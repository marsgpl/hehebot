var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};
if (!window.$ || !window.jQuery) {
    var $ = function $(things) {
        return $
    };
    $.fn = {};
    $.fake = true;
    var jQuery = $
}(function($) {
    $.fn.serializeObject = function() {
        var result = {};
        var extend = function extend(i, element) {
            var node = result[element.name];
            if ("undefined" !== typeof node && node !== null) {
                if ($.isArray(node)) {
                    node.push(element.value)
                } else {
                    result[element.name] = [node, element.value]
                }
            } else {
                result[element.name] = element.value
            }
        };
        $.each(this.serializeArray(), extend);
        return result
    };
    $.loadPage = function(url, params, method) {
        if (!url) url = document.location.href;
        if (!params || method && method.match(/^GET$/i)) {
            if (params) {
                url += url.match(/[?]/) ? "&" : "?";
                url += $.param(params)
            }
            document.location = url
        } else {
            var $form = $("<form>").attr("method", "post").attr("action", url);
            $.each(params, function(name, value) {
                _load_value_into_form($form, name, value)
            });
            $form.appendTo("body");
            $form.submit()
        }
    };

    function _load_value_into_form($form, name, value) {
        switch (typeof value === "undefined" ? "undefined" : _typeof(value)) {
            case "undefined":
                break;
            case "boolean":
            case "number":
            case "string":
                $("<input type='hidden'>").attr("name", name).attr("value", value).appendTo($form);
                break;
            case "object":
            default:
                $.each(value, function(n1, v1) {
                    _load_value_into_form($form, name + "[" + n1 + "]", v1)
                });
                break
        }
    }
    $.fn.imageRealSize = function(callback) {
        if (!$.isFunction(callback)) throw new Error("Arg for imageRealSize() isn't a function, it should be.");
        if (this.attr("realWidth") !== undefined) {
            callback(this.attr("realWidth"), this.attr("realHeight"))
        } else {
            $("<img/>").attr("src", this.attr("src")).load(function() {
                callback(this.width, this.height)
            })
        }
    };
    $.fn.imageHoverForFullsize = function(action) {
        if (!(action && action == "click")) action = "hover";
        var whole_action = function whole_action() {
            var coords = $(this).offset();
            coords.left += Math.round($(this).width() / 2);
            coords.top += Math.round($(this).height() / 2);
            var img = $("<img />").attr({
                src: $(this).attr("src")
            }).appendTo("body");
            var w = img.width();
            var h = img.height();
            var css = {
                width: "auto",
                height: "auto",
                "max-width": "none",
                "max-height": "none",
                position: "absolute",
                left: coords.left + "px",
                top: coords.top + "px",
                "z-index": "999999999",
                "margin-left": "-" + Math.round(w / 2) + "px",
                "margin-top": "-" + Math.round(h / 2) + "px"
            };
            img.css(css);
            var closing = function closing() {
                img.remove()
            };
            if (action == "hover") {
                img.mouseout(closing)
            } else {
                window.setTimeout(function() {
                    $("body").one("click", closing)
                }, 300)
            }
            var W = $(window).width();
            var H = $(window).height();
            if (w > W * .9) {
                var old_w = w;
                w = Math.round(W * .9);
                h = Math.round(h * w / old_w);
                if (h > H * .9) {
                    var old_h = h;
                    h = Math.round(H * .9);
                    w = Math.round(w * h / old_h)
                }
                img.css({
                    width: w + "px",
                    height: h + "px",
                    "margin-left": "-" + Math.round(w / 2) + "px",
                    "margin-top": "-" + Math.round(h / 2) + "px"
                })
            }
            var pos = img.offset();
            var T = $(window).scrollTop();
            var L = $(window).scrollLeft();
            if (pos.top < T) {
                img.offset({
                    top: T + 4
                })
            } else if (pos.top + h > T + H) {
                img.offset({
                    top: T + H - h - 4
                })
            }
            if (pos.left < L) {
                img.offset({
                    left: L + 4
                })
            } else if (pos.left + w > L + W) {
                img.offset({
                    left: L + W - w - 4
                })
            }
        };
        if (action == "hover") {
            this.mouseenter(whole_action)
        } else {
            this.css("cursor", "pointer");
            this.click(whole_action)
        }
    };
    $.fn.centerMe = function() {
        this.css("position", "absolute");
        this.css("top", Math.max(0, ($(window).height() - $(this).outerHeight()) / 2 + $(window).scrollTop()) + "px");
        this.css("left", Math.max(0, ($(window).width() - $(this).outerWidth()) / 2 + $(window).scrollLeft()) + "px");
        return this
    };
    $.blackScreen = function() {
        var args = Array.prototype.slice.call(arguments);
        var callback = function callback() {};
        if (typeof args[0] === "function") callback = args.shift();
        var zindex = 999;
        if (typeof args[0] === "number") zindex = args.shift();
        var css = {
            background: "rgba(0,0,0,0.5)",
            "z-index": zindex,
            position: "absolute",
            top: "0",
            left: "0",
            right: "0",
            height: $(document).height() + "px",
            cursor: "crosshair"
        };
        $("<div id='black_screen'></div>").css(css).appendTo("body").click(function() {
            callback();
            $(this).remove()
        })
    };
    $.fn.fake_tabs = function() {
        $(this).attr("class", "site_block box_white ui-tabs ui-widget ui-widget-content ui-corner-all");
        var ul = $(this).children("ul");
        ul.attr("class", "ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");
        ul.children("li").attr("class", "ui-state-default ui-corner-top");
        ul.children("li[rel=selected]").attr("class", "ui-state-default ui-corner-top ui-tabs-selected ui-state-active")
    };
    $.fn.isScreenVisible = function() {
        var bcr = this[0].getBoundingClientRect();
        return bcr.top >= 0 && bcr.bottom <= window.innerHeight
    };
    $.fn.scrollToMe = function() {
        var bcr = this[0].getBoundingClientRect();
        if (bcr.top < 0) {
            var sc = Math.abs(bcr.top) + 5;
            $.scrollTo("-=" + sc + "px", "slow")
        } else if (bcr.bottom > window.innerHeight) {
            var sc = bcr.bottom - window.innerHeight + 5;
            $.scrollTo("+=" + sc + "px", "slow")
        }
    };
    $.fn.slow_remove = function() {
        this.hide("slow", function() {
            $(this).remove()
        })
    };
    $.fn.wasModified = function(unmodifiedIfEmpty) {
        var value = this.val();
        var domInput = this.get(0);
        if (value === undefined) return false;
        if (value === "" && unmodifiedIfEmpty) return false;
        if (domInput.defaultValue == value) return false;
        domInput.defaultValue = value;
        return true
    };
    $.getQueryParam = function(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var res = window.location.search.substring(1).replace(/(^&|&$)/, "").match(new RegExp("(^|&)" + name + "=([^&]*)"));
        if (!res) {
            return arguments[1] || ""
        }
        return decodeURIComponent(res[2].replace(/^\s|\s+^/g, ""))
    };
    $.extend({
        getUrlVars: function getUrlVars() {
            var vars = {},
                hash;
            var hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&");
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split("=");
                vars[decodeURIComponent(hash[0])] = decodeURIComponent(hash[1])
            }
            return vars
        },
        getUrlVar: function getUrlVar(name) {
            return $.getUrlVars()[name]
        }
    });
    $.count = function(o) {
        switch (typeof o === "undefined" ? "undefined" : _typeof(o)) {
            case "object":
                if (o.isArray) return o.length;
                var i, count = 0;
                for (i in o) {
                    if (o.hasOwnProperty(i)) count++
                }
                return count;
            default:
                return false
        }
    };
    $.getScriptOnce = function(url, success) {
        if (!this.getScriptOnce_already_done) this.getScriptOnce_already_done = {};
        if (this.getScriptOnce_already_done[url]) {
            success()
        } else {
            this.getScriptOnce_already_done[url] = true;
            var options = {
                dataType: "script",
                cache: true,
                url: url,
                success: success
            };
            this.ajax(options)
        }
    };
    $.animation = function(callback, duration, number_from, number_to, loop) {
        if (number_from == number_to) return;
        var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame;
        if (!requestAnimationFrame) {
            callback(number_to);
            return
        }
        var d = {
            t_start: (new Date).getTime(),
            t_end: (new Date).getTime() + duration,
            duration: duration,
            from: number_from,
            to: number_to,
            callback: callback,
            loop: loop
        };
        var make_step = function make_step() {
            var now = (new Date).getTime();
            var val = (d.to - d.from) * (now - d.t_start) / d.duration;
            val = d.from + Math.round(val);
            if (d.to > d.from) {
                if (val > d.to) val = d.to
            } else {
                if (val < d.to) val = d.to
            }
            d.callback(val);
            if (d.t_end <= now) {
                if (d.loop) {
                    if (typeof d.loop === "function") {
                        d.loop();
                        return
                    }
                    d.t_start = now;
                    d.t_end = now + d.duration;
                    if (d.loop === -1) {
                        var tmp = d.to;
                        d.to = d.from;
                        d.from = tmp
                    }
                } else {
                    if (val != d.to) d.callback(d.to);
                    return
                }
            }
            requestAnimationFrame(make_step)
        };
        make_step()
    };
    $.fn.resized = function(f) {
        this.resized(f)
    };
    $.resized = function(doneResizingCallback, time_tolerance) {
        var resizeTimer;
        time_tolerance = time_tolerance || 250;
        $(window).on("resize", function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(doneResizingCallback, time_tolerance)
        })
    }
})(jQuery);
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};

function reload() {
    var url = document.location.href;
    document.location.replace(url)
}

function empty(mixed_var) {
    var undef, key, i, len;
    var emptyValues = [undef, null, false, 0, "", "0"];
    for (i = 0, len = emptyValues.length; i < len; i++) {
        if (mixed_var === emptyValues[i]) {
            return true
        }
    }
    if ((typeof mixed_var === "undefined" ? "undefined" : _typeof(mixed_var)) === "object") {
        for (key in mixed_var) {
            return false
        }
        return true
    }
    return false
}

function trim(str) {
    switch (typeof str === "undefined" ? "undefined" : _typeof(str)) {
        case "number":
            return str + "";
        case "string":
            return str.replace(/^\s*(.*?)\s*$/, "$1");
        case "undefined":
        default:
            return ""
    }
}

function ucfirst(str) {
    return str.charAt(0).toUpperCase() + str.substring(1)
}

function random(from, to) {
    return Math.floor(Math.random() * (1 + to - from) + from)
}

function toIntAdd(s, add) {
    var sep = s.replace(/\d/g, "").substr(0, 1);
    var n = s.replace(/\D/g, "");
    n = parseInt(n, 10);
    var s1 = n + add;
    if (sep && s1 >= 1e3) {
        s1 += "";
        var s2 = s1.substr(-3);
        s1 = s1.substr(0, s1.length - 3);
        while (s1.length) {
            s2 = s1.substr(-3) + sep + s2;
            s1 = s1.substr(0, s1.length - 3)
        }
        s1 = s2
    }
    return s1
}

function is_mobile() {
    if (typeof is_mobile.b == "undefined") {
        var a = navigator.userAgent || navigator.vendor || window.opera;
        is_mobile.b = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))
    }
    return is_mobile.b
}

function is_tablet() {
    var is_tablet = false;
    is_tablet |= /ipad|android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent);
    is_tablet |= navigator.userAgent.match(/Mac/) && navigator.maxTouchPoints && navigator.maxTouchPoints > 2;
    return is_tablet
}

function is_mobile_device() {
    return is_mobile() || is_tablet()
}

function is_ios() {
    var user_agent = navigator.userAgent || navigator.vendor || window.opera;
    return /iPad|iPhone|iPod/.test(user_agent) && !window.MSStream
}

function get_lang() {
    if (window.Phoenix && window.Phoenix.language) {
        return window.Phoenix.language
    }
    if (document.cookies && document.cookies.lang && document.cookies.lang.match(/^[a-z]{2}(_[A-Z]{2})?$/)) {
        return document.cookies.lang
    }
    var lang = window.navigator.languages ? window.navigator.languages[0] : null;
    lang = lang || window.navigator.language || window.navigator.browserLanguage || window.navigator.userLanguage;
    return lang
}

function lang2simple(lang) {
    return lang.split("[_-]")[0]
}

function lang2locale(lang) {
    if (lang.indexOf("-") !== -1) return lang;
    if (lang.indexOf("_") !== -1) return lang.replace(/_/, "-");
    var exceptions = {
        br: "pt-BR",
        ca: "ca-ES",
        el: "el-GR",
        en: "en-US",
        ja: "ja-JP",
        jp: "ja-JP"
    };
    if (exceptions[lang]) return exceptions[lang];
    return lang + "-" + lang.toUpperCase()
}

function number_format_auto(number) {
    if (typeof Intl != "undefined") {
        var loc = lang2locale(get_lang());
        return new Intl.NumberFormat(loc).format(number)
    } else {
        return number
    }
}

function number_format(number, decimals, decPoint, thousandsSep) {
    number = (number + "").replace(/[^0-9+\-Ee.]/g, "");
    var n = !isFinite(+number) ? 0 : +number;
    var prec = !isFinite(+decimals) ? 0 : Math.abs(decimals);
    var sep = typeof thousandsSep === "undefined" ? "," : thousandsSep;
    var dec = typeof decPoint === "undefined" ? "." : decPoint;
    var s = "";
    var toFixedFix = function toFixedFix(n, prec) {
        var k = Math.pow(10, prec);
        return "" + (Math.round(n * k) / k).toFixed(prec)
    };
    s = (prec ? toFixedFix(n, prec) : "" + Math.round(n)).split(".");
    if (s[0].length > 3) {
        s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep)
    }
    if ((s[1] || "").length < prec) {
        s[1] = s[1] || "";
        s[1] += new Array(prec - s[1].length + 1).join("0")
    }
    return s.join(dec)
}

function get_dec_and_sep(lang) {
    var dec_sign, separator;
    lang = lang.replace(/-/, "_");
    switch (lang) {
        case "en_CA":
        case "zh_CN":
        case "zh_TW":
        case "zh":
        case "si_LK":
            dec_sign = ".";
            separator = "В ";
            break;
        case "tr":
        case "tr_TR":
        case "pt_BR":
        case "au":
        case "id_ID":
        case "id":
            dec_sign = ",";
            separator = ".";
            break;
        case "ir":
        case "ko_KR":
        case "ms_MY":
        case "nz":
        case "en_PH":
        case "en_SG":
        case "th":
        case "th_TH":
        case "gb":
        case "uk":
        case "en_UK":
            dec_sign = "В·";
            separator = ",";
            break;
        case "en":
        case "en_US":
        case "jp":
        case "ja_JP":
            dec_sign = ".";
            separator = ",";
            break;
        default:
            dec_sign = ",";
            separator = "В ";
            break
    }
    return {
        dec: dec_sign,
        sep: separator
    }
}

function number_format_lang(number, decimals) {
    decimals = decimals || 0;
    var dec2 = Math.pow(10, decimals);
    number *= dec2;
    if (Math.abs(number % 1) < 1e-5) number = Math.floor(number);
    else number = Math.ceil(number);
    number /= dec2;
    var lang = get_lang();
    var a = get_dec_and_sep(lang);
    return number_format(number, decimals, a.dec, a.sep)
}

function number_reduce(i) {
    if (i < 1e4) return number_format_lang(i);
    var units = [" ", "K", "M", "G", "T", "P", "E", "Z", "Y"];
    var round, a = 0;
    while (i >= 1e3) {
        i /= 1e3;
        a++
    }
    if (i < 10) round = 2;
    else if (i < 100) round = 1;
    else round = 0;
    i = number_format_lang(i, round);
    if (a) i += units[a];
    return i
}

function str_replace(str, replaces) {
    var k, k2, reg;
    for (k in replaces) {
        k2 = k.replace(/[.*+?^${}()|\[\]\/\\]/g, "\\$&");
        reg = new RegExp("\\[" + k2 + "\\]", "g");
        str = str.replace(reg, replaces[k])
    }
    return str
}(function() {
    if (!window.console) {
        window.console = {}
    }
    var m = ["log", "info", "warn", "error", "debug", "trace", "dir", "group", "groupCollapsed", "groupEnd", "time", "timeEnd", "profile", "profileEnd", "dirxml", "assert", "count", "markTimeline", "timeStamp", "clear"];
    for (var i = 0; i < m.length; i++) {
        if (!window.console[m[i]]) {
            window.console[m[i]] = function() {}
        }
    }
})();

function get_tr_label(id_text, fallback) {
    if (typeof tr_labels == "undefined") return fallback;
    if (tr_labels[id_text] == undefined) return fallback;
    return tr_labels[id_text]
}

function in_clipboard(to_copy) {
    if (!/boolean|number|string/.test(typeof to_copy === "undefined" ? "undefined" : _typeof(to_copy))) {
        to_copy = to_copy.html();
        to_copy = to_copy.replace(/&gt;/g, ">").replace(/&lt;/g, "<")
    }
    var dialog = get_tr_label(3520, "Press Ctrl+c, then ENTER");
    window.prompt(dialog, to_copy)
}

function confirm_unload(confirm_message, condition_check) {
    window.onbeforeunload = function(e) {
        if (typeof confirm_message === "number") {
            confirm_message = get_tr_label(confirm_message, "")
        } else if (typeof confirm_message === "function") {
            condition_check = confirm_message;
            confirm_message = null
        }
        if (condition_check) {
            var a = condition_check();
            if (empty(a)) return null;
            if (typeof confirm_message !== "string" && typeof a === "string") confirm_message = a
        }
        if (empty(confirm_message)) return null;
        console.log(navigator.userAgent);
        if (/irefox\/([4-9]|[12]\d)\./.test(navigator.userAgent)) {
            alert(confirm_message)
        }
        return confirm_message
    }
}

function get_location_query() {
    if (window.location.search != undefined) return window.location.search.replace(/^[?]/, "");
    var get_params = window.location.href.split("?");
    if (get_params[1] == undefined) return "";
    return get_params[1]
}

function url_add_param(url, param) {
    if (url.indexOf("?") === -1) url += "?";
    else url += "&";
    return url + param
}

function _GET(url) {
    if (!url) url = document.location.href;
    var search = url.replace(/^.*[?]/, "");
    if (empty(search)) return {};
    return parse_str(search)
}

function parse_str(search) {
    search = search.replace(/[+]/g, "%20");
    var out = {};
    search = search.split("&");
    for (var i in search) {
        var s = search[i].split("=");
        var key = decodeURIComponent(s[0]);
        var val = s[1] ? decodeURIComponent(s[1]) : "";
        if (-1 !== key.indexOf("[")) {
            key = key.split(/[\[\]]+/);
            key.pop();
            var goingIn = out;
            var lastOne = key.pop();
            while (key.length) {
                var subKey = key.shift();
                if (_typeof(goingIn[subKey]) !== "object") goingIn[subKey] = {};
                goingIn = goingIn[subKey]
            }
            goingIn[lastOne] = val
        } else {
            out[key] = val
        }
    }
    return out
}

function http_build_query(vars) {
    var flatten = {};

    function goingDeep(key, value) {
        if ((typeof value === "undefined" ? "undefined" : _typeof(value)) !== "object") {
            flatten[key] = value;
            return
        }
        for (var k in value) {
            goingDeep(key + "[" + k + "]", value[k])
        }
    }
    for (var k in vars) {
        goingDeep(k, vars[k])
    }
    var str = "";
    for (var k in flatten) {
        str += "&" + encodeURIComponent(k) + "=" + encodeURIComponent(flatten[k])
    }
    return str.substring(1)
}

function form_query2hidden(id) {
    var form = document.getElementById(id);
    if (!form) return;
    var q = form.action.split("?", 2);
    if (q.length <= 1) return;
    form.action = q[0];
    var pairs = q[1].split("&");
    for (var p in pairs) {
        var pp = pairs[p].split("=", 2);
        var node = document.createElement("input");
        node.type = "hidden";
        node.name = pp[0];
        node.value = pp[1];
        form.appendChild(node)
    }
}

function setIntervalFromNow(callback, time) {
    var int_name = setInterval(callback, time);
    callback();
    return int_name
}

function fillSelect(select, options) {
    if (select instanceof jQuery) select = select.get()[0];
    else if (typeof select === "string") select = document.getElementById(select);
    select.options.length = 0;
    for (var i = 0; i < options.length; i++) {
        var d = options[i];
        var o = new Option(d, d);
        select.options.add(o)
    }
}(function() {
    var c1 = document.cookie.split(/; */);
    var c = {};
    for (var i in c1) {
        var c2 = c1[i].split(/=/, 2);
        c[c2[0]] = decodeURIComponent(c2[1])
    }
    document.cookies = c;
    window.set_cookie = function set_cookie(cname, cvalue, exdays) {
        if (exdays) {
            var d = new Date;
            d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1e3);
            var expires = "; expires=" + d.toUTCString()
        } else var expires = "";
        document.cookie = cname + "=" + encodeURIComponent(cvalue) + expires;
        document.cookies[cname] = cvalue
    };
    window.setCookie = window.set_cookie
})();

function deleteCookie(name) {
    document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"
}
var delete_cookie = deleteCookie;

function getLocalStorage() {
    var storage;
    try {
        storage = window.localStorage
    } catch (ex) {
        console.log(ex)
    }
    return storage
}

function localStorageGetItem(key) {
    var storage = getLocalStorage();
    if (storage) return storage.getItem(key);
    return null
}

function localStorageSetItem(key, value) {
    var storage = getLocalStorage();
    if (storage) storage.setItem(key, value)
}

function decimal2roman(num) {
    var roman = "";
    var lookup = {
        M: 1e3,
        CM: 900,
        D: 500,
        CD: 400,
        C: 100,
        XC: 90,
        L: 50,
        XL: 40,
        X: 10,
        IX: 9,
        V: 5,
        IV: 4,
        I: 1
    };
    for (var i in lookup) {
        while (num >= lookup[i]) {
            roman += i;
            num -= lookup[i]
        }
    }
    return roman
}
var Phoenix = {};
Phoenix.ajax = function Phoenix_ajax(params, callback) {
    var url = Phoenix.site_root + Phoenix.site_locations.phoenix.entry;
    if (!$.isFunction(callback)) callback = function callback() {};
    if (!("call" in params)) {
        if (params.module) params.call = params.module;
        else console.log("Phoenix.ajax()", "Dev error: didn't define module. Bad.", params)
    }
    return $.post(url, params, callback, "json")
};
if (!$("#loading").length) $(function() {
    $("body").append('<div id="loading" style="display:none"></div>')
});
Phoenix.language = "en";
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var PhoenixModal = function() {
    function PhoenixModal() {
        _classCallCheck(this, PhoenixModal);
        this.devMode = false;
        this._logger("loaded.")
    }
    _createClass(PhoenixModal, [{
        key: "open",
        value: function open(content, params, closeCallback) {
            if ($("#phoenix-modal-overlay").length) this.close();
            this.$content = $(content);
            this.$contentParent = this.$content.parent();
            if (!this.$content.length) {
                this._logger("Empty contentObj. End process!", "error");
                return
            }
            this.params = params;
            this.closeCallback = closeCallback;
            this._buildModalOverlay();
            this._buildModalPanel();
            this._eventListeners();
            this._logger("Opening a window!", "info")
        }
    }, {
        key: "_buildModalOverlay",
        value: function _buildModalOverlay() {
            var html = '<div id="phoenix-modal-overlay"></div>';
            $("body").append(html)
        }
    }, {
        key: "_buildModalPanel",
        value: function _buildModalPanel() {
            var $html = $('<div id="phoenix-modal-panel">\n\t\t\t\t\t\t\t<span id="phoenix-modal-close">X</span>\n\t\t\t\t\t\t\t<div id="phoenix-modal-body"></div>\n\t\t\t\t\t\t</div>');
            $html.find("#phoenix-modal-body").append(this.$content);
            $("#phoenix-modal-overlay").append($html);
            $html.find("#phoenix-modal-body > *").show()
        }
    }, {
        key: "_eventListeners",
        value: function _eventListeners() {
            var theClass = this;
            $("#phoenix-modal-overlay, #phoenix-modal-close").on("click", function(event) {
                if (event.target.id == "phoenix-modal-overlay" || event.target.id == "phoenix-modal-close") theClass.close()
            })
        }
    }, {
        key: "close",
        value: function close() {
            this._logger("Close current modal!", "info");
            this.$content.hide();
            this.$content.appendTo(this.$contentParent);
            $("#phoenix-modal-overlay").remove();
            if (this.closeCallback && typeof this.closeCallback == "function") this.closeCallback();
            else this._logger("Invalid OR Unset - close callback function.", "error")
        }
    }, {
        key: "_logger",
        value: function _logger(text, type) {
            if (!this.devMode) return;
            var typeMessage = "";
            switch (type) {
                case "error":
                    typeMessage = "[ !!! ]";
                    break;
                case "info":
                    typeMessage = "[ > ]";
                    break;
                default:
                    typeMessage = "";
                    break
            }
            console.log("" + (type == "error" ? "[31m" : "[35m") + typeMessage + " PhoenixModal: " + text)
        }
    }]);
    return PhoenixModal
}();
var phoenixModal = {};
$(function() {
    phoenixModal = new PhoenixModal
});

function mobile_input(selector) {
    if (!is_mobile()) return;
    if (window.Phoenix && Phoenix["__"] && Phoenix["__"]["General"]) {
        var tr = window.Phoenix["__"]["General"]
    } else {
        var tr = {
            input_next: "Next",
            input_done: "Done",
            input_cancel: "Cancel"
        }
    }
    $(selector).find("input[mobile_input]").click(function() {
        var $orig_input = $(this);
        if ($("#phoenix_mobile_input").length) $("#phoenix_mobile_input").remove();
        var $div = $('<div id="phoenix_mobile_input"></div>');
        var $div2 = $("<form></form>").appendTo($div);
        var $input = $("<input />").appendTo($div2);
        var attrs = $orig_input[0].attributes;
        for (var i = 0; i < attrs.length; i++) {
            $input.attr(attrs[i].name, attrs[i].value)
        }
        $input.val($orig_input.val());
        var $done = $('<button type="button" rel="done"></button>').appendTo($div2);
        if ($orig_input.attr("mobile_input_next")) $done.text(tr.input_next);
        else $done.text(tr.input_done);
        var $cancel = $('<button type="button" rel="cancel"></button>').text(tr.input_cancel).appendTo($div2);
        $div.appendTo("body");
        $div2.submit(function(event) {
            event.preventDefault();
            $done.click()
        });
        $done.click(function() {
            $orig_input.val($input.val());
            if ($orig_input.attr("mobile_input_next")) {
                var next = $orig_input.attr("mobile_input_next");
                var $next_input = $('input[rel="' + next + '"]').first();
                $div.remove();
                $next_input.click()
            } else {
                $div.remove()
            }
        });
        $cancel.click(function() {
            $("#phoenix_mobile_input").remove();
            $orig_input.focus()
        });
        $input.focus()
    })
}
$(function() {
    mobile_input("body")
});
var FullScreen = {
    iframe: function() {
        $(document.body).empty().prepend("<center><br /><br />Loading your page...</center>");
        var url = url_add_param(document.location.href, "fs=1");
        var style = "position:absolute; top:0; right:0; bottom:0; left:0; width:100%; height:100%; overflow:hidden;";
        $(document.body).prepend('<iframe id="fullscreen" style="' + style + '" src="' + url + '" frameborder="no"></iframe>')
    },
    click: function() {
        var screenfull = window.top.screenfull;
        if (window.is_mobile && window.is_mobile()) screenfull.request();
        else screenfull.toggle();
        if (window.self === window.top) {
            FullScreen.iframe()
        }
    }
};
var FullSize = {
    enabled: false,
    scale: 1,
    width: 0,
    height: 0,
    top: 0,
    left: 0,
    rotate: false,
    ajax_server: null,
    ajax_server_on_run: false,
    vertically_centered: true,
    max_scale: 3,
    min_scale: .3,
    box_size: [1e3, 580],
    force_orientation: false,
    height_ratio: 1,
    is_ios: false,
    debug: false,
    updateAll: function(before_document_ready) {
        var tmp_scale = this.scale;
        this.calculateAndSetAll();
        if (!before_document_ready && this.scale == tmp_scale) return;
        if (this.debug) console.log("FS updateAll", this.getStatus());
        var styles_html = this.getCss();
        this.writeCssOnDocument(styles_html, before_document_ready)
    },
    getCss: function() {
        var styles = "position: absolute; top: " + this.top + "px; left: " + this.left + "px; transform-origin: left top;";
        if (this.rotate) {
            styles += "transform: scale(" + this.scale + ") rotate(-90deg);"
        } else {
            styles += "transform: scale(" + this.scale + ");"
        }
        styles = css_add_prefixes(styles);
        return '<style id="fixed_size_auto"> .fixed_scaled { ' + styles + " } </style>"
    },
    writeCssOnDocument: function(styles_html, before_document_ready) {
        if (before_document_ready) {
            document.write(styles_html)
        } else {
            var $styles_html = $("#fixed_size_auto");
            if ($styles_html.length) {
                $styles_html.replaceWith(styles_html)
            } else {
                $("body").append(styles_html)
            }
        }
    },
    calculateAndSetAll: function() {
        this.rotate = this.findRotation();
        var dimensions = this.findDimensions();
        this.width = dimensions.width;
        this.height = dimensions.height;
        this.scale = this.findScale();
        if (this.scale > this.max_scale) {
            this.scale = this.max_scale
        }
        if (this.scale < this.min_scale) {
            this.scale = this.min_scale
        }
        var position = this.findPosition();
        this.top = position.top;
        this.left = position.left;
        if (this.debug) console.log("FS Calculating: ", dimensions, position)
    },
    findOrientation: function() {
        if (window.is_mobile && !window.is_mobile()) {
            return false
        }
        if (this.box_size[0] > this.box_size[1]) {
            return "landscape"
        } else {
            return "portrait"
        }
    },
    findRotation: function() {
        var width = this.box_size[0];
        var height = this.box_size[1];
        if (height > width && this.force_orientation == "landscape") {
            return true
        }
        if (width > height && this.force_orientation == "portrait") {
            return true
        }
        return false
    },
    findDimensions: function() {
        var width = $(window).width();
        var height = $(window).height();
        if (this.is_ios) {
            width = window.screen.width;
            height = window.screen.height;
            if (window.orientation == 90 || window.orientation == -90) {
                width = window.screen.height;
                height = window.screen.width
            }
            if (window.parent) {
                if (height != window.parent.innerHeight) {
                    height = window.parent.innerHeight
                }
            }
        }
        return {
            width: width,
            height: height
        }
    },
    findScale: function() {
        var box_w = this.box_size[0];
        var box_h = this.box_size[1];
        var win_w = this.width;
        var win_h = this.height;
        if (this.rotate) {
            if (win_h > win_w && this.force_orientation == "landscape") {
                return win_h / box_w
            }
            if (win_w > win_h && this.force_orientation == "portrait") {
                return win_w / box_h
            }
        }
        if (box_w / box_h > win_w / win_h) {
            return win_w / box_w
        } else {
            return win_h / box_h
        }
    },
    findPosition: function() {
        var width = this.width;
        var height = this.height;
        var scale = this.scale;
        var box_width = this.box_size[0] * scale;
        var box_height = this.box_size[1] * scale;
        var centerMargin = function(window_length, box_length) {
            if (box_length < window_length - 2) {
                return Math.floor((window_length - box_length) / 2)
            }
            return 0
        };
        var top;
        var left;
        if (this.rotate) {
            top = height;
            top -= centerMargin(height, box_width);
            left = 0;
            if (this.vertically_centered) {
                left += centerMargin(width, box_height)
            }
        } else {
            left = centerMargin(width, box_width);
            if (this.vertically_centered) {
                top = centerMargin(height, box_height)
            } else {
                top = 0
            }
        }
        if (this.debug) console.log("FS Position Calc: ", width, box_width, height, box_height);
        return {
            top: top,
            left: left
        }
    },
    onReady: function() {
        if (!this.enabled) return;
        var me = this;
        $(window).on("orientationchange", function() {
            me.updateAll()
        });
        if (this.is_ios) {
            setInterval(function() {
                me.updateAll()
            }, 1e3)
        } else {
            $(window).resize(function() {
                me.updateAll()
            })
        }
        if (this.ajax_server) {
            if (this.ajax_server_on_run) this.ajaxSaveScale();
            $.resized(function() {
                me.ajaxSaveScale()
            })
        }
    },
    ajaxSaveScale: function() {
        if (!this.ajax_server) return;
        var stored_scale = localStorageGetItem("FullSize_scale");
        if (stored_scale) {
            var diff = this.scale - stored_scale;
            if (Math.abs(diff) < .05) return
        }
        localStorageSetItem("FullSize_scale", this.scale);
        this.ajax_server(this.scale)
    },
    run: function() {
        this.enabled = true;
        this.is_ios = window.is_ios && window.is_ios();
        if (this.force_orientation === true) {
            this.force_orientation = this.findOrientation()
        }
        this.updateAll(true);
        var me = this;
        $(function() {
            me.onReady()
        })
    },
    getStatus: function() {
        var rounded_scale = Math.round(this.scale * 100) / 100;
        var canvas = this.width + "x" + this.height + "+" + this.left + "+" + this.top;
        return canvas + ", *" + rounded_scale + ", x" + window.devicePixelRatio
    }
};

function css_add_prefixes(str) {
    var out = str;
    for (var i in {
            webkit: 1,
            moz: 1,
            ms: 1,
            o: 1
        }) {
        out += str.replace(/(transform|keyframes|animation|transition)/g, "-" + i + "-$&")
    }
    return out
}(function(factory) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], factory)
    } else if (typeof exports === "object") {
        module.exports = factory(require("jquery"))
    } else {
        factory(jQuery)
    }
})(function(jQuery) {
    "use strict";
    var domfocus = false,
        mousefocus = false,
        tabindexcounter = 0,
        ascrailcounter = 2e3,
        globalmaxzindex = 0;
    var $ = jQuery,
        _doc = document,
        _win = window,
        $window = $(_win);
    var delegatevents = [];

    function getScriptPath() {
        var scripts = _doc.currentScript || function() {
            var s = _doc.getElementsByTagName("script");
            return s.length ? s[s.length - 1] : false
        }();
        var path = scripts ? scripts.src.split("?")[0] : "";
        return path.split("/").length > 0 ? path.split("/").slice(0, -1).join("/") + "/" : ""
    }
    var setAnimationFrame = _win.requestAnimationFrame || _win.webkitRequestAnimationFrame || _win.mozRequestAnimationFrame || false;
    var clearAnimationFrame = _win.cancelAnimationFrame || _win.webkitCancelAnimationFrame || _win.mozCancelAnimationFrame || false;
    if (!setAnimationFrame) {
        var anilasttime = 0;
        setAnimationFrame = function(callback, element) {
            var currTime = (new Date).getTime();
            var timeToCall = Math.max(0, 16 - (currTime - anilasttime));
            var id = _win.setTimeout(function() {
                callback(currTime + timeToCall)
            }, timeToCall);
            anilasttime = currTime + timeToCall;
            return id
        };
        clearAnimationFrame = function(id) {
            _win.clearTimeout(id)
        }
    } else {
        if (!_win.cancelAnimationFrame) clearAnimationFrame = function(id) {}
    }
    var ClsMutationObserver = _win.MutationObserver || _win.WebKitMutationObserver || false;
    var now = Date.now || function() {
        return (new Date).getTime()
    };
    var _globaloptions = {
        zindex: "auto",
        cursoropacitymin: 0,
        cursoropacitymax: 1,
        cursorcolor: "#668899",
        cursorwidth: "4px",
        cursorborder: "#668899",
        cursorborderradius: "10px",
        scrollspeed: 40,
        mousescrollstep: 9 * 3,
        touchbehavior: false,
        emulatetouch: false,
        hwacceleration: true,
        usetransition: true,
        boxzoom: false,
        dblclickzoom: true,
        gesturezoom: true,
        grabcursorenabled: true,
        autohidemode: false,
        background: "",
        iframeautoresize: true,
        cursorminheight: 32,
        preservenativescrolling: true,
        railoffset: false,
        railhoffset: false,
        bouncescroll: true,
        spacebarenabled: true,
        railpadding: {
            top: 0,
            right: 0,
            left: 0,
            bottom: 0
        },
        disableoutline: true,
        horizrailenabled: true,
        railalign: "right",
        railvalign: "bottom",
        enabletranslate3d: true,
        enablemousewheel: true,
        enablekeyboard: true,
        smoothscroll: true,
        sensitiverail: true,
        enablemouselockapi: true,
        cursorfixedheight: false,
        directionlockdeadzone: 6,
        hidecursordelay: 400,
        nativeparentscrolling: true,
        enablescrollonselection: true,
        overflowx: true,
        overflowy: true,
        cursordragspeed: .3,
        rtlmode: "auto",
        cursordragontouch: false,
        oneaxismousemode: "auto",
        scriptpath: getScriptPath(),
        preventmultitouchscrolling: true,
        disablemutationobserver: false,
        enableobserver: true,
        scrollbarid: false
    };
    var browserdetected = false;
    var getBrowserDetection = function() {
        if (browserdetected) return browserdetected;
        var _el = _doc.createElement("DIV"),
            _style = _el.style,
            _agent = navigator.userAgent,
            _platform = navigator.platform,
            d = {};
        d.haspointerlock = "pointerLockElement" in _doc || "webkitPointerLockElement" in _doc || "mozPointerLockElement" in _doc;
        d.isopera = "opera" in _win;
        d.isopera12 = d.isopera && "getUserMedia" in navigator;
        d.isoperamini = Object.prototype.toString.call(_win.operamini) === "[object OperaMini]";
        d.isie = "all" in _doc && "attachEvent" in _el && !d.isopera;
        d.isieold = d.isie && !("msInterpolationMode" in _style);
        d.isie7 = d.isie && !d.isieold && (!("documentMode" in _doc) || _doc.documentMode === 7);
        d.isie8 = d.isie && "documentMode" in _doc && _doc.documentMode === 8;
        d.isie9 = d.isie && "performance" in _win && _doc.documentMode === 9;
        d.isie10 = d.isie && "performance" in _win && _doc.documentMode === 10;
        d.isie11 = "msRequestFullscreen" in _el && _doc.documentMode >= 11;
        d.ismsedge = "msCredentials" in _win;
        d.ismozilla = "MozAppearance" in _style;
        d.iswebkit = !d.ismsedge && "WebkitAppearance" in _style;
        d.ischrome = d.iswebkit && "chrome" in _win;
        d.ischrome38 = d.ischrome && "touchAction" in _style;
        d.ischrome22 = !d.ischrome38 && (d.ischrome && d.haspointerlock);
        d.ischrome26 = !d.ischrome38 && (d.ischrome && "transition" in _style);
        d.cantouch = "ontouchstart" in _doc.documentElement || "ontouchstart" in _win;
        d.hasw3ctouch = (_win.PointerEvent || false) && (navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0);
        d.hasmstouch = !d.hasw3ctouch && (_win.MSPointerEvent || false);
        d.ismac = /^mac$/i.test(_platform);
        d.isios = d.cantouch && /iphone|ipad|ipod/i.test(_platform);
        d.isios4 = d.isios && !("seal" in Object);
        d.isios7 = d.isios && "webkitHidden" in _doc;
        d.isios8 = d.isios && "hidden" in _doc;
        d.isios10 = d.isios && _win.Proxy;
        d.isandroid = /android/i.test(_agent);
        d.haseventlistener = "addEventListener" in _el;
        d.trstyle = false;
        d.hastransform = false;
        d.hastranslate3d = false;
        d.transitionstyle = false;
        d.hastransition = false;
        d.transitionend = false;
        d.trstyle = "transform";
        d.hastransform = "transform" in _style || function() {
            var check = ["msTransform", "webkitTransform", "MozTransform", "OTransform"];
            for (var a = 0, c = check.length; a < c; a++) {
                if (_style[check[a]] !== undefined) {
                    d.trstyle = check[a];
                    break
                }
            }
            d.hastransform = !!d.trstyle
        }();
        if (d.hastransform) {
            _style[d.trstyle] = "translate3d(1px,2px,3px)";
            d.hastranslate3d = /translate3d/.test(_style[d.trstyle])
        }
        d.transitionstyle = "transition";
        d.prefixstyle = "";
        d.transitionend = "transitionend";
        d.hastransition = "transition" in _style || function() {
            d.transitionend = false;
            var check = ["webkitTransition", "msTransition", "MozTransition", "OTransition", "OTransition", "KhtmlTransition"];
            var prefix = ["-webkit-", "-ms-", "-moz-", "-o-", "-o", "-khtml-"];
            var evs = ["webkitTransitionEnd", "msTransitionEnd", "transitionend", "otransitionend", "oTransitionEnd", "KhtmlTransitionEnd"];
            for (var a = 0, c = check.length; a < c; a++) {
                if (check[a] in _style) {
                    d.transitionstyle = check[a];
                    d.prefixstyle = prefix[a];
                    d.transitionend = evs[a];
                    break
                }
            }
            if (d.ischrome26) d.prefixstyle = prefix[1];
            d.hastransition = d.transitionstyle
        }();

        function detectCursorGrab() {
            var lst = ["grab", "-webkit-grab", "-moz-grab"];
            if (d.ischrome && !d.ischrome38 || d.isie) lst = [];
            for (var a = 0, l = lst.length; a < l; a++) {
                var p = lst[a];
                _style.cursor = p;
                if (_style.cursor == p) return p
            }
            return "url(https://cdnjs.cloudflare.com/ajax/libs/slider-pro/1.3.0/css/images/openhand.cur),n-resize"
        }
        d.cursorgrabvalue = detectCursorGrab();
        d.hasmousecapture = "setCapture" in _el;
        d.hasMutationObserver = ClsMutationObserver !== false;
        _el = null;
        browserdetected = d;
        return d
    };
    var NiceScrollClass = function(myopt, me) {
        var self = this;
        this.version = "3.7.6";
        this.name = "nicescroll";
        this.me = me;
        var $body = $("body");
        var opt = this.opt = {
            doc: $body,
            win: false
        };
        $.extend(opt, _globaloptions);
        opt.snapbackspeed = 80;
        if (myopt || false) {
            for (var a in opt) {
                if (myopt[a] !== undefined) opt[a] = myopt[a]
            }
        }
        if (opt.disablemutationobserver) ClsMutationObserver = false;
        this.doc = opt.doc;
        this.iddoc = this.doc && this.doc[0] ? this.doc[0].id || "" : "";
        this.ispage = /^BODY|HTML/.test(opt.win ? opt.win[0].nodeName : this.doc[0].nodeName);
        this.haswrapper = opt.win !== false;
        this.win = opt.win || (this.ispage ? $window : this.doc);
        this.docscroll = this.ispage && !this.haswrapper ? $window : this.win;
        this.body = $body;
        this.viewport = false;
        this.isfixed = false;
        this.iframe = false;
        this.isiframe = this.doc[0].nodeName == "IFRAME" && this.win[0].nodeName == "IFRAME";
        this.istextarea = this.win[0].nodeName == "TEXTAREA";
        this.forcescreen = false;
        this.canshowonmouseevent = opt.autohidemode != "scroll";
        this.onmousedown = false;
        this.onmouseup = false;
        this.onmousemove = false;
        this.onmousewheel = false;
        this.onkeypress = false;
        this.ongesturezoom = false;
        this.onclick = false;
        this.onscrollstart = false;
        this.onscrollend = false;
        this.onscrollcancel = false;
        this.onzoomin = false;
        this.onzoomout = false;
        this.view = false;
        this.page = false;
        this.scroll = {
            x: 0,
            y: 0
        };
        this.scrollratio = {
            x: 0,
            y: 0
        };
        this.cursorheight = 20;
        this.scrollvaluemax = 0;
        if (opt.rtlmode == "auto") {
            var target = this.win[0] == _win ? this.body : this.win;
            var writingMode = target.css("writing-mode") || target.css("-webkit-writing-mode") || target.css("-ms-writing-mode") || target.css("-moz-writing-mode");
            if (writingMode == "horizontal-tb" || writingMode == "lr-tb" || writingMode === "") {
                this.isrtlmode = target.css("direction") == "rtl";
                this.isvertical = false
            } else {
                this.isrtlmode = writingMode == "vertical-rl" || writingMode == "tb" || writingMode == "tb-rl" || writingMode == "rl-tb";
                this.isvertical = writingMode == "vertical-rl" || writingMode == "tb" || writingMode == "tb-rl"
            }
        } else {
            this.isrtlmode = opt.rtlmode === true;
            this.isvertical = false
        }
        this.scrollrunning = false;
        this.scrollmom = false;
        this.observer = false;
        this.observerremover = false;
        this.observerbody = false;
        if (opt.scrollbarid !== false) {
            this.id = opt.scrollbarid
        } else {
            do {
                this.id = "ascrail" + ascrailcounter++
            } while (_doc.getElementById(this.id))
        }
        this.rail = false;
        this.cursor = false;
        this.cursorfreezed = false;
        this.selectiondrag = false;
        this.zoom = false;
        this.zoomactive = false;
        this.hasfocus = false;
        this.hasmousefocus = false;
        this.railslocked = false;
        this.locked = false;
        this.hidden = false;
        this.cursoractive = true;
        this.wheelprevented = false;
        this.overflowx = opt.overflowx;
        this.overflowy = opt.overflowy;
        this.nativescrollingarea = false;
        this.checkarea = 0;
        this.events = [];
        this.saved = {};
        this.delaylist = {};
        this.synclist = {};
        this.lastdeltax = 0;
        this.lastdeltay = 0;
        this.detected = getBrowserDetection();
        var cap = $.extend({}, this.detected);
        this.canhwscroll = cap.hastransform && opt.hwacceleration;
        this.ishwscroll = this.canhwscroll && self.haswrapper;
        if (!this.isrtlmode) {
            this.hasreversehr = false
        } else if (this.isvertical) {
            this.hasreversehr = !(cap.iswebkit || cap.isie || cap.isie11)
        } else {
            this.hasreversehr = !(cap.iswebkit || cap.isie && !cap.isie10 && !cap.isie11)
        }
        this.istouchcapable = false;
        if (!cap.cantouch && (cap.hasw3ctouch || cap.hasmstouch)) {
            this.istouchcapable = true
        } else if (cap.cantouch && !cap.isios && !cap.isandroid && (cap.iswebkit || cap.ismozilla)) {
            this.istouchcapable = true
        }
        if (!opt.enablemouselockapi) {
            cap.hasmousecapture = false;
            cap.haspointerlock = false
        }
        this.debounced = function(name, fn, tm) {
            if (!self) return;
            var dd = self.delaylist[name] || false;
            if (!dd) {
                self.delaylist[name] = {
                    h: setAnimationFrame(function() {
                        self.delaylist[name].fn.call(self);
                        self.delaylist[name] = false
                    }, tm)
                };
                fn.call(self)
            }
            self.delaylist[name].fn = fn
        };
        this.synched = function(name, fn) {
            if (self.synclist[name]) self.synclist[name] = fn;
            else {
                self.synclist[name] = fn;
                setAnimationFrame(function() {
                    if (!self) return;
                    self.synclist[name] && self.synclist[name].call(self);
                    self.synclist[name] = null
                })
            }
        };
        this.unsynched = function(name) {
            if (self.synclist[name]) self.synclist[name] = false
        };
        this.css = function(el, pars) {
            for (var n in pars) {
                self.saved.css.push([el, n, el.css(n)]);
                el.css(n, pars[n])
            }
        };
        this.scrollTop = function(val) {
            return val === undefined ? self.getScrollTop() : self.setScrollTop(val)
        };
        this.scrollLeft = function(val) {
            return val === undefined ? self.getScrollLeft() : self.setScrollLeft(val)
        };
        var BezierClass = function(st, ed, spd, p1, p2, p3, p4) {
            this.st = st;
            this.ed = ed;
            this.spd = spd;
            this.p1 = p1 || 0;
            this.p2 = p2 || 1;
            this.p3 = p3 || 0;
            this.p4 = p4 || 1;
            this.ts = now();
            this.df = ed - st
        };
        BezierClass.prototype = {
            B2: function(t) {
                return 3 * (1 - t) * (1 - t) * t
            },
            B3: function(t) {
                return 3 * (1 - t) * t * t
            },
            B4: function(t) {
                return t * t * t
            },
            getPos: function() {
                return (now() - this.ts) / this.spd
            },
            getNow: function() {
                var pc = (now() - this.ts) / this.spd;
                var bz = this.B2(pc) + this.B3(pc) + this.B4(pc);
                return pc >= 1 ? this.ed : this.st + this.df * bz | 0
            },
            update: function(ed, spd) {
                this.st = this.getNow();
                this.ed = ed;
                this.spd = spd;
                this.ts = now();
                this.df = this.ed - this.st;
                return this
            }
        };

        function getMatrixValues() {
            var tr = self.doc.css(cap.trstyle);
            if (tr && tr.substr(0, 6) == "matrix") {
                return tr.replace(/^.*\((.*)\)$/g, "$1").replace(/px/g, "").split(/, +/)
            }
            return false
        }
        if (this.ishwscroll) {
            this.doc.translate = {
                x: 0,
                y: 0,
                tx: "0px",
                ty: "0px"
            };
            if (cap.hastranslate3d && cap.isios) this.doc.css("-webkit-backface-visibility", "hidden");
            this.getScrollTop = function(last) {
                if (!last) {
                    var mtx = getMatrixValues();
                    if (mtx) return mtx.length == 16 ? -mtx[13] : -mtx[5];
                    if (self.timerscroll && self.timerscroll.bz) return self.timerscroll.bz.getNow()
                }
                return self.doc.translate.y
            };
            this.getScrollLeft = function(last) {
                if (!last) {
                    var mtx = getMatrixValues();
                    if (mtx) return mtx.length == 16 ? -mtx[12] : -mtx[4];
                    if (self.timerscroll && self.timerscroll.bh) return self.timerscroll.bh.getNow()
                }
                return self.doc.translate.x
            };
            this.notifyScrollEvent = function(el) {
                var e = _doc.createEvent("UIEvents");
                e.initUIEvent("scroll", false, false, _win, 1);
                e.niceevent = true;
                el.dispatchEvent(e)
            };
            var cxscrollleft = this.isrtlmode ? 1 : -1;
            if (cap.hastranslate3d && opt.enabletranslate3d) {
                this.setScrollTop = function(val, silent) {
                    self.doc.translate.y = val;
                    self.doc.translate.ty = val * -1 + "px";
                    self.doc.css(cap.trstyle, "translate3d(" + self.doc.translate.tx + "," + self.doc.translate.ty + ",0)");
                    if (!silent) self.notifyScrollEvent(self.win[0])
                };
                this.setScrollLeft = function(val, silent) {
                    self.doc.translate.x = val;
                    self.doc.translate.tx = val * cxscrollleft + "px";
                    self.doc.css(cap.trstyle, "translate3d(" + self.doc.translate.tx + "," + self.doc.translate.ty + ",0)");
                    if (!silent) self.notifyScrollEvent(self.win[0])
                }
            } else {
                this.setScrollTop = function(val, silent) {
                    self.doc.translate.y = val;
                    self.doc.translate.ty = val * -1 + "px";
                    self.doc.css(cap.trstyle, "translate(" + self.doc.translate.tx + "," + self.doc.translate.ty + ")");
                    if (!silent) self.notifyScrollEvent(self.win[0])
                };
                this.setScrollLeft = function(val, silent) {
                    self.doc.translate.x = val;
                    self.doc.translate.tx = val * cxscrollleft + "px";
                    self.doc.css(cap.trstyle, "translate(" + self.doc.translate.tx + "," + self.doc.translate.ty + ")");
                    if (!silent) self.notifyScrollEvent(self.win[0])
                }
            }
        } else {
            this.getScrollTop = function() {
                return self.docscroll.scrollTop()
            };
            this.setScrollTop = function(val) {
                self.docscroll.scrollTop(val)
            };
            this.getScrollLeft = function() {
                var val;
                if (!self.hasreversehr) {
                    val = self.docscroll.scrollLeft()
                } else if (self.detected.ismozilla) {
                    val = self.page.maxw - Math.abs(self.docscroll.scrollLeft())
                } else {
                    val = self.page.maxw - self.docscroll.scrollLeft()
                }
                return val
            };
            this.setScrollLeft = function(val) {
                return setTimeout(function() {
                    if (!self) return;
                    if (self.hasreversehr) {
                        if (self.detected.ismozilla) {
                            val = -(self.page.maxw - val)
                        } else {
                            val = self.page.maxw - val
                        }
                    }
                    return self.docscroll.scrollLeft(val)
                }, 1)
            }
        }
        this.getTarget = function(e) {
            if (!e) return false;
            if (e.target) return e.target;
            if (e.srcElement) return e.srcElement;
            return false
        };
        this.hasParent = function(e, id) {
            if (!e) return false;
            var el = e.target || e.srcElement || e || false;
            while (el && el.id != id) {
                el = el.parentNode || false
            }
            return el !== false
        };

        function getZIndex() {
            var dom = self.win;
            if ("zIndex" in dom) return dom.zIndex();
            while (dom.length > 0) {
                if (dom[0].nodeType == 9) return false;
                var zi = dom.css("zIndex");
                if (!isNaN(zi) && zi !== 0) return parseInt(zi);
                dom = dom.parent()
            }
            return false
        }
        var _convertBorderWidth = {
            thin: 1,
            medium: 3,
            thick: 5
        };

        function getWidthToPixel(dom, prop, chkheight) {
            var wd = dom.css(prop);
            var px = parseFloat(wd);
            if (isNaN(px)) {
                px = _convertBorderWidth[wd] || 0;
                var brd = px == 3 ? chkheight ? self.win.outerHeight() - self.win.innerHeight() : self.win.outerWidth() - self.win.innerWidth() : 1;
                if (self.isie8 && px) px += 1;
                return brd ? px : 0
            }
            return px
        }
        this.getDocumentScrollOffset = function() {
            return {
                top: _win.pageYOffset || _doc.documentElement.scrollTop,
                left: _win.pageXOffset || _doc.documentElement.scrollLeft
            }
        };
        this.getOffset = function() {
            if (self.isfixed) {
                var ofs = self.win.offset();
                var scrl = self.getDocumentScrollOffset();
                ofs.top -= scrl.top;
                ofs.left -= scrl.left;
                return ofs
            }
            var ww = self.win.offset();
            if (!self.viewport) return ww;
            var vp = self.viewport.offset();
            return {
                top: ww.top - vp.top,
                left: ww.left - vp.left
            }
        };
        this.updateScrollBar = function(len) {
            var pos, off;
            if (self.ishwscroll) {
                self.rail.css({
                    height: self.win.innerHeight() - (opt.railpadding.top + opt.railpadding.bottom)
                });
                if (self.railh) self.railh.css({
                    width: self.win.innerWidth() - (opt.railpadding.left + opt.railpadding.right)
                })
            } else {
                var wpos = self.getOffset();
                pos = {
                    top: wpos.top,
                    left: wpos.left - (opt.railpadding.left + opt.railpadding.right)
                };
                pos.top += getWidthToPixel(self.win, "border-top-width", true);
                pos.left += self.rail.align ? self.win.outerWidth() - getWidthToPixel(self.win, "border-right-width") - self.rail.width : getWidthToPixel(self.win, "border-left-width");
                off = opt.railoffset;
                if (off) {
                    if (off.top) pos.top += off.top;
                    if (off.left) pos.left += off.left
                }
                if (!self.railslocked) self.rail.css({
                    top: pos.top,
                    left: pos.left,
                    height: (len ? len.h : self.win.innerHeight()) - (opt.railpadding.top + opt.railpadding.bottom)
                });
                if (self.zoom) {
                    self.zoom.css({
                        top: pos.top + 1,
                        left: self.rail.align == 1 ? pos.left - 20 : pos.left + self.rail.width + 4
                    })
                }
                if (self.railh && !self.railslocked) {
                    pos = {
                        top: wpos.top,
                        left: wpos.left
                    };
                    off = opt.railhoffset;
                    if (off) {
                        if (off.top) pos.top += off.top;
                        if (off.left) pos.left += off.left
                    }
                    var y = self.railh.align ? pos.top + getWidthToPixel(self.win, "border-top-width", true) + self.win.innerHeight() - self.railh.height : pos.top + getWidthToPixel(self.win, "border-top-width", true);
                    var x = pos.left + getWidthToPixel(self.win, "border-left-width");
                    self.railh.css({
                        top: y - (opt.railpadding.top + opt.railpadding.bottom),
                        left: x,
                        width: self.railh.width
                    })
                }
            }
        };
        this.doRailClick = function(e, dbl, hr) {
            var fn, pg, cur, pos;
            if (self.railslocked) return;
            self.cancelEvent(e);
            if (!("pageY" in e)) {
                e.pageX = e.clientX + _doc.documentElement.scrollLeft;
                e.pageY = e.clientY + _doc.documentElement.scrollTop
            }
            if (dbl) {
                fn = hr ? self.doScrollLeft : self.doScrollTop;
                cur = hr ? (e.pageX - self.railh.offset().left - self.cursorwidth / 2) * self.scrollratio.x : (e.pageY - self.rail.offset().top - self.cursorheight / 2) * self.scrollratio.y;
                self.unsynched("relativexy");
                fn(cur | 0)
            } else {
                fn = hr ? self.doScrollLeftBy : self.doScrollBy;
                cur = hr ? self.scroll.x : self.scroll.y;
                pos = hr ? e.pageX - self.railh.offset().left : e.pageY - self.rail.offset().top;
                pg = hr ? self.view.w : self.view.h;
                fn(cur >= pos ? pg : -pg)
            }
        };
        self.newscrolly = self.newscrollx = 0;
        self.hasanimationframe = "requestAnimationFrame" in _win;
        self.hascancelanimationframe = "cancelAnimationFrame" in _win;
        self.hasborderbox = false;
        this.init = function() {
            self.saved.css = [];
            if (cap.isoperamini) return true;
            if (cap.isandroid && !("hidden" in _doc)) return true;
            opt.emulatetouch = opt.emulatetouch || opt.touchbehavior;
            self.hasborderbox = _win.getComputedStyle && _win.getComputedStyle(_doc.body)["box-sizing"] === "border-box";
            var _scrollyhidden = {
                "overflow-y": "hidden"
            };
            if (cap.isie11 || cap.isie10) _scrollyhidden["-ms-overflow-style"] = "none";
            if (self.ishwscroll) {
                this.doc.css(cap.transitionstyle, cap.prefixstyle + "transform 0ms ease-out");
                if (cap.transitionend) self.bind(self.doc, cap.transitionend, self.onScrollTransitionEnd, false)
            }
            self.zindex = "auto";
            if (!self.ispage && opt.zindex == "auto") {
                self.zindex = getZIndex() || "auto"
            } else {
                self.zindex = opt.zindex
            }
            if (!self.ispage && self.zindex != "auto" && self.zindex > globalmaxzindex) {
                globalmaxzindex = self.zindex
            }
            if (self.isie && self.zindex === 0 && opt.zindex == "auto") {
                self.zindex = "auto"
            }
            if (!self.ispage || !cap.isieold) {
                var cont = self.docscroll;
                if (self.ispage) cont = self.haswrapper ? self.win : self.doc;
                self.css(cont, _scrollyhidden);
                if (self.ispage && (cap.isie11 || cap.isie)) {
                    self.css($("html"), _scrollyhidden)
                }
                if (cap.isios && !self.ispage && !self.haswrapper) self.css($body, {
                    "-webkit-overflow-scrolling": "touch"
                });
                var cursor = $(_doc.createElement("div"));
                cursor.css({
                    position: "relative",
                    top: 0,
                    float: "right",
                    width: opt.cursorwidth,
                    height: 0,
                    "background-color": opt.cursorcolor,
                    border: opt.cursorborder,
                    "background-clip": "padding-box",
                    "-webkit-border-radius": opt.cursorborderradius,
                    "-moz-border-radius": opt.cursorborderradius,
                    "border-radius": opt.cursorborderradius
                });
                cursor.addClass("nicescroll-cursors");
                self.cursor = cursor;
                var rail = $(_doc.createElement("div"));
                rail.attr("id", self.id);
                rail.addClass("nicescroll-rails nicescroll-rails-vr");
                var v, a, kp = ["left", "right", "top", "bottom"];
                for (var n in kp) {
                    a = kp[n];
                    v = opt.railpadding[a] || 0;
                    v && rail.css("padding-" + a, v + "px")
                }
                rail.append(cursor);
                rail.width = Math.max(parseFloat(opt.cursorwidth), cursor.outerWidth());
                rail.css({
                    width: rail.width + "px",
                    zIndex: self.zindex,
                    background: opt.background,
                    cursor: "default"
                });
                rail.visibility = true;
                rail.scrollable = true;
                rail.align = opt.railalign == "left" ? 0 : 1;
                self.rail = rail;
                self.rail.drag = false;
                var zoom = false;
                if (opt.boxzoom && !self.ispage && !cap.isieold) {
                    zoom = _doc.createElement("div");
                    self.bind(zoom, "click", self.doZoom);
                    self.bind(zoom, "mouseenter", function() {
                        self.zoom.css("opacity", opt.cursoropacitymax)
                    });
                    self.bind(zoom, "mouseleave", function() {
                        self.zoom.css("opacity", opt.cursoropacitymin)
                    });
                    self.zoom = $(zoom);
                    self.zoom.css({
                        cursor: "pointer",
                        zIndex: self.zindex,
                        backgroundImage: "url(" + opt.scriptpath + "zoomico.png)",
                        height: 18,
                        width: 18,
                        backgroundPosition: "0 0"
                    });
                    if (opt.dblclickzoom) self.bind(self.win, "dblclick", self.doZoom);
                    if (cap.cantouch && opt.gesturezoom) {
                        self.ongesturezoom = function(e) {
                            if (e.scale > 1.5) self.doZoomIn(e);
                            if (e.scale < .8) self.doZoomOut(e);
                            return self.cancelEvent(e)
                        };
                        self.bind(self.win, "gestureend", self.ongesturezoom)
                    }
                }
                self.railh = false;
                var railh;
                if (opt.horizrailenabled) {
                    self.css(cont, {
                        overflowX: "hidden"
                    });
                    cursor = $(_doc.createElement("div"));
                    cursor.css({
                        position: "absolute",
                        top: 0,
                        height: opt.cursorwidth,
                        width: 0,
                        backgroundColor: opt.cursorcolor,
                        border: opt.cursorborder,
                        backgroundClip: "padding-box",
                        "-webkit-border-radius": opt.cursorborderradius,
                        "-moz-border-radius": opt.cursorborderradius,
                        "border-radius": opt.cursorborderradius
                    });
                    if (cap.isieold) cursor.css("overflow", "hidden");
                    cursor.addClass("nicescroll-cursors");
                    self.cursorh = cursor;
                    railh = $(_doc.createElement("div"));
                    railh.attr("id", self.id + "-hr");
                    railh.addClass("nicescroll-rails nicescroll-rails-hr");
                    railh.height = Math.max(parseFloat(opt.cursorwidth), cursor.outerHeight());
                    railh.css({
                        height: railh.height + "px",
                        zIndex: self.zindex,
                        background: opt.background
                    });
                    railh.append(cursor);
                    railh.visibility = true;
                    railh.scrollable = true;
                    railh.align = opt.railvalign == "top" ? 0 : 1;
                    self.railh = railh;
                    self.railh.drag = false
                }
                if (self.ispage) {
                    rail.css({
                        position: "fixed",
                        top: 0,
                        height: "100%"
                    });
                    rail.css(rail.align ? {
                        right: 0
                    } : {
                        left: 0
                    });
                    self.doc.append(rail);
                    if (self.railh) {
                        railh.css({
                            position: "fixed",
                            left: 0,
                            width: "100%"
                        });
                        railh.css(railh.align ? {
                            bottom: 0
                        } : {
                            top: 0
                        });
                        self.doc.append(railh)
                    }
                } else {
                    if (self.ishwscroll) {
                        if (self.win.css("position") == "static") self.css(self.win, {
                            position: "relative"
                        });
                        var bd = self.win[0].nodeName == "HTML" ? self.body : self.win;
                        $(bd).scrollTop(0).scrollLeft(0);
                        if (self.zoom) {
                            self.zoom.css({
                                position: "absolute",
                                top: 1,
                                right: 0,
                                "margin-right": rail.width + 4
                            });
                            bd.append(self.zoom)
                        }
                        rail.css({
                            position: "absolute",
                            top: 0
                        });
                        rail.css(rail.align ? {
                            right: 0
                        } : {
                            left: 0
                        });
                        bd.append(rail);
                        if (railh) {
                            railh.css({
                                position: "absolute",
                                left: 0,
                                bottom: 0
                            });
                            railh.css(railh.align ? {
                                bottom: 0
                            } : {
                                top: 0
                            });
                            bd.append(railh)
                        }
                    } else {
                        self.isfixed = self.win.css("position") == "fixed";
                        var rlpos = self.isfixed ? "fixed" : "absolute";
                        if (!self.isfixed) self.viewport = self.getViewport(self.win[0]);
                        if (self.viewport) {
                            self.body = self.viewport;
                            if (!/fixed|absolute/.test(self.viewport.css("position"))) self.css(self.viewport, {
                                position: "relative"
                            })
                        }
                        rail.css({
                            position: rlpos
                        });
                        if (self.zoom) self.zoom.css({
                            position: rlpos
                        });
                        self.updateScrollBar();
                        self.doc.append(rail);
                        if (self.zoom) self.doc.append(self.zoom);
                        if (self.railh) {
                            railh.css({
                                position: rlpos
                            });
                            self.doc.append(railh)
                        }
                    }
                    if (cap.isios) self.css(self.win, {
                        "-webkit-tap-highlight-color": "rgba(0,0,0,0)",
                        "-webkit-touch-callout": "none"
                    });
                    if (opt.disableoutline) {
                        if (cap.isie) self.win.attr("hideFocus", "true");
                        if (cap.iswebkit) self.win.css("outline", "none")
                    }
                }
                if (opt.autohidemode === false) {
                    self.autohidedom = false;
                    self.rail.css({
                        opacity: opt.cursoropacitymax
                    });
                    if (self.railh) self.railh.css({
                        opacity: opt.cursoropacitymax
                    })
                } else if (opt.autohidemode === true || opt.autohidemode === "leave") {
                    self.autohidedom = $().add(self.rail);
                    if (cap.isie8) self.autohidedom = self.autohidedom.add(self.cursor);
                    if (self.railh) self.autohidedom = self.autohidedom.add(self.railh);
                    if (self.railh && cap.isie8) self.autohidedom = self.autohidedom.add(self.cursorh)
                } else if (opt.autohidemode == "scroll") {
                    self.autohidedom = $().add(self.rail);
                    if (self.railh) self.autohidedom = self.autohidedom.add(self.railh)
                } else if (opt.autohidemode == "cursor") {
                    self.autohidedom = $().add(self.cursor);
                    if (self.railh) self.autohidedom = self.autohidedom.add(self.cursorh)
                } else if (opt.autohidemode == "hidden") {
                    self.autohidedom = false;
                    self.hide();
                    self.railslocked = false
                }
                if (cap.cantouch || self.istouchcapable || opt.emulatetouch || cap.hasmstouch) {
                    self.scrollmom = new ScrollMomentumClass2D(self);
                    var delayedclick = null;
                    self.ontouchstart = function(e) {
                        if (self.locked) return false;
                        if (e.pointerType && (e.pointerType === "mouse" || e.pointerType === e.MSPOINTER_TYPE_MOUSE)) return false;
                        self.hasmoving = false;
                        if (self.scrollmom.timer) {
                            self.triggerScrollEnd();
                            self.scrollmom.stop()
                        }
                        if (!self.railslocked) {
                            var tg = self.getTarget(e);
                            if (tg) {
                                var skp = /INPUT/i.test(tg.nodeName) && /range/i.test(tg.type);
                                if (skp) return self.stopPropagation(e)
                            }
                            var ismouse = e.type === "mousedown";
                            if (!("clientX" in e) && "changedTouches" in e) {
                                e.clientX = e.changedTouches[0].clientX;
                                e.clientY = e.changedTouches[0].clientY
                            }
                            if (self.forcescreen) {
                                var le = e;
                                e = {
                                    original: e.original ? e.original : e
                                };
                                e.clientX = le.screenX;
                                e.clientY = le.screenY
                            }
                            self.rail.drag = {
                                x: e.clientX,
                                y: e.clientY,
                                sx: self.scroll.x,
                                sy: self.scroll.y,
                                st: self.getScrollTop(),
                                sl: self.getScrollLeft(),
                                pt: 2,
                                dl: false,
                                tg: tg
                            };
                            if (self.ispage || !opt.directionlockdeadzone) {
                                self.rail.drag.dl = "f"
                            } else {
                                var view = {
                                    w: $window.width(),
                                    h: $window.height()
                                };
                                var page = self.getContentSize();
                                var maxh = page.h - view.h;
                                var maxw = page.w - view.w;
                                if (self.rail.scrollable && !self.railh.scrollable) self.rail.drag.ck = maxh > 0 ? "v" : false;
                                else if (!self.rail.scrollable && self.railh.scrollable) self.rail.drag.ck = maxw > 0 ? "h" : false;
                                else self.rail.drag.ck = false
                            }
                            if (opt.emulatetouch && self.isiframe && cap.isie) {
                                var wp = self.win.position();
                                self.rail.drag.x += wp.left;
                                self.rail.drag.y += wp.top
                            }
                            self.hasmoving = false;
                            self.lastmouseup = false;
                            self.scrollmom.reset(e.clientX, e.clientY);
                            if (tg && ismouse) {
                                var ip = /INPUT|SELECT|BUTTON|TEXTAREA/i.test(tg.nodeName);
                                if (!ip) {
                                    if (cap.hasmousecapture) tg.setCapture();
                                    if (opt.emulatetouch) {
                                        if (tg.onclick && !(tg._onclick || false)) {
                                            tg._onclick = tg.onclick;
                                            tg.onclick = function(e) {
                                                if (self.hasmoving) return false;
                                                tg._onclick.call(this, e)
                                            }
                                        }
                                        return self.cancelEvent(e)
                                    }
                                    return self.stopPropagation(e)
                                }
                                if (/SUBMIT|CANCEL|BUTTON/i.test($(tg).attr("type"))) {
                                    self.preventclick = {
                                        tg: tg,
                                        click: false
                                    }
                                }
                            }
                        }
                    };
                    self.ontouchend = function(e) {
                        if (!self.rail.drag) return true;
                        if (self.rail.drag.pt == 2) {
                            if (e.pointerType && (e.pointerType === "mouse" || e.pointerType === e.MSPOINTER_TYPE_MOUSE)) return false;
                            self.rail.drag = false;
                            var ismouse = e.type === "mouseup";
                            if (self.hasmoving) {
                                self.scrollmom.doMomentum();
                                self.lastmouseup = true;
                                self.hideCursor();
                                if (cap.hasmousecapture) _doc.releaseCapture();
                                if (ismouse) return self.cancelEvent(e)
                            }
                        } else if (self.rail.drag.pt == 1) {
                            return self.onmouseup(e)
                        }
                    };
                    var moveneedoffset = opt.emulatetouch && self.isiframe && !cap.hasmousecapture;
                    var locktollerance = opt.directionlockdeadzone * .3 | 0;
                    self.ontouchmove = function(e, byiframe) {
                        if (!self.rail.drag) return true;
                        if (e.targetTouches && opt.preventmultitouchscrolling) {
                            if (e.targetTouches.length > 1) return true
                        }
                        if (e.pointerType && (e.pointerType === "mouse" || e.pointerType === e.MSPOINTER_TYPE_MOUSE)) return true;
                        if (self.rail.drag.pt == 2) {
                            if ("changedTouches" in e) {
                                e.clientX = e.changedTouches[0].clientX;
                                e.clientY = e.changedTouches[0].clientY
                            }
                            var ofy, ofx;
                            ofx = ofy = 0;
                            if (moveneedoffset && !byiframe) {
                                var wp = self.win.position();
                                ofx = -wp.left;
                                ofy = -wp.top
                            }
                            var fy = e.clientY + ofy;
                            var my = fy - self.rail.drag.y;
                            var fx = e.clientX + ofx;
                            var mx = fx - self.rail.drag.x;
                            var ny = self.rail.drag.st - my;
                            if (self.ishwscroll && opt.bouncescroll) {
                                if (ny < 0) {
                                    ny = Math.round(ny / 2)
                                } else if (ny > self.page.maxh) {
                                    ny = self.page.maxh + Math.round((ny - self.page.maxh) / 2)
                                }
                            } else {
                                if (ny < 0) {
                                    ny = 0;
                                    fy = 0
                                } else if (ny > self.page.maxh) {
                                    ny = self.page.maxh;
                                    fy = 0
                                }
                                if (fy === 0 && !self.hasmoving) {
                                    if (!self.ispage) self.rail.drag = false;
                                    return true
                                }
                            }
                            var nx = self.getScrollLeft();
                            if (self.railh && self.railh.scrollable) {
                                nx = self.isrtlmode ? mx - self.rail.drag.sl : self.rail.drag.sl - mx;
                                if (self.ishwscroll && opt.bouncescroll) {
                                    if (nx < 0) {
                                        nx = Math.round(nx / 2)
                                    } else if (nx > self.page.maxw) {
                                        nx = self.page.maxw + Math.round((nx - self.page.maxw) / 2)
                                    }
                                } else {
                                    if (nx < 0) {
                                        nx = 0;
                                        fx = 0
                                    }
                                    if (nx > self.page.maxw) {
                                        nx = self.page.maxw;
                                        fx = 0
                                    }
                                }
                            }
                            if (!self.hasmoving) {
                                if (self.rail.drag.y === e.clientY && self.rail.drag.x === e.clientX) return self.cancelEvent(e);
                                var ay = Math.abs(my);
                                var ax = Math.abs(mx);
                                var dz = opt.directionlockdeadzone;
                                if (!self.rail.drag.ck) {
                                    if (ay > dz && ax > dz) self.rail.drag.dl = "f";
                                    else if (ay > dz) self.rail.drag.dl = ax > locktollerance ? "f" : "v";
                                    else if (ax > dz) self.rail.drag.dl = ay > locktollerance ? "f" : "h"
                                } else if (self.rail.drag.ck == "v") {
                                    if (ax > dz && ay <= locktollerance) {
                                        self.rail.drag = false
                                    } else if (ay > dz) self.rail.drag.dl = "v"
                                } else if (self.rail.drag.ck == "h") {
                                    if (ay > dz && ax <= locktollerance) {
                                        self.rail.drag = false
                                    } else if (ax > dz) self.rail.drag.dl = "h"
                                }
                                if (!self.rail.drag.dl) return self.cancelEvent(e);
                                self.triggerScrollStart(e.clientX, e.clientY, 0, 0, 0);
                                self.hasmoving = true
                            }
                            if (self.preventclick && !self.preventclick.click) {
                                self.preventclick.click = self.preventclick.tg.onclick || false;
                                self.preventclick.tg.onclick = self.onpreventclick
                            }
                            if (self.rail.drag.dl) {
                                if (self.rail.drag.dl == "v") nx = self.rail.drag.sl;
                                else if (self.rail.drag.dl == "h") ny = self.rail.drag.st
                            }
                            self.synched("touchmove", function() {
                                if (self.rail.drag && self.rail.drag.pt == 2) {
                                    if (self.prepareTransition) self.resetTransition();
                                    if (self.rail.scrollable) self.setScrollTop(ny);
                                    self.scrollmom.update(fx, fy);
                                    if (self.railh && self.railh.scrollable) {
                                        self.setScrollLeft(nx);
                                        self.showCursor(ny, nx)
                                    } else {
                                        self.showCursor(ny)
                                    }
                                    if (cap.isie10) _doc.selection.clear()
                                }
                            });
                            return self.cancelEvent(e)
                        } else if (self.rail.drag.pt == 1) {
                            return self.onmousemove(e)
                        }
                    };
                    self.ontouchstartCursor = function(e, hronly) {
                        if (self.rail.drag && self.rail.drag.pt != 3) return;
                        if (self.locked) return self.cancelEvent(e);
                        self.cancelScroll();
                        self.rail.drag = {
                            x: e.touches[0].clientX,
                            y: e.touches[0].clientY,
                            sx: self.scroll.x,
                            sy: self.scroll.y,
                            pt: 3,
                            hr: !!hronly
                        };
                        var tg = self.getTarget(e);
                        if (!self.ispage && cap.hasmousecapture) tg.setCapture();
                        if (self.isiframe && !cap.hasmousecapture) {
                            self.saved.csspointerevents = self.doc.css("pointer-events");
                            self.css(self.doc, {
                                "pointer-events": "none"
                            })
                        }
                        return self.cancelEvent(e)
                    };
                    self.ontouchendCursor = function(e) {
                        if (self.rail.drag) {
                            if (cap.hasmousecapture) _doc.releaseCapture();
                            if (self.isiframe && !cap.hasmousecapture) self.doc.css("pointer-events", self.saved.csspointerevents);
                            if (self.rail.drag.pt != 3) return;
                            self.rail.drag = false;
                            return self.cancelEvent(e)
                        }
                    };
                    self.ontouchmoveCursor = function(e) {
                        if (self.rail.drag) {
                            if (self.rail.drag.pt != 3) return;
                            self.cursorfreezed = true;
                            if (self.rail.drag.hr) {
                                self.scroll.x = self.rail.drag.sx + (e.touches[0].clientX - self.rail.drag.x);
                                if (self.scroll.x < 0) self.scroll.x = 0;
                                var mw = self.scrollvaluemaxw;
                                if (self.scroll.x > mw) self.scroll.x = mw
                            } else {
                                self.scroll.y = self.rail.drag.sy + (e.touches[0].clientY - self.rail.drag.y) / FullSize.scale;
                                if (self.scroll.y < 0) self.scroll.y = 0;
                                var my = self.scrollvaluemax;
                                if (self.scroll.y > my) self.scroll.y = my
                            }
                            self.synched("touchmove", function() {
                                if (self.rail.drag && self.rail.drag.pt == 3) {
                                    self.showCursor();
                                    if (self.rail.drag.hr) self.doScrollLeft(Math.round(self.scroll.x * self.scrollratio.x), opt.cursordragspeed);
                                    else self.doScrollTop(Math.round(self.scroll.y * self.scrollratio.y), opt.cursordragspeed)
                                }
                            });
                            return self.cancelEvent(e)
                        }
                    }
                }
                self.onmousedown = function(e, hronly) {
                    if (self.rail.drag && self.rail.drag.pt != 1) return;
                    if (self.railslocked) return self.cancelEvent(e);
                    self.cancelScroll();
                    self.rail.drag = {
                        x: e.clientX,
                        y: e.clientY,
                        sx: self.scroll.x,
                        sy: self.scroll.y,
                        pt: 1,
                        hr: hronly || false
                    };
                    var tg = self.getTarget(e);
                    if (cap.hasmousecapture) tg.setCapture();
                    if (self.isiframe && !cap.hasmousecapture) {
                        self.saved.csspointerevents = self.doc.css("pointer-events");
                        self.css(self.doc, {
                            "pointer-events": "none"
                        })
                    }
                    self.hasmoving = false;
                    return self.cancelEvent(e)
                };
                self.onmouseup = function(e) {
                    if (self.rail.drag) {
                        if (self.rail.drag.pt != 1) return true;
                        if (cap.hasmousecapture) _doc.releaseCapture();
                        if (self.isiframe && !cap.hasmousecapture) self.doc.css("pointer-events", self.saved.csspointerevents);
                        self.rail.drag = false;
                        self.cursorfreezed = false;
                        if (self.hasmoving) self.triggerScrollEnd();
                        return self.cancelEvent(e)
                    }
                };
                self.onmousemove = function(e) {
                    if (self.rail.drag) {
                        if (self.rail.drag.pt !== 1) return;
                        if (cap.ischrome && e.which === 0) return self.onmouseup(e);
                        self.cursorfreezed = true;
                        if (!self.hasmoving) self.triggerScrollStart(e.clientX, e.clientY, 0, 0, 0);
                        self.hasmoving = true;
                        if (self.rail.drag.hr) {
                            self.scroll.x = self.rail.drag.sx + (e.clientX - self.rail.drag.x);
                            if (self.scroll.x < 0) self.scroll.x = 0;
                            var mw = self.scrollvaluemaxw;
                            if (self.scroll.x > mw) self.scroll.x = mw
                        } else {
                            self.scroll.y = self.rail.drag.sy + (e.clientY - self.rail.drag.y) / FullSize.scale;
                            if (self.scroll.y < 0) self.scroll.y = 0;
                            var my = self.scrollvaluemax;
                            if (self.scroll.y > my) self.scroll.y = my
                        }
                        self.synched("mousemove", function() {
                            if (self.cursorfreezed) {
                                self.showCursor();
                                if (self.rail.drag.hr) {
                                    self.scrollLeft(Math.round(self.scroll.x * self.scrollratio.x))
                                } else {
                                    self.scrollTop(Math.round(self.scroll.y * self.scrollratio.y))
                                }
                            }
                        });
                        return self.cancelEvent(e)
                    } else {
                        self.checkarea = 0
                    }
                };
                if (cap.cantouch || opt.emulatetouch) {
                    self.onpreventclick = function(e) {
                        if (self.preventclick) {
                            self.preventclick.tg.onclick = self.preventclick.click;
                            self.preventclick = false;
                            return self.cancelEvent(e)
                        }
                    };
                    self.onclick = cap.isios ? false : function(e) {
                        if (self.lastmouseup) {
                            self.lastmouseup = false;
                            return self.cancelEvent(e)
                        } else {
                            return true
                        }
                    };
                    if (opt.grabcursorenabled && cap.cursorgrabvalue) {
                        self.css(self.ispage ? self.doc : self.win, {
                            cursor: cap.cursorgrabvalue
                        });
                        self.css(self.rail, {
                            cursor: cap.cursorgrabvalue
                        })
                    }
                } else {
                    var checkSelectionScroll = function(e) {
                        if (!self.selectiondrag) return;
                        if (e) {
                            var ww = self.win.outerHeight();
                            var df = e.pageY - self.selectiondrag.top;
                            if (df > 0 && df < ww) df = 0;
                            if (df >= ww) df -= ww;
                            self.selectiondrag.df = df
                        }
                        if (self.selectiondrag.df === 0) return;
                        var rt = -(self.selectiondrag.df * 2 / 6) | 0;
                        self.doScrollBy(rt);
                        self.debounced("doselectionscroll", function() {
                            checkSelectionScroll()
                        }, 50)
                    };
                    if ("getSelection" in _doc) {
                        self.hasTextSelected = function() {
                            return _doc.getSelection().rangeCount > 0
                        }
                    } else if ("selection" in _doc) {
                        self.hasTextSelected = function() {
                            return _doc.selection.type != "None"
                        }
                    } else {
                        self.hasTextSelected = function() {
                            return false
                        }
                    }
                    self.onselectionstart = function(e) {
                        if (self.ispage) return;
                        self.selectiondrag = self.win.offset()
                    };
                    self.onselectionend = function(e) {
                        self.selectiondrag = false
                    };
                    self.onselectiondrag = function(e) {
                        if (!self.selectiondrag) return;
                        if (self.hasTextSelected()) self.debounced("selectionscroll", function() {
                            checkSelectionScroll(e)
                        }, 250)
                    }
                }
                if (cap.hasw3ctouch) {
                    self.css(self.ispage ? $("html") : self.win, {
                        "touch-action": "none"
                    });
                    self.css(self.rail, {
                        "touch-action": "none"
                    });
                    self.css(self.cursor, {
                        "touch-action": "none"
                    });
                    self.bind(self.win, "pointerdown", self.ontouchstart);
                    self.bind(_doc, "pointerup", self.ontouchend);
                    self.delegate(_doc, "pointermove", self.ontouchmove)
                } else if (cap.hasmstouch) {
                    self.css(self.ispage ? $("html") : self.win, {
                        "-ms-touch-action": "none"
                    });
                    self.css(self.rail, {
                        "-ms-touch-action": "none"
                    });
                    self.css(self.cursor, {
                        "-ms-touch-action": "none"
                    });
                    self.bind(self.win, "MSPointerDown", self.ontouchstart);
                    self.bind(_doc, "MSPointerUp", self.ontouchend);
                    self.delegate(_doc, "MSPointerMove", self.ontouchmove);
                    self.bind(self.cursor, "MSGestureHold", function(e) {
                        e.preventDefault()
                    });
                    self.bind(self.cursor, "contextmenu", function(e) {
                        e.preventDefault()
                    })
                } else if (cap.cantouch) {
                    self.bind(self.win, "touchstart", self.ontouchstart, false, true);
                    self.bind(_doc, "touchend", self.ontouchend, false, true);
                    self.bind(_doc, "touchcancel", self.ontouchend, false, true);
                    self.delegate(_doc, "touchmove", self.ontouchmove, false, true)
                }
                if (opt.emulatetouch) {
                    self.bind(self.win, "mousedown", self.ontouchstart, false, true);
                    self.bind(_doc, "mouseup", self.ontouchend, false, true);
                    self.bind(_doc, "mousemove", self.ontouchmove, false, true)
                }
                if (opt.cursordragontouch || !cap.cantouch && !opt.emulatetouch) {
                    self.rail.css({
                        cursor: "default"
                    });
                    self.railh && self.railh.css({
                        cursor: "default"
                    });
                    self.jqbind(self.rail, "mouseenter", function() {
                        if (!self.ispage && !self.win.is(":visible")) return false;
                        if (self.canshowonmouseevent) self.showCursor();
                        self.rail.active = true
                    });
                    self.jqbind(self.rail, "mouseleave", function() {
                        self.rail.active = false;
                        if (!self.rail.drag) self.hideCursor()
                    });
                    if (opt.sensitiverail) {
                        self.bind(self.rail, "click", function(e) {
                            self.doRailClick(e, false, false)
                        });
                        self.bind(self.rail, "dblclick", function(e) {
                            self.doRailClick(e, true, false)
                        });
                        self.bind(self.cursor, "click", function(e) {
                            self.cancelEvent(e)
                        });
                        self.bind(self.cursor, "dblclick", function(e) {
                            self.cancelEvent(e)
                        })
                    }
                    if (self.railh) {
                        self.jqbind(self.railh, "mouseenter", function() {
                            if (!self.ispage && !self.win.is(":visible")) return false;
                            if (self.canshowonmouseevent) self.showCursor();
                            self.rail.active = true
                        });
                        self.jqbind(self.railh, "mouseleave", function() {
                            self.rail.active = false;
                            if (!self.rail.drag) self.hideCursor()
                        });
                        if (opt.sensitiverail) {
                            self.bind(self.railh, "click", function(e) {
                                self.doRailClick(e, false, true)
                            });
                            self.bind(self.railh, "dblclick", function(e) {
                                self.doRailClick(e, true, true)
                            });
                            self.bind(self.cursorh, "click", function(e) {
                                self.cancelEvent(e)
                            });
                            self.bind(self.cursorh, "dblclick", function(e) {
                                self.cancelEvent(e)
                            })
                        }
                    }
                }
                if (opt.cursordragontouch && (this.istouchcapable || cap.cantouch)) {
                    self.bind(self.cursor, "touchstart", self.ontouchstartCursor);
                    self.bind(self.cursor, "touchmove", self.ontouchmoveCursor);
                    self.bind(self.cursor, "touchend", self.ontouchendCursor);
                    self.cursorh && self.bind(self.cursorh, "touchstart", function(e) {
                        self.ontouchstartCursor(e, true)
                    });
                    self.cursorh && self.bind(self.cursorh, "touchmove", self.ontouchmoveCursor);
                    self.cursorh && self.bind(self.cursorh, "touchend", self.ontouchendCursor)
                }
                if (!opt.emulatetouch && !cap.isandroid && !cap.isios) {
                    self.bind(cap.hasmousecapture ? self.win : _doc, "mouseup", self.onmouseup);
                    self.bind(_doc, "mousemove", self.onmousemove);
                    if (self.onclick) self.bind(_doc, "click", self.onclick);
                    self.bind(self.cursor, "mousedown", self.onmousedown);
                    self.bind(self.cursor, "mouseup", self.onmouseup);
                    if (self.railh) {
                        self.bind(self.cursorh, "mousedown", function(e) {
                            self.onmousedown(e, true)
                        });
                        self.bind(self.cursorh, "mouseup", self.onmouseup)
                    }
                    if (!self.ispage && opt.enablescrollonselection) {
                        self.bind(self.win[0], "mousedown", self.onselectionstart);
                        self.bind(_doc, "mouseup", self.onselectionend);
                        self.bind(self.cursor, "mouseup", self.onselectionend);
                        if (self.cursorh) self.bind(self.cursorh, "mouseup", self.onselectionend);
                        self.bind(_doc, "mousemove", self.onselectiondrag)
                    }
                    if (self.zoom) {
                        self.jqbind(self.zoom, "mouseenter", function() {
                            if (self.canshowonmouseevent) self.showCursor();
                            self.rail.active = true
                        });
                        self.jqbind(self.zoom, "mouseleave", function() {
                            self.rail.active = false;
                            if (!self.rail.drag) self.hideCursor()
                        })
                    }
                } else {
                    self.bind(cap.hasmousecapture ? self.win : _doc, "mouseup", self.ontouchend);
                    if (self.onclick) self.bind(_doc, "click", self.onclick);
                    if (opt.cursordragontouch) {
                        self.bind(self.cursor, "mousedown", self.onmousedown);
                        self.bind(self.cursor, "mouseup", self.onmouseup);
                        self.cursorh && self.bind(self.cursorh, "mousedown", function(e) {
                            self.onmousedown(e, true)
                        });
                        self.cursorh && self.bind(self.cursorh, "mouseup", self.onmouseup)
                    } else {
                        self.bind(self.rail, "mousedown", function(e) {
                            e.preventDefault()
                        });
                        self.railh && self.bind(self.railh, "mousedown", function(e) {
                            e.preventDefault()
                        })
                    }
                }
                if (opt.enablemousewheel) {
                    if (!self.isiframe) self.mousewheel(cap.isie && self.ispage ? _doc : self.win, self.onmousewheel);
                    self.mousewheel(self.rail, self.onmousewheel);
                    if (self.railh) self.mousewheel(self.railh, self.onmousewheelhr)
                }
                if (!self.ispage && !cap.cantouch && !/HTML|^BODY/.test(self.win[0].nodeName)) {
                    if (!self.win.attr("tabindex")) self.win.attr({
                        tabindex: ++tabindexcounter
                    });
                    self.bind(self.win, "focus", function(e) {
                        domfocus = self.getTarget(e).id || self.getTarget(e) || false;
                        self.hasfocus = true;
                        if (self.canshowonmouseevent) self.noticeCursor()
                    });
                    self.bind(self.win, "blur", function(e) {
                        domfocus = false;
                        self.hasfocus = false
                    });
                    self.bind(self.win, "mouseenter", function(e) {
                        mousefocus = self.getTarget(e).id || self.getTarget(e) || false;
                        self.hasmousefocus = true;
                        if (self.canshowonmouseevent) self.noticeCursor()
                    });
                    self.bind(self.win, "mouseleave", function(e) {
                        mousefocus = false;
                        self.hasmousefocus = false;
                        if (!self.rail.drag) self.hideCursor()
                    })
                }
                self.onkeypress = function(e) {
                    if (self.railslocked && self.page.maxh === 0) return true;
                    e = e || _win.event;
                    var tg = self.getTarget(e);
                    if (tg && /INPUT|TEXTAREA|SELECT|OPTION/.test(tg.nodeName)) {
                        var tp = tg.getAttribute("type") || tg.type || false;
                        if (!tp || !/submit|button|cancel/i.tp) return true
                    }
                    if ($(tg).attr("contenteditable")) return true;
                    if (self.hasfocus || self.hasmousefocus && !domfocus || self.ispage && !domfocus && !mousefocus) {
                        var key = e.keyCode;
                        if (self.railslocked && key != 27) return self.cancelEvent(e);
                        var ctrl = e.ctrlKey || false;
                        var shift = e.shiftKey || false;
                        var ret = false;
                        switch (key) {
                            case 38:
                            case 63233:
                                self.doScrollBy(24 * 3);
                                ret = true;
                                break;
                            case 40:
                            case 63235:
                                self.doScrollBy(-24 * 3);
                                ret = true;
                                break;
                            case 37:
                            case 63232:
                                if (self.railh) {
                                    ctrl ? self.doScrollLeft(0) : self.doScrollLeftBy(24 * 3);
                                    ret = true
                                }
                                break;
                            case 39:
                            case 63234:
                                if (self.railh) {
                                    ctrl ? self.doScrollLeft(self.page.maxw) : self.doScrollLeftBy(-24 * 3);
                                    ret = true
                                }
                                break;
                            case 33:
                            case 63276:
                                self.doScrollBy(self.view.h);
                                ret = true;
                                break;
                            case 34:
                            case 63277:
                                self.doScrollBy(-self.view.h);
                                ret = true;
                                break;
                            case 36:
                            case 63273:
                                self.railh && ctrl ? self.doScrollPos(0, 0) : self.doScrollTo(0);
                                ret = true;
                                break;
                            case 35:
                            case 63275:
                                self.railh && ctrl ? self.doScrollPos(self.page.maxw, self.page.maxh) : self.doScrollTo(self.page.maxh);
                                ret = true;
                                break;
                            case 32:
                                if (opt.spacebarenabled) {
                                    shift ? self.doScrollBy(self.view.h) : self.doScrollBy(-self.view.h);
                                    ret = true
                                }
                                break;
                            case 27:
                                if (self.zoomactive) {
                                    self.doZoom();
                                    ret = true
                                }
                                break
                        }
                        if (ret) return self.cancelEvent(e)
                    }
                };
                if (opt.enablekeyboard) self.bind(_doc, cap.isopera && !cap.isopera12 ? "keypress" : "keydown", self.onkeypress);
                self.bind(_doc, "keydown", function(e) {
                    var ctrl = e.ctrlKey || false;
                    if (ctrl) self.wheelprevented = true
                });
                self.bind(_doc, "keyup", function(e) {
                    var ctrl = e.ctrlKey || false;
                    if (!ctrl) self.wheelprevented = false
                });
                self.bind(_win, "blur", function(e) {
                    self.wheelprevented = false
                });
                self.bind(_win, "resize", self.onscreenresize);
                self.bind(_win, "orientationchange", self.onscreenresize);
                self.bind(_win, "load", self.lazyResize);
                if (cap.ischrome && !self.ispage && !self.haswrapper) {
                    var tmp = self.win.attr("style");
                    var ww = parseFloat(self.win.css("width")) + 1;
                    self.win.css("width", ww);
                    self.synched("chromefix", function() {
                        self.win.attr("style", tmp)
                    })
                }
                self.onAttributeChange = function(e) {
                    self.lazyResize(self.isieold ? 250 : 30)
                };
                if (opt.enableobserver) {
                    if (!self.isie11 && ClsMutationObserver !== false) {
                        self.observerbody = new ClsMutationObserver(function(mutations) {
                            mutations.forEach(function(mut) {
                                if (mut.type == "attributes") {
                                    return $body.hasClass("modal-open") && $body.hasClass("modal-dialog") && !$.contains($(".modal-dialog")[0], self.doc[0]) ? self.hide() : self.show()
                                }
                            });
                            if (self.me.clientWidth != self.page.width || self.me.clientHeight != self.page.height) return self.lazyResize(30)
                        });
                        self.observerbody.observe(_doc.body, {
                            childList: true,
                            subtree: true,
                            characterData: false,
                            attributes: true,
                            attributeFilter: ["class"]
                        })
                    }
                    if (!self.ispage && !self.haswrapper) {
                        var _dom = self.win[0];
                        if (ClsMutationObserver !== false) {
                            self.observer = new ClsMutationObserver(function(mutations) {
                                mutations.forEach(self.onAttributeChange)
                            });
                            self.observer.observe(_dom, {
                                childList: true,
                                characterData: false,
                                attributes: true,
                                subtree: false
                            });
                            self.observerremover = new ClsMutationObserver(function(mutations) {
                                mutations.forEach(function(mo) {
                                    if (mo.removedNodes.length > 0) {
                                        for (var dd in mo.removedNodes) {
                                            if (!!self && mo.removedNodes[dd] === _dom) return self.remove()
                                        }
                                    }
                                })
                            });
                            self.observerremover.observe(_dom.parentNode, {
                                childList: true,
                                characterData: false,
                                attributes: false,
                                subtree: false
                            })
                        } else {
                            self.bind(_dom, cap.isie && !cap.isie9 ? "propertychange" : "DOMAttrModified", self.onAttributeChange);
                            if (cap.isie9) _dom.attachEvent("onpropertychange", self.onAttributeChange);
                            self.bind(_dom, "DOMNodeRemoved", function(e) {
                                if (e.target === _dom) self.remove()
                            })
                        }
                    }
                }
                if (!self.ispage && opt.boxzoom) self.bind(_win, "resize", self.resizeZoom);
                if (self.istextarea) {
                    self.bind(self.win, "keydown", self.lazyResize);
                    self.bind(self.win, "mouseup", self.lazyResize)
                }
                self.lazyResize(30)
            }
            if (this.doc[0].nodeName == "IFRAME") {
                var oniframeload = function() {
                    self.iframexd = false;
                    var doc;
                    try {
                        doc = "contentDocument" in this ? this.contentDocument : this.contentWindow._doc;
                        var a = doc.domain
                    } catch (e) {
                        self.iframexd = true;
                        doc = false
                    }
                    if (self.iframexd) {
                        if ("console" in _win) console.log("NiceScroll error: policy restriced iframe");
                        return true
                    }
                    self.forcescreen = true;
                    if (self.isiframe) {
                        self.iframe = {
                            doc: $(doc),
                            html: self.doc.contents().find("html")[0],
                            body: self.doc.contents().find("body")[0]
                        };
                        self.getContentSize = function() {
                            return {
                                w: Math.max(self.iframe.html.scrollWidth, self.iframe.body.scrollWidth),
                                h: Math.max(self.iframe.html.scrollHeight, self.iframe.body.scrollHeight)
                            }
                        };
                        self.docscroll = $(self.iframe.body)
                    }
                    if (!cap.isios && opt.iframeautoresize && !self.isiframe) {
                        self.win.scrollTop(0);
                        self.doc.height("");
                        var hh = Math.max(doc.getElementsByTagName("html")[0].scrollHeight, doc.body.scrollHeight);
                        self.doc.height(hh)
                    }
                    self.lazyResize(30);
                    self.css($(self.iframe.body), _scrollyhidden);
                    if (cap.isios && self.haswrapper) {
                        self.css($(doc.body), {
                            "-webkit-transform": "translate3d(0,0,0)"
                        })
                    }
                    if ("contentWindow" in this) {
                        self.bind(this.contentWindow, "scroll", self.onscroll)
                    } else {
                        self.bind(doc, "scroll", self.onscroll)
                    }
                    if (opt.enablemousewheel) {
                        self.mousewheel(doc, self.onmousewheel)
                    }
                    if (opt.enablekeyboard) self.bind(doc, cap.isopera ? "keypress" : "keydown", self.onkeypress);
                    if (cap.cantouch) {
                        self.bind(doc, "touchstart", self.ontouchstart);
                        self.bind(doc, "touchmove", self.ontouchmove)
                    } else if (opt.emulatetouch) {
                        self.bind(doc, "mousedown", self.ontouchstart);
                        self.bind(doc, "mousemove", function(e) {
                            return self.ontouchmove(e, true)
                        });
                        if (opt.grabcursorenabled && cap.cursorgrabvalue) self.css($(doc.body), {
                            cursor: cap.cursorgrabvalue
                        })
                    }
                    self.bind(doc, "mouseup", self.ontouchend);
                    if (self.zoom) {
                        if (opt.dblclickzoom) self.bind(doc, "dblclick", self.doZoom);
                        if (self.ongesturezoom) self.bind(doc, "gestureend", self.ongesturezoom)
                    }
                };
                if (this.doc[0].readyState && this.doc[0].readyState === "complete") {
                    setTimeout(function() {
                        oniframeload.call(self.doc[0], false)
                    }, 500)
                }
                self.bind(this.doc, "load", oniframeload)
            }
        };
        this.showCursor = function(py, px) {
            if (self.cursortimeout) {
                clearTimeout(self.cursortimeout);
                self.cursortimeout = 0
            }
            if (!self.rail) return;
            if (self.autohidedom) {
                self.autohidedom.stop().css({
                    opacity: opt.cursoropacitymax
                });
                self.cursoractive = true
            }
            if (!self.rail.drag || self.rail.drag.pt != 1) {
                if (py !== undefined && py !== false) {
                    self.scroll.y = py / self.scrollratio.y | 0
                }
                if (px !== undefined) {
                    self.scroll.x = px / self.scrollratio.x | 0
                }
            }
            self.cursor.css({
                height: self.cursorheight,
                top: self.scroll.y
            });
            if (self.cursorh) {
                var lx = self.hasreversehr ? self.scrollvaluemaxw - self.scroll.x : self.scroll.x;
                self.cursorh.css({
                    width: self.cursorwidth,
                    left: !self.rail.align && self.rail.visibility ? lx + self.rail.width : lx
                });
                self.cursoractive = true
            }
            if (self.zoom) self.zoom.stop().css({
                opacity: opt.cursoropacitymax
            })
        };
        this.hideCursor = function(tm) {
            if (self.cursortimeout) return;
            if (!self.rail) return;
            if (!self.autohidedom) return;
            if (self.hasmousefocus && opt.autohidemode === "leave") return;
            self.cursortimeout = setTimeout(function() {
                if (!self.rail.active || !self.showonmouseevent) {
                    self.autohidedom.stop().animate({
                        opacity: opt.cursoropacitymin
                    });
                    if (self.zoom) self.zoom.stop().animate({
                        opacity: opt.cursoropacitymin
                    });
                    self.cursoractive = false
                }
                self.cursortimeout = 0
            }, tm || opt.hidecursordelay)
        };
        this.noticeCursor = function(tm, py, px) {
            self.showCursor(py, px);
            if (!self.rail.active) self.hideCursor(tm)
        };
        this.getContentSize = self.ispage ? function() {
            return {
                w: Math.max(_doc.body.scrollWidth, _doc.documentElement.scrollWidth),
                h: Math.max(_doc.body.scrollHeight, _doc.documentElement.scrollHeight)
            }
        } : self.haswrapper ? function() {
            return {
                w: self.doc[0].offsetWidth,
                h: self.doc[0].offsetHeight
            }
        } : function() {
            return {
                w: self.docscroll[0].scrollWidth,
                h: self.docscroll[0].scrollHeight
            }
        };
        this.onResize = function(e, page) {
            if (!self || !self.win) return false;
            var premaxh = self.page.maxh,
                premaxw = self.page.maxw,
                previewh = self.view.h,
                previeww = self.view.w;
            self.view = {
                w: self.ispage ? self.win.width() : self.win[0].clientWidth,
                h: self.ispage ? self.win.height() : self.win[0].clientHeight
            };
            self.page = page ? page : self.getContentSize();
            self.page.maxh = Math.max(0, self.page.h - self.view.h);
            self.page.maxw = Math.max(0, self.page.w - self.view.w);
            if (self.page.maxh == premaxh && self.page.maxw == premaxw && self.view.w == previeww && self.view.h == previewh) {
                if (!self.ispage) {
                    var pos = self.win.offset();
                    if (self.lastposition) {
                        var lst = self.lastposition;
                        if (lst.top == pos.top && lst.left == pos.left) return self
                    }
                    self.lastposition = pos
                } else {
                    return self
                }
            }
            if (self.page.maxh === 0) {
                self.hideRail();
                self.scrollvaluemax = 0;
                self.scroll.y = 0;
                self.scrollratio.y = 0;
                self.cursorheight = 0;
                self.setScrollTop(0);
                if (self.rail) self.rail.scrollable = false
            } else {
                self.page.maxh -= opt.railpadding.top + opt.railpadding.bottom;
                self.rail.scrollable = true
            }
            if (self.page.maxw === 0) {
                self.hideRailHr();
                self.scrollvaluemaxw = 0;
                self.scroll.x = 0;
                self.scrollratio.x = 0;
                self.cursorwidth = 0;
                self.setScrollLeft(0);
                if (self.railh) {
                    self.railh.scrollable = false
                }
            } else {
                self.page.maxw -= opt.railpadding.left + opt.railpadding.right;
                if (self.railh) self.railh.scrollable = opt.horizrailenabled
            }
            self.railslocked = self.locked || self.page.maxh === 0 && self.page.maxw === 0;
            if (self.railslocked) {
                if (!self.ispage) self.updateScrollBar(self.view);
                return false
            }
            if (!self.hidden) {
                if (!self.rail.visibility) self.showRail();
                if (self.railh && !self.railh.visibility) self.showRailHr()
            }
            if (self.istextarea && self.win.css("resize") && self.win.css("resize") != "none") self.view.h -= 20;
            self.cursorheight = Math.min(self.view.h, Math.round(self.view.h * (self.view.h / self.page.h)));
            self.cursorheight = opt.cursorfixedheight ? opt.cursorfixedheight : Math.max(opt.cursorminheight, self.cursorheight);
            self.cursorwidth = Math.min(self.view.w, Math.round(self.view.w * (self.view.w / self.page.w)));
            self.cursorwidth = opt.cursorfixedheight ? opt.cursorfixedheight : Math.max(opt.cursorminheight, self.cursorwidth);
            self.scrollvaluemax = self.view.h - self.cursorheight - (opt.railpadding.top + opt.railpadding.bottom);
            if (!self.hasborderbox) self.scrollvaluemax -= self.cursor[0].offsetHeight - self.cursor[0].clientHeight;
            if (self.railh) {
                self.railh.width = self.page.maxh > 0 ? self.view.w - self.rail.width : self.view.w;
                self.scrollvaluemaxw = self.railh.width - self.cursorwidth - (opt.railpadding.left + opt.railpadding.right)
            }
            if (!self.ispage) self.updateScrollBar(self.view);
            self.scrollratio = {
                x: self.page.maxw / self.scrollvaluemaxw,
                y: self.page.maxh / self.scrollvaluemax
            };
            var sy = self.getScrollTop();
            if (sy > self.page.maxh) {
                self.doScrollTop(self.page.maxh)
            } else {
                self.scroll.y = self.getScrollTop() / self.scrollratio.y | 0;
                self.scroll.x = self.getScrollLeft() / self.scrollratio.x | 0;
                if (self.cursoractive) self.noticeCursor()
            }
            if (self.scroll.y && self.getScrollTop() === 0) self.doScrollTo(self.scroll.y * self.scrollratio.y | 0);
            return self
        };
        this.resize = self.onResize;
        var hlazyresize = 0;
        this.onscreenresize = function(e) {
            clearTimeout(hlazyresize);
            var hiderails = !self.ispage && !self.haswrapper;
            if (hiderails) self.hideRails();
            hlazyresize = setTimeout(function() {
                if (self) {
                    if (hiderails) self.showRails();
                    self.resize()
                }
                hlazyresize = 0
            }, 120)
        };
        this.lazyResize = function(tm) {
            clearTimeout(hlazyresize);
            tm = isNaN(tm) ? 240 : tm;
            hlazyresize = setTimeout(function() {
                self && self.resize();
                hlazyresize = 0
            }, tm);
            return self
        };

        function _modernWheelEvent(dom, name, fn, bubble) {
            self._bind(dom, name, function(e) {
                e = e || _win.event;
                var event = {
                    original: e,
                    target: e.target || e.srcElement,
                    type: "wheel",
                    deltaMode: e.type == "MozMousePixelScroll" ? 0 : 1,
                    deltaX: 0,
                    deltaZ: 0,
                    preventDefault: function() {
                        e.preventDefault ? e.preventDefault() : e.returnValue = false;
                        return false
                    },
                    stopImmediatePropagation: function() {
                        e.stopImmediatePropagation ? e.stopImmediatePropagation() : e.cancelBubble = true
                    }
                };
                if (name == "mousewheel") {
                    e.wheelDeltaX && (event.deltaX = -1 / 40 * e.wheelDeltaX);
                    e.wheelDeltaY && (event.deltaY = -1 / 40 * e.wheelDeltaY);
                    !event.deltaY && !event.deltaX && (event.deltaY = -1 / 40 * e.wheelDelta)
                } else {
                    event.deltaY = e.detail
                }
                return fn.call(dom, event)
            }, bubble)
        }
        this.jqbind = function(dom, name, fn) {
            self.events.push({
                e: dom,
                n: name,
                f: fn,
                q: true
            });
            $(dom).on(name, fn)
        };
        this.mousewheel = function(dom, fn, bubble) {
            var el = "jquery" in dom ? dom[0] : dom;
            if ("onwheel" in _doc.createElement("div")) {
                self._bind(el, "wheel", fn, bubble || false)
            } else {
                var wname = _doc.onmousewheel !== undefined ? "mousewheel" : "DOMMouseScroll";
                _modernWheelEvent(el, wname, fn, bubble || false);
                if (wname == "DOMMouseScroll") _modernWheelEvent(el, "MozMousePixelScroll", fn, bubble || false)
            }
        };
        var passiveSupported = false;
        if (cap.haseventlistener) {
            try {
                var options = Object.defineProperty({}, "passive", {
                    get: function() {
                        passiveSupported = !0
                    }
                });
                _win.addEventListener("test", null, options)
            } catch (err) {}
            this.stopPropagation = function(e) {
                if (!e) return false;
                e = e.original ? e.original : e;
                e.stopPropagation();
                return false
            };
            this.cancelEvent = function(e) {
                if (e.cancelable) e.preventDefault();
                e.stopImmediatePropagation();
                if (e.preventManipulation) e.preventManipulation();
                return false
            }
        } else {
            Event.prototype.preventDefault = function() {
                this.returnValue = false
            };
            Event.prototype.stopPropagation = function() {
                this.cancelBubble = true
            };
            _win.constructor.prototype.addEventListener = _doc.constructor.prototype.addEventListener = Element.prototype.addEventListener = function(type, listener, useCapture) {
                this.attachEvent("on" + type, listener)
            };
            _win.constructor.prototype.removeEventListener = _doc.constructor.prototype.removeEventListener = Element.prototype.removeEventListener = function(type, listener, useCapture) {
                this.detachEvent("on" + type, listener)
            };
            this.cancelEvent = function(e) {
                e = e || _win.event;
                if (e) {
                    e.cancelBubble = true;
                    e.cancel = true;
                    e.returnValue = false
                }
                return false
            };
            this.stopPropagation = function(e) {
                e = e || _win.event;
                if (e) e.cancelBubble = true;
                return false
            }
        }
        this.delegate = function(dom, name, fn, bubble, active) {
            var de = delegatevents[name] || false;
            if (!de) {
                de = {
                    a: [],
                    l: [],
                    f: function(e) {
                        var lst = de.l,
                            l = lst.length - 1;
                        var r = false;
                        for (var a = l; a >= 0; a--) {
                            r = lst[a].call(e.target, e);
                            if (r === false) return false
                        }
                        return r
                    }
                };
                self.bind(dom, name, de.f, bubble, active);
                delegatevents[name] = de
            }
            if (self.ispage) {
                de.a = [self.id].concat(de.a);
                de.l = [fn].concat(de.l)
            } else {
                de.a.push(self.id);
                de.l.push(fn)
            }
        };
        this.undelegate = function(dom, name, fn, bubble, active) {
            var de = delegatevents[name] || false;
            if (de && de.l) {
                for (var a = 0, l = de.l.length; a < l; a++) {
                    if (de.a[a] === self.id) {
                        de.a.splice(a);
                        de.l.splice(a);
                        if (de.a.length === 0) {
                            self._unbind(dom, name, de.l.f);
                            delegatevents[name] = null
                        }
                    }
                }
            }
        };
        this.bind = function(dom, name, fn, bubble, active) {
            var el = "jquery" in dom ? dom[0] : dom;
            self._bind(el, name, fn, bubble || false, active || false)
        };
        this._bind = function(el, name, fn, bubble, active) {
            self.events.push({
                e: el,
                n: name,
                f: fn,
                b: bubble,
                q: false
            });
            passiveSupported && active ? el.addEventListener(name, fn, {
                passive: false,
                capture: bubble
            }) : el.addEventListener(name, fn, bubble || false)
        };
        this._unbind = function(el, name, fn, bub) {
            if (delegatevents[name]) self.undelegate(el, name, fn, bub);
            else el.removeEventListener(name, fn, bub)
        };
        this.unbindAll = function() {
            for (var a = 0; a < self.events.length; a++) {
                var r = self.events[a];
                r.q ? r.e.unbind(r.n, r.f) : self._unbind(r.e, r.n, r.f, r.b)
            }
        };
        this.showRails = function() {
            return self.showRail().showRailHr()
        };
        this.showRail = function() {
            if (self.page.maxh !== 0 && (self.ispage || self.win.css("display") != "none")) {
                self.rail.visibility = true;
                self.rail.css("display", "block")
            }
            return self
        };
        this.showRailHr = function() {
            if (self.railh) {
                if (self.page.maxw !== 0 && (self.ispage || self.win.css("display") != "none")) {
                    self.railh.visibility = true;
                    self.railh.css("display", "block")
                }
            }
            return self
        };
        this.hideRails = function() {
            return self.hideRail().hideRailHr()
        };
        this.hideRail = function() {
            self.rail.visibility = false;
            self.rail.css("display", "none");
            return self
        };
        this.hideRailHr = function() {
            if (self.railh) {
                self.railh.visibility = false;
                self.railh.css("display", "none")
            }
            return self
        };
        this.show = function() {
            self.hidden = false;
            self.railslocked = false;
            return self.showRails()
        };
        this.hide = function() {
            self.hidden = true;
            self.railslocked = true;
            return self.hideRails()
        };
        this.toggle = function() {
            return self.hidden ? self.show() : self.hide()
        };
        this.remove = function() {
            self.stop();
            if (self.cursortimeout) clearTimeout(self.cursortimeout);
            for (var n in self.delaylist)
                if (self.delaylist[n]) clearAnimationFrame(self.delaylist[n].h);
            self.doZoomOut();
            self.unbindAll();
            if (cap.isie9) self.win[0].detachEvent("onpropertychange", self.onAttributeChange);
            if (self.observer !== false) self.observer.disconnect();
            if (self.observerremover !== false) self.observerremover.disconnect();
            if (self.observerbody !== false) self.observerbody.disconnect();
            self.events = null;
            if (self.cursor) {
                self.cursor.remove()
            }
            if (self.cursorh) {
                self.cursorh.remove()
            }
            if (self.rail) {
                self.rail.remove()
            }
            if (self.railh) {
                self.railh.remove()
            }
            if (self.zoom) {
                self.zoom.remove()
            }
            for (var a = 0; a < self.saved.css.length; a++) {
                var d = self.saved.css[a];
                d[0].css(d[1], d[2] === undefined ? "" : d[2])
            }
            self.saved = false;
            self.me.data("__nicescroll", "");
            var lst = $.nicescroll;
            lst.each(function(i) {
                if (!this) return;
                if (this.id === self.id) {
                    delete lst[i];
                    for (var b = ++i; b < lst.length; b++, i++) lst[i] = lst[b];
                    lst.length--;
                    if (lst.length) delete lst[lst.length]
                }
            });
            for (var i in self) {
                self[i] = null;
                delete self[i]
            }
            self = null
        };
        this.scrollstart = function(fn) {
            this.onscrollstart = fn;
            return self
        };
        this.scrollend = function(fn) {
            this.onscrollend = fn;
            return self
        };
        this.scrollcancel = function(fn) {
            this.onscrollcancel = fn;
            return self
        };
        this.zoomin = function(fn) {
            this.onzoomin = fn;
            return self
        };
        this.zoomout = function(fn) {
            this.onzoomout = fn;
            return self
        };
        this.isScrollable = function(e) {
            var dom = e.target ? e.target : e;
            if (dom.nodeName == "OPTION") return true;
            while (dom && dom.nodeType == 1 && dom !== this.me[0] && !/^BODY|HTML/.test(dom.nodeName)) {
                var dd = $(dom);
                var ov = dd.css("overflowY") || dd.css("overflowX") || dd.css("overflow") || "";
                if (/scroll|auto/.test(ov)) return dom.clientHeight != dom.scrollHeight;
                dom = dom.parentNode ? dom.parentNode : false
            }
            return false
        };
        this.getViewport = function(me) {
            var dom = me && me.parentNode ? me.parentNode : false;
            while (dom && dom.nodeType == 1 && !/^BODY|HTML/.test(dom.nodeName)) {
                var dd = $(dom);
                if (/fixed|absolute/.test(dd.css("position"))) return dd;
                var ov = dd.css("overflowY") || dd.css("overflowX") || dd.css("overflow") || "";
                if (/scroll|auto/.test(ov) && dom.clientHeight != dom.scrollHeight) return dd;
                if (dd.getNiceScroll().length > 0) return dd;
                dom = dom.parentNode ? dom.parentNode : false
            }
            return false
        };
        this.triggerScrollStart = function(cx, cy, rx, ry, ms) {
            if (self.onscrollstart) {
                var info = {
                    type: "scrollstart",
                    current: {
                        x: cx,
                        y: cy
                    },
                    request: {
                        x: rx,
                        y: ry
                    },
                    end: {
                        x: self.newscrollx,
                        y: self.newscrolly
                    },
                    speed: ms
                };
                self.onscrollstart.call(self, info)
            }
        };
        this.triggerScrollEnd = function() {
            if (self.onscrollend) {
                var px = self.getScrollLeft();
                var py = self.getScrollTop();
                var info = {
                    type: "scrollend",
                    current: {
                        x: px,
                        y: py
                    },
                    end: {
                        x: px,
                        y: py
                    }
                };
                self.onscrollend.call(self, info)
            }
        };
        var scrolldiry = 0,
            scrolldirx = 0,
            scrolltmr = 0,
            scrollspd = 1;

        function doScrollRelative(px, py, chkscroll, iswheel) {
            if (!self.scrollrunning) {
                self.newscrolly = self.getScrollTop();
                self.newscrollx = self.getScrollLeft();
                scrolltmr = now()
            }
            var gap = now() - scrolltmr;
            scrolltmr = now();
            if (gap > 350) {
                scrollspd = 1
            } else {
                scrollspd += (2 - scrollspd) / 10
            }
            px = px * scrollspd | 0;
            py = py * scrollspd | 0;
            if (px) {
                if (iswheel) {
                    if (px < 0) {
                        if (self.getScrollLeft() >= self.page.maxw) return true
                    } else {
                        if (self.getScrollLeft() <= 0) return true
                    }
                }
                var dx = px > 0 ? 1 : -1;
                if (scrolldirx !== dx) {
                    if (self.scrollmom) self.scrollmom.stop();
                    self.newscrollx = self.getScrollLeft();
                    scrolldirx = dx
                }
                self.lastdeltax -= px
            }
            if (py) {
                var chk = function() {
                    var top = self.getScrollTop();
                    if (py < 0) {
                        if (top >= self.page.maxh) return true
                    } else {
                        if (top <= 0) return true
                    }
                }();
                if (chk) {
                    if (opt.nativeparentscrolling && chkscroll && !self.ispage && !self.zoomactive) return true;
                    var ny = self.view.h >> 1;
                    if (self.newscrolly < -ny) {
                        self.newscrolly = -ny;
                        py = -1
                    } else if (self.newscrolly > self.page.maxh + ny) {
                        self.newscrolly = self.page.maxh + ny;
                        py = 1
                    } else py = 0
                }
                var dy = py > 0 ? 1 : -1;
                if (scrolldiry !== dy) {
                    if (self.scrollmom) self.scrollmom.stop();
                    self.newscrolly = self.getScrollTop();
                    scrolldiry = dy
                }
                self.lastdeltay -= py
            }
            if (py || px) {
                self.synched("relativexy", function() {
                    var dty = self.lastdeltay + self.newscrolly;
                    self.lastdeltay = 0;
                    var dtx = self.lastdeltax + self.newscrollx;
                    self.lastdeltax = 0;
                    if (!self.rail.drag) self.doScrollPos(dtx, dty)
                })
            }
        }
        var hasparentscrollingphase = false;

        function execScrollWheel(e, hr, chkscroll) {
            var px, py;
            if (!chkscroll && hasparentscrollingphase) return true;
            if (e.deltaMode === 0) {
                px = -(e.deltaX * (opt.mousescrollstep / (18 * 3))) | 0;
                py = -(e.deltaY * (opt.mousescrollstep / (18 * 3))) | 0
            } else if (e.deltaMode === 1) {
                px = -(e.deltaX * opt.mousescrollstep * 50 / 80) | 0;
                py = -(e.deltaY * opt.mousescrollstep * 50 / 80) | 0
            }
            if (hr && opt.oneaxismousemode && px === 0 && py) {
                px = py;
                py = 0;
                if (chkscroll) {
                    var hrend = px < 0 ? self.getScrollLeft() >= self.page.maxw : self.getScrollLeft() <= 0;
                    if (hrend) {
                        py = px;
                        px = 0
                    }
                }
            }
            if (self.isrtlmode) px = -px;
            var chk = doScrollRelative(px, py, chkscroll, true);
            if (chk) {
                if (chkscroll) hasparentscrollingphase = true
            } else {
                hasparentscrollingphase = false;
                e.stopImmediatePropagation();
                return e.preventDefault()
            }
        }
        this.onmousewheel = function(e) {
            if (self.wheelprevented || self.locked) return false;
            if (self.railslocked) {
                self.debounced("checkunlock", self.resize, 250);
                return false
            }
            if (self.rail.drag) return self.cancelEvent(e);
            if (opt.oneaxismousemode === "auto" && e.deltaX !== 0) opt.oneaxismousemode = false;
            if (opt.oneaxismousemode && e.deltaX === 0) {
                if (!self.rail.scrollable) {
                    if (self.railh && self.railh.scrollable) {
                        return self.onmousewheelhr(e)
                    } else {
                        return true
                    }
                }
            }
            var nw = now();
            var chk = false;
            if (opt.preservenativescrolling && self.checkarea + 600 < nw) {
                self.nativescrollingarea = self.isScrollable(e);
                chk = true
            }
            self.checkarea = nw;
            if (self.nativescrollingarea) return true;
            var ret = execScrollWheel(e, false, chk);
            if (ret) self.checkarea = 0;
            return ret
        };
        this.onmousewheelhr = function(e) {
            if (self.wheelprevented) return;
            if (self.railslocked || !self.railh.scrollable) return true;
            if (self.rail.drag) return self.cancelEvent(e);
            var nw = now();
            var chk = false;
            if (opt.preservenativescrolling && self.checkarea + 600 < nw) {
                self.nativescrollingarea = self.isScrollable(e);
                chk = true
            }
            self.checkarea = nw;
            if (self.nativescrollingarea) return true;
            if (self.railslocked) return self.cancelEvent(e);
            return execScrollWheel(e, true, chk)
        };
        this.stop = function() {
            self.cancelScroll();
            if (self.scrollmon) self.scrollmon.stop();
            self.cursorfreezed = false;
            self.scroll.y = Math.round(self.getScrollTop() * (1 / self.scrollratio.y));
            self.noticeCursor();
            return self
        };
        this.getTransitionSpeed = function(dif) {
            return 80 + dif / 72 * opt.scrollspeed | 0
        };
        if (!opt.smoothscroll) {
            this.doScrollLeft = function(x, spd) {
                var y = self.getScrollTop();
                self.doScrollPos(x, y, spd)
            };
            this.doScrollTop = function(y, spd) {
                var x = self.getScrollLeft();
                self.doScrollPos(x, y, spd)
            };
            this.doScrollPos = function(x, y, spd) {
                var nx = x > self.page.maxw ? self.page.maxw : x;
                if (nx < 0) nx = 0;
                var ny = y > self.page.maxh ? self.page.maxh : y;
                if (ny < 0) ny = 0;
                self.synched("scroll", function() {
                    self.setScrollTop(ny);
                    self.setScrollLeft(nx)
                })
            };
            this.cancelScroll = function() {}
        } else if (self.ishwscroll && cap.hastransition && opt.usetransition && !!opt.smoothscroll) {
            var lasttransitionstyle = "";
            this.resetTransition = function() {
                lasttransitionstyle = "";
                self.doc.css(cap.prefixstyle + "transition-duration", "0ms")
            };
            this.prepareTransition = function(dif, istime) {
                var ex = istime ? dif : self.getTransitionSpeed(dif);
                var trans = ex + "ms";
                if (lasttransitionstyle !== trans) {
                    lasttransitionstyle = trans;
                    self.doc.css(cap.prefixstyle + "transition-duration", trans)
                }
                return ex
            };
            this.doScrollLeft = function(x, spd) {
                var y = self.scrollrunning ? self.newscrolly : self.getScrollTop();
                self.doScrollPos(x, y, spd)
            };
            this.doScrollTop = function(y, spd) {
                var x = self.scrollrunning ? self.newscrollx : self.getScrollLeft();
                self.doScrollPos(x, y, spd)
            };
            this.cursorupdate = {
                running: false,
                start: function() {
                    var m = this;
                    if (m.running) return;
                    m.running = true;
                    var loop = function() {
                        if (m.running) setAnimationFrame(loop);
                        self.showCursor(self.getScrollTop(), self.getScrollLeft());
                        self.notifyScrollEvent(self.win[0])
                    };
                    setAnimationFrame(loop)
                },
                stop: function() {
                    this.running = false
                }
            };
            this.doScrollPos = function(x, y, spd) {
                var py = self.getScrollTop();
                var px = self.getScrollLeft();
                if ((self.newscrolly - py) * (y - py) < 0 || (self.newscrollx - px) * (x - px) < 0) self.cancelScroll();
                if (!opt.bouncescroll) {
                    if (y < 0) y = 0;
                    else if (y > self.page.maxh) y = self.page.maxh;
                    if (x < 0) x = 0;
                    else if (x > self.page.maxw) x = self.page.maxw
                } else {
                    if (y < 0) y = y / 2 | 0;
                    else if (y > self.page.maxh) y = self.page.maxh + (y - self.page.maxh) / 2 | 0;
                    if (x < 0) x = x / 2 | 0;
                    else if (x > self.page.maxw) x = self.page.maxw + (x - self.page.maxw) / 2 | 0
                }
                if (self.scrollrunning && x == self.newscrollx && y == self.newscrolly) return false;
                self.newscrolly = y;
                self.newscrollx = x;
                var top = self.getScrollTop();
                var lft = self.getScrollLeft();
                var dst = {};
                dst.x = x - lft;
                dst.y = y - top;
                var dd = Math.sqrt(dst.x * dst.x + dst.y * dst.y) | 0;
                var ms = self.prepareTransition(dd);
                if (!self.scrollrunning) {
                    self.scrollrunning = true;
                    self.triggerScrollStart(lft, top, x, y, ms);
                    self.cursorupdate.start()
                }
                self.scrollendtrapped = true;
                if (!cap.transitionend) {
                    if (self.scrollendtrapped) clearTimeout(self.scrollendtrapped);
                    self.scrollendtrapped = setTimeout(self.onScrollTransitionEnd, ms)
                }
                self.setScrollTop(self.newscrolly);
                self.setScrollLeft(self.newscrollx)
            };
            this.cancelScroll = function() {
                if (!self.scrollendtrapped) return true;
                var py = self.getScrollTop();
                var px = self.getScrollLeft();
                self.scrollrunning = false;
                if (!cap.transitionend) clearTimeout(cap.transitionend);
                self.scrollendtrapped = false;
                self.resetTransition();
                self.setScrollTop(py);
                if (self.railh) self.setScrollLeft(px);
                if (self.timerscroll && self.timerscroll.tm) clearInterval(self.timerscroll.tm);
                self.timerscroll = false;
                self.cursorfreezed = false;
                self.cursorupdate.stop();
                self.showCursor(py, px);
                return self
            };
            this.onScrollTransitionEnd = function() {
                if (!self.scrollendtrapped) return;
                var py = self.getScrollTop();
                var px = self.getScrollLeft();
                if (py < 0) py = 0;
                else if (py > self.page.maxh) py = self.page.maxh;
                if (px < 0) px = 0;
                else if (px > self.page.maxw) px = self.page.maxw;
                if (py != self.newscrolly || px != self.newscrollx) return self.doScrollPos(px, py, opt.snapbackspeed);
                if (self.scrollrunning) self.triggerScrollEnd();
                self.scrollrunning = false;
                self.scrollendtrapped = false;
                self.resetTransition();
                self.timerscroll = false;
                self.setScrollTop(py);
                if (self.railh) self.setScrollLeft(px);
                self.cursorupdate.stop();
                self.noticeCursor(false, py, px);
                self.cursorfreezed = false
            }
        } else {
            this.doScrollLeft = function(x, spd) {
                var y = self.scrollrunning ? self.newscrolly : self.getScrollTop();
                self.doScrollPos(x, y, spd)
            };
            this.doScrollTop = function(y, spd) {
                var x = self.scrollrunning ? self.newscrollx : self.getScrollLeft();
                self.doScrollPos(x, y, spd)
            };
            this.doScrollPos = function(x, y, spd) {
                var py = self.getScrollTop();
                var px = self.getScrollLeft();
                if ((self.newscrolly - py) * (y - py) < 0 || (self.newscrollx - px) * (x - px) < 0) self.cancelScroll();
                var clipped = false;
                if (!self.bouncescroll || !self.rail.visibility) {
                    if (y < 0) {
                        y = 0;
                        clipped = true
                    } else if (y > self.page.maxh) {
                        y = self.page.maxh;
                        clipped = true
                    }
                }
                if (!self.bouncescroll || !self.railh.visibility) {
                    if (x < 0) {
                        x = 0;
                        clipped = true
                    } else if (x > self.page.maxw) {
                        x = self.page.maxw;
                        clipped = true
                    }
                }
                if (self.scrollrunning && self.newscrolly === y && self.newscrollx === x) return true;
                self.newscrolly = y;
                self.newscrollx = x;
                self.dst = {};
                self.dst.x = x - px;
                self.dst.y = y - py;
                self.dst.px = px;
                self.dst.py = py;
                var dd = Math.sqrt(self.dst.x * self.dst.x + self.dst.y * self.dst.y) | 0;
                var ms = self.getTransitionSpeed(dd);
                self.bzscroll = {};
                var p3 = clipped ? 1 : .58;
                self.bzscroll.x = new BezierClass(px, self.newscrollx, ms, 0, 0, p3, 1);
                self.bzscroll.y = new BezierClass(py, self.newscrolly, ms, 0, 0, p3, 1);
                var loopid = now();
                var loop = function() {
                    if (!self.scrollrunning) return;
                    var x = self.bzscroll.y.getPos();
                    self.setScrollLeft(self.bzscroll.x.getNow());
                    self.setScrollTop(self.bzscroll.y.getNow());
                    if (x <= 1) {
                        self.timer = setAnimationFrame(loop)
                    } else {
                        self.scrollrunning = false;
                        self.timer = 0;
                        self.triggerScrollEnd()
                    }
                };
                if (!self.scrollrunning) {
                    self.triggerScrollStart(px, py, x, y, ms);
                    self.scrollrunning = true;
                    self.timer = setAnimationFrame(loop)
                }
            };
            this.cancelScroll = function() {
                if (self.timer) clearAnimationFrame(self.timer);
                self.timer = 0;
                self.bzscroll = false;
                self.scrollrunning = false;
                return self
            }
        }
        this.doScrollBy = function(stp, relative) {
            doScrollRelative(0, stp)
        };
        this.doScrollLeftBy = function(stp, relative) {
            doScrollRelative(stp, 0)
        };
        this.doScrollTo = function(pos, relative) {
            var ny = relative ? Math.round(pos * self.scrollratio.y) : pos;
            if (ny < 0) ny = 0;
            else if (ny > self.page.maxh) ny = self.page.maxh;
            self.cursorfreezed = false;
            self.doScrollTop(pos)
        };
        this.checkContentSize = function() {
            var pg = self.getContentSize();
            if (pg.h != self.page.h || pg.w != self.page.w) self.resize(false, pg)
        };
        self.onscroll = function(e) {
            if (self.rail.drag) return;
            if (!self.cursorfreezed) {
                self.synched("scroll", function() {
                    self.scroll.y = Math.round(self.getScrollTop() / self.scrollratio.y);
                    if (self.railh) self.scroll.x = Math.round(self.getScrollLeft() / self.scrollratio.x);
                    self.noticeCursor()
                })
            }
        };
        self.bind(self.docscroll, "scroll", self.onscroll);
        this.doZoomIn = function(e) {
            if (self.zoomactive) return;
            self.zoomactive = true;
            self.zoomrestore = {
                style: {}
            };
            var lst = ["position", "top", "left", "zIndex", "backgroundColor", "marginTop", "marginBottom", "marginLeft", "marginRight"];
            var win = self.win[0].style;
            for (var a in lst) {
                var pp = lst[a];
                self.zoomrestore.style[pp] = win[pp] !== undefined ? win[pp] : ""
            }
            self.zoomrestore.style.width = self.win.css("width");
            self.zoomrestore.style.height = self.win.css("height");
            self.zoomrestore.padding = {
                w: self.win.outerWidth() - self.win.width(),
                h: self.win.outerHeight() - self.win.height()
            };
            if (cap.isios4) {
                self.zoomrestore.scrollTop = $window.scrollTop();
                $window.scrollTop(0)
            }
            self.win.css({
                position: cap.isios4 ? "absolute" : "fixed",
                top: 0,
                left: 0,
                zIndex: globalmaxzindex + 100,
                margin: 0
            });
            var bkg = self.win.css("backgroundColor");
            if ("" === bkg || /transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(bkg)) self.win.css("backgroundColor", "#fff");
            self.rail.css({
                zIndex: globalmaxzindex + 101
            });
            self.zoom.css({
                zIndex: globalmaxzindex + 102
            });
            self.zoom.css("backgroundPosition", "0 -18px");
            self.resizeZoom();
            if (self.onzoomin) self.onzoomin.call(self);
            return self.cancelEvent(e)
        };
        this.doZoomOut = function(e) {
            if (!self.zoomactive) return;
            self.zoomactive = false;
            self.win.css("margin", "");
            self.win.css(self.zoomrestore.style);
            if (cap.isios4) {
                $window.scrollTop(self.zoomrestore.scrollTop)
            }
            self.rail.css({
                "z-index": self.zindex
            });
            self.zoom.css({
                "z-index": self.zindex
            });
            self.zoomrestore = false;
            self.zoom.css("backgroundPosition", "0 0");
            self.onResize();
            if (self.onzoomout) self.onzoomout.call(self);
            return self.cancelEvent(e)
        };
        this.doZoom = function(e) {
            return self.zoomactive ? self.doZoomOut(e) : self.doZoomIn(e)
        };
        this.resizeZoom = function() {
            if (!self.zoomactive) return;
            var py = self.getScrollTop();
            self.win.css({
                width: $window.width() - self.zoomrestore.padding.w + "px",
                height: $window.height() - self.zoomrestore.padding.h + "px"
            });
            self.onResize();
            self.setScrollTop(Math.min(self.page.maxh, py))
        };
        this.init();
        $.nicescroll.push(this)
    };
    var ScrollMomentumClass2D = function(nc) {
        var self = this;
        this.nc = nc;
        this.lastx = 0;
        this.lasty = 0;
        this.speedx = 0;
        this.speedy = 0;
        this.lasttime = 0;
        this.steptime = 0;
        this.snapx = false;
        this.snapy = false;
        this.demulx = 0;
        this.demuly = 0;
        this.lastscrollx = -1;
        this.lastscrolly = -1;
        this.chkx = 0;
        this.chky = 0;
        this.timer = 0;
        this.reset = function(px, py) {
            self.stop();
            self.steptime = 0;
            self.lasttime = now();
            self.speedx = 0;
            self.speedy = 0;
            self.lastx = px;
            self.lasty = py;
            self.lastscrollx = -1;
            self.lastscrolly = -1
        };
        this.update = function(px, py) {
            var tm = now();
            self.steptime = tm - self.lasttime;
            self.lasttime = tm;
            var dy = py - self.lasty;
            var dx = px - self.lastx;
            var sy = self.nc.getScrollTop();
            var sx = self.nc.getScrollLeft();
            var newy = sy + dy;
            var newx = sx + dx;
            self.snapx = newx < 0 || newx > self.nc.page.maxw;
            self.snapy = newy < 0 || newy > self.nc.page.maxh;
            self.speedx = dx;
            self.speedy = dy;
            self.lastx = px;
            self.lasty = py
        };
        this.stop = function() {
            self.nc.unsynched("domomentum2d");
            if (self.timer) clearTimeout(self.timer);
            self.timer = 0;
            self.lastscrollx = -1;
            self.lastscrolly = -1
        };
        this.doSnapy = function(nx, ny) {
            var snap = false;
            if (ny < 0) {
                ny = 0;
                snap = true
            } else if (ny > self.nc.page.maxh) {
                ny = self.nc.page.maxh;
                snap = true
            }
            if (nx < 0) {
                nx = 0;
                snap = true
            } else if (nx > self.nc.page.maxw) {
                nx = self.nc.page.maxw;
                snap = true
            }
            snap ? self.nc.doScrollPos(nx, ny, self.nc.opt.snapbackspeed) : self.nc.triggerScrollEnd()
        };
        this.doMomentum = function(gp) {
            var t = now();
            var l = gp ? t + gp : self.lasttime;
            var sl = self.nc.getScrollLeft();
            var st = self.nc.getScrollTop();
            var pageh = self.nc.page.maxh;
            var pagew = self.nc.page.maxw;
            self.speedx = pagew > 0 ? Math.min(60, self.speedx) : 0;
            self.speedy = pageh > 0 ? Math.min(60, self.speedy) : 0;
            var chk = l && t - l <= 60;
            if (st < 0 || st > pageh || sl < 0 || sl > pagew) chk = false;
            var sy = self.speedy && chk ? self.speedy : false;
            var sx = self.speedx && chk ? self.speedx : false;
            if (sy || sx) {
                var tm = Math.max(16, self.steptime);
                if (tm > 50) {
                    var xm = tm / 50;
                    self.speedx *= xm;
                    self.speedy *= xm;
                    tm = 50
                }
                self.demulxy = 0;
                self.lastscrollx = self.nc.getScrollLeft();
                self.chkx = self.lastscrollx;
                self.lastscrolly = self.nc.getScrollTop();
                self.chky = self.lastscrolly;
                var nx = self.lastscrollx;
                var ny = self.lastscrolly;
                var onscroll = function() {
                    var df = now() - t > 600 ? .04 : .02;
                    if (self.speedx) {
                        nx = Math.floor(self.lastscrollx - self.speedx * (1 - self.demulxy));
                        self.lastscrollx = nx;
                        if (nx < 0 || nx > pagew) df = .1
                    }
                    if (self.speedy) {
                        ny = Math.floor(self.lastscrolly - self.speedy * (1 - self.demulxy));
                        self.lastscrolly = ny;
                        if (ny < 0 || ny > pageh) df = .1
                    }
                    self.demulxy = Math.min(1, self.demulxy + df);
                    self.nc.synched("domomentum2d", function() {
                        if (self.speedx) {
                            var scx = self.nc.getScrollLeft();
                            self.chkx = nx;
                            self.nc.setScrollLeft(nx)
                        }
                        if (self.speedy) {
                            var scy = self.nc.getScrollTop();
                            self.chky = ny;
                            self.nc.setScrollTop(ny)
                        }
                        if (!self.timer) {
                            self.nc.hideCursor();
                            self.doSnapy(nx, ny)
                        }
                    });
                    if (self.demulxy < 1) {
                        self.timer = setTimeout(onscroll, tm)
                    } else {
                        self.stop();
                        self.nc.hideCursor();
                        self.doSnapy(nx, ny)
                    }
                };
                onscroll()
            } else {
                self.doSnapy(self.nc.getScrollLeft(), self.nc.getScrollTop())
            }
        }
    };
    var _scrollTop = jQuery.fn.scrollTop;
    jQuery.cssHooks.pageYOffset = {
        get: function(elem, computed, extra) {
            var nice = $.data(elem, "__nicescroll") || false;
            return nice && nice.ishwscroll ? nice.getScrollTop() : _scrollTop.call(elem)
        },
        set: function(elem, value) {
            var nice = $.data(elem, "__nicescroll") || false;
            nice && nice.ishwscroll ? nice.setScrollTop(parseInt(value)) : _scrollTop.call(elem, value);
            return this
        }
    };
    jQuery.fn.scrollTop = function(value) {
        if (value === undefined) {
            var nice = this[0] ? $.data(this[0], "__nicescroll") || false : false;
            return nice && nice.ishwscroll ? nice.getScrollTop() : _scrollTop.call(this)
        } else {
            return this.each(function() {
                var nice = $.data(this, "__nicescroll") || false;
                nice && nice.ishwscroll ? nice.setScrollTop(parseInt(value)) : _scrollTop.call($(this), value)
            })
        }
    };
    var _scrollLeft = jQuery.fn.scrollLeft;
    $.cssHooks.pageXOffset = {
        get: function(elem, computed, extra) {
            var nice = $.data(elem, "__nicescroll") || false;
            return nice && nice.ishwscroll ? nice.getScrollLeft() : _scrollLeft.call(elem)
        },
        set: function(elem, value) {
            var nice = $.data(elem, "__nicescroll") || false;
            nice && nice.ishwscroll ? nice.setScrollLeft(parseInt(value)) : _scrollLeft.call(elem, value);
            return this
        }
    };
    jQuery.fn.scrollLeft = function(value) {
        if (value === undefined) {
            var nice = this[0] ? $.data(this[0], "__nicescroll") || false : false;
            return nice && nice.ishwscroll ? nice.getScrollLeft() : _scrollLeft.call(this)
        } else {
            return this.each(function() {
                var nice = $.data(this, "__nicescroll") || false;
                nice && nice.ishwscroll ? nice.setScrollLeft(parseInt(value)) : _scrollLeft.call($(this), value)
            })
        }
    };
    var NiceScrollArray = function(doms) {
        var self = this;
        this.length = 0;
        this.name = "nicescrollarray";
        this.each = function(fn) {
            $.each(self, fn);
            return self
        };
        this.push = function(nice) {
            self[self.length] = nice;
            self.length++
        };
        this.eq = function(idx) {
            return self[idx]
        };
        if (doms) {
            for (var a = 0; a < doms.length; a++) {
                var nice = $.data(doms[a], "__nicescroll") || false;
                if (nice) {
                    this[this.length] = nice;
                    this.length++
                }
            }
        }
        return this
    };

    function mplex(el, lst, fn) {
        for (var a = 0, l = lst.length; a < l; a++) fn(el, lst[a])
    }
    mplex(NiceScrollArray.prototype, ["show", "hide", "toggle", "onResize", "resize", "remove", "stop", "doScrollPos"], function(e, n) {
        e[n] = function() {
            var args = arguments;
            return this.each(function() {
                this[n].apply(this, args)
            })
        }
    });
    jQuery.fn.getNiceScroll = function(index) {
        if (index === undefined) {
            return new NiceScrollArray(this)
        } else {
            return this[index] && $.data(this[index], "__nicescroll") || false
        }
    };
    var pseudos = jQuery.expr.pseudos || jQuery.expr[":"];
    pseudos.nicescroll = function(a) {
        return $.data(a, "__nicescroll") !== undefined
    };
    $.fn.niceScroll = function(wrapper, _opt) {
        if (_opt === undefined && typeof wrapper == "object" && !("jquery" in wrapper)) {
            _opt = wrapper;
            wrapper = false
        }
        if (is_mobile_device() && FullSize.width <= 1025) {
            $(this).css("overflow", "auto");
            return $(this)
        }
        var ret = new NiceScrollArray;
        this.each(function() {
            var $this = $(this);
            var opt = $.extend({}, _opt);
            if (wrapper || false) {
                var wrp = $(wrapper);
                opt.doc = wrp.length > 1 ? $(wrapper, $this) : wrp;
                opt.win = $this
            }
            var docundef = !("doc" in opt);
            if (!docundef && !("win" in opt)) opt.win = $this;
            var nice = $this.data("__nicescroll") || false;
            if (!nice) {
                opt.doc = opt.doc || $this;
                nice = new NiceScrollClass(opt, $this);
                $this.data("__nicescroll", nice)
            }
            ret.push(nice)
        });
        return ret.length === 1 ? ret[0] : ret
    };
    _win.NiceScroll = {
        getjQuery: function() {
            return jQuery
        }
    };
    if (!$.nicescroll) {
        $.nicescroll = new NiceScrollArray;
        $.nicescroll.options = _globaloptions
    }
});

function mobile_log(txt) {
    if (mobile_log.is_off) return;
    if (!mobile_log.into) {
        mobile_log.into = $('<div id="mobile_logs"></div>').appendTo("body");
        $("<style> #mobile_logs { \t\t\t\tposition: fixed; \t\t\t\ttop: 0; left: 0; z-index: 5000; \t\t\t\tbackground: #fff; color: #000; \t\t\t} #mobile_logs>p { \t\t\t\tmargin: 0.4em; \t\t\t\tfont: 0.8em sans-serif; \t\t\t} </style>").appendTo("body")
    }
    mobile_log.into.append($("<p></p>").text(txt))
}
mobile_log.consolelog = function() {
    console.log = function() {
        var msg = "";
        for (var i in arguments) {
            msg += JSON.stringify(arguments[i], null, "\t");
            msg += "\n"
        }
        mobile_log(msg)
    }
};
mobile_log.off = function() {
    mobile_log.is_off = true
};
mobile_log.on = function() {
    mobile_log.is_off = false
};
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};

function webPSupportCheck() {
    var savedSupport = localStorage.getItem("webPSupport");
    if (savedSupport === "yes") return true;
    if (savedSupport === "no") return false;
    var webPSupport = false;
    var canvas = (typeof document === "undefined" ? "undefined" : _typeof(document)) === "object" ? document.createElement("canvas") : {};
    canvas.width = canvas.height = 1;
    var firefoxDetection = window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);
    var firefoxVersion = firefoxDetection ? parseInt(firefoxDetection[1]) : 0;
    if (firefoxVersion > 64) {
        webPSupport = true
    } else {
        webPSupport = canvas.toDataURL ? canvas.toDataURL("image/webp").indexOf("image/webp") === 5 : false
    }
    localStorage.setItem("webPSupport", webPSupport ? "yes" : "no");
    return webPSupport
}
String.prototype.toImageUrl = function() {
    var resizingType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
    var imageUrl = this.toString();
    if (resizingType === null) {
        console.log("Error: no resizing type provided to toImageUrl for" + imageUrl);
        return imageUrl
    } else if (!imageUrl.includes(".png")) {
        console.log("Error: no png detected in image src: " + imageUrl);
        return imageUrl
    }
    var webPSupport = webPSupportCheck();
    var sizeAvatar = screen.width > 1025 ? "-1200x" : "-300x";
    var extension = webPSupport ? ".webp" : ".png";
    switch (resizingType) {
        case "ava":
        case "avb":
            return imageUrl.replace(".png", sizeAvatar + extension);
        case "ico":
            return imageUrl.replace(".png", "-300x" + extension);
        default:
            console.log("Error: incorrect resizing type provided to toImageUrl for " + imageUrl);
            return imageUrl
    }
};

function replaceImageSources() {
    var typesToResize = ["girl-ava", "girl-ico", "girl-avb"];
    typesToResize.forEach(function(resizingType) {
        $("img[" + resizingType + "-src]").each(function() {
            $(this).attr("src", $(this).attr(resizingType + "-src").toImageUrl(resizingType.split("-")[1]))
        })
    })
}
$(document).ready(function() {
    replaceImageSources()
});
var star_glitter = function star_glitter(x, y, w, h) {
    var write_css = function write_css() {
        if (star_glitter.css_written) return;
        star_glitter.css_written = true;
        var keyfr = "@keyframes glitter {\n" + "\t0% { transform: scale(1.0); opacity: 1; }\n" + "\t50% { transform: scale(0.5); opacity: 0; }\n" + "\t100% { transform: scale(1.0); opacity: 1; }\n" + "}\n";
        var css = css_add_prefixes(keyfr);
        css += ".glitter-svg {\n\tposition:absolute;\nopacity:0;\nz-index:999;\n" + css_add_prefixes("\ttransition: opacity 1s;\n") + "}\n";
        css += ".glitter-star {\n" + css_add_prefixes("\tanimation: glitter 500ms linear 0s infinite normal;\n") + "}\n";
        $("body").append("<style>" + css + "</style>")
    };
    var write_svg = function write_svg() {
        star_glitter.unique_id++;
        var svg = '<svg width="' + w + '" height="' + h + '" class="glitter-svg" style="top:' + y + "; left:" + x + '; pointer-events: none" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n';
        svg += '\t<defs><path id="star' + star_glitter.unique_id + '" fill="#ffcc00" d="M0-10L2.939-4.05L9.511-3.09L4.755 1.55L5.878 8.09L0 5L-5.878 8.09L-4.755 1.55L-9.511-3.09L-2.939-4.05Z"/></defs>\n';
        svg += "\t<g>\n";
        var positions = [
            [28, 12, 9],
            [45, 68, 5],
            [93, 44, 3],
            [21, 39, 7],
            [74, 76, 1],
            [19, 75, 8],
            [39, 32, 5],
            [43, 85, 4],
            [62, 20, 3],
            [72, 48, 3]
        ];
        for (var i = 0; i < 10; i++) {
            var delay = scale_me(0, 500, positions[i][2] / 10);
            delay = css_add_prefixes("animation-delay:" + delay + "ms;");
            var size = scale_me(20, 80, i / 10) / 100;
            if (h < 30) size *= .6;
            else if (h > 100) size *= 2;
            var x1 = scale_me(0, w, positions[i][0]) / 100;
            var y1 = scale_me(0, h, positions[i][1]) / 100;
            svg += '\t\t<g transform="translate(' + x1 + "," + y1 + ") scale(" + size + ')">\n\t\t\t<use xlink:href="#star' + star_glitter.unique_id + '" class="glitter-star" style="' + delay + '"/>\n\t\t</g>\n'
        }
        svg += "\t</g>\n</svg>\n";
        $svg = $(svg);
        $("#contains_all").append($svg)
    };
    var scale_me = function scale_me(start, end, i) {
        return i * (end - start) + start
    };
    w = w ? Math.round(parseInt(w, 10)) : 200;
    h = h ? Math.round(parseInt(h, 10)) : 200;
    var $svg;
    write_css();
    write_svg();
    setTimeout(function() {
        $svg.css("opacity", "1")
    }, 50);
    setTimeout(function() {
        $svg.css("opacity", "0");
        setTimeout(function() {
            $svg.remove()
        }, 1050)
    }, 2e3)
};
star_glitter.css_written = false;
star_glitter.unique_id = 0;
var appear_anim = {
    appear_all: function appear_all() {
        var $appear = $("[appear]");
        if (!$appear.length) return;
        setTimeout(function() {
            $appear.each(function() {
                appear_anim.appear_one($(this))
            });
            $("[unappear]").fadeOut(2e3)
        }, 600)
    },
    appear_one: function appear_one($element) {
        var width, height;
        var left = "" + $element.css("left");
        var top = parseInt($element.css("top"));
        top = "" + (top / 100 * 500 + 80) + "";
        if ($element.is(".ico-quest")) {
            width = 185;
            height = 50
        } else if ($element.is(".ico-world")) {
            width = 90;
            height = 80
        } else if ($element.is("img.avatar")) {
            width = 160;
            height = 420;
            left = "350px";
            top = "150px";
            $(".new-information").each(function(index, value) {
                var me = $(this);
                setTimeout(function() {
                    me.slideDown(2e3);
                    setTimeout(function() {
                        $("#harem_right>.opened .girl_infos_area").getNiceScroll().resize()
                    }, 2100)
                }, (index + 1) * 2e3)
            });
            if (is_mobile_size()) {
                left = "380px"
            }
        }
        $element.fadeIn(2e3);
        new star_glitter(left, top, width, height)
    }
};

function glitter_me(field) {
    var x, y, w, h;
    switch (field) {
        case "soft_currency":
            if (is_mobile_size()) {
                x = "730px";
                y = "10px";
                w = 100;
                h = 30
            } else {
                x = "720px";
                y = "10px";
                w = 90;
                h = 30
            }
            break;
        case "hard_currency":
            if (is_mobile_size()) {
                x = "730px";
                y = "38px";
                w = 100;
                h = 30
            } else {
                x = "800px";
                y = "10px";
                w = 90;
                h = 30
            }
            break;
        case "energy_quest":
            if (is_mobile_size()) {
                x = "370px";
                y = "20px";
                w = 130;
                h = 50
            } else {
                x = "390px";
                y = "10px";
                w = 150;
                h = 30
            }
            break;
        case "energy_battle":
            if (is_mobile_size()) {
                x = "530px";
                y = "20px";
                w = 130;
                h = 50
            } else {
                x = "530px";
                y = "0px";
                w = 150;
                h = 30
            }
            break;
        case "xp":
            if (is_mobile_size()) {
                x = "230px";
                y = "25px";
                w = 130;
                h = 40
            } else {
                x = "190px";
                y = "10px";
                w = 120;
                h = 30
            }
            break;
        case "affection":
            x = "680px";
            y = "260px";
            w = 140;
            h = 40;
            break;
        case "xp_shop":
            x = "680px";
            y = "240px";
            w = 140;
            h = 40;
            break;
        default:
            return
    }
    new star_glitter(x, y, w, h)
}
var star_glitter2 = function star_glitter2(purpose, selector, x, y, w, h) {
    var duration = 2e3;
    var length = 1e4;
    var color = "#FFFFFF";
    var size = .55;
    if (purpose == "new girl1") {
        size = .2;
        length = 1400
    } else if (purpose == "new girl2") {
        size = .3;
        length = 1400
    }
    var write_css = function write_css() {
        if (star_glitter2.css_written) return;
        star_glitter2.css_written = true;
        var keyfr = "@keyframes glitter {\n" + "\t0% { opacity: 0; }\n" + "\t10% { opacity: 1; }\n" + "\t20% { opacity: 0; }\n" + "\t100% { opacity: 0; }\n" + "}\n";
        var css = css_add_prefixes(keyfr);
        css += ".glitter-svg {\nposition:absolute;\npointer-events: none;\nopacity:0;\nz-index:999;\n" + css_add_prefixes("transition: opacity 1s;\n") + "}\n";
        css += ".glitter-star {\nopacity:0; pointer-events: none; \n" + css_add_prefixes("\tanimation: glitter " + duration + "ms linear 0s infinite normal;\n") + "}\n";
        $("head").append("<style>" + css + "</style>")
    };
    var write_svg = function write_svg() {
        star_glitter2.unique_id++;
        var svg = '<svg width="' + w + '" height="' + h + '" class="glitter-svg" style="top:0; left:0" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n';
        svg += '\t<defs><path id="star' + star_glitter2.unique_id + '" fill="' + color + '" d="M0-10L2.939-4.05L9.511-3.09L4.755 1.55L5.878 8.09L0 5L-5.878 8.09L-4.755 1.55L-9.511-3.09L-2.939-4.05Z"/></defs>\n';
        svg += "\t<g>\n";
        var positions = [
            [6, 50, 1],
            [7, 65, 2],
            [10, 55, 3],
            [11, 75, 4],
            [9, 35, 5],
            [14, 20, 6],
            [13, 40, 7],
            [13, 63, 8],
            [16, 80, 5],
            [18, 27, 8],
            [19, 67, 2],
            [17, 46, 4],
            [94, 50, 8],
            [93, 65, 2],
            [90, 55, 3],
            [89, 75, 4],
            [91, 35, 5],
            [86, 20, 6],
            [87, 40, 7],
            [87, 63, 8],
            [84, 80, 1],
            [82, 27, 2],
            [81, 67, 3],
            [83, 46, 4],
            [20, 86, 1],
            [26, 82, 2],
            [30, 89, 3],
            [34, 85, 4],
            [39, 83, 5],
            [43, 86, 6],
            [48, 84, 7],
            [54, 83, 8],
            [61, 85, 1],
            [66, 87, 2],
            [70, 84, 3],
            [75, 86, 4],
            [79, 85, 5],
            [51, 93, 6],
            [58, 95, 7],
            [37, 92, 6],
            [24, 93, 4],
            [70, 93, 5],
            [82, 90, 3],
            [63, 96, 3],
            [46, 97, 3],
            [33, 97, 3],
            [50, 77, 3],
            [20, 14, 5],
            [26, 18, 3],
            [30, 11, 7],
            [34, 15, 8],
            [39, 17, 3],
            [43, 14, 5],
            [48, 16, 2],
            [54, 17, 6],
            [61, 15, 4],
            [66, 13, 5],
            [70, 16, 3],
            [75, 14, 1],
            [79, 15, 7],
            [51, 9, 2],
            [57, 8, 8],
            [37, 7, 6],
            [24, 8, 1],
            [63, 7, 5],
            [72, 8, 4],
            [23, 50, 7],
            [22, 32, 4],
            [24, 70, 2],
            [27, 30, 7],
            [30, 23, 4],
            [17, 57, 2],
            [29, 74, 5],
            [28, 59, 1],
            [30, 40, 6],
            [32, 65, 3],
            [34, 32, 5],
            [36, 73, 2],
            [35, 53, 1],
            [40, 34, 7],
            [42, 65, 3],
            [44, 28, 4],
            [45, 74, 5],
            [49, 30, 6],
            [40, 50, 7],
            [46, 43, 3],
            [54, 38, 4],
            [56, 63, 1],
            [58, 34, 2],
            [75, 26, 4],
            [62, 71, 5],
            [64, 25, 2],
            [50, 59, 4],
            [70, 37, 1],
            [67, 65, 6],
            [75, 58, 8],
            [63, 48, 7]
        ];
        for (var i = 0; i < positions.length; i++) {
            var delay = scale_me(0, duration, positions[i][2] / 10);
            delay = css_add_prefixes("animation-delay:" + delay + "ms;");
            var x1 = scale_me(0, w, positions[i][0] / 100);
            var y1 = scale_me(0, h, positions[i][1] / 100);
            svg += '\t\t<g transform="translate(' + x1 + "," + y1 + ") scale(" + size + ')">\n\t\t\t<use xlink:href="#star' + star_glitter2.unique_id + '" class="glitter-star" style="' + delay + '"/>\n\t\t</g>\n'
        }
        svg += "\t</g>\n</svg>\n";
        $svg = $(svg);
        $(selector).append($svg)
    };
    var scale_me = function scale_me(start, end, i) {
        return i * (end - start) + start
    };
    x = Math.round(parseInt(x, 10));
    y = Math.round(parseInt(y, 10));
    w = w ? Math.round(parseInt(w, 10)) : 200;
    h = h ? Math.round(parseInt(h, 10)) : 200;
    var $svg;
    write_css();
    write_svg();
    setTimeout(function() {
        $svg.css("opacity", "1")
    }, 50);
    setTimeout(function() {
        $svg.css("opacity", "0");
        setTimeout(function() {
            $svg.remove()
        }, 1e3)
    }, length)
};
star_glitter2.css_written = false;
star_glitter2.unique_id = 0;

function glitter_me2(purpose, selector) {
    if (typeof selector === "string") var $a = $(selector);
    else var $a = selector;
    var offset = $a.offset();
    new star_glitter2(purpose, $a, offset.left, offset.top, $a.width(), $a.height())
}

function anim_number($s, current, diff) {
    var goal = current + diff;
    var diff2 = Math.abs(diff);
    if (diff2 == 1) {
        hh_format_number($s, goal);
        return
    }
    var interval = $s.data("anim_number");
    if (interval) clearInterval(interval);
    var speed = 2e3 / diff2;
    var inc = 1;
    var divisor = 1;
    if (Math.round(diff) != diff) {
        divisor = 100;
        current = Math.round(current * divisor);
        diff2 = Math.round(diff2 * divisor);
        goal = Math.round(goal * divisor);
        speed = 1e3 / diff2
    }
    if (diff2 < 14) speed = 1e3 / diff2;
    while (speed < 30) {
        speed *= 2;
        inc *= 2
    }
    speed = Math.round(speed);
    var decimals = divisor == 1 ? 0 : 2;
    interval = setInterval(function() {
        if (diff > 0) {
            current += inc;
            if (current > goal) current = goal
        } else {
            current -= inc;
            if (current < goal) current = goal
        }
        hh_format_number($s, current / divisor, decimals);
        if (current == goal) {
            clearInterval(interval);
            $s.data("anim_number", 0)
        }
    }, speed);
    $s.data("anim_number", interval)
}
var loadingAnimation = {
    $animation: undefined,
    lastAnimatedElement: undefined,
    start: function start() {
        var $element = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : $("#contains_all");
        if (!$element.length) return;
        this.$animation = $(".loading-anim");
        var scale = getWindowScale($element);
        var matrixRegex = /matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/;
        var transform = $element.css("transform");
        var scaleMatrixArray = transform ? transform.match(matrixRegex) : false;
        var isAlreadyScaled = $element.is("#contains_all");
        var customScale = scaleMatrixArray && scaleMatrixArray.length >= 2 && !isAlreadyScaled ? parseFloat(scaleMatrixArray[1]) : 1;
        var finalScale = scale * customScale;
        var style = {
            width: parseInt(this.$animation.width() * scale, 10) + "px",
            top: parseInt($element.offset().top + $element.height() / 2 * finalScale, 10) + "px",
            left: parseInt($element.offset().left + $element.width() / 2 * finalScale, 10) + "px"
        };
        this.$animation.css(style);
        $element.css({
            filter: "brightness(0.5)",
            "pointer-events": "none"
        });
        this.$animation.show();
        if (this.lastAnimatedElement) this.stop();
        this.lastAnimatedElement = $element
    },
    stop: function stop() {
        if (this.lastAnimatedElement) {
            this.$animation.hide();
            this.lastAnimatedElement.css({
                filter: "none",
                "pointer-events": "auto"
            });
            delete this.lastAnimatedElement
        }
    }
};

function img_colorize($img) {
    $.animation(function(i) {
        $img.css({
            filter: "brightness(" + i + "%)",
            "-webkit-filter": "brightness(" + i + "%)"
        })
    }, 1e3, 0, 100)
}

function shaking_element($element, interval, time, size) {
    time = time || 0;
    size = size || 2;
    var arr = ["0px, -" + size + "px", "0px, " + size + "px", "" + size + "px, 0px", "-" + size + "px, 0px", "0px, " + size + "px", "0px, -" + size + "px", "-" + size + "px, 0px", "" + size + "px, 0px"];
    while (interval > 1) {
        arr = arr.concat(arr);
        interval--
    }
    setTimeout(shaking_element2, time);

    function shaking_element2() {
        var i = arr.shift();
        $element.css({
            transform: "translate(" + i + ")"
        });
        if (!arr.length) return;
        setTimeout(shaking_element2, 50)
    }
}

function getWindowScale() {
    var $element = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : $("#contains_all");
    var bodyWidth = $("body").width();
    var offsetLeft = $element.offset().left;
    var elementWidth = $element.width();
    return (bodyWidth - offsetLeft * 2) / elementWidth
}

function movingStars(click, value) {
    var scale = getWindowScale();
    if (value == "$") {
        var containerWidth = $("#contains_all").width();
        var containerHeight = $("#contains_all").height();
        var left = containerWidth * .07;
        var top = click.pageY / scale - 60 / 2;
        var style = "position: absolute; width: 60px; height: 60px; top: " + top + "px; left: " + left + "px; z-index: 999; transition: left 1s, top 1s, width 1s, height 1s;";
        var $img = $('<img class="collect_img" style="' + style + '" src="' + IMAGES_URL + '/design/ic_collect_SC.png">');
        $("#contains_all").append($img);
        var newT = top - containerHeight * .12;
        var newL = containerWidth * .55;
        var size = 94;
        var movement = [newL, newT, size];
        setTimeout(function() {
            $img.fadeIn("fast").css({
                left: movement[0] + "px",
                top: movement[1] + "px",
                width: movement[3],
                height: movement[3]
            });
            setTimeout(function() {
                $img.fadeOut();
                setTimeout(function() {
                    $img.remove()
                }, 1e3)
            }, 600)
        }, 100)
    } else if (value == "xp") {
        var right = (102 - 60) / 2;
        var top = (102 - 60) / 2;
        var counter = 0;
        var stop = setInterval(function() {
            if (counter == 4) clearInterval(stop);
            var style = "position: absolute; width: 60px; height: auto; top: " + top + "px; right: " + right + "px; opacity: 0; z-index: 999;";
            var $img = $('<img class="star_img" style="' + style + '" src="' + IMAGES_URL + '/design/ic_star_orange.svg">');
            $img.appendTo("#controls");
            counter++;
            setTimeout(function() {
                $img.remove()
            }, 1500)
        }, 200)
    }
}
var VerticalAnimID = 0;

function MovingVerticalSlotsV2($parent) {
    var manualOverride = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var $elm = $parent.children();
    var $children = $parent.find(">div>div");
    var height = parseInt($children.css("height").split("px")[0]);
    $elm.children().first().addClass("line");
    var animName = "vertical_slots" + VerticalAnimID++;
    var firstAnimValue = $children.length * height;
    var secondAnimValue = height;
    if (!Object.keys(manualOverride).length === 0) {
        if (manualOverride.hasOwnProperty("firstAnimValue") && manualOverride.hasOwnProperty("secondAnimValue")) {
            firstAnimValue = manualOverride.firstAnimValue;
            secondAnimValue = manualOverride.secondAnimValue
        } else {
            console.log("Manual animation override unsuccessful. Check if object properties are correct.")
        }
    }
    $("head link[rel='stylesheet']").last().after("\t\t<style>\t\t@keyframes " + animName + " {\t\t\t0% { transform: translateY(-" + firstAnimValue + "px) scale(1.0);}  \t\t\t100% { transform: translateY(" + secondAnimValue + "px) scale(1.0);}\t\t}\t\t</style>\t\t");
    this.animStyle = animName + " " + $children.length * 1.5 + "s linear infinite";
    $elm.css("animation", this.animStyle);
    this.elm = $elm
}
MovingVerticalSlotsV2.prototype.stop = function() {
    this.elm.css("animation", "none")
};
MovingVerticalSlotsV2.prototype.continue = function() {
    this.elm.css("animation", this.animStyle)
};

function scrollElement(scrollWrap, offset) {
    var duration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 500;
    var delay = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
    var _this = this;
    var callback = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;
    var args = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;
    var initialScroll = scrollWrap.scrollTop;
    var currentOffset = void 0;
    var start = void 0;
    var progress = 0;
    var scrollCallback = function scrollCallback(timestamp) {
        if (!start) start = timestamp;
        if (timestamp - start > delay) progress = timestamp - start - delay;
        currentOffset = offset * easeInOut(progress / duration);
        scrollWrap.scrollTop = Math.floor(initialScroll + currentOffset);
        if (progress >= duration) {
            scrollWrap.scrollTop = initialScroll + offset;
            if (typeof callback == "function") callback.apply(_this, args)
        } else window.requestAnimationFrame(scrollCallback)
    };
    window.requestAnimationFrame(scrollCallback)
}

function easeInOut(n) {
    return n > .5 ? 4 * Math.pow(n - 1, 3) + 1 : 4 * Math.pow(n, 3)
}
var hh_crosspromo = {
    adData: {},
    localCrosspromoRewards: {},
    remoteCrosspromoRewards: {},
    finishedCrosspromo: {},
    init: function init(crosspromo) {
        if (crosspromo.is_local) {
            this.localCrosspromoRewards = crosspromo.crosspromos;
            this.showLocalCrosspromoRewardPopup()
        } else if (crosspromo.is_remote) {
            this.remoteCrosspromoRewards = crosspromo.crosspromos;
            this.showRemoteCrosspromoRewardPopups()
        } else if (crosspromo.is_new) {
            this.adData = $.extend(true, {}, crosspromo.crosspromos);
            this.showCrosspromoPopup()
        } else if (crosspromo.is_finished) {
            this.finishedCrosspromo = $.extend(true, {}, crosspromo.crosspromos);
            this.showFinishedCrosspromoPopup()
        }
    },
    showCrosspromoPopup: function showCrosspromoPopup() {
        var _this = this;
        this.openPopup("crosspromo_show_ad", function() {
            var params = {
                class: "Crosspromo",
                action: "log_ad_view",
                crosspromo: _this.adData.id_crosspromo
            };
            hh_ajax(params)
        })
    },
    showLocalCrosspromoRewardPopup: function showLocalCrosspromoRewardPopup() {
        this.openPopup("crosspromo_show_localreward")
    },
    showRemoteCrosspromoRewardPopups: function showRemoteCrosspromoRewardPopups() {
        for (var index in this.remoteCrosspromoRewards) {
            delete this.remoteCrosspromoRewards[index];
            this.openPopup("crosspromo_show_remotereward_" + index)
        }
    },
    showFinishedCrosspromoPopup: function showFinishedCrosspromoPopup() {
        this.openPopup("crosspromo_show_finished")
    },
    openPopup: function openPopup(popupId, onOpen) {
        var _this2 = this;
        var popupConfig = {
            open_callback: onOpen,
            sliding: true,
            no_background: true
        };
        var callback;
        if (popupId == "crosspromo_show_ad") {
            callback = function callback() {
                _this2.closeAd(_this2.adData.id_crosspromo)
            }
        }
        HHSlidingPopupManager.show(popupId, popupConfig, callback)
    },
    closeAd: function closeAd(id_crosspromo) {
        var params = {
            class: "Crosspromo",
            action: "close_crosspromo",
            id_crosspromo: id_crosspromo
        };
        hh_ajax(params)
    },
    closeAndBan: function closeAndBan(element) {
        var params = {
            class: "Crosspromo",
            action: "ban_crosspromo",
            id_crosspromo: $(element).data("crosspromo-id")
        };
        hh_ajax(params)
    },
    redirectToCrosspromo: function redirectToCrosspromo(id_crosspromo, url, click_reward) {
        if (hh_app) parent.appGameSignal("openURL", [url]);
        else window.open(url);
        var is_crosspromo_page = $(".crosspromo_id_" + id_crosspromo).closest(".sex_friend_crosspromo").length;
        var params = {
            class: "Crosspromo",
            action: "log_player_redirect",
            crosspromo: id_crosspromo,
            url: url
        };
        hh_ajax(params);
        if (HH_UNIVERSE == "nutaku") {
            var _params = {
                class: "Crosspromo",
                action: "claim_nutaku_player",
                crosspromo: id_crosspromo
            };
            hh_ajax(_params)
        }
        if (click_reward) {
            var _params2 = {
                class: "Crosspromo",
                action: "click_reward",
                crosspromo: id_crosspromo
            };
            hh_ajax(_params2)
        }
        if (!is_crosspromo_page) this.closeAd(id_crosspromo)
    },
    giveRemoteCrosspromoReward: function giveRemoteCrosspromoReward(id_crosspromo, button) {
        $(button).attr("disabled", true);
        var params = {
            class: "Crosspromo",
            action: "send_tasks_complete_notification",
            crosspromo: id_crosspromo
        };
        hh_ajax(params, function(response) {
            HHSlidingPopupManager.closeLastOpenedPopup()
        })
    },
    giveLocalCrosspromoReward: function giveLocalCrosspromoReward(id_crosspromo, button) {
        var _this3 = this;
        $(button).attr("disabled", true);
        var is_crosspromo_page = $(".crosspromo_id_" + id_crosspromo).closest(".sex_friend_crosspromo").length;
        var params = {
            class: "Crosspromo",
            action: "local_crosspromo_give_reward",
            crosspromo: id_crosspromo
        };
        hh_ajax(params, function(response) {
            HHSlidingPopupManager.closeLastOpenedPopup();
            if (response.rewardAmount.hero.hard_currency === undefined) {
                Reward.handlePopup(_this3.localCrosspromoRewards.reward_girl_popup)
            } else {
                Hero.update("hard_currency", response.rewardAmount.hero.hard_currency, true)
            }
            if (is_crosspromo_page) reload()
        })
    }
};
var adBanner = {
    init: function init() {
        if ($("#sliding-popups iframe").length) {
            this.showAdBanner();
            $("#sliding-popups>close").appendTo($("#sliding-popups #iframe_wrapper"))
        }
    },
    showAdBanner: function showAdBanner() {
        var popupConfig = {
            open_callback: "",
            sliding: true,
            no_background: true
        };
        HHSlidingPopupManager.show("iframe_wrapper", popupConfig)
    }
};
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var HHCanvasWidth = 1040;
var HHCanvasHeight = 585;
if (!window.noFullSize) {
    FullSize.ajax_server = function(scale) {
        hh_ajax({
            class: "Hero",
            action: "save_screen_ratio",
            ratio: scale
        })
    };
    FullSize.ajax_server_on_run = true;
    FullSize.vertically_centered = false;
    FullSize.box_size = [HHCanvasWidth, HHCanvasHeight];
    FullSize.run()
}

function show_debug_lines(lines) {
    var $container = $(".hh_debug_lines:first").show();
    if ($container.length < 1) {
        $container = $("<div class='hh_debug_lines'>\n\t\t\t\t\t\t\t<h4>Debug lines:\n\t\t\t\t\t\t\t\t<a href='#' class='delete_messages'>(Hide me)</a>\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<div class=\"debug_lines_content\"></div>\n\t\t\t\t\t\t</div>");
        $("#debug_box").append($container)
    }
    $container.off(".delete_messages");
    $container.on("click", ".delete_messages", function(event) {
        event.preventDefault();
        $container.hide()
    });
    if ($container.children("div").length) {
        lines.unshift("---------------[AJAX DEBUG INFO]------------------")
    }
    for (var i = 0; i < lines.length; i++) {
        var $text = $("<div></div>").html(lines[i]);
        $container.find(".debug_lines_content").append($text)
    }
}

function hero_page_popup(info) {
    var preview = info.preview || false;
    var page = info.page || "harem";
    var params = {
        class: "HeroPages",
        action: "fetch",
        id: page,
        preview: preview,
        player_id: info.id
    };
    if (info.profile_fallback) params.profile_fallback = info.profile_fallback;
    if (info.background) params.background = info.background;
    else if (info.back_id) params.back_id = info.back_id;
    loadingAnimation.start();
    hh_ajax(params, function(resp) {
        loadingAnimation.stop();
        var openCallback = function openCallback() {
            setHeroPagePopup(resp.html)
        };
        if (HHPopupManager.getLastOpenedPopup() != "hero_pages") {
            var resetStyle = function resetStyle() {
                $("#hero_pages").css({
                    transform: "scale(0.98)",
                    opacity: "0"
                })
            };
            HHPopupManager.show("hero_pages", {
                open_callback: openCallback,
                color: "black"
            }, resetStyle)
        } else {
            openCallback()
        }
    })
}

function popup_message(input, callback) {
    var options = {
        no_background: true,
        context: {
            text: input
        }
    };
    if (HHPopupManager.getLastOpenedPopup()) options.show_over = true;
    HHPopupManager.show("popup_message", options, callback)
}
var objectivePopup = {
    initTime: null,
    pointsBox: {},
    objectiveStack: false,
    show: function show(data) {
        var _this = this;
        if (!data.objective_points) return;
        var objectivePoints = data.objective_points;
        if (!Object.keys(this.pointsBox).length) this.pointsBox = data.objective_points;
        else {
            for (var key in objectivePoints) {
                if (!this.pointsBox[key]) this.pointsBox[key] = objectivePoints[key];
                else if (this.pointsBox[key].name === objectivePoints[key].name) this.pointsBox[key].points_gained += objectivePoints[key].points_gained
            }
        }
        if (data.end && data.end.rewards && data.end.rewards.hasOwnProperty("lose")) return;
        window.clearTimeout(this.initTime);
        this.initTime = setTimeout(function() {
            if (data.next_step || $("body").attr("page") == "pachinko") {
                var _top = data.next_step ? "12rem" : "8.5rem";
                if ($("#objective_popup").length) {
                    HHSlidingPopupManager.close({}, "objective_popup");
                    if (!_this.objectiveStack) _this.initTime = setTimeout(function() {
                        _this.popOverlayPoints({
                            top_position: _top
                        });
                        _this.objectiveStack = true
                    }, 1e3)
                } else {
                    _this.objectiveStack = false;
                    _this.popOverlayPoints({
                        top_position: _top
                    })
                }
            } else {
                _this.popPoints()
            }
        }, data.next_step ? 200 : 1e3)
    },
    popPoints: function popPoints() {
        HHPopupManager.show("objective_popup", {
            objective_points: this.pointsBox,
            no_background: true,
            no_close: true
        });
        this.pointsBox = {}
    },
    popOverlayPoints: function popOverlayPoints(options) {
        HHSlidingPopupManager.show("objective_popup", Object.assign({
            objective_points: this.pointsBox,
            no_background: true,
            no_close: true,
            show_over: true
        }, options));
        this.pointsBox = {}
    }
};

function notEnoughSoftCurrency(amount) {
    var options = {
        context: {
            money: amount
        }
    };
    HHPopupManager.show("popup_message", options)
}

function payment_failed_popup(message) {
    var options = {
        no_background: true,
        error: message
    };
    if (HHPopupManager.getLastOpenedPopup()) options.show_over = true;
    HHPopupManager.show("payment_failed_popup", options)
}

function displayPendingRewards() {
    var shouldUpdateUI = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
    var params = {
        class: "RewardNotification",
        action: "show_pending"
    };
    hh_ajax(params, function(data) {
        if (data.heroChangesUpdate && !shouldUpdateUI) delete data.heroChangesUpdate;
        if (data.data) Reward.handlePopup(data)
    })
}

function hc_confirm(price, callback, closeCallback) {
    price = parseInt(price, 10);
    if (price > Hero.infos.hard_currency) {
        HHPopupManager.show("no_HC", {
            init_load: true,
            prevent_events: true
        })
    } else if (!Hero.infos.hc_confirm) {
        HHPopupManager.show("confirm_HC", {
            price: price,
            closeCallback: closeCallback
        }, callback)
    } else if (typeof callback == "function") callback()
}

function disableButtonIfNotEnoughKobans() {
    if (!GAME_FEATURE_NO_PAYMENT) {
        return
    }
    $(".orange_button_L, .orange_text_button, .blue_button_L").each(function() {
        var $hcButton = $(this);
        if ($("body").hasClass("page-champions") && $hcButton.hasClass("blue_button_L")) {
            if ($hcButton.attr("currency-type") == "hard_currency") {
                $hcButton.prop("disabled", false)
            }
            return
        }
        var price = $hcButton.attr("price");
        if (!price) {
            if ($hcButton.is("#collect_all")) {
                price = $hcButton.parent().attr("cost")
            } else {
                price = $hcButton.find('span.currency_cost, span.price-number, div[cur="hard_currency"], span[cur="hard_currency"], span[cur="HC"]>span, span.number').text()
            }
        }
        price = parseInt(price.replace(/\s/g, ""));
        if (price) {
            var disable = $.isNumeric(price) && price > Hero.infos.hard_currency;
            if ($hcButton.is("button,input")) {
                $hcButton.prop("disabled", disable)
            } else {
                $hcButton.toggleClass("grey_text_button", disable);
                if (disable) {
                    $hcButton.removeAttr("act")
                }
            }
        }
    })
}
Number.isInteger = Number.isInteger || function(value) {
    return typeof value === "number" && isFinite(value) && Math.floor(value) === value
};

function formatGirlCarac(caracValue) {
    var formatedCaracVal = caracValue >= 100 ? number_format_lang(caracValue) : number_format_lang(caracValue, 1);
    return formatedCaracVal
}

function hh_show_filtered_girls(girlsWrapperSelector, data) {
    var girlsElements = document.querySelectorAll(girlsWrapperSelector + " div[id_girl]");
    var toShowIds = Object.keys(data);
    for (var i = 0, len = girlsElements.length; i < len; i++) {
        var $elm = $(girlsElements[i]);
        if (toShowIds.indexOf($elm.attr("id_girl")) > -1) $elm.show();
        else $elm.hide()
    }
    if (girlsWrapperSelector == ".girls.wrapper") {
        $(girlsWrapperSelector).find(".empty").parent().show()
    }
}

function hh_filter_girls_list(girlsInputList, filterBy, value) {
    var filteredGirlsList = {};
    for (var girlID in girlsInputList) {
        var girl = girlsInputList[girlID];
        var source = girl.source_selector;
        if (source == undefined) return girlsInputList;
        if (filterBy == "name") {
            if (value && girl.name.toLowerCase().indexOf(value.toLowerCase()) != -1) filteredGirlsList[girlID] = girl
        } else if (filterBy == "world" || filterBy == "event") {
            if (source[0] == filterBy && (source[1] == value || value == 0)) filteredGirlsList[girlID] = girl
        } else if (source[0] == filterBy) filteredGirlsList[girlID] = girl;
        else if (filterBy == "shards") {
            if (value[0] <= girl.shards && girl.shards <= value[1]) filteredGirlsList[girlID] = girl
        } else if (filterBy == "class") {
            for (var activeClass in value) {
                if (value[activeClass] == girl.class) filteredGirlsList[girlID] = girl
            }
        } else if (filterBy == "positions") {
            if (girl.figure == value || value == 0) filteredGirlsList[girlID] = girl
        } else if (filterBy == "rarity") {
            if (girl.rarity == value || value == "all") filteredGirlsList[girlID] = girl
        }
    }
    return filteredGirlsList
}

function filter_lists(girlsWrapperSelector, type, option) {
    if (type == "lists") {
        var second_opition = undefined;
        if (option == "event" || option == "world") {
            $('select[name="' + option + '"]').show();
            second_opition = $('select[name="' + option + '"]').find("option:selected").attr("value")
        }
        if (option != "world") {
            $('select[name="world"]').hide()
        }
        if (option != "event") {
            $('select[name="event"]').hide()
        }
    } else if (type == "world" || type == "event") {
        option = type;
        var second_opition = $('select[name="' + type + '"]').find("option:selected").attr("value")
    }
    var filtered_girl_list = all_possible_girls;
    if (option != "all") {
        filtered_girl_list = hh_filter_girls_list(filtered_girl_list, option, second_opition)
    }
    if ($('input[name="find"]').val() != "") filtered_girl_list = hh_filter_girls_list(filtered_girl_list, "name", $('input[name="find"]').val());
    hh_show_filtered_girls(girlsWrapperSelector, filtered_girl_list);
    var chosen_slot = undefined;
    var $girls_wrapper = $(girlsWrapperSelector);
    using_girls($girls_wrapper, filtered_girl_list);
    $('.slot.girls.used[position="' + chosen_slot + '"]').addClass("using");
    $girls_wrapper.css({
        "margin-left": wrapper_margin[$girls_wrapper.attr("class")] + "px"
    });
    toggle_arrows($girls_wrapper)
}
var positionImages = ["img_0", "doggystyle.png", "dolphin.png", "missionary.png", "sodomy.png", "69.png", "jackhammer.png", "nosedive.png", "column.png", "indian.png", "suspendedcongress.png", "splittingbamboo.png", "bridge.png"];
var girlsSkillImages = ["burst.png", "block.png", "heal.png"];
$(function() {
    if (window.noFullSize) return;
    phoenixModal.open = function(selector) {
        HHPopupManager.show("authentication_popup", {
            show_over: true,
            no_background: true
        });
        $(selector).show().appendTo("#authentication_popup")
    };
    disableButtonIfNotEnoughKobans()
});

function getNow() {
    if (window.performance && performance.now) return performance.now();
    return Date.now()
}

function hh_ajax(params, callback, err_callback) {
    var ajaxStarting = getNow();
    return $.ajax({
        type: "POST",
        url: "/ajax.php",
        data: params,
        dataType: "json",
        success: function success(data) {
            if (data.retry_request) {
                setTimeout(function() {
                    hh_ajax(params, callback, err_callback)
                }, 500);
                return
            }
            var wannaWait = 100;
            var ajaxTook = getNow() - ajaxStarting;
            if (ajaxTook > 0 && ajaxTook < wannaWait) wannaWait -= Math.round(ajaxTook);
            else wannaWait = 0;
            if (data.hh_debug_lines) show_debug_lines(data.hh_debug_lines);
            setTimeout(function() {
                if (data.success) {
                    objectivePopup.show(data);
                    if (typeof callback == "function") callback(data);
                    if (data.html) {
                        replaceImageSources()
                    }
                } else if (data.error) {
                    if (typeof err_callback == "function") err_callback(data.error);
                    else popup_message(data.error, reload);
                    slotsActive = false
                }
            }, wannaWait);
            if (data.season_mojo_reset) {
                if (params && params.class && (params.class == "Battle" || params.class == "TeamBattle")) localStorageSetItem("season_reset", JSON.stringify(data.season_mojo_reset));
                else SeasonsFunc.show_season_end_popup(data.season_mojo_reset)
            }
        },
        error: function error(jqXHR, textStatus) {
            console.log("HH error", params, arguments);
            if (params.class == "Hero" && params.action == "save_screen_ratio" && !test_ajax_prod_mobile_fuck_503()) {
                return
            }
            if (textStatus == "parsererror") {
                if (jqXHR.responseText == "") {
                    console.log("hh_ajax() parse error, EMPTY ANSWER.");
                    popup_message("Error on server. Please try again. <br /> (Err HH_0 parse error)")
                } else {
                    console.log("hh_ajax() parse error, Response was:", jqXHR.responseText);
                    popup_message("Error on server. Please try again. <br /> (Err HH_2 parse error)")
                }
            } else {
                popup_message("The server didn't answer properly. Please try again. <br /> (Err HH_1 " + textStatus + ")")
            }
        },
        fail: function fail(jqXHR, textStatus) {
            console.log("HH fail", params, arguments);
            popup_message("The server didn't answer. Please try again. <br /> (Err HH_3/503 " + textStatus + ")", reload);
            console.log("hh_ajax() error, Response was:", jqXHR.responseText);
            slotsActive = false
        }
    })
}

function hh_ajax_then_reload(params) {
    $("#admin_cheat").append('<p>Please wait... <img src="/images/loading.gif" /></p>');
    hh_ajax(params, reload)
}
$(function() {
    if (is_mobile() && test_ajax_prod_mobile_fuck_503()) mobile_log.consolelog()
});

function test_ajax_prod_mobile_fuck_503() {
    if (Hero.infos.hh_universe.startsWith("dev_h") || Hero.infos.hh_universe == "test_h") return true;
    if (Hero.infos.hh_universe == "hentai" && Hero.infos.id == 555928) return true;
    if (Hero.infos.id == 3) return true;
    return false
}
var Hero = {
    infos: {},
    energies: {},
    energy_fields: {},
    no_glitter: false,
    caracs: ["carac1", "carac2", "carac3", "endurance", "chance", "ego", "damage"],
    updates: function updates(changes, add) {
        if (!changes) return;
        if (changes.level) Hero.no_glitter = true;
        for (var i in changes) {
            Hero.update(i, changes[i], add)
        }
        Hero.no_glitter = false
    },
    updateEnergyField: function updateEnergyField(energy_type, update_field, amount, add) {
        var diff;
        if (add) {
            diff = amount;
            amount += Hero.energies[energy_type][update_field]
        } else {
            diff = amount - Hero.energies[energy_type][update_field]
        }
        if (update_field === "amount") {
            var initial_energy_amount = Hero.energies[energy_type].amount;
            Hero.grow_bar(energy_type, amount);
            Hero.energies[energy_type].amount = amount;
            anim_number($('.energy_counter[type="' + energy_type + '"] span[energy]'), initial_energy_amount, diff);
            HHTimers.updateEnergyTimer(energy_type);
            if (amount >= Hero.energies[energy_type].max_amount) {
                $('plus[type="energy_' + energy_type + '"]').attr("disabled", "disabled");
                if (energy_type === "challenge") {
                    $(".refill-challenge-points").hide();
                    if (hasMultipleLeagueBattles) $(".multiple-battles").show()
                }
            } else {
                $('plus[type="energy_' + energy_type + '"]').removeAttr("disabled")
            }
        } else if (update_field === "max_amount") {
            $('.energy_counter[type="' + energy_type + '"] span[rel="max"]').text(amount)
        }
        Hero.energies[energy_type][update_field] = amount
    },
    update: function update(field, value, add) {
        if (typeof this.energy_fields[field] !== "undefined") {
            var energy_field_data = this.energy_fields[field];
            this.updateEnergyField(energy_field_data.type, energy_field_data.field, value, add);
            return
        }
        var diff, before;
        if ((typeof value === "undefined" ? "undefined" : _typeof(value)) != "object") {
            value = parseInt(value, 10)
        }

        function value_calc(target) {
            var target_carac = target[field];
            if (typeof target_carac == "undefined") {
                target_carac = 0
            }
            if (typeof target_carac !== "number") {
                target_carac = parseInt(target_carac, 10)
            }
            if (add) {
                diff = value;
                value += target_carac
            } else {
                diff = value - target_carac
            }
            before = target_carac;
            target[field] = value
        }
        if ($.inArray(field, Hero.caracs) != -1) {
            value_calc(Hero.infos.caracs);
            if (diff == 0) return;
            var $s = $('[hero="' + field + '"]>span, [hero="' + field + '"]>div[carac]');
            anim_number($s, before, diff);
            return
        }
        if (field != "Xp") {
            value_calc(Hero.infos);
            if (diff == 0) return
        }
        if (["soft_currency", "hard_currency", "xp"].indexOf(field) !== -1) {
            var $s = $('[hero="' + field + '"]');
            anim_number($s, before, diff);
            if (diff > 0 && !Hero.no_glitter) glitter_me(field)
        }
        if (field == "Xp") {
            Hero.infos[field] = value
        }
        if (field == "level") {
            Hero.fill_level_target($('[hero="level"]'));
            if (HHPopupManager.getLastOpenedPopup() == "popup_bunny") {
                HHPopupManager.show("level_up", {
                    show_over: true,
                    quest_energy_amount: diff * 10
                })
            } else {
                HHPopupManager.show("level_up", {
                    quest_energy_amount: diff * 10
                })
            }
            if (Hero.infos.level >= HH_MAX_LEVEL) {
                $('[hero="xp_max"]').html("MAX")
            } else {
                hh_format_number($('[hero="xp_max"]'), Hero.infos.Xp.max)
            }
            this.grow_bar_xp()
        }
        if (field == "xp") {
            Hero.infos.Xp.cur = value;
            Hero.infos.Xp.left = Hero.infos.Xp.max - Hero.infos.Xp.cur;
            this.grow_bar_xp()
        }
        disableButtonIfNotEnoughKobans()
    },
    grow_bar_xp: function grow_bar_xp() {
        var Xp = Hero.infos.Xp;
        var cur_xp = Hero.infos.xp;
        var xxp = (cur_xp - Xp.min) / (Xp.max - Xp.min);
        xxp = .05 + xxp * .95;
        this.grow_bar("xp", xxp)
    },
    grow_bar: function grow_bar(field, value) {
        var width_percent;
        if (field === "xp") {
            width_percent = value * 100
        } else {
            width_percent = value / Hero.energies[field].max_amount * 100
        }
        if (width_percent > 100) {
            width_percent = 100
        }
        $('div[type="' + field + '"] .bar').css("width", width_percent + "%")
    },
    fill_level_target: function fill_level_target($element) {
        $element.text(Hero.infos.level).attr("chars", Hero.infos.level.toString().length)
    },
    validate_energy_type: function validate_energy_type(type) {
        if (hh_prices[type + "_cost_per_minute"]) {
            return true
        }
        console.log("Trying to recharge invalid energy type: " + type);
        return false
    },
    get_recharge_cost: function get_recharge_cost(type) {
        var original = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
        if (!Hero.validate_energy_type(type)) {
            return Number.MAX_VALUE
        }
        var recharge_time = Hero.energies[type].recharge_time;
        if (recharge_time == 0) {
            return 0
        }
        var passed_seconds = Math.floor(Date.now() / 1e3) - server_now_ts;
        var recharge_time_seconds = recharge_time - passed_seconds;
        if (recharge_time_seconds < 0) recharge_time_seconds = 0;
        var cost_type = original ? "original_" + type : type;
        return Math.ceil(recharge_time_seconds * hh_prices[cost_type + "_cost_per_minute"] / 60)
    },
    get_max_recharge_cost: function get_max_recharge_cost(type, max) {
        var original = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
        if (!Hero.validate_energy_type(type)) {
            return Number.MAX_VALUE
        }
        var cost_type = original ? "original_" + type : type;
        var recharge_above_max_cost = Hero.get_recharge_cost(type, original);
        var seconds_above = void 0;
        if (recharge_above_max_cost) {
            seconds_above = (max - Hero.energies[type].max_amount) * Hero.energies[type].seconds_per_point
        } else {
            seconds_above = (max - Hero.energies[type].amount) * Hero.energies[type].seconds_per_point
        }
        recharge_above_max_cost += Math.ceil(seconds_above * hh_prices[cost_type + "_cost_per_minute"] / 60);
        return recharge_above_max_cost
    },
    recharge: function recharge(me, price, type, max, callback) {
        hc_confirm(price, function() {
            $(me).prop("disabled", true);
            var params = {
                class: "Hero",
                action: "recharge",
                type: type,
                max: max
            };
            hh_ajax(params, function(data) {
                Hero.update("energy_" + type, max || Hero.energies[type].max_amount);
                Hero.update("hard_currency", 0 - price, true);
                $(me).prop("disabled", false);
                if (typeof callback == "function") callback()
            })
        })
    }
};

function reload() {
    document.location.replace(document.location.href)
}

function open_class_change() {
    if (location.href.indexOf("tab=profile") > -1) return;
    else if (location.href.indexOf("tab=avatar") > -1) {
        act_tab.changeTab($(".tabs>h4.profile"));
        return
    }
    location.href = "hero/profile.html?edit&tab=profile"
}
var Collect = {
    cost: null,
    open: function open(b) {
        $("#collect_all_container>*").toggle(!b);
        $("#collect_all_container>#collect_all").toggle(b)
    },
    check_state: function check_state() {
        var girlsMap = GirlSalaryManager.girlsMap;
        var sum = 0,
            nb = 0;
        for (var i in girlsMap) {
            if (girlsMap[i].gData.pay_in <= 0) {
                nb++;
                sum += girlsMap[i].gData.salary
            }
        }
        this.open(nb > 0);
        hh_format_number($('#collect_all [rel="next_salary"]'), sum)
    },
    run_all: function run_all(event, mc) {
        var where = $("#homepage").length ? "home" : "harem";
        if (where == "harem") Collect.open(false);
        var params = {
            class: "Girl",
            action: "get_all_salaries",
            where: where
        };
        params["mc"] = Collect.cost == 0;
        hh_ajax(params, function(data) {
            if (where == "harem") {
                for (var i in girls) {
                    var girlInfo = girls[i];
                    if (girlInfo.gData.pay_in > 0) continue;
                    girlInfo.resetSalary()
                }
            } else {
                var $button = $("#collect_all");
                $button.hide();
                $button.find(".sum").attr("amount", "0").text("0");
                var ownedGirls = {};
                for (var girlId in data.girls) {
                    ownedGirls[girlId] = new Girl(data.girls[girlId])
                }
                GirlSalaryManager.init(ownedGirls, true)
            }
            Hero.update("hard_currency", 0 - Collect.cost, true);
            Hero.update("soft_currency", data.money, true);
            Collect.changeDisableBtnState(false)
        })
    },
    init: function init(event) {
        Collect.cost = parseInt($("#collect_all_container").attr("cost"));
        if (!$("#homepage").length) this.check_state();
        $("#collect_all").click(function() {
            if (is_cheat_click(arguments[0])) return false;
            Collect.changeDisableBtnState(true);
            $(this).blur();
            $("body").on("escape_pressed_event", function() {
                Collect.changeDisableBtnState(false)
            });
            if (Collect.cost) {
                hc_confirm(Collect.cost, function() {
                    Collect.run_all()
                }, function() {
                    Collect.changeDisableBtnState(false)
                })
            } else Collect.run_all()
        })
    },
    changeDisableBtnState: function changeDisableBtnState(state) {
        $("#collect_all").prop("disabled", state)
    }
};
$(function() {
    var scElement = $('#contains_all header div[hero="soft_currency"]');
    hh_format_number(scElement, Hero.infos.soft_currency)
});

function hh_format_number(tag, number, decimals) {
    if (!decimals) number = Math.round(number);
    var $tag = $(tag);
    var format = number_format_lang;
    if ($tag.attr("hero") == "soft_currency") {
        if (number > 1e6) format = number_reduce
    } else if ($tag.attr("hero") == "xp" || $tag.attr("hero") == "xp_max") format = number_reduce;
    $tag.text(format(number))
}
var swipeHandler = function() {
    function swipeHandler(callback) {
        var _this2 = this;
        _classCallCheck(this, swipeHandler);
        this.callback = callback;
        this.xDown = null;
        this.yDown = null;
        document.addEventListener("touchstart", function() {
            _this2.handleTouchStart(event)
        }, false);
        document.addEventListener("touchmove", function() {
            _this2.handleTouchMove(event)
        }, false)
    }
    _createClass(swipeHandler, [{
        key: "handleTouchStart",
        value: function handleTouchStart(event) {
            this.xDown = event.touches[0].clientX;
            this.yDown = event.touches[0].clientY
        }
    }, {
        key: "handleTouchMove",
        value: function handleTouchMove(event) {
            if (!this.xDown || !this.yDown) return;
            var xDiff = this.xDown - event.touches[0].clientX;
            var yDiff = this.yDown - event.touches[0].clientY;
            if (Math.abs(xDiff) > 10 && Math.abs(xDiff) > 5 * Math.abs(yDiff)) {
                if (xDiff > 0) this.callback("left");
                else this.callback("right")
            }
            this.xDown = null;
            this.yDown = null
        }
    }]);
    return swipeHandler
}();

function is_mobile_size() {
    return $(window).width() <= 1025
}

function detectIE() {
    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE ");
    if (msie > 0) {
        return parseInt(ua.substring(msie + 5, ua.indexOf(".", msie)), 10)
    }
    var trident = ua.indexOf("Trident/");
    if (trident > 0) {
        var rv = ua.indexOf("rv:");
        return parseInt(ua.substring(rv + 3, ua.indexOf(".", rv)), 10)
    }
    var edge = ua.indexOf("Edge/");
    if (edge > 0) {
        return parseInt(ua.substring(edge + 5, ua.indexOf(".", edge)), 10)
    }
    return false
}

function detectBrowser() {
    var ua = window.navigator.userAgent;
    var sBrowser = null;
    if (ua.indexOf("Firefox") > -1) {
        sBrowser = "Firefox"
    } else if (ua.indexOf("SamsungBrowser") > -1) {
        sBrowser = "Samsung"
    } else if (ua.indexOf("Opera") > -1 || ua.indexOf("OPR") > -1) {
        sBrowser = "Opera"
    } else if (ua.indexOf("Trident") > -1) {
        sBrowser = "IE"
    } else if (ua.indexOf("Edge") > -1) {
        sBrowser = "Edge"
    } else if (ua.indexOf("Chrome") > -1) {
        sBrowser = "Chrome"
    } else if (ua.indexOf("Safari") > -1) {
        sBrowser = "Safari"
    } else {
        sBrowser = "unknown"
    }
    return sBrowser
}

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
    var results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return "";
    return decodeURIComponent(results[2].replace(/\+/g, " "))
}
var hh_music = function() {
    function hh_music() {
        _classCallCheck(this, hh_music);
        hh_music.getMusicDom();
        return this
    }
    _createClass(hh_music, [{
        key: "play",
        value: function play() {
            var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
            if (hh_nutaku && !hh_nutaku.sp) {
                HH_Nutaku.message_to_nutaku({
                    action: "sound",
                    val: value ? "on" : "off"
                })
            } else {
                var music = hh_music.music;
                if (!music) {
                    return
                }
                if (value) {
                    if (!(music.currentTime > 0 && !music.paused && !music.ended && music.readyState > 2)) {
                        var promise = music.play();
                        if (promise !== undefined) {
                            promise.catch(function(error) {})
                        }
                    }
                } else {
                    music.pause()
                }
            }
        }
    }], [{
        key: "handler",
        value: function handler() {
            if (!hh_music.instance) hh_music.instance = new hh_music;
            return hh_music.instance
        }
    }, {
        key: "getMusicDom",
        value: function getMusicDom() {
            if (window.parent == window) return null;
            if (!hh_music.music) {
                try {
                    hh_music.music = hh_music.makeMusicDom(window.parent.document)
                } catch (err) {
                    return null
                }
            }
            return hh_music.music
        }
    }, {
        key: "makeMusicDom",
        value: function makeMusicDom(doc) {
            var node = doc.getElementById("hh_bg_music");
            if (node) return node;
            var html = '<audio id="hh_bg_music" loop="true" volume="0.7">' + '<source src="' + IMAGES_URL + '/pictures/audio/bg_music_2.ogg" type="audio/ogg">' + '<source src="' + IMAGES_URL + '/pictures/audio/bg_music_2.mp3" type="audio/mpeg">' + "</audio>";
            var wrapper = doc.createElement("div");
            wrapper.innerHTML = html;
            doc.body.appendChild(wrapper);
            return doc.getElementById("hh_bg_music")
        }
    }]);
    return hh_music
}();

function create_scroll_checker($scrollbar_holder) {
    if (!$scrollbar_holder.getNiceScroll()[0]) return;
    var scroll = $scrollbar_holder.getNiceScroll()[0];
    var is_scrollable = $scrollbar_holder.height() == scroll.getContentSize().h;
    if (is_scrollable) $scrollbar_holder.addClass("bottom");
    check_scroll_position($scrollbar_holder, scroll);
    scroll.scrollend(function() {
        check_scroll_position($scrollbar_holder, scroll)
    })
}

function check_scroll_position($scrollbar_holder, scroll) {
    var max_scroll_height = scroll.getContentSize().h - $scrollbar_holder.height();
    var scroll_top = scroll.getScrollTop();
    var bottom_possible_height = max_scroll_height === scroll_top;
    var top_possible = scroll_top > 0;
    if (bottom_possible_height) {
        $scrollbar_holder.addClass("bottom")
    } else {
        $scrollbar_holder.removeClass("bottom")
    }
}

function calculateTime(current, end) {
    var secondsPerDay = 86400;
    var secondsPerHour = 3600;
    var secondsPerMinute = 60;
    var currentDate = current ? new Date(current) : Date.now();
    var endDate = new Date(end);
    var remainingTime = (endDate - currentDate) / 1e3;
    var result = {
        daysLeft: 0,
        hoursLeft: 0,
        minutesLeft: 0,
        secondsLeft: 0,
        decimalDaysLeft: 0
    };
    if (remainingTime < 0) return result;
    result.daysLeft = Math.floor(remainingTime / secondsPerDay);
    remainingTime -= result.daysLeft * secondsPerDay;
    result.hoursLeft = Math.floor(remainingTime / secondsPerHour);
    remainingTime -= result.hoursLeft * secondsPerHour;
    result.minutesLeft = Math.floor(remainingTime / secondsPerMinute);
    remainingTime -= result.minutesLeft * secondsPerMinute;
    result.secondsLeft = remainingTime;
    result.decimalDaysLeft = result.daysLeft + result.hoursLeft / 24 + result.minutesLeft / 1440 + result.secondsLeft / secondsPerDay;
    return result
}

function is_cheat_click(e) {
    function is_cheater(e) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        return true
    }
    var items = ["offset", "page", "screen", "client"],
        ne = 0,
        i;
    for (i in items) {
        if (items[i] + "X" in e && items[i] + "Y" in e) {
            if (0 === e[items[i] + "X"] && 0 === e[items[i] + "Y"]) {
                return is_cheater(e)
            }
        } else {
            ++ne
        }
    }
    return items.length === ne ? is_cheater(e) : false
}
var hh_app;
$(function() {
    if (location.href.indexOf("payment_redirect") > -1) {
        displayPendingRewards(true)
    }
    if (location.href.indexOf("payment") > -1) displayPendingRewards();
    hh_app = localStorageGetItem("inApp");
    if (localStorageGetItem("season_reset")) {
        SeasonsFunc.show_season_end_popup(JSON.parse(localStorageGetItem("season_reset")));
        getLocalStorage().removeItem("season_reset")
    }
    if (typeof FullScreen.is_iOSMobile == "function" && FullScreen.is_iOSMobile()) {
        $('[hide-for="iosMobile"]').hide()
    }
    Hero["c"] = {};
    $(".energy_counter").each(function() {
        var type = $(this).attr("type");
        if (Hero.energies[type].amount < Hero.energies[type].max_amount) {
            Hero["c"][type] = HHTimers.initEnergyTimer($(this));
            $(this).find("plus").removeAttr("disabled")
        } else {
            $(this).find('span[rel="count_txt"]').hide();
            $(this).find("plus").attr("disabled", "disabled")
        }
    });
    Hero.grow_bar("quest", Hero.energies.quest.amount);
    Hero.grow_bar("fight", Hero.energies.fight.amount);
    Hero.grow_bar_xp();
    if (is_mobile_size() && $(window).width() < $(window).height()) $(".rotate_device, .app_redirect").show();
    $("#btn_fullscreen").click(FullScreen.click);
    $(".currency plus").click(function() {
        if (Hero.infos.guest) {
            if (!hh_nutaku) PhoenixLogin.openEggsForm("register");
            else HHPopupManager.show("nutaku_guest_register")
        } else HHPopupManager.show("no_HC", {
            init_load: true,
            prevent_events: true
        })
    });
    appear_anim.appear_all();
    Collect.init();
    $("body").on("click", "#no_HC .purchase_box button", function() {
        var $button = $(this);
        if ($button.hasClass("crypto_purchase_box")) return;
        if ($button.hasClass("claim-first-purchase-gift")) {
            handleFirstPurchaseAction($button.attr("product"), $button.attr("kobans"), $button);
            return
        }
        var attr = "";
        if ($("h4.monthly_card").hasClass("active")) attr = "monthly_card";
        else attr = $button.attr("bg");
        if ($button.hasClass("auto-renew")) {
            var options = {
                show_over: true,
                confirm: {
                    title: "",
                    body: "" + GT.design.confirm_cancellation
                }
            };
            $button.prop("disabled", true);
            HHPopupManager.show("confirmation_popup", options, hh_cancel_subscription);
            $("#confirmation_popup button").click(function() {
                $button.prop("disabled", false)
            })
        } else hh_click_hc_button($button.attr("product"), $button.html(), $button.attr("kobans"), $button, attr)
    });

    function handleFirstPurchaseAction(product, kobans, $btn) {
        $btn.prop("disabled", true);
        var pathname = prepareCurrentPathURL();
        var params = {
            class: "Payment",
            id_product: product,
            nb: kobans,
            url_back: pathname
        };
        loadingAnimation.start($("#no_HC"));
        hh_ajax(params, function(data) {
            loadingAnimation.stop();
            document.location = "/home.html?payment=0"
        })
    }
    if (GT) {
        var add_carac_title = function add_carac_title(attr, text, no_parent) {
            $('[carac="' + attr + '"]').each(function() {
                var $element = $(this);
                if (empty($element.text()) && !no_parent) $element = $element.parent();
                var isArena = $element.hasClass("opponents_ico") || $element.hasClass("reversed_tooltip");
                var isBattle = $element.parent().hasClass("battle-faces");
                var isChampion = $element.hasClass("girl-box__draggable");
                var isChangeTeam = $element.hasClass("girl-in");
                var isLeaderboard = $element.hasClass("lead_player_profile") || $element.hasClass("reversed_tooltip");
                var isShop = $element.attr("id") == "girls_list" || $element.hasClass("icon");
                var isHarem = $element.hasClass("left");
                var isHaremdexFilter = $element.siblings().hasClass("checkbox-group");
                var isTooltip = $(this)[0].hasAttribute("hh_class_tooltip");
                if (isArena || isBattle || isChampion || isChangeTeam || isTooltip || isLeaderboard || isShop || isHarem || isHaremdexFilter) {
                    return
                }
                $element.attr("hh_title", text)
            })
        };
        add_carac_title("1", GT.caracs[1]);
        add_carac_title("2", GT.caracs[2]);
        add_carac_title("3", GT.caracs[3]);
        add_carac_title("carac1", GT.caracs[1]);
        add_carac_title("carac2", GT.caracs[2]);
        add_carac_title("carac3", GT.caracs[3]);
        add_carac_title("class1", GT.classes[1], true);
        add_carac_title("class2", GT.classes[2], true);
        add_carac_title("class3", GT.classes[3], true);
        add_carac_title("ego", GT.ego);
        add_carac_title("endurance", GT.endurance);
        add_carac_title("chance", GT.chance);
        add_carac_title("excit", GT.excit)
    }
    $("a.sound, button.sound").click(function() {
        var $me = $(this);
        var val = $me.attr("rel") == "on" ? "off" : "on";
        hh_music.handler().play(val == "on");
        hh_ajax({
            class: "Hero",
            action: "sound"
        }, function(data) {
            Hero.infos.nosound = data.nosound;
            $me.attr("rel", val)
        })
    });
    if ($("button.sound").attr("rel") == "on" || !Hero.infos.nosound) {
        hh_music.handler().play(true)
    }
    $("a.forum_link").click(function(event) {
        event.preventDefault();
        hh_ajax({
            class: "Hero",
            action: "forum_cookie"
        });
        var url = $(this).attr("href");
        window.open(url, "_blank")
    });
    $("#harem_whole, .harem_page").on("click", ".change>.skin, .diamond-bar .diamond", function() {
        var $me = $(this);
        if ($me.attr("disabled") || $me.hasClass("locked")) return;
        if ($me.attr("checked") || $me.hasClass("selected")) return;
        var isHaremPage = $("#harem_whole").length;
        if (isHaremPage) {
            $me.siblings(".unlocked").removeClass("selected");
            $me.addClass("selected")
        } else {
            $me.siblings(".skin").removeAttr("checked");
            $me.attr("checked", "checked")
        }
        var grade = parseInt($me.attr("grade"));
        var check_only = void 0,
            id_girl = void 0;
        if (isHaremPage) {
            id_girl = $me.parent().closest("div[girl]").attr("girl");
            check_only = 0;
            girlsDataList[id_girl].fav_graded = grade
        } else if ($(".harem_page").length) {
            id_girl = $me.closest(".box").attr("id_girl");
            check_only = 1
        }
        hh_ajax({
            class: "Hero",
            action: "show_specific_girl_grade",
            id_girl: id_girl,
            girl_grade: grade,
            check_only: check_only
        }, function(data) {
            var avatar = void 0,
                leftAvatar = void 0;
            if (isHaremPage) {
                avatar = $("#harem_right .opened img.avatar");
                leftAvatar = $("#harem_left .opened img")
            } else if ($(".harem_page").length) {
                avatar = $(".harem_page").find('.box[id_girl="' + id_girl + '"]>img')
            }
            if (avatar) {
                avatar.attr("src", data.ava.toImageUrl("ava"));
                if (isHaremPage) girlsDataList[id_girl].avatar = data.ava
            }
            if (leftAvatar) {
                leftAvatar.attr("src", data.ico.toImageUrl("ico"));
                girlsDataList[id_girl].ico = data.ico
            }
        })
    })
});
$(function() {
    if (!hh_nutaku) return;
    $('[rel="nutaku_guest_register"]').on("click", function() {
        HHPopupManager.show("nutaku_guest_register")
    });
    if (hh_nutaku.sp) {} else {
        window.addEventListener("message", HH_Nutaku.game_event_listener)
    }
});
$(function() {
    if (typeof hh_eroges == "undefined" || !hh_eroges) return;
    window.addEventListener("message", hh_eroges.game_event_listener)
});

function hh_register() {
    if (hh_nutaku) HHPopupManager.show("nutaku_guest_register");
    else PhoenixLogin.openEggsForm("register")
}

function findSessionID() {
    var cookies = window.document.cookies;
    var sessionName = "";
    for (var cookieName in cookies) {
        if (cookieName.indexOf("HH_SESS_") == 0) {
            if (!sessionName) {
                sessionName = cookieName
            } else {
                var sessnum = parseInt(sessionName.replace("HH_SESS_", ""));
                var cookienum = parseInt(cookieName.replace("HH_SESS_", ""));
                if (cookienum > sessnum) {
                    delete_cookie(sessionName);
                    sessionName = cookieName
                } else {
                    delete_cookie(cookieName)
                }
            }
        }
    }
    return cookies[sessionName]
}

function delete_cookie(name) {
    document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"
}

function clubs_chat_init(msg, ALLOWED_PARENT_TARGET_URL) {
    msg.MEMBER_ID = Hero.infos.id;
    msg.GT = GT.design;
    msg.AUTH_TOKEN = msg.CHAT_TOKEN;
    msg.msgtype = "chat_init";
    window.parent.postMessage(msg, ALLOWED_PARENT_TARGET_URL);
    $("a#chat_btn").on("click", function() {
        if (hh_app || hh_nutaku && is_mobile()) {
            popup_message(GT.design.chat_unavailable);
            return
        }
        window.parent.postMessage({
            msgtype: "toggleWindow"
        }, ALLOWED_PARENT_TARGET_URL);
        $("img.new_notif.chat_btn_notif").hide();
        if (window.self == window.top) {
            var option = {
                confirm: {
                    title: GT.design.chatfix_message_title,
                    body: GT.design.chatfix_message
                }
            };
            HHPopupManager.show("confirmation_popup", option, function() {
                window.location.pathname = "/"
            })
        }
    });
    window.addEventListener("message", function(event) {
        if (event.data.msgtype == "popup_message") {
            popup_message(event.data.msgtext)
        } else if (event.data.msgtype == "redirect") {
            window.location.pathname = event.data.url
        } else if (event.data.msgtype == "chat_notif") {
            $("img.new_notif.chat_btn_notif").show()
        }
    })
}
var _paq = _paq || [];
$(function() {
    var conf = {
        hentai: "2",
        gay: "3",
        nutaku: "4",
        test_h: "5"
    };
    conf = conf[Hero.infos.hh_universe];
    if (!conf) return;
    if (!Hero.infos.on_prod_server) return;
    _paq.push(["setSecureCookie", true]);
    _paq.push(["trackPageView"]);
    _paq.push(["enableLinkTracking"]);
    var u = "//www.statisgeek.com/";
    _paq.push(["setTrackerUrl", u + "piwik.php"]);
    _paq.push(["setSiteId", conf]);
    var g = document.createElement("script"),
        s = document.getElementsByTagName("script")[0];
    g.type = "text/javascript";
    g.async = true;
    g.defer = true;
    g.src = u + "piwik.js";
    s.parentNode.insertBefore(g, s)
});

function getBattlePositionImagePath(position) {
    var positionFilename = "";
    var callerName = "";
    try {
        if (getBattlePositionImagePath.caller) callerName = getBattlePositionImagePath.caller.name
    } catch (err) {
        callerName = "iOS"
    }
    if (isNaN(position)) {
        if (position.length === 0) positionFilename = "emptyNaN" + callerName + ".png";
        else positionFilename = position
    } else {
        if (typeof positionImages[position] === "undefined") positionFilename = "invalidNum" + position + callerName + ".png";
        else positionFilename = positionImages[position]
    }
    return IMAGES_URL + "/pictures/design/battle_positions/" + positionFilename
}
var INDEX_MODES = {
    OVER_INDEX: "OVER_INDEX",
    UNDER_INDEX: "UNDER_INDEX"
};

function find_mojo_progress(_season_tier, _season_mojo_s, _season_tiers) {
    var mojo_progress = 0;
    var mojo_tier_index = find_tier_mojo(_season_mojo_s, _season_tiers);
    if (mojo_tier_index == INDEX_MODES.OVER_INDEX) {
        mojo_progress = 100;
        return {
            text: GT.design.Max + " " + GT.design.season_tier + "!",
            progress: mojo_progress
        }
    } else if (mojo_tier_index == INDEX_MODES.UNDER_INDEX) {
        mojo_progress = get_mojo_progress(season_mojo_s, 0, season_tiers[0].mojo_required);
        return {
            text: season_mojo_s + "/" + season_tiers[0].mojo_required,
            progress: mojo_progress
        }
    } else if (mojo_tier_index >= 0) {
        mojo_progress = get_mojo_progress(season_mojo_s, season_tiers[mojo_tier_index].mojo_required, season_tiers[mojo_tier_index].mojo_next_tier);
        return {
            text: season_mojo_s + "/" + season_tiers[mojo_tier_index].mojo_next_tier,
            progress: mojo_progress
        }
    } else {
        return {
            text: season_mojo_s,
            progress: mojo_progress
        }
    }
}

function find_tier_mojo(mojo, season_tiers) {
    for (var i = 0; i < season_tiers.length; i++) {
        var mojo_required = parseInt(season_tiers[i].mojo_required);
        var mojo_next_tier = parseInt(season_tiers[i].mojo_next_tier);
        if (i == 0) {
            if (mojo < mojo_required) {
                return INDEX_MODES.UNDER_INDEX
            }
        }
        if (mojo >= mojo_required && mojo < mojo_next_tier) {
            return parseInt(season_tiers[i].tier) - 1
        }
    }
    if (mojo > season_tiers[season_tiers.length - 1].mojo_next_tier) {
        return INDEX_MODES.OVER_INDEX
    }
    return null
}

function get_mojo_progress(current_mojo, mojo_required, mojo_next_tier) {
    var mojo_begin = current_mojo - mojo_required;
    var mojo_end = mojo_next_tier - mojo_required;
    var progress_percent = mojo_begin / mojo_end * 100;
    if (progress_percent > 100) {
        progress_percent = 100
    }
    return progress_percent
}
var SITTING_GIRLS_AVATARS_IDS = {
    hh_hentai: ["53", "56", "88", "823452", "1961491", "5186956", "6496077", "98258867", "522806488", "754880300", "3592385", "853057833", "794239543", "861885853"],
    hh_gay: ["823452", "924298645", "389646175", "754880300", "107891324", "980045920"]
};
var OFFSET_GIRLS_AVATARS_IDS = {
    hh_hentai: ["225777755"],
    hh_gay: ["225777755"]
};

function extractGirlIdFromUrl(img_url) {
    return img_url.substring(img_url.indexOf("/girls/") + 7, img_url.lastIndexOf("/"))
}

function isGirlInCollection(girl_id, collection) {
    var skin = $("body").attr("id");
    return $.inArray(girl_id.toString(), collection[skin]) !== -1
}

function calculateResetPrice(remainingTime, cooldownPrice) {
    var divisor = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1200;
    var timeLeft = Math.ceil((remainingTime - server_now_ts) / divisor);
    return cooldownPrice * timeLeft
}

function makePostRedirect(location, params) {
    var form = "";
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;
    try {
        for (var _iterator = params[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var input_data = _step.value;
            form += '<input type="hidden" name="' + input_data.name + '" value="' + input_data.value + '">'
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return()
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError
            }
        }
    }
    $('<form action="' + location + '" method="POST">' + form + "</form>").appendTo($(top.document.body)).submit()
}
var HHMenu = {
    isMenuOpen: false,
    menuTimeout: 0,
    $nav: null,
    $menu: null,
    $coverer: null,
    $pachinkoAnimations: null,
    noSwipe: false,
    toggleMenu: function toggleMenu() {
        var _this = this;
        clearTimeout(this.menuTimeout);
        if (this.isMenuOpen) {
            this.$pachinkoAnimations.css({
                "z-index": "3"
            });
            this.$nav.toggleClass("opened");
            this.$coverer.hide();
            this.menuTimeout = setTimeout(function() {
                _this.$menu.hide()
            }, 1e3)
        } else {
            this.$pachinkoAnimations.css({
                "z-index": "1"
            });
            this.$coverer.show();
            this.$menu.show();
            this.menuTimeout = setTimeout(function() {
                _this.$nav.toggleClass("opened")
            }, 10)
        }
        this.isMenuOpen = !this.isMenuOpen
    },
    init: function init() {
        var _this2 = this;
        this.$nav = $("#contains_all nav");
        this.$menu = $('nav>[rel="content"]');
        this.$coverer = $('<div id="nav_coverer"></div>');
        this.$pachinkoAnimations = $("#content-unscaled");
        this.$coverer.appendTo("#contains_all");
        this.$nav.children('[rel="open"]').on("click", function() {
            _this2.toggleMenu()
        });
        this.$nav.children("#language").on("click", function() {
            _this2.toggleMenu()
        });
        this.noSwipe = typeof event_data != "undefined" && event_data.girls.length > 6;
        if (!this.noSwipe) {
            new swipeHandler(function(direction) {
                if (_this2.isMenuOpen && direction == "right" || !_this2.isMenuOpen && direction == "left") _this2.toggleMenu()
            })
        }
        this.$nav.find('[rel="helper"]').on("click", function() {
            _this2.toggleMenu()
        });
        this.$coverer.on("click", function() {
            _this2.toggleMenu()
        })
    }
};
$(function() {
    HHMenu.init()
});
var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);
    if (desc === undefined) {
        var parent = Object.getPrototypeOf(object);
        if (parent === null) {
            return undefined
        } else {
            return get(parent, property, receiver)
        }
    } else if ("value" in desc) {
        return desc.value
    } else {
        var getter = desc.get;
        if (getter === undefined) {
            return undefined
        }
        return getter.call(receiver)
    }
};
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass)
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}

function format_time_short(seconds) {
    var secondsPerMinute = 60;
    var secondsPerHour = 3600;
    var secondsPerDay = 86400;
    var txt = "";
    seconds = Math.round(seconds);
    if (seconds < secondsPerHour && seconds % secondsPerMinute != 0) {
        var _minutes = Math.floor(seconds / secondsPerMinute);
        if (_minutes) {
            txt += _minutes + GT.time.m;
            txt += " ";
            seconds -= _minutes * secondsPerMinute
        }
        txt += seconds < 10 ? "0" + seconds : seconds;
        return txt + GT.time.s
    }
    var days = Math.floor(seconds / secondsPerDay);
    if (days) {
        txt += days + GT.time.d;
        seconds -= days * secondsPerDay
    }
    var hours = Math.floor(seconds / secondsPerHour);
    if (hours) {
        if (days) txt += " ";
        txt += hours + GT.time.h;
        seconds -= hours * secondsPerHour
    }
    var minutes = Math.floor(seconds / secondsPerMinute);
    if (minutes) {
        if (hours) txt += " ";
        txt += minutes + GT.time.m
    }
    return txt
}
var HHTimer = function() {
    function HHTimer($elm) {
        _classCallCheck(this, HHTimer);
        this.$elm = $elm;
        this.onDestroy = null;
        this.id = 0;
        this.isForRemoval = false
    }
    _createClass(HHTimer, [{
        key: "destroy",
        value: function destroy() {
            if (this.onDestroy) this.onDestroy();
            for (var key in this) {
                delete this[key]
            }
        }
    }]);
    return HHTimer
}();
var HHSimpleTimer = function(_HHTimer) {
    _inherits(HHSimpleTimer, _HHTimer);

    function HHSimpleTimer($elm, time, callback, updateCallback) {
        _classCallCheck(this, HHSimpleTimer);
        var _this = _possibleConstructorReturn(this, (HHSimpleTimer.__proto__ || Object.getPrototypeOf(HHSimpleTimer)).call(this, $elm));
        _this.remainingTime = time;
        _this.onComplete = callback;
        _this.updateCallback = updateCallback;
        _this.mobilePrependTxt = undefined;
        if (_this.$elm) _this.update();
        return _this
    }
    _createClass(HHSimpleTimer, [{
        key: "update",
        value: function update() {
            this.$elm.html(this.generateTimerText());
            if (typeof this.updateCallback == "function") this.updateCallback();
            if (this.remainingTime <= 0) {
                if (this.onComplete) this.onComplete();
                this.destroy()
            }
        }
    }, {
        key: "generateTimerText",
        value: function generateTimerText() {
            var timeTxt = format_time_short(this.remainingTime);
            return this.mobilePrependTxt && is_mobile_size() ? this.mobilePrependTxt + timeTxt : timeTxt
        }
    }]);
    return HHSimpleTimer
}(HHTimer);
var HHBarTimer = function(_HHTimer2) {
    _inherits(HHBarTimer, _HHTimer2);

    function HHBarTimer(totalTime, remaining, $elm, bars, callback, options) {
        _classCallCheck(this, HHBarTimer);
        var _this2 = _possibleConstructorReturn(this, (HHBarTimer.__proto__ || Object.getPrototypeOf(HHBarTimer)).call(this, $elm));
        _this2.totalTime = totalTime - 0;
        _this2.remainingTime = remaining ? remaining - 0 : _this2.totalTime;
        _this2.$barElm = bars ? bars.barElm : _this2.$elm.find(".frontbar");
        _this2.$textElm = bars ? bars.textElm : _this2.$elm.find("div.text>span");
        _this2.lastUpdatedTxt = null;
        _this2.onComplete = callback;
        _this2.options = options || {};
        _this2.onUpdate = _this2.options.onUpdate ? _this2.options.onUpdate : null;
        _this2.$elm.show();
        _this2.update();
        return _this2
    }
    _createClass(HHBarTimer, [{
        key: "updateBar",
        value: function updateBar() {
            var pc = (this.totalTime - this.remainingTime) / this.totalTime * 100;
            if (this.options.reverse) pc = 100 - pc;
            this.$barElm.css("width", pc + "%")
        }
    }, {
        key: "update",
        value: function update() {
            this.updateBar();
            var newTime = format_time_short(this.remainingTime);
            if (this.lastUpdatedTxt != newTime) this.$textElm.html(newTime);
            this.lastUpdatedTxt = newTime;
            if (this.onUpdate) this.onUpdate(this);
            if (this.remainingTime <= 0) {
                if (this.onComplete) this.onComplete(this);
                if (this.$elm) this.$elm.hide();
                this.destroy()
            }
        }
    }]);
    return HHBarTimer
}(HHTimer);
var HHEnergyTimer = function(_HHTimer3) {
    _inherits(HHEnergyTimer, _HHTimer3);

    function HHEnergyTimer($elm) {
        _classCallCheck(this, HHEnergyTimer);
        var _this3 = _possibleConstructorReturn(this, (HHEnergyTimer.__proto__ || Object.getPrototypeOf(HHEnergyTimer)).call(this, $elm));
        _this3.type = _this3.$elm.attr("type");
        _this3.timeForOnePoint = parseInt(_this3.$elm.find("span[timeForSinglePoint]").attr("timeForSinglePoint"));
        _this3.remainingTime = parseInt(_this3.$elm.find("span[timeOnLoad]").attr("timeOnLoad"));
        _this3.$timeCounter = _this3.$elm.find('span[rel="count"]');
        _this3.$currentEnergy = _this3.$elm.find("span[energy]");
        _this3.$elm.find('span[rel="count_txt"]').show();
        _this3.onDestroy = function() {
            _this3.$elm.find('span[rel="count_txt"]').hide();
            if (_this3.isChallengeEnergy) {
                $(".refill-challenge-points").hide();
                if (hasMultipleLeagueBattles) $(".multiple-battles").show()
            }
        };
        _this3.update();
        return _this3
    }
    _createClass(HHEnergyTimer, [{
        key: "update",
        value: function update() {
            this.updateText();
            this.isChallengeEnergy = this.type === "challenge";
            if (this.isChallengeEnergy) {
                $(".refill-challenge-points").attr("price", Hero.get_recharge_cost("challenge"));
                $(".refill-challenge-points span").first().text(Hero.get_recharge_cost("challenge"));
                disableButtonIfNotEnoughKobans()
            }
            if (this.remainingTime <= 0) {
                Hero.energies[this.type].amount++;
                Hero.grow_bar(this.type, Hero.energies[this.type].amount);
                this.$currentEnergy.text(Hero.energies[this.type].amount);
                if (Hero.energies[this.type].amount == Hero.energies[this.type].max_amount) {
                    this.destroy()
                } else {
                    this.remainingTime = this.timeForOnePoint;
                    this.updateText()
                }
            }
        }
    }, {
        key: "updateText",
        value: function updateText() {
            this.$timeCounter.html(format_time_short(this.remainingTime))
        }
    }, {
        key: "getTotalRemainingTime",
        value: function getTotalRemainingTime() {
            var pointsToFill = Hero.energies[this.type].max_amount - Hero.energies[this.type].amount;
            if (pointsToFill == 0) return 0;
            return (pointsToFill - 1) * this.timeForOnePoint + this.remainingTime
        }
    }, {
        key: "destroy",
        value: function destroy() {
            _get(HHEnergyTimer.prototype.__proto__ || Object.getPrototypeOf(HHEnergyTimer.prototype), "destroy", this).call(this);
            delete Hero.c[this.type]
        }
    }]);
    return HHEnergyTimer
}(HHTimer);
var HHTimers = {
    timersListMin: [],
    timersListTenSec: [],
    timersListSec: [],
    thresholdTenSec: 500,
    thresholdSec: 150,
    updateMinInterval: 0,
    updateTenSecInterval: 0,
    updateSecInterval: 0,
    isMinRunning: false,
    isTenSecRunning: false,
    isSecRunning: false,
    timers: {},
    tiers: ["second", "tenSeconds", "minute"],
    timerMapping: {
        second: {
            list: "timersListSec",
            interval: "updateSecInterval",
            isRunning: "isSecRunning",
            timerThreshold: "thresholdSec",
            threshold: 1e3
        },
        tenSeconds: {
            list: "timersListTenSec",
            interval: "updateTenSecInterval",
            isRunning: "isTenSecRunning",
            timerThreshold: "thresholdTenSec",
            lowerTimerTier: "second",
            threshold: 1e4
        },
        minute: {
            list: "timersListMin",
            interval: "updateMinInterval",
            isRunning: "isMinRunning",
            lowerTimerTier: "tenSeconds",
            threshold: 6e4
        }
    },
    timerIDcounter: 0,
    DEBUG: false,
    initDecTimer: function initDecTimer($elm, time, callback, updateCallback) {
        var newTimer = new HHSimpleTimer($elm, time, callback, updateCallback);
        this.addNewTimer(newTimer);
        return newTimer.id
    },
    initBarTimer: function initBarTimer(totalTime, remaining, $main, bars, callback, options) {
        var newTimer = new HHBarTimer(totalTime, remaining, $main, bars, callback, options);
        this.addNewTimer(newTimer);
        return newTimer
    },
    initEnergyTimer: function initEnergyTimer($elm) {
        var newTimer = new HHEnergyTimer($elm);
        this.addNewTimer(newTimer);
        return newTimer
    },
    initSimpleTimerTxt: function initSimpleTimerTxt($elm, time, callback, txt) {
        var newTimer = new HHSimpleTimer($elm, time, callback);
        newTimer.mobilePrependTxt = txt;
        newTimer.update();
        this.addNewTimer(newTimer);
        return newTimer.id
    },
    updateEnergyTimer: function updateEnergyTimer(type) {
        if (Hero.energies[type].amount >= Hero.energies[type].max_amount) {
            if (Hero.c[type] != undefined) {
                $('.energy_counter[type="' + type + '"] span[rel="count_txt"]').hide();
                this.stopTimer(Hero.c[type].id);
                delete Hero.c[type]
            }
        } else {
            if (Hero.c[type] == undefined) {
                var $timerContainer = $('.energy_counter[type="' + type + '"]');
                var timeForOnePoint = $timerContainer.find("span[timeForSinglePoint]").attr("timeForSinglePoint");
                $timerContainer.find("span[timeOnLoad]").attr("timeOnLoad", timeForOnePoint);
                Hero.c[type] = this.initEnergyTimer($timerContainer)
            }
        }
    },
    addNewTimer: function addNewTimer(newTimer) {
        newTimer.id = this.timerIDcounter++;
        this.timers[newTimer.id] = newTimer;
        var originalOnDestroy = newTimer.onDestroy;
        newTimer.onDestroy = function() {
            if (originalOnDestroy) originalOnDestroy();
            $.proxy(HHTimers.onTimerDestroy, HHTimers)
        };
        if (newTimer.options && newTimer.options.threshold) newTimer.forceThreshold = newTimer.options.threshold;
        if (newTimer.remainingTime < this.thresholdSec || newTimer.forceThreshold == "second") this.timersListSec.push(newTimer);
        else if (newTimer.remainingTime < this.thresholdTenSec || newTimer.forceThreshold == "tenSeconds") this.timersListTenSec.push(newTimer);
        else this.timersListMin.push(newTimer);
        if (!this.isMinRunning && this.timersListMin.length > 0) this.initTimer("minute");
        if (!this.isTenSecRunning && this.timersListTenSec.length > 0) this.initTimer("tenSeconds");
        if (!this.isSecRunning && this.timersListSec.length > 0) this.initTimer("second")
    },
    stopTimer: function stopTimer(timerId) {
        var timerToStop = this.timers[timerId];
        if (timerToStop != undefined) timerToStop.isForRemoval = true;
        delete this.timers[timerId]
    },
    onTimerDestroy: function onTimerDestroy(timer) {
        delete this.timers[timer.id]
    },
    initTimer: function initTimer(type) {
        var _this4 = this;
        if (HHTimers.DEBUG) console.log(type + " timer is initiated");
        if (this.tiers.indexOf(type) == -1) {
            console.log("Unsupported type of Timer: " + type);
            return
        }
        var mapping = this.timerMapping[type];
        this[mapping.isRunning] = true;
        this[mapping.interval] = setInterval(function() {
            _this4.updateTimer(type)
        }, mapping.threshold)
    },
    clearTimer: function clearTimer(type) {
        var mapping = this.timerMapping[type];
        clearInterval(this[mapping.interval]);
        this[mapping.isRunning] = false
    },
    updateTimer: function updateTimer(type) {
        var _this5 = this;
        if (HHTimers.DEBUG) console.log("update " + type);
        var newList = [];
        var mapping = this.timerMapping[type];
        var originalList = this[mapping.list];
        var lowerTimerTier = this.timerMapping[mapping.lowerTimerTier];
        var lowerTimerThreshold = void 0,
            lowerTimerList = void 0;
        if (lowerTimerTier) {
            lowerTimerThreshold = this[lowerTimerTier.timerThreshold];
            lowerTimerList = this[lowerTimerTier.list]
        }
        var _loop = function _loop(i, length) {
            var timer = originalList[i];
            if (timer.remainingTime > 0 && !timer.isForRemoval) {
                timer.remainingTime -= mapping.threshold / 1e3;
                if (lowerTimerTier) {
                    if (timer.remainingTime < lowerTimerThreshold) _this5[lowerTimerTier.list].push(timer);
                    else if (timer.remainingTime >= lowerTimerThreshold) newList.push(timer)
                } else {
                    var currentTier = function currentTier(i) {
                        return _this5.timerMapping[_this5.tiers[i]]
                    };
                    var isInThreshold = function isInThreshold(i) {
                        return timer.remainingTime < _this5[currentTier(i).timerThreshold]
                    };
                    if (isInThreshold(0) || timer.forceThreshold == _this5.tiers[0]) newList.push(timer);
                    else if (isInThreshold(1) || timer.forceThreshold == _this5.tiers[1]) {
                        _this5[currentTier(1).list].push(timer);
                        if (!_this5[currentTier(1).isRunning]) _this5.initTimer(_this5.tiers[1])
                    } else {
                        var lastPossibleTier = _this5.tiers.length - 1;
                        _this5[currentTier(lastPossibleTier).list].push(timer);
                        if (!_this5[currentTier(lastPossibleTier).isRunning]) _this5.initTimer(_this5.tiers[lastPossibleTier])
                    }
                }
                timer.update()
            }
        };
        for (var i = 0, length = originalList.length; i < length; i++) {
            _loop(i, length)
        }
        this[mapping.list] = newList;
        if (this[mapping.list].length == 0) this.clearTimer(type);
        if (lowerTimerTier && !this[lowerTimerTier.isRunning] && lowerTimerList.length > 0) this.initTimer(mapping.lowerTimerTier)
    }
};
var _slicedToArray = function() {
    function sliceIterator(arr, i) {
        var _arr = [];
        var _n = true;
        var _d = false;
        var _e = undefined;
        try {
            for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
                _arr.push(_s.value);
                if (i && _arr.length === i) break
            }
        } catch (err) {
            _d = true;
            _e = err
        } finally {
            try {
                if (!_n && _i["return"]) _i["return"]()
            } finally {
                if (_d) throw _e
            }
        }
        return _arr
    }
    return function(arr, i) {
        if (Array.isArray(arr)) {
            return arr
        } else if (Symbol.iterator in Object(arr)) {
            return sliceIterator(arr, i)
        } else {
            throw new TypeError("Invalid attempt to destructure non-iterable instance")
        }
    }
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var PartSiteHider = function() {
    function PartSiteHider() {
        _classCallCheck(this, PartSiteHider);
        $("#part_site_hider").remove();
        this._isMobile = is_mobile_size();
        this._questWidth = 858;
        this._topBarHeight = this._isMobile ? 80 : 50;
        var $part_site_hider = $('<div id="part_site_hider"></div>');
        this._$menu = $('<section rel="menu"></section>').css({
            position: "absolute",
            width: this._questWidth + "px",
            "margin-left": this._px(-this._questWidth / 2),
            left: "50%",
            top: "0"
        }).appendTo($part_site_hider);
        this._$whole = $('<section rel="whole"></section>').appendTo($part_site_hider);
        $part_site_hider.appendTo($("#contains_all"))
    }
    _createClass(PartSiteHider, [{
        key: "tutorial",
        value: function tutorial(_ref) {
            var _ref2 = _slicedToArray(_ref, 6),
                left = _ref2[0],
                top = _ref2[1],
                width = _ref2[2],
                height = _ref2[3],
                circle = _ref2[4],
                clickable = _ref2[5];
            this._addDiv({
                left: this._px(left - 1),
                top: "0",
                width: "300%",
                height: this._px(top),
                "pointer-events": "auto"
            }, this._$whole);
            this._addDiv({
                left: this._px(left + width),
                top: "0",
                width: "300%",
                height: "300%",
                "pointer-events": "auto"
            }, this._$whole);
            this._addDiv({
                left: this._px(left - 1),
                top: this._px(top + height),
                width: this._px(width + 2),
                height: "300%",
                "pointer-events": "auto"
            }, this._$whole);
            this._addDiv({
                top: 0,
                right: this._px(HHCanvasWidth - left),
                width: "300%",
                height: "300%",
                "pointer-events": "auto"
            }, this._$whole);
            if (!circle) {
                this._addDiv({
                    left: this._px(left - 5),
                    top: this._px(top - 5),
                    width: this._px(width + 10),
                    height: this._px(height + 10),
                    background: "none",
                    border: "5px #000 solid",
                    "border-radius": "15px",
                    "pointer-events": "none"
                }, this._$whole)
            } else {
                this._addDiv({
                    left: this._px(left - 60),
                    top: this._px(top - 60),
                    width: this._px(width + 120),
                    height: this._px(height + 120),
                    background: "none",
                    border: "60px solid black",
                    "border-radius": "50%",
                    "pointer-events": "none"
                }, this._$whole)
            }
            if (clickable) $("#part_site_hider").css("pointer-events", "none")
        }
    }, {
        key: "questTutorial",
        value: function questTutorial(show) {
            PartSiteHider.questTutorialShow = show;
            this._drawAroundQuest();
            var parts = {
                left: 124,
                xp: 174,
                energy: 205,
                combat: 200,
                money: 98,
                right: 100
            };
            if (this._isMobile) {
                parts = {
                    left: 140,
                    xp: 150,
                    energy: 177,
                    combat: 173,
                    money: 175,
                    right: 100
                }
            }
            var x = -76;
            for (var part in parts) {
                var width = parts[part];
                var rect = {
                    top: "0",
                    left: this._px(x),
                    width: this._px(width),
                    height: this._px(this._topBarHeight)
                };
                if (show.includes(part)) {
                    rect.background = "radial-gradient(ellipse at center center, transparent 70%, black 80%)";
                    this._addDiv(rect, this._$menu)
                } else {
                    this._addDiv(rect, this._$menu)
                }
                x += width
            }
        }
    }, {
        key: "_px",
        value: function _px(i) {
            return Math.round(i) + "px"
        }
    }, {
        key: "_drawAroundQuest",
        value: function _drawAroundQuest() {
            var height = "1179px";
            this._addDiv({
                "margin-right": this._px((this._questWidth + 152) / 2),
                top: "0",
                left: this._px("-" + HHCanvasWidth),
                right: "50%",
                height: height
            }, this._$whole);
            this._addDiv({
                "margin-left": this._px((this._questWidth - 152) / 2),
                top: "0",
                left: "50%",
                right: this._px("-" + HHCanvasWidth),
                height: height
            }, this._$whole);
            this._addDiv({
                top: "565px",
                left: "0",
                right: "0",
                bottom: "-1500px",
                width: HHCanvasWidth
            }, this._$whole);
            if (!this._isMobile) {
                this._addDiv({
                    top: this._topBarHeight + "px",
                    left: "0",
                    right: "0",
                    height: "30px",
                    width: HHCanvasWidth
                }, this._$whole)
            }
        }
    }, {
        key: "_addDiv",
        value: function _addDiv(css, $elem) {
            $("<div></div>").css(css).appendTo($elem)
        }
    }]);
    return PartSiteHider
}();
var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);
    if (desc === undefined) {
        var parent = Object.getPrototypeOf(object);
        if (parent === null) {
            return undefined
        } else {
            return get(parent, property, receiver)
        }
    } else if ("value" in desc) {
        return desc.value
    } else {
        var getter = desc.get;
        if (getter === undefined) {
            return undefined
        }
        return getter.call(receiver)
    }
};
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass)
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var HHPopup = function() {
    function HHPopup(name, options, callback) {
        _classCallCheck(this, HHPopup);
        this.isMobile = is_mobile_size();
        this.name = name;
        this.options = options || {};
        this.callback = callback;
        this.isSliding = this.options.sliding;
        this.wrapperName = this.isSliding ? "sliding-popups" : "popups";
        this.close_element = "<close></close>";
        this.$popupBackground = $("#" + this.name + "_background");
        this.$blackBackground = $("#black_screen");
        this.$popupWrapper = $("#" + this.wrapperName);
        this.$popup = $("#" + this.name);
        this.$popupWhole = $("#" + this.wrapperName + ", #" + this.wrapperName + ">div#" + this.name)
    }
    _createClass(HHPopup, [{
        key: "setClassProperties",
        value: function setClassProperties() {
            this.$popup = $("#" + this.name);
            this.$popupWhole = $("#" + this.wrapperName + ", #" + this.wrapperName + ">div#" + this.name)
        }
    }, {
        key: "applyOptions",
        value: function applyOptions() {
            if (this.options.show_over) {
                this.$popup.css("z-index", 11)
            }
            if (this.options.open_callback) {
                this.options.open_callback()
            }
            if (!this.options.no_close) {
                this.addClose()
            } else {
                this.options.color = "black"
            }
            if (!this.options.no_background) {
                this.setBackground()
            }
            if (this.options.own_background) {
                this.createOwnBackground()
            }
            if (this.isSliding) {
                var left = this.isMobile ? "500px" : "620px";
                this.$popup.css({
                    left: left
                })
            }
            if (this.options.top_position) {
                this.$popup.css({
                    top: this.options.top_position
                })
            }
        }
    }, {
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this = this;
            this.closeSelector = "#" + this.name + ">close, #" + this.name + "_background, #" + this.name + " [close_callback]";
            this.$popupWrapper.on("click", this.closeSelector, function(event) {
                _this.close()
            });
            var $body = $("body");
            $body.on("enter_pressed_event", function() {
                _this.enterEventHandler()
            }).on("escape_pressed_event", function() {
                _this.escapeEventHandler()
            })
        }
    }, {
        key: "enterEventHandler",
        value: function enterEventHandler() {
            if (!this.options.prevent_events) {
                this.close()
            }
        }
    }, {
        key: "escapeEventHandler",
        value: function escapeEventHandler() {
            this.close()
        }
    }, {
        key: "open",
        value: function open() {
            this.$popupWhole.show();
            this.applyOptions();
            this.addEventListeners()
        }
    }, {
        key: "close",
        value: function close() {
            if (this.options.show_over) {
                this.$popup.hide()
            } else {
                this.$popupWhole.hide()
            }
            this.removeEventListeners();
            if (!this.options.no_background) {
                this.removeBackground()
            }
            this.removeClose();
            if (this.isSliding) {
                this.$popup.css({
                    left: parseInt(this.$popup.css("left"), 10) + 1e3 + "px"
                })
            }
            if (typeof this.callback === "function") {
                this.callback()
            }
            if (this.options.show_over) {
                this.$popup.trigger("force_closed_popup", [this.name])
            } else {
                this.$popup.trigger("closed_popup", [this.name])
            }
        }
    }, {
        key: "addClose",
        value: function addClose() {
            $(this.close_element).appendTo(this.$popup)
        }
    }, {
        key: "removeClose",
        value: function removeClose() {
            this.$popup.find("close").remove()
        }
    }, {
        key: "setBackground",
        value: function setBackground() {
            if (this.options.no_close) {
                this.$blackBackground.show()
            } else {
                var color = void 0;
                if (this.options.color) {
                    color = this.options.color
                } else {
                    color = this.isMobile ? "blue" : "black"
                }
                this.createBackground(color)
            }
        }
    }, {
        key: "setDimming",
        value: function setDimming() {
            if (this.options.own_background) {
                var $frame = this.$popup.children(":first");
                $frame.addClass("popup_bg");
                $frame.css({
                    left: this.$popup.css("left"),
                    top: this.$popup.css("top"),
                    width: this.$popup.width(),
                    height: this.$popup.height()
                })
            }
        }
    }, {
        key: "createOwnBackground",
        value: function createOwnBackground() {
            if (!$(".popup_background.self.black").length) {
                var $background = '<div id="' + this.name + '_own_background" class="popup_background self black"></div>';
                this.$popup.prepend($background)
            }
        }
    }, {
        key: "createBackground",
        value: function createBackground(color) {
            var $background = '<div id="' + this.name + '_background" class="popup_background ' + color + '"></div>';
            $("body").append($background);
            this.$popupBackground = $("#" + this.name + "_background")
        }
    }, {
        key: "removeBackground",
        value: function removeBackground() {
            this.$popupBackground.remove();
            this.$blackBackground.hide()
        }
    }, {
        key: "removeEventListeners",
        value: function removeEventListeners() {
            this.$popupWrapper.off("click", this.closeSelector);
            $("body").off("enter_pressed_event").off("escape_pressed_event")
        }
    }]);
    return HHPopup
}();
var HHBuildablePopup = function(_HHPopup) {
    _inherits(HHBuildablePopup, _HHPopup);

    function HHBuildablePopup() {
        _classCallCheck(this, HHBuildablePopup);
        return _possibleConstructorReturn(this, (HHBuildablePopup.__proto__ || Object.getPrototypeOf(HHBuildablePopup)).apply(this, arguments))
    }
    _createClass(HHBuildablePopup, [{
        key: "close",
        value: function close() {
            _get(HHBuildablePopup.prototype.__proto__ || Object.getPrototypeOf(HHBuildablePopup.prototype), "close", this).call(this);
            this.$popup.remove()
        }
    }]);
    return HHBuildablePopup
}(HHPopup);
var HHAuthenticationPopup = function(_HHPopup2) {
    _inherits(HHAuthenticationPopup, _HHPopup2);

    function HHAuthenticationPopup(name, options, callback) {
        _classCallCheck(this, HHAuthenticationPopup);
        var _this3 = _possibleConstructorReturn(this, (HHAuthenticationPopup.__proto__ || Object.getPrototypeOf(HHAuthenticationPopup)).call(this, name, options, callback));
        _this3.setClassProperties();
        _this3.close_element = '<div class="close_cross">\n\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png">\n\t\t\t\t\t\t\t</div>';
        return _this3
    }
    _createClass(HHAuthenticationPopup, [{
        key: "setClassProperties",
        value: function setClassProperties() {
            this.$popup = $("#" + this.name);
            this.wrapperName = "body";
            this.$popupWrapper = $(this.wrapperName);
            this.$popupWhole = $(this.wrapperName + ", " + this.wrapperName + ">div#" + this.name)
        }
    }, {
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this4 = this;
            this.closeSelector = "#" + this.name + ">.close_cross, #" + this.name + "_background";
            this.$popupWrapper.on("click", this.closeSelector, function(event) {
                _this4.close()
            })
        }
    }, {
        key: "close",
        value: function close() {
            _get(HHAuthenticationPopup.prototype.__proto__ || Object.getPrototypeOf(HHAuthenticationPopup.prototype), "close", this).call(this);
            $("#" + this.name + ">.close_cross").remove()
        }
    }]);
    return HHAuthenticationPopup
}(HHPopup);
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var HHPopupsManager = function() {
    function HHPopupsManager() {
        _classCallCheck(this, HHPopupsManager);
        this.listQueuedPopups = [];
        this.listOpenedPopups = {};
        this.listQueuedCallbacks = {};
        this.isHandlerAdded = false
    }
    _createClass(HHPopupsManager, [{
        key: "show",
        value: function show(name, options, callback) {
            if (Object.keys(this.listOpenedPopups).length) {
                if (options && options.show_over) this.init(name, options, callback);
                else this.addToPopupQueue(name, options, callback)
            } else this.init(name, options, callback)
        }
    }, {
        key: "init",
        value: function init(name, options, callback) {
            this.addHandler();
            var newPopup = {};
            if (this.listQueuedCallbacks[name]) {
                callback = this.listQueuedCallbacks[name];
                delete this.listQueuedCallbacks[name]
            }
            if (options && options.offer) {
                newPopup = new HHOffer(name, options, callback)
            } else if (options && options.context) {
                newPopup = new HHSimplePopup(name, options, callback)
            } else if (name == "confirm_pachinko") {
                newPopup = new HHPachinkoConfirm(name, options, callback)
            } else if (options && options.confirm) {
                newPopup = new HHConfirmPopup(name, options, callback)
            } else if (options && options.objective_points) {
                newPopup = new HHObjectivePointsPopup(name, options, callback)
            } else if (name == "authentication_popup") {
                newPopup = new HHAuthenticationPopup(name, options, callback)
            } else if (name == "level_up") {
                newPopup = new HHLevelPopup(name, options, callback)
            } else if (name == "confirm_HC") {
                newPopup = new HHConfirmHCPopup(name, options, callback)
            } else if (name == "popup_news") {
                newPopup = new HHNewsPopup(name, options, callback)
            } else if (name == "popup_credits") {
                newPopup = new HHPatreonPopup(name, options, callback)
            } else if (name == "rewards_popup") {
                newPopup = new HHRewardsPopup(name, options, callback)
            } else if (name == "email_validation") {
                newPopup = new HHEmailValidationPopup(name, options, callback)
            } else if (name.indexOf("no_energy_") != -1) {
                newPopup = new HHEnergyPopup(name, options, callback)
            } else if (name.indexOf("monthly_card_") != -1) {
                newPopup = new HHMonthlyCardPopup(name, options, callback)
            } else if (name.indexOf("_page") != -1) {
                newPopup = new HHHeroPagePopup(name, options, callback)
            } else if (name == "no_HC") {
                newPopup = new HHPaymentsPopup(name, options, callback)
            } else if (name == "scene_popup") {
                newPopup = new HHScenePopup(name, options, callback)
            } else if (name == "payment_failed_popup") {
                newPopup = new HHPaymentFailedPopup(name, options, callback)
            } else if (name == "reactivation_reward") {
                newPopup = new HHReactivationRewardPopup(name, options, callback)
            } else if (name == "season_end_popup") {
                newPopup = new HHSeasonEndPopup(name, options, callback)
            } else if (name == "club_champions_help_popup") {
                newPopup = new HHClubChampionsHelpPopup(name, options, callback)
            } else newPopup = new HHPopup(name, options, callback);
            this.listOpenedPopups[name] = newPopup;
            newPopup.open()
        }
    }, {
        key: "addToPopupQueue",
        value: function addToPopupQueue(name, options, callback) {
            if (this.listQueuedPopups.length) {
                for (var i in this.listQueuedPopups) {
                    if (this.listQueuedPopups[i]["name"] == name) return
                }
            }
            this.listQueuedPopups.push({
                name: name,
                options: options,
                callback: callback
            })
        }
    }, {
        key: "addHandler",
        value: function addHandler() {
            if (!this.isHandlerAdded) {
                $("#popups").on("force_closed_popup", $.proxy(HHPopupManager.close, HHPopupManager));
                $("#popups").on("closed_popup", $.proxy(HHPopupManager.close, HHPopupManager));
                $("#sliding-popups").on("force_closed_popup", $.proxy(HHSlidingPopupManager.close, HHSlidingPopupManager));
                $("#sliding-popups").on("closed_popup", $.proxy(HHSlidingPopupManager.close, HHSlidingPopupManager));
                this.isHandlerAdded = true
            }
        }
    }, {
        key: "setCallback",
        value: function setCallback(name, callback) {
            if (this.listOpenedPopups[name]) {
                this.listOpenedPopups[name].callback = callback;
                delete this.listQueuedCallbacks[name]
            } else this.listQueuedCallbacks[name] = callback
        }
    }, {
        key: "getLastOpenedPopup",
        value: function getLastOpenedPopup() {
            var keys = Object.keys(this.listOpenedPopups);
            return keys[keys.length - 1]
        }
    }, {
        key: "closeLastOpenedPopup",
        value: function closeLastOpenedPopup() {
            var lastPopup = this.getLastOpenedPopup();
            if (lastPopup && this.listOpenedPopups[lastPopup]) this.listOpenedPopups[lastPopup].close()
        }
    }, {
        key: "close",
        value: function close(event, name) {
            delete this.listOpenedPopups[name];
            if (event.type == "force_closed_popup") return;
            if (!Object.keys(this.listOpenedPopups).length && this.listQueuedPopups.length) {
                var nextPopup = this.listQueuedPopups.shift();
                this.show(nextPopup.name, nextPopup.options, nextPopup.callback)
            }
        }
    }]);
    return HHPopupsManager
}();
var HHPopupManager = new HHPopupsManager;
var HHSlidingPopupManager = new HHPopupsManager;
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();
var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);
    if (desc === undefined) {
        var parent = Object.getPrototypeOf(object);
        if (parent === null) {
            return undefined
        } else {
            return get(parent, property, receiver)
        }
    } else if ("value" in desc) {
        return desc.value
    } else {
        var getter = desc.get;
        if (getter === undefined) {
            return undefined
        }
        return getter.call(receiver)
    }
};

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass)
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass
}
var HHNewsPopup = function(_HHPopup) {
    _inherits(HHNewsPopup, _HHPopup);

    function HHNewsPopup(name, options, callback) {
        _classCallCheck(this, HHNewsPopup);
        var _this = _possibleConstructorReturn(this, (HHNewsPopup.__proto__ || Object.getPrototypeOf(HHNewsPopup)).call(this, name, options, callback));
        _this.close_element = '<div class="close_cross">\n\t\t                      \t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png">\n\t\t                      </div>';
        _this.$news_list = _this.$popupWrapper.find(".news_list");
        _this.$news_page = _this.$popupWrapper.find(".news_page");
        return _this
    }
    _createClass(HHNewsPopup, [{
        key: "applyOptions",
        value: function applyOptions() {
            _get(HHNewsPopup.prototype.__proto__ || Object.getPrototypeOf(HHNewsPopup.prototype), "applyOptions", this).call(this);
            this.prepareNews()
        }
    }, {
        key: "prepareNews",
        value: function prepareNews() {
            var stored_read_news = JSON.parse(localStorageGetItem("News_read")) || {};
            var number_of_unreads = 0;
            for (var i in news_list) {
                var currentNews = news_list[i];
                currentNews.read = stored_read_news.hasOwnProperty(currentNews.id_news);
                if (!currentNews.read) {
                    number_of_unreads++
                }
            }
            this.$news_list.append(this.buildList()).show();
            this.$popupWrapper.find(".news_list .news_thumb").click(this.thumbClick.bind(this));
            if (this.options.single_news || news_list.length == 1) {
                this.$news_list.hide();
                this.buildPage(0);
                this.updateReadNews(0, this.$news_list.children().first());
                if (number_of_unreads > 1) {
                    this.getCloseButton().hide()
                } else {
                    this.$popupWrapper.find(".back_button").hide()
                }
            } else {
                this.$news_page.hide()
            }
        }
    }, {
        key: "updateReadNews",
        value: function updateReadNews(id, $thumb) {
            if (!news_list[id].read) {
                var local_storage_news = JSON.parse(localStorageGetItem("News_read")) || {};
                local_storage_news[news_list[id].id_news] = 1;
                localStorageSetItem("News_read", JSON.stringify(local_storage_news));
                $thumb.find(".news_thumb_notif").hide()
            }
        }
    }, {
        key: "thumbClick",
        value: function thumbClick(event) {
            this.getCloseButton().hide();
            this.$news_list.hide();
            this.$news_page.show();
            var $thumb = $(event.currentTarget);
            var index = $thumb.index();
            this.buildPage(index);
            this.updateReadNews(index, $thumb)
        }
    }, {
        key: "backClick",
        value: function backClick() {
            this.$news_list.show();
            this.$news_page.hide();
            this.buildList()
        }
    }, {
        key: "buildList",
        value: function buildList() {
            this.getCloseButton().show();
            this.$popupWrapper.find(".news_container>h1").html("" + GT.design.news);
            var list = "";
            for (var i in news_list) {
                var currentNews = news_list[i];
                var date = this.buildDate(currentNews.release_on);
                var notif = !currentNews.read ? '<img class="news_thumb_notif" src="' + IMAGES_URL + '/ic_new.png">' : "";
                list += '\n\t\t\t\t<div class="news_thumb">\n\t\t\t\t\t<div class="news_thumb_pic"\n\t\t\t\t\t\tstyle="background-image: url(' + currentNews.image_url + ');">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="news_thumb_frame">\n\t\t\t\t\t\t<div class="news_thumb_title">' + currentNews.title + '</div>\n\t\t\t\t\t\t<div class="news_thumb_date">' + date + "</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t" + notif + "\n\t\t\t\t</div>"
            }
            return list
        }
    }, {
        key: "buildPage",
        value: function buildPage(id) {
            var currentNews = news_list[id];
            var date = this.buildDate(currentNews.release_on);
            var body = '\n\t\t\t<div class="back_button">\n\t\t\t\t<span class="mapArrowBack_flat_icn"></span>\n\t\t\t</div>\n\t\t\t<div class="news_page_date">' + date + '</div>\n\t\t\t<div class="news_page_content">\n\t\t\t\t<div class="news_page_pic"\n\t\t\t\t\tstyle="background-image: url(' + currentNews.image_url + ');">\n\t\t\t\t</div>\n\t\t\t\t<div class="news_page_text">' + currentNews.content + "</div>\n\t\t\t</div>";
            this.$news_page.empty().append(body);
            this.$popupWrapper.find(".news_container>h1").html(currentNews.title);
            this.$popupWrapper.find(".back_button").click(this.backClick.bind(this));
            var $pageContent = this.$popupWrapper.find(".news_page .news_page_content");
            var contentHeight = $pageContent.find(".news_page_pic").height() + $pageContent.find(".news_page_text").height();
            if (contentHeight > $pageContent.height()) {
                $pageContent.niceScroll()
            }
        }
    }, {
        key: "buildDate",
        value: function buildDate(dateTime) {
            var date = new Date(dateTime);
            var month = date.toLocaleString(this.locale, {
                month: "short"
            });
            var dateString = get_lang() != "en" ? date.getDate() + " " + month + " " + date.getFullYear() : month + " " + date.getDate() + ", " + date.getFullYear();
            return dateString
        }
    }, {
        key: "getCloseButton",
        value: function getCloseButton() {
            var closeSelector = "#" + this.name + ">div.close_cross";
            return $(closeSelector)
        }
    }, {
        key: "setBackground",
        value: function setBackground() {
            this.$blackBackground.show()
        }
    }, {
        key: "open",
        value: function open() {
            var _this2 = this;
            _get(HHNewsPopup.prototype.__proto__ || Object.getPrototypeOf(HHNewsPopup.prototype), "open", this).call(this);
            this.getCloseButton().one("click", function() {
                return _this2.close()
            })
        }
    }, {
        key: "close",
        value: function close() {
            _get(HHNewsPopup.prototype.__proto__ || Object.getPrototypeOf(HHNewsPopup.prototype), "close", this).call(this);
            this.$news_list.empty();
            this.getCloseButton().remove()
        }
    }]);
    return HHNewsPopup
}(HHPopup);
var HHPaymentsPopup = function(_HHPopup2) {
    _inherits(HHPaymentsPopup, _HHPopup2);

    function HHPaymentsPopup(name, options, callback) {
        _classCallCheck(this, HHPaymentsPopup);
        var _this3 = _possibleConstructorReturn(this, (HHPaymentsPopup.__proto__ || Object.getPrototypeOf(HHPaymentsPopup)).call(this, name, options, callback));
        _this3.desired_tab = _this3.options.desired_tab || "payments";
        _this3.close_element = '<div class="close_cross">\n\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png">\n\t\t\t\t\t\t\t</div>';
        return _this3
    }
    _createClass(HHPaymentsPopup, [{
        key: "setBackground",
        value: function setBackground() {
            this.$blackBackground.show()
        }
    }, {
        key: "applyOptions",
        value: function applyOptions() {
            _get(HHPaymentsPopup.prototype.__proto__ || Object.getPrototypeOf(HHPaymentsPopup.prototype), "applyOptions", this).call(this);
            if (this.options.init_load) load_payments(this.desired_tab)
        }
    }, {
        key: "open",
        value: function open() {
            var _this4 = this;
            this.$popupWhole.show();
            this.applyOptions();
            var closeSelector = "#" + this.name + ">div.close_cross, #" + this.name + "_background, #" + this.name + " [close_callback]";
            $(closeSelector).click(function(event) {
                $(closeSelector).off();
                _this4.close()
            })
        }
    }, {
        key: "close",
        value: function close() {
            _get(HHPaymentsPopup.prototype.__proto__ || Object.getPrototypeOf(HHPaymentsPopup.prototype), "close", this).call(this);
            $("#" + this.name + " .close_cross").remove()
        }
    }]);
    return HHPaymentsPopup
}(HHPopup);
var HHOffer = function(_HHPopup3) {
    _inherits(HHOffer, _HHPopup3);

    function HHOffer(name, options, callback) {
        _classCallCheck(this, HHOffer);
        var _this5 = _possibleConstructorReturn(this, (HHOffer.__proto__ || Object.getPrototypeOf(HHOffer)).call(this, name, options, callback));
        _this5.isMutable = options && options.is_mutable;
        _this5.timer = 0;
        _this5.timerId = 0;
        return _this5
    }
    _createClass(HHOffer, [{
        key: "load",
        value: function load(callback) {
            var _this6 = this;
            hh_ajax({
                namespace: "h\\Offer",
                class: "OfferDisplay",
                action: "popup",
                id: this.name
            }, function(data) {
                _this6.$popupWrapper.append(data.html);
                _this6.$popup = $("#" + _this6.name);
                _this6.$popupWhole = $("#popups, #popups>div#" + _this6.name);
                if (data.data.endDisplay) _this6.timer = data.data.endDisplay - Date.now() / 1e3;
                if (typeof callback == "function") callback()
            })
        }
    }, {
        key: "prepareOpen",
        value: function prepareOpen() {
            this.applyOptions();
            if (this.isMobile) this.$popupWhole.show();
            else this.openAnimation();
            if (this.timer) {
                var expiresLabel = this.$popup.find('[rel="expires"]');
                if (this.isMobile) expiresLabel.hide();
                var expiresText = expiresLabel.text() + " ";
                this.timerId = HHTimers.initSimpleTimerTxt(this.$popup.find('[rel="offer_timer"]'), this.timer, reload, expiresText)
            }
            this.addEventListeners()
        }
    }, {
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this7 = this;
            $(this.closeSelector).off();
            $("#" + this.name + ">close, #" + this.name + "_background").click(function(event) {
                _this7.close();
                $("#" + _this7.name + " button").off()
            });
            $("#" + this.name + " button").click(function(event) {
                _this7.prepareCallback($(_this7));
                $(event.target).off()
            });
            var $body = $("body");
            $body.on("escape_pressed_event", function() {
                _this7.escapeEventHandler();
                $body.off("escape_pressed_event")
            })
        }
    }, {
        key: "enterEventHandler",
        value: function enterEventHandler() {}
    }, {
        key: "open",
        value: function open() {
            var _this8 = this;
            if (this.$popup.length) this.prepareOpen();
            else this.load(function() {
                _this8.prepareOpen()
            })
        }
    }, {
        key: "close",
        value: function close() {
            if (this.isMobile) this.afterClose();
            else {
                this.$popup.css("display", "block");
                this.closeAnimation()
            }
            this.$popup.hide();
            if (!this.options.no_background) this.removeBackground();
            this.removeClose();
            if (this.isMutable) {
                hh_ajax({
                    namespace: "h\\Offer",
                    class: "OfferDisplay",
                    action: "mute_offer",
                    id_offer: this.name
                })
            }
            HHTimers.stopTimer(this.timerId);
            if (typeof this.callback == "function") this.callback();
            this.removeEventListeners()
        }
    }, {
        key: "afterClose",
        value: function afterClose() {
            this.$popupWrapper.trigger("closed_popup", [this.name]);
            this.$popupBackground.remove()
        }
    }, {
        key: "prepareCallback",
        value: function prepareCallback($button) {
            this.close();
            var info = window["offers_" + this.name];
            info.name = this.name;
            openOfferPayment(info)
        }
    }, {
        key: "openAnimation",
        value: function openAnimation() {
            this.$popupBackground.css("display", "block");
            this.$popupBackground.velocity("fadeIn", {
                duration: 5
            });
            this.$popupWhole.show();
            this.$popup.velocity({
                scale: .2
            }, 0).velocity({
                scale: 1,
                opacity: 1
            }, "easeInOutCirc", 500).velocity({
                scale: .8
            }, "easeInOutCirc", 100)
        }
    }, {
        key: "closeAnimation",
        value: function closeAnimation() {
            var _this9 = this;
            this.$popupBackground.css("display", "block");
            this.$popupBackground.fadeOut(850);
            this.$popup.velocity({
                display: "block"
            }).velocity({
                scale: .1,
                top: "600px",
                left: "0",
                opacity: 0
            }, "easeOutCirc", 850).velocity({
                opacity: 0,
                top: "100px",
                left: "210px",
                complete: function complete() {
                    _this9.afterClose()
                }
            })
        }
    }]);
    return HHOffer
}(HHPopup);
var HHRewardsPopup = function(_HHPopup4) {
    _inherits(HHRewardsPopup, _HHPopup4);

    function HHRewardsPopup(name, options, callback) {
        _classCallCheck(this, HHRewardsPopup);
        var _this10 = _possibleConstructorReturn(this, (HHRewardsPopup.__proto__ || Object.getPrototypeOf(HHRewardsPopup)).call(this, name, options, callback));
        _this10.$rewardsHolder = _this10.$popup.find("#reward_holder");
        _this10.$scrollingArea = _this10.$rewardsHolder.find(".container>.scrolling_area");
        _this10.preparePopup();
        _this10.prepareButtons();
        return _this10
    }
    _createClass(HHRewardsPopup, [{
        key: "prepareButtons",
        value: function prepareButtons() {
            this.$rerollBlock = $("#rewards_popup .reroll-block");
            this.$confirmButton = $("#rewards_popup button[confirm_blue_button]");
            if (typeof this.options.canReroll === "undefined") {
                this.$rerollBlock.hide();
                this.$confirmButton.removeClass("absolute-style-reroll");
                if (this.options.draft) this.$confirmButton.text(GT.design.confirm).prop("disabled", true);
                else this.$confirmButton.text("Ok")
            } else {
                if (this.options.canReroll) {
                    this.$rerollBlock.show();
                    this.$confirmButton.addClass("absolute-style-reroll").text(GT.design.confirm)
                }
            }
        }
    }, {
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this11 = this;
            _get(HHRewardsPopup.prototype.__proto__ || Object.getPrototypeOf(HHRewardsPopup.prototype), "addEventListeners", this).call(this);
            var $draftGirls = $("[girl-draft-identifier]").not(".girl_border_glow");
            $draftGirls.click(function(event) {
                var $target = $(event.target);
                var $girl = $target.is(".right-girl") ? $draftGirls.filter(".left-girl") : $draftGirls.filter(".right-girl");
                var oppositeSrc = $girl.attr("src");
                $girl.removeClass("girl_border_glow").attr("src", oppositeSrc.replace("ava0", "avb0"));
                var currentSrc = $target.attr("src");
                $target.addClass("girl_border_glow").attr("src", currentSrc.replace("avb0", "ava0"));
                _this11.$confirmButton.prop("disabled", false)
            });
            var $buttons = $("#rewards_popup button");
            $buttons.click(function(event) {
                $buttons.off();
                var isReroll = $(event.currentTarget).is(".reroll-button");
                var draftID = $("[girl-draft-identifier].girl_border_glow").attr("girl-draft-identifier");
                if (_this11.options.draft) {
                    var eventInfo = {
                        type: "draft",
                        id_girl: draftID
                    };
                    $("body").trigger("pachinkoEvent", eventInfo)
                } else if (typeof _this11.options.canReroll !== "undefined") {
                    var _eventInfo = {
                        type: "reroll",
                        state: isReroll
                    };
                    if (isReroll) {
                        hc_confirm(hh_prices.pachinko2reroll, function() {
                            $("body").trigger("pachinkoEvent", _eventInfo);
                            Hero.update("hard_currency", 0 - hh_prices.pachinko2reroll, true)
                        })
                    } else $("body").trigger("pachinkoEvent", _eventInfo);
                    _this11.$rerollBlock.hide();
                    _this11.$confirmButton.removeClass("absolute-style-reroll")
                }
            })
        }
    }, {
        key: "enterEventHandler",
        value: function enterEventHandler() {
            if (this.options.canReroll == undefined && this.options.draft == undefined) _get(HHRewardsPopup.prototype.__proto__ || Object.getPrototypeOf(HHRewardsPopup.prototype), "enterEventHandler", this).call(this)
        }
    }, {
        key: "escapeEventHandler",
        value: function escapeEventHandler() {
            if (this.options.canReroll == undefined && this.options.draft == undefined) _get(HHRewardsPopup.prototype.__proto__ || Object.getPrototypeOf(HHRewardsPopup.prototype), "escapeEventHandler", this).call(this)
        }
    }, {
        key: "preparePopup",
        value: function preparePopup() {
            var _this12 = this;
            var openCallback = this.options.open_callback;
            this.options.open_callback = function() {
                openCallback();
                _this12.setScroll();
                _this12.showDefaultAnimation()
            }
        }
    }, {
        key: "setScroll",
        value: function setScroll() {
            var $rewardsContainer = this.$scrollingArea.find(".rewards_scrollable");
            var maxAllowedHeight = parseInt($rewardsContainer.css("max-height"));
            var height = $rewardsContainer.height();
            if (height >= maxAllowedHeight) {
                $rewardsContainer.niceScroll();
                if (this.$scrollingArea.find(".rewards_static").height()) {
                    $rewardsContainer.find(".nicescroll-rails").addClass("nicescroll-rails-pushed")
                }
            }
        }
    }, {
        key: "showDefaultAnimation",
        value: function showDefaultAnimation() {
            this.setRewardsBackground();
            this.$rewardsHolder.find(".rewards_background").addClass("vertically_expand");
            this.$rewardsHolder.find(".line").not(".masked_girl").addClass("slide_left");
            this.$rewardsHolder.find(".line.masked_girl, .shards_line").addClass("slide_right")
        }
    }, {
        key: "setRewardsBackground",
        value: function setRewardsBackground() {
            var $shardsBackground = $(".shards_background");
            var $shardsHolder = this.$scrollingArea.find(".shards_line");
            var shardsHeight = $shardsHolder.height();
            var shardsFinalHeight = shardsHeight ? Math.max(shardsHeight, parseInt(this.$scrollingArea.css("min-height"), 10)) : 0;
            if (shardsFinalHeight) {
                $shardsBackground.show().height(shardsFinalHeight);
                $shardsHolder.height(shardsFinalHeight)
            } else $shardsBackground.hide();
            var maxWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0, 1e3);
            var parentWidth = this.$rewardsHolder.width();
            var left = maxWidth > parentWidth ? Math.round((parentWidth - maxWidth) / 2) : 0;
            var finalHeight = this.$scrollingArea.height();
            this.$rewardsHolder.find(".rewards_background").css({
                height: finalHeight + "px",
                width: maxWidth + "px",
                left: left + "px"
            });
            return this.$rewardsHolder
        }
    }, {
        key: "close",
        value: function close() {
            _get(HHRewardsPopup.prototype.__proto__ || Object.getPrototypeOf(HHRewardsPopup.prototype), "close", this).call(this);
            $("body").trigger("closed_rewards_popup")
        }
    }]);
    return HHRewardsPopup
}(HHPopup);
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();
var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);
    if (desc === undefined) {
        var parent = Object.getPrototypeOf(object);
        if (parent === null) {
            return undefined
        } else {
            return get(parent, property, receiver)
        }
    } else if ("value" in desc) {
        return desc.value
    } else {
        var getter = desc.get;
        if (getter === undefined) {
            return undefined
        }
        return getter.call(receiver)
    }
};

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass)
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass
}
var HHSimplePopup = function(_HHBuildablePopup) {
    _inherits(HHSimplePopup, _HHBuildablePopup);

    function HHSimplePopup(name, options, callback) {
        _classCallCheck(this, HHSimplePopup);
        var _this = _possibleConstructorReturn(this, (HHSimplePopup.__proto__ || Object.getPrototypeOf(HHSimplePopup)).call(this, name, options, callback));
        _this.popupClass = _this.name + $('[name="' + _this.name + '"]').length;
        _this.$popupWrapper.append(_this.buildBody(options.context));
        _this.$popup = $("." + _this.popupClass);
        _this.$popupWhole = $("#popups, #popups>div." + _this.popupClass);
        return _this
    }
    _createClass(HHSimplePopup, [{
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this2 = this;
            if (this.options.context.text) {
                _get(HHSimplePopup.prototype.__proto__ || Object.getPrototypeOf(HHSimplePopup.prototype), "addEventListeners", this).call(this);
                this.$popupWrapper.off("click", _get(HHSimplePopup.prototype.__proto__ || Object.getPrototypeOf(HHSimplePopup.prototype), "closeSelector", this))
            }
            this.closeSelector = "." + this.popupClass + ">close, #" + this.name + "_background, ." + this.popupClass + " button[close_callback]";
            this.$popupWrapper.on("click", this.closeSelector, function() {
                _this2.close()
            })
        }
    }, {
        key: "createBackground",
        value: function createBackground(color) {
            var $background = '<div id="' + this.popupClass + '_background" class="popup_background ' + color + '"></div>';
            $("body").append($background);
            this.$popupBackground = $("#" + this.popupClass + "_background")
        }
    }, {
        key: "buildBody",
        value: function buildBody(context) {
            var body = '<div id="' + this.name + '" class="' + this.popupClass + '" name="' + this.name + '">';
            if (context.money) {
                var money = number_format_lang(context.money);
                body += '<div rel="money">' + GT.design.msg_no_money.replace("[num]", money) + '\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<a href="/harem.html" class="orange_text_button">' + GT.design.Harem + "</a>\n\t\t\t\t\t</div>"
            } else body += "<div>" + context.text + "</div>";
            body += "</div>";
            return body
        }
    }]);
    return HHSimplePopup
}(HHBuildablePopup);
var HHConfirmPopup = function(_HHBuildablePopup2) {
    _inherits(HHConfirmPopup, _HHBuildablePopup2);

    function HHConfirmPopup(name, options, callback) {
        _classCallCheck(this, HHConfirmPopup);
        var _this3 = _possibleConstructorReturn(this, (HHConfirmPopup.__proto__ || Object.getPrototypeOf(HHConfirmPopup)).call(this, name, options, callback));
        _this3.$popupWrapper.append(_this3.buildBody(options.confirm));
        _get(HHConfirmPopup.prototype.__proto__ || Object.getPrototypeOf(HHConfirmPopup.prototype), "setClassProperties", _this3).call(_this3);
        return _this3
    }
    _createClass(HHConfirmPopup, [{
        key: "buildBody",
        value: function buildBody(confirm) {
            var body = '<div id="' + this.name + '" class="' + (this.options.size ? this.options.size : "") + ' popup_view_v2">\n\t\t\t\t\t\t<div class="container">\n\t\t\t\t\t\t\t<h3 class="title_box">' + confirm.title + '</h3>\n\n\t\t\t\t\t\t\t<p class="text ' + (this.options.textAlign ? "text-align-" + this.options.textAlign : "") + '">' + confirm.body + '</p>\n\n\t\t\t\t\t\t\t<div class="buttons-section">\n\t\t\t\t\t\t\t\t<button close_callback id="popup_confirm" class="blue_button_L">' + (confirm.buttons ? confirm.buttons.yes : GT.design.Yes) + '</button>\n\t\t\t\t\t\t\t\t<button close_callback class="red_button_L">' + (confirm.buttons ? confirm.buttons.no : GT.design.No) + "</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>";
            return body
        }
    }, {
        key: "enterEventHandler",
        value: function enterEventHandler() {
            this.isConfirm = true;
            this.close()
        }
    }, {
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this4 = this;
            _get(HHConfirmPopup.prototype.__proto__ || Object.getPrototypeOf(HHConfirmPopup.prototype), "addEventListeners", this).call(this);
            this.$popupWrapper.off("click", this.closeSelector);
            this.$popupWrapper.on("click", this.closeSelector, function(event) {
                if ($(event.target).is("#popup_confirm")) {
                    _this4.isConfirm = true
                } else if (_this4.options.confirm.cancelCallback) {
                    _this4.options.confirm.cancelCallback();
                    return
                }
                _this4.close()
            })
        }
    }, {
        key: "close",
        value: function close() {
            if (this.options.no_background != true) this.removeBackground();
            this.$popup.trigger("closed_popup", [this.name]);
            this.$popup.remove();
            this.removeEventListeners();
            if (this.isConfirm) this.runCallback()
        }
    }, {
        key: "runCallback",
        value: function runCallback() {
            if (typeof this.callback == "function") this.callback()
        }
    }]);
    return HHConfirmPopup
}(HHBuildablePopup);
var HHPachinkoConfirm = function(_HHConfirmPopup) {
    _inherits(HHPachinkoConfirm, _HHConfirmPopup);

    function HHPachinkoConfirm(name, options, callback) {
        _classCallCheck(this, HHPachinkoConfirm);
        var _this5 = _possibleConstructorReturn(this, (HHPachinkoConfirm.__proto__ || Object.getPrototypeOf(HHPachinkoConfirm)).call(this, name, options, callback));
        _this5.buildTimer();
        return _this5
    }
    _createClass(HHPachinkoConfirm, [{
        key: "buildTimer",
        value: function buildTimer() {
            var html = "";
            html += '<br/>\n\t\t\t\t<p class="text ' + (this.options.textAlign ? "text-align-" + this.options.textAlign : "") + '">\n\t\t\t\t\t' + GT.design.confirm_pachinko_timer + " " + format_time_short(Math.abs(this.options.confirm.timer)) + "\n\t\t\t\t</p>";
            this.$popup.append(html)
        }
    }]);
    return HHPachinkoConfirm
}(HHConfirmPopup);
var HHLevelPopup = function(_HHBuildablePopup3) {
    _inherits(HHLevelPopup, _HHBuildablePopup3);

    function HHLevelPopup(name, options, callback) {
        _classCallCheck(this, HHLevelPopup);
        var _this6 = _possibleConstructorReturn(this, (HHLevelPopup.__proto__ || Object.getPrototypeOf(HHLevelPopup)).call(this, name, options, callback));
        _this6.$popupWrapper.append(_this6.buildBody(options.quest_energy_amount));
        _get(HHLevelPopup.prototype.__proto__ || Object.getPrototypeOf(HHLevelPopup.prototype), "setClassProperties", _this6).call(_this6);
        return _this6
    }
    _createClass(HHLevelPopup, [{
        key: "buildBody",
        value: function buildBody() {
            var quest_energy_amount = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;
            var body = '<div id="' + this.name + '">\n\t\t\t\t\t\t<div class="level_target"><div><div>' + Hero.infos.level + "</div></div></div>\n\t\t\t\t\t\t<div>" + GT.design.popup_level_up + '</div>\n\n\t\t\t\t\t\t<span class="energy-levelup">+' + quest_energy_amount + '</span>\n\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design/ic_level-energy.png" id=\'level_energy_icon\'>\n\n\t\t\t\t\t\t<button class="blue_text_button" close_callback>' + GT.design.resume + "</button>\n\t\t\t\t\t</div>";
            return body
        }
    }, {
        key: "open",
        value: function open() {
            _get(HHLevelPopup.prototype.__proto__ || Object.getPrototypeOf(HHLevelPopup.prototype), "open", this).call(this);
            $('#level_up [rel="num"]').text(Hero.infos.level);
            Hero.fill_level_target($("#level_up .level_target>div>div"));
            Hero.fill_level_target($("#leagues_left .level>div>div, #lead_left .level>div>div"));
            if (typeof hh_battle_players != "undefined") {
                this.callback = function() {
                    var url = void 0;
                    var opponent = hh_battle_players[1];
                    if (opponent.id_world) url = "/world/" + opponent.id_world;
                    else if ("id_arena" in opponent) url = "/season-arena.html";
                    else url = "/tower-of-fame.html?tab=leagues";
                    window.location.href = url
                }
            }
        }
    }]);
    return HHLevelPopup
}(HHBuildablePopup);
var HHConfirmHCPopup = function(_HHBuildablePopup4) {
    _inherits(HHConfirmHCPopup, _HHBuildablePopup4);

    function HHConfirmHCPopup(name, options, callback) {
        _classCallCheck(this, HHConfirmHCPopup);
        var _this7 = _possibleConstructorReturn(this, (HHConfirmHCPopup.__proto__ || Object.getPrototypeOf(HHConfirmHCPopup)).call(this, name, options, callback));
        _this7.$popupWrapper.append(_this7.buildBody());
        _get(HHConfirmHCPopup.prototype.__proto__ || Object.getPrototypeOf(HHConfirmHCPopup.prototype), "setClassProperties", _this7).call(_this7);
        _this7.internalCallback = _this7.callback;
        _this7.closeCallback = options.closeCallback;
        _this7.callback = null;
        return _this7
    }
    _createClass(HHConfirmHCPopup, [{
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this8 = this;
            _get(HHConfirmHCPopup.prototype.__proto__ || Object.getPrototypeOf(HHConfirmHCPopup.prototype), "addEventListeners", this).call(this);
            $("#confirm_HC button").on("click", function() {
                _this8.updateHeroPreferences();
                if (typeof _this8.internalCallback == "function") _this8.internalCallback()
            })
        }
    }, {
        key: "enterEventHandler",
        value: function enterEventHandler() {
            this.updateHeroPreferences();
            if (typeof this.internalCallback == "function") this.internalCallback();
            this.close()
        }
    }, {
        key: "removeEventListeners",
        value: function removeEventListeners() {
            _get(HHConfirmHCPopup.prototype.__proto__ || Object.getPrototypeOf(HHConfirmHCPopup.prototype), "removeEventListeners", this).call(this);
            $("#confirm_HC button").off()
        }
    }, {
        key: "updateHeroPreferences",
        value: function updateHeroPreferences() {
            if ($("#confirm_HC button").closest("div").find("input").prop("checked")) {
                $(this).blur();
                hh_ajax({
                    class: "Hero",
                    action: "tuto_bunny",
                    tuto_id: "hc_confirm"
                });
                Hero.infos.hc_confirm = true
            }
        }
    }, {
        key: "open",
        value: function open() {
            _get(HHConfirmHCPopup.prototype.__proto__ || Object.getPrototypeOf(HHConfirmHCPopup.prototype), "open", this).call(this);
            $("#confirm_HC p span").text(this.options.price)
        }
    }, {
        key: "close",
        value: function close() {
            _get(HHConfirmHCPopup.prototype.__proto__ || Object.getPrototypeOf(HHConfirmHCPopup.prototype), "close", this).call(this);
            if (typeof this.closeCallback == "function") this.closeCallback()
        }
    }, {
        key: "buildBody",
        value: function buildBody() {
            var body = '<div id="confirm_HC">\n\t\t\t\t\t\t<p>' + GT.design.confirm_HC_text + '</p>\n\t\t\t\t\t\t<button class="orange_text_button" close_callback>' + GT.design.Yes + '</button>\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type="checkbox">\n\t\t\t\t\t\t\t' + GT.design.confirm_HC_label + "\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>";
            return body
        }
    }]);
    return HHConfirmHCPopup
}(HHBuildablePopup);
var HHPatreonPopup = function(_HHBuildablePopup5) {
    _inherits(HHPatreonPopup, _HHBuildablePopup5);

    function HHPatreonPopup(name, options, callback) {
        _classCallCheck(this, HHPatreonPopup);
        var _this9 = _possibleConstructorReturn(this, (HHPatreonPopup.__proto__ || Object.getPrototypeOf(HHPatreonPopup)).call(this, name, options, callback));
        _this9.$popupWrapper.append(_this9.buildBody());
        _get(HHPatreonPopup.prototype.__proto__ || Object.getPrototypeOf(HHPatreonPopup.prototype), "setClassProperties", _this9).call(_this9);
        return _this9
    }
    _createClass(HHPatreonPopup, [{
        key: "buildBody",
        value: function buildBody() {
            var body = '<div id="popup_credits">\n\t\t\t\t\t\t<h1>' + GT.design.credits_title + '</h1>\n\t\t\t\t\t\t<div class="credits_box">\n\t\t\t\t\t\t\t<p>' + GT.design.credits_body_1 + "</p>\n\t\t\t\t\t\t\t<p>&nbsp;</p>\n\t\t\t\t\t\t\t" + this.buildSupportersList() + "\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>";
            return body
        }
    }, {
        key: "buildSupportersList",
        value: function buildSupportersList() {
            var universe = $("body").attr("id").replace("hh_", "");
            var getextIdentifier = "";
            switch (universe) {
                case "hentai":
                    getextIdentifier = "credits_body_2";
                    break;
                case "gay":
                    getextIdentifier = "credits_body_4"
            }
            var originalText = GT.design[getextIdentifier];
            for (var key in sharedVars) {
                var keyName = sharedVars[key]["name"].replace("patreonNames_" + universe + "_", "");
                originalText = originalText.replace("[" + keyName + "]", sharedVars[key]["value"])
            }
            var getext = "<p>" + originalText + "</p>";
            return getext
        }
    }]);
    return HHPatreonPopup
}(HHBuildablePopup);
var HHEnergyPopup = function(_HHBuildablePopup6) {
    _inherits(HHEnergyPopup, _HHBuildablePopup6);

    function HHEnergyPopup(name, options, callback) {
        _classCallCheck(this, HHEnergyPopup);
        var _this10 = _possibleConstructorReturn(this, (HHEnergyPopup.__proto__ || Object.getPrototypeOf(HHEnergyPopup)).call(this, name, options, callback));
        _this10.confirmCallback = callback;
        _this10.type = _this10.options.energy;
        _this10.wasteRefill = _this10.options.can_refill === false;
        _this10.$popupWrapper.append(_this10.buildBody());
        _get(HHEnergyPopup.prototype.__proto__ || Object.getPrototypeOf(HHEnergyPopup.prototype), "setClassProperties", _this10).call(_this10);
        return _this10
    }
    _createClass(HHEnergyPopup, [{
        key: "enterEventHandler",
        value: function enterEventHandler() {
            Hero.recharge(this.$popup.find("button"), Hero.get_recharge_cost(this.type), options.max_battles, this.type);
            this.close()
        }
    }, {
        key: "buildBody",
        value: function buildBody() {
            var isValidPromo = promoInfo && (!promoInfo.type || promoInfo.type == this.type && promoInfo.type != "challenge");
            var promo = isValidPromo ? this.buildPromo() : "";
            var girl = '<img src="' + randomGirlAvatar + '" />';
            var restTimer = this.options.max_battles ? "" : this.buildRestTimer();
            var body = void 0;
            if (this.type == "kiss") {
                body = '<div id="' + this.name + '" style= "position: relative;">\n\t\t\t\t\t\t<img src="' + randomGirlAvatar.toImageUrl("ava") + '" class= "energy_popup_kiss_girl"/>\n\t\t\t\t\t\t<div style= "width: 85%;">\n\t\t\t\t\t\t\t\t<h2>' + this.buildTitle() + "</h2>\n\t\t\t\t\t\t\t\t<p>" + GT.design.energy_quest_text1 + '</p>\n\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div class="slot slot_energy_' + this.type + '" style= "width: 75px; height: 75px;">\n\n\t\t\t\t\t\t\t\t\t\t<div cur="energy_' + this.type + '" ><p></p></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<button class="orange_text_button" style="width: 200px;" close_callback>\n\t\t\t\t\t\t\t\t\t\t<span>' + GT.design.refill + '</span>\n\t\t\t\t\t\t\t\t\t\t<div cur="hard_currency"></div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t' + promo + "\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t" + restTimer + "\n\t\t\t\t\t\t<div>\n\t\t\t\t\t</div>"
            } else if (this.wasteRefill) {
                body = '<div id="' + this.name + '">\n\t\t\t\t\t\t<img src="' + randomGirlAvatar.toImageUrl("ava") + '" />\n\t\t\t\t\t\t<h2>' + this.buildTitle() + "</h2>\n\t\t\t\t\t\t<p>" + GT.design.energy_quest_text3.replace("[attempts_wasted]", 15 - league_battle_count) + '</p>\n\t\t\t\t\t\t<div style="display: inline;">\n\t\t\t\t\t\t\t<button class="blue_text_button confirm_button" confirm_callback>' + GT.design.Yes + '</button>\n\t\t\t\t\t\t\t<button class="blue_text_button confirm_button" close_callback>' + GT.design.No + "</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"
            } else {
                body = '<div id="' + this.name + '">\n\t\t\t\t\t\t<img src="' + randomGirlAvatar.toImageUrl("ava") + '" />\n\t\t\t\t\t\t<h2>' + this.buildTitle() + "</h2>\n\t\t\t\t\t\t<p>" + GT.design.energy_quest_text1 + '</p>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="slot slot_energy_' + this.type + '"><div cur="energy_' + this.type + '"><p></p></div></div>\n\t\t\t\t\t\t\t<button class="orange_text_button" close_callback>\n\t\t\t\t\t\t\t\t<span>' + GT.design.refill + '</span>\n\t\t\t\t\t\t\t\t<div cur="hard_currency"></div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t' + promo + "\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t" + restTimer + "\n\t\t\t\t\t</div>"
            }
            return body
        }
    }, {
        key: "buildTitle",
        value: function buildTitle() {
            switch (this.type) {
                case "quest":
                    return GT.design.quest_down;
                    break;
                case "fight":
                    return GT.design.energy_down;
                    break;
                case "challenge":
                    return GT.design.no_challenge_tokens;
                    break;
                case "kiss":
                    return GT.design.season_no_kisses;
                    break;
                default:
                    throw new Error("Unsupported type of energy: " + this.type);
                    break
            }
        }
    }, {
        key: "applyOptions",
        value: function applyOptions() {
            var _this11 = this;
            _get(HHEnergyPopup.prototype.__proto__ || Object.getPrototypeOf(HHEnergyPopup.prototype), "applyOptions", this).call(this);
            if (this.wasteRefill) {
                this.$popup.find("[confirm_callback]").click(function(event) {
                    _this11.close();
                    HHPopupManager.show("no_energy_challenge", {
                        energy: "challenge",
                        can_refill: true
                    }, _this11.callback)
                })
            } else this.handleEnergy()
        }
    }, {
        key: "buildRestTimer",
        value: function buildRestTimer() {
            var restTimer = "\n\t\t\t<p>\n\t\t\t\t" + GT.design.energy_rest_timer.replace("[timer]", '<b rel="timer"></b>') + "\n\t\t\t</p>";
            return restTimer
        }
    }, {
        key: "buildPromo",
        value: function buildPromo() {
            var promo = '<div class="promo_div" promo_percentage="' + promoInfo.percentage + '">\n\t\t\t\t\t\t<p>' + GT.design.promo_ends_in.replace("[nb]", promoInfo.hours) + "</p>\n\t\t\t\t\t\t<p>" + promoInfo.name + "</p>\n\t\t\t\t\t\t<p>-" + promoInfo.percentage + '%</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="promo_cross">_</div>\n\t\t\t\t\t<div class="promo_price"></div>';
            return promo
        }
    }, {
        key: "handleEnergy",
        value: function handleEnergy() {
            var _this12 = this;
            var energyTimer = Hero.c[this.type];
            var timeNeeded = void 0;
            if (!energyTimer) {
                timeNeeded = Hero.energies[this.type].recharge_time
            } else {
                timeNeeded = energyTimer.getTotalRemainingTime()
            }
            var info = function info() {
                return {
                    energy: (_this12.options.max_battles || Hero.energies[_this12.type].max_amount) - Hero.energies[_this12.type].amount,
                    price: _this12.options.max_battles ? Hero.get_max_recharge_cost(_this12.type, _this12.options.max_battles) : Hero.get_recharge_cost(_this12.type)
                }
            };
            var $energy = this.$popup.find(".slot>[cur]>p");
            var $price = this.$popup.find('[cur="hard_currency"]');
            var $discountPrice = this.$popup.find(".promo_price");
            var setAmounts = function setAmounts() {
                var initialInfo = info();
                var promoPercentage = parseInt($("#no_energy_" + _this12.type + " .promo_div").attr("promo_percentage"));
                $energy.text(initialInfo.energy);
                $price.text(initialInfo.price);
                if (promoPercentage) {
                    var originalPrice = _this12.options.max_battles ? Hero.get_max_recharge_cost(_this12.type, _this12.options.max_battles, true) : Hero.get_recharge_cost(_this12.type, true);
                    $price.text(originalPrice);
                    $discountPrice.text(initialInfo.price)
                }
                disableButtonIfNotEnoughKobans()
            };
            var timerId = void 0;
            if (!this.options.max_battles) {
                var $t = this.$popup.find('[rel="timer"]');
                timerId = HHTimers.initDecTimer($t, timeNeeded, function() {
                    $t.text("").addClass("empty");
                    _this12.close()
                }, setAmounts)
            }
            this.$popup.find("button").click(function(event) {
                Hero.recharge(_this12.$popup.find("button"), info().price, _this12.type, _this12.options.max_battles, _this12.confirmCallback);
                Hero.energies[_this12.type].recharge_time = 0;
                HHTimers.stopTimer(timerId);
                _this12.close()
            });
            setAmounts();
            this.callback = function() {
                HHTimers.stopTimer(timerId)
            }
        }
    }, {
        key: "removeEventListeners",
        value: function removeEventListeners() {
            _get(HHEnergyPopup.prototype.__proto__ || Object.getPrototypeOf(HHEnergyPopup.prototype), "removeEventListeners", this).call(this);
            this.$popup.find("button").off()
        }
    }]);
    return HHEnergyPopup
}(HHBuildablePopup);
var HHHeroPagePopup = function(_HHBuildablePopup7) {
    _inherits(HHHeroPagePopup, _HHBuildablePopup7);

    function HHHeroPagePopup(name, options, callback) {
        _classCallCheck(this, HHHeroPagePopup);
        var _this13 = _possibleConstructorReturn(this, (HHHeroPagePopup.__proto__ || Object.getPrototypeOf(HHHeroPagePopup)).call(this, name, options, callback));
        _this13.$popupWrapper.append(_this13.buildBody());
        _get(HHHeroPagePopup.prototype.__proto__ || Object.getPrototypeOf(HHHeroPagePopup.prototype), "setClassProperties", _this13).call(_this13);
        return _this13
    }
    _createClass(HHHeroPagePopup, [{
        key: "buildBody",
        value: function buildBody() {
            var body = "";
            switch (this.name) {
                case "no_hero_page":
                    body = this.buildNoHeroPagePopup();
                    break;
                case "share_page":
                    body = this.buildSharePagePopup();
                    break;
                case "hero_pages":
                    body = '<div id="' + this.name + '"></div>';
                    break;
                default:
                    throw new Error("Unsupported hero page popup case: " + this.name)
            }
            return body
        }
    }, {
        key: "buildNoHeroPagePopup",
        value: function buildNoHeroPagePopup() {
            var body = '<div id="' + this.name + '">\n\t\t\t\t\t\t<div>' + GT.design.hp_no_profile + '</div>\n\t\t\t\t\t\t<button class="blue_text_button" close_callback>' + GT.design.quest_close + "</button>\n\t\t\t\t\t</div>";
            return body
        }
    }, {
        key: "buildSharePagePopup",
        value: function buildSharePagePopup() {
            var isHaremPage = $(".harem_page").length;
            var page = isHaremPage ? "harem" : "profile";
            var id = Hero.infos.id;
            var url = SITE_ROOT + "hero/" + id + "/" + page + ".html";
            var body = '<div id="' + this.name + '">\n\t\t\t\t\t\t<h2>' + (isHaremPage ? GT.design.harem_share : GT.design.hp_share) + "</h2>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span>" + (isHaremPage ? GT.design.harem_link : GT.design.hp_link) + '</span>\n\t\t\t\t\t\t\t<input type="text" id="copy_target" value="' + url + '"\tonclick="$(this).select()">\n\t\t\t\t\t\t\t<span class="copied">' + GT.design.hp_copied + '</span>\n\t\t\t\t\t\t\t<button data-copytarget="#copy_target" class="blue_text_button copy">' + GT.design.hp_copy + "</button>\n\t\t\t\t\t\t\t<div close_callback>" + GT.design.quest_close + "</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>";
            return body
        }
    }]);
    return HHHeroPagePopup
}(HHBuildablePopup);
var HHEmailValidationPopup = function(_HHBuildablePopup8) {
    _inherits(HHEmailValidationPopup, _HHBuildablePopup8);

    function HHEmailValidationPopup(name, options, callback) {
        _classCallCheck(this, HHEmailValidationPopup);
        var _this14 = _possibleConstructorReturn(this, (HHEmailValidationPopup.__proto__ || Object.getPrototypeOf(HHEmailValidationPopup)).call(this, name, options, callback));
        _this14.$popupWrapper.append(_this14.buildBody(options.type, true));
        _get(HHEmailValidationPopup.prototype.__proto__ || Object.getPrototypeOf(HHEmailValidationPopup.prototype), "setClassProperties", _this14).call(_this14);
        if (email_validation == "rewarded") {
            _this14.callback = function() {
                hh_ajax({
                    class: "Hero",
                    action: "valid_msg"
                })
            }
        }
        return _this14
    }
    _createClass(HHEmailValidationPopup, [{
        key: "buildText",
        value: function buildText() {
            var email = memberInfo.email;
            var name = memberInfo.Name;
            return {
                sentMailMessage: GT.design.sent_mail_msg.replace("[email]", email).replace("[number]", '150 <span cur="hard_currency"></span>'),
                newMailMessage: GT.design.new_mail_msg.replace("[email]", email),
                validatedMailMessage: GT.design.validated_mail_msg.replace("[name]", name),
                mailInboxUrl: "http://" + email.replace("/^.*@/", "")
            }
        }
    }, {
        key: "buildBody",
        value: function buildBody(type) {
            var wrap = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
            var text = this.buildText();
            var body = wrap ? '<div id="' + this.name + '">' : "";
            switch (type) {
                case "rewarded":
                    body += '<div class="validated">' + text.validatedMailMessage + "</div>";
                    break;
                case "asking":
                    body += '<div class="sent_msg">' + text.sentMailMessage + '</div>\n\t\t\t\t\t\t\t<div class="links">\n\t\t\t\t\t\t\t\t<a class="resend_email">' + GT.design.resend_mail + '</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<a class="green_text_button inbox" target="_blank" href="' + text.mailInboxUrl + '">' + GT.design.inbox_mail + "</a>";
                    break;
                case "changeEmail":
                    body += '<div class="change_msg">\n\t\t\t\t\t\t\t\t' + GT.design.change_mail_msg + '\n\t\t\t\t\t\t\t\t<form class="mail_form">\n\t\t\t\t\t\t\t\t\t<input class="email_field" type="text" placeholder="' + GT.design.new_email + '" rel="email"></input>\n\t\t\t\t\t\t\t\t\t<button class="green_text_button resend">' + GT.design.confirm_mail + '</button>\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t<span rel="emailInfo"></span>\n\t\t\t\t\t\t\t</div>';
                    break;
                case "sentEmail":
                    body += '<div class="mail_sent">' + text.newMailMessage + "</div>";
                    break;
                default:
                    throw new Error("Unsupported type for e-mail validation popup: " + type)
            }
            if (wrap) body += "</div>";
            return body
        }
    }, {
        key: "replaceBody",
        value: function replaceBody(type) {
            this.$popup.children().not("close").remove();
            this.$popup.append(this.buildBody(type))
        }
    }, {
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this15 = this;
            _get(HHEmailValidationPopup.prototype.__proto__ || Object.getPrototypeOf(HHEmailValidationPopup.prototype), "addEventListeners", this).call(this);
            this.$popup.find(".resend_email").click(function() {
                Phoenix.ajax({
                    module: "Member",
                    action: "resend_confirm_email"
                }, function(data) {
                    if (data.success) _this15.replaceBody("sentEmail")
                })
            })
        }
    }, {
        key: "close",
        value: function close() {
            _get(HHEmailValidationPopup.prototype.__proto__ || Object.getPrototypeOf(HHEmailValidationPopup.prototype), "close", this).call(this);
            hh_ajax({
                class: "Hero",
                action: "email_timer"
            })
        }
    }]);
    return HHEmailValidationPopup
}(HHBuildablePopup);
var HHMonthlyCardPopup = function(_HHBuildablePopup9) {
    _inherits(HHMonthlyCardPopup, _HHBuildablePopup9);

    function HHMonthlyCardPopup(name, options, callback) {
        _classCallCheck(this, HHMonthlyCardPopup);
        var _this16 = _possibleConstructorReturn(this, (HHMonthlyCardPopup.__proto__ || Object.getPrototypeOf(HHMonthlyCardPopup)).call(this, name, options, callback));
        _this16.type = _this16.name.replace("monthly_card_", "");
        _this16.kobansAmount = _this16.options.amount;
        _this16.$popupWrapper.append(_this16.buildBody());
        _get(HHMonthlyCardPopup.prototype.__proto__ || Object.getPrototypeOf(HHMonthlyCardPopup.prototype), "setClassProperties", _this16).call(_this16);
        _get(HHMonthlyCardPopup.prototype.__proto__ || Object.getPrototypeOf(HHMonthlyCardPopup.prototype), "setDimming", _this16).call(_this16);
        return _this16
    }
    _createClass(HHMonthlyCardPopup, [{
        key: "buildBody",
        value: function buildBody() {
            var body = '<div id="' + this.name + '"><div id="own_frame"></div>';
            switch (this.type) {
                case "expired":
                    body += '<img src="' + IMAGES_URL + '/payments/mc_cat.png">\n\t\t\t\t\t\t<div class="msg">' + GT.design.monthly_card_expiration + '</div>\n\t\t\t\t\t\t<div class="amount">\n\t\t\t\t\t\t\t<button class="orange_text_button">' + GT.design.monthly_card_buy.replace("[amount]", "") + '</button>\n\t\t\t\t\t\t\t<a class="close" close_callback>' + GT.design.crosspromo_register_button_no + "</a>\n\t\t\t\t\t\t</div>";
                    break;
                default:
                    throw new Error("Unsupported type for monthly card popup: " + this.type)
            }
            body += "</div>";
            return body
        }
    }]);
    return HHMonthlyCardPopup
}(HHBuildablePopup);
var HHReactivationRewardPopup = function(_HHBuildablePopup10) {
    _inherits(HHReactivationRewardPopup, _HHBuildablePopup10);

    function HHReactivationRewardPopup(name, options, callback) {
        _classCallCheck(this, HHReactivationRewardPopup);
        var _this17 = _possibleConstructorReturn(this, (HHReactivationRewardPopup.__proto__ || Object.getPrototypeOf(HHReactivationRewardPopup)).call(this, name, options, callback));
        _this17.kobansAmount = _this17.options.amount;
        _this17.$popupWrapper.append(_this17.buildBody());
        _get(HHReactivationRewardPopup.prototype.__proto__ || Object.getPrototypeOf(HHReactivationRewardPopup.prototype), "setClassProperties", _this17).call(_this17);
        _get(HHReactivationRewardPopup.prototype.__proto__ || Object.getPrototypeOf(HHReactivationRewardPopup.prototype), "setDimming", _this17).call(_this17);
        return _this17
    }
    _createClass(HHReactivationRewardPopup, [{
        key: "buildBody",
        value: function buildBody() {
            var body = '<div id="' + this.name + '"><div id="own_frame"></div>\n\t\t\t<img src="' + IMAGES_URL + '/pictures/design/payments/mc_bunny.png">\n\t\t\t<div class="msg">' + GT.design.reactivation_popup + '</div>\n\t\t\t<div class="amount">\n\t\t\t\t<span class="num">' + this.kobansAmount + '</span> <span cur="hard_currency"></span>\n\t\t\t\t<button class="blue_text_button" close_callback>' + GT.design.awesome + "</button>\n\t\t\t</div>\n\t\t</div>";
            return body
        }
    }]);
    return HHReactivationRewardPopup
}(HHBuildablePopup);
var HHScenePopup = function(_HHBuildablePopup11) {
    _inherits(HHScenePopup, _HHBuildablePopup11);

    function HHScenePopup(name, options, callback) {
        _classCallCheck(this, HHScenePopup);
        var _this18 = _possibleConstructorReturn(this, (HHScenePopup.__proto__ || Object.getPrototypeOf(HHScenePopup)).call(this, name, options, callback));
        _this18.close_element = '<div class="close_cross">\n\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png">\n\t\t\t\t\t\t\t</div>';
        _this18.$popupWrapper.append(_this18.buildBody());
        _get(HHScenePopup.prototype.__proto__ || Object.getPrototypeOf(HHScenePopup.prototype), "setClassProperties", _this18).call(_this18);
        return _this18
    }
    _createClass(HHScenePopup, [{
        key: "open",
        value: function open() {
            var _this19 = this;
            this.$popupWhole.show();
            this.applyOptions();
            var closeSelector = "#" + this.name + ">div.close_cross, #" + this.name + "_background, #" + this.name + " [close_callback]";
            $(closeSelector).click(function(event) {
                _this19.close()
            });
            $(".toggle-scene-text").click(function() {
                $(".end-scene-text-wrapper").children().toggle()
            })
        }
    }, {
        key: "buildBody",
        value: function buildBody() {
            var body = "";
            body = '<div id="scene_popup" style="background-image: url(\'' + this.options.url + '\')">\n\t\t\t\t\t<div class="end-scene-text-wrapper">\n\t\t\t\t\t\t<img class="toggle-scene-text" src="' + IMAGES_URL + '/quest/ic_eyeclosed.svg" />\n\t\t\t\t\t\t<img class="toggle-scene-text" src="' + IMAGES_URL + '/quest/ic_eyeopen.svg" style="display:none" />\n\t\t\t\t\t\t<span>' + this.options.text + "<span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>";
            return body
        }
    }]);
    return HHScenePopup
}(HHBuildablePopup);
var HHPaymentFailedPopup = function(_HHBuildablePopup12) {
    _inherits(HHPaymentFailedPopup, _HHBuildablePopup12);

    function HHPaymentFailedPopup(name, options, callback) {
        _classCallCheck(this, HHPaymentFailedPopup);
        var _this20 = _possibleConstructorReturn(this, (HHPaymentFailedPopup.__proto__ || Object.getPrototypeOf(HHPaymentFailedPopup)).call(this, name, options, callback));
        _this20.close_element = '<div class="close_cross">\n\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png">\n\t\t\t\t\t\t\t</div>';
        _this20.$popupWrapper.append(_this20.buildBody());
        _get(HHPaymentFailedPopup.prototype.__proto__ || Object.getPrototypeOf(HHPaymentFailedPopup.prototype), "setClassProperties", _this20).call(_this20);
        return _this20
    }
    _createClass(HHPaymentFailedPopup, [{
        key: "buildBody",
        value: function buildBody() {
            var body = '<div id="' + this.name + '" class="popup_view_v2">\n\t\t\t\t\t\t<div class="container"><p class="text">' + this.options.error + "</p></div>\n\t\t\t\t\t</div>";
            return body
        }
    }]);
    return HHPaymentFailedPopup
}(HHBuildablePopup);
var HHObjectivePointsPopup = function(_HHBuildablePopup13) {
    _inherits(HHObjectivePointsPopup, _HHBuildablePopup13);

    function HHObjectivePointsPopup(name, options, callback) {
        _classCallCheck(this, HHObjectivePointsPopup);
        var _this21 = _possibleConstructorReturn(this, (HHObjectivePointsPopup.__proto__ || Object.getPrototypeOf(HHObjectivePointsPopup)).call(this, name, options, callback));
        _this21.objective_points = _this21.options.objective_points;
        _this21.$popupWrapper.append(_this21.buildBody());
        _get(HHObjectivePointsPopup.prototype.__proto__ || Object.getPrototypeOf(HHObjectivePointsPopup.prototype), "setClassProperties", _this21).call(_this21);
        _this21.animateRow();
        $(".noti_box .points").niceScroll(".container");
        return _this21
    }
    _createClass(HHObjectivePointsPopup, [{
        key: "buildBody",
        value: function buildBody() {
            var body = '<div id="objective_popup" class="notifs">\n\t\t\t\t\t\t<div class="noti_box">\n\t\t\t\t\t\t\t<div class="points">\n\t\t\t\t\t\t\t\t<div class="container">\n\t\t\t\t\t\t\t\t\t' + this.buildObjectiveBlock() + "\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>";
            return body
        }
    }, {
        key: "buildObjectiveBlock",
        value: function buildObjectiveBlock() {
            var body = "";
            for (var key in this.objective_points) {
                var objective = this.objective_points[key];
                body += '<div class="row">\n\t\t\t\t\t\t<div class="contest_name">' + GT.design[key] + ':</div>\n\t\t\t\t\t\t<div class="contest_points">\n\t\t\t\t\t\t\t<div class="points_name">' + objective.name + ': </div>\n\t\t\t\t\t\t\t<div class="points_num">\n\t\t\t\t\t\t\t\t<div class="points_i">+' + number_format_lang(objective.points_gained) + "</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"
            }
            return body
        }
    }, {
        key: "animateRow",
        value: function animateRow() {
            var $rows = $(".row");
            var timer = void 0;
            var me = this;
            $rows.each(function(i, row) {
                setTimeout(function() {
                    $(row).addClass("animate");
                    $(".noti_box .points .container").getNiceScroll().resize()
                }, 300 * (i + 1))
            });
            timer = setTimeout(closePoints, $rows.length * 2e3);

            function closePoints() {
                $("#objective_popup").addClass("slide-out");
                setTimeout(function() {
                    me.close()
                }, 500);
                clearTimeout(timer)
            }
        }
    }]);
    return HHObjectivePointsPopup
}(HHBuildablePopup);
var HHSeasonEndPopup = function(_HHBuildablePopup14) {
    _inherits(HHSeasonEndPopup, _HHBuildablePopup14);

    function HHSeasonEndPopup(name, options, callback) {
        _classCallCheck(this, HHSeasonEndPopup);
        var _this22 = _possibleConstructorReturn(this, (HHSeasonEndPopup.__proto__ || Object.getPrototypeOf(HHSeasonEndPopup)).call(this, name, options, callback));
        _this22.season_reset_data = options.custom_data;
        _this22.$popupWrapper.append(_this22.buildBody());
        _get(HHSeasonEndPopup.prototype.__proto__ || Object.getPrototypeOf(HHSeasonEndPopup.prototype), "setClassProperties", _this22).call(_this22);
        _this22.close_element = $("#close_btn_sns");
        _this22.close_element.click(reload);
        _this22.start_button = $("#start_new_season_btn");
        _this22.start_button.click(_this22.start_new_season);
        return _this22
    }
    _createClass(HHSeasonEndPopup, [{
        key: "start_new_season",
        value: function start_new_season() {
            return window.location.href = "/season.html"
        }
    }, {
        key: "open",
        value: function open() {
            _get(HHSeasonEndPopup.prototype.__proto__ || Object.getPrototypeOf(HHSeasonEndPopup.prototype), "open", this).call(this);
            $("#popups").prepend('\n\t\t\t\t\t<span\n\t\t\t\t\t\tstyle="display: block; z-index: 11; position: fixed; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); top: 0; left: 0">\n\t\t\t\t\t</span>')
        }
    }, {
        key: "buildBody",
        value: function buildBody() {
            var headline_name = "";
            var headline_suffix = "";
            var first_p = "";
            var previous_season_mojo = void 0;
            var second_p = "";
            var second_p_season_name = "";
            var current_season_mojo = void 0;
            var has_previus_season = false;
            if (this.season_reset_data.previous_season && this.season_reset_data.previous_season.name) {
                has_previus_season = true;
                headline_name = this.season_reset_data.previous_season.name;
                headline_suffix = GT.design.has_ended;
                first_p = GT.design.mojo_reset;
                if (this.season_reset_data.previous_season.mojo) {
                    previous_season_mojo = number_format_lang(this.season_reset_data.previous_season.mojo)
                }
            } else {
                headline_name = this.season_reset_data.current_season.name;
                headline_suffix = GT.design.has_begun
            }
            second_p = GT.design.good_luck_new_season;
            second_p_season_name = this.season_reset_data.current_season.name;
            current_season_mojo = number_format_lang(this.season_reset_data.current_season.mojo);
            var body = '<div id="season_end_popup" class= "notifs">\n\t\t\t\t<div class="border-gradient">\n\t\t\t\t\t<div id="close_btn_sns" class="close_cross">\n\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class = "h_container_univ">\n\t\t\t\t\t\t<div style="width: 25%;">\n\t\t\t\t\t\t\t<img src="' + randomGirlAvatar.toImageUrl("ava") + '" style="height: 100%; transform: translate(-30px, 10px);"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="text-align: center; padding: 20px; width: 70%;">\n\t\t\t\t\t\t\t<div style="display: inline-block; text-align: left;">\n\t\t\t\t\t\t\t\t<div id="season_end_headline">\n\t\t\t\t\t\t\t\t\t<span id="season_end_headline_name">' + headline_name + "</span>\n\t\t\t\t\t\t\t\t\t" + headline_suffix + '\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id="first_p" class="season_ended_p" style="display: ' + (previous_season_mojo ? "block" : "none") + '">' + first_p + '</div>\n\t\t\t\t\t\t\t\t<div id="second_p" class="season_ended_p">\n\t\t\t\t\t\t\t\t\t' + second_p + '\n\t\t\t\t\t\t\t\t\t<span id="second_p_season_name">' + second_p_season_name + '</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="season_end_mojo_container"">\n\t\t\t\t\t\t\t\t<div id="row1" class="season_ended_popup_row" style="display: ' + (previous_season_mojo ? "flex" : "none") + '">\n\t\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design/ic_mojo.png" class="season_end_mojo_img"/>\n\t\t\t\t\t\t\t\t\t<div id="value_row_1" class="season_ended_mojo">' + previous_season_mojo + '</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id="row2" class= "season_ended_popup_row" style="display: ' + (previous_season_mojo ? "flex" : "none") + '">\n\t\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/ic_arrow.svg" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id="row3" class="season_ended_popup_row" style="margin-top: 18px;">\n\t\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design/ic_mojo.png" class="season_end_mojo_img"/>\n\t\t\t\t\t\t\t\t\t<div id="value_row_3" class="season_ended_mojo">' + current_season_mojo + '</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button id="start_new_season_btn" class="blue_button_L seasons_sns_btn">' + GT.design["season_start_btn"] + "</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>";
            return body
        }
    }]);
    return HHSeasonEndPopup
}(HHBuildablePopup);
var HHClubChampionsHelpPopup = function(_HHBuildablePopup15) {
    _inherits(HHClubChampionsHelpPopup, _HHBuildablePopup15);

    function HHClubChampionsHelpPopup(name, options, callback) {
        _classCallCheck(this, HHClubChampionsHelpPopup);
        var _this23 = _possibleConstructorReturn(this, (HHClubChampionsHelpPopup.__proto__ || Object.getPrototypeOf(HHClubChampionsHelpPopup)).call(this, name, options, callback));
        _this23.$popupWrapper.append(_this23.buildBody());
        _this23.close_element = '<div class="close_cross">\n\t\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png">\n\t\t\t\t\t\t\t\t</div>';
        _get(HHClubChampionsHelpPopup.prototype.__proto__ || Object.getPrototypeOf(HHClubChampionsHelpPopup.prototype), "setClassProperties", _this23).call(_this23);
        return _this23
    }
    _createClass(HHClubChampionsHelpPopup, [{
        key: "open",
        value: function open() {
            var _this24 = this;
            this.$popupWhole.show();
            this.applyOptions();
            var closeSelector = "#" + this.name + ">div.close_cross, #" + this.name + "_background, #" + this.name + " [close_callback]";
            $(closeSelector).click(function(event) {
                _this24.close()
            })
        }
    }, {
        key: "buildBody",
        value: function buildBody() {
            var body = '<div id="club_champions_help_popup" class= "notifs">\n\t\t\t\t<div class="border-gradient">\n\t\t\t\t\t<div class="club_champions_help_container">\n\t\t\t\t\t\t' + GT.design.club_champion_help_section_1 + "\n\t\t\t\t\t\t" + GT.design.club_champion_help_section_2 + "\n\t\t\t\t\t\t" + GT.design.club_champion_help_section_3 + "\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>";
            return body
        }
    }]);
    return HHClubChampionsHelpPopup
}(HHBuildablePopup);
var _slicedToArray = function() {
    function sliceIterator(arr, i) {
        var _arr = [];
        var _n = true;
        var _d = false;
        var _e = undefined;
        try {
            for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
                _arr.push(_s.value);
                if (i && _arr.length === i) break
            }
        } catch (err) {
            _d = true;
            _e = err
        } finally {
            try {
                if (!_n && _i["return"]) _i["return"]()
            } finally {
                if (_d) throw _e
            }
        }
        return _arr
    }
    return function(arr, i) {
        if (Array.isArray(arr)) {
            return arr
        } else if (Symbol.iterator in Object(arr)) {
            return sliceIterator(arr, i)
        } else {
            throw new TypeError("Invalid attempt to destructure non-iterable instance")
        }
    }
}();

function hh_click_hc_button(product, price, kobans, $but, attr) {
    if (hh_nutaku || typeof hh_eroges != "undefined" || typeof hh_thrix != "undefined" || typeof hh_esprit != "undefined") {
        price = $but.attr("price");
        var is_offer = typeof $but.attr("offer") !== "undefined";
        var is_season_pass = typeof $but.attr("season_pass") !== "undefined";
        var buy = {
            id: product,
            cost: price,
            nb: kobans,
            name: kobans + " Kobans",
            mc: false,
            has_active_mc: false,
            hc_per_day: 0,
            offer: is_offer,
            sp: is_season_pass
        };
        if (attr === "monthly_card") {
            buy.mc = true;
            buy.name = "Monthly Card";
            buy.hc_per_day = parseInt($but.attr("per_day"), 10);
            buy.has_active_mc = $but.attr("has_active_mc")
        } else if (is_season_pass) {
            buy.name = "Season pass"
        }
        var params = {
            class: "Payment",
            id_product: product,
            nb: kobans
        };
        if (hh_nutaku) {
            HH_Nutaku.payment(buy)
        } else if (typeof hh_eroges != "undefined") {
            hh_ajax(params, function(data) {
                buy["publicKey"] = data.publicKey;
                buy["hash"] = data.hash;
                buy["tr_id"] = data.tr_id;
                buy["cost"] = data.price;
                buy["name"] = data.name;
                buy["entities"] = data.entities;
                hh_eroges.payment(buy)
            })
        } else if (typeof hh_thrix != "undefined") {
            hh_ajax(params, hh_thrix.payment)
        } else if (typeof hh_esprit != "undefined") {
            hh_ajax(params, hh_esprit.payment)
        }
    } else {
        var $buy = $(this);
        $buy.prop("disabled", true);
        var pathname = prepareCurrentPathURL();
        var _params = {
            class: "Payment",
            id_product: product,
            nb: kobans,
            url_back: pathname
        };
        loadingAnimation.start($("#no_HC"));
        hh_ajax(_params, function(data) {
            loadingAnimation.stop();
            var callback = function callback() {
                payment_html_display(data, product, price, kobans, false, $but, $buy, $but.attr("text"));
                prepareCheckout($but)
            };
            handlePaymentAjaxResponce(data, callback)
        })
    }
}

function prepareCurrentPathURL() {
    var pathname = window.location.href.split(document.domain)[1].slice(1);
    return pathname
}

function prepareCheckout($button, info) {
    var $checkoutBox = $(".checkout").removeClass("monthly_card bundles");
    var $finalElement = "";
    var priceHtml = "";
    var finalWidth = 0;
    if ($button) {
        var text = $button.attr("checkout-price") || $button.text();
        var cost = [GT.design.quest_cost, text];
        priceHtml = '<div class="product-price"><span class="product-cost">' + cost[0] + ": </span>" + cost[1];
        var $parent = $button.parent();
        $finalElement = $parent.clone();
        $finalElement.find("button").remove();
        if ($parent.is(".monthly_card")) {
            $finalElement.find("button, .expires, .product-active-checkbox").hide();
            $finalElement.find(".product-normal-price").show();
            $checkoutBox.addClass("monthly_card");
            if (!is_mobile_size()) $("#no_HC").addClass("extended")
        } else if ($parent.is(".bundles")) {
            $finalElement.find("button, .product-info, p.normal_price, .fixed_blocks, .product-active-checkbox, .headline-bundle").hide();
            $checkoutBox.addClass("bundles");
            $checkoutBox.find(".product-wrapper").css({
                margin: "-17px 8px 10px"
            });
            if (!is_mobile_size()) $("#no_HC").addClass("extended");
            $finalElement.find(".checkout-bundle-version").show()
        } else if ($parent.is(".season_pass_tab")) {
            $finalElement.css({
                position: "relative",
                width: "250px",
                height: "320px"
            });
            $finalElement.find("#payments_season_pass_title, #payments_season_pass_sub_title, #sp_image_container, #value_sp, #available_time, #left_girl_sp, #right_girl_sp, #normal_price, #pay_button_sp").hide();
            $finalElement.find("#season_pass_icon_section").show();
            priceHtml = '<div class="price_sp_payments"><span class="product-cost">' + cost[0] + ': </span><span style= "font-size:22px; line-height: 22px;">' + cost[1] + "</span>"
        }
    } else {
        var _info = _slicedToArray(info, 4),
            price = _info[0],
            kobans = _info[1],
            image = _info[2],
            id_offer = _info[3];
        var _cost = [GT.design.quest_cost, price];
        var currency = image == "kobans" ? "hard_currency" : "soft_currency";
        var offerImage = IMAGES_URL + "/pictures/design/payments/ic_popup_offer_" + image + ".png";
        var offerName = id_offer == 7 ? GT.design["starter_offer_name"] : GT.design["special_offer_name"];
        $checkoutBox.removeClass("monthly_card");
        priceHtml = '<div class="product-price offer"><span class="product-cost">' + _cost[0] + ": </span>" + _cost[1];
        $finalElement = '<div class="product-wrapper offer gold-border-box">\n\t\t\t\t\t\t\t<div class="product-background inner-shadows">\n\t\t\t\t\t\t\t\t<div class="product-info">\n\t\t\t\t\t\t\t\t\t<div class="offer-name">' + offerName + '</div>\n\t\t\t\t\t\t\t\t\t<img class="offer-currency" src="' + IMAGES_URL + "/design/ic_" + currency + '.png" />\n\t\t\t\t\t\t\t\t\t<div class="offer-currency-amount">' + kobans + '</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<img class="offer-image" src="' + offerImage + '" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>'
    }
    $checkoutBox.children().remove();
    $checkoutBox.html($finalElement);
    $checkoutBox.append(priceHtml);
    $("#payment-checkout-page").css("display", "flex").prepend($checkoutBox.clone().css("display", "inline-block"));
    $(".payments-container").find(".contact, .secured_payment").addClass("repositioned")
}

function openOfferPayment(_ref) {
    var price = _ref.price,
        currency = _ref.currency,
        kobans = _ref.kobans,
        productId = _ref.productId,
        id_offer = _ref.id_offer,
        image = _ref.image;
    var currencies = {
        EUR: "в‚¬",
        USD: "$",
        CHF: "CHF",
        JPY: "ВҐ",
        RUB: "в‚Ѕ",
        AUD: "AUD",
        CAD: "CAD",
        GBP: "ВЈ"
    };
    loadingAnimation.start();
    hh_ajax({
        class: "Hero",
        action: "check_offer",
        id_offer: id_offer
    }, function(data) {
        if (data.available === false && data.id_offer == id_offer) {
            popup_message("Offer not available.");
            $("." + id_offer).hide();
            return
        }
        if ((HH_UNIVERSE.startsWith("dev_h") || HH_UNIVERSE == "test_h") && Hero.infos.on_prod_server) {
            HHPopupManager.show("no_HC", {
                prevent_events: true
            });
            loadingAnimation.stop();
            return
        }
        var params = {
            class: "Payment",
            id_product: productId,
            nb: kobans
        };
        if (hh_nutaku || typeof hh_eroges != "undefined") {
            var buy = {
                id: productId,
                cost: price * 100,
                nb: kobans,
                offer: true
            };
            if (name == "reactivating_offer") buy.name = number_format_lang(5e7);
            else buy.name = buy.nb + " Kobans";
            if (hh_nutaku) {
                HH_Nutaku.payment(buy);
                loadingAnimation.stop()
            } else {
                hh_ajax(params, function(data) {
                    loadingAnimation.stop();
                    buy["publicKey"] = data.publicKey;
                    buy["hash"] = data.hash;
                    buy["tr_id"] = data.tr_id;
                    buy["cost"] = data.price;
                    buy["name"] = data.name;
                    buy["entities"] = data.entities;
                    hh_eroges.payment(buy)
                })
            }
        } else if (typeof hh_thrix != "undefined") hh_ajax(params, hh_thrix.payment);
        else if (typeof hh_esprit != "undefined") hh_ajax(params, hh_esprit.payment);
        else {
            params.url_back = prepareCurrentPathURL();
            hh_ajax(params, function(data) {
                var callback = function callback() {
                    loadingAnimation.stop();
                    price += " " + currencies[currency];
                    payment_html_display(data, productId, price, kobans, true);
                    prepareCheckout(undefined, [price, kobans, image, id_offer]);
                    HHPopupManager.show("no_HC", {
                        prevent_events: true
                    })
                };
                handlePaymentAjaxResponce(data, callback)
            })
        }
    })
}

function hh_cancel_subscription() {
    var monthly_card_params = {
        class: "Hero",
        action: "get_mc_info"
    };
    hh_ajax(monthly_card_params, function(data) {
        var cancel_subscription_params = {
            class: "Payment",
            action: "cancel_subscription",
            id_subscription: data.monthly_card_data.id_subscription
        };
        hh_ajax(cancel_subscription_params, function(data) {
            window.mc_info.subscription_active = false;
            modifyMonthlyCardTab()
        })
    })
}

function displayPaymentTabs() {
    var tab = $(".payment-tabs").find(".active").attr("type");
    $("#no_HC .payment_box").each(function() {
        var method = $(this).attr("method");
        $(this).toggle(!!$(".tab." + tab + ' .purchase_box[method="' + method + '"]').length)
    });
    var method = $("#no_HC .payment_box.selected").attr("method");
    var $currentMethod = $('#no_HC .payment_box[method="' + method + '"]');
    if (method != undefined && $currentMethod.css("display") != "none") $currentMethod.click();
    else {
        if (is_mobile()) {
            var $mobile = $('#no_HC .payment_box[method="mobile"]');
            var $sms = $('#no_HC .payment_box[method="sms"]');
            if ($mobile.css("display") != "none") $mobile.click();
            else if ($sms.css("display") != "none") $sms.click();
            else $("#no_HC .payment_box").first().click()
        } else {
            $("#no_HC .payment_box").each(function() {
                var $box = $(this);
                if ($box.css("display") != "none") {
                    $box.click();
                    return false
                }
            })
        }
    }
}

function handlePaymentAjaxResponce(data, callback) {
    if (data.destination) top.location.href = data.destination;
    else if (data.redirect_params) return makeRedirectTransaction(data.redirect_params);
    else if (typeof callback == "function") callback();
    else console.log("Unsuported case for payment ajax handle. callback() was not passed. ")
}

function makeRedirectTransaction(redirect_data) {
    var location = redirect_data.url;
    var params = redirect_data.params;
    switch (redirect_data.redirect_method) {
        case "get":
            top.location.href = location;
            break;
        case "post":
            makePostRedirect(location, params);
            break
    }
}
var hh_pay = {
    tries: 0,
    max_tries: 4,
    time_list: {
        0: 5,
        1: 10,
        2: 20,
        3: 30,
        4: 60
    },
    wait: function wait(trid) {
        var span = $("#popup_message div span");
        var cpt = hh_pay.time_list[hh_pay.tries];
        var i = setInterval(function() {
            if (cpt <= 0) {
                clearInterval(i);
                hh_ajax({
                    class: "Payment",
                    action: "check_tr",
                    trid: trid,
                    tries: hh_pay.tries
                }, function(data) {
                    if (data.retry && hh_pay.tries <= hh_pay.max_tries) {
                        hh_pay.tries++;
                        hh_pay.wait(trid);
                        return
                    }
                    if (data.error) {
                        HHPopupManager.closeLastOpenedPopup();
                        payment_failed_popup(data.error);
                        return
                    }
                    if (data.hc && data.hc > 0) {
                        Hero.update("hard_currency", data.hc, true)
                    } else if (data.sc && data.sc > 0) {
                        Hero.update("soft_currency", data.sc, true)
                    }
                    HHPopupManager.closeLastOpenedPopup();
                    if (data.reload) {
                        document.location.replace(document.location.href.split(/[?#]/)[0])
                    }
                })
            } else {
                span.text(cpt);
                cpt--
            }
        }, 1e3)
    },
    direct: function direct(amount, what) {
        what = what || "hard_currency";
        setTimeout(function() {
            Hero.update(what, amount, true)
        }, 500)
    }
};

function changeContent(action) {
    var tab = $("h4.active").attr("type");
    var $elements = $(".choose_product, #payment_options, #choose_country, .payment-tabs, .tab." + tab);
    switch (action) {
        case "show":
        case "hide":
            $elements[action]();
            break;
        default:
            throw new Error("Unsupported operation for payments content change: " + action)
    }
}

function payment_html_display(data, idProduct, price, kobans, isCustom, $but, $buy, text) {
    if (data.force_popup) popup_message(data.message);
    window.isTransactionFinished = false;
    changeContent("hide");
    isCustom = isCustom || false;
    var $disclaimer = $(".payment-disclaimer-text");
    var originalDisclaimer = $disclaimer.html();
    $disclaimer.text("");
    var newDisclaimerText = "";
    if (!isCustom) {
        $("#no_HC div.close_cross").before($("#payment-checkout-page-helper>#return-to-products"));
        price = $but.html()
    }
    $(".payments-left-girl, .payments-right-girl").hide();
    $("#payment-checkout-page").show().html(data.html).show();
    $("#payment-checkout-page").attr("id_product", data.id_product);
    if (!isCustom && data.processor == "hipaysc") {
        $(".container>.numText>button").addClass("orange_text_button");
        $("#hp_button_retry>button").addClass("blue_text_button");
        hipaysc.countdown = function(event, $tag_to_update) {
            $tag_to_update.html(format_time_short(event.offset.totalSeconds))
        }
    }
    var isProperCase = $but && $but.attr("type") == "monthly_card" && $but.attr("level") == "2";
    if (isProperCase && window.mc_info.active && window.mc_info.subscription_active && window.mc_info.level == 1) newDisclaimerText += '<span class="red">' + GT.design.monthly_card_note + "</span> " + GT.design.monthly_card_upgrade_note;
    $disclaimer.addClass("disclaimer-checkout").html(newDisclaimerText);
    var callback = function callback() {
        var iframe = document.getElementById("eggs-payment-iframe");
        var transaction_id = iframe && iframe.contentWindow.transaction_id ? iframe.contentWindow.transaction_id : false;
        var is_transaction_in_progress = iframe && iframe.contentWindow.is_transaction_in_progress ? iframe.contentWindow.is_transaction_in_progress : false;
        if (is_transaction_in_progress) {
            popup_message(GT.design.payment_still_processing)
        } else {
            changeContent("show");
            $(".repositioned").removeClass("repositioned");
            $("#payment-checkout-page, .checkout, .securion_disclaimer_textarea").hide();
            $disclaimer.removeClass("disclaimer-checkout").html(originalDisclaimer);
            $("#no_HC").removeClass("extended");
            if (!isCustom) {
                $("#return-to-products").appendTo("#payment-checkout-page-helper");
                $buy.prop("disabled", false)
            }
        }
    };
    if (!isCustom) {
        $("#no_HC .return_arrow").off("click");
        $("#no_HC .return_arrow").click(callback)
    }
}

function load_payments(desiredTab) {
    loadingAnimation.start($("#no_HC"));
    var country = $("#choose_country select").val() || $("[country]").attr("country");
    var params = {
        class: "Payment",
        country: country
    };
    hh_ajax(params, function(data) {
        loadingAnimation.stop();
        var $cp = $(".tab.payments .choose_product");
        var $mc_content = $(".tab.monthly_card .choose_product");
        $cp.children(".purchase_box").remove();
        $cp.prepend(data.html);
        if (data.has_mc_product) {
            $mc_content.children().remove();
            $mc_content.prepend(data.html_mc)
        }
        if (data.html_offers) {
            var $bundles = $(".tab.bundles .scrolling_area");
            var createScroll = $bundles.find(".nicescroll-rails").length;
            $bundles.children().remove();
            $bundles.append(data.html_offers);
            $bundles.find(".slot").addClass("mid_sized_slot");
            if ($bundles.find(".purchase_box").length > 1) {
                if (createScroll) {
                    $bundles.getNiceScroll().remove();
                    $bundles.niceScroll()
                } else $bundles.niceScroll().resize();
                animatedBundleScroll()
            }
            var $timers = $bundles.find("[time-stamp]");
            if ($timers.length) {
                $timers.each(function(index, element) {
                    var $timer = $(element);
                    var endTime = parseInt($timer.attr("time-stamp"), 10) - Date.now() / 1e3;
                    HHTimers.initSimpleTimerTxt($timer.find('[rel="expires"]'), endTime, reload, GT.design.expires_in)
                })
            }
        }
        if (data.html_season_pass) {
            var $seasonPass = $(".tab.season_pass .choose_product");
            $seasonPass.children().remove();
            $seasonPass.append(data.html_season_pass);
            var $timer = $seasonPass.find(".timer");
            var endTime = parseInt($timer.attr("time-stamp"));
            HHTimers.initSimpleTimerTxt($timer.find('[rel="expires"]'), endTime, reload, GT.design.expires_in)
        } else {
            $('h4[type="season_pass"]').remove()
        }
        if (data.html_daily_rewards && data.html_daily_rewards.indexOf("NO CONTENT") == -1) $(".tab.daily_rewards .choose_product").html(data.html_daily_rewards);
        else $(".daily_rewards").hide();
        this.switchToBundleOffers();
        var tab = desiredTab || $(".payment-tabs").find(".active").attr("type");
        $(".payment-tabs").children().removeClass("active").filter("." + tab).click()
    })
}

function findSelectedPaymentMethod() {
    var selected_payment_method = $(".payment_box.selected").attr("method");
    if (!selected_payment_method) {
        selected_payment_method = $(".monthly_card .purchase_box").first().attr("method")
    }
    return selected_payment_method
}

function modifyMonthlyCardTab() {
    displayProperMCProducts();
    var activeLevel = 0;
    var decimalDaysLeft = 0;
    for (var level in cardsDefinitions) {
        var currentCard = cardsDefinitions[level];
        var selected_payment_method = findSelectedPaymentMethod();
        var $currentCard = $('.purchase_box[method="' + selected_payment_method + '"] .monthly_card[level="' + level + '"]');
        if (currentCard.isActive) {
            activeLevel = level;
            $currentCard.parent().addClass("active");
            $currentCard.find(".product-active-checkbox").show();
            decimalDaysLeft = currentCard.endTimeInfo.decimalDaysLeft;
            if (currentCard.isSubscriptionActive) {
                $currentCard.find("button.auto-renew").show();
                $currentCard.find(".buy").hide();
                if (currentCard.daysRecurring) {
                    var text = $currentCard.find(".extends").text().replace("[number]", currentCard.daysRecurring);
                    $currentCard.find(".extends").show().text(text)
                }
            } else {
                $currentCard.find(".extends, .auto-renew, .product-normal-price").hide();
                $currentCard.find("button.extend").show();
                var daysLeft = currentCard.endTimeInfo.daysLeft;
                var $expires = daysLeft ? $currentCard.find(".expires").not(".today") : $currentCard.find(".expires.today");
                if (daysLeft) $expires.show().find(">span").text(daysLeft);
                else $expires.show()
            }
        } else if (currentCard.isDefaultView) {
            $(".tab.monthly_card .buy, .tab.monthly_card .product-normal-price").show()
        } else if (currentCard.isLowerLevel) {
            $currentCard.find("button.buy").show().prop("disabled", true);
            var _text = '<span class="green">' + GT.design.monthly_card_note + "</span> " + GT.design.monthly_card_recalculation;
            $(".payment-disclaimer-text").html(_text)
        } else {
            $currentCard.find(".product-normal-price, button.upgrade").show();
            var plusDays = Math.ceil(decimalDaysLeft / (currentCard.price / cardsDefinitions[activeLevel].price));
            var html = GT.design.monthly_card_duration_new.replace("[added_days]", '<span class="added-days-highlight">+' + plusDays + "<sup>*</sup></span>");
            $currentCard.find(".mc-duration").html(html)
        }
    }
}
var cardsDefinitionsDefault = {
    1: {
        price: 2.99
    },
    2: {
        price: 9.99
    },
    3: {
        price: 29.99
    }
};
var cardsDefinitions = {};

function updateMCDefinitions() {
    cardsDefinitions = $.extend(true, {}, cardsDefinitionsDefault);
    var purchasedLevel = window.mc_info ? window.mc_info.level : 0;
    var isActive = window.mc_info && window.mc_info.active;
    for (var level in cardsDefinitions) {
        cardsDefinitions[level].isDefaultView = !isActive;
        if (level == purchasedLevel) {
            cardsDefinitions[level].isActive = isActive;
            cardsDefinitions[level].isExpired = window.mc_info && window.mc_info.expired;
            cardsDefinitions[level].endTimeInfo = calculateTime(window.mc_info.server_time, window.mc_info.end_js);
            cardsDefinitions[level].isSubscriptionActive = window.mc_info.subscription_active;
            if (cardsDefinitions[level].isSubscriptionActive) cardsDefinitions[level].daysRecurring = calculateTime(window.mc_info.server_time, window.mc_info.next_charge_js).daysLeft
        }
        cardsDefinitions[level].isLowerLevel = level < purchasedLevel
    }
}

function displayProperMCProducts() {
    updateMCDefinitions();
    var $arrows = $(".mc-arrows").hide();
    var $products = $(".monthly_card .purchase_box").hide();
    var selected_payment_method = findSelectedPaymentMethod();
    for (var level in cardsDefinitions) {
        level = parseInt(level, 10);
        if (cardsDefinitions[level].isDefaultView) {
            $products.filter('[method="' + selected_payment_method + '"][level="1"], [method="' + selected_payment_method + '"][level="2"]').show();
            $arrows.filter(".right").show()
        } else if (cardsDefinitions[level].isActive || cardsDefinitions[level].isExpired) {
            var otherCardLevel = cardsDefinitions[level + 1] ? level + 1 : level - 1;
            $products.filter('[method="' + selected_payment_method + '"][level="' + level + '"], [method="' + selected_payment_method + '"][level="' + otherCardLevel + '"]').show();
            if (level === 1) {
                $arrows.filter(".right").show()
            } else {
                $arrows.filter(".left").show()
            }
        }
    }
}
var isBundleScrollAnimated = false;

function animatedBundleScroll() {
    if (isBundleScrollAnimated) return;
    isBundleScrollAnimated = true;
    var i = 1;
    var isIncreasing = false;
    var iterationCounter = 0;
    var interval = setInterval(function() {
        $(".bundles .nicescroll-rails").css({
            opacity: i
        });
        if (!isIncreasing) i -= .05;
        else i += .05;
        var currentValue = i.toFixed(2);
        if (currentValue == "0.30") isIncreasing = true;
        else if (currentValue == "1.00") isIncreasing = false;
        iterationCounter++;
        if (iterationCounter == 150) {
            clearInterval(interval);
            isBundleScrollAnimated = false;
            $(".bundles .nicescroll-rails").css({
                opacity: 1
            })
        }
    }, 100)
}

function useEggsTransaction(transaction_id, subscription_info) {
    var params = {
        class: "Payment",
        action: "use_transaction",
        transaction_id: transaction_id,
        subscription_info: subscription_info
    };
    hh_ajax(params, function(data) {
        $("#payment-checkout-page").hide();
        $("#return-to-products").appendTo("#payment-checkout-page-helper");
        changeContent("show");
        HHPopupManager.closeLastOpenedPopup();
        if (data.recurring) animateMonthlyCardDays();
        if (data.product_type === "season_pass") {
            var url = document.location.href;
            document.location.replace(url + "?payment=0")
        } else {
            displayPendingRewards(true)
        }
        if (data.id_offer && $("." + data.id_offer)) {
            $("." + data.id_offer).remove()
        }
    })
}

function handleSubscription(transaction_data) {
    var params = {
        class: "Payment",
        action: "save_subscription",
        subscription_info: transaction_data.subscription_info
    };
    hh_ajax(params, function(data) {
        $("#payment-checkout-page").hide();
        $("#return-to-products").appendTo("#payment-checkout-page-helper");
        changeContent("show");
        HHPopupManager.closeLastOpenedPopup();
        window.mc_info = null;
        useEggsTransaction(transaction_data.transaction_id, transaction_data.subscription_info)
    })
}

function switchToBundleOffers() {
    var paymentElements = $("#payment-checkout-page");
    paymentElements.css("display", "none");
    changeContent("show");
    $(".payments-left-girl, .payments-right-girl").toggle(!is_mobile_size())
}

function closeLastOpenedPopupMessage() {
    if (HHPopupManager.getLastOpenedPopup() == "popup_message") HHPopupManager.closeLastOpenedPopup()
}
$(function() {
    if (Hero.infos.guest) return;
    window.mc_info = null;
    window.addEventListener("message", function(message) {
        var data = message.data;
        if (data.action == "trigger_popup") {
            closeLastOpenedPopupMessage();
            popup_message(data.text)
        } else if (data.action == "transactionSuccessful") {
            closeLastOpenedPopupMessage();
            window.isTransactionFinished = true;
            useEggsTransaction(data.transaction_id)
        } else if (data.action == "subscriptionSuccessful") {
            handleSubscription(data)
        }
    });
    $("h4.payments, h4.monthly_card, h4.bundles, h4.season_pass, h4.daily_rewards").click(function() {
        var $tab = $(this);
        var $payments_left_girl = $(".payments-left-girl");
        var $payments_right_girl = $(".payments-right-girl");
        if ($tab.hasClass("active")) return;
        if (!is_mobile_size()) {
            $payments_left_girl.show();
            $payments_right_girl.show()
        }
        $(".payment-disclaimer-text").text("");
        $(".payments, .monthly_card, .bundles, .season_pass, .daily_rewards").removeClass("active");
        $tab.addClass("active");
        displayPaymentTabs();
        if ($tab.hasClass("payments")) {
            $(".tab.monthly_card, .tab.bundles, .tab.season_pass, .tab.daily_rewards").hide();
            $(".tab.payments").show()
        } else if ($tab.hasClass("monthly_card")) {
            $(".tab.payments, .tab.bundles, .tab.season_pass, .tab.daily_rewards").hide();
            $(".tab.monthly_card").show();
            $(".tab.monthly_card .choose_product").children().hide();
            if (window.mc_info == null) {
                var params = {
                    class: "Hero",
                    action: "get_mc_info"
                };
                hh_ajax(params, function(data) {
                    window.mc_info = data.monthly_card_data;
                    modifyMonthlyCardTab()
                })
            } else modifyMonthlyCardTab()
        } else if ($tab.hasClass("bundles")) {
            $(".tab.monthly_card, .tab.payments, .tab.season_pass, .tab.daily_rewards").hide();
            $(".tab.bundles").show();
            var $scrollingArea = $(".tab.bundles .scrolling_area");
            if ($scrollingArea.find(".nicescroll-rails").length) $scrollingArea.niceScroll().resize();
            else $scrollingArea.niceScroll();
            animatedBundleScroll()
        } else if ($tab.hasClass("season_pass")) {
            $(".tab.monthly_card, .tab.payments, .tab.bundles, .tab.daily_rewards").hide();
            $payments_left_girl.hide();
            $payments_right_girl.hide();
            $(".tab.season_pass").show();
            var _$scrollingArea = $(".tab.season_pass .scrolling_area");
            if (_$scrollingArea.find(".nicescroll-rails").length) _$scrollingArea.niceScroll().resize();
            else _$scrollingArea.niceScroll()
        } else if ($tab.hasClass("daily_rewards")) {
            $(".tab.monthly_card, .tab.payments, .tab.bundles, .tab.season_pass").hide();
            $payments_left_girl.hide();
            $payments_right_girl.hide();
            $(".tab.daily_rewards").show()
        }
    });
    $("body").on("click", ".mc-arrows", function() {
        $(".mc-arrows").toggle();
        var selected_payment_method = findSelectedPaymentMethod();
        var $cards = $('.monthly_card .purchase_box[method="' + selected_payment_method + '"]');
        if ($(this).hasClass("left")) {
            $cards.first().show();
            $cards.last().hide()
        } else {
            $cards.first().hide();
            $cards.last().show()
        }
    });
    var $requestedTimer = $("div.tab.bundles div.fixed_blocks .loading");
    if ($requestedTimer.length) {
        var remainingTime = parseInt($requestedTimer.attr("time"), 10);
        if (remainingTime > 0) {
            HHTimers.initBarTimer(3600, remainingTime, $requestedTimer, {
                barElm: $requestedTimer.find(".bar"),
                textElm: $requestedTimer.find('[rel="timer"]')
            }, reload)
        }
    }
    $("#choose_country select").change(function() {
        load_payments()
    });
    $("#no_HC .payment_box").on("click", function() {
        var $element = $(this);
        $element.siblings().removeClass("selected");
        $element.addClass("selected");
        var selected_tab = $(".payment-tabs").find(".active").attr("type");
        if (selected_tab === "monthly_card") {
            modifyMonthlyCardTab()
        } else {
            var method = $element.attr("method");
            $("#no_HC .purchase_box").hide();
            $('#no_HC .purchase_box[method="' + method + '"]').show()
        }
    });
    $("#choose_country select").selectric({
        optionsItemBuilder: function optionsItemBuilder(itemData) {
            return itemData.value.length ? '<span class="country country-' + itemData.value.toLowerCase() + '"></span>' + itemData.text : itemData.text
        },
        labelBuilder: function labelBuilder(currItem) {
            return '<span class="ico ico-' + currItem.value + " country country-" + currItem.value.toLowerCase() + '"></span>'
        },
        onOpen: function onOpen() {
            $(".selectric-scroll").niceScroll()
        }
    })
});
var _slicedToArray = function() {
    function sliceIterator(arr, i) {
        var _arr = [];
        var _n = true;
        var _d = false;
        var _e = undefined;
        try {
            for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
                _arr.push(_s.value);
                if (i && _arr.length === i) break
            }
        } catch (err) {
            _d = true;
            _e = err
        } finally {
            try {
                if (!_n && _i["return"]) _i["return"]()
            } finally {
                if (_d) throw _e
            }
        }
        return _arr
    }
    return function(arr, i) {
        if (Array.isArray(arr)) {
            return arr
        } else if (Symbol.iterator in Object(arr)) {
            return sliceIterator(arr, i)
        } else {
            throw new TypeError("Invalid attempt to destructure non-iterable instance")
        }
    }
}();
var Reward = {
    handlePopup: function handlePopup(reward) {
        var _this = this;
        var rewardDefaults = {
            heroChangesUpdate: {},
            title: "",
            sub_title: "",
            redirectUrl: ""
        };
        for (var property in rewardDefaults) {
            reward[property] = reward.hasOwnProperty(property) ? reward[property] : rewardDefaults[property]
        }
        reward.levelUp = reward.heroChangesUpdate && reward.heroChangesUpdate.level;
        var $rewardPopup = $("#rewards_popup");
        var $scrollingArea = $rewardPopup.find("#reward_holder>.container>.scrolling_area");
        var $rewardsTitle = $rewardPopup.find("h1");
        var $rewardsSubTitle = $rewardPopup.find("h3");
        if (reward.lose) {
            $rewardsTitle.addClass("losing");
            $rewardPopup.find(".info_container").show()
        } else {
            $rewardsTitle.removeClass("losing");
            $rewardPopup.find(".info_container").hide();
            if (reward.heroChangesUpdate) {
                if (reward.heroChangesUpdate.hasOwnProperty("energy_fight")) objectivePopup.popOverlayPoints();
                else if (reward.hasOwnProperty("lose")) objectivePopup.popOverlayPoints()
            }
        }
        var rewardsInfo = reward.data || reward.list || {};
        if (rewardsInfo.season_pass || rewardsInfo.MC) {
            var openCallback = function openCallback() {
                $rewardsTitle.html(reward.title);
                $scrollingArea.html(RewardsBuilder.buildHtml(reward))
            };
            HHPopupManager.show("rewards_popup", {
                open_callback: openCallback,
                no_close: true
            }, reload)
        } else if (rewardsInfo && !(rewardsInfo.girlAnimation || rewardsInfo.draft)) {
            $rewardsTitle.html(reward.title || GT.design.Reward);
            $rewardsSubTitle.html(reward.sub_title);
            if (reward.sub_title.length > 70) $rewardsSubTitle.addClass("minimized");
            $scrollingArea.html(RewardsBuilder.buildHtml(reward));
            var _openCallback = function _openCallback() {
                $("#reward_holder").css({
                    margin: "20px 0"
                });
                if (reward.lose) $rewardPopup.find(".line").addClass("losing")
            };
            var girls = rewardsInfo.girls,
                surplus_item = rewardsInfo.surplus_item;
            var callback = rewardsInfo.girls ? function() {
                _this._girlAnimationCallback(girls, surplus_item, reward.redirectUrl, rewardsInfo.can_reroll);
                _this.updateHeroValues(reward.heroChangesUpdate)
            } : function() {
                _this.updateHeroValues(reward.heroChangesUpdate)
            };
            HHPopupManager.show("rewards_popup", {
                open_callback: _openCallback,
                no_close: true
            }, callback)
        } else if (rewardsInfo.girls) {
            var _girls = rewardsInfo.girls,
                _surplus_item = rewardsInfo.surplus_item,
                draft = rewardsInfo.draft;
            $rewardsTitle.html(reward.title || GT.design.Reward);
            $scrollingArea.html(RewardsBuilder.buildHtml({
                data: {
                    girls: _girls,
                    surplus_item: _surplus_item,
                    draft: draft
                }
            }));
            var girlsWon = _girls.length;
            var _callback = void 0;
            if (girlsWon > 1 && !draft) {
                var newGirls = _girls.slice(1);
                _callback = function _callback() {
                    _this._girlAnimationCallback(newGirls, _surplus_item, reward.redirectUrl)
                }
            } else reward.isClosable = true;
            var _openCallback2 = function _openCallback2() {
                var margin = draft ? "160px 0" : "120px 0";
                $("#reward_holder").css({
                    margin: margin
                });
                _this.updateHeroValues(reward.heroChangesUpdate);
                if (Hero.infos.hard_currency < hh_prices.pachinko2reroll) $(".reroll-block button").attr("disabled", true)
            };
            HHPopupManager.show("rewards_popup", {
                open_callback: _openCallback2,
                no_close: true,
                canReroll: rewardsInfo.can_reroll,
                draft: draft
            }, _callback);
            if (rewardsInfo.draft) this.draftGiftsUpdate(_girls);
            else this._wonGirlAnimation(_girls[0])
        }
        if (reward.callback) {
            if (typeof window[reward.callback] === "function") window[reward.callback](reward.callbackArgs);
            else Reward[reward.callback](reward.callbackArgs)
        }
        $("#rewards_popup").find("button").click(function() {
            _this._handlePopupClose(reward)
        });
        $("body").on("enter_pressed_event", function() {
            _this._handlePopupClose(reward)
        }).on("escape_pressed_event", function() {
            _this._handlePopupClose(reward)
        })
    },
    _handlePopupClose: function _handlePopupClose(reward) {
        var isGirlAnimationRunning = reward.data && reward.data.girls && reward.data.girls.length && !reward.isClosable;
        if (reward.redirectUrl && !reward.levelUp && !isGirlAnimationRunning) window.location.href = reward.redirectUrl
    },
    _girlAnimationCallback: function _girlAnimationCallback(girls, surplus_item, url, can_reroll) {
        this.handlePopup({
            data: {
                girls: girls,
                surplus_item: surplus_item,
                girlAnimation: true,
                can_reroll: can_reroll
            },
            redirectUrl: url
        })
    },
    _wonGirlAnimation: function _wonGirlAnimation(_ref) {
        var value = _ref.value,
            name = _ref.name;
        var $shardsCounter = $('#rewards_popup [name="' + name + '"] p>span');
        setTimeout(function() {
            $(".masked_girl .gradient").css({
                "z-index": 3
            }).addClass("fill_girl");
            anim_number($shardsCounter, value, -100);
            setTimeout(function() {
                $(".gradient, .girl_border_glow").fadeOut()
            }, 1500);
            var shardsLeft = value - 100;
            if (shardsLeft > 0) {
                var $bonusText = $("span.bonus");
                setTimeout(function() {
                    $bonusText.addClass("animated");
                    setTimeout(function() {
                        $bonusText.removeClass("animated").hide();
                        $('[id_item="15"]').fadeIn().addClass("slide_left");
                        anim_number($shardsCounter, shardsLeft, -shardsLeft);
                        anim_number($('[id_item="15"] .stack_num span'), 0, shardsLeft)
                    }, 1e3)
                }, 2200)
            }
        }, 600)
    },
    draftGiftsUpdate: function draftGiftsUpdate(_ref2) {
        var _ref3 = _slicedToArray(_ref2, 2),
            leftGirl = _ref3[0],
            rightGirl = _ref3[1];
        var shardsLeft = leftGirl.value - 100;
        $('.left [id_item="15"] .stack_num span').text(shardsLeft);
        var shardsright = rightGirl.value - 100;
        $('.right [id_item="15"] .stack_num span').text(shardsright)
    },
    updateHeroValues: function updateHeroValues(values) {
        if (!values) return;
        Hero.updates(values, false);
        if (values.level) {
            var $level = $("#leagues_left .level, #lead_left .level");
            if ($level.length) $level.text(values.level)
        }
    },
    handleBattleEnd: function handleBattleEnd() {
        $('#battle .battle_balloon, #battle [rel="skip"]').remove();
        $("body.page-battle").addClass("battleEnded")
    },
    handleLeaguesRewardsPopup: function handleLeaguesRewardsPopup() {
        var callback = function callback() {
            $(".forced_info").hide();
            $(".leagues_table").show();
            $(".leagues_table .lead_table_view").getNiceScroll().resize()
        };
        HHPopupManager.setCallback("rewards_popup", callback)
    },
    handleMissionPopup: function handleMissionPopup(inputArgs) {
        if (!$(".missions_wrap > .mission_object").length) {
            if (!inputArgs.isGiftClaimed) {
                inputArgs.displayGift();
                $("#missions_counter").hide()
            } else {
                inputArgs.displayAfterGift();
                $(".end_gift").hide()
            }
        }
        $('#missions button[rel="claim"]').addClass("button_glow").prop("disabled", false)
    }
};
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var HHTab = function() {
    function HHTab(list_tabs, default_tab, page, display) {
        _classCallCheck(this, HHTab);
        this.first_tab = "";
        this.default_tab = default_tab;
        this.page = "hh_tab-" + page;
        this.list_tabs = list_tabs;
        this.tabs_length = list_tabs.length;
        this.display = display;
        this.init()
    }
    _createClass(HHTab, [{
        key: "init",
        value: function init() {
            var _this = this;
            this.first_tab = this.identifyTab();
            this.showTab(this.first_tab);
            window.onpopstate = function(event) {
                if (event.state && event.state.tab) {
                    _this.showTab(event.state.tab)
                } else {
                    _this.showTab(_this.first_tab)
                }
            };
            var selector = "h4." + this.list_tabs.join(", h4.");
            var self = this;
            $(selector).click(function() {
                if (!$(this).hasClass("selected")) self.changeTab($(this));
                self.notificationToggle()
            })
        }
    }, {
        key: "showTab",
        value: function showTab(tab) {
            $("h4").removeClass("selected");
            $("h4." + tab).addClass("selected");
            for (var i = 0; i < this.tabs_length; i++) {
                $("#" + this.list_tabs[i]).hide()
            }
            this.slideTab(tab);
            this.toggleContent(tab);
            this.notificationToggle();
            if (this.display) {
                $("#" + tab).css("display", this.display)
            } else {
                $("#" + tab).show()
            }
        }
    }, {
        key: "identifyTab",
        value: function identifyTab() {
            for (var i = 0; i < this.tabs_length; i++) {
                if ($.getQueryParam("tab") == this.list_tabs[i]) {
                    return this.list_tabs[i]
                }
            }
            if (this.default_tab === "") {
                this.default_tab = localStorageGetItem(this.page) ? localStorageGetItem(this.page) : this.list_tabs[0]
            }
            return this.default_tab
        }
    }, {
        key: "changeTab",
        value: function changeTab(event, tab) {
            if (!tab) tab = $(event).attr("rel");
            this.showTab(tab);
            var url = window.location.href;
            if (url.match(/(?:\&|\?)tab=/)) {
                var tabRegex = /(\&|\?)tab=[^&]*/;
                url = url.replace(tabRegex, "$1tab=" + tab)
            } else {
                url = url_add_param(url, "tab=" + tab)
            }
            history.pushState({
                tab: tab
            }, tab, url);
            localStorageSetItem(this.page, tab)
        }
    }, {
        key: "slideTab",
        value: function slideTab(tab) {
            var $slider = $(".tabs>.slider");
            if (!$slider.length) return;
            var $tab = $(".tabs>h4." + tab);
            var w = $tab.css("width");
            var left = 0;
            left += parseInt($tab.css("margin-left"), 10);
            var $all_tabs = $tab.prevAll().not(".slider");
            if ($all_tabs.length) {
                $all_tabs.each(function() {
                    var $me = $(this);
                    left += parseInt($me.css("margin-left"));
                    left += $me.width();
                    left += parseInt($me.css("margin-right"))
                })
            }
            $slider.css({
                width: w,
                left: left + "px"
            })
        }
    }, {
        key: "notificationToggle",
        value: function notificationToggle() {
            var _this2 = this;
            var _loop = function _loop(i) {
                var $collectNotif = $("." + _this2.list_tabs[i] + " .collect_notif");
                $collectNotif.hide();
                $collectNotif.removeClass("collect_notif_active");
                $("#" + _this2.list_tabs[i]).find('button[rel="claim"], button[rel="pop_claim"], button[rel="pop_thumb_claim"]').each(function() {
                    if ($(this).css("display") != "none") {
                        $collectNotif.show();
                        return
                    }
                })
            };
            for (var i = 0; i < this.tabs_length; i++) {
                _loop(i)
            }
            $("." + this.identifyTab() + " .collect_notif").addClass("collect_notif_active")
        }
    }, {
        key: "toggleContent",
        value: function toggleContent(tab) {
            $(".content").hide();
            $("." + tab).show()
        }
    }]);
    return HHTab
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var TableSorting = function() {
    function TableSorting(list, index, secondarySort, sortOptions, name, attribute) {
        var uniqueBodySelector = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : "";
        var uniqueHeadSelector = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : "";
        _classCallCheck(this, TableSorting);
        this.bodySelector = uniqueBodySelector + " [sorting_table]";
        this.html = document.querySelector(this.bodySelector).outerHTML;
        this.rowSelector = "sorting_id";
        this.sortIcons = {
            default: "upDownArrows_mix_icn",
            desc: "downArrow_mix_icn",
            asc: "upArrow_mix_icn"
        };
        this.index = index;
        this.secondarySort = secondarySort;
        this.sortOptions = sortOptions;
        this.name = name;
        this.attribute = attribute;
        this.list = this.prepareSortingHTML(list);
        this.uniqueBodySelector = uniqueBodySelector;
        this.uniqueHeadSelector = uniqueHeadSelector ? uniqueHeadSelector : ""
    }
    _createClass(TableSorting, [{
        key: "prepareSortingHTML",
        value: function prepareSortingHTML(list) {
            for (var i = 0; i < list.length; i++) {
                if (list[i][this.index] == null) list[i][this.index] = 0;
                var selector = this.bodySelector + " [" + this.rowSelector + '="' + list[i][this.index] + '"]';
                list[i]["html"] = document.querySelector(selector).innerHTML;
                if ($(selector).attr(this.attribute)) list[i][this.attribute] = $(selector).attr(this.attribute).trim()
            }
            return list
        }
    }, {
        key: "sortbyLetter",
        value: function sortbyLetter(prop, order) {
            return function(a, b) {
                var a_pro = a[prop].toUpperCase();
                var b_pro = b[prop].toUpperCase();
                if (a_pro < b_pro) return order == "asc" ? -1 : 1;
                if (a_pro > b_pro) return order == "asc" ? 1 : -1;
                return 0
            }
        }
    }, {
        key: "sortbyNumber",
        value: function sortbyNumber(prop, order, secondarySort) {
            return function(a, b) {
                var a_pro = parseInt(a[prop], 10);
                var b_pro = parseInt(b[prop], 10);
                if (secondarySort) {
                    var a_rank = parseInt(a[secondarySort], 10);
                    var b_rank = parseInt(b[secondarySort], 10);
                    if (a_pro == b_pro) return a_rank - b_rank;
                    else return order == "asc" ? a_pro - b_pro : b_pro - a_pro
                } else {
                    return order == "asc" ? a_pro - b_pro : b_pro - a_pro
                }
            }
        }
    }, {
        key: "updateSortedHTML",
        value: function updateSortedHTML(isDefault) {
            if (isDefault) $(this.bodySelector).replaceWith(this.html);
            else {
                var oldElements = document.querySelectorAll(this.bodySelector + " tr");
                for (var i = 0, len = oldElements.length; i < len; i++) {
                    var elm = oldElements[i];
                    elm.remove()
                }
                var htmlToInsert = "";
                for (var n = 0, _len = this.list.length; n < _len; n++) {
                    htmlToInsert += "<tr " + this.rowSelector + '="' + this.list[n][this.index] + '" ' + this.attribute + '="' + this.list[n][this.attribute] + '">' + this.list[n].html + "</tr>"
                }
                $(this.bodySelector).append(htmlToInsert);
                $(".lead_table_view").scrollTop(0)
            }
        }
    }, {
        key: "init",
        value: function init() {
            var _this = this;
            $(this.uniqueHeadSelector + " span[sort_by]").on("click", function(event) {
                if (!_this.preventClick) _this.onSortingButtonClick($(event.target))
            });
            if (localStorageGetItem(this.name + "_sorting")) {
                this.onSortingButtonClick()
            }
        }
    }, {
        key: "onSortingButtonClick",
        value: function onSortingButtonClick($clickedElement) {
            var sortBy = void 0,
                currentState = void 0,
                nextState = void 0,
                sortedInfo = void 0;
            if ($clickedElement) {
                if ($clickedElement.is("i")) $clickedElement = $clickedElement.parent();
                sortBy = $clickedElement.attr("sort_by");
                currentState = $clickedElement.attr("select");
                sortedInfo = JSON.stringify({
                    sort_by: sortBy,
                    current_state: currentState
                });
                localStorageSetItem(this.name + "_sorting", sortedInfo)
            } else {
                sortedInfo = JSON.parse(localStorageGetItem(this.name + "_sorting"));
                sortBy = sortedInfo.sort_by;
                currentState = sortedInfo.current_state;
                $clickedElement = $('[sort_by="' + sortedInfo.sort_by + '"]')
            }
            switch (currentState) {
                case "default":
                    nextState = "asc";
                    break;
                case "asc":
                    nextState = "desc";
                    break;
                case "desc":
                    nextState = "default";
                    break
            }
            $("[sort_by]").attr("select", "default");
            $("[sort_by] i").attr("class", this.sortIcons["default"]);
            $clickedElement.find("i").attr("class", this.sortIcons[nextState]);
            $clickedElement.attr("select", nextState);
            var sortFunction = void 0;
            if (this.sortOptions[sortBy] == "number") sortFunction = this.sortbyNumber;
            else if (this.sortOptions[sortBy] == "letter") sortFunction = this.sortbyLetter;
            if (nextState == "default") this.updateSortedHTML(true);
            else {
                this.list.sort(sortFunction(sortBy, nextState, this.secondarySort));
                this.updateSortedHTML()
            }
        }
    }]);
    return TableSorting
}();
var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);
    if (desc === undefined) {
        var parent = Object.getPrototypeOf(object);
        if (parent === null) {
            return undefined
        } else {
            return get(parent, property, receiver)
        }
    } else if ("value" in desc) {
        return desc.value
    } else {
        var getter = desc.get;
        if (getter === undefined) {
            return undefined
        }
        return getter.call(receiver)
    }
};
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass)
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var Tooltip = function() {
    function Tooltip($target, title, body, options) {
        _classCallCheck(this, Tooltip);
        this.$target = $target;
        this.title = title || false;
        this.body = body || "";
        this.options = options || false;
        var tooltipContainerClass = options && options.className ? options.className : "hh_tooltip_new have_arrows";
        var tooltipTitleClass = options && options.titleClassName ? options.titleClassName : "";
        var titleHtml = title ? '<h5 class="' + tooltipTitleClass + '">' + title + "</h5>" : "";
        this.$html = $('<div class="' + tooltipContainerClass + '">' + titleHtml + "</div>");
        this.containerSelector = "#overlay";
        this.boundsSelector = "#contains_all";
        this.avoidElm = options && options.avoidElm ? options.avoidElm : false;
        this.arrowSize = 10
    }
    _createClass(Tooltip, [{
        key: "init",
        value: function init(beforeArrange) {
            $(this.containerSelector).after(this.$html);
            if (this.body) this.$html.append(this.body);
            if (beforeArrange) this[beforeArrange]();
            this.arrange();
            if (this.avoidElm) this.avoidRearrange()
        }
    }, {
        key: "applyScale",
        value: function applyScale(scale) {
            var scaleString = "scale(" + scale + ")";
            this.$html.css("transform", scaleString);
            this.$html.css("-moz-transform", scaleString);
            this.$html.css("-webkit-transform", scaleString);
            this.$html.css("transform-origin", "left top");
            this.$html.css("-moz-transform-origin", "left top");
            this.$html.css("-webkit-transform-origin", "left top")
        }
    }, {
        key: "getRects",
        value: function getRects() {
            var additionalScalingFactor = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
            var ownWidth = this.$html.outerWidth();
            var maxWidth = 500;
            if (ownWidth > maxWidth) {
                ownWidth = maxWidth;
                this.$html.width(ownWidth)
            }
            var ownHeight = this.$html.outerHeight();
            var $boundsElm = $(this.boundsSelector);
            var boundsScaleMatch = $boundsElm.css("transform").match(/matrix\(((\d*\.)?\d+),/);
            var boundsScale = 1;
            if (boundsScaleMatch && boundsScaleMatch[1]) {
                boundsScale = parseFloat(boundsScaleMatch[1]);
                this.$html.width(this.$html.width() + 2);
                this.applyScale(boundsScale);
                ownWidth *= boundsScale;
                ownHeight *= boundsScale
            }
            var boundsX = $boundsElm.offset().left;
            var boundsY = $boundsElm.offset().top;
            var boundsWidth = $boundsElm.outerWidth() * boundsScale;
            var boundsHeight = $boundsElm.outerHeight() * boundsScale;
            var targetX = this.$target.offset().left;
            var targetY = this.$target.offset().top;
            var targetWidth = this.$target.outerWidth() * boundsScale;
            var targetHeight = this.$target.outerHeight() * boundsScale;
            var m = this.$target.css("transform").match(/matrix\(((\d*\.)?\d+),/);
            if (m && m[1]) {
                var scale = parseFloat(m[1]);
                targetWidth *= scale;
                targetHeight *= scale
            }
            if (additionalScalingFactor) {
                targetWidth *= additionalScalingFactor;
                targetHeight *= additionalScalingFactor
            }
            var result = {
                own: {
                    width: ownWidth,
                    height: ownHeight
                },
                target: {
                    width: targetWidth,
                    height: targetHeight,
                    x: targetX,
                    y: targetY
                },
                bounds: {
                    width: boundsWidth,
                    height: boundsHeight,
                    x: boundsX,
                    y: boundsY,
                    scale: boundsScale
                }
            };
            result = this.checkAndModifyBounds(result);
            return result
        }
    }, {
        key: "checkAndModifyBounds",
        value: function checkAndModifyBounds(data) {
            var own = data.own,
                target = data.target,
                bounds = data.bounds;
            var isAbove = target.y - (own.height + this.arrowSize) > bounds.y;
            var isBelow = target.y + target.height + own.height + this.arrowSize < bounds.height;
            var isLeft = target.x - (own.width + this.arrowSize) > bounds.width;
            var isRight = target.x + target.width + own.width + this.arrowSize < bounds.width;
            var position = "top";
            if (isAbove) position = "top";
            else if (isBelow) position = "bottom";
            else if (isLeft) position = "left";
            else if (isRight) position = "right";
            else throw new Error("Impossible tooltip placement.");
            data.position = position;
            if (isAbove || isBelow) data.own.height += this.arrowSize;
            else if (isLeft || isRight) data.own.width += this.arrowSize;
            return data
        }
    }, {
        key: "arrange",
        value: function arrange() {
            var _getRects = this.getRects(),
                own = _getRects.own,
                target = _getRects.target,
                bounds = _getRects.bounds,
                position = _getRects.position;
            var tooltipY = 0;
            switch (position) {
                case "top":
                    tooltipY = target.y - own.height;
                    break;
                case "bottom":
                    tooltipY = target.y + target.height + this.arrowSize * bounds.scale;
                    break;
                case "left":
                    tooltipY = target.y + target.height / 2 + this.arrowSize * bounds.scale;
                    break;
                case "right":
                    tooltipY = target.y + target.height / 2 + this.arrowSize * bounds.scale;
                    break
            }
            this.$html.addClass("align-" + position);
            this.$html.css("top", tooltipY + "px");
            var tooltipX = 0;
            var centerTargetX = target.x + target.width / 2;
            var centeredOwnLeftEdge = centerTargetX - own.width / 2;
            var centeredOwnRightEdge = centerTargetX + own.width / 2;
            if (centeredOwnLeftEdge >= bounds.x && centeredOwnRightEdge <= bounds.x + bounds.width) tooltipX = centeredOwnLeftEdge;
            else if (centeredOwnLeftEdge < bounds.x) {
                tooltipX = target.x;
                this.$html.addClass("align-vertical-left")
            } else {
                tooltipX = target.x + target.width - own.width;
                this.$html.addClass("align-vertical-right")
            }
            this.$html.css("left", tooltipX + "px")
        }
    }, {
        key: "avoidRearrange",
        value: function avoidRearrange() {
            var rect1 = this.avoidElm[0].getBoundingClientRect();
            var rect2 = this.$html[0].getBoundingClientRect();
            var overlap = !(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom);
            if (!overlap) return;
            var _getRects2 = this.getRects(),
                own = _getRects2.own,
                target = _getRects2.target,
                bounds = _getRects2.bounds;
            this.$html.removeClass("align-top");
            this.$html.removeClass("align-bottom");
            this.$html.removeClass("align-vertical-left");
            this.$html.removeClass("align-vertical-right");
            var tooltipY = target.y;
            if (target.y + own.height > bounds.y + bounds.height) tooltipY = target.y - (own.height - target.height);
            this.$html.css("top", tooltipY + "px");
            var tooltipX = 0;
            var type = target.y <= tooltipY ? "top" : "bottom";
            if (target.x + target.width + own.width < bounds.x + bounds.width) {
                tooltipX = target.x + target.width;
                this.$html.addClass("align-right")
            } else if (target.x - own.width > bounds.x) {
                tooltipX = target.x - own.width;
                this.$html.addClass("align-left")
            }
            this.$html.addClass("align-vertical-" + type);
            this.$html.css("left", tooltipX + "px")
        }
    }, {
        key: "close",
        value: function close() {
            this.$html.remove();
            this.destroy()
        }
    }, {
        key: "destroy",
        value: function destroy() {
            for (var key in this) {
                delete this[key]
            }
        }
    }, {
        key: "buildAdditionalContent",
        value: function buildAdditionalContent(additionalTooltipInfo) {
            if (typeof additionalTooltipInfo !== "undefined") {
                try {
                    additionalTooltipInfo = JSON.parse(additionalTooltipInfo)
                } catch (error) {}
                return '<div class="season_rewards_tooltip">\n\t\t\t\t<div class="season_rewards_tier_info">' + GT.design.season_tier + " " + additionalTooltipInfo.tier + " " + GT.design.Reward + '</div>\n\t\t\t\t<div class="season_rewards_mojo_info">' + GT.design.Reach + " " + additionalTooltipInfo.mojo_required + " " + GT.design.Mojo + "</div>\n\t\t\t</div>"
            }
            return ""
        }
    }]);
    return Tooltip
}();
var CVCTooltip = function(_Tooltip) {
    _inherits(CVCTooltip, _Tooltip);

    function CVCTooltip($target) {
        _classCallCheck(this, CVCTooltip);
        var tooltipClasses = "hh_tooltip_new cvc_tooltip have_arrows";
        var _this = _possibleConstructorReturn(this, (CVCTooltip.__proto__ || Object.getPrototypeOf(CVCTooltip)).call(this, $target, "", "", {
            className: tooltipClasses
        }));
        _this.body = '<img src="' + IMAGES_URL + '/payments/card_cvc_example.png" />';
        return _this
    }
    return CVCTooltip
}(Tooltip);
var BattleClassTooltip = function(_Tooltip2) {
    _inherits(BattleClassTooltip, _Tooltip2);

    function BattleClassTooltip($target) {
        _classCallCheck(this, BattleClassTooltip);
        var tooltipClasses = "hh_tooltip_new have_arrows hh_class_tooltip";
        var hasClassChange = $target.hasClass("class_change_btn");
        if (!hasClassChange) tooltipClasses += " hh_class_tooltip_click_disabled";
        var _this2 = _possibleConstructorReturn(this, (BattleClassTooltip.__proto__ || Object.getPrototypeOf(BattleClassTooltip)).call(this, $target, "", "", {
            className: tooltipClasses
        }));
        _this2.body = _this2.buildBody(hasClassChange);
        return _this2
    }
    _createClass(BattleClassTooltip, [{
        key: "buildBody",
        value: function buildBody(hasClassChange) {
            var body = "<div>" + GT.design.dominance_scheme + '</div>\n\t\t\t\t\t<div class="dominance_scheme">\n\t\t\t\t\t\t<span class="label one">' + GT.design.dominance_hardcore + '</span>\n\t\t\t\t\t\t<img class="one" src="' + IMAGES_URL + '/design/ic_arrow-back_gray.svg">\n\t\t\t\t\t\t<span carac="1"></span>\n\t\t\t\t\t\t<span class="label two">' + GT.design.dominance_knowhow + '</span>\n\t\t\t\t\t\t<img class="two" src="' + IMAGES_URL + '/design/ic_arrow-back_gray.svg">\n\t\t\t\t\t\t<span carac="2"></span>\n\t\t\t\t\t\t<span class="label three">' + GT.design.dominance_charm + '</span>\n\t\t\t\t\t\t<img class="three" src="' + IMAGES_URL + '/design/ic_arrow-back_gray.svg">\n\t\t\t\t\t\t<span carac="3"></span>\n\t\t\t\t\t</div>';
            if (hasClassChange) body += '<p class="bottom">' + GT.design.dominance_click + "</p>";
            return body
        }
    }]);
    return BattleClassTooltip
}(Tooltip);
var ChampionRewardsTooltip = function(_Tooltip3) {
    _inherits(ChampionRewardsTooltip, _Tooltip3);

    function ChampionRewardsTooltip($target, data) {
        _classCallCheck(this, ChampionRewardsTooltip);
        var className = "hh_tooltip_new have_arrows champion_tooltip extended";
        var options = {
            className: className
        };
        var _this3 = _possibleConstructorReturn(this, (ChampionRewardsTooltip.__proto__ || Object.getPrototypeOf(ChampionRewardsTooltip)).call(this, $target, "", "", options));
        _this3.data = JSON.parse(data);
        _this3.body = _this3.buildBody($target);
        return _this3
    }
    _createClass(ChampionRewardsTooltip, [{
        key: "buildBody",
        value: function buildBody($target) {
            var body = "";
            var isLastStage = $target.is("[show-last]");
            var rewards = undefined;
            if (!isLastStage) {
                rewards = "";
                for (var index in this.data.stage.armor) {
                    rewards += RewardsBuilder.buildSlot(this.data.stage.armor[index])
                }
            } else {
                rewards = {};
                for (var category in this.data.final) {
                    var list = this.data.final[category];
                    if (category == "girl_shards") {
                        rewards["girl"] = RewardsBuilder.buildSlot(list[0])
                    } else if (category == "orbs") {
                        rewards["orbs"] = "";
                        for (var i in list) {
                            rewards["orbs"] += RewardsBuilder.buildSlot(list[i])
                        }
                    } else if (category == "personalization") {
                        rewards.theme = "";
                        rewards.scenery = "";
                        rewards.outfit = "";
                        for (var _i in list) {
                            var element = list[_i];
                            var type = element.type;
                            if (type == "theme") rewards.theme += RewardsBuilder.buildSlot(element);
                            else if (type == "scenery") rewards.scenery += RewardsBuilder.buildSlot(element);
                            else if (type.indexOf("character_") != -1) rewards.outfit += RewardsBuilder.buildSlot(element)
                        }
                    }
                }
            }
            var output = "";
            if ((typeof rewards === "undefined" ? "undefined" : _typeof(rewards)) == "object") {
                if (Object.keys(rewards).length === 0 && isLastStage && this.data.final.hasOwnProperty("energy_kiss")) {
                    rewards["energy_kiss"] = "";
                    var _list = this.data.final["energy_kiss"];
                    for (var _i2 in _list) {
                        rewards["energy_kiss"] += RewardsBuilder.buildSlot(_list[_i2])
                    }
                    output += '<div class="grid-reward-holder">\n\t\t\t\t\t\t\t\t' + rewards["energy_kiss"] + "\n\t\t\t\t\t\t\t</div>"
                } else {
                    for (var name in rewards) {
                        if (rewards[name]) {
                            output += '<div class="grid-reward-holder">\n\t\t\t\t\t\t\t\t\t\t<div>* ' + GT.design["champions_" + name] + "</div>\n\t\t\t\t\t\t\t\t\t\t" + rewards[name] + "\n\t\t\t\t\t\t\t\t\t</div>"
                        }
                    }
                }
            }
            if (!isLastStage) {
                body = '<div>\n\t\t\t\t\t\t<div class="explanation-text">' + GT.design.champions_stage_set + '</div>\n\t\t\t\t\t\t<div class="items-holder">' + rewards + "</div>\n\t\t\t\t\t</div>"
            } else {
                body = '<div>\n\t\t\t\t\t\t<div class="explanation-text">' + GT.design.champions_stage_rewards + '</div>\n\t\t\t\t\t\t<div class="items-holder">' + output + "</div>\n\t\t\t\t\t</div>"
            }
            return body
        }
    }]);
    return ChampionRewardsTooltip
}(Tooltip);
var GirlTooltip = function(_Tooltip4) {
    _inherits(GirlTooltip, _Tooltip4);

    function GirlTooltip($target, data) {
        _classCallCheck(this, GirlTooltip);
        var className = "hh_tooltip_new have_arrows girl_tooltip rarity-styling " + data.rarity + "-border";
        var titleClassName = data.rarity + "-text";
        var options = {
            className: className,
            titleClassName: titleClassName,
            avoidElm: $target
        };
        var _this4 = _possibleConstructorReturn(this, (GirlTooltip.__proto__ || Object.getPrototypeOf(GirlTooltip)).call(this, $target, data.Name, "", options));
        _this4.body = _this4.buildBody(data);
        return _this4
    }
    _createClass(GirlTooltip, [{
        key: "buildBody",
        value: function buildBody(data) {
            var skillIcon = girlsSkillImages[parseInt(data.class, 10) - 1];
            var body = '<div class="icons">\n\t\t\t\t\t\t<span carac="carac' + data.class + '"></span>\n\t\t\t\t\t\t<img class="position" src="' + getBattlePositionImagePath(data.position_img) + '">\n\t\t\t\t\t\t<img class="skill" src="' + IMAGES_URL + "/caracs/" + skillIcon + '">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="caracs">\n\t\t\t\t\t\t<span carac="carac1">' + formatGirlCarac(data.caracs.carac1) + '</span>\n\t\t\t\t\t\t<span carac="carac2">' + formatGirlCarac(data.caracs.carac2) + '</span>\n\t\t\t\t\t\t<span carac="carac3">' + formatGirlCarac(data.caracs.carac3) + "</span>\n\t\t\t\t\t</div>";
            if (data.salary_per_hour) {
                body += '<div class="income ' + data.rarity + '-background border-top">\n\t\t\t\t\t\t' + GT.design.haremdex_income + ':\n\t\t\t\t\t\t<span><span cur="soft_currency"></span>' + number_format_lang(data.salary_per_hour) + "/" + GT.time.h + "</span>\n\t\t\t\t\t</div>"
            }
            return body
        }
    }]);
    return GirlTooltip
}(Tooltip);
var NewGirlTooltip = function(_Tooltip5) {
    _inherits(NewGirlTooltip, _Tooltip5);

    function NewGirlTooltip($target, data) {
        _classCallCheck(this, NewGirlTooltip);
        var className = "hh_tooltip_new new_girl_tooltip rarity-styling " + data.rarity + "-border";
        var titleClassName = data.rarity + "-text";
        var options = {
            className: className,
            titleClassName: titleClassName,
            avoidElm: $target
        };
        var _this5 = _possibleConstructorReturn(this, (NewGirlTooltip.__proto__ || Object.getPrototypeOf(NewGirlTooltip)).call(this, $target, data.Name, "", options));
        _this5.body = _this5.buildBody(data);
        return _this5
    }
    _createClass(NewGirlTooltip, [{
        key: "checkAndModifyBounds",
        value: function checkAndModifyBounds(data) {
            var own = data.own,
                target = data.target,
                bounds = data.bounds;
            var isAbove = target.y - own.height > bounds.y;
            var isBelow = target.y + target.height + own.height < bounds.height;
            var isLeft = target.x - own.width < bounds.width;
            var isRight = target.x + target.width + own.width < bounds.width;
            var position = "top";
            if (isAbove) position = "top";
            else if (isBelow) position = "bottom";
            else if (isLeft) position = "left";
            else if (isRight) position = "right";
            else throw new Error("Impossible tooltip placement.");
            data.position = position;
            return data
        }
    }, {
        key: "buildBody",
        value: function buildBody(data) {
            var body = '<div class="girl_tooltip_level ' + data.rarity + '-text">< ' + data.level + " " + GT.design.Lvl + " " + GT.design["girls_rarity_" + data.rarity] + " " + GT.design.girl + ' ></div>\n\t\t\t\t\t<div class="girl_tooltip_grade">' + data.Graded2 + '</div>\n\t\t\t\t\t<div class="icons girl_tooltip_positions">\n\t\t\t\t\t\t<span carac="carac' + data.class + '"></span>\n\t\t\t\t\t\t<div class="girl_tooltip_img_container">\n\t\t\t\t\t\t\t<img class="position" src="' + getBattlePositionImagePath(data.position_img) + '">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="caracs">\n\t\t\t\t\t\t<span carac="carac1"><span>' + formatGirlCarac(data.caracs.carac1) + '</span></span>\n\t\t\t\t\t\t<span carac="carac2"><span>' + formatGirlCarac(data.caracs.carac2) + '</span></span>\n\t\t\t\t\t\t<span carac="carac3"><span>' + formatGirlCarac(data.caracs.carac3) + "</span></span>\n\t\t\t\t\t</div>";
            if (data.salary_per_hour) {
                body += '<div class="income">\n\t\t\t\t\t\t' + GT.design.haremdex_income + ':\n\t\t\t\t\t\t<span><span cur="soft_currency"></span>' + number_format_lang(data.salary_per_hour) + "/" + GT.time.h + "</span>\n\t\t\t\t\t</div>"
            }
            return body
        }
    }]);
    return NewGirlTooltip
}(Tooltip);
var StatsTooltip = function(_Tooltip6) {
    _inherits(StatsTooltip, _Tooltip6);

    function StatsTooltip($target, data) {
        _classCallCheck(this, StatsTooltip);
        var tooltipClasses = "hh_tooltip_new stats_tooltip have_arrows";
        var _this6 = _possibleConstructorReturn(this, (StatsTooltip.__proto__ || Object.getPrototypeOf(StatsTooltip)).call(this, $target, GT.design.stats_ttp_title, "", {
            className: tooltipClasses
        }));
        _this6.body = _this6.buildBody(data);
        return _this6
    }
    _createClass(StatsTooltip, [{
        key: "buildBody",
        value: function buildBody(data) {
            var heroClass = data.heroClass;
            var carac = data.carac;
            var multiplier = data.multiplier;
            var body = "";
            if (carac == heroClass) {
                body += '<div class="row"><span carac="damage"></span><span class="text">+' + multiplier.nb * 1 + "</span></div>";
                body += '<div class="row"><span carac="endurance"></span><span class="text">+' + multiplier.nb * 5 + "</span></div>"
            } else if (heroClass == 3 && carac == 2 || heroClass == 2 && carac == 1 || heroClass == 1 && carac == 3) {
                body += '<div class="row"><span carac="def' + carac + '"></span><span class="text">+' + multiplier.nb * .5 + "</span></div>";
                body += '<div class="row"><span carac="endurance"></span><span class="text">+' + multiplier.nb * 2 + "</span></div>"
            } else if (heroClass == 3 && carac == 1 || heroClass == 2 && carac == 3 || heroClass == 1 && carac == 2) {
                body += '<div class="row"><span carac="def' + carac + '"></span><span class="text">+' + multiplier.nb * .5 + "</span></div>";
                body += '<div class="row"><span carac="chance"></span><span class="text">+' + multiplier.nb * .5 + "</span></div>"
            }
            return body
        }
    }]);
    return StatsTooltip
}(Tooltip);
var RewardsTooltip = function(_Tooltip7) {
    _inherits(RewardsTooltip, _Tooltip7);

    function RewardsTooltip($target, data) {
        _classCallCheck(this, RewardsTooltip);
        var tooltipClasses = "hh_tooltip_new have_arrows rewards_tooltip";
        var isPachinkoPoolGirls = $target.hasClass("pachinko-pool-girl");
        var titleTooltip = isPachinkoPoolGirls ? GT.design.mythic_pachinko_current_selection : "";
        var _this7 = _possibleConstructorReturn(this, (RewardsTooltip.__proto__ || Object.getPrototypeOf(RewardsTooltip)).call(this, $target, titleTooltip, "", {
            className: tooltipClasses
        }));
        _this7.body = _this7.buildBody(data, isPachinkoPoolGirls);
        return _this7
    }
    _createClass(RewardsTooltip, [{
        key: "init",
        value: function init() {
            _get(RewardsTooltip.prototype.__proto__ || Object.getPrototypeOf(RewardsTooltip.prototype), "init", this).call(this, "squarify")
        }
    }, {
        key: "squarify",
        value: function squarify() {
            var slotCount = this.$html.find(".slot").length;
            if (slotCount < 6) return;
            var colNum = Math.round(Math.sqrt(slotCount));
            var slotWidth = this.$html.find(".slot").first().width();
            var squareWidth = colNum * slotWidth;
            if (colNum >= 8) squareWidth += 80;
            this.$html.width(squareWidth)
        }
    }, {
        key: "buildBody",
        value: function buildBody(data, isPachinkoPoolGirls) {
            var body = "";
            var setPachinkoPoolClass = isPachinkoPoolGirls ? "pachinko_pool" : "";
            var displayItemsCount = Math.min(data.rewards.length, 96);
            for (var i = 0; i < displayItemsCount; i++) {
                var item = data.rewards[i];
                if (data.type == "girl") {
                    if (item.type === "dating_tokens") {
                        body += '<div class="slot"><div class="girl_ico"><img src="' + IMAGES_URL + '/design/ic_DatingTokens.png"/></div></div>'
                    } else {
                        body += '<div class="slot slot_girl" ' + setPachinkoPoolClass + '>\n\t\t\t\t\t\t\t\t<div class="girl_ico" rarity="' + item.rarity + '">\n\t\t\t\t\t\t\t\t\t<img src="' + item.ico + '" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>'
                    }
                } else if (data.type == "item") {
                    body += '<div class="slot">\n\t\t\t\t\t\t\t<img src="' + item.ico + '" />\n\t\t\t\t\t\t</div>'
                }
            }
            return body
        }
    }]);
    return RewardsTooltip
}(Tooltip);
var ItemTooltip = function(_Tooltip8) {
    _inherits(ItemTooltip, _Tooltip8);

    function ItemTooltip($target, itemData) {
        _classCallCheck(this, ItemTooltip);
        var $comparableTarget = $("#equiped .armor div[subtype=" + itemData.itemTooltipInfo.subtype + "][id_item]");
        var options = {
            className: "hh_tooltip_new have_arrows item_tooltip rarity-styling " + itemData.itemTooltipInfo.rarity + "-border",
            titleClassName: itemData.itemTooltipInfo.rarity + "-background border-bottom"
        };
        if ($comparableTarget.length > 0) options.avoidElm = $comparableTarget;
        var _this8 = _possibleConstructorReturn(this, (ItemTooltip.__proto__ || Object.getPrototypeOf(ItemTooltip)).call(this, $target, itemData.itemTooltipInfo.name, "", options));
        _this8.itemData = itemData.itemTooltipInfo;
        _this8.additionalTooltipInfo = itemData.additionalTooltipInfo;
        _this8.comparableData = false;
        _this8.isEquipped = parseInt(_this8.itemData.equiped, 10);
        if (!_this8.isEquipped && $comparableTarget.length > 0) _this8.comparableData = $comparableTarget.data("d");
        _this8.body = _this8.buildBody();
        if (!_this8.isEquipped) _this8.highLightPotentialSlot(true);
        return _this8
    }
    _createClass(ItemTooltip, [{
        key: "init",
        value: function init() {
            _get(ItemTooltip.prototype.__proto__ || Object.getPrototypeOf(ItemTooltip.prototype), "init", this).call(this);
            if (this.isEquipped && this.itemData.expiration) this.initExpirationTimer()
        }
    }, {
        key: "getRects",
        value: function getRects() {
            var scale = null;
            try {
                scale = JSON.parse(this.additionalTooltipInfo).scale
            } catch (error) {}
            return _get(ItemTooltip.prototype.__proto__ || Object.getPrototypeOf(ItemTooltip.prototype), "getRects", this).call(this, scale)
        }
    }, {
        key: "close",
        value: function close() {
            if (!this.isEquipped) this.highLightPotentialSlot(false);
            if (this.timerId) HHTimers.stopTimer(this.timerId);
            _get(ItemTooltip.prototype.__proto__ || Object.getPrototypeOf(ItemTooltip.prototype), "close", this).call(this)
        }
    }, {
        key: "buildBody",
        value: function buildBody() {
            var body = '<div class="item-properties">';
            body += this.buildPropertyList();
            body += this.buildItemSpecificProps();
            body += "</div>";
            body += this.buildPriceInfo();
            body += this.buildAdditionalContent(this.additionalTooltipInfo);
            return body
        }
    }, {
        key: "buildPropertyList",
        value: function buildPropertyList() {
            var result = "";
            var displayableProps = ["carac1", "carac2", "carac3", "chance", "endurance", "damage", "ego"];
            for (var i = 0; i < displayableProps.length; i++) {
                var prop = displayableProps[i];
                var propValue = this.itemData[prop];
                var mustCompare = this.comparableData && (this.comparableData[prop] > 0 || propValue > 0);
                if (propValue > 0 || mustCompare) {
                    var propData = {
                        p: prop,
                        v: propValue,
                        diff: ""
                    };
                    var diffString = "";
                    if (mustCompare) {
                        var diff = propValue - this.comparableData[prop];
                        if (diff != 0) {
                            diffString = number_format_lang(diff);
                            diffString = diff > 0 ? "+" + diffString : diffString;
                            diffString = '<span class="prop-diff ' + (diff > 0 ? "green" : "red") + '">' + diffString + "</span>"
                        }
                    }
                    var formatedValue = "";
                    if (propValue == 0) formatedValue = '<span class="compared-zero-value">0</span>';
                    else formatedValue = number_format_lang(propValue);
                    var finalTextValue = formatedValue + diffString;
                    if (this.itemData.type == "booster") {
                        var timeLeft = 0;
                        if (this.itemData.rarity == "legendary") finalTextValue += "%";
                        if (this.itemData.lifetime && this.itemData.lifetime != "0") timeLeft = format_time_short(parseInt(this.itemData.lifetime, 10) - Date.now() / 1e3);
                        else timeLeft = format_time_short(this.itemData.duration);
                        finalTextValue = '<span class="green">\n\t\t\t\t\t\t\t\t\t\t+' + finalTextValue + " " + GT.design.for+'\n\t\t\t\t\t\t\t\t\t\t<span class="item-duration-time orange">' + timeLeft + "</span>\n\t\t\t\t\t\t\t\t\t</span>"
                    }
                    result += '<div class="item-property">\n\t\t\t\t\t\t\t\t<span carac="' + prop + '"></span>\n\t\t\t\t\t\t\t\t' + finalTextValue + "\n\t\t\t\t\t\t\t</div>"
                }
            }
            return result
        }
    }, {
        key: "buildItemSpecificProps",
        value: function buildItemSpecificProps() {
            var result = "";
            var formattedValue = number_format_lang(this.itemData.value);
            switch (this.itemData.type) {
                case "potion":
                    result = '<span class="item-value green">+' + number_format_lang(this.itemData.value) + " " + GT.design.XP + "</span>";
                    break;
                case "gift":
                    result = '<span class="item-value green">+' + number_format_lang(this.itemData.value) + " " + GT.design.Aff + "</span>";
                    break
            }
            return result
        }
    }, {
        key: "buildPriceInfo",
        value: function buildPriceInfo() {
            var price = number_format_lang(this.itemData.price_sell);
            var priceIconClass = "item-price-icon-sc";
            if (!this.itemData.id_m_i[0] && (this.itemData.price || this.itemData.price_hc)) {
                price = number_format_lang(this.itemData.price);
                if (this.itemData.price_hc) {
                    price = number_format_lang(this.itemData.price_hc);
                    priceIconClass = "item-price-icon-hc"
                }
            }
            var priceString = "";
            if (price && price != "0") {
                priceString = '<div class="item-price ' + this.itemData.rarity + '-background border-top">\n\t\t\t\t\t\t\t\t<span class="item-price-icon ' + priceIconClass + '"></span>\n\t\t\t\t\t\t\t\t' + price + "\n\t\t\t\t\t\t\t</div>"
            }
            return priceString
        }
    }, {
        key: "highLightPotentialSlot",
        value: function highLightPotentialSlot(isOn) {
            var potentialClass = "potential";
            var potentialClassOld = "potential_old";
            var $selector = $("#equiped .armor ." + potentialClass);
            var $selectorSub = $("#equiped .armor div[subtype=" + this.itemData.subtype + "]");
            if (isOn) {
                $selector.addClass(potentialClassOld);
                $selector.removeClass(potentialClass);
                $selectorSub.addClass(potentialClass)
            } else {
                $selectorSub.removeClass(potentialClass);
                $("#equiped .armor ." + potentialClassOld).addClass(potentialClass);
                $selector.removeClass(potentialClassOld)
            }
        }
    }, {
        key: "initExpirationTimer",
        value: function initExpirationTimer() {
            var now = Date.now() / 1e3;
            var remainingTime = this.itemData.lifetime - now;
            if (remainingTime < 0) return;
            this.timerId = HHTimers.initDecTimer(this.$html.find(".item-duration-time"), remainingTime, function() {
                this.close()
            })
        }
    }]);
    return ItemTooltip
}(Tooltip);
var RankingRewardsTooltip = function(_Tooltip9) {
    _inherits(RankingRewardsTooltip, _Tooltip9);

    function RankingRewardsTooltip($target, tooltipData) {
        _classCallCheck(this, RankingRewardsTooltip);
        var _this9 = _possibleConstructorReturn(this, (RankingRewardsTooltip.__proto__ || Object.getPrototypeOf(RankingRewardsTooltip)).call(this, $target, "", "", {
            className: "ranking_rewards_tooltip have_arrows"
        }));
        _this9.tooltipData = tooltipData;
        _this9.body = _this9.buildBody();
        return _this9
    }
    _createClass(RankingRewardsTooltip, [{
        key: "init",
        value: function init() {
            _get(RankingRewardsTooltip.prototype.__proto__ || Object.getPrototypeOf(RankingRewardsTooltip.prototype), "init", this).call(this);
            this.initiateTimers()
        }
    }, {
        key: "initiateTimers",
        value: function initiateTimers() {
            var leagueExpirationTimestamp = this.tooltipData[3];
            if (is_mobile_size() && leagueExpirationTimestamp && leagueExpirationTimestamp > 0) {
                var leaguesEndTimerClass = ".leagues_end_in_tooltip";
                Object.keys(HHTimers.timers).forEach(function(key) {
                    if (HHTimers.timers[key].$elm.selector.includes(leaguesEndTimerClass)) {
                        HHTimers.stopTimer(key)
                    }
                });
                HHTimers.initDecTimer($(leaguesEndTimerClass + ' [rel="timer"]'), leagueExpirationTimestamp, function() {})
            }
            if (this.weeklyTimerInfo) {
                this.initExpirationTimer()
            }
        }
    }, {
        key: "buildBody",
        value: function buildBody() {
            var body = "";
            var hasName = false;
            var currentReward = this.tooltipData[0];
            var isMobileSize = is_mobile_size();
            if (isMobileSize && this.tooltipData[2]) {
                body += '<p class="weekly-rewards-headline">' + this.tooltipData[2] + "</p>"
            }
            for (var key in this.tooltipData[1]) {
                if (this.tooltipData[1]["name"] && !hasName) {
                    body += '<span class="name">' + this.tooltipData[1]["name"] + "</span>";
                    hasName = true
                }
                if (key == "name") break;
                var reward = this.tooltipData[1][key];
                if (currentReward == key) body += '<div class="reward_position pink">';
                else body += '<div class="reward_position">';
                body += '<div class="rank">\n\t\t\t\t\t\t' + reward.label + '\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="rewards_wrapper">';
                if (reward.orbs) {
                    var orb_name = Object.keys(reward.orbs)[0];
                    if (typeof orb_name != "undefined") {
                        body += '<div class="orbs">\n\t\t\t\t\t\t\t\t<span class="orb_icon ' + orb_name + '"></span>\n\t\t\t\t\t\t\t\t<span class="nb">' + reward.orbs[orb_name] + "</span>\n\t\t\t\t\t\t\t</div>"
                    }
                }
                if (reward.sc > 0) {
                    body += '<div class="sc">\n\t\t\t\t\t\t\t<span>' + number_reduce(reward.sc) + "</span>\n\t\t\t\t\t\t</div>"
                }
                if (reward.xp > 0) {
                    body += '<div class="xp">\n\t\t\t\t\t\t\t<span>' + number_reduce(reward.xp) + "</span>\n\t\t\t\t\t\t</div>"
                }
                if (reward.hc > 0) {
                    body += '<div class="hc">\n\t\t\t\t\t\t\t<span>' + number_reduce(reward.hc) + "</span>\n\t\t\t\t\t\t</div>"
                }
                if (reward.gift || reward.equipment) {
                    body += '<div class="present">\n\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design/ic_gift.png" />\n\t\t\t\t\t\t</div>'
                }
                if (reward.combativity) {
                    body += '<div class="ef">\n\t\t\t\t\t\t\t<span>' + number_reduce(reward.combativity) + "</span>\n\t\t\t\t\t\t</div>"
                }
                if (reward.energy_kiss) {
                    body += '<div class="energy_kiss">\n\t\t\t\t\t\t\t<span>' + number_reduce(reward.energy_kiss) + "</span>\n\t\t\t\t\t\t</div>"
                }
                body += "</div></div>"
            }
            var leagueEndIn = this.tooltipData[3];
            if (isMobileSize && leagueEndIn && leagueEndIn > 0) {
                body += '\n\t\t\t<div class="leagues_end_in_tooltip">\n\t\t\t\t<i><i></i></i>\n\t\t\t\t<span>' + GT.design.leagues_end_in + ' <span rel="timer"></span></span>\n\t\t\t</div>'
            }
            return body
        }
    }, {
        key: "initExpirationTimer",
        value: function initExpirationTimer() {
            var remainingTime = this.weeklyTimerInfo.in_seconds;
            if (remainingTime < 0) return;
            this.timerId = HHTimers.initDecTimer(this.$html.find('[weekly-timer-mobile] > [rel="timer"]'), remainingTime, function() {
                this.close()
            })
        }
    }]);
    return RankingRewardsTooltip
}(Tooltip);
var PachinkoOrbTooltip = function(_Tooltip10) {
    _inherits(PachinkoOrbTooltip, _Tooltip10);

    function PachinkoOrbTooltip($target, data) {
        _classCallCheck(this, PachinkoOrbTooltip);
        var className = "hh_tooltip_new";
        var options = {
            className: className
        };
        var _this10 = _possibleConstructorReturn(this, (PachinkoOrbTooltip.__proto__ || Object.getPrototypeOf(PachinkoOrbTooltip)).call(this, $target, false, "", options));
        _this10.additionalTooltipInfo = data.additionalTooltipInfo;
        _this10.body = _this10.buildBody(data);
        return _this10
    }
    _createClass(PachinkoOrbTooltip, [{
        key: "buildBody",
        value: function buildBody(data) {
            return "<div>\n\t\t\t\t\t<div>" + GT.design["pachinko_" + data.orbClass] + "<br/>" + GT.design.pachinko_o_description + "</div>\n\t\t\t\t\t" + this.buildAdditionalContent(data.additionalTooltipInfo) + "\n\t\t\t\t</div>"
        }
    }, {
        key: "getRects",
        value: function getRects() {
            var scale = null;
            try {
                scale = JSON.parse(this.additionalTooltipInfo).scale
            } catch (error) {}
            return _get(PachinkoOrbTooltip.prototype.__proto__ || Object.getPrototypeOf(PachinkoOrbTooltip.prototype), "getRects", this).call(this, scale)
        }
    }]);
    return PachinkoOrbTooltip
}(Tooltip);
var SeasonRewardsTooltip = function(_Tooltip11) {
    _inherits(SeasonRewardsTooltip, _Tooltip11);

    function SeasonRewardsTooltip($target, data) {
        _classCallCheck(this, SeasonRewardsTooltip);
        var className = "hh_tooltip_new";
        var options = {
            className: className
        };
        var _this11 = _possibleConstructorReturn(this, (SeasonRewardsTooltip.__proto__ || Object.getPrototypeOf(SeasonRewardsTooltip)).call(this, $target, false, "", options));
        _this11.body = _this11.buildBody(data);
        _this11.additionalTooltipInfo = data.additionalTooltipInfo;
        return _this11
    }
    _createClass(SeasonRewardsTooltip, [{
        key: "getRects",
        value: function getRects() {
            var scale = null;
            try {
                scale = JSON.parse(this.additionalTooltipInfo).scale
            } catch (error) {}
            return _get(SeasonRewardsTooltip.prototype.__proto__ || Object.getPrototypeOf(SeasonRewardsTooltip.prototype), "getRects", this).call(this, scale)
        }
    }, {
        key: "buildBody",
        value: function buildBody(data) {
            return this.buildAdditionalContent(data.additionalTooltipInfo)
        }
    }]);
    return SeasonRewardsTooltip
}(Tooltip);
var GirlsShardsTooltip = function(_Tooltip12) {
    _inherits(GirlsShardsTooltip, _Tooltip12);

    function GirlsShardsTooltip($target, data) {
        _classCallCheck(this, GirlsShardsTooltip);
        var className = "hh_tooltip_new have_arrows design_v2";
        var options = {
            className: className
        };
        var _this12 = _possibleConstructorReturn(this, (GirlsShardsTooltip.__proto__ || Object.getPrototypeOf(GirlsShardsTooltip)).call(this, $target, data.title, "", options));
        _this12.additionalTooltipInfo = data.additionalTooltipInfo;
        _this12.body = _this12.buildBody(data);
        return _this12
    }
    _createClass(GirlsShardsTooltip, [{
        key: "getRects",
        value: function getRects() {
            var scale = null;
            try {
                scale = JSON.parse(this.additionalTooltipInfo).scale
            } catch (error) {}
            return _get(GirlsShardsTooltip.prototype.__proto__ || Object.getPrototypeOf(GirlsShardsTooltip.prototype), "getRects", this).call(this, scale)
        }
    }, {
        key: "buildBody",
        value: function buildBody(data) {
            return data.body + this.buildAdditionalContent(data.additionalTooltipInfo)
        }
    }]);
    return GirlsShardsTooltip
}(Tooltip);
var TooltipManager = {
    tooltipIdCounter: 1,
    tooltipIdAttrSelector: "tooltip-id",
    tooltips: {},
    doCloseTooltips: true,
    init: function init() {
        var _this13 = this;
        var isMobile = window.is_mobile && window.is_mobile() || window.is_tablet && window.is_tablet();
        this.initTooltipType(isMobile, "div.slot[id_item]", function(elm) {
            return {
                itemTooltipInfo: $(elm).data("d"),
                additionalTooltipInfo: $(elm).attr("additional-tooltip-info")
            }
        }, function(target, data) {
            var newTooltip = new ItemTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "div#weekly_rewards, #weekly-rewards-info-btn, .tier_icons>img, #leagues-info-btn", function(elm) {
            return $(elm).data()
        }, function(target, data) {
            var newTooltip = new RankingRewardsTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, '[cur="orbs"], div .orb_icon', function(elm) {
            var $elm = $(elm);
            var additionalTooltipInfo = $elm.attr("additional-tooltip-info");
            var attrName = $elm.attr("cur");
            var orbClass = attrName == "orbs" ? $elm.children().first().attr("class").split(" ").pop() : attrName;
            if (orbClass && orbClass.startsWith("o_")) {
                if (GT.design["pachinko_" + orbClass]) {
                    return {
                        orbClass: orbClass,
                        additionalTooltipInfo: additionalTooltipInfo
                    }
                }
            }
        }, function(target, data) {
            var newTooltip = new PachinkoOrbTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[hh_title]", function(elm) {
            return $(elm).attr("hh_title")
        }, function(target, data) {
            var newTooltip = new Tooltip($(target), false, data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[cvc_tooltip]", function(elm) {
            return $(elm)
        }, function(target, data) {
            var newTooltip = new CVCTooltip($(target));
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[champion-rewards-tooltip]", function(elm) {
            return $(elm).attr("champion-rewards-tooltip")
        }, function(target, data) {
            var newTooltip = new ChampionRewardsTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[hh_class_tooltip]", false, function(target) {
            var newTooltip = new BattleClassTooltip($(target));
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[girl-tooltip-data]", function(elm) {
            var data = false;
            try {
                data = JSON.parse($(elm).attr("girl-tooltip-data"))
            } catch (e) {}
            return data
        }, function(target, data) {
            var newTooltip = new GirlTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[new-girl-tooltip-data]", function(elm) {
            var data = false;
            try {
                data = JSON.parse($(elm).attr("new-girl-tooltip-data"))
            } catch (e) {}
            return data
        }, function(target, data) {
            if (typeof data !== "undefined" && Object.keys(data).length > 0) {
                var newTooltip = new NewGirlTooltip($(target), data);
                _this13.initNewTooltip(target, newTooltip)
            }
        });
        this.initTooltipType(isMobile, '#seasons_tab_container [class*="slot_"]:not(".slot_orbs")', function(elm) {
            var data = {};
            data.additionalTooltipInfo = $(elm).attr("additional-tooltip-info");
            return data
        }, function(target, data) {
            var newTooltip = new SeasonRewardsTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "plus[for_carac]", function(elm) {
            var data = {
                heroClass: $(elm).attr("hero_class"),
                carac: $(elm).attr("for_carac"),
                multiplier: statsMultiplier[statsMultiplierIndex]
            };
            return data
        }, function(target, data) {
            var newTooltip = new StatsTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[data-rewards]", function(elm) {
            var type = "";
            if ($(elm).hasClass("girls_reward")) type = "girl";
            else if ($(elm).hasClass("items_reward")) type = "item";
            var data = {
                type: type,
                rewards: $(elm).data("rewards")
            };
            return data
        }, function(target, data) {
            var newTooltip = new RewardsTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[shards]", function(elm) {
            var $elm = $(elm);
            var shardsAmount = parseInt($elm.attr("shards"), 10);
            var name = $elm.attr("name");
            var title = GT.design.shards_tooltip_title.replace("[amount]", shardsAmount + "/100");
            var body = GT.design.shards_tooltip_body.replace("[name]", name);
            var additionalTooltipInfo = $elm.attr("additional-tooltip-info");
            return {
                title: title,
                body: body,
                additionalTooltipInfo: additionalTooltipInfo
            }
        }, function(target, data) {
            var newTooltip = new GirlsShardsTooltip($(target), data);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, '[hero="soft_currency"]', false, function(target) {
            var money = number_format_lang(Hero.infos.soft_currency);
            var text = '<span class="orange">' + money + "</span>";
            var newTooltip = new Tooltip($(target), GT.design.current_money, text);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "header .energy_counter .hudBattlePts_mix_icn", false, function(target) {
            var text = void 0;
            if (Hero.energies.fight.amount >= Hero.energies.fight.max_amount) text = '<span class="orange">' + GT.design.Full + "</span>";
            else {
                var rechargeIn = Hero.c.fight.getTotalRemainingTime();
                text = GT.design.full_in + '<span class="orange" rel="timer">' + format_time_short(rechargeIn) + "</span>"
            }
            var newTooltip = new Tooltip($(target), GT.design.Combativity, text);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, ".energy_counter .hudKiss_mix_icn", false, function(target) {
            var text = void 0;
            if (Hero.energies.kiss.amount >= Hero.energies.kiss.max_amount) text = '<span class="orange">' + GT.design.Full + "</span>";
            else {
                var rechargeIn = Hero.c.kiss.getTotalRemainingTime();
                text = GT.design.full_in + '<span class="orange" rel="timer">' + format_time_short(rechargeIn) + "</span>"
            }
            var newTooltip = new Tooltip($(target), GT.design.Kiss, text);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "header .energy_counter .hudEnergy_mix_icn", false, function(target) {
            var text = void 0;
            if (Hero.energies.quest.amount >= Hero.energies.quest.max_amount) text = '<span class="orange">' + GT.design.Full + "</span>";
            else {
                var rechargeIn = Hero.c.quest.getTotalRemainingTime();
                text = GT.design.full_in + '<span class="orange" rel="timer">' + format_time_short(rechargeIn) + "</span>"
            }
            var newTooltip = new Tooltip($(target), GT.design.Energy, text);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[champion-healing-tooltip]", false, function(target) {
            var data = JSON.parse($(target).attr("champion-healing-tooltip"));
            if (!data) return;
            var amount = '<span class="white">' + data.amount + "</span>";
            var text = "";
            if (typeof data.amount !== "undefined") {
                text = GT.design.champions_healing_tooltip.replace("[impression_info]", data.impression_info).replace("[amount]", amount)
            } else {
                text = data.impression_info
            }
            var newTooltip = new Tooltip($(target), "", text);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, 'header div[rel="xp"]', false, function(target) {
            var left = number_format_lang(Hero.infos.Xp.left);
            var text = GT.design.tooltip_experience;
            text = text.replace("[xp_left]", '<span class="orange">' + left + "</span>");
            var newTooltip = new Tooltip($(target), GT.design.Experience, text);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, ".active_light", false, function(target) {
            var time = parseInt($(target).attr("afk"));
            if (!time) return;
            var text = GT.design.tooltip_afk;
            text = text.replace("[afk_time]", format_time_short(time));
            var newTooltip = new Tooltip($(target), text);
            _this13.initNewTooltip(target, newTooltip)
        });
        this.initTooltipType(isMobile, "[generic-tooltip]", false, function(target) {
            var data = $(target).attr("generic-tooltip");
            var newTooltip = new Tooltip($(target), "", data);
            _this13.initNewTooltip(target, newTooltip)
        });
        if (isMobile) {
            $("body").on("touchstart", function() {
                _this13.removeAllTooltips()
            })
        }
    },
    initTooltipType: function initTooltipType(isMobile, elmSelector, dataExtract, createTooltip) {
        var self = this;
        if (!isMobile) {
            $("body").on("mouseenter", elmSelector, function() {
                self.removeAllTooltips();
                if (dataExtract instanceof Function) {
                    var itemData = void 0;
                    if (itemData = dataExtract(this)) createTooltip(this, itemData)
                } else createTooltip(this)
            }).on("mouseleave", elmSelector, function() {
                self.removeTooltip(this)
            })
        } else {
            var delay = 0;
            var longpress = 800;
            $("body").on("touchstart", elmSelector, function() {
                var $clicked = $(this);
                if (dataExtract instanceof Function) {
                    var itemData = void 0;
                    if (itemData = dataExtract(this)) {
                        delay = setTimeout(function() {
                            createTooltip($clicked, itemData)
                        }, longpress)
                    }
                } else {
                    delay = setTimeout(function() {
                        createTooltip($clicked)
                    }, longpress)
                }
            });
            $("body").on("touchend", elmSelector, function() {
                if (delay) clearTimeout(delay)
            });
            $("body").on("touchcancel", elmSelector, function() {
                if (delay) clearTimeout(delay)
            })
        }
    },
    initNewTooltip: function initNewTooltip(target, tooltip) {
        tooltip.init();
        var tooltipId = $(target).attr(this.tooltipIdAttrSelector);
        if (!tooltipId) {
            tooltipId = "tooltip_" + this.tooltipIdCounter++;
            $(target).attr(this.tooltipIdAttrSelector, tooltipId)
        }
        this.tooltips[tooltipId] = tooltip
    },
    removeTooltip: function removeTooltip(target) {
        if (!this.doCloseTooltips) return;
        var tooltipId = $(target).attr(this.tooltipIdAttrSelector);
        var tooltip = this.tooltips[tooltipId];
        if (tooltip) {
            tooltip.close();
            delete this.tooltips[tooltipId]
        }
    },
    removeAllTooltips: function removeAllTooltips() {
        for (var tooltipId in this.tooltips) {
            if (this.tooltips[tooltipId]) this.tooltips[tooltipId].close()
        }
        this.tooltips = {}
    }
};
$(function() {
    TooltipManager.init()
});
var TutorialPopup = {
    _tuto_id: null,
    _tuto_text: null,
    _tutorialMessageCoordinates: null,
    _hiderCoordinates: null,
    _multipleTutorialPopups: [],
    _onCloseCallback: null,
    _onTutorialCallback: null,
    createTutorialMessage: function createTutorialMessage(initial, isMobile) {
        $("#popup_bunny>p").text(this._tuto_text);
        this.styleTutorialMessage(initial, isMobile)
    },
    styleTutorialMessage: function styleTutorialMessage(initial, isMobile) {
        var left = this._tutorialMessageCoordinates[!isMobile && this._tutorialMessageCoordinates.length > 2 ? 2 : 0];
        var top = this._tutorialMessageCoordinates[!isMobile && this._tutorialMessageCoordinates.length > 3 ? 3 : 1];
        var width = this.calculateTutorialMessageWidth(isMobile, left);
        var css = {
            left: left + "px",
            top: initial ? "-300px" : top + "px",
            width: width + "px"
        };
        $("#popup_bunny").css(css);
        $("#popup_bunny>img").css("pointer-events", "none");
        if (initial) setTimeout(function() {
            $("#popup_bunny").css({
                top: top + "px",
                left: left + "px"
            })
        }, 10)
    },
    calculateTutorialMessageWidth: function calculateTutorialMessageWidth(isMobile, left) {
        var width = this._tuto_text.length * 3;
        var maxWidth = isMobile ? 400 : 800;
        var limitWidth = isMobile ? 860 : 1020;
        width = width > maxWidth ? maxWidth : width;
        width = width < 300 ? 300 : width;
        width = width + left > limitWidth ? limitWidth - left : width;
        return width
    },
    createTutorialMessageButtons: function createTutorialMessageButtons(closingButtonID, buttonVisible, callback) {
        var isVisible = buttonVisible !== null && buttonVisible !== false || buttonVisible === null && closingButtonID !== null;
        $("#popup_bunny>button").toggle(isVisible).addClass("button_glow");
        if (typeof closingButtonID === "string") this._tuto_id = closingButtonID;
        if (typeof callback == "function") this._onTutorialCallback = callback
    },
    handleHHPopupManager: function handleHHPopupManager() {
        var options = {
            no_close: true,
            prevent_events: true
        };
        options.no_background = this._hiderCoordinates.length === 0 ? false : true;
        HHPopupManager.show("popup_bunny", options)
    },
    createPartSiteHider: function createPartSiteHider() {
        if (this._hiderCoordinates.length !== 0) {
            var partSiteHider = new PartSiteHider;
            partSiteHider.tutorial(this._hiderCoordinates)
        }
    },
    open: function open(text, tutorialMessageCoords, tutorialHiderCoords) {
        var closingButtonID = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
        var buttonVisible = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;
        var callback = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;
        this._tuto_text = text;
        this._tutorialMessageCoordinates = tutorialMessageCoords;
        this._hiderCoordinates = tutorialHiderCoords;
        var isMobile = is_mobile_size();
        this.createTutorialMessage(true, isMobile);
        this.createTutorialMessageButtons(closingButtonID, buttonVisible, callback);
        this.createPartSiteHider();
        this.handleHHPopupManager();
        HHMenu.noSwipe = true
    },
    openNoHider: function openNoHider(text, tutorialMessageCoords) {
        this._tuto_text = text;
        this._tutorialMessageCoordinates = tutorialMessageCoords;
        var isMobile = is_mobile_size();
        this.createTutorialMessage(true, isMobile);
        HHPopupManager.show("popup_bunny", {
            no_close: true,
            prevent_events: true,
            no_background: true
        });
        HHMenu.noSwipe = true
    },
    openMultiple: function openMultiple(tutorialArray, onCloseCallback) {
        this._multipleTutorialPopups = tutorialArray;
        var cur = this._multipleTutorialPopups.shift();
        this.open(cur[0], cur[1], cur[2], cur[3], cur[4], cur[5]);
        this._onCloseCallback = onCloseCallback
    },
    updateTutoBunny: function updateTutoBunny(pref_data_id) {
        var params = {
            class: "Hero",
            action: "tuto_bunny",
            tuto_id: pref_data_id
        };
        hh_ajax(params, function(data) {
            if (!data.success) {
                HHPopupManager.closeLastOpenedPopup();
                popup_message("Could not save Hero preferences.");
                return
            }
        })
    },
    close: function close(preservePartSiteHider) {
        if (this._tuto_id) this.updateTutoBunny(this._tuto_id);
        if (!preservePartSiteHider) $("#part_site_hider").remove();
        else HHPopupManager.closeLastOpenedPopup();
        HHMenu.noSwipe = false;
        if (this._onTutorialCallback) {
            var callCallback = this._onTutorialCallback;
            this._onTutorialCallback = null;
            callCallback()
        }
        if (this._multipleTutorialPopups.length) {
            var cur = this._multipleTutorialPopups.shift();
            this.open(cur[0], cur[1], cur[2], cur[3], cur[4], cur[5], cur[6])
        } else if (this._onCloseCallback) {
            var _callCallback = this._onCloseCallback;
            this._onCloseCallback = null;
            _callCallback()
        }
    }
};
var Tutorial = {
    currentPage: undefined,
    data: undefined,
    tuto_is_mobile: is_mobile_size(),
    init: function init(data) {
        var _this = this;
        this.currentPage = $("body").attr("page");
        if (!this.currentPage) {
            console.log("Warning: Game page could not be identified!");
            return
        }
        this.data = data;
        setTimeout(function() {
            _this.play()
        }, 100)
    },
    calculateSizeAndPosition: function calculateSizeAndPosition($element, circle) {
        var sideMargins = parseInt($element.css("margin-left"), 10) + parseInt($element.css("margin-right"), 10);
        var originalHeight = $element.outerHeight();
        var $title = $element.children("h3, h4").first();
        var addedSize = $title.length ? $title.outerHeight() / 2 : 0;
        var elementHeight = Math.max(originalHeight, 20);
        var modifyPosition = {
            top: originalHeight < 20 ? 10 : 5 + addedSize,
            height: elementHeight <= 30 ? 16 : 12 + addedSize
        };
        var left = ($element.offset().left - $("#contains_all").offset().left) / FullSize.scale - Math.round(sideMargins / 2);
        var top = $element.offset().top / FullSize.scale - modifyPosition.top;
        var width = $element.outerWidth() + sideMargins;
        var height = elementHeight + modifyPosition.height;
        var output = [left, top];
        if (circle) {
            var radius = Math.max(width, height);
            output[1] -= (radius - height) / 2;
            output = output.concat([radius, radius, circle])
        } else output = output.concat([width, height, circle]);
        return output
    },
    getHiderFromDom: function getHiderFromDom($selector) {
        var offsets = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
        var circle = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
        var clickable = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
        var coords = this.calculateSizeAndPosition($selector, circle);
        if (offsets.length !== 0) {
            for (var i in offsets) {
                coords[i] += offsets[i]
            }
        }
        coords.push(clickable);
        return coords
    },
    getHiderFromCoords: function getHiderFromCoords(mobileCoords) {
        var desktopCoords = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
        var circle = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
        var clickable = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
        var coords = desktopCoords.length === 0 || is_mobile_size() ? mobileCoords : desktopCoords;
        coords.push(circle, clickable);
        return coords
    },
    updateTutoId: function updateTutoId(tuto_id, destination) {
        var params = {
            class: "Hero",
            action: "tuto_bunny",
            tuto_id: tuto_id
        };
        hh_ajax(params, function() {
            if (typeof destination == "function") destination();
            else if (destination) location.href = destination
        })
    },
    interceptClick: function interceptClick(selector, tuto_id, destination) {
        var _this2 = this;
        $(selector).on("click", function(event) {
            event.preventDefault();
            event.stopPropagation();
            if (typeof destination == "boolean" && destination) _this2.updateTutoId(tuto_id, $(event.target).attr("href"));
            else _this2.updateTutoId(tuto_id, destination)
        })
    },
    play: function play() {
        var tutorialFuncName = "play_" + this.currentPage;
        if (this[tutorialFuncName] != undefined) this[tutorialFuncName]()
    },
    play_home: function play_home() {
        if (!this.data.home1 || !this.data.home2) {
            $(".continue_quest_home, #collect_all_container").remove()
        }
        var context = this;
        if (!this.data.home1) {
            var bunny_tuto_home1 = function bunny_tuto_home1() {
                var popup_coords = [220, 386, 460, 320];
                var hider_coords = context.getHiderFromDom($('[rel="harem"]>div.position>span'), [-10, -12, 20, 20], true, true);
                TutorialPopup.open(GT.design.tuto_bunny_home, popup_coords, hider_coords);
                $('[rel="harem"]>span').addClass("home_label_glow")
            };
            if (this.data.postAppear) bunny_tuto_home1();
            else {
                $("#girl_reward button").click(bunny_tuto_home1)
            }
        } else if (!this.data.home2) {
            var popup_coords = [266, 404, 300, 360];
            var hider_coords = this.getHiderFromDom($('[rel="map"]>div.position>span'), [-10, -12, 20, 20], true, true);
            TutorialPopup.open(GT.design.tuto_bunny_adventure, popup_coords, hider_coords);
            $('[rel="map"]>span').addClass("home_label_glow")
        } else if (!this.data.home3 && this.data.tab_pop_available) {
            var _popup_coords = [360, 250, 480, 320];
            var _hider_coords = this.getHiderFromDom($('[rel="activities"]>div.position>span'), [-10, -12, 20, 20], true, true);
            var text = GT.design.tuto_bunny_pop_initial.replace("[name]", Hero.infos.Name);
            TutorialPopup.open(text, _popup_coords, _hider_coords, "home3");
            this.interceptClick('[rel="activities"]', "home3", "/activities.html")
        } else if (!this.data.home4 && this.data.seasons_available && $(".seasons_button").length) {
            var _popup_coords2 = [440, 325, 380, 260];
            var _hider_coords2 = this.getHiderFromDom($(".seasons_button"), [-20, -10, 40, 20], false, true);
            TutorialPopup.open(GT.design.tuto_bunny_seasons, _popup_coords2, _hider_coords2, "home4");
            this.interceptClick(".seasons_button", "home4", "/season.html")
        }
    },
    play_harem: function play_harem() {
        if (this.data.home1) return;
        var context = this;

        function bunny_tuto_harem_initial() {
            var popup_coords = [400, 120, 398, 153];
            var hider_coords = context.getHiderFromCoords([10, 160, 340, 145], [35, 120, 315, 145], false, true);
            TutorialPopup.open(GT.design.tuto_bunny_harem_initial, popup_coords, hider_coords);
            $(".salary .collect_money").addClass("button_glow");
            var salaryInterval = setInterval(function() {
                var $girls = $("#harem_left div[girl]").not(".not_owned").slice(0, 2);
                if ($girls.find(".salary.loads").length == $girls.length) {
                    clearInterval(salaryInterval);
                    bunny_tuto_harem_multi();
                    context.updateTutoId("harem_collected");
                    $(".salary .collect_money").removeClass("button_glow")
                }
            }, 500)
        }

        function bunny_tuto_harem_multi() {
            var onClose = bunny_tuto_harem_last;
            var popup_coords = [
                [100, 220, 250, 233],
                [80, 325, 210, 80],
                [80, 350, 400, 230]
            ];
            var hider_coords = [context.getHiderFromDom(is_mobile_size() ? $(".tab-body .stats_box") : $(".girl_caracs .stats_box")), context.getHiderFromDom(is_mobile_size() ? $('[tab-data="stats"] .experience') : $('[data-block="experience"]')), context.getHiderFromDom(is_mobile_size() ? $('[tab-data="stats"] .affection') : $('[data-block="affection"]'))];
            TutorialPopup.openMultiple([
                [GT.design.tuto_bunny_harem2, popup_coords[0], hider_coords[0], true],
                [GT.design.tuto_bunny_harem3, popup_coords[1], hider_coords[1], true],
                [GT.design.tuto_bunny_harem4, popup_coords[2], hider_coords[2], "home1"]
            ], onClose)
        }

        function bunny_tuto_harem_last() {
            var popupText = GT.design.tuto_bunny_harem_last.replace("[clickon]", context.tuto_is_mobile ? GT.design.tuto_harem_clickon_mob : GT.design.tuto_harem_clickon_desktop);
            var popup_coords = [365, 126, 555, 135];
            var hider_coords = context.getHiderFromDom($(".close_cross"), [-6, -2], true, true);
            TutorialPopup.open(popupText, popup_coords, hider_coords)
        }
        if (!this.data.harem_collected) bunny_tuto_harem_initial();
        else bunny_tuto_harem_multi()
    },
    play_map: function play_map() {
        if (this.data.home2) return;
        $(".continue_quest_map").hide();
        var popup_coords = [320, 87, 310, 105];
        var hiderOffset = is_mobile_size() ? [80, 63, -180, -180] : [75, 52, -180, -180];
        var hider_coords = this.getHiderFromDom($(".canvas>a.link-world:first-child"), hiderOffset, true, true);
        TutorialPopup.open(GT.design.tuto_bunny_map, popup_coords, hider_coords);
        $(".ico-world").each(function() {
            if ($(this).find(".ico-lock").length == 0) {
                $(this).addClass("general_glow")
            }
        })
    },
    play_world: function play_world() {
        if (this.data.home2) return;
        var id_quest = this.data.q3;
        var $quests = $("#worldmap>a.ico-quest");
        var this_quest_selector = '[href="/quest/' + id_quest + '"]';
        $quests.not(this_quest_selector).removeAttr("href");
        var $quest = $quests.filter(this_quest_selector);
        var popup_coords = [];
        if (this.data.content === "nerd") {
            popup_coords = [400, 150, 400, 150]
        } else {
            popup_coords = [185, 307, 60, 270]
        }
        var hider_coords = this.getHiderFromDom($quest, [], false, true);
        TutorialPopup.open(GT.design.tuto_bunny_world1, popup_coords, hider_coords);
        $quest.addClass("general_glow");
        this.interceptClick(".ico-quest", "home2", "/quest/" + id_quest)
    },
    play_shop: function play_shop() {
        if (this.data.shop1) return;
        var popup_coords = [
            [470, 140, 524, 184],
            [35, 365, 20, 184]
        ];
        var hider_coords = [this.getHiderFromDom($("#shops_left")), this.getHiderFromDom($("#shops_right"))];
        TutorialPopup.openMultiple([
            [GT.design.tuto_bunny_shop1, popup_coords[0], hider_coords[0], "shop1"],
            [GT.design.tuto_bunny_shop2, popup_coords[1], hider_coords[1], "shop2"]
        ])
    },
    play_arena: function play_arena() {
        if (this.data.battle1) return;
        var context = this;

        function _bunnyРўutoРђrena() {
            var popup_coords = [
                [266, 221],
                [400, 221],
                [250, 221],
                [336, 34, 447]
            ];
            var hider_coords = [
                [], context.getHiderFromDom($(".battle_user_block.battle_hero")), context.getHiderFromDom($(".daily_quest")), context.getHiderFromDom($(".opponents_arena"))
            ];
            TutorialPopup.openMultiple([
                [GT.design.tuto_bunny_battle1, popup_coords[0], hider_coords[0], "battle1"],
                [GT.design.tuto_bunny_battle2, popup_coords[1], hider_coords[1], "battle2"],
                [GT.design.tuto_bunny_battle3, popup_coords[2], hider_coords[2], "battle3"],
                [GT.design.tuto_bunny_battle4, popup_coords[3], hider_coords[3], "battle4"]
            ])
        }
        if (this.data.postAppear) _bunnyРўutoРђrena();
        else {
            $("#girl_reward button").on("click", function() {
                _bunnyРўutoРђrena()
            })
        }
    },
    play_pachinko: function play_pachinko() {
        if (this.data.tuto_pachinko == 1) {
            setTimeout(function() {
                $("#pachinko_free").show()
            }, 200);
            var popup_coords = [55, 55, 219, 174];
            var hider_coords = this.getHiderFromDom($('#playzone-replace-info [nb_games="1"]'), [], false, true);
            TutorialPopup.open(GT.design.tuto_bunny_pachinko2, popup_coords, hider_coords)
        } else if (!this.data.pachinko) {
            var _popup_coords3 = [280, 240, 250, 300];
            var _hider_coords3 = [];
            TutorialPopup.openMultiple([
                [GT.design.tuto_bunny_pachinko, _popup_coords3, _hider_coords3, "pachinko"]
            ])
        } else if (this.data.tuto_pachinko_orbs) {
            var _popup_coords4 = [
                [250, 250],
                [250, 250]
            ];
            var _hider_coords4 = [
                [], this.getHiderFromDom($("#playzone-replace-info button").first())
            ];
            TutorialPopup.openMultiple([
                [GT.design.tuto_pachinko_orbs_1, _popup_coords4[0], _hider_coords4[0], "test1"],
                [GT.design.tuto_pachinko_orbs_2, _popup_coords4[1], _hider_coords4[1], "test2"]
            ])
        }
    },
    play_leaderboard: function play_leaderboard() {
        if (!this.data.leagues6 && league_tag && $(".tabs .leagues.selected").length) {
            var popups_coords = [
                [150, 120],
                [200, 220],
                [250, 375, 250, 420],
                [50, 100, 150, 430],
                [200, 230],
                [175, 160, 250, 160]
            ];
            var hider_coords = [this.getHiderFromDom($(".tabs .leagues.selected")), this.getHiderFromDom($(".tier_icons")), is_mobile_size() ? this.getHiderFromCoords([930, 225, 90, 60]) : this.getHiderFromDom($(".challenge_points.energy_counter")), is_mobile_size() ? this.getHiderFromCoords([615, 360, 120, 70]) : this.getHiderFromDom($(".challenge .wrapper")), [],
                []
            ];
            TutorialPopup.openMultiple([
                [GT.design.tuto_bunny_leagues1, popups_coords[0], hider_coords[0], "leagues1"],
                [GT.design.tuto_bunny_leagues2, popups_coords[1], hider_coords[1], "leagues2"],
                [GT.design.tuto_bunny_leagues3, popups_coords[2], hider_coords[2], "leagues3"],
                [GT.design.tuto_bunny_leagues4, popups_coords[3], hider_coords[3], "leagues4"],
                [GT.design.tuto_bunny_leagues5, popups_coords[4], hider_coords[4], "leagues5"],
                [GT.design.tuto_bunny_leagues6, popups_coords[5], hider_coords[5], "leagues6"]
            ])
        }
    },
    play_season: function play_season() {
        if (!this.data.seasons1 || !this.data.seasons2 || !this.data.seasons3) {
            var multipleTabs = [];
            if (!this.data.seasons1) {
                var popup_coords = [280, 200, 360, 240];
                var hider_coords = this.getHiderFromDom($("#rewards_cont_scroll"), [10, 0, -20], false, false);
                multipleTabs.push([GT.design.tuto_bunny_seasons1, popup_coords, hider_coords, "seasons1"])
            }
            if (!this.data.seasons2) {
                var _popup_coords5 = [240, 295, 340, 315];
                var _hider_coords5 = this.getHiderFromDom($("#rewards_cont_scroll"), [45, 80, -90, -110], false, false);
                multipleTabs.push([GT.design.tuto_bunny_seasons2, _popup_coords5, _hider_coords5, "seasons2"])
            }
            if (!this.data.seasons3) {
                var _popup_coords6 = [300 + $(".seasons_controls_holder_global a div").width(), 200];
                var _hider_coords6 = this.getHiderFromDom($(".seasons_controls_holder_global a div"), [-10, 0, 20], false, true);
                multipleTabs.push([GT.design.tuto_bunny_seasons3, _popup_coords6, _hider_coords6, "seasons3", false])
            }
            if (multipleTabs.length) {
                TutorialPopup.openMultiple(multipleTabs)
            }
            this.interceptClick(".seasons_controls_holder_global a", "seasons3", "/season-arena.html")
        }
    },
    play_season_arena: function play_season_arena() {
        var _highlightTutorialButton = function _highlightTutorialButton() {
            $('[rel="launch"]').first().addClass("general_glow")
        };
        if (!this.data.seasons4 || !this.data.seasons5) {
            var multipleTabs = [];
            if (!this.data.seasons4) {
                var popup_coords = [320, 210];
                var hider_coords = this.getHiderFromDom($(".season_arena_block"), [0, 24, 0, -40], false, false);
                multipleTabs.push([GT.design.tuto_bunny_seasons4, popup_coords, hider_coords, "seasons4", true, _highlightTutorialButton])
            }
            if (!this.data.seasons5) {
                if (this.data.seasons4) {
                    _highlightTutorialButton()
                }
                this.interceptClick('[rel="launch"]', "seasons5", true);
                var _popup_coords7 = [540, 320, 580, 240];
                var _hider_coords7 = this.getHiderFromDom($(".season_arena_opponent_container"), [-5, -2, 10, 50], false, true);
                multipleTabs.push([GT.design.tuto_bunny_seasons5, _popup_coords7, _hider_coords7, "seasons5", false])
            }
            if (multipleTabs.length) {
                TutorialPopup.openMultiple(multipleTabs)
            }
        } else if (!this.data.seasons7) {
            var _popup_coords8 = [250, 240, 320];
            var _hider_coords8 = [];
            TutorialPopup.open(GT.design.tuto_bunny_seasons7, _popup_coords8, _hider_coords8, "seasons7");
            if (!this.data.seasons6) {
                TutorialPopup.updateTutoBunny("seasons6")
            }
        }
    },
    play_battle: function play_battle() {
        var context = this;
        if (this.data.seasons5 && !this.data.seasons6) {
            if (getParameterByName("id_season_arena")) {
                var observer = new MutationObserver(function(mutations) {
                    var _iteratorNormalCompletion = true;
                    var _didIteratorError = false;
                    var _iteratorError = undefined;
                    try {
                        for (var _iterator = mutations[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                            var mutation = _step.value;
                            if (mutation.target.innerHTML == "0") {
                                var popup_coords = [300, 180, 400];
                                var hider_coords = [];
                                TutorialPopup.open(GT.design.tuto_bunny_seasons6, popup_coords, hider_coords, "seasons6");
                                TutorialPopup._onCloseCallback = function() {
                                    setTimeout(function() {
                                        return $("#popup_bunny").hide()
                                    }, 1)
                                };
                                observer.disconnect()
                            }
                        }
                    } catch (err) {
                        _didIteratorError = true;
                        _iteratorError = err
                    } finally {
                        try {
                            if (!_iteratorNormalCompletion && _iterator.return) {
                                _iterator.return()
                            }
                        } finally {
                            if (_didIteratorError) {
                                throw _iteratorError
                            }
                        }
                    }
                });
                observer.observe($(".battle_opponent .battle-bar-ego .over span")[0], {
                    attributes: true,
                    childList: true,
                    subtree: true,
                    characterData: true
                })
            }
        }
    },
    play_missions: function play_missions() {
        var _this3 = this;
        if (!this.data.missions && this.data.active_tab == "missions") {
            var popup_coords = [300, 250, 370];
            var hider_coords = [];
            TutorialPopup.open(GT.design.tuto_bunny_missions, popup_coords, hider_coords, "missions")
        } else if (!this.data.contests && this.data.active_tab == "contests") {
            var _popup_coords9 = [101, 234, 351];
            var _hider_coords9 = [];
            TutorialPopup.open(GT.design.tuto_bunny_contests, _popup_coords9, _hider_coords9, "contests")
        } else if (this.data.tab_pop_available) {
            var _displayPoPTutorialScreens = function _displayPoPTutorialScreens() {
                var _locallyCompleteTutorials = function _locallyCompleteTutorials() {
                    multipleTabs = [];
                    _this3.data.pop = 1;
                    _this3.data.pop1 = 1;
                    _this3.data.pop2 = 1;
                    _this3.data.pop3 = 1;
                    _this3.data.pop4 = 1;
                    _this3.data.pop5 = 1;
                    _this3.data.pop6 = 1;
                    _this3.data.pop7 = 1;
                    _this3.data.pop8 = 1
                };
                var multipleTabs = [];
                if (!_this3.data.pop2) {
                    var _popup_coords10 = [250, 200, 350, 250];
                    var _hider_coords10 = _this3.getHiderFromDom($(".pop_rewards"), [0, 0, -30, -20], false, false);
                    multipleTabs.push([GT.design.tuto_bunny_pop2, _popup_coords10, _hider_coords10, "pop2"])
                }
                if (!_this3.data.pop3) {
                    var _popup_coords11 = [250, 100, 350, 155];
                    var _hider_coords11 = _this3.getHiderFromDom($(".pop_power_needed"), [20, -12, -40, 15], false, false);
                    multipleTabs.push([GT.design.tuto_bunny_pop3, _popup_coords11, _hider_coords11, "pop3"])
                }
                if (!_this3.data.pop4) {
                    var _popup_coords12 = [230, 300, 340, 360];
                    var _hider_coords12 = _this3.getHiderFromDom($('[rel="pop_action"]'));
                    multipleTabs.push([GT.design.tuto_bunny_pop4, _popup_coords12, _hider_coords12, "pop4"])
                }
                if (!_this3.data.pop5) {
                    var _popup_coords13 = [240, 140, 385, 115];
                    var _hider_coords13 = _this3.getHiderFromDom($(".acting-power-min"), [0, 0, 0, 10], false, false);
                    multipleTabs.push([GT.design.tuto_bunny_pop5, _popup_coords13, _hider_coords13, "pop5"])
                }
                if (!_this3.data.pop6) {
                    var _popup_coords14 = [240, 260, 385, 275];
                    var _hider_coords14 = _this3.getHiderFromDom($(".grid_view"));
                    multipleTabs.push([GT.design.tuto_bunny_pop6, _popup_coords14, _hider_coords14, "pop6"])
                }
                if (!_this3.data.pop7) {
                    var _popup_coords15 = [240, 380, 385, 390];
                    var _hider_coords15 = _this3.getHiderFromDom($('[rel="pop_auto_assign"]'));
                    multipleTabs.push([GT.design.tuto_bunny_pop7, _popup_coords15, _hider_coords15, "pop7"])
                }
                if (!_this3.data.pop8) {
                    var _popup_coords16 = [186, 260, 350, 240];
                    var _hider_coords16 = _this3.getHiderFromDom($('[rel="pop_levelup"]'), [-10, 0, 20], false, false);
                    multipleTabs.push([GT.design.tuto_bunny_pop8, _popup_coords16, _hider_coords16, "pop8", true, _locallyCompleteTutorials])
                }
                if (multipleTabs.length) {
                    TutorialPopup.openMultiple(multipleTabs)
                }
            };
            _displayPoPTutorialList = function _displayPoPTutorialList() {
                var popup_coords = [250, 350, 330, 300];
                var hider_coords = _this3.getHiderFromDom($(".pop_thumb_selected"), [], false, true);
                TutorialPopup.open(GT.design.tuto_bunny_pop1, popup_coords, hider_coords, "pop1", false);
                _this3.interceptClick('button[rel="pop_thumb_info"]', "pop1")
            };
            var areTutorialsNotPassed = !this.data.pop1 || !this.data.pop2 || !this.data.pop3 || !this.data.pop4 || !this.data.pop5 || !this.data.pop6 || !this.data.pop7 || !this.data.pop8;
            var currentTab = act_tab.identifyTab();
            var pendingReward = $(".pop_thumb").attr("status") == "pending_reward";
            if (areTutorialsNotPassed) {
                if (pendingReward) {
                    TutorialPopup.updateTutoBunny("pop");
                    for (var i = 1; i < 9; i++) {
                        TutorialPopup.updateTutoBunny("pop" + i)
                    }
                    return
                }
                if (currentTab == "pop") {
                    TutorialPopup.updateTutoBunny("pop");
                    _displayPoPTutorialScreens()
                } else {
                    var $element = $('[rel="pop"]');
                    var _popup_coords17 = [125, 180, 180, 140];
                    var _hider_coords17 = this.getHiderFromDom($element, [], false, true);
                    TutorialPopup.open(GT.design.tuto_bunny_pop, _popup_coords17, _hider_coords17, "pop", false);
                    $element.addClass("general_glow");
                    this.interceptClick('[rel="pop"]', "pop", function() {
                        $element.removeClass("general_glow");
                        act_tab.changeTab(null, "pop");
                        _displayPoPTutorialList()
                    })
                }
            } else if (!this.data.pop) {
                TutorialPopup.updateTutoBunny("pop")
            }
        }
    }
};
$(function() {
    if (!$("header").hasClass("intro")) {
        Tutorial.init(tutoData)
    }
});
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};
var _slicedToArray = function() {
    function sliceIterator(arr, i) {
        var _arr = [];
        var _n = true;
        var _d = false;
        var _e = undefined;
        try {
            for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
                _arr.push(_s.value);
                if (i && _arr.length === i) break
            }
        } catch (err) {
            _d = true;
            _e = err
        } finally {
            try {
                if (!_n && _i["return"]) _i["return"]()
            } finally {
                if (_d) throw _e
            }
        }
        return _arr
    }
    return function(arr, i) {
        if (Array.isArray(arr)) {
            return arr
        } else if (Symbol.iterator in Object(arr)) {
            return sliceIterator(arr, i)
        } else {
            throw new TypeError("Invalid attempt to destructure non-iterable instance")
        }
    }
}();
var RewardsBuilder = {
    isPreview: true,
    init: function init() {
        var self = this;
        $("[data-reward-display]").each(function() {
            var rewardDisplayData = $(this).data("reward-display");
            var rewardDisplayElement = $(this);
            if (rewardDisplayElement.hasClass("arena-rewards-list") || rewardDisplayElement.hasClass("league-reward-list")) {
                if (rewardDisplayData.hasOwnProperty("rewards")) {
                    var itemSlot = '<div class="slot"><img src=' + IMAGES_URL + "/design/ic_gift.png></div>";
                    var itemIconAdded = false;
                    rewardDisplayData.rewards.forEach(function(reward) {
                        if (reward.type === "item" && itemIconAdded === false) {
                            rewardDisplayElement.prepend(itemSlot);
                            itemIconAdded = true
                        }
                    });
                    var filteredRewards = rewardDisplayData.rewards.filter(function(reward) {
                        return reward.type !== "item"
                    });
                    rewardDisplayData.rewards = filteredRewards
                }
            }
            rewardDisplayElement.prepend(self.buildPreviewHtml(rewardDisplayData))
        })
    },
    buildHtml: function buildHtml(rewards) {
        if (rewards.list) return this._buildListableHtml(rewards.list);
        else if (rewards.data) {
            if (rewards.data.MC) return this._buildMonthlyCardNotificationHTML(rewards.data.MC);
            else if (rewards.data.season_pass) {
                return this._buildSeasonPassHTML(rewards.data)
            } else return this._buildDropHtml(rewards.data)
        } else throw new Error("Invalid format for rewards: " + rewards)
    },
    buildPreviewHtml: function buildPreviewHtml(rewardsData) {
        if (!Object.keys(rewardsData).length) return;
        return this._buildMultipleSlots(this.reformatRewards(rewardsData))
    },
    reformatRewards: function reformatRewards(rewardsData) {
        if (!this._isRewardCategory(rewardsData)) {
            var reformattedRewards = [];
            for (var category in rewardsData) {
                if (["rewards", "shards", "team"].indexOf(category) > -1) reformattedRewards = reformattedRewards.concat(rewardsData[category])
            }
            return reformattedRewards
        }
        return rewardsData
    },
    _isRewardCategory: function _isRewardCategory(data) {
        return data[0] && data[0].hasOwnProperty("type")
    },
    _buildListableHtml: function _buildListableHtml(rewardsData) {
        this.isPreview = false;
        var body = "";
        for (var i in rewardsData) {
            var _rewardsData$i = rewardsData[i],
                field = _rewardsData$i.field,
                rank = _rewardsData$i.rank,
                data = _rewardsData$i.data;
            var centerSlot = rewardsData.length == 1 ? 'class="centered_slot"' : "";
            body += '<div class="line unlimited">\n\t\t\t\t\t\t<span>' + field + "</span>\n\t\t\t\t\t\t<span>" + rank + "</span>\n\t\t\t\t\t\t<div " + centerSlot + ">" + this._buildMultipleSlots(data.rewards) + "</div>\n\t\t\t\t\t</div>"
        }
        return body
    },
    _buildDropHtml: function _buildDropHtml(_ref) {
        var shards = _ref.shards,
            rewards = _ref.rewards,
            team = _ref.team,
            girls = _ref.girls,
            surplus_item = _ref.surplus_item,
            draft = _ref.draft;
        this.isPreview = false;
        var shardsHTML = "";
        var dropsHTML = "";
        if (shards) shardsHTML += this._buildWrapper(shards, "shards");
        if (team) dropsHTML += this._buildWrapper(team, "team");
        if (rewards) dropsHTML += this._buildWrapper(rewards, undefined, !team || !team.value.girls.length);
        if (girls && girls.length && !shards) {
            if (draft) shardsHTML += this._buildDraftBox(girls, surplus_item);
            else shardsHTML += this._buildGirlBox(girls[0], surplus_item)
        }
        var bodyHTML = "\n\t\t\t<div class='rewards_static'>\n\t\t\t\t" + shardsHTML + "\n\t\t\t</div>\n\t\t\t<div class='rewards_scrollable'>\n\t\t\t\t" + dropsHTML + "\n\t\t\t</div>";
        return bodyHTML
    },
    _buildMonthlyCardNotificationHTML: function _buildMonthlyCardNotificationHTML(MC_type) {
        var body = "";
        var imageFile = IMAGES_URL + "/pictures/design/payments/mc_bgr/";
        switch (MC_type) {
            case 1:
                imageFile += "mc_silver.png";
                break;
            case 2:
                imageFile += "mc_gold.png";
                break;
            case 3:
                imageFile += "mc_platinum.png";
                break
        }
        var style = 'style="height: 19.9rem"';
        var styleDiv = ' style="align-self: flex-start"';
        var imageTag = '<img src="' + imageFile + '" ' + style + " ></img>";
        body += "<div " + styleDiv + "> " + imageTag + "</div>";
        return body
    },
    _buildSeasonPassHTML: function _buildSeasonPassHTML(data) {
        var body = "";
        var imageFile = IMAGES_URL + "/pictures/design/season_pass.png";
        var imageTag = '<img src="' + imageFile + '"/>';
        var sp_text = GT.design.Season_pass || "Season pass:";
        var _season_name = data.season_name || sp_name;
        var _season_flavor = data.season_flavor || sp_flavor;
        var texts = '<div>\n\t\t\t\t\t\t<div class="popup_season_pass_text">' + sp_text + '</div>\n\t\t\t\t\t\t<div class="popup_season_pass_title">' + _season_flavor + '</div>\n\t\t\t\t\t\t<div class="popup_season_pass_ts">' + _season_name + "</div>\n\t\t\t\t\t</div>";
        body += '<div class="popup_seasons_pass_img_container"> ' + imageTag + "</div>" + texts;
        return body
    },
    _buildGirlBox: function _buildGirlBox(_ref2, surplus_item) {
        var id_girl = _ref2.id_girl,
            name = _ref2.name,
            rarity = _ref2.rarity,
            ico = _ref2.ico,
            value = _ref2.value,
            avatar = _ref2.avatar,
            black_avatar = _ref2.black_avatar;
        var bonus = '<span class="bonus">' + GT.design.bonus + "</span>" + surplus_item;
        var girlBox = '<div class="masked_girl line">\n\t\t\t\t\t\t\t<div class="gradient" style="-webkit-mask-image: url(' + black_avatar + ')"></div>\n\t\t\t\t\t\t\t<img class="girl_border_glow" src="' + black_avatar.toImageUrl("avb") + '" />\n\t\t\t\t\t\t\t<img class="normal_girl" src="' + avatar.toImageUrl("ava") + '" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="line gifted">\n\t\t\t\t\t\t\t<div class="shards_wrapper">\n\t\t\t\t\t\t\t\t<div class="shards_name"> ' + name + " " + GT.design.shards + ':</div>\n\t\t\t\t\t\t\t\t<div class="shards_girl_ico" rarity="' + rarity + '">\n\t\t\t\t\t\t\t\t\t<img src="' + ico.toImageUrl("ico") + '">\n\t\t\t\t\t\t\t\t\t' + this.buildShardsValue(value, name, value) + "\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t" + (value > 100 ? bonus : "") + "\n\t\t\t\t\t\t</div>";
        return girlBox
    },
    _buildDraftBox: function _buildDraftBox(_ref3, surplus_item) {
        var _ref4 = _slicedToArray(_ref3, 2),
            leftGirl = _ref4[0],
            rightGirl = _ref4[1];
        leftGirl.side = "left";
        rightGirl.side = "right";
        var GT_or = Phoenix.__.General.or.toUpperCase();
        var girlBox = this._buildDraftGirl(leftGirl, surplus_item);
        girlBox += '<div class="middle-positioned-text">' + GT_or + "</div>";
        girlBox += this._buildDraftGirl(rightGirl, surplus_item);
        return girlBox
    },
    _buildWrapper: function _buildWrapper(rewards, type, isSupersizable) {
        var body = this._isRewardCategory(rewards) ? this._buildMultipleSlots(rewards) : this.buildSlot(rewards);
        var amount = Object.keys(rewards).length;
        var supersize = amount <= 3 && isSupersizable ? "supersize" : "";
        var additionalClass = type == "team" ? type + "_drops_wrapper" : "";
        if (type == "shards" && !this.isPreview) {
            return '<div class="line shards_line unlimited ' + supersize + '">\n\t\t\t\t\t\t<div class="shards_wrapper">\n\t\t\t\t\t\t\t<div class="shards_name"> ' + GT.design.Girls + " " + GT.design.shards + ":</div>\n\t\t\t\t\t\t\t" + body + "\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"
        }
        return '<div class="line ' + supersize + " " + additionalClass + '">' + body + "</div>"
    },
    _buildMultipleSlots: function _buildMultipleSlots(rewardsData) {
        var body = "";
        for (var key in rewardsData) {
            body += this.buildSlot(rewardsData[key])
        }
        return body
    },
    _buildAdditionalSlotInfo: function _buildAdditionalSlotInfo() {
        var additionalInfo = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
        var tooltipAttributes = "";
        if (additionalInfo !== null) {
            for (var tooltipKey in additionalInfo) {
                var tooltipData = additionalInfo[tooltipKey];
                if ((typeof tooltipData === "undefined" ? "undefined" : _typeof(tooltipData)) == "object" && tooltipData !== null) {
                    tooltipData = JSON.stringify(tooltipData);
                    tooltipAttributes += tooltipKey + "=" + tooltipData
                } else {
                    tooltipAttributes += tooltipKey + '="' + tooltipData + '"'
                }
            }
        }
        return tooltipAttributes
    },
    buildSlot: function buildSlot(slot) {
        var additionalTooltipOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
        var type = slot.type,
            value = slot.value,
            slot_class = slot.slot_class,
            currency = slot.currency,
            ico = slot.ico,
            rarity = slot.rarity,
            name = slot.name,
            previous_value = slot.previous_value,
            display = slot.display;
        slot_class = slot_class ? "slot" : false;
        currency = currency ? 'cur="' + type + '"' : "";
        var shards = value - previous_value;
        if (type == "girl_shards" && this.isPreview) {
            if (value) {
                value = this._buildSmallShardsSlot({
                    rarity: rarity,
                    ico: ico,
                    shards: shards
                })
            } else value = this._buildGirlIco({
                ico: ico,
                rarity: rarity
            })
        } else if (type == "girl_shards" && !this.isPreview) {
            value = this.buildShardsSlot(slot, shards)
        } else if (type == "girls_xp_affection") {
            var body = "";
            for (var i in value.girls) {
                var girl = value.girls[i];
                var xp = girl.xp,
                    affection = girl.affection,
                    _ico = girl.ico,
                    _rarity = girl.rarity,
                    team_position = girl.team_position;
                if (xp || affection) body += '<div class="girl_slot"><span>' + team_position + "</span>" + this._buildGirlIco(girl) + '<div class="stats">' + xp + affection + "</div></div>"
            }
            return body
        } else if (display == "mystery") {
            value = '<div class="slot gift">\n\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design/ic_gift.png">\n\t\t\t\t\t</div>'
        }
        var tooltipAttributes = this._buildAdditionalSlotInfo(additionalTooltipOptions);
        if (!slot_class && tooltipAttributes !== "" && value.indexOf("id_item") > -1) {
            var temp = value.split("");
            temp.splice(value.indexOf("id_item"), 0, tooltipAttributes + " ");
            value = temp.join("")
        }
        var rval = !slot_class ? value : '<div class="' + slot_class + " slot_" + type + '" ' + tooltipAttributes + " " + currency + ">" + value + "</div>";
        return rval
    },
    _buildGirlIco: function _buildGirlIco(_ref5) {
        var ico = _ref5.ico,
            rarity = _ref5.rarity;
        return '<div class="girl_ico" rarity="' + rarity + '"><img src="' + ico.toImageUrl("ico") + '"/></div>'
    },
    _buildSmallShardsSlot: function _buildSmallShardsSlot(_ref6) {
        var rarity = _ref6.rarity,
            ico = _ref6.ico,
            shards = _ref6.shards;
        return '<div class="girl_ico slot slot_avatar" rarity="' + rarity + '">\n\t\t\t\t\t<img src="' + ico.toImageUrl("ico") + '"/>\n\t\t\t\t\t' + this._buildShardsLine("x", shards, "") + "\n\t\t\t\t</div>"
    },
    buildShardsSlot: function buildShardsSlot(slot, shards) {
        var additionalTooltipOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
        var rarity = slot.rarity,
            ico = slot.ico,
            value = slot.value,
            name = slot.name,
            girl_class = slot.girl_class,
            caracs = slot.caracs,
            salary_per_hour = slot.salary_per_hour,
            position_img = slot.position_img,
            Graded2 = slot.Graded2,
            level = slot.level,
            chance = slot.chance,
            shard_range = slot.shard_range;
        var tooltip_attribute = void 0;
        if (position_img && salary_per_hour) {
            var json_data = JSON.stringify({
                Name: name,
                rarity: rarity,
                class: girl_class,
                caracs: caracs,
                position_img: position_img,
                salary_per_hour: salary_per_hour,
                Graded2: Graded2,
                level: level
            }).replace("'", "&apos;");
            tooltip_attribute = "new-girl-tooltip-data='" + json_data + "'"
        } else {
            tooltip_attribute = ""
        }
        if (typeof chance !== "undefined") {
            var shardChanceValues = shard_range.split("-");
            value = null;
            if (shardChanceValues[0] == shardChanceValues[1]) {
                shards = shardChanceValues[0]
            } else {
                shards = shard_range
            }
        }
        var htmlWrapper = '<div class="shards_girl_ico" rarity="' + rarity + '">\n\t\t\t\t\t\t\t\t<img src="' + ico.toImageUrl("ico") + '" draggable="false" ' + tooltip_attribute + ">\n\t\t\t\t\t\t\t\t" + this.buildShardsValue(value, name, shards, false, "x", "", additionalTooltipOptions) + "\n\t\t\t\t\t\t\t</div>";
        if (typeof chance !== "undefined") {
            return '<div class="girl-shards-reward-wrapper">\n\t\t\t\t' + htmlWrapper + '\n\t\t\t\t<div class="girl-shards-reward-chance">' + chance.toFixed(2) + "%</div>\n\t\t\t</div>"
        }
        return htmlWrapper
    },
    _buildDraftGirl: function _buildDraftGirl(_ref7, surplus_item) {
        var id_girl = _ref7.id_girl,
            name = _ref7.name,
            rarity = _ref7.rarity,
            ico = _ref7.ico,
            value = _ref7.value,
            girl_class = _ref7.girl_class,
            caracs = _ref7.caracs,
            side = _ref7.side,
            avatar = _ref7.avatar;
        var caracsHtml = "";
        for (var i in caracs) {
            if (side == "left") caracsHtml += '<div><span carac="' + i + '"></span> ' + caracs[i] + "</div>";
            else caracsHtml += "<div>" + caracs[i] + ' <span carac="' + i + '"></span></div>'
        }
        var girlBox = '<div class="draft-girl ' + side + '">\n\t\t\t\t\t\t\t<img class="' + side + '-girl" girl-draft-identifier="' + id_girl + '" src="' + avatar.toImageUrl("avb") + '" />\n\t\t\t\t\t\t\t<div class="line drafted ' + side + '">\n\t\t\t\t\t\t\t\t<div class="shards_wrapper">\n\t\t\t\t\t\t\t\t\t<div class="shards_name">' + name + ' <span carac="' + girl_class + '"></span></div>\n\t\t\t\t\t\t\t\t\t<div class="shards_girl_ico" rarity="' + rarity + '">\n\t\t\t\t\t\t\t\t\t\t<img src="' + ico.toImageUrl("ico") + '">\n\t\t\t\t\t\t\t\t\t\t' + this.buildShardsValue(value, name, value) + "\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t" + (value > 100 ? surplus_item : "") + '\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="girl-stats ' + side + '">\n\t\t\t\t\t\t\t\t' + caracsHtml + "\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>";
        return girlBox
    },
    buildShardsDisplay: function buildShardsDisplay(value, name, shards) {
        var bar = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
        var smallShards = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;
        var prefixText = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : "";
        var postfixText = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : "/100";
        if (!shards) shards = value;
        var htmlStr = '<div class="shards_bar_wrapper">' + this.buildShardsValue(value, name, shards, smallShards, prefixText, postfixText) + (bar ? this._buildShardsBar(value) : "") + "</div>";
        return htmlStr
    },
    buildShardsValue: function buildShardsValue(value, name, shards) {
        var smallShards = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
        var prefixText = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : "x";
        var postfixText = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : "";
        var additionalTooltipOptions = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : null;
        var shardsSecondClass = smallShards ? " small" : "";
        var tooltipAttributes = this._buildAdditionalSlotInfo(additionalTooltipOptions);
        var shardsTooltipAttribute = value === null ? "" : 'shards="' + value + '"';
        return '<div class="shards' + shardsSecondClass + '" ' + shardsTooltipAttribute + " " + tooltipAttributes + ' name="' + name + '">\n\t\t\t\t\t<span class="shard"></span>\n\t\t\t\t\t' + this._buildShardsLine(prefixText, shards, postfixText) + "\n\t\t\t\t</div>"
    },
    _buildShardsLine: function _buildShardsLine(prefixText, shards, postfixText) {
        return "<p>" + prefixText + "<span>" + shards + postfixText + "</span></p>"
    },
    _buildShardsBar: function _buildShardsBar(percent) {
        return '<div class="shards_bar">\n\t\t\t\t\t<div class="bar basic-progress-bar-fill pink" style="width: ' + percent + '%"></div>\n\t\t\t\t</div>'
    }
};
$(function() {
    RewardsBuilder.init()
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var DragAndDrop = function() {
    function DragAndDrop(page) {
        _classCallCheck(this, DragAndDrop);
        this.page = page
    }
    _createClass(DragAndDrop, [{
        key: "initEventListeners",
        value: function initEventListeners() {
            switch (this.page) {
                case "shop":
                    this.shopCurrentLogic = slots;
                    this.shopSelectors = {
                        openedShopTab: $("#type_item>div.selected").attr("type"),
                        heroInventory: $("#inventory > div > div > div"),
                        equipedArea: $("#equiped"),
                        shopArea: $("#shop")
                    };
                    this.shopSelectors.shopStock = $("#shop div");
                    this.shopSelectors.product = this.shopSelectors.shopStock.find(".slot[id_item]");
                    this.shopAndInventoryListeners();
                    break;
                default:
                    console.log("Not found events for this page!");
                    break
            }
        }
    }, {
        key: "shopAndInventoryListeners",
        value: function shopAndInventoryListeners() {
            this.initAffectionItems();
            this.initShopStockItemsDraggable();
            this.initInventoryItemsDraggable(this.shopSelectors.heroInventory.find(".slot[id_item]"));
            this.initInventoryDroppable();
            this.initBasicDroppable(this.shopSelectors.shopArea, "onShop");
            this.initBasicDroppable(this.shopSelectors.equipedArea, "onEquip");
            this.assistListeners()
        }
    }, {
        key: "assistListeners",
        value: function assistListeners() {
            var _this = this;
            $("#girls_list span[nav]").click(function() {
                _this.initAffectionItems()
            });
            $("#equiped").on("equip-completed", function() {
                var a = $("#inventory > div.armor.selected > div > div > div.slot:first-child");
                _this.initInventoryItemsDraggable(a)
            });
            $("#shops").on("btnItemBought", function(evt, elm) {
                var $elm = $(elm);
                _this.onBoughtItem($elm)
            });
            $("#type_item > div").click(function(event) {
                var $attr = $(event.target).attr("type");
                if ($attr == "armor" || $attr == "booster") return;
                $("#inventory > div.selected > div .slot")[0].click();
                _this.initAffectionItems()
            });
            $('#shop > button[rel="shop_reload"]').on("click", function(evt) {
                var buttonCLicked = evt.target;
                setTimeout(function() {
                    $(buttonCLicked).closest("div#shop").find(".selected > .slot").each(function(index, element) {
                        _this.initShopStockItemsDraggable($(element))
                    })
                }, 500)
            })
        }
    }, {
        key: "initInventoryItemsDraggable",
        value: function initInventoryItemsDraggable($items) {
            var me = this;
            $items.draggable({
                helper: "clone",
                revert: "invalid",
                zIndex: 50,
                cursorAt: {
                    top: 40,
                    left: 40
                },
                containment: "document",
                start: function start(event, ui) {
                    me.standardPropertiesStartStopDrag(this, "start");
                    $(ui.helper[0]).find(".stack_num").hide()
                },
                drag: function drag(event, ui) {
                    me.fixScaleOnDrag(ui)
                },
                stop: function stop(event, ui) {
                    me.standardPropertiesStartStopDrag(this, "stop")
                }
            })
        }
    }, {
        key: "initShopStockItemsDraggable",
        value: function initShopStockItemsDraggable() {
            var select = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.shopSelectors.product;
            var me = this;
            select.draggable({
                helper: "clone",
                revert: "invalid",
                zIndex: 50,
                cursorAt: {
                    top: 40,
                    left: 40
                },
                scope: "buy",
                containment: "document",
                start: function start(event, ui) {
                    me.standardPropertiesStartStopDrag(this, "start")
                },
                drag: function drag(event, ui) {
                    me.fixScaleOnDrag(ui)
                },
                stop: function stop(event, ui) {
                    me.standardPropertiesStartStopDrag(this, "stop")
                }
            })
        }
    }, {
        key: "standardPropertiesStartStopDrag",
        value: function standardPropertiesStartStopDrag(instance, state) {
            switch (state) {
                case "start":
                    $(instance).addClass("selected");
                    $(instance).css({
                        opacity: "0.50"
                    });
                    this.shopCurrentLogic.select($(instance));
                    break;
                case "stop":
                    $(instance).removeClass("selected");
                    $(instance).css({
                        opacity: "1"
                    });
                    this.shopCurrentLogic.select($(instance));
                    break
            }
        }
    }, {
        key: "onBoughtItem",
        value: function onBoughtItem($itemSlot) {
            this.initInventoryItemsDraggable($itemSlot)
        }
    }, {
        key: "initBasicDroppable",
        value: function initBasicDroppable(selector, area) {
            var me = this;
            var acceptFrom = "#inventory > div > div > div > div";
            selector.droppable({
                accept: acceptFrom,
                activate: function activate(event, ui) {
                    $(this).css({
                        border: "2px solid red"
                    })
                },
                drop: function drop(event, ui) {
                    if (area == "onShop") me.shopCurrentLogic.sell();
                    else if (area == "onEquip" || area == "onGirls" && !$("#inventory > button.blue_text_button").is("[disabled]")) me.shopCurrentLogic.use()
                },
                deactivate: function deactivate(event, ui) {
                    $(this).css({
                        border: "none"
                    })
                }
            })
        }
    }, {
        key: "initInventoryDroppable",
        value: function initInventoryDroppable() {
            var me = this;
            this.shopSelectors.heroInventory.droppable({
                accept: "#shop > div > div",
                scope: "buy",
                activate: function activate(event, ui) {
                    $(this).prepend('<div class="slot empty" temp-slot></div>')
                },
                drop: function drop(event, ui) {
                    var $attr = $("#type_item > div.selected").attr("type");
                    var $field = $('#shops button[rel="buy"]').find('[cur="hard_currency"]');
                    if ($field.length) {
                        hc_confirm($field.text(), function() {
                            me.shopCurrentLogic.buy(function(item) {
                                me.onBoughtItem(item);
                                if ($attr == "potion" || $attr == "gift") {
                                    me.shopCurrentLogic.select(item);
                                    me.initAffectionItems()
                                }
                            })
                        })
                    } else {
                        me.shopCurrentLogic.buy(function(item) {
                            me.onBoughtItem(item);
                            if ($attr == "potion" || $attr == "gift") {
                                me.shopCurrentLogic.select(item);
                                me.initAffectionItems()
                            }
                        })
                    }
                },
                deactivate: function deactivate(event, ui) {
                    $(this).find("div[temp-slot]").remove()
                }
            })
        }
    }, {
        key: "initAffectionItems",
        value: function initAffectionItems() {
            var oldDroppable = $("#girls_list > div.g1 div.girl-ico.ui-droppable");
            if (oldDroppable.length) oldDroppable.droppable("destroy");
            var setDroppableSelectedGirl = $("#girls_list > div.g1 div.girl-ico:not(.not-selected)");
            if (!$("#inventory > button.blue_text_button").is("[disabled]") && ($('#type_item > div[type="potion"].selected').length || $('#type_item > div[type="gift"].selected').length)) this.initBasicDroppable(setDroppableSelectedGirl, "onGirls")
        }
    }, {
        key: "fixScaleOnDrag",
        value: function fixScaleOnDrag(ui) {
            ui.position.top = ui.position.top / FullSize.scale;
            ui.position.left = ui.position.left / FullSize.scale
        }
    }]);
    return DragAndDrop
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var BattleBuilder = function() {
    function BattleBuilder(data) {
        _classCallCheck(this, BattleBuilder);
        this.prepareData(data);
        this.prepareBattleScreen()
    }
    _createClass(BattleBuilder, [{
        key: "prepareData",
        value: function prepareData(data) {
            this.battleData = data;
            this.attackerData = this.battleData.attacker;
            this.defenderData = this.battleData.defender;
            this.log = $.extend([], this.battleData.battle);
            this.dataRound1 = this.log.shift();
            this.saveRoundIndex = 0;
            this.finalData = this.battleData.final;
            this.champion = championData.champion;
            this.isSinglePlayerChampion = typeof this.champion.stage !== "undefined";
            this.isSceneUnlocked = this.battleData.end.endSceneImage && this.battleData.end.endSceneText;
            this.skill = {
                charm: GT.design.charm_skill,
                hardcore: GT.design.hardcore_skill,
                knowhow: GT.design.knowhow_skill
            };
            this.rewardPopup = true;
            this.skipIntroAnim = false;
            this.playTheBattle = true;
            this.showSkipBtnOnRound = 3;
            this.stopAnims = false
        }
    }, {
        key: "prepareBattleScreen",
        value: function prepareBattleScreen() {
            var _this = this;
            this._clearIntroPage();
            setTimeout(function() {
                _this._showBattlePage()
            }, 1e3)
        }
    }, {
        key: "_prepareArrayFigures",
        value: function _prepareArrayFigures() {
            var figures = $.extend([], this.battleData.positions);
            var pos5 = figures.pop();
            var pos4 = figures.pop();
            figures.unshift(pos5);
            figures.unshift(pos4);
            return figures
        }
    }, {
        key: "_determinateHTMLselector",
        value: function _determinateHTMLselector(attacker) {
            var attackerIsHero = attacker == "hero";
            var selectAttacker = attackerIsHero ? "attacker" : "defender";
            return selectAttacker
        }
    }, {
        key: "_showBattlePage",
        value: function _showBattlePage() {
            var classInstance = this;
            var HTML = this._buildEverything();
            $("#contains_all > section").append(HTML);
            this._animIntroAddToScene(this.skipIntroAnim);
            $("body").on("click", ".section__preview-characters .skip-button", function() {
                $(this).attr("disabled", true);
                classInstance._skipBattleAnimation()
            })
        }
    }, {
        key: "_showRewardScreen",
        value: function _showRewardScreen() {
            if (this.rewardPopup) {
                Reward.handlePopup(this.battleData.end.rewards)
            }
        }
    }, {
        key: "_showEndScreen",
        value: function _showEndScreen() {
            var _this2 = this;
            if (this.isSceneUnlocked) {
                var url = this.battleData.end.endSceneImage;
                var text = this.battleData.end.endSceneText;
                if (url && text) HHPopupManager.show("scene_popup", {
                    url: url,
                    text: text,
                    color: "black"
                }, function() {
                    _this2._showRewardScreen()
                })
            }
        }
    }, {
        key: "_showPopupsAfterFight",
        value: function _showPopupsAfterFight() {
            var _this3 = this;
            setTimeout(function() {
                if (_this3.isSceneUnlocked) {
                    _this3._showEndScreen()
                } else {
                    _this3._showRewardScreen()
                }
            }, 800)
        }
    }, {
        key: "_clearIntroPage",
        value: function _clearIntroPage() {
            $(".champions-animation").removeClass("champions-animation");
            setTimeout(function() {
                $("#contains_all > section").children().remove()
            }, 1e3)
        }
    }, {
        key: "_skipBattleAnimation",
        value: function _skipBattleAnimation() {
            var _this4 = this;
            this.stopAnims = true;
            this.playTheBattle = !this.playTheBattle;
            var speedMs = 1500;
            var counterStep = 1;
            var animSteps = setInterval(function() {
                switch (counterStep) {
                    case 1:
                        _this4._applyFinalEgo(_this4.finalData.attacker_ego, _this4.finalData.defender_impression);
                        counterStep++;
                        break;
                    case 2:
                        $(".section__preview-characters .skip-button").hide();
                        _this4._showPopupsAfterFight();
                        clearInterval(animSteps);
                        break
                }
            }, speedMs)
        }
    }, {
        key: "_applyFinalEgo",
        value: function _applyFinalEgo(player1Ego, player2Ego) {
            var bars = {
                left: {
                    value: player1Ego,
                    htmlTarget: "attacker",
                    $numOnBar: $(".personal-bars__attacker .text-bar-numbers .placeholder-num"),
                    $progressBar: $(".personal-bars__attacker .the-bar .bar")
                },
                right: {
                    value: player2Ego,
                    htmlTarget: "defender",
                    $numOnBar: $(".personal-bars__defender .text-bar-numbers .placeholder-num"),
                    $progressBar: $(".personal-bars__defender .the-bar .bar")
                }
            };
            var barPercent = 0;
            for (var side in bars) {
                bars[side].$numOnBar.attr("number", bars[side].value);
                bars[side].$numOnBar.text("" + number_format_lang(bars[side].value));
                barPercent = bars[side].value / this.battleData["" + bars[side].htmlTarget].ego_orig * 100;
                bars[side].$progressBar.css("width", barPercent + "%")
            }
        }
    }, {
        key: "_buildEverything",
        value: function _buildEverything() {
            var html = '\n\t\t\t\t<div class="section__battle-header">';
            html += this.isSinglePlayerChampion ? this._buildStageInformation(this.champion) : "";
            html += this._buildParticipantsBars();
            html += this._buildRoundsCounterAndPositions();
            html += "</div>";
            html += this._buildPreviewCharactersAndGirls();
            return html
        }
    }, {
        key: "_buildStageInformation",
        value: function _buildStageInformation(data) {
            var progress = data.bar.current / data.bar.max * 20;
            var percentage = data.stage.current / data.stage.max * 100 + progress;
            var html = '\n\t\t<div class="stage-bar-wrapper" hh_title="' + number_format_lang(data.bar.current) + "/" + number_format_lang(data.bar.max) + '">\n\t\t\t<div class="stage-bar-fill" style="width: ' + percentage + '%">\n\t\t\t\t<span class="stage-bar-tier">' + data.tier + "</span>";
            for (var i = 1; i <= data.stage.max; i++) {
                html += '<div class="stage-icon ' + (data.stage.current < i ? "locked" : "unlocked") + '"></div>'
            }
            html += "\n\t\t\t</div>\n\t\t</div>";
            return html
        }
    }, {
        key: "_buildParticipantsBars",
        value: function _buildParticipantsBars() {
            var heroStats = this.dataRound1.attacker.stats_orig;
            var oppoStats = this.dataRound1.defender.stats_orig;
            var html = '\n\t\t<div class="section__personal-bars">\n\t\t\t<div class="personal-bars__attacker">\n\t\t\t\t<span class="icon-bar egoBar_flat_icn"></span>\n\n\t\t\t\t<span class="text-bar-numbers">\n\t\t\t\t\t' + GT.design.team_ego + '\n\t\t\t\t\t<span class="placeholder-num" number="' + this.attackerData.ego + '">' + number_format_lang(this.attackerData.ego) + '</span>\n\t\t\t\t</span>\n\n\t\t\t\t<div class="the-bar wrapper">\n\t\t\t\t\t<div class="bar" style="width: 100%"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="stats-block">\n\t\t\t\t\t<span class="damage" carac="damage" number="' + heroStats.damage + '">\n\t\t\t\t\t\t' + number_format_lang(heroStats.damage) + '\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span class="def" carac="def' + this.defenderData.class + '" number="' + heroStats.defense + '">\n\t\t\t\t\t\t' + number_format_lang(heroStats.defense) + '\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span class="ability" number="' + heroStats.chance + '">\n\t\t\t\t\t\t<span skill="' + heroStats.ability_icon + '"></span>\n\t\t\t\t\t\t' + number_format_lang(this.dataRound1.attacker.stats_orig.chance, 2) + '%\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="personal-bars__defender">\n\t\t\t\t<span class="icon-bar champImpression_flat_icn"></span>\n\n\t\t\t\t<span class="text-bar-numbers">\n\t\t\t\t\t<span class="placeholder-num" number="' + this.defenderData.impression + '">' + number_format_lang(this.defenderData.impression) + "</span>\n\t\t\t\t\t" + GT.design.champions_impression + '\n\t\t\t\t</span>\n\n\t\t\t\t<div class="the-bar wrapper" hh_title="' + number_format_lang(this.champion.bar.current) + "/" + number_format_lang(this.champion.bar.max) + '">\n\t\t\t\t\t<div class="bar red" style="width: ' + this.defenderData.impression / this.defenderData.ego_orig * 100 + '%"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="stats-block">\n\t\t\t\t\t<span class="ability" number="' + oppoStats.chance + '">\n\t\t\t\t\t\t<span skill="' + oppoStats.ability_icon + '"></span>\n\t\t\t\t\t\t' + number_format_lang(oppoStats.chance, 2) + '%\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span class="def" carac="def' + this.attackerData.class + '" number="' + oppoStats.defense + '">\n\t\t\t\t\t\t' + number_format_lang(oppoStats.defense) + '\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span class="damage" carac="damage" number="' + oppoStats.damage + '">\n\t\t\t\t\t\t' + number_format_lang(oppoStats.damage) + "\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>";
            return html
        }
    }, {
        key: "_buildRoundsCounterAndPositions",
        value: function _buildRoundsCounterAndPositions() {
            var preparedPositions = this._prepareArrayFigures();
            var srcPath = "";
            var html = '\n\t\t<div class="section__rounds-info">\n\t\t\t<h1 class="rounds-info__counter">\n\t\t\t\t' + GT.design.champions_round_label + '\n\t\t\t\t<span class="placeholder-num">' + this.dataRound1.round_id + '</span>\n\t\t\t</h1>\n\n\t\t\t<div class="rounds-info__figures">';
            for (var index in preparedPositions) {
                var figureID = preparedPositions[index];
                srcPath = getBattlePositionImagePath(figureID);
                html += '\n\t\t\t\t<img class="figure" id-pose="' + figureID + '" src="' + srcPath + '">\n\t\t\t'
            }
            html += "\n\t\t\t</div>\n\t\t</div>";
            return html
        }
    }, {
        key: "_buildPreviewCharactersAndGirls",
        value: function _buildPreviewCharactersAndGirls() {
            var outfits = this.attackerData.outfit;
            var attackerGirlInfo = this.attackerData.girls[this.dataRound1.player_cur_girl_index];
            var opponentGirlInfo = this.defenderData.girls[this.dataRound1.opponent_cur_girl_index];
            var srcPathAttGirlFig = getBattlePositionImagePath(attackerGirlInfo.position);
            var srcPathDefGirlFig = getBattlePositionImagePath(opponentGirlInfo.position);
            var html = '\n\t\t<div class="section__preview-characters">\n\t\t\t<div class="attacker-preview">\n\t\t\t\t<img class="character head" src="' + outfits.head + '">\n\t\t\t\t<img class="character body" src="' + outfits.body + '">\n\t\t\t\t<img class="character item" src="' + outfits.item + '">\n\t\t\t</div>\n\n\t\t\t<div class="girl attacker-girl">\n\t\t\t\t<img class="girl-ava" src="' + attackerGirlInfo.avatar.toImageUrl("ava") + '">\n\n\t\t\t\t' + this._buildGirlCard(attackerGirlInfo) + '\n\n\t\t\t\t<div class="girl-fav-position">\n\t\t\t\t\t<img class="favorite-position" src="' + srcPathAttGirlFig + '" id-pose="' + attackerGirlInfo.position + '">\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\t\t\t<div class="girl defender-girl">\n\t\t\t\t<img class="girl-ava" src="' + opponentGirlInfo.avatar.toImageUrl("ava") + '">\n\n\t\t\t\t' + this._buildGirlCard(opponentGirlInfo) + '\n\n\t\t\t\t<div class="girl-fav-position">\n\t\t\t\t\t<img class="favorite-position" src="' + srcPathDefGirlFig + '" id-pose="' + opponentGirlInfo.position + '">\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="defender-preview">\n\t\t\t\t<img class="" src="' + this.champion.image + '">\n\t\t\t</div>\n\n\t\t\t<button class="blue_button_L skip-button">\n\t\t\t\t' + GT.design.battle_skip + "\n\t\t\t</button>\n\n\t\t\t" + this._buildGirlQueue() + "\n\t\t</div>";
            return html
        }
    }, {
        key: "_buildGirlQueue",
        value: function _buildGirlQueue() {
            var reverseAttackerGirls = $.extend([], this.attackerData.girls);
            reverseAttackerGirls = reverseAttackerGirls.reverse();
            var girlOnScene = reverseAttackerGirls.pop();
            reverseAttackerGirls.unshift(girlOnScene);
            var html = '\n\t\t<div class="girl-queue">';
            for (var girlIndex = 0; girlIndex < reverseAttackerGirls.length; girlIndex++) {
                html += this._buildGirlCard(reverseAttackerGirls[girlIndex], true)
            }
            html += '\n\t\t\t<span class="next-girl-label">' + GT.design.champions_next_girl_label + "</span>\n\t\t</div>";
            return html
        }
    }, {
        key: "_buildGirlCard",
        value: function _buildGirlCard(girlInfo) {
            var isCaracVisible = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
            var srcPath = getBattlePositionImagePath(girlInfo.position);
            var html = '\n\t\t<div id-girl="' + girlInfo.id_girl + '" rarity="' + girlInfo.rarity + '" class="girl-card">\n\t\t\t<img src="' + girlInfo.ico.toImageUrl("ico") + '">\n\t\t\t' + (isCaracVisible ? '<img class="fav-position" src="' + srcPath + '">' : "") + "\n\t\t</div>";
            return html
        }
    }, {
        key: "_animSamePosition",
        value: function _animSamePosition() {
            var player = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "attacker";
            var $girlFavPosition = $(".section__preview-characters ." + player + "-girl .girl-fav-position");
            var $curFigureHeader = $(".rounds-info__figures .figure").eq(2);
            $curFigureHeader.addClass("same-position-bonus");
            $girlFavPosition.addClass("same-position-bonus");
            setTimeout(function() {
                $curFigureHeader.removeClass("same-position-bonus");
                $girlFavPosition.removeClass("same-position-bonus")
            }, 250)
        }
    }, {
        key: "_animChangeAbilityIcon",
        value: function _animChangeAbilityIcon() {
            var player = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "hero";
            var abilityIcon = arguments[1];
            var selectBar = this._determinateHTMLselector(player);
            var $abilityStat = $(".personal-bars__" + selectBar + " .stats-block span.ability span[skill]");
            $abilityStat.addClass("change-round-number");
            var speedMs = 350;
            var counterStep = 1;
            var animSteps = setInterval(function() {
                switch (counterStep) {
                    case 1:
                        $abilityStat.attr("skill", abilityIcon);
                        counterStep++;
                        break;
                    case 2:
                        $abilityStat.removeClass("change-round-number");
                        clearInterval(animSteps);
                        break
                }
            }, speedMs)
        }
    }, {
        key: "_animChangeStats",
        value: function _animChangeStats() {
            var who = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "hero";
            var stats = arguments[1];
            var htmlTarget = this._determinateHTMLselector(who);
            var $statsBlock = $(".personal-bars__" + htmlTarget + " .stats-block");
            var statsObj = {
                damage: {
                    $el: $statsBlock.find("span.damage"),
                    value: parseInt($statsBlock.find("span.damage").attr("number"), 10)
                },
                defense: {
                    $el: $statsBlock.find("span.def"),
                    value: parseInt($statsBlock.find("span.def").attr("number"), 10)
                }
            };
            anim_number(statsObj.damage.$el, statsObj.damage.value, stats.damage - statsObj.damage.value);
            anim_number(statsObj.defense.$el, statsObj.defense.value, stats.defense - statsObj.defense.value);
            statsObj.damage.$el.attr("number", stats.damage);
            statsObj.defense.$el.attr("number", stats.defense)
        }
    }, {
        key: "_animNextRound",
        value: function _animNextRound() {
            var $headline = $(".section__rounds-info.add-to-scene .rounds-info__counter");
            var $num = parseInt($headline.find(".placeholder-num").text(), 10);
            $num++;
            $headline.addClass("change-round-number");
            setTimeout(function() {
                $headline.find(".placeholder-num").text($num);
                $headline.removeClass("change-round-number")
            }, 500)
        }
    }, {
        key: "_animNextFigure",
        value: function _animNextFigure() {
            var $figuresSection = $(".rounds-info__figures");
            var $firstFigure = $figuresSection.find(".figure").eq(0);
            var $copyFirstFigure = $firstFigure.clone().addClass("hide-figure");
            $firstFigure.remove();
            $figuresSection.append($copyFirstFigure);
            setTimeout(function() {
                $copyFirstFigure.removeClass("hide-figure")
            }, 200)
        }
    }, {
        key: "_animSwitchBattleGirl",
        value: function _animSwitchBattleGirl() {
            var _this5 = this;
            this._animPutGirlCardInDeck();
            var speedMs = 2e3 / 5;
            setTimeout(function() {
                _this5._animApplyNextGirl()
            }, speedMs)
        }
    }, {
        key: "_animPutGirlCardInDeck",
        value: function _animPutGirlCardInDeck() {
            var player = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "attacker";
            var $girlPreviewBlock = $(".section__preview-characters ." + player + "-girl");
            var $girlAvatarCard = $girlPreviewBlock.find(".girl-card");
            $girlPreviewBlock.find(".girl-ava").addClass("small-size");
            $girlPreviewBlock.find(".girl-fav-position").removeClass("show-fav-pos");
            $girlAvatarCard.addClass("show-girl-card");
            var speedMs = 1e3;
            var counterStep = 1;
            var animSteps = setInterval(function() {
                switch (counterStep) {
                    case 1:
                        $girlAvatarCard.addClass("move-to-left");
                        $girlAvatarCard.removeClass("show-girl-card");
                        counterStep++;
                        break;
                    case 2:
                        $girlAvatarCard.remove();
                        clearInterval(animSteps);
                        break
                }
            }, speedMs)
        }
    }, {
        key: "_animApplyNextGirl",
        value: function _animApplyNextGirl() {
            var player = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "attacker";
            var $nextGirlCard = $(".section__preview-characters .girl-queue .girl-card").eq(-1);
            var $copyNextGirlCard = $nextGirlCard.clone();
            var nextGirlID = $nextGirlCard.attr("id-girl");
            var nextGirlData = this.attackerData.girls.find(function(girl) {
                return girl.id_girl == nextGirlID
            });
            var nextGirlCardHTML = this._buildGirlCard(nextGirlData);
            var nextGirlFavPosition = getBattlePositionImagePath(nextGirlData.position);
            var $curGirlBlock = $(".section__preview-characters ." + player + "-girl");
            var $curGirlAvatar = $(".section__preview-characters ." + player + "-girl img.girl-ava");
            var speedMs = 700;
            var counterStep = 1;
            var animSteps = setInterval(function() {
                switch (counterStep) {
                    case 1:
                        $nextGirlCard.addClass("move-to-center");
                        counterStep++;
                        break;
                    case 2:
                        $curGirlAvatar.attr("src", nextGirlData.avatar.toImageUrl("ava"));
                        $nextGirlCard.addClass("girl-card-scale-remove");
                        $curGirlAvatar.removeClass("small-size");
                        counterStep++;
                        break;
                    case 3:
                        $nextGirlCard.remove();
                        $copyNextGirlCard.prependTo(".section__preview-characters .girl-queue");
                        $curGirlBlock.append(nextGirlCardHTML);
                        $curGirlBlock.find("img.favorite-position").attr("src", nextGirlFavPosition);
                        $curGirlBlock.find("img.favorite-position").attr("id-pose", nextGirlData.position);
                        $curGirlBlock.find(".girl-fav-position").addClass("show-fav-pos");
                        clearInterval(animSteps);
                        break
                }
            }, speedMs)
        }
    }, {
        key: "_animSpecialAbility",
        value: function _animSpecialAbility(player1, player2) {
            var _this6 = this;
            var durationForOnceRunning = 2100;
            var opponents = {
                hero: {
                    htmlTarget: "attacker",
                    abilityStats: this._checkForActivatedAbility(player1.ability),
                    statsBase: player1.stats_orig
                },
                opponent: {
                    htmlTarget: "defender",
                    abilityStats: this._checkForActivatedAbility(player2.ability),
                    statsBase: player2.stats_orig
                }
            };
            var prepareAnimDetails = function prepareAnimDetails(pl1, pl2) {
                var time = 0;
                var players = [];
                if (pl1) {
                    time = time + durationForOnceRunning;
                    players.push("hero")
                }
                if (pl2) {
                    time = time + durationForOnceRunning;
                    players.push("opponent")
                }
                return {
                    time: time,
                    players: players
                }
            };
            var animDetails = prepareAnimDetails(opponents.hero.abilityStats.hasAbility, opponents.opponent.abilityStats.hasAbility);
            if (animDetails.players.length) {
                var playerInfo = opponents[animDetails.players[0]];
                var $playerGirl = $(".section__preview-characters .girl." + playerInfo.htmlTarget + "-girl");
                var $playerBar = $(".personal-bars__" + playerInfo.htmlTarget);
                var $abilityIcon = $playerBar.find(".stats-block .ability span[skill]");
                var $secondaryIcon = $(".special-ability-pending");
                var speedMs = Math.round(durationForOnceRunning / 3);
                var counterStep = 1;
                var animSteps = setInterval(function() {
                    switch (counterStep) {
                        case 1:
                            var currentSkillType = playerInfo.abilityStats.ability.type;
                            var currentBattleData = _this6.battleData.battle[_this6.saveRoundIndex].attacker.ability;
                            if (Object.keys(currentBattleData).length > 1) {
                                _this6._applyAbilityOnPlayer({
                                    type: "block",
                                    value: currentBattleData.block
                                }, playerInfo.htmlTarget, $playerBar);
                                currentSkillType = currentBattleData.heal ? "heal" : "burst"
                            } else if (currentBattleData.block && _this6.battleData.battle.length > _this6.saveRoundIndex + 1) {
                                if (!_this6.battleData.battle[_this6.saveRoundIndex + 1].attacker.ability.block || playerInfo.statsBase.ability_icon != "block") {
                                    currentSkillType = null
                                }
                            }
                            if (currentSkillType) {
                                playerInfo.abilityStats.ability.type = currentSkillType;
                                $playerGirl.prepend(_this6._createSpecialAbilityText(playerInfo.abilityStats.ability.type))
                            }
                            counterStep++;
                            break;
                        case 2:
                            $abilityIcon.addClass("blink-me");
                            counterStep++;
                            break;
                        case 3:
                            if ($secondaryIcon.length) {
                                $secondaryIcon.delay(500).animate({
                                    top: "-=100px",
                                    opacity: 0
                                }, 300, function() {
                                    $(this).remove()
                                })
                            }
                            var pendingSkillType = playerInfo.abilityStats.ability.type;
                            if (pendingSkillType == "block") {
                                if (_this6.battleData.battle.length > _this6.saveRoundIndex + 1) {
                                    if (_this6.battleData.battle[_this6.saveRoundIndex + 1].attacker.ability.block && playerInfo.statsBase.ability_icon == "block") {
                                        var newSecondaryIcon = _this6._createSpecialAbilityText(playerInfo.abilityStats.ability.type, true);
                                        var offsetLeft = window.innerWidth > 1026 ? 185 : 187;
                                        var offsetTop = window.innerWidth > 1026 ? 57 : 85;
                                        if (playerInfo.htmlTarget == "defender") {
                                            offsetLeft = window.innerWidth > 1026 ? 645 : 660
                                        }
                                        $(newSecondaryIcon).css({
                                            top: offsetTop + 100 + "px",
                                            left: offsetLeft + "px",
                                            opacity: 0
                                        });
                                        $("#contains_all").append(newSecondaryIcon);
                                        $(newSecondaryIcon).delay(500).animate({
                                            top: offsetTop + "px",
                                            opacity: 1
                                        }, 300)
                                    }
                                }
                            }
                            _this6._applyAbilityOnPlayer(playerInfo.abilityStats.ability, playerInfo.htmlTarget, $playerBar);
                            $abilityIcon.removeClass("blink-me");
                            $playerGirl.find("p.special-ability[temp-text]").remove();
                            clearInterval(animSteps);
                            break
                    }
                }, speedMs)
            }
            return animDetails.time
        }
    }, {
        key: "_createSpecialAbilityText",
        value: function _createSpecialAbilityText(abilityType, secondary) {
            var class_str = "special-ability animation-text";
            if (secondary) {
                class_str = "special-ability-pending"
            }
            var html_element = $('<p class="' + class_str + '" skill="' + abilityType + '" temp-text>\n\t\t\t\t<span skill="' + abilityType + '"></span>\n\t\t\t\t' + this._textForAbility(abilityType) + "\n\t\t\t</p>");
            return html_element[0]
        }
    }, {
        key: "_checkForActivatedAbility",
        value: function _checkForActivatedAbility(plAbilityObj) {
            var abilityStatus = {
                hasAbility: true,
                ability: {}
            };
            if (typeof plAbilityObj.heal != "undefined") {
                abilityStatus.ability.type = "heal";
                abilityStatus.ability.value = plAbilityObj.heal
            } else if (typeof plAbilityObj.block != "undefined") {
                abilityStatus.ability.type = "block";
                abilityStatus.ability.value = plAbilityObj.block
            } else if (typeof plAbilityObj.burst != "undefined") {
                abilityStatus.ability.type = "burst";
                abilityStatus.ability.value = plAbilityObj.burst
            } else {
                abilityStatus.hasAbility = false
            }
            return abilityStatus
        }
    }, {
        key: "_textForAbility",
        value: function _textForAbility(ability) {
            var abilities = {
                heal: this.skill.knowhow,
                block: this.skill.charm,
                burst: this.skill.hardcore
            };
            return abilities[ability]
        }
    }, {
        key: "_applyAbilityOnPlayer",
        value: function _applyAbilityOnPlayer(ability, htmlTarget, $playerBar) {
            switch (ability.type) {
                case "heal":
                    var $progressBar = $playerBar.find(".the-bar .bar");
                    var $barNumber = $playerBar.find(".text-bar-numbers .placeholder-num");
                    var attrCurNumber = parseInt($barNumber.attr("number"), 10);
                    var symbol = htmlTarget == "attacker" ? "+" : "-";
                    var totalAfterHeal = symbol == "+" ? attrCurNumber + ability.value : attrCurNumber - ability.value;
                    var barPercent = totalAfterHeal / this.battleData["" + htmlTarget].ego_orig * 100;
                    $barNumber.attr("number", totalAfterHeal);
                    $barNumber.text(number_format_lang(totalAfterHeal));
                    $progressBar.css("width", barPercent + "%");
                    $playerBar.prepend('<span class="heal-ability" temp-text>' + symbol + number_format_lang(ability.value) + "</span>");
                    setTimeout(function() {
                        $playerBar.find("span.heal-ability[temp-text]").remove()
                    }, 700);
                    break;
                case "block":
                    this._applyAbilityValueIntoStats(ability, htmlTarget);
                    break;
                case "burst":
                    this._applyAbilityValueIntoStats(ability, htmlTarget);
                    break;
                default:
                    console.log("No such special skill exists!");
                    break
            }
        }
    }, {
        key: "_applyAbilityValueIntoStats",
        value: function _applyAbilityValueIntoStats(ability, htmlTarget) {
            var $statsBlock = $(".personal-bars__" + htmlTarget + " .stats-block");
            var statsObj = {
                block: {
                    $el: $statsBlock.find("span.def"),
                    value: parseInt($statsBlock.find("span.def").attr("number"), 10)
                },
                burst: {
                    $el: $statsBlock.find("span.damage"),
                    value: parseInt($statsBlock.find("span.damage").attr("number"), 10)
                }
            };
            anim_number(statsObj[ability.type].$el, statsObj[ability.type].value, ability.value);
            var total = statsObj[ability.type].value + ability.value;
            statsObj[ability.type].$el.attr("number", total)
        }
    }, {
        key: "_animGirlPerform",
        value: function _animGirlPerform(attacker, damage) {
            var _this7 = this;
            var selectAttacker = this._determinateHTMLselector(attacker);
            var selectOpponent = selectAttacker == "attacker" ? "defender" : "attacker";
            var $attackerGirl = $(".section__preview-characters .girl." + selectAttacker + "-girl");
            this._animAttackerGirlShake(selectAttacker, $attackerGirl, function() {
                _this7._animShowDamageOnOpponent(selectAttacker, selectOpponent, damage)
            })
        }
    }, {
        key: "_animAttackerGirlShake",
        value: function _animAttackerGirlShake(attackerIsHero, $attackerGirl, callback) {
            var shakeGirlAnim = attackerIsHero == "attacker" ? "hero-girl-shake-attack" : "opponent-girl-shake-attack";
            $attackerGirl.addClass("" + shakeGirlAnim);
            setTimeout(function() {
                $attackerGirl.removeClass("" + shakeGirlAnim);
                if (typeof callback == "function") callback()
            }, 500)
        }
    }, {
        key: "_animShowDamageOnOpponent",
        value: function _animShowDamageOnOpponent(attackerIsHero, opponent, damage) {
            var symbol = attackerIsHero == "attacker" ? "+" : "-";
            var damageElementHTML = '\n\t\t\t<span class="damage-on-opponent" type-num="' + symbol + '">' + symbol + number_format_lang(damage) + "<span>\n\t\t";
            var $opponentBlock = $(".section__preview-characters ." + opponent + "-preview");
            $opponentBlock.append(damageElementHTML);
            $opponentBlock.find(".damage-on-opponent").addClass("damage-fadeout-up");
            var $opponentBarBlock = $(".section__personal-bars .personal-bars__" + opponent);
            var $progressBar = $opponentBarBlock.find(".the-bar .bar");
            var $barNumber = $opponentBarBlock.find(".text-bar-numbers .placeholder-num");
            var attrCurNumber = parseInt($barNumber.attr("number"), 10);
            var afterDamageTotal = symbol == "+" ? attrCurNumber + damage : attrCurNumber - damage;
            var barPercent = afterDamageTotal / this.battleData["" + opponent].ego_orig * 100;
            setTimeout(function() {
                $opponentBlock.find(".damage-on-opponent").remove();
                $barNumber.attr("number", afterDamageTotal);
                $barNumber.text(number_format_lang(afterDamageTotal));
                $progressBar.css("width", barPercent + "%")
            }, 900)
        }
    }, {
        key: "_animIntroAddToScene",
        value: function _animIntroAddToScene(skip) {
            var _this8 = this;
            var $opponentsPreviewBlock = $(".attacker-preview, .defender-preview");
            var $bars = $(".section__personal-bars .personal-bars__attacker, .section__personal-bars .personal-bars__defender");
            var $girlsAvatar = $(".section__preview-characters .girl.attacker-girl, .section__preview-characters .girl.defender-girl");
            var $positionsSection = $(".section__rounds-info");
            var $stageTimerAndGirlsQueue = $(".section__battle-header .stage-bar-wrapper, .section__preview-characters .girl-queue");
            if (skip) {
                $opponentsPreviewBlock.addClass("add-to-scene");
                $opponentsPreviewBlock.addClass("move-backwards-opponents");
                $bars.addClass("add-to-scene");
                $girlsAvatar.addClass("add-to-scene");
                $positionsSection.addClass("add-to-scene");
                $girlsAvatar.find(".girl-fav-position").addClass("show-fav-pos");
                $stageTimerAndGirlsQueue.css("opacity", 1);
                this.startBattleAnimation()
            } else {
                var speedMs = 200;
                var counterStep = 1;
                setTimeout(function() {
                    $opponentsPreviewBlock.addClass("add-to-scene");
                    speedMs = 1200;
                    var anim = setInterval(function() {
                        switch (counterStep) {
                            case 1:
                                $opponentsPreviewBlock.addClass("move-backwards-opponents");
                                counterStep++;
                                break;
                            case 2:
                                $bars.addClass("add-to-scene");
                                counterStep++;
                                break;
                            case 3:
                                $girlsAvatar.addClass("add-to-scene");
                                counterStep++;
                                break;
                            case 4:
                                $positionsSection.addClass("add-to-scene");
                                $girlsAvatar.find(".girl-fav-position").addClass("show-fav-pos");
                                counterStep++;
                                break;
                            case 5:
                                $stageTimerAndGirlsQueue.css("opacity", 1);
                                counterStep++;
                                break;
                            case 6:
                                _this8.startBattleAnimation();
                                clearInterval(anim);
                                break
                        }
                    }, speedMs)
                }, speedMs)
            }
        }
    }, {
        key: "checkForSamePosition",
        value: function checkForSamePosition(round, stepIndex) {
            var onStepFigureMatch = {
                0: false,
                1: false
            };
            var posMatchOnStep = typeof round.steps[stepIndex].position_match != "undefined";
            if (posMatchOnStep) onStepFigureMatch[stepIndex] = true;
            return onStepFigureMatch
        }
    }, {
        key: "startBattleAnimation",
        value: function startBattleAnimation() {
            if (this.playTheBattle == true) {
                var round1 = this.dataRound1;
                this.iterateSteps(round1)
            } else {
                this._showPopupsAfterFight()
            }
        }
    }, {
        key: "iterateSteps",
        value: function iterateSteps(round) {
            var _this9 = this;
            var stepIndex = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
            if (this.stopAnims) return;
            if (this.playTheBattle == false) return;
            if (round.steps.length == 1 && stepIndex == 1) {
                this.iterateRounds();
                return
            }
            var positionMatches = this.checkForSamePosition(round, stepIndex);
            var figureMatchThisStep = positionMatches[stepIndex];
            if (round.round_id != 1 || round.round_id == 1 && stepIndex == 1) {
                this.stepLoop(round, stepIndex, figureMatchThisStep)
            } else if (round.round_id == 1 && stepIndex == 0) {
                var abilityAnimDuration = this._animSpecialAbility(round.attacker, round.defender);
                setTimeout(function() {
                    _this9.stepLoop(round, stepIndex, figureMatchThisStep)
                }, abilityAnimDuration)
            }
        }
    }, {
        key: "iterateRounds",
        value: function iterateRounds() {
            var _this10 = this;
            if (this.stopAnims) return;
            if (this.log.length) {
                var round = this.log.shift();
                var abilityAnimDuration = this._animSpecialAbility(round.attacker, round.defender);
                setTimeout(function() {
                    _this10.iterateSteps(round)
                }, abilityAnimDuration)
            } else this._showPopupsAfterFight()
        }
    }, {
        key: "stepLoop",
        value: function stepLoop(round, stepIndex, figureMatchThisStep) {
            var _this11 = this;
            if (this.stopAnims) return;
            var stepData = round.steps[stepIndex];
            var selAttacker = this._determinateHTMLselector(stepData.who.type);
            var _animSamePositionDuration = figureMatchThisStep ? 400 : 0;
            var _animGirlPerformDuration = 1500;
            var stepDuration = _animSamePositionDuration + _animGirlPerformDuration;
            var nextRound = this.getNextRound();
            if (figureMatchThisStep) this._animSamePosition(selAttacker);
            setTimeout(function() {
                _this11._animGirlPerform(stepData.who.type, stepData.damage)
            }, _animSamePositionDuration);
            if (stepIndex == 0) {
                stepIndex++;
                setTimeout(function() {
                    _this11.iterateSteps(round, stepIndex)
                }, stepDuration)
            } else if (stepIndex == 1) {
                if (round.round_id == 1) $(".section__preview-characters .skip-button").show();
                if (nextRound == false) {
                    setTimeout(function() {
                        _this11.stopAnims = true;
                        _this11._applyFinalEgo(_this11.finalData.attacker_ego, _this11.finalData.defender_impression)
                    }, _animGirlPerformDuration);
                    this.iterateRounds();
                    return
                }
                var speedMs = 1500;
                var counterStep = 1;
                var animSteps = setInterval(function() {
                    switch (counterStep) {
                        case 1:
                            _this11._animSwitchBattleGirl();
                            if (nextRound) {
                                _this11._animChangeAbilityIcon("hero", nextRound.attacker.stats_orig.ability_icon);
                                _this11._animChangeStats("hero", nextRound.attacker.stats_orig);
                                _this11._animChangeStats("champion", nextRound.defender.stats_orig)
                            }
                            counterStep++;
                            break;
                        case 2:
                            _this11._animNextRound();
                            _this11._animNextFigure();
                            _this11.saveRoundIndex++;
                            counterStep++;
                            break;
                        case 3:
                            _this11.iterateRounds();
                            clearInterval(animSteps);
                            break
                    }
                }, speedMs)
            }
        }
    }, {
        key: "getNextRound",
        value: function getNextRound() {
            if (this.log.length) return this.log[0];
            else return false
        }
    }]);
    return BattleBuilder
}();

function switchMobieAndDesktopViews() {
    if ($("body").attr("page") == "leaderboard") {
        var isMobileSize = is_mobile_size();
        if (LeaguesMobile.is_mobile_size != isMobileSize) {
            if (LeaguesMobile.is_mobile_size != null) {
                reload()
            }
            LeaguesMobile.is_mobile_size = isMobileSize
        }
    }
    if ($("#popup_bunny").is(":visible")) {
        var _isMobileSize = is_mobile_size();
        if (Tutorial.tuto_is_mobile != _isMobileSize) {
            Tutorial.tuto_is_mobile = _isMobileSize;
            TutorialPopup.createTutorialMessage(true, _isMobileSize);
            TutorialPopup.createPartSiteHider()
        }
    }
    if (PartSiteHider.questTutorialShow != null) {
        (new PartSiteHider).questTutorial(PartSiteHider.questTutorialShow)
    }
}

function applyMobileColorBackground() {
    var pageCurrentlyOpen = $("body").attr("page");
    var $pageBgrContainer = $('body[page="' + pageCurrentlyOpen + '"] #bg_all .fixed_scaled');
    var $pageBgrAll = $pageBgrContainer.find(".mobile-bg-all");
    var allowedOnPages = ["harem", "leaderboard", "sex_friends", "missions"];
    var disallowOnTabs = [
        [],
        [],
        [],
        ["contests", "missions"]
    ];
    var isMobile = is_mobile_size();
    var pageIndex = allowedOnPages.indexOf(pageCurrentlyOpen);
    var isMobilePage = isMobile && pageIndex > -1;
    var hasTabs = typeof act_tab != "undefined";
    if (hasTabs) act_tab.slideTab(act_tab.identifyTab());
    if (isMobilePage) {
        if (hasTabs) {
            for (var page in disallowOnTabs) {
                for (var tab in disallowOnTabs[page]) {
                    if (disallowOnTabs[page][tab] == act_tab.identifyTab()) {
                        if ($pageBgrAll.length) $pageBgrAll.remove();
                        return
                    }
                }
            }
        }
        if (!$pageBgrAll.length) {
            var html = '<div class="container-special-bg mobile-bg-all"></div>';
            $pageBgrContainer.append(html)
        }
    } else if ($pageBgrAll && $pageBgrAll.length) $pageBgrAll.remove()
}
$(function() {
    var resizeTimeout = 100;
    var resizeTimeoutID = void 0;
    var _resizeTrigger = function _resizeTrigger(event) {
        if (resizeTimeoutID) clearTimeout(resizeTimeoutID);
        resizeTimeoutID = setTimeout(_callResizeFunctions, resizeTimeout)
    };
    var _callResizeFunctions = function _callResizeFunctions() {
        switchMobieAndDesktopViews();
        applyMobileColorBackground()
    };
    _callResizeFunctions();
    window.addEventListener("resize", _resizeTrigger);
    window.addEventListener("orientationchange", _resizeTrigger)
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var ImageFadeRotator = function() {
    function ImageFadeRotator(selector) {
        _classCallCheck(this, ImageFadeRotator);
        this.verbose = false;
        this.itemInterval = 5e3;
        this.stopInterval = false;
        if (selector) this.run(selector)
    }
    _createClass(ImageFadeRotator, [{
        key: "run",
        value: function run(parent_selector) {
            var _this = this;
            var $items = $(parent_selector).children("img");
            $items.addClass("background_images");
            var numberOfItems = $items.length;
            if (!numberOfItems) {
                if (this.verbose) console.log("Found no image in your selector", parent_selector);
                return
            } else {
                if (this.verbose) console.log("Starting image rotation.")
            }
            var currentItem = numberOfItems - 1;
            var startTime = void 0;
            var infiniteLoop = function infiniteLoop(timeStamp) {
                if (_this.stopInterval) {
                    _this.stopInterval = false;
                    if (_this.verbose) console.log("Image rotation has been stopped.");
                    return
                }
                if (!$items.length) {
                    if (_this.verbose) console.log("Auto stop, image are gone.");
                    return
                }
                if (!startTime) {
                    startTime = timeStamp;
                    $items.eq(currentItem).css({
                        opacity: 1
                    });
                    if (_this.verbose) console.log("Current timestamp: " + startTime)
                }
                var elapsed = timeStamp - startTime;
                if (elapsed >= _this.itemInterval) {
                    if (_this.verbose) console.log("Starting transition of image " + currentItem);
                    $items.eq(currentItem).one(_this.getTransitionEndEvent(), function() {
                        $(this).css({
                            display: "none"
                        })
                    });
                    $items.eq(currentItem).css("opacity", 0);
                    if (currentItem == numberOfItems - 1) {
                        currentItem = 0
                    } else {
                        currentItem++
                    }
                    $items.eq(currentItem).css({
                        display: "block"
                    });
                    startTime = 0
                }
                requestAnimationFrame(infiniteLoop)
            };
            $items.not(":last").css({
                opacity: 0,
                display: "none"
            });
            $items.eq(currentItem).css({
                opacity: 1,
                display: "block"
            });
            requestAnimationFrame(infiniteLoop)
        }
    }, {
        key: "getTransitionEndEvent",
        value: function getTransitionEndEvent() {
            var transition = void 0;
            var element = document.createElement("fakeelement");
            var transitions = {
                transition: "transitionend",
                OTransition: "oTransitionEnd",
                MozTransition: "transitionend",
                WebkitTransition: "webkitTransitionEnd"
            };
            for (transition in transitions) {
                if (element.style[transition] !== undefined) {
                    return transitions[transition]
                }
            }
            return transitions.transition
        }
    }, {
        key: "stop",
        value: function stop() {
            if (this.verbose) console.log("Stopping rotation.");
            this.stopInterval = true
        }
    }]);
    return ImageFadeRotator
}();
$(function() {
    if ($("#bg_all:not(.map) > div > img").length > 1) {
        var bg = new ImageFadeRotator;
        bg.itemInterval = 7e3;
        bg.run("#bg_all > div")
    }
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var PushNotification = function() {
    function PushNotification() {
        var _this = this;
        _classCallCheck(this, PushNotification);
        if (!ENABLE_PUSH_NOTIFICATIONS) return;
        if (!("serviceWorker" in navigator) || !("PushManager" in window)) {
            console.warn("Push messaging is not supported!");
            return
        }
        this.applicationServerKey = this.urlB64ToUint8Array("BB35dLGN4VDaC7SPXOJv_FuqUehaCaHMq-6mYOqXxcDkH-BzqsHCPSYhYJo56s44a14PHdycgXpEqfAQweq-ogw");
        navigator.serviceWorker.register("sw.js").then(function(swReg) {
            _this.swRegistration = swReg;
            _this.swRegistration.pushManager.getSubscription().then(function(subscription) {
                _this.isSubscribed = !(subscription === null);
                if (!_this.isSubscribed && !localStorageGetItem("push_notification")) _this.callSubscribePopup()
            })
        }).catch(function(error) {
            console.error("Service Worker Error: ", error)
        })
    }
    _createClass(PushNotification, [{
        key: "callSubscribePopup",
        value: function callSubscribePopup() {
            var _this2 = this;
            localStorageSetItem("push_notification", true);
            var options = {
                confirm: {
                    title: GT.design.push_notif_title,
                    body: "\n\t\t\t\t\t" + GT.design.push_notif_text1 + '\n\t\t\t\t\t<br/><br/>\n\t\t\t\t\t<span style="color:#c77e62;">' + GT.design.push_notif_text2 + "</span>",
                    buttons: {
                        yes: "OK",
                        no: GT.design.push_notif_no_thanks
                    }
                },
                no_close: true,
                size: "biggest-confirm-popup",
                textAlign: "left"
            };
            HHPopupManager.show("confirmation_popup", options, function() {
                _this2.callBrowserDialogBox()
            })
        }
    }, {
        key: "urlB64ToUint8Array",
        value: function urlB64ToUint8Array(base64String) {
            var padding = "=".repeat((4 - base64String.length % 4) % 4);
            var base64 = (base64String + padding).replace(/\-/g, "+").replace(/_/g, "/");
            var rawData = window.atob(base64);
            var outputArray = new Uint8Array(rawData.length);
            for (var i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i)
            }
            return outputArray
        }
    }, {
        key: "callBrowserDialogBox",
        value: function callBrowserDialogBox() {
            var _this3 = this;
            if (this.isSubscribed) {
                console.warn("Already subscribed");
                return
            }
            this.swRegistration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: this.applicationServerKey
            }).then(function(subscription) {
                _this3.saveEndpoint(subscription);
                localStorageSetItem("push_notification", true)
            }).catch(function(err) {
                console.log("Failed to subscribe the user: ", err);
                localStorageSetItem("push_notification", false)
            })
        }
    }, {
        key: "saveEndpoint",
        value: function saveEndpoint(subscription) {
            this.isSubscribed = !(subscription === null);
            var options = {
                module: "PushNotification",
                action: "add_endpoint",
                endpoint: JSON.stringify(subscription)
            };
            Phoenix.ajax(options)
        }
    }, {
        key: "showPushSubscription",
        value: function showPushSubscription() {
            var _this4 = this;
            this.swRegistration.pushManager.getSubscription().then(function(subscription) {
                if (_this4.isSubscribed) console.log("Push subscription: ", JSON.stringify(subscription));
                else console.log("No active push subscription.")
            })
        }
    }]);
    return PushNotification
}();
$(function() {
    if (!$("body.page-home").length) return;
    var pushNotification = new PushNotification;
    pushNotification
});
$(function() {
    var $loadedPage = $(".page-champions, .page-club_champion");
    if (!$loadedPage.length) return;
    var championBuilder = new ChampionBuilder(championData);
    var championType = typeof championData.champion.stage !== "undefined" ? "champion" : "club_champion";
    $loadedPage.on("click", ".champions-bottom__draft-team", function() {
        championBuilder.rebuildBody(["middle", "bottom"], true)
    }).on("click", ".champions-bottom__confirm-team", function() {
        $(".girl-box__draggable").removeClass("selected");
        championBuilder.selectedGirls = [];
        championBuilder.rebuildBody(["middle", "bottom"], false)
    });
    disableButtonIfNotEnoughKobans();
    $loadedPage.on("click", ".champions-over__champion-tier-link:not(.grey)", function(event) {
        var url = championData.champion.endSceneImage;
        var text = championData.champion.endSceneText;
        if (url && text) HHPopupManager.show("scene_popup", {
            url: url,
            text: text,
            color: "black"
        })
    });
    $loadedPage.on("click", ".champions-bottom__skip-team-cooldown, .champions-bottom__skip-champion-cooldown", function() {
        var $button = $(this);
        $button.attr("disabled", true);
        var params = {
            class: "ChampionController",
            namespace: "h\\Champions",
            action: $button.attr("action"),
            id_champion: championData.champion.id,
            champion_type: championType
        };
        var championSkipCooldownAJAX = function championSkipCooldownAJAX() {
            hh_ajax(params, function(data) {
                Hero.updates(data.heroChangesUpdate);
                championBuilder.championRest = 0;
                championBuilder.teamRest = 0;
                championBuilder.rebuildBody(["top", "middle", "champion", "bottom"], false)
            })
        };
        if (params.action == "team_reset" && isTeamRestFree) championSkipCooldownAJAX();
        else hc_confirm($button.attr("price"), championSkipCooldownAJAX)
    });
    $loadedPage.on("click", ".champions-bottom__make-draft", function() {
        var price = $(this).attr("price");
        if (price) hc_confirm(price, function() {
            makeDraft()
        });
        else makeDraft();

        function makeDraft() {
            var girlsToKeep = [];
            $(".girl-box__draggable.selected").each(function(index, element) {
                girlsToKeep.push($(element).attr("id_girl"))
            });
            var params = {
                class: "ChampionController",
                namespace: "h\\Champions",
                action: "team_draft",
                girls_to_keep: girlsToKeep,
                id_champion: championData.champion.id,
                champion_type: championType
            };
            hh_ajax(params, function(data) {
                if (data.heroChangesUpdate) Hero.updates(data.heroChangesUpdate);
                for (var key in data) {
                    if (championBuilder[key] != undefined) championBuilder[key] = data[key]
                }
                championBuilder.teamDrafted = true;
                championBuilder.rebuildBody(["middle", "bottom"], true);
                delete championBuilder.teamDrafted
            })
        }
    });
    $loadedPage.on("save_champion_team", function() {
        var teamArray = [];
        $(".girl-box__draggable").each(function(index, element) {
            teamArray.push($(element).attr("id_girl"))
        });
        var params = {
            class: "ChampionController",
            namespace: "h\\Champions",
            action: "team_reorder",
            team_order: teamArray,
            id_champion: championData.champion.id,
            champion_type: championType
        };
        hh_ajax(params)
    });
    $loadedPage.on("click", ".battles-number-change", function() {
        var isIncreasing = $(this).hasClass("increase");
        if (isIncreasing) {
            championBuilder.battlesAmount += 1;
            championBuilder.multipleBattlesHCPrice += championData.champion.battlePriceIncrease
        } else {
            championBuilder.battlesAmount -= 1;
            championBuilder.multipleBattlesHCPrice -= championData.champion.battlePriceIncrease
        }
        var elements = {
            $upArrow: $(".battles-number-change.increase"),
            $downArrow: $(".battles-number-change.decrease"),
            $battleButton: $('[rel="perform"]'),
            $buttonProps: $('[rel="perform"] .price-number, [rel="perform"] [cur="hard_currency"]')
        };
        if (championBuilder.battlesAmount >= 2) {
            elements.$downArrow.css("display", "block");
            if (!isTeamRestFree) {
                elements.$battleButton.removeClass("blue_button_L").addClass("orange_button_L");
                elements.$buttonProps.show()
            }
        } else {
            elements.$downArrow.hide();
            elements.$battleButton.removeClass("orange_button_L").addClass("blue_button_L");
            elements.$buttonProps.hide()
        }
        if (championBuilder.battlesAmount >= championBuilder.maxMultipleBattles || championBuilder.battlesAmount >= championData.champion.currentTickets) elements.$upArrow.hide();
        else elements.$upArrow.css("display", "block");
        $(".battles-number").text(championBuilder.battlesAmount);
        $(".price-number").text(championBuilder.multipleBattlesHCPrice);
        disableButtonIfNotEnoughKobans()
    });
    $loadedPage.on("click", '.champions-bottom__buttons-wrapper [rel="perform"]', function() {
        $(this).attr("disabled", true);
        if (championBuilder.multipleBattlesHCPrice > 0 && !isTeamRestFree) hc_confirm(championBuilder.multipleBattlesHCPrice, function() {
            prepareDataForBattle()
        });
        else prepareDataForBattle()
    });
    $loadedPage.on("click", ".girl-box__draggable", function() {
        championBuilder.selectDraftGirl($(this).attr("id_girl"))
    });

    function prepareDataForBattle() {
        loadingAnimation.start();
        var teamArray = [];
        $(".girl-box__draggable").each(function(index, element) {
            teamArray.push($(element).attr("id_girl"))
        });
        var params = {
            class: "TeamBattle",
            battle_type: championType,
            battles_amount: championBuilder.battlesAmount,
            defender_id: championData.champion.id,
            attacker: {
                team: teamArray
            }
        };
        hh_ajax(params, function(data) {
            loadingAnimation.stop();
            if (championBuilder.battlesAmount == 1) new BattleBuilder(data);
            else Reward.handlePopup(data.end.rewards)
        })
    }
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var ChampionBuilder = function() {
    function ChampionBuilder(championData) {
        _classCallCheck(this, ChampionBuilder);
        this.isSinglePlayerChampion = typeof championData.champion.stage !== "undefined";
        this.additionalClass = "";
        this.sectionToSelector = {
            top: ".champions-top__wrapper",
            middle: ".champions-middle__wrapper",
            champion: ".champions-over__champion-wrapper",
            bottom: ".champions-bottom__wrapper"
        };
        this.selectedGirls = [];
        this.prepareInternalVariables(championData);
        $("section").append(this._buildBody());
        this._loadingAnimation();
        this._initTimers()
    }
    _createClass(ChampionBuilder, [{
        key: "prepareInternalVariables",
        value: function prepareInternalVariables(championData) {
            this.rewards = championRewards;
            this.championID = championData.champion.id;
            this.tier = championData.champion.tier;
            this.championName = championData.champion.name;
            this.championClass = championData.champion.class;
            this.posesArray = championData.champion.poses;
            this.lairName = championData.champion.lairName;
            if (this.isSinglePlayerChampion) {
                this.currentStage = championData.champion.stage.current;
                this.lastStage = championData.champion.stage.last;
                this.maxStage = championData.champion.stage.max
            }
            this.currentImpression = championData.champion.bar.current;
            this.healingImpression = championData.champion.bar.healingImpression;
            this.maxImpression = championData.champion.bar.max;
            this.bubbleText = championData.champion.bubbleText.replace("[Name]", Hero.infos.Name);
            this.championImage = championData.champion.image;
            this.priceEnergy = championData.priceEnergy;
            this.priceDraft = championData.priceDraft || 0;
            this.canDraft = championData.canDraft;
            this.freeDrafts = championData.freeDrafts;
            this.maxSelectableGirls = 5;
            this.teamRest = championData.timers.teamRest;
            this.championRest = championData.timers.championRest;
            this.championHeal = championData.timers.championHeal;
            this.teamArray = championData.team;
            this.currentTickets = championData.champion.currentTickets;
            this.isSceneUnlocked = championData.champion.endSceneImage && championData.champion.endSceneText;
            this.timerMapping = {
                teamRest: "teamRest",
                championRest: "championRest",
                championHeal: "championHeal"
            };
            this.battlesAmount = 1;
            this.multipleBattlesHCPrice = 0;
            this.maxMultipleBattles = championData.champion.maxMultipleBattles
        }
    }, {
        key: "rebuildBody",
        value: function rebuildBody(sections, isDraft) {
            var _this = this;
            this.isDraft = isDraft;
            this.additionalClass = "champions-animation";
            if (sections.indexOf("top") != -1) $(this.sectionToSelector["top"]).replaceWith(this._buildTopBody());
            if (sections.indexOf("middle") != -1) {
                $(this.sectionToSelector["middle"]).replaceWith(this._buildMiddleBody());
                if (!this.isDraft) this.dragAndDrop.initSwap()
            }
            if (sections.indexOf("champion") != -1) $(this.sectionToSelector["champion"]).replaceWith(this._buildChampionBody(true));
            if (sections.indexOf("bottom") != -1) $(this.sectionToSelector["bottom"]).replaceWith(this._buildBottomBody());
            this._setShadowStyles();
            setTimeout(function() {
                for (var i in _this.timersList) {
                    HHTimers.stopTimer(_this.timersList[i])
                }
                _this._initTimers()
            }, 100)
        }
    }, {
        key: "reorderTeam",
        value: function reorderTeam(dropped, dragged) {
            var indexes = [];
            for (var key in this.teamArray) {
                var idGirl = this.teamArray[key].id_girl;
                if (idGirl == dragged || idGirl == dropped) indexes.push(key)
            }
            var firstGirl = this.teamArray[indexes[0]];
            this.teamArray[indexes[0]] = this.teamArray[indexes[1]];
            this.teamArray[indexes[1]] = firstGirl
        }
    }, {
        key: "selectDraftGirl",
        value: function selectDraftGirl(girlID) {
            if (!this.isDraft) return;
            var $girl = $('[id_girl="' + girlID + '"]');
            var $tick = $girl.siblings(".girl-box__index");
            var $tickList = $(".champions-middle__team-draft");
            if ($girl.hasClass("selected")) {
                $girl.removeClass("selected");
                $tick.removeClass("green-tick-icon");
                $tickList.find(".green-tick-icon.empty").first().removeClass("empty");
                this.selectedGirls.splice(this.selectedGirls.indexOf(girlID), 1)
            } else if (this.selectedGirls.length < this.maxSelectableGirls) {
                $girl.addClass("selected");
                $tick.not(".green-tick-icon").addClass("green-tick-icon");
                $tickList.find(".green-tick-icon").not(".empty").last().addClass("empty");
                this.selectedGirls.push(girlID)
            }
        }
    }, {
        key: "_buildBody",
        value: function _buildBody() {
            var body = "";
            body += this._buildTopBody();
            body += this._buildMiddleBody();
            body += this._buildChampionBody();
            body += this._buildBottomBody();
            return body
        }
    }, {
        key: "_buildTopBody",
        value: function _buildTopBody() {
            var body = "";
            var content = this._buildBodyContent("top");
            var returnUrl = this.isSinglePlayerChampion ? "/champions-map.html" : "/clubs.html?club_tab=club_champions";
            body = '<div class="champions-top__wrapper ' + this.additionalClass + '">\n\t\t\t\t\t<div class="champions-top__inner-wrapper">\n\t\t\t\t\t\t<div class="champions-top__title">\n\t\t\t\t\t\t\t' + this.lairName + "  " + (this.isSinglePlayerChampion ? -this.tier : "") + '\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="champions-top__stage">\n\t\t\t\t\t\t\t' + content.stage + '\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a class="close_cross" href="' + returnUrl + '">\n\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>';
            return body
        }
    }, {
        key: "_buildMiddleBody",
        value: function _buildMiddleBody() {
            var body = "";
            var team = this._buildTeam();
            var content = this._buildBodyContent("middle");
            var teamWrapper = this.championRest > 0 ? "" : '<div class="champions-middle__girl-selection ' + this.additionalClass + '">' + team + "</div>";
            body = '<div class="champions-middle__wrapper ' + this.additionalClass + '">\n\t\t\t\t\t<div class="champions-middle__champion-description ' + this.additionalClass + '">\n\t\t\t\t\t\t' + content.description + "\n\t\t\t\t\t</div>\n\t\t\t\t\t" + teamWrapper + "\n\t\t\t\t</div>";
            return body
        }
    }, {
        key: "_buildChampionBody",
        value: function _buildChampionBody(isRebuilt) {
            var body = "";
            var classSpan = '<span class="champion-class" carac="' + this.championClass + '"></span>';
            var poses = this.posesArray.map(function(pose) {
                return '<img class="champion-pose" src="' + getBattlePositionImagePath(pose) + '">'
            }).join("");
            var championInfo = '<div class="champions-over__champion-info">\n\t\t\t\t\t\t\t\t' + classSpan + "\n\t\t\t\t\t\t\t\t" + poses + "\n\t\t\t\t\t\t\t</div>";
            var dialog = this.championRest ? "" : '<div class="champions-over__champion-dialog-box ' + this.additionalClass + '"><p>' + this.bubbleText + "</p></div>";
            var rewards = "";
            if (this.isSinglePlayerChampion) {
                rewards = '<div class="champions-over__champion-rewards-outline">\n\t\t\t\t\t\t\t<div class="rewards-title">' + GT.design.Rewards + '</div>\n\t\t\t\t\t\t\t<div class="slot slot_champion_rewards" champion-rewards-tooltip=\'' + this.rewards + '\'>\n\t\t\t\t\t\t\t\t<div class="stage-title">' + GT.design.champions_stage + '</div>\n\t\t\t\t\t\t\t\t<div class="stage-counter">1-4</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="slot slot_champion_rewards" champion-rewards-tooltip=\'' + this.rewards + '\' show-last>\n\t\t\t\t\t\t\t\t<div class="stage-title">' + GT.design.champions_stage + '</div>\n\t\t\t\t\t\t\t\t<div class="stage-counter">5</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<g class="champions-over__champion-tier-link ' + (this.isSceneUnlocked ? "" : "grey") + '"></g>\n\t\t\t\t\t\t</div>'
            } else {
                rewards = '<div class="champions-over__champion-rewards-outline">\n\t\t\t\t\t\t\t<div class="rewards-title">' + GT.design.performance_rewards + '</div>\n\t\t\t\t\t\t\t<div class="slot slot_soft_currency" cur="$" hh_title="' + GT.design.clubup_soft_currency_gain_bonus + '"></div>\n\t\t\t\t\t\t\t<div class="slot slot_contribution_points" cur="contribution_points" hh_title="' + GT.design.clubs_total_contribution_points + '"></div>\n\t\t\t\t\t\t\t<g class="champions-over__champion-tier-link ' + (this.isSceneUnlocked ? "" : "grey") + '"></g>\n\t\t\t\t\t\t</div>'
            }
            body = '<div class="champions-over__champion-wrapper ' + this.additionalClass + '">\n\t\t\t\t\t' + championInfo + "\n\t\t\t\t\t" + dialog + "\n\t\t\t\t\t" + rewards + '\n\t\t\t\t\t<img class="champions-over__champion-image ' + (isRebuilt ? "nofilter" : "") + '" src="' + this.championImage + '">\n\t\t\t\t</div>';
            return body
        }
    }, {
        key: "_buildBottomBody",
        value: function _buildBottomBody() {
            var body = "";
            var content = this._buildBodyContent("bottom");
            body = '<div class="champions-bottom__wrapper ' + this.additionalClass + '">\n\t\t\t\t\t<div class="champions-bottom__inner-wrapper">\n\t\t\t\t\t\t<div class="champions-bottom__tips">\n\t\t\t\t\t\t\t' + (content.tip ? content.tip : "") + '\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="champoions-bottom__footer">\n\t\t\t\t\t\t\t' + content.footer + "\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>";
            return body
        }
    }, {
        key: "_buildBodyContent",
        value: function _buildBodyContent(section) {
            var content = {};
            switch (section) {
                case "top":
                    var percentage = this.currentImpression / this.maxImpression * 100;
                    var tooltip = this.isSinglePlayerChampion ? JSON.stringify({
                        amount: number_format_lang(this.healingImpression),
                        impression_info: number_format_lang(this.currentImpression) + "/" + number_format_lang(this.maxImpression)
                    }) : JSON.stringify({
                        impression_info: number_format_lang(this.currentImpression) + "/" + number_format_lang(this.maxImpression)
                    });
                    var timer = this.championHeal ? '<span class="stage-progress-reset" timer="' + this.championHeal + '" ' + tooltip + ' property="championHeal" rel="timer"></span>' : "";
                    if (this.isSinglePlayerChampion) {
                        content.stage = this.championRest ? GT.design.champions_stage_completed.replace("[current]", this.lastStage) : GT.design.champions_stage_number.replace("[current]", this.currentStage).replace("[max]", this.maxStage)
                    } else {
                        content.stage = GT.design.tier + " " + this.tier
                    }
                    if (!this.championRest) {
                        content.stage += '<div class="stage-progress-bar-wrapper" champion-healing-tooltip=' + tooltip + '>\n\t\t\t\t\t\t\t\t\t\t<div class="stage-progress-text">' + GT.design.champions_impression + "</div>";
                        if (this.isSinglePlayerChampion) {
                            var percentageAfterHeal = Math.max(0, this.currentImpression - this.healingImpression) / this.maxImpression * 100;
                            content.stage += '<div class="stage-progress-bar-fill basic-progress-bar-fill red" style="width: ' + percentageAfterHeal + '%"></div>'
                        }
                        content.stage += '<div class="stage-progress-bar-fill basic-progress-bar-fill healing-amount champion-healing-tooltip" style="width: ' + percentage + '%"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t' + timer
                    }
                    break;
                case "middle":
                    if (this.isDraft) {
                        var ticks = "";
                        for (var i = this.maxSelectableGirls; i > 0; i--) {
                            var isSelected = i <= this.selectedGirls.length;
                            ticks += '<span class="green-tick-icon ' + (isSelected ? "empty" : "") + '"></span>'
                        }
                        content.description = '<div class="champions-middle__champion-draft">\n\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_draft_text + '\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="champions-middle__team-draft">\n\t\t\t\t\t\t\t\t\t\t\t\t\t' + ticks + "\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>"
                    } else if (this.championRest) {
                        content.description = '<div class="champions-middle__champion-resting-text">\n\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_resting_text + '\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="champions-middle__champion-resting" timer="' + this.championRest + '" property="championRest" rel="timer"></div>'
                    } else {
                        content.description = '<div class="champions-middle__champion-text">\n\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_team_selection.replace("[name]", "<span>" + this.championName + "</span>") + "\n\t\t\t\t\t\t\t\t\t\t\t</div>"
                    }
                    break;
                case "bottom":
                    if (!this.championRest) {
                        if (this.isDraft) content.tip = GT.design.champions_tip_draft;
                        else content.tip = GT.design.champions_tip_drag
                    }
                    if (this.isDraft) {
                        var _tooltip = GT.design.champions_free_drafts.replace("[number]", this.freeDrafts);
                        var draftButton = this.freeDrafts ? '<button type="button" class="blue_button_L champions-bottom__make-draft ' + this.additionalClass + '" hh_title="' + _tooltip + '">\n\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_new_draft + "\n\t\t\t\t\t\t\t\t\t\t</button>" : '<button type="button" class="orange_button_L champions-bottom__make-draft ' + this.additionalClass + '" hh_title="" price="' + this.priceDraft + '">\n\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_new_draft + " " + this.priceDraft + ' <span cur="hard_currency"></span>\n\t\t\t\t\t\t\t\t\t\t</button>';
                        content.footer = '<div class="champions-bottom__draft-box">\n\t\t\t\t\t\t\t\t\t\t\t' + draftButton + '\n\t\t\t\t\t\t\t\t\t\t\t<button type="button" class="blue_button_L champions-bottom__confirm-team">\n\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.confirm + "\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>"
                    } else {
                        content.footer = "";
                        var tickets = '<span cur="ticket">x ' + this.currentTickets + "</span>";
                        if (this.championRest) {
                            content.footer += '<div class="champions-bottom__resting-box">\n\t\t\t\t\t\t\t\t\t\t\t\t<button action="champion_reset" class="orange_button_L champions-bottom__skip-champion-cooldown" price="' + calculateResetPrice(this.championRest, hh_prices.champion_cooldown_reset) + '">\n\t\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_skip_resting + " " + calculateResetPrice(this.championRest, hh_prices.champion_cooldown_reset) + ' <span cur="hard_currency"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="champions-bottom__ticket-amount right">\n\t\t\t\t\t\t\t\t\t\t\t\t' + tickets + "\n\t\t\t\t\t\t\t\t\t\t\t</div>"
                        } else if (this.teamRest) {
                            var _draftButton = this.canDraft ? '<button type="button" class="blue_button_L champions-bottom__draft-team ' + this.additionalClass + '">\n\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_change_draft + "\n\t\t\t\t\t\t\t\t\t\t\t</button>" : "";
                            var teamRestButtonClass = isTeamRestFree ? "blue_button_L" : "orange_button_L";
                            var teamRestText = GT.design.champions_skip_resting;
                            if (!isTeamRestFree) teamRestText += " " + calculateResetPrice(this.teamRest, hh_prices.champion_team_cooldown_reset) + ' <span cur="hard_currency"></span>';
                            content.footer = '\n\t\t\t\t\t\t\t\t\t\t\t<div class="champions-bottom__draft-box">\n\t\t\t\t\t\t\t\t\t\t\t\t' + _draftButton + '\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="champions-bottom__rest">\n\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_resting_girls + ' <span timer="' + this.teamRest + '" property="teamRest" rel="timer"></span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<button action="team_reset" class="' + teamRestButtonClass + ' champions-bottom__skip-team-cooldown" price="' + calculateResetPrice(this.teamRest, hh_prices.champion_team_cooldown_reset) + '">\n\t\t\t\t\t\t\t\t\t\t\t\t' + teamRestText + "\n\t\t\t\t\t\t\t\t\t\t\t</button>"
                        } else {
                            var isUpArrowVisible = this.currentTickets > 1 && this.currentTickets > this.battlesAmount && this.battlesAmount < this.maxMultipleBattles;
                            var isDownArrowVisible = this.currentTickets > 1 && this.battlesAmount > 1;
                            var isBattleFree = isTeamRestFree || this.battlesAmount == 1;
                            var displayValue = isBattleFree ? "none" : "inline-block";
                            var _draftButton2 = this.canDraft ? '<button type="button" class="blue_button_L champions-bottom__draft-team ' + this.additionalClass + '">\n\t\t\t\t\t\t\t\t\t\t\t\t' + GT.design.champions_change_draft + "\n\t\t\t\t\t\t\t\t\t\t\t</button>" : "";
                            content.footer += '<div class="champions-bottom__draft-box">\n\t\t\t\t\t\t\t\t\t\t\t\t' + _draftButton2 + '\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="champions-bottom__ticket-shop">\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="/champions-help.html"><img src="' + IMAGES_URL + '/pictures/design/champion_ticket_buy.png"/></a>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="champions-bottom__amount-slider">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="battles-number-change increase upArrow_mix_icn" style="display: ' + (isUpArrowVisible ? "block" : "none") + '"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="input-field">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="battles-number">' + this.battlesAmount + "</span><span> / " + this.currentTickets + '</span> <span cur="ticket"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="battles-number-change decrease downArrow_mix_icn" style="display: ' + (isDownArrowVisible ? "block" : "none") + '"></i>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="champions-bottom__buttons-wrapper">\n\t\t\t\t\t\t\t\t\t\t\t\t<button rel="perform" currency-type="hard_currency" class="' + (isBattleFree ? "blue_button_L" : "orange_button_L") + ' champions-bottom__start-battle" ' + (this.currentTickets < 1 ? 'disabled="disabled"' : "") + ">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>" + GT.design.champion_perform_button + ' </span><span class="battles-number">' + this.battlesAmount + '</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div><span class="battles-number">' + this.battlesAmount + '</span><span cur="ticket"></span> <span class="price-number" style="display: ' + displayValue + '">' + this.multipleBattlesHCPrice + '</span><span cur="hard_currency" style="display: ' + displayValue + '"></span></div>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>'
                        }
                    }
                    break;
                default:
                    throw new Error("Unsupported content section: " + section)
            }
            return content
        }
    }, {
        key: "_buildTeam",
        value: function _buildTeam() {
            var team = "";
            for (var index in this.teamArray) {
                var girl = this.teamArray[index];
                var tooltip = girl.damage >= 1e4 ? 'hh_title="' + number_format_lang(girl.damage) + '"' : "";
                var isSelected = this.selectedGirls.indexOf(girl.id_girl) != -1;
                var shouldAnimate = this.isDraft && !isSelected && this.teamDrafted;
                var indexLine = this.isDraft ? '<span class="girl-box__index ' + (isSelected ? "green-tick-icon" : "") + '"></span>' : '<span class="girl-box__index">' + (parseInt(index, 10) + 1) + "</span>";
                team += '<div class="girl-selection__girl-box ' + (shouldAnimate ? "animated" : "") + '">\n\t\t\t\t\t\t' + indexLine + '\n\t\t\t\t\t\t<div class="girl-box__draggable ' + (isSelected ? "selected" : "") + '" id_girl="' + girl.id_girl + '">\n\t\t\t\t\t\t\t<img class="girl-box__ico girl_ico" rarity="' + girl.rarity + '" src="' + girl.ico.toImageUrl("ico") + '">\n\t\t\t\t\t\t\t<span carac="' + girl.class + '"></span>\n\t\t\t\t\t\t\t<div carac="damage" ' + tooltip + '">' + number_reduce(girl.damage) + '</div>\n\t\t\t\t\t\t\t<img class="girl-box__pose" src="' + getBattlePositionImagePath(girl.figure) + '">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>'
            }
            return team
        }
    }, {
        key: "_initTimers",
        value: function _initTimers() {
            var _this2 = this;
            var $timers = $('[rel="timer"]');
            if (!$timers.length) return;
            this.timersList = [];
            $timers.each(function(index, element) {
                var $timer = $(element);
                var timeLeft = Math.round(parseInt($timer.attr("timer"), 10) - server_now_ts);
                if (timeLeft > 0) {
                    var id = HHTimers.initSimpleTimerTxt($timer, timeLeft, function() {
                        $timer.attr("timer", server_now_ts);
                        var isHealing = $timer.attr("property") == "championHeal";
                        if (isHealing) {
                            _this2.currentImpression = Math.max(0, _this2.currentImpression - _this2.healingImpression);
                            _this2[_this2.timerMapping[$timer.attr("property")]] += 24 * 60 * 60;
                            _this2.rebuildBody(["top"])
                        } else {
                            _this2[_this2.timerMapping[$timer.attr("property")]] = 0;
                            _this2.rebuildBody(["top", "middle", "bottom"])
                        }
                    });
                    _this2.timersList.push(id)
                }
            })
        }
    }, {
        key: "_setShadowStyles",
        value: function _setShadowStyles() {
            var width = Math.round(window.innerWidth / FullSize.scale);
            var left = Math.round((HHCanvasWidth - width) / 2);
            var $shaders = $(".champions-top__wrapper, .champions-bottom__wrapper");
            $shaders.addClass("champions-animation").css({
                width: width + "px",
                left: left + "px"
            })
        }
    }, {
        key: "_loadingAnimation",
        value: function _loadingAnimation() {
            this._setShadowStyles();
            var $championWrapper = $(".champions-over__champion-wrapper");
            $(".champions-middle__champion-description, .champions-middle__girl-selection, .champions-bottom__draft-team").addClass("champions-animation");
            setTimeout(function() {
                $championWrapper.addClass("champions-animation")
            }, 100);
            setTimeout(function() {
                $championWrapper.find("img").addClass("nofilter");
                $championWrapper.find("div").addClass("champions-animation")
            }, 1e3);
            this.dragAndDrop = new ChampionSwap(this)
        }
    }]);
    return ChampionBuilder
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var ChampionSwap = function() {
    function ChampionSwap(championBuilder) {
        _classCallCheck(this, ChampionSwap);
        this.championBuilder = championBuilder;
        this.initSwap()
    }
    _createClass(ChampionSwap, [{
        key: "_fixScaleOnDrag",
        value: function _fixScaleOnDrag(ui) {
            ui.position.top = ui.position.top / FullSize.scale;
            ui.position.left = ui.position.left / FullSize.scale
        }
    }, {
        key: "initSwap",
        value: function initSwap() {
            this.$swappableGirls = $(".girl-box__draggable");
            this._initShopRedirect();
            this._initDroppable();
            this._initDraggable()
        }
    }, {
        key: "_initShopRedirect",
        value: function _initShopRedirect() {
            this.$swappableGirls.click(function() {
                var id = $(this).attr("id_girl");
                if (id) window.location.href = "/shop.html?type=potion&girl=" + id
            })
        }
    }, {
        key: "_initDraggable",
        value: function _initDraggable() {
            var me = this;
            this.$swappableGirls.draggable({
                helper: "clone",
                revert: "invalid",
                zIndex: 50,
                containment: "document",
                start: function start(event, ui) {
                    $(this).hide()
                },
                drag: function drag(event, ui) {
                    me._fixScaleOnDrag(ui)
                },
                stop: function stop(event, ui) {
                    $(this).show()
                }
            })
        }
    }, {
        key: "_initDroppable",
        value: function _initDroppable() {
            var me = this;
            me.potentialGirlsList = [];
            this.$swappableGirls.droppable({
                over: function over(event, ui) {
                    $(this).addClass("potential")
                },
                out: function out(event, ui) {
                    $(this).removeClass("potential")
                },
                drop: function drop(event, ui) {
                    if (!$(this).hasClass("potential")) return;
                    var $dropped = $(this).removeClass("potential");
                    var $dragged = ui.draggable.hide();
                    me.championBuilder.reorderTeam($dropped.attr("id_girl"), $dragged.attr("id_girl"));
                    $dropped.after($dragged.clone().show().removeClass("moving"));
                    $dragged.after($dropped.clone().removeClass("moving").fadeIn("slow"));
                    $dragged.remove();
                    $dropped.remove();
                    me.initSwap();
                    setTimeout(function() {
                        $(".page-champions, .page-club_champion").trigger("save_champion_team")
                    }, 100)
                }
            })
        }
    }]);
    return ChampionSwap
}();

function displayNotifications() {
    function sortNotifsByPriority(a, b) {
        var notifPriority = {
            new: 1,
            reward: 2,
            action: 3,
            upgrade: 4
        };
        var aPrio = notifPriority[a];
        var bPrio = notifPriority[b];
        return aPrio - bPrio
    }
    for (var key in notificationData) {
        var itemData = notificationData[key];
        if (itemData.length == 0) continue;
        if (key == "season") {
            if (check_if_rewards_to_claim()) {} else {
                continue
            }
        }
        itemData.sort(sortNotifsByPriority);
        var notifClass = itemData[0];
        var $element = $("[rel=" + key + "] .position span");
        if (!$element.length) {
            $element = $("[rel=" + key + "]")
        }
        $element.find(".button-notification-icon").remove();
        var iconHtml = notifClass == "new" ? '<img class="new_notif button-notification-new" src="' + IMAGES_URL + '/ic_new.png">' : '<span class="button-notification-icon button-notification-' + notifClass + '"></span>';
        $element.append(iconHtml)
    }
}

function runActivitiesTimer($selector, duration, remaining_time, callback_duration, callback_remaining_time) {
    $selector.show();
    var mission_timer = HHTimers.initBarTimer(duration, remaining_time, $selector, null, null, {
        threshold: "second"
    });
    mission_timer.onComplete = function(timer) {
        notificationData.activities.push("reward");
        displayNotifications();
        if (callback_duration) {
            runActivitiesTimer($selector, callback_duration, callback_remaining_time);
            setTimeout(function() {
                return $selector.show()
            }, 1)
        }
    }
}

function setSeasonsTierProgressBar() {
    if (!season_season_id) {
        return
    }
    if (season_reset && season_reset.current_season && season_reset.current_season.name) {
        SeasonsFunc.show_season_end_popup()
    }
    var mojo_data = find_mojo_progress(season_tier, season_mojo_s, season_tiers);
    $("#mojo_data_home").text(mojo_data.text);
    var seasonsTierBar = $(".tier_bar");
    seasonsTierBar.css("width", mojo_data.progress + "%")
}
$(function() {
    if (!$("body.page-home").length) return;
    setTimeout(displayPendingRewards, 5e3);
    var is_iphone = window.navigator.userAgent.search("iPhone");
    if (is_integrated && !is_iphone) {
        document.cookie = "cookietest=1; SameSite=None; Secure";
        var is_cookie_created = document.cookie.indexOf("cookietest=") != -1;
        document.cookie = "cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT";
        if (!is_cookie_created) {
            popup_message(GT.design.cookies_issue)
        }
    }
    var eventWidgetClass = new EventWidget;
    for (var girlId in girlsDataList) {
        ownedGirls[girlId] = new Girl(girlsDataList[girlId]);
        ownedGirls[girlId]["gId"] = parseInt(girlId, 10)
    }
    GirlSalaryManager.init(ownedGirls, true);
    $(".social").children("div.follow_us, span").click(function() {
        $(this).parent().children("span, a").toggle();
        if (is_mobile_size()) {
            if ($(".social>span").css("display") == "none") $(".redirect.gayharem").css({
                left: "230px"
            });
            else $(".redirect.gayharem").css({
                left: "140px"
            })
        }
    });
    $(".redirect.gayharem.fromHH").click(function() {
        hh_ajax({
            class: "Crosspromo",
            action: "log_player_redirect",
            game: 5,
            url: $(this).attr("href")
        })
    });
    for (var offKey in offers) {
        var offItem = offers[offKey];
        if (offItem.popup) {
            if (offItem.isBundle) {
                openBundles(offKey, 1500)
            } else {
                HHPopupManager.show(offKey, {
                    offer: true,
                    is_mutable: true
                })
            }
        }
        var offRemainingTime = offItem.endDisplay - Date.now() / 1e3;
        if (offRemainingTime > 0) {
            HHTimers.initDecTimer($(".canvas ." + offKey + ' [rel="offer_timer"]'), offRemainingTime, reload)
        }
    }
    $(".offer").click(function() {
        var $element = $(this);
        if (!$element.hasClass("clicked")) {
            var _offKey = $element.attr("class").replace(" offer", "");
            HHPopupManager.show(_offKey, {
                offer: true
            });
            $element.addClass("clicked")
        }
    });
    $(".bundle").click(function() {
        var $element = $(this);
        if (!$element.hasClass("clicked")) {
            var _offKey2 = $element.attr("class").replace(" bundle", "");
            openBundles(_offKey2)
        }
    });

    function openBundles(offKey) {
        var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;
        HHPopupManager.show("no_HC", {
            init_load: true,
            prevent_events: true,
            desired_tab: "bundles"
        });
        setTimeout(function() {
            var $selector = $(".bundles .choose_product .scrolling_area");
            var $offer = $selector.find("#" + offKey);
            if ($offer.length) {
                var scrollTop = $offer[0].offsetTop - parseInt($offer.css("margin-top"));
                $selector.animate({
                    scrollTop: scrollTop
                }, "slow")
            }
        }, timeout);
        animatedBundleScroll()
    }
    $("#popups").on("closed_popup", function(event, name) {
        $("." + name).removeClass("clicked")
    });
    $(".promo_discount").click(function(event) {
        var type = $(this).attr("type");
        if (type == "fight" || type == "quest") {
            if (Hero.infos["energy_" + type] < Hero.infos["energy_" + type + "_max"]) HHPopupManager.show("no_energy_" + type, {
                energy: type
            })
        } else if (type == "profile") window.location.href = "/hero/profile.html?edit"
    });
    if (is_mobile_size()) {
        $(".finish_in_bar .text").html("<span></span>");
        $(".finish_in_bar .text").css({
            "text-align": "right"
        })
    }
    var $missionsBar1 = $("#home_missions_bar1");
    var $missionsBar2 = $("#home_missions_bar2");
    if (missions_datas.remaining_time) {
        if (missions_datas.pop_remaining_time) {
            if (missions_datas.remaining_time < missions_datas.pop_remaining_time) {
                runActivitiesTimer($missionsBar1, missions_datas.duration, missions_datas.remaining_time, missions_datas.pop_duration, missions_datas.pop_remaining_time)
            } else {
                runActivitiesTimer($missionsBar1, missions_datas.pop_duration, missions_datas.pop_remaining_time, missions_datas.duration, missions_datas.remaining_time)
            }
        } else {
            runActivitiesTimer($missionsBar1, missions_datas.duration, missions_datas.remaining_time)
        }
    } else if (missions_datas.pop_remaining_time && (!missions_datas.next_missions || missions_datas.next_missions > missions_datas.pop_duration)) {
        runActivitiesTimer($missionsBar1, missions_datas.pop_duration, missions_datas.pop_remaining_time)
    } else if (missions_datas.next_missions) {
        runActivitiesTimer($missionsBar2, 60 * 60 * 24, missions_datas.next_missions)
    }
    $("#news_button").click(function() {
        showNews()
    });
    if (news_pop_up) {
        showNews(true)
    }

    function showNews(single_news) {
        HHPopupManager.show("popup_news", {
            prevent_events: true,
            single_news: single_news
        })
    }
    $("#blog_button").click(function() {
        HHPopupManager.show("popup_credits")
    });
    if (email_validation == "asking" || email_validation == "rewarded") HHSlidingPopupManager.show("email_validation", {
        no_background: true,
        sliding: true,
        type: email_validation
    });
    var $championTimer = $(".champion-timer");
    if ($championTimer.length) {
        var timeLeft = Math.round(parseInt($championTimer.attr("timer"), 10) - Date.now() / 1e3);
        HHTimers.initDecTimer($championTimer, timeLeft, function() {
            $championTimer.hide();
            if (parseInt($championTimer.attr("has-notif"), 10)) {
                notificationData.champions.push("action");
                displayNotifications()
            }
        })
    }
    displayNotifications();
    setSeasonsTierProgressBar()
});
$(function() {
    if (!$("#worldmap").length) return;

    function updateSittingGirlsAvatars() {
        var $girl = $(".troll_world img.girl-event-img");
        if ($girl.length) {
            var girl_id = extractGirlIdFromUrl($girl.attr("src"));
            if (isGirlInCollection(girl_id, SITTING_GIRLS_AVATARS_IDS)) $girl.css("top", "-95px");
            if (isGirlInCollection(girl_id, OFFSET_GIRLS_AVATARS_IDS)) $girl.css("left", "-90px")
        }
    }
    updateSittingGirlsAvatars();
    if (trollInfo.display_new_level) {
        setTimeout(function() {
            var $lvl = $("h3.troll_world>.level_target_box");
            $lvl.css({
                transform: "scale(1.5)",
                transition: "transform 500ms ease-in"
            });
            setTimeout(function() {
                $lvl.css({
                    transform: "scale(1.7)",
                    transition: "transform 200ms ease-in"
                });
                setTimeout(function() {
                    $lvl.css({
                        transform: "scale(1)",
                        transition: "transform 125ms ease-in"
                    })
                }, 600)
            }, 800)
        }, 300)
    }
    $(".tiers-selection .tier").on("click", function() {
        var $tier = $(this);
        if ($tier.hasClass("locked") || $tier.hasClass("selected")) return;
        $(".tiers-selection .tier.selected").removeClass("selected");
        $tier.addClass("selected");
        var tierNum = $(".tiers-selection .tier.selected").attr("tier");
        var params = {
            class: "Troll",
            action: "set_favorite_tier",
            id_troll: trollInfo.id_troll,
            tier: tierNum
        };
        loadingAnimation.start();
        hh_ajax(params, function(data) {
            loadingAnimation.stop();
            $("h3.troll_world > .level_target_box div[troll_level]").text(data.level);
            $("div.troll_world img.troll-tier-img").attr("src", data.avatar);
            updateSittingGirlsAvatars()
        })
    })
});
$(function() {
    if (!$("body.page-home").length) return;
    $("body").on("click", "#monthly_card_expired>div>button, .canvas>.monthly_card", function() {
        var mc_expired_popup = HHPopupManager.listOpenedPopups["monthly_card_expired"];
        if (mc_expired_popup) {
            mc_expired_popup.close()
        }
        HHPopupManager.show("no_HC", {
            init_load: true,
            prevent_events: true,
            desired_tab: "monthly_card"
        })
    });
    if ("active" in monthly_card_data && !monthly_card_data.active && "notified" in monthly_card_data && !monthly_card_data.notified) {
        var callback = function callback() {
            hh_ajax({
                class: "Hero",
                action: "mute_mc_ended_notif"
            })
        };
        HHPopupManager.show("monthly_card_expired", {
            own_background: true,
            no_background: true,
            show_over: true
        }, callback)
    }
    var timeLeft = calculateTime(monthly_card_data.server_time, monthly_card_data.end_js);
    var $mcDays = $(".monthly_card>.days");
    var $mcToday = $(".monthly_card>.today");
    if (timeLeft.daysLeft) {
        $mcDays.find(".days_left").text(timeLeft.daysLeft);
        $mcDays.find(".hours_left").text(timeLeft.hoursLeft);
        if (timeLeft.daysLeft <= 2) $(".monthly_card .days").addClass("last-three-days");
        $mcDays.show()
    } else $mcToday.show();
    if (mc_extend_days == 3 || mc_extend_days == 30) animateMonthlyCardDays()
});

function animateMonthlyCardDays() {
    var mcAnimDuration = 3e3;
    var animateImage = "animate-mc-image";
    var animateText = "animate-mc-text";
    var $mcIcon = $(".mc-icon");
    var $addNewDays = $(".add-new-days");
    $mcIcon.addClass(animateImage);
    $addNewDays.addClass(animateText);
    $addNewDays.show();
    setTimeout(function() {
        $mcIcon.removeClass(animateImage);
        $addNewDays.removeClass(animateText);
        $addNewDays.hide()
    }, mcAnimDuration)
}

function reactivation_reward_popup(kobans) {
    Hero.update("hard_currency", kobans, true);
    HHPopupManager.show("reactivation_reward", {
        own_background: true,
        no_background: true,
        show_over: true,
        amount: kobans
    })
}
$(function() {
    function hide_elements($parent, selectors_to_hide) {
        selectors_to_hide.forEach(function(v) {
            return $parent.find(v).hide()
        })
    }

    function get_greek_text(idx) {
        var res = "";
        idx = parseInt(idx);
        if (idx === 0) {
            res = "Alpha"
        } else if (idx === 1) {
            res = "Beta"
        } else if (idx === 2) {
            res = "Omega"
        } else {
            throw new Error
        }
        return res
    }
    if (!$("#battle_change_team").length) return;
    var team_orig = $.extend({}, team);
    var $spots = [];
    $("#battle_change_team .battle_team_left .team_girl").each(function() {
        var $girl = $(this);
        var i = parseInt($girl.attr("team"), 10);
        $spots[i] = $girl
    });
    $("#season_choose_opponents_left .hero_team").on("click", ".js_hero_girl", function() {
        var $center_img_container = $("#season_choose_opponents_center");
        var i = parseInt($(this).attr("team"), 10);
        $center_img_container.html(this.innerHTML);
        load_avatar($center_img_container.find(".avatar"));
        hide_elements($center_img_container, [".icon", ".text_girl_level", "img[rarity], .text_girl_alpha"]);
        preselect_girl(i)
    });
    var $girls = [];
    $("#battle_change_team #battle_team_girlslist div[id_girl]").each(function() {
        var $girl = $(this);
        var girl_id = parseInt($girl.attr("id_girl"), 10);
        $girls[girl_id] = $girl
    });

    function load_avatar($img) {
        $img.one("load", function() {
            $(this).show()
        });
        $img.attr("src", $img.attr("avatar"))
    }

    function html_select_girl(i, $girl, swapped, hasAlpha) {
        var $i = $girl.clone();
        var $icon = $girl.find(".icon").attr("carac");
        if ($("#season_choose_opponents_left").length) {
            $i.find(".ico").show();
            $i.find(".avatar").hide()
        } else {
            $i.find(".ico").hide();
            load_avatar($i.find(".avatar"))
        }
        if (!swapped) {
            var ttp = $("#overlay").children().clone();
            $i.append(ttp)
        }
        $spots[i].html($i);
        $spots[i].find(".text_girl_level").show();
        if (hasAlpha) {
            $spots[i].find(".text_girl_alpha").remove();
            $spots[i].append('<div class="text_girl_alpha">' + get_greek_text(i) + "</div>");
            $girl.find(".text_girl_level").hide();
            $girl.find(".text_girl_alpha").remove();
            $girl.append('<div class="text_girl_alpha">' + get_greek_text(i) + "</div>")
        }
        var $position = $girl.find(".alpha_pos").clone();
        if (i == 0) {
            var $pos = $spots[i].siblings(".stats_wrap").find(".position");
            $pos.children().remove();
            $pos.append($position.show())
        }
        $spots[i].find(".girl").siblings(".icon").show().attr("carac", $icon);
        $girl.addClass("using")
    }

    function preselect_girl() {
        var i = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
        var $girl = $("#battle_change_team>.battle_team_left").find('[team="' + i + '"]') || $("#season-arena .hero_team").find('[team="' + i + '"]');
        $girl.addClass("selected");
        $girl.siblings().removeClass("selected")
    }
    for (var i in team) {
        if (!team[i]) continue;
        var $i = $girls[team[i]];
        html_select_girl(i, $i, null, true);
        if (i === "0") {
            var $center_img_container = $("#season_choose_opponents_center");
            $center_img_container.html($i.clone());
            load_avatar($center_img_container.find(".avatar"));
            $center_img_container.find(".change_team_girls").removeClass("using");
            hide_elements($center_img_container, [".icon", "img[rarity]", ".text_girl_level"])
        }
        $girls[team[i]].find(".text_girl_level").hide()
    }
    $("#battle_change_team").on("click", ".girl", function() {
        if ($(this).closest(".base_block").is(".battle_team_left")) {
            var _i = parseInt($(this).parent().attr("team"), 10);
            preselect_girl(_i)
        } else {
            var idg = parseInt($(this).attr("id_girl"), 10);
            var selected_girl = parseInt($(".team_girl.selected").attr("team"), 10);
            var selected_idg = parseInt($(".team_girl.selected>.girl").attr("id_girl"), 10);
            var _i2 = selected_girl || 0;
            if (idg == team[0] || idg == team[1] || idg == team[2]) {
                var pos = void 0;
                for (var j = 0; j < team.length; j++) {
                    if (team[j] == idg) pos = j
                }
                html_select_girl(pos, $('#battle_team_girlslist>.girl[id_girl="' + selected_idg + '"]'), true);
                team[pos] = selected_idg;
                html_select_girl(_i2, $(this));
                team[_i2] = idg
            } else {
                if (team[_i2]) $girls[team[_i2]].removeClass("using");
                html_select_girl(_i2, $(this));
                team[_i2] = idg
            }
        }
        update_alpha_caracs();
        $("#save_team").prop("disabled", !(team[0] && team[1] && team[2]))
    });
    $("#season_choose_opponents_right").on("click", ".change_team_girls", function() {
        if ($(this).closest(".base_block").is(".battle_team_left") || $(this).parent().hasClass("js_hero_girl")) {
            var _i3 = parseInt($(this).parent().attr("team"), 10);
            preselect_girl(_i3)
        } else {
            var idg = parseInt($(this).attr("id_girl"), 10);
            var selected_girl = parseInt($(".team_girl.selected").attr("team"), 10);
            var selected_idg = parseInt($("#season_choose_opponents_center .change_team_girls").attr("id_girl"), 10);
            var _i4 = selected_girl || 0;
            if (idg == team[0] || idg == team[1] || idg == team[2]) {
                var pos = void 0;
                for (var j = 0; j < team.length; j++) {
                    if (team[j] == idg) pos = j
                }
                html_select_girl(pos, $('#battle_team_girlslist>.change_team_girls[id_girl="' + selected_idg + '"]'), true, true);
                team[pos] = selected_idg;
                html_select_girl(_i4, $(this), null, true);
                team[_i4] = idg
            } else {
                if (team[_i4]) {
                    $girls[team[_i4]].removeClass("using");
                    $girls[team[_i4]].find(".text_girl_level").show();
                    $girls[team[_i4]].find(".text_girl_alpha").remove()
                }
                html_select_girl(_i4, $(this), null, true);
                team[_i4] = idg
            }
            var _$center_img_container = $("#season_choose_opponents_center");
            if (_$center_img_container.length) {
                _$center_img_container.html($(this).clone());
                load_avatar(_$center_img_container.find(".avatar"));
                _$center_img_container.find(".change_team_girls").removeClass("using");
                hide_elements(_$center_img_container, [".icon", "img[rarity]", ".text_girl_level"])
            }
        }
        update_alpha_caracs();
        $("#save_team").prop("disabled", !(team[0] && team[1] && team[2]))
    });
    $("#change_team, .battle_hero .sub_block.battle-faces>.change_team_girls").click(function() {
        preselect_girl($(this).attr("girl_n"));
        $("#arena, #battle").hide();
        $("#battle_change_team").show();
        $("#save_team").prop("disabled", false);
        $(".back").hide();
        $("#battle_team_girlslist").niceScroll();
        if ($("#battle_change_team").length && $("#battle_change_team").css("display") == "none") return;
        create_scroll_checker($("#battle_team_girlslist"))
    });
    $("#season_change_team").on("click", function() {
        preselect_girl($(this).attr("girl_n"));
        $("#arena, #battle, #season-arena").hide();
        $("#season_battle_user_block_kiss_energy, .seasons_tab_mojo").hide();
        $("#battle_change_team").show();
        $("#save_team").prop("disabled", false);
        $(".back").hide();
        $(".validate_team_container").show();
        $(".change_team_container").hide();
        $("#season_choose_opponents_left #info_s").hide();
        $("#battle_team_girlslist").niceScroll();
        if ($("#battle_change_team").length && $("#battle_change_team").css("display") == "none") return;
        create_scroll_checker($("#battle_team_girlslist"))
    });
    $("#save_team").click(function() {
        $(".back").show();
        if (team_orig[0] == team[0] && team_orig[1] == team[1] && team_orig[2] == team[2]) {
            $("#arena, #battle").show();
            $("#battle_change_team").hide();
            return
        }
        $("#save_team").prop("disabled", true);
        var params = {
            class: "Hero",
            action: "change_girl_team",
            girls: team
        };
        hh_ajax(params, function() {
            reload()
        })
    });
    $("#battle_change_team .validate_team_container").on("click", "#save_team", function() {
        $(".back").show();
        if (team_orig[0] == team[0] && team_orig[1] == team[1] && team_orig[2] == team[2]) {
            $("#arena, #battle, #season-arena").show();
            $("#season-arena .validate_team_container").hide();
            $("#season-arena .change_team_container").show();
            $("#battle_change_team").hide();
            $("#season_battle_user_block_kiss_energy, .seasons_tab_mojo").show();
            return
        }
        $("#battle_change_team #save_team").prop("disabled", true);
        var params = {
            class: "Hero",
            action: "change_girl_team",
            girls: team
        };
        hh_ajax(params, function() {
            reload()
        })
    });
    $(".opponents_arena").on("click", "#refresh_villains", function() {
        var $button = $(this).blur();
        var price = $button.attr("price");
        hc_confirm(price, function() {
            $button.prop("disabled", true);
            var params = {
                namespace: "h\\Season",
                class: "Arena",
                action: "arena_reload"
            };
            hh_ajax(params, function(data) {
                Hero.update("hard_currency", data.hard_currency, false);
                $(".opponents_arena").html(data.html);
                selectSeasonArenaOpponent($(".season_arena_opponent_container").first(), $("#player_defence_stat"));
                RewardsBuilder.init()
            })
        })
    });
    $("#fake_back_button").click(function() {
        if ($("#battle").length) {
            $("#arena, #battle").show();
            $(".back").show();
            $("#battle_change_team").hide()
        } else {
            reload()
        }
    });

    function update_alpha_caracs() {
        var i, vals = {};
        if (!team[0]) {
            vals = {
                damage: "",
                def_carac1: "",
                def_carac2: "",
                def_carac3: "",
                ego: "",
                orgasm: ""
            }
        } else {
            var ac = alpha_caracs[team[0]];
            for (i in ac) {
                vals[i] = battle_number(ac[i])
            }
            if (team[1] && team[2]) {
                var bonus = alpha_caracs[team[1]].bonus + alpha_caracs[team[2]].bonus;
                var subcars = ["damage", "def_carac1", "def_carac2", "def_carac3"];
                for (i in subcars) {
                    i = subcars[i];
                    vals[i] += "-" + battle_number(ac[i] + bonus)
                }
            }
        }
        if ($("#season_choose_opponents_left").length) {
            $('#season_choose_opponents_left .hero_stats [carac="damage"] ~ .pull_right').text(vals.damage);
            $('#season_choose_opponents_left .hero_stats [carac="def1"] ~ .pull_right').text(vals.def_carac1);
            $('#season_choose_opponents_left .hero_stats [carac="def2"] ~ .pull_right').text(vals.def_carac2);
            $('#season_choose_opponents_left .hero_stats [carac="def3"] ~ .pull_right').text(vals.def_carac3);
            $('#season_choose_opponents_left .hero_stats [carac="ego"] ~ .pull_right').text(vals.ego)
        }
        $('.change_team_carac_left  [carac="ego"]').text(vals.ego);
        $('.change_team_carac_left  [carac="excit"]').text(vals.orgasm);
        $('.change_team_carac_left [carac="damage"]').text(vals.damage);
        $('.change_team_carac_right [carac="def1"]').text(vals.def_carac1);
        $('.change_team_carac_right [carac="def2"]').text(vals.def_carac2);
        $('.change_team_carac_right [carac="def3"]').text(vals.def_carac3)
    }

    function battle_number(number) {
        return number_format_lang(number)
    }
});
$(function() {
    $(".class_change_btn").click(function() {
        open_class_change()
    });
    if (!$("#battle").length) return;
    $('button[rel="launch"]').removeAttr("disabled");
    disableButtonIfNotEnoughKobans();
    if ($("#battle .season_arena_block").length) {
        if (season_reset && season_reset.current_season && season_reset.current_season.name) {
            localStorageSetItem("season_reset", JSON.stringify(season_reset))
        }
        if (Hero.energies.kiss.amount <= 0) {
            window.location.href = "/season.html"
        }
        startBattle()
    }
    $('#battle button[rel="launch"]').click(startBattle);

    function startBattle(event) {
        var troll = hh_battle_players[1].id_troll;
        var battleType = troll ? "fight" : "challenge";
        var energy = event ? battleType : "kiss";
        var $button = event ? $(this) : null;
        var battlesAmount = void 0;
        $(".js_season_battle_user_general_info").show();
        if (event && is_cheat_click(event)) return false;
        $("#battle .season_arena_block").find(".personal_info, .hero_stats, .change_team_container, .validate_team_container, .hero_team, #info_s").hide();
        $("#battle .season_arena_block").css("background", "none");
        $("#battle .battle_hero .class_change_btn").unbind("click");
        $("#battle .battle_hero .class_change_btn .hh_class_tooltip").addClass("hh_class_tooltip_click_disabled");
        $("#battle .battle_hero .class_change_btn").removeClass("class_change_btn");
        if ($button) {
            var numBattles = parseInt($button.attr("price_fe"));
            battlesAmount = $button.hasClass("autofight") ? numBattles : 0;
            if (troll) {
                if ($(".girls_reward").find(".animate>div").length > 1) {
                    if (window.troll_girls) window.troll_girls.stop()
                }
                if ($(".items_reward").find(".animate>div>div").length > 1) {
                    if (window.troll_rewards) window.troll_rewards.stop()
                }
                var price = $button.attr("price");
                var makeTrollFight = function makeTrollFight() {
                    makeAjax(hh_battle_players[1], energy, battlesAmount, price)
                };
                if (battlesAmount) {
                    if (price > 0 && Hero.energies[energy].amount >= battlesAmount) {
                        hc_confirm(price, makeTrollFight)
                    } else {
                        makeTrollFight()
                    }
                }
            }
        }
        if (!battlesAmount) {
            var startAnimation = makeAjax(hh_battle_players[1], energy, 0);
            if (startAnimation == false) return;
            $("body.page-battle").addClass("battleStarted");
            setTimeout(function() {
                $("#battle").addClass("preBattleAnim");
                $('[anim-step="hideDelay"]').hide()
            }, 800);
            var $opponentGirlImage = $('#girlsBattleground img[girl-owner="opponent"]');
            $opponentGirlImage.each(function() {
                var path = $(this).attr("src");
                $(this).attr("src", path.replace("ico", "ava"))
            });
            if ($button) {
                $button.prop("disabled", true)
            }
            $('#battle button[rel="skip"]').hide()
        }
    }

    function makeAjax(player, energy, battlesAmount, price) {
        var max_battles = battlesAmount == 50 ? 50 : 0;
        if (player.id_member && Hero.energies[energy].amount <= 0) {
            HHPopupManager.show("no_energy_" + energy, {
                energy: energy
            });
            return false
        } else if (player.id_troll && (Hero.energies.fight.amount <= 0 || battlesAmount && Hero.energies.fight.amount < battlesAmount)) {
            HHPopupManager.show("no_energy_fight", {
                energy: "fight",
                max_battles: max_battles
            });
            return false
        } else if (price) {
            Hero.updates({
                hard_currency: -price
            }, true)
        }
        $('[rel="launch"]').prop("disabled", true);
        var params = {
            class: "Battle",
            action: "fight",
            who: player,
            battles_amount: battlesAmount
        };
        if (battlesAmount) {
            loadingAnimation.start()
        }
        hh_ajax(params, function(data) {
            $(".judjePos").show();
            loadingAnimation.stop();
            var battleData = void 0;
            if (!battlesAmount) {
                battleData = data.end.updated_infos;
                Battle.log = data.log;
                Battle.end = data.end;
                Battle.show()
            } else {
                battleData = data.updated_infos;
                var reward = data.rewards;
                reward.redirectUrl = "/world/" + hh_battle_players[1].id_world;
                Reward.handlePopup(reward)
            }
            Hero.updates(battleData, true)
        })
    }
    $('#battle button[rel="skip"]').click(function() {
        $(this).hide();
        Battle.go_to_end()
    });
    var Battle = {
        log: [],
        end: [],
        round_a: 1,
        round_b: 1,
        show_steps: true,
        time_step: 1e3,
        end_of_battle: false,
        rewards_shown: false,
        loser: null,
        turns_taken: 0,
        turn_attacker_hero: false,
        turn_attacker_opponent: false,
        fav_pose_decode: function fav_pose_decode() {
            var Hero_pose = hh_battle_players[0].figure;
            var Opp_pose = hh_battle_players[1].figure;
            $('#battle [pose-owner="hero"]').attr("src", getBattlePositionImagePath(Hero_pose));
            $('#battle [pose-owner="opponent"]').attr("src", getBattlePositionImagePath(Opp_pose))
        },
        current_pose: 0,
        show: function show() {
            $("#change_team").remove();
            $('#battle .battle_balloon [rel="start"]').remove();
            $('#battle .battle_balloon [rel="pos"]').show();
            $("#battle").find('[rel="g2"], [rel="g3"]').css("opacity", "0");
            hh_battle_players[0].$ego = $(".battle_hero .battle-bar-ego").first();
            hh_battle_players[0].$org = $(".battle_hero .battle-bar-orgasm").first();
            hh_battle_players[0].$faces = $(".battle_hero .battle-faces");
            hh_battle_players[0].$girlAlpha = $(".battle_hero #girlsBattleground").first();
            hh_battle_players[0].$figure = $('.battle_hero [rel="fav_fig"]');
            hh_battle_players[0].$poseOwner = $('.battle_hero [pose-owner="hero"]');
            hh_battle_players[1].$ego = $(".battle_opponent .battle-bar-ego");
            hh_battle_players[1].$org = $(".battle_opponent .battle-bar-orgasm");
            hh_battle_players[1].$faces = $(".battle_opponent .battle-faces");
            hh_battle_players[1].$girlAlpha = $(".battle_opponent #girlsBattleground");
            hh_battle_players[1].$figure = $('.battle_opponent [rel="fav_fig"]');
            hh_battle_players[1].$poseOwner = $('.battle_opponent [pose-owner="opponent"]');
            Battle.$current_figure = $('#battle .battle_balloon [rel="pos"]>div, #battle .judjePos [rel="pos"]>span');
            Battle.$current_figure_image = $('#battle .judjePos [rel="pos_image"]>img');
            Battle.$block_image = $("#battle #skills_icons>span.block");
            Battle.$crit_image = $("#battle #skills_icons>span.crit");
            Battle.$heal_image = $("#battle #skills_icons>span.heal");
            hh_battle_players[0].same_fig = false;
            hh_battle_players[1].same_fig = false;
            var judgePoses = Battle.log[0].f;
            var judgeCurrentPose = judgePoses.split(/:/);
            var judgePose = judgeCurrentPose[1];
            Battle.current_pose = judgePose;
            $(Battle.$current_figure_image).attr("src", getBattlePositionImagePath(Battle.current_pose));
            Battle.$current_figure.text(GT_figures[judgePose]);
            setTimeout(function() {
                if (!Battle.show_steps) return;
                Battle.show_step(0, 1);
                $('#battle [delay-opa="0"]').attr("delay-opa", "1");
                setTimeout(function() {
                    $('#battle button[rel="skip"]').fadeIn("300")
                }, 200)
            }, 500)
        },
        show_step: function show_step(a, b) {
            var log = Battle.log.shift();
            var player_a = hh_battle_players[a];
            var player_b = hh_battle_players[b];
            Battle.turns_taken++;
            Battle.now = {
                critical: false,
                block: false,
                heal: false,
                player_a: player_a,
                player_b: player_b
            };
            if (log.f) {
                log.f = log.f.split(/:/);
                Battle.$current_figure.text(GT_figures[log.f[1]]).attr("carac", log.f[0]);
                Battle.current_pose = log.f[1];
                $(Battle.$current_figure_image).attr("src", getBattlePositionImagePath(Battle.current_pose));
                player_a.same_fig = player_a.figure == log.f[1];
                player_b.same_fig = player_b.figure == log.f[1]
            }
            if (log.attacker_ability == "heal") {
                Battle.now.heal = true
            }
            if (log.defender_ability == "block") {
                Battle.now.block = true
            }
            if (log.attacker_ability == "critical" || log.c) {
                Battle.now.critical = true
            }
            player_b.curr_ego -= log.damage;
            if (player_b.curr_ego < 0) player_b.curr_ego = 0;
            if (Battle.now.heal) {
                player_a.curr_ego += log.heal;
                Battle.make_animation(player_a.$ego, player_a.curr_ego, player_a.ego, log.heal, "heal")
            }
            if (Battle.now.block) {
                Battle.make_animation(player_b.$ego, player_b.curr_ego, player_b.ego, log.damage, "block")
            } else if (Battle.now.critical) {
                Battle.make_animation(player_b.$ego, player_b.curr_ego, player_b.ego, log.damage, "crit")
            } else {
                Battle.make_animation(player_b.$ego, player_b.curr_ego, player_b.ego, log.damage)
            }
            Battle.player_thrust(player_a.$girlAlpha);
            Battle.figure_flash(Battle.$current_figure);
            player_a.x += log.x;
            if (log.o) {
                Battle.orgasm_animation(a == 0 ? "player" : "opponent");
                player_a.x = 0;
                player_a.nb_org++;
                if (Battle.round_a == 1 && a == 0 || Battle.round_b == 1 && a == 1) player_a.$girlAlpha.find('[rel="g2"]').css("opacity", "1");
                else if (Battle.round_a == 2 && a == 0 || Battle.round_b == 2 && a == 1) player_a.$girlAlpha.find('[rel="g3"]').css("opacity", "1");
                a == 0 ? Battle.round_a++ : Battle.round_b++
            }
            Battle.update_org(player_a.$org, player_a.x, player_a.orgasm);
            if (Battle.log.length) {
                setTimeout(function() {
                    if (Battle.show_steps) Battle.show_step(b, a)
                }, Battle.time_step)
            }
        },
        update_ego: function update_ego($bar, val, val_max) {
            var pc = Math.min(Math.round(val * 100 / val_max), 100);
            $bar.children(".bar_ego_blue").css("width", pc + "%");
            hh_format_number($bar.find(".over span"), val);
            var $red = $bar.children(".bar_ego_red");
            setTimeout(function() {
                $red.velocity({
                    p: {
                        opacity: 0
                    },
                    o: {
                        duration: 150,
                        complete: function complete() {
                            $red.css("width", pc - 1 + "%").css("opacity", 1)
                        }
                    }
                });
                setTimeout(function() {
                    if (!Battle.log.length && !Battle.rewards_shown) Battle.display_end()
                }, 500)
            }, 450)
        },
        make_animation: function make_animation($bar, val, val_max, amount) {
            var type = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;
            Battle.update_ego($bar, val, val_max);
            var dmg_text = Battle.egodamage_numbers(amount, type);
            var $dmgContainer = $bar.find(".dmg-anim");
            var $block_img = Battle.$block_image.html();
            var $crit_img = Battle.$crit_image.html();
            var $heal_img = Battle.$heal_image.html();
            if (type) {
                var $img;
                if (type == "heal") {
                    $img = $heal_img
                } else if (type == "block") {
                    $img = $block_img
                } else if (type == "crit") {
                    $img = $crit_img
                }
                var $dmgLog = $('<div turn-taken="' + Battle.turns_taken + '" type-dmg="' + type + '"><span class="skill"><span class="tpSpan">' + dmg_text + '</span><span class="bmSpan">' + dmg_text + "</span></span>" + $img + "</div>");
                $dmgLog.appendTo($dmgContainer);
                $('#battle [type-dmg="' + type + '"] img').show();
                $('#battle .dmg-anim [rel="' + type + '"]').velocity({
                    scale: 1.5
                }, 500, "linear");
                $('#battle .dmg-anim [rel="' + type + '"]').velocity({
                    opacity: 0
                }, 300 * 3, "linear")
            } else {
                var $dmgLog = $('<div turn-taken="' + Battle.turns_taken + '"><span class="dmg"><span class="tpSpan">' + dmg_text + '</span><span class="bmSpan">' + dmg_text + "</span></span></div>");
                $dmgLog.appendTo($dmgContainer)
            }
            $dmgLog.velocity({
                top: -40
            }, 600, "linear");
            $dmgLog.velocity({
                top: -55,
                opacity: 0
            }, 500 * 3, "linear");
            $dmgLog.velocity({
                display: "none"
            })
        },
        update_org: function update_org($bar, val, val_max) {
            var pc = Math.round(val * 100 / val_max);
            pc = Math.min(pc, 100);
            $bar.children(".bar").css("width", pc + "%");
            $bar.find(".over span").text(pc)
        },
        go_to_end: function go_to_end() {
            Battle.show_steps = false;
            Battle.show_end_bars()
        },
        display_end: function display_end(closed) {
            Battle.end_of_battle = true;
            var url;
            if (hh_battle_players[1].id_world) url = "/world/" + hh_battle_players[1].id_world;
            else if ("id_season_arena" in hh_battle_players[1]) url = "/season-arena.html";
            else url = "/tower-of-fame.html?tab=leagues";
            var reward = Battle.end.rewards;
            reward.callback = "handleBattleEnd";
            reward.scale = 100;
            reward.redirectUrl = url;
            Reward.handlePopup(reward);
            Battle.rewards_shown = true
        },
        show_end_bars: function show_end_bars() {
            var p1 = hh_battle_players[0];
            var p2 = hh_battle_players[1];
            var shift = Battle.turns_taken % 2;
            for (var i = 0; i < Battle.log.length; i++) {
                var log = Battle.log[i];
                if (log.o) {
                    if (Battle.round_a == 1 && i % 2 == 0 || Battle.round_b == 1 && i % 2 == 1) p1.$girlAlpha.find('[rel="g2"]').css("opacity", "1");
                    else if (Battle.round_a == 2 && i % 2 == 0 || Battle.round_b == 2 && i % 2 == 1) p1.$girlAlpha.find('[rel="g3"]').css("opacity", "1");
                    i % 2 == 0 ? Battle.round_a++ : Battle.round_b++
                }
                if ((shift + i) % 2 == 0) {
                    p2.curr_ego -= log.damage;
                    if (log.heal > 0) p1.curr_ego += log.heal;
                    p1.x += log.x;
                    if (log.o) {
                        p1.nb_org++;
                        p1.x = 0
                    }
                } else {
                    p1.curr_ego -= log.damage;
                    if (log.heal > 0) p2.curr_ego += log.heal;
                    p2.x += log.x;
                    if (log.o) {
                        p2.nb_org++;
                        p2.x = 0
                    }
                }
            }
            Battle.log = 0;
            Battle.update_ego(p1.$ego, Math.max(0, p1.curr_ego), p1.ego);
            Battle.update_ego(p2.$ego, Math.max(0, p2.curr_ego), p2.ego);
            Battle.update_org(p1.$org, p1.x, p1.orgasm);
            Battle.update_org(p2.$org, p2.x, p2.orgasm)
        },
        egodamage_numbers: function egodamage_numbers(amount, type) {
            var dmg = number_format_lang(parseInt(amount, 10));
            var $text = $("#skills_icons");
            if (type) {
                return $text.attr(type) + '<br><span class="number">' + dmg + "</span>"
            } else {
                return dmg
            }
        },
        orgasm_animation: function orgasm_animation(character) {
            var css = {
                "font-size": "75px"
            };
            var css = {
                opacity: 1
            };
            var cssInitial = {
                top: "-20px",
                opacity: 0,
                "font-size": "44px"
            };
            var left = $("#battle").width() / 4;
            var oP;
            if (character == "player") {
                $(".battle_hero .orgasm_anim").show().css(css);
                oP = ".battle_hero"
            } else {
                $(".battle_opponent .orgasm_anim").show().css(css);
                oP = ".battle_opponent"
            }
            $(oP + " .orgasm_anim").velocity({
                top: "-70px",
                "font-size": "65px",
                opacity: .6
            }, "easeOutSine", 600).velocity({
                top: "-80px",
                opacity: 0
            }, "easeOutSine", 400).velocity({
                complete: function complete() {
                    $(oP + " .orgasm_anim").css(cssInitial)
                },
                delay: 800
            })
        },
        player_thrust: function player_thrust($box) {
            var $guy = $box;
            var $girl = $box;
            if ($box.closest(".battle_user_block").is(".battle_opponent")) {
                $girl.velocity({
                    p: {
                        right: "-= 15px"
                    },
                    o: {
                        duration: 100
                    }
                }).velocity({
                    p: {
                        right: "+= 20px"
                    },
                    o: {
                        duration: 50,
                        complete: function complete() {
                            $girl.velocity({
                                p: {
                                    right: "+= 4px"
                                },
                                o: {
                                    duration: 50
                                }
                            }).velocity({
                                p: {
                                    right: "-= 4px"
                                },
                                o: {
                                    duration: 50
                                }
                            })
                        }
                    }
                }).velocity({
                    p: {
                        right: "-= 5px"
                    },
                    o: {
                        duration: 50
                    }
                })
            } else {
                $girl.velocity({
                    p: {
                        left: "-= 15px"
                    },
                    o: {
                        duration: 100
                    }
                }).velocity({
                    p: {
                        left: "+= 20px"
                    },
                    o: {
                        duration: 50,
                        complete: function complete() {
                            $girl.velocity({
                                p: {
                                    left: "+= 4px"
                                },
                                o: {
                                    duration: 50
                                }
                            }).velocity({
                                p: {
                                    left: "-= 4px"
                                },
                                o: {
                                    duration: 50
                                }
                            })
                        }
                    }
                }).velocity({
                    p: {
                        left: "-= 5px"
                    },
                    o: {
                        duration: 50
                    }
                })
            }
        },
        figure_flash: function figure_flash($middle_figure) {
            if (!Battle.now.player_a.same_fig && !Battle.now.player_b.same_fig) {
                return
            }
            var $attacker = Battle.now.player_a.$figure;
            var $attackerTrue = Battle.now.player_a.$figure.length;
            var $defendee = Battle.now.player_b.$figure;
            var puple_glow_selector = ".position_animation>div";
            if (Battle.now.player_a.same_fig) {
                $attacker.addClass("color_flash");
                $middle_figure.addClass("color_flash");
                if (Battle.now.player_a.$poseOwner[0].attributes[2].nodeValue === "hero") {
                    $(".battle_hero " + puple_glow_selector).addClass("purple_glow_flash");
                    $('[rel="pos_image"] ' + puple_glow_selector).addClass("purple_glow_flash")
                }
            }
            if (Battle.now.critical) {
                if (Battle.now.player_a.same_fig) $(".battle_hero .battle_fav_pose").addClass("scale_flash")
            }
            setTimeout(function() {
                if (Battle.now.player_a.same_fig) {
                    $attacker.removeClass("color_flash");
                    $(".battle_hero .battle_fav_pose").removeClass("scale_flash");
                    $(".battle_hero " + puple_glow_selector).removeClass("purple_glow_flash");
                    $('[rel="pos_image"] ' + puple_glow_selector).removeClass("purple_glow_flash")
                }
                if (Battle.now.player_b.same_fig) {
                    $defendee.removeClass("color_flash");
                    $(".battle_opponent " + puple_glow_selector).removeClass("purple_glow_flash");
                    $(".battle_opponent .battle_fav_pose").removeClass("scale_flash")
                }
                $middle_figure.removeClass("color_flash")
            }, 750)
        }
    };
    window.Battle = Battle;
    Battle.fav_pose_decode()
});
$(function() {
    if ($("body").hasClass("page-battle")) {
        var $girlsSelector = $(".girls_reward.girl_ico>.animate");
        var $itemsSelector = $(".rewards_list>.items_reward>.animate");
        var numberOfGirls = $girlsSelector.find(">div>div").length;
        if (numberOfGirls > 1) {
            window.troll_girls = new MovingVerticalSlotsV2($girlsSelector)
        } else {
            if ($(this).find(".girl_ico").length > 0) {
                $(this).find(".girl_ico").addClass("single-reward-image")
            }
        }
        var numberOfItems = $itemsSelector.find(">div>div").length;
        if (numberOfItems > 1) window.troll_rewards = new MovingVerticalSlotsV2($itemsSelector)
    }
});

function change_hero_page(info) {
    var page = info.attr("page");
    var playerID = info.attr("id_player");
    if (HHPopupManager.getLastOpenedPopup() == "hero_pages") {
        hero_page_popup({
            page: page,
            preview: true,
            id: playerID
        });
        $(".social>div").first().hide()
    } else window.location.href = "/hero/" + playerID + "/" + page + ".html"
}

function heroPageSelectItem($element) {
    var $me = $element.children(".slot");
    var radioGrid = $element.attr("radio-grid");
    var tab = $element.closest("div[id]").attr("id");
    var $saveButton = $('button[tab="' + tab + '"][act="save"]');
    if (radioGrid == "girls") {
        $('button[tab="' + radioGrid + '"]').prop("disabled", $me.hasClass("used") && !$me.hasClass("using"));
        $(".slot." + radioGrid).removeClass("selected");
        $element.addClass("selected")
    } else if (tab == "character" || tab == "theme" || tab == "avatar" || tab == "backgrounds") {
        var $buyButton = $element.children(".price");
        var price = parseInt($buyButton.find(".number").attr("price"), 10);
        var currency = $buyButton.find("span[cur]").attr("cur");
        var $siblings = $element.siblings(".selected");
        if (tab != "character") $siblings = $(".box.selected");
        $siblings.each(function() {
            var $selectedBox = $(this);
            $selectedBox.removeClass("selected");
            $selectedBox.children(".slot").removeClass("selected");
            $selectedBox.children(".price").removeClass("orange_text_button");
            $selectedBox.children(".price").removeClass("grey_text_button");
            $selectedBox.children(".price").removeClass("green_text_button")
        });
        $element.addClass("selected");
        $me.addClass("selected");
        if (price) $buyButton.addClass(currency == "soft_currency" ? "green_text_button" : "orange_text_button");
        disableButtonIfNotEnoughKobans();
        if ($me.attr("radio-grid") == "backgrounds") $("#backgrounds button.preview").attr("disabled", $me.hasClass("using"));
        var $tabSlots = $("#" + tab).find(".slot.selected:not(.using)");
        var hasSlotPrice = false;
        $tabSlots.each(function() {
            if ($(this).siblings(".price").find(".number").attr("price")) hasSlotPrice = true
        });
        var isFreeSave = $me.hasClass("using") && !$tabSlots.length || price || hasSlotPrice;
        $saveButton.prop("disabled", isFreeSave)
    } else if ($me.hasClass("using")) $saveButton.prop("disabled", true);
    if ($me.hasClass("girls")) return;
    else if ($element.parent().hasClass("theme wrapper")) $("#bg_all img").attr("src", $me.find("img").attr("url"));
    else if ($element.parent().hasClass("avatar wrapper")) $(".img_wrapper>img").attr("src", $me.find("img").attr("src"));
    else if ($element.parent().hasClass("choice wrapper")) {
        var name = $me.attr("id");
        var category = $me.attr("radio-grid");
        var $img = $("img.character." + category);
        var newFilename = name + ".png";
        var parts = $img.attr("src").split("/");
        parts[parts.length - 1] = newFilename;
        $img.attr("src", parts.join("/"))
    }
}

function heroPageExplodeNames(tab) {
    var nameObject = void 0;
    if (tab == "theme" || tab == "backgrounds" || tab == "avatar") {
        var id = $("." + tab + ".wrapper .slot.selected").attr("id");
        nameObject = {
            id: id
        }
    } else if (tab == "girls") {
        var $img = $(".girls.wrapper .slot.selected>img");
        var grade = $img.siblings(".change").find("plus.skin[checked]").attr("grade");
        nameObject = {
            id: $img.parent().attr("id_girl"),
            grade: grade,
            position: $img.closest(".change_girl").attr("position")
        }
    }
    return nameObject
}

function heroPageMarkSeenElements(tab) {
    var subtab = tab == "item" || tab == "head" || tab == "body";
    var category = void 0;
    var unseenIdList = void 0;
    if (subtab) {
        category = "character_" + tab;
        unseenIdList = unseen_list[category]
    } else {
        if (tab == "backgrounds") unseenIdList = unseen_list["scenery"];
        else unseenIdList = unseen_list[tab]
    }
    var $elementList = $(".slot." + tab);
    var result = [];
    var ajaxList = [];
    var newUnseenList = {};
    if (tab == "character") {
        var list = ["head", "body", "item"];
        var listKey = void 0;
        for (listKey in list) {
            $elementList = $(".slot." + list[listKey]);
            category = "character_" + list[listKey];
            unseenIdList = unseen_list[category];
            result = heroPageCompareIDs(unseenIdList, $elementList);
            ajaxList = ajaxList.concat(result[0]);
            newUnseenList[category] = result[1]
        }
    } else {
        result = heroPageCompareIDs(unseenIdList, $elementList);
        ajaxList = result[0];
        newUnseenList = result[1]
    }
    if (tab == "character") {
        var areAllSeen = true;
        var replacedKey = void 0;
        var $element = void 0;
        var _listKey = void 0;
        for (_listKey in newUnseenList) {
            replacedKey = _listKey.replace("character_", "");
            $element = $("div." + replacedKey).find(".new_notif");
            if (newUnseenList[_listKey].length) {
                areAllSeen = false;
                $element.show()
            } else {
                $element.hide();
                if (!newUnseenList[_listKey].length && areAllSeen) $("h4." + tab).find(".new_notif").fadeOut()
            }
        }
    } else if (newUnseenList.length) {
        if (subtab) $("." + tab).find(".new").show();
        else $("#" + tab).find(".new_notif").show()
    } else {
        if (subtab) $("div." + tab).find(".new_notif").fadeOut();
        else $("#" + tab + ", h4." + tab).find(".new_notif").fadeOut()
    }
    if (ajaxList.length) {
        var params = {
            class: "HeroPages",
            action: "set_element_seen",
            element_id: JSON.stringify(ajaxList)
        };
        hh_ajax(params, function(data) {
            if (tab == "character") {
                var _listKey2 = void 0;
                for (_listKey2 in newUnseenList) {
                    unseen_list[_listKey2] = newUnseenList[_listKey2]
                }
            } else if (subtab) unseen_list[category] = newUnseenList;
            else if (tab == "backgrounds") unseen_list["scenery"] = newUnseenList;
            else unseen_list[tab] = newUnseenList;
            var isAllProfileSeen = true;
            var isAllHaremSeen = true;
            var listKey = void 0;
            for (listKey in unseen_list) {
                if (unseen_list[listKey].length) {
                    if (listKey == "scenery") isAllHaremSeen = false;
                    else isAllProfileSeen = false
                }
            }
            if (isAllProfileSeen) $("h4").find(".new_notif").hide();
            if (isAllProfileSeen && isAllHaremSeen) $(".new_notif").hide()
        })
    }
}

function heroPageCompareIDs(idList, $list) {
    var ajaxList = [];
    var unseenList = [];
    var key = void 0,
        id = void 0,
        seen = void 0;
    for (key in idList) {
        id = idList[key];
        seen = "";
        $list.each(function() {
            var $id = $(this);
            if ($id.attr("id") == id) {
                $id.find(".new").show();
                seen = id;
                ajaxList.push(id)
            }
        });
        if (id != seen) unseenList.push(id)
    }
    return [ajaxList, unseenList]
}
var wrapper_margin = {};

function toggle_arrows($me, nav, direction, page) {
    var myClass = $me.attr("class");
    if (!nav) wrapper_margin[myClass] = parseInt($me.css("margin-left").split("px")[0], 10);
    var margin = wrapper_margin[myClass];
    if (!$me.find(".slot").length) return;
    var marginRight = parseInt($me.find(".box").css("margin-right").split("px")[0], 10);
    var distance = marginRight + $me.find(".box").outerWidth();
    var mult = 4;
    var _calculateMargin = function _calculateMargin(selector, multiplier) {
        return Math.ceil($me.children(selector).length / (mult * (multiplier || 1)) - 1) * (-distance * mult) + margin
    };
    var check = _calculateMargin(".box");
    var isLast = !!$me.siblings('[nav="right"]').attr("last");
    if ($me.hasClass("theme wrapper") || $me.hasClass("avatar wrapper") || $me.hasClass("backgrounds wrapper")) {
        mult = $me.hasClass("backgrounds wrapper") ? 5 : 3;
        if (Math.ceil($me.children(".box").length <= mult * 2)) check = margin;
        if (nav) check = _calculateMargin(".box", 2)
    } else if ($me.hasClass("girls wrapper")) {
        mult = 5;
        if (Math.ceil($me.children(".box:visible").length <= mult)) check = margin;
        else check = _calculateMargin(".box:visible")
    }
    var marginLeft = parseInt($me.css("margin-left").split("px")[0], 10);
    if (nav) {
        if (page != undefined) {
            if (page) marginLeft = -distance * mult * direction * page + margin;
            else marginLeft = margin
        } else marginLeft -= distance * mult * direction;
        $me.css({
            "margin-left": marginLeft + "px"
        })
    }
    if (marginLeft == margin) $me.siblings('[nav="left"]').hide();
    else if (marginLeft < margin) $me.siblings('[nav="left"]').show();
    if (marginLeft == check && isLast) $me.siblings('[nav="right"]').hide();
    else if (marginLeft > check) $me.siblings('[nav="right"]').show()
}

function heroPageBuyId($button) {
    var info = {};
    var params = {
        class: "HeroPages",
        action: "buy_id",
        id: $button.siblings(".slot").attr("id")
    };
    hh_ajax(params, function(data) {
        updateHeroCurrency(data.price);
        $button.attr("class", "").html("");
        heroPageSelectItem($button.parent())
    })
}

function updateHeroCurrency(price) {
    var key = void 0;
    for (key in price) {
        if (price[key]) Hero.update(key, -price[key], true)
    }
}

function heroPageSaveChanges(tab, $button) {
    var info = {};
    var params = {
        class: "HeroPages"
    };
    if (tab == "character") {
        params.action = "save_character";
        params.selection = {
            body: $('[radio-grid="body"].selected').attr("id") || $('[radio-grid="body"].using').attr("id"),
            item: $('[radio-grid="item"].selected').attr("id") || $('[radio-grid="item"].using').attr("id"),
            head: $('[radio-grid="head"].selected').attr("id") || $('[radio-grid="head"].using').attr("id")
        }
    } else if (tab == "theme" || tab == "avatar") {
        info = heroPageExplodeNames(tab);
        params.action = "save_" + tab;
        params.id = info.id
    } else if (tab == "profile") {
        if ($button.hasClass("nickname")) {
            var nickname = $("input").val();
            params.action = "save_nickname";
            params.nickname = nickname
        } else if ($button.hasClass("class")) {
            var playerClass = $button.parent().siblings(".selected").find(">div").attr("carac").replace("class", "");
            params.action = "save_class";
            params.player_class = playerClass
        }
    } else if (tab == "backgrounds") {
        info = heroPageExplodeNames("backgrounds");
        params.action = "save_scenery";
        params.id = info.id
    } else if (tab == "girls") {
        info = heroPageExplodeNames("girls");
        params.action = "save_harem_girl";
        params.id_girl = info.id != -1 ? info.id : 0;
        params.grade = info.grade;
        params.position = parseInt(info.position, 10) + 1
    }
    if (tab == "profile") {
        hh_ajax(params, function(data) {
            var $save = void 0,
                $buy = void 0;
            if ($button.attr("act") == "save") {
                $save = $button;
                $buy = $save.siblings('[act="buy"]')
            } else {
                $buy = $button;
                $save = $buy.siblings('[act="save"]')
            }
            var $free = $save.siblings("span");
            if ($button.hasClass("nickname")) {
                if ($save.css("display") != "none") {
                    $save.hide();
                    $buy.show();
                    $free.hide()
                } else if ($buy.css("display") != "none") Hero.update("hard_currency", -data.HC, true);
                $("input").val("");
                $("input").attr("placeholder", params.nickname);
                $(".top>h3").text(params.nickname);
                $('[rel="avatar"]').attr("title", params.nickname)
            } else if ($button.hasClass("class")) {
                if ($save.css("display") != "none" && data.free_change == 1) {
                    $free.html($free.attr("next"))
                }
                if ($save.css("display") != "none" && !data.free_change) {
                    $save.hide();
                    $buy.show();
                    $free.hide()
                } else if ($buy.css("display") != "none") {
                    Hero.update("hard_currency", -data.HC, true);
                    $("button.class").prop("disabled", true)
                }
                $save.parent().siblings(".slot.using").removeClass("using").removeClass("selected");
                $save.parent().siblings(".slot.selected").addClass("using");
                $(".hero_info>.top>.icon").attr("carac", params.player_class)
            }
            var $buttonParent = $button.parent();
            $buttonParent.siblings(".changed").show();
            if ($button.parent().siblings(".error").is(":visible")) $button.parent().siblings(".error").hide();
            setTimeout(function() {
                $buttonParent.siblings(".changed").fadeOut()
            }, 3e3);
            disableButtonIfNotEnoughKobans();
            if (params.action == "save_nickname") window.parent.location.reload()
        }, function(err) {
            $button.parent().siblings(".error").text(err).show()
        })
    } else {
        hh_ajax(params, function(data) {
            updateHeroCurrency(data.price);
            $button.siblings("div").find(".slot").removeClass("selected").removeClass("using");
            var $rel = $("#" + tab + ' .wrapper span[rel="using"], .container>.' + tab + '.wrapper span[rel="using"]');
            var text = $rel.first().text();
            $rel.text("").attr("rel", "");
            var $element = [];
            if (tab == "character") {
                info = data.elements;
                $element = $('.body .slot[id="' + info.body + '"], .item .slot[id="' + info.item + '"], .head .slot[id="' + info.head + '"]').siblings("span")
            } else if (tab == "theme") $element = $('.slot[id="' + info.id + '"]').siblings("span");
            else if (tab == "avatar") {
                $('[rel="avatar"]>a>img').attr("src", data.avatar);
                $element = $('.slot.avatar[id="' + info.id + '"]').siblings("span")
            } else if (tab == "backgrounds") {
                heroPageCreateSlots(data.background);
                $("#bg_all img").attr("src", data.background.background_image);
                $element = $('[id="' + info.id + '"]').siblings("span");
                $(".change_background").hide();
                selected_girls = {}
            } else if (tab == "girls") {
                var $img = $('.slot.girls[position="' + info.position + '"]:not(.box)>img');
                if (data.empty) {
                    $img.addClass("plus").attr("src", data.empty);
                    $img.siblings(".shadow").hide()
                } else {
                    $img.removeClass("plus").attr("src", data.avatar.toImageUrl("ava"));
                    $img.siblings(".shadow").show()
                }
                selected_girls = data.selected_girls;
                $(".change_girl").hide();
                $('input[name="find"]').val("")
            }
            if (tab != "girls") {
                $element.next().addClass("using");
                $element.attr("rel", "using");
                $element.text(text)
            }
            $button.prop("disabled", true);
            if (params.action == "save_avatar") window.parent.location.reload()
        })
    }
}

function heroPageCreateSlots(info) {
    var charPosition = info.character_position;
    $("div.character").css({
        left: charPosition.x + "px",
        top: charPosition.y + "px",
        transform: "scale(" + charPosition.size + ")",
        "z-index": charPosition.index
    });
    var girlPosition = info.girl_positions;
    $(".harem_page>.slot.girls").remove();
    var plus = $("div.character>img").attr("plus");
    var $slot = "";
    var style = void 0,
        position = void 0,
        i = void 0;
    for (i = 0; i < girlPosition.length; i++) {
        position = girlPosition[i];
        style = "top: " + position.y + "px; left: " + position.x + "px; z-index: " + position.index + "; transform: scale(" + position.size + ");";
        $slot = '<div class="slot girls" style="' + style + '" position="' + i + '"><img class="plus" src="' + plus + '"><div class="shadow" style="display: none"></div></div>';
        $(".harem_page").append($slot)
    }
}

function heroPageCopyText(event) {
    var copyTarget = event.target.dataset.copytarget,
        input = copyTarget ? document.querySelector(copyTarget) : null,
        copied = document.querySelector(".copied");
    if (input && input.select) {
        input.select();
        var success = false;
        try {
            success = document.execCommand("copy")
        } catch (err) {
            success = false
        }
        if (!success) {
            alert("please press Ctrl/Cmd+C to copy");
            return
        }
        input.blur();
        copied.style.display = "block";
        setTimeout(function() {
            copied.style.display = "none"
        }, 1500)
    }
}

function setHeroPagePopup(html) {
    var $heroPages = $("#hero_pages");
    var $canvas = $heroPages.find(".canvas");
    if ($canvas.length) $canvas.replaceWith(html);
    else $heroPages.append(html);
    var $link = $(".with-club-name a");
    if ($link.length) {
        var prevPage = window.location.href.replace(/^http.....[^\/]*[\/]/, "");
        $link.attr("href", $link.attr("href").replace("prev_page=hero/profile.html", "prev_page=" + encodeURIComponent(prevPage)))
    }
    $(".history-scrolling-area").niceScroll();
    var url = $heroPages.find(".profile_page").attr("bg") || $heroPages.find(".harem_page").attr("bg");
    $heroPages.css({
        background: "url(" + url + ") no-repeat",
        "background-size": "cover"
    });
    if ($(".change_background").css("display") == "block") $heroPages.find(".slot").removeClass("preview").find("img").hide();
    setTimeout(function() {
        $heroPages.css({
            transform: "scale(1)",
            opacity: 1
        })
    }, 100)
}

function using_girls($girlsWrapper, data) {
    var girlId = void 0,
        $girl = void 0;
    for (girlId in data) {
        $girl = $girlsWrapper.find('[id_girl="' + girlId + '"]');
        if (selected_girls[girlId] != undefined) $girl.addClass("used");
        else {
            $girl.removeClass("using");
            $girl.removeClass("used")
        }
        if (selected_girls[girlId] && selected_girls[girlId]["position"]) $girl.attr("position", selected_girls[girlId]["position"] - 1);
        else $girl.removeAttr("position")
    }
}

function heroPageSetPromoTag() {
    if (!promoInfo || promoInfo.type != "profile") return;
    var text = "-" + promoInfo.percentage + "%";
    $(".slot").each(function() {
        var $element = $(this);
        if ($element.siblings("span").hasClass("price")) {
            $element.attr("discount", text)
        }
    })
}
$(function() {
    if (!$(".page-hero_pages").length) return;
    heroPageSetPromoTag();
    $(".history-scrolling-area").niceScroll();
    $("body").on("click", "#share_page .copy", heroPageCopyText);
    if ($(".edit_content_tabs").length) heroPageMarkSeenElements($(".edit_content_tabs>div:visible").attr("id"));
    if ($(".harem_page").length && !$(".editor").length) {
        $('input[name="find"]').on("keyup", function() {
            var sel = "lists";
            var option = $('select[name="lists"]').find("option:selected").attr("value");
            if (option == "world" || option == "event") {
                sel = option;
                option = $('select[name="' + option + '"]').find("option:selected").attr("value")
            }
            filter_lists(".girls.wrapper", sel, option)
        });
        $('select[name="lists"], select[name="world"], select[name="event"]').change(function() {
            var sel = $(this).attr("name");
            var option = $(this).find("option:selected").attr("value");
            filter_lists(".girls.wrapper", sel, option)
        })
    }
    $(".tabs>h4").click(function(event) {
        heroPageMarkSeenElements($(this).attr("class").replace(" selected", ""))
    });
    $(".choice.wrapper, .theme.wrapper, .avatar.wrapper, .backgrounds.wrapper, .girls.wrapper").each(function() {
        toggle_arrows($(this))
    });
    $('input[name="username"]').keyup(function() {
        var $me = $(this);
        if ($me.val().length >= 3 && $me.val().length <= 20) $me.parent().find(">div>button.nickname").prop("disabled", false);
        else $me.parent().find(">div>button.nickname").prop("disabled", true);
        if ($me.val() == $me.attr("placeholder")) $me.parent().find(">div>button.nickname").prop("disabled", true);
        disableButtonIfNotEnoughKobans()
    });
    $("body").on("click", ".edit_content_tabs [act], .harem_page [act]", function() {
        var $elementBuySave = $(this);
        var action = $elementBuySave.attr("act");
        var tab = $elementBuySave.attr("tab");
        if (action == "buy") {
            var currency = $elementBuySave.find("span[cur]").attr("cur");
            var price = parseInt($elementBuySave.find(".number").attr("price"), 10) || parseInt($elementBuySave.attr("price"), 10);
            if (currency == "hard_currency") {
                if (tab == "profile") hc_confirm(price, function() {
                    heroPageSaveChanges(tab, $elementBuySave)
                });
                else hc_confirm(price, function() {
                    heroPageBuyId($elementBuySave)
                })
            } else if (currency == "soft_currency") {
                if (price > Hero.infos.soft_currency) notEnoughSoftCurrency(price - Hero.infos.soft_currency);
                else {
                    if (tab == "profile") heroPageSaveChanges(tab, $elementBuySave);
                    else heroPageBuyId($elementBuySave)
                }
            }
        } else if (action == "save") heroPageSaveChanges(tab, $elementBuySave);
        else throw new Error("Invalid hero page button action: " + action)
    });
    $(".edit_content_tabs, .harem_page").on("click", ".box, .girls.wrapper>.slot", function(event) {
        if (!$(this).children(".price").hasClass("orange_text_button") && !$(this).children(".price").hasClass("green_text_button")) event.stopPropagation();
        heroPageSelectItem($(this))
    });
    $(".edit_content_tabs>#profile .slot.class").click(function() {
        var $me = $(this);
        $(".slot.class.selected").removeClass("selected");
        $me.addClass("selected");
        $("button." + $me.attr("radio-grid")).prop("disabled", $me.hasClass("using"));
        disableButtonIfNotEnoughKobans()
    });
    $(".harem_page").on("click", ">.slot.girls, .close", function() {
        var $me = $(this);
        if ($me.is(".close")) {
            if ($me.hasClass("close")) {
                $(".slot.girls.using").removeClass("using");
                $('input[name="find"]').val("")
            }
            $me.parent().toggle()
        } else if ($me.is(".slot.girls")) {
            hh_show_filtered_girls(".girls.wrapper", all_possible_girls);
            using_girls($(".girls.wrapper"), all_possible_girls);
            var $changeGirl = $me.siblings(".change_girl");
            $changeGirl.attr("position", $me.attr("position")).toggle();
            var page = 0;
            var reduce = 0;
            $changeGirl.find(".slot.girls.box").each(function() {
                if ($(this).hasClass("used")) {
                    return false
                } else if (!$(this).is(":visible")) {
                    reduce++
                }
            });
            $changeGirl.find(".slot.girls.used").each(function() {
                var $el = $(this);
                if ($el.attr("position") == $me.attr("position")) {
                    $el.addClass("using");
                    page = Math.floor(($el.index() - reduce) / 5)
                } else {
                    $el.removeClass("using")
                }
            });
            if (page != undefined) toggle_arrows($(".girls.wrapper"), true, 1, page);
            else toggle_arrows($(".girls.wrapper"))
        } else if ($me.parent().is(".change_background")) $me.parent().toggle()
    });
    $(".harem_page .change_bg").click(function() {
        $(".change_background").toggle();
        heroPageMarkSeenElements("backgrounds")
    });
    $(".harem_page div.preview").click(function() {
        hero_page_popup({
            preview: true,
            id: $(this).attr("id_player")
        })
    });
    $(".harem_page>.change_background>button.preview").click(function() {
        hero_page_popup({
            preview: true,
            back_id: $("#backgrounds .slot.selected").attr("id")
        })
    });
    $("[nav]").click(heroPageNavigationClick)
});

function heroPageNavigationClick() {
    var $me = $(this);
    var direction = $me.attr("nav");
    var $div = $me.siblings(":not(span)");
    var radioGrid = $div.find(".slot").attr("radio-grid");
    var what = "";
    var page = 2;
    var length = $div.find(".slot").length;
    if ($div.hasClass("theme wrapper")) {
        page = Math.ceil(length / 6) + 1;
        what = "backgrounds"
    } else if ($div.hasClass("avatar wrapper")) {
        page = Math.ceil(length / 6) + 1;
        what = radioGrid + "s"
    } else if ($div.hasClass("choice wrapper")) {
        page = Math.ceil(length / 4) + 1;
        what = "character_" + radioGrid + "s"
    } else if ($div.hasClass("backgrounds wrapper")) {
        page = Math.ceil(length / 10) + 1;
        what = "sceneries"
    } else if ($div.hasClass("girls wrapper")) {
        page = Math.ceil(length / 5) + 1;
        what = $div.attr("class").split(" ")[0]
    }
    if (direction == "left") toggle_arrows($div, true, -1);
    if (direction == "right") {
        if ($me.attr("last") == "true") toggle_arrows($div, true, 1);
        else {
            var params = {
                class: "HeroPages",
                action: "get_list",
                what: what,
                page: page
            };
            hh_ajax(params, function(data) {
                if (data.last) $div.siblings('[nav="right"]').attr("last", "true");
                var dataObject = void 0;
                var html = void 0;
                var imageTag = void 0;
                if (what.indexOf("character_") != -1) {
                    var key = void 0;
                    for (key in data.list) {
                        dataObject = data.list[key];
                        imageTag = '<img src="' + dataObject.url + '">';
                        html = heroPageGenerateNewItemHTML(dataObject, "character", radioGrid, imageTag, "character_" + radioGrid);
                        $div.append(html)
                    }
                } else {
                    var i = void 0;
                    for (i = 0; i < data.list.length; i++) {
                        dataObject = data.list[i];
                        var rl = 2;
                        if (what == "backgrounds") {
                            imageTag = '<img url="' + dataObject.url + '" src="' + dataObject.url_thumb + '">';
                            html = heroPageGenerateNewItemHTML(dataObject, radioGrid, radioGrid, imageTag, radioGrid)
                        } else if (what == "avatars") {
                            imageTag = '<img src="' + dataObject.url + '">';
                            html = heroPageGenerateNewItemHTML(dataObject, radioGrid, radioGrid, imageTag, radioGrid)
                        } else if (what == "sceneries") {
                            rl = 4;
                            var path = $("div.character>img").attr("girl");
                            imageTag = '<div class="capacity"><img src="' + path + '">' + dataObject.number_of_girls + '</div>\n\t\t\t\t\t\t\t\t\t\t<img url="' + dataObject.background_image + '" src="' + dataObject.background_thumbnail + '">';
                            html = heroPageGenerateNewItemHTML(dataObject, radioGrid, radioGrid, imageTag, "scenery")
                        }
                        if (i <= rl) $div.eq(0).append(html);
                        else $div.eq(1).append(html)
                    }
                }
                heroPageSetPromoTag();
                toggle_arrows($div, true, 1);
                heroPageMarkSeenElements(radioGrid)
            })
        }
    }
}

function heroPageGenerateNewItemHTML(dataObject, tab, radioGrid, imageTag, unseenId) {
    var html = '<div class="box">';
    if (dataObject.SC == 0 && dataObject.HC == 0 || dataObject.purchased) html += "<span></span>";
    else if (dataObject.SC > 0 && !dataObject.purchased) html += '<span class="price" tab="' + tab + '" act="buy"><span class="number" price="' + dataObject.SC + '">' + number_reduce(dataObject.SC) + '</span> <span cur="soft_currency"></span></span>';
    else if (dataObject.HC > 0 && !dataObject.purchased) html += '<span class="price" tab="' + tab + '" act="buy"><span class="number" price="' + dataObject.HC + '">' + dataObject.HC + '</span> <span cur="hard_currency"></span></span>';
    html += '<div class="slot ' + radioGrid + '" name="' + dataObject.image_part + '" id="' + dataObject.id_personalization_element + '" radio-grid="' + radioGrid + '">';
    html += imageTag;
    if (unseen_list[unseenId] && unseen_list[unseenId].indexOf(dataObject.id_personalization_element) != -1) html += '<div class="new">' + GT.design.hp_new + "</div>";
    html += "</div></div>";
    return html
}
$(function() {
    var is_tower_of_fame = $("#leagues").length;
    var isMobile = is_mobile_size();
    $("div#contains_all").on("click", "tbody.leadTable tr", function() {
        var areLeaguesVisible = $("#leagues").length && $("#leagues").css("display") != "none";
        var areClubsVisible = $("#clubs").length && $("#clubs").css("display") != "none";
        var $clickedRow = $(this);
        var playerID = $clickedRow.attr("sorting_id");
        if (areLeaguesVisible && playerID != Hero.infos.id) {
            if (isMobile && is_tower_of_fame) {
                if ($clickedRow.not(".personal_highlight").length) loadLeaguesPlayer($clickedRow)
            } else loadLeaguesPlayer($clickedRow)
        } else if (areClubsVisible) window.location.href = "clubs.html?prev_page=tower-of-fame.html&tab=clubs&view_club=" + playerID;
        else hero_page_popup({
            id: playerID,
            profile_fallback: true
        })
    });
    if (!is_tower_of_fame) return;
    if (isMobile) {
        var fixedPlayerRow = {
            oneRowHTML: function oneRowHTML(dataHTML) {
                var html = '\n\t\t\t\t<div class="use-lead-table" hero-club-mobile-preview>\n\t\t\t\t\t<table class="club-mobile-content">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t' + dataHTML + "\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>";
                return html
            },
            club: {
                viewHTML: "\n\t\t\t\t<tr>\n\t\t\t\t\t<td>" + heroClubInfo.place + '</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class="square-avatar-wrapper">\n\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/pictures/design/clubs/clubs-avatar.png">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t' + heroClubInfo.name + "\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t" + heroClubInfo.member_count + "\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t" + heroClubInfo.level + "\n\t\t\t\t\t</td>\n\t\t\t\t</tr>",
                noClubHTML: '\n\t\t\t\t<tr class="no-club-box">\n\t\t\t\t\t<td colspan="3">\n\t\t\t\t\t\t' + GT.design.not_in_club + '\n\t\t\t\t\t</td>\n\t\t\t\t\t<td></td>\n\t\t\t\t\t<td></td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<a class="blue_button_L" href="/clubs.html">' + GT.design.go_to_clubs + "</a>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>",
                $appendSelector: $("#clubs_right #clubs_filters")
            }
        };
        var heroClubStatus = Object.keys(heroClubInfo).length ? fixedPlayerRow.club.viewHTML : fixedPlayerRow.club.noClubHTML;
        fixedPlayerRow.club.$appendSelector.after(fixedPlayerRow.oneRowHTML(heroClubStatus));
        $("[filter-button]").on("click", function() {
            $("#clubs_filters").toggleClass("visible-class");
            var arrowIcon = $(this).find(".icon");
            if (arrowIcon.is(".upArrow_mix_icn")) arrowIcon.removeClass("upArrow_mix_icn").addClass("downArrow_mix_icn");
            else arrowIcon.removeClass("downArrow_mix_icn").addClass("upArrow_mix_icn")
        });
        btnsAppearingMobile()
    }

    function btnsAppearingMobile() {
        var isLeaguesTabSelected = act_tab.identifyTab() == "leagues";
        $("[filter-button]").toggle(!isLeaguesTabSelected);
        $(".leagues-btn-mobile-refill-multi").toggle(isLeaguesTabSelected)
    }
    $("#tower_of_fame .tabs h4").on("click", function() {
        if (isMobile) btnsAppearingMobile();
        scrollToHeroPosition()
    });
    $(".bunny_message .rank").each(function() {
        var size = 26;
        if (trim($(this).text()).length >= 3) size = 20;
        $(this).css("font-size", size + "px")
    });
    if (is_mobile_size()) $('[rel="count_txt"]').css("margin-top", "-4px");
    scrollToHeroPosition();

    function scrollToHeroPosition() {
        $(".lead_table").each(function() {
            if (!is_mobile_size()) $(this).children(".lead_table_view").niceScroll();
            autoScrollTable($(this))
        })
    }

    function autoScrollTable($parent) {
        var defaultHighlight = $parent.find(".lead_table_default");
        var $el = defaultHighlight.length ? defaultHighlight : $parent.find(".personal_highlight");
        var position = $el.index();
        var elHeight = is_mobile_size() ? $el.height() + 4 : $el.height();
        position = position >= 8 ? (position - 1) * elHeight : 0;
        $parent.children("div.lead_table_view").scrollTop(position);
        if (!is_mobile_size()) create_scroll_checker($parent.children("div.lead_table_view"))
    }
    HHTimers.initDecTimer($('.lead_lastup [rel="timer"]'), next_ranking_in, reload);
    if (!Hero.infos.is_tester) HHTimers.initDecTimer($('.bunny_message [rel="timer"]'), next_ranking_in, reload);
    if (!Hero.infos.is_tester) HHTimers.initDecTimer($('.bunny_message [rel="weekly_timer"]'), next_ranking_in, false)
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var LeaguesMobile = function() {
    function LeaguesMobile() {
        _classCallCheck(this, LeaguesMobile);
        this.$appendHeroInfo = $("#leagues_middle > div.leagues_table.lead_table > div:nth-child(1)");
        this.$leaguesMultiBtn = $("#leagues_left .challenge_points.energy_counter button.multiple-battles");
        this.$leaguesRefillBtn = $("#leagues_left .challenge_points.energy_counter button.refill-challenge-points");
        this.lastClickedRowHTML = "";
        if (Hero.infos.level >= 20) this.init()
    }
    _createClass(LeaguesMobile, [{
        key: "init",
        value: function init() {
            this.$leaguesTable = $("#leagues_middle .leagues_table.lead_table .lead_table_view");
            this.$heroHighlightRow = this.$leaguesTable.find("tr.personal_highlight");
            heroLeaguesData.rank = this.$heroHighlightRow.find("td:nth-child(1) > span").text().trim();
            heroLeaguesData.points = this.$heroHighlightRow.find("td:nth-child(5)").text().trim();
            var heroLeaguesHTML = this.generateExpandedPlayerHTML(heroLeaguesData);
            this.$appendHeroInfo.after(heroLeaguesHTML);
            this.$leaguesMultiBtn.clone().appendTo(".leagues-btn-mobile-refill-multi");
            this.$leaguesRefillBtn.clone().appendTo(".leagues-btn-mobile-refill-multi");
            var existTable = this.$leaguesTable.length && this.$leaguesTable.find("table tr.lead_table_default").length;
            if (existTable) this.openPlayerExpandedInfo(this.$leaguesTable.find("table tr.lead_table_default"))
        }
    }, {
        key: "openPlayerExpandedInfo",
        value: function openPlayerExpandedInfo(tableRow) {
            var $clickedRow = $(tableRow);
            if ($clickedRow.hasClass("selected-player-leagues")) return;
            var $selectedRow = this.$leaguesTable.find("tr.selected-player-leagues");
            if ($selectedRow.length) {
                $selectedRow.children().remove();
                $selectedRow.append(this.lastClickedRowHTML);
                $selectedRow.removeClass("selected-player-leagues")
            }
            this.lastClickedRowHTML = $clickedRow.html();
            $clickedRow.addClass("selected-player-leagues");
            playerLeaguesData.rank = $clickedRow.find("td:nth-child(1) > span").text().trim();
            playerLeaguesData.points = $clickedRow.find("td:nth-child(5)").text().trim();
            var generatedPlayerHTML = '\n\t\t\t<td colspan="5">\n\t\t\t\t' + this.generateExpandedPlayerHTML(playerLeaguesData) + "\n\t\t\t</td>\n\t\t";
            $clickedRow.children().remove();
            $clickedRow.append(generatedPlayerHTML)
        }
    }, {
        key: "generateExpandedPlayerHTML",
        value: function generateExpandedPlayerHTML(heroData) {
            var heroID = Hero.infos.id;
            var playerID = parseInt(heroData.id_member, 10);
            var showButton = false;
            var html = '\n\t\t<div hero-leagues-fixed-bar>\n\t\t\t<div main-row>\n\t\t\t\t<p class="rank">' + heroData.rank + '</p>\n\n\t\t\t\t<div class="ava-name">\n\t\t\t\t\t<div class="square-avatar-wrapper">\n\t\t\t\t\t\t<img src="' + heroData.ico + '">\n\t\t\t\t\t\t<span carac="' + heroData.class + '"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="nickname">' + heroData.Name + '</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="girls_wrapper">\n\t\t\t\t\t' + this.prepareHeroTeamHTML(heroData.team) + '\n\t\t\t\t</div>\n\t\t\t\t<p class="level">' + heroData.level + "</p>";
            if (heroID == playerID) {
                html += '\n\t\t\t\t\t<p class="ch">-</p>\n\t\t\t\t\t<p class="points">' + heroData.points + "</p>"
            } else {
                html += '<div class="wrapper">';
                for (var i in heroData.match_history) {
                    var match_result = heroData.match_history[i];
                    if (match_result) {
                        html += '<div class="result ' + match_result + '">\n\t\t\t\t\t\t\t\t\t\t' + GT.design["leagues_" + match_result + "_letter"] + "\n\t\t\t\t\t\t\t\t\t</div>"
                    } else {
                        showButton = true;
                        html += '<div class="result"></div>'
                    }
                }
                html += "</div>"
            }
            if (showButton) {
                var price = GT.design.leagues_challenge.replace("[nb]", hh_prices.fight_leagues);
                html += '<button challenge-mobile-btn class="blue_button_L">' + price + "</button>"
            }
            html += '\n\t\t\t</div>\n\n\t\t\t<div second-row>\n\t\t\t\t<div class="caracs-hero">\n\t\t\t\t\t<p class="excitement">\n\t\t\t\t\t\t<span carac="ego"></span> ' + number_reduce(heroData.caracs.ego) + '\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class="attack">\n\t\t\t\t\t\t<span carac="damage"></span> ' + number_reduce(heroData.caracs.damage) + '\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class="harmony">\n\t\t\t\t\t\t<span carac="chance"></span> ' + number_reduce(heroData.caracs.chance) + '\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class="endurance">\n\t\t\t\t\t\t<span carac="endurance"></span> ' + number_reduce(heroData.caracs.endurance) + '\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class="def1">\n\t\t\t\t\t\t<span carac="def1"></span> ' + number_reduce(heroData.caracs.def_carac1) + '\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class="def2">\n\t\t\t\t\t\t<span carac="def2"></span> ' + number_reduce(heroData.caracs.def_carac2) + '\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class="def3">\n\t\t\t\t\t\t<span carac="def3"></span> ' + number_reduce(heroData.caracs.def_carac3) + "\n\t\t\t\t\t</p>\n\t\t\t\t</div>";
            if (heroID == playerID) {
                html += '\n\t\t\t\t<div class="leagues_energy_points">\n\t\t\t\t\t<span class="text">' + Hero.energies.challenge.amount + "/" + Hero.energies.challenge.max_amount + '</span>\n\t\t\t\t\t<span cur="energy_challenge"></span>\n\t\t\t\t</div>'
            }
            html += "\n\t\t\t</div>\n\t\t</div>";
            return html
        }
    }, {
        key: "prepareHeroTeamHTML",
        value: function prepareHeroTeamHTML(heroTeam) {
            var html = "";
            for (var index in heroTeam) {
                var girl = heroTeam[index];
                var girlJSON = $.extend({}, girl);
                var arrKeys = ["Name", "class", "position_img", "caracs", "salary_per_hour", "rarity", "Graded2", "level"];
                var girlTooltipData = {};
                for (var i in arrKeys) {
                    var key = arrKeys[i];
                    if (girlJSON[key]) girlTooltipData[key] = girlJSON[key]
                }
                if (girl) {
                    var girlPosition = ["Alpha", "Beta", "Omega"];
                    html += '\n\t\t\t\t<div class="team_girl" g="' + index + "\" new-girl-tooltip-data='" + JSON.stringify(girlTooltipData) + "'>\n\t\t\t\t\t<img rarity=\"" + girl.rarity + '" src="' + girl.ico.toImageUrl("ico") + '" rel="girl"/>\n\t\t\t\t\t<span>' + girlPosition[index - 1] + '</span>\n\t\t\t\t\t<div class="level">' + girl.level + "</div>\n\t\t\t\t</div>"
                }
            }
            return html
        }
    }]);
    return LeaguesMobile
}();
var leaguesMobile = {};
$(function() {
    var isLeagues = $("#leagues").length;
    if (!isLeagues) return;
    if (is_mobile_size()) leaguesMobile = new LeaguesMobile;
    if (league_rewards) {
        var $icons = $(".tier_icons>img");
        $icons.each(function(index, icon) {
            var i = index + 1;
            var data = i == league_tag ? hero_rank_tier : false;
            $(icon).data([data, league_rewards[i], false, season_end_at])
        })
    }
    $("#leagues-info-btn").data([hero_rank_tier, league_rewards[league_tag], false, season_end_at]);
    if ($('.league_end_in [rel="timer"]').length && !(season_end_at < 0)) {
        HHTimers.initDecTimer($('.league_end_in [rel="timer"]'), season_end_at, reload)
    }
    var $nextLeague = $('.warning_message[rel="next_league"]');
    if ($nextLeague.length && !(season_end_at < 0)) {
        HHTimers.initDecTimer($nextLeague.find('[rel="timer"]'), season_end_at, reload)
    }
    $(".current_position").click(function() {
        var $parent = $(".leagues_table");
        var $el = $parent.find("." + $(this).attr("scroll_to"));
        var position = $el.index();
        position = position >= 8 ? (position - 1) * $el.height() : 0;
        $parent.children("div.lead_table_view").scrollTop(position);
        create_scroll_checker($parent.children("div.lead_table_view"))
    });
    $(".refill-challenge-points").click(function() {
        $(this).blur();
        HHPopupManager.show("no_energy_challenge", {
            energy: "challenge",
            can_refill: league_battle_count >= 15
        }, updateInMobileEnergy)
    });

    function updateInMobileEnergy() {
        if (is_mobile_size()) $(".leagues_table.lead_table > [hero-leagues-fixed-bar] .leagues_energy_points > .text").text(Hero.energies.challenge.amount + "/" + Hero.energies.challenge.max_amount)
    }
    $("body").on("click", ".multiple-battles", function() {
        $(this).blur();
        var params = {
            class: "Battle",
            action: "fight",
            who: "league",
            battles_amount: 15
        };
        var callback = function callback() {
            loadingAnimation.start();
            hh_ajax(params, function(data) {
                loadingAnimation.stop();
                Reward.handlePopup(data.rewards)
            })
        };
        if ($(this).attr("price") > 0) hc_confirm($(this).attr("price"), callback);
        else callback()
    });
    $("#leagues").on("click", ".challenge>button, [hero-leagues-fixed-bar] [challenge-mobile-btn]", function() {
        if (Hero.energies.challenge.amount <= 0) {
            HHPopupManager.show("no_energy_challenge", {
                energy: "challenge"
            }, updateInMobileEnergy)
        } else location.href = "/battle.html?league_battle=1&id_member=" + $("#leagues_middle .lead_table_default").attr("sorting_id")
    });
    $(".info .join").on("click", function() {
        hh_ajax({
            namespace: "h\\Leagues",
            class: "Leagues",
            action: "first_join"
        }, function(data) {
            reload()
        })
    });
    $(".forced_info>button").click(function(event) {
        var $button = $(this);
        $button.prop("disabled", true);
        $(".refill-challenge-points, .multiple-battles").prop("disabled", true);
        var type = $button.attr("rel");
        if (type == "claim") {
            hh_ajax({
                namespace: "h\\Leagues",
                class: "Leagues",
                action: "claim_rewards"
            }, function(data) {
                $button.prop("disabled", false);
                $(".refill-challenge-points, .multiple-battles").prop("disabled", false);
                var reward = data.rewards;
                reward.callback = "handleLeaguesRewardsPopup";
                Reward.handlePopup(reward)
            })
        } else if (type == "join") {
            hh_ajax({
                namespace: "h\\Leagues",
                class: "Leagues",
                action: "join"
            }, function(data) {
                reload()
            })
        }
    });
    if ($("#leagues_middle > div.forced_info").is(":visible")) $(".refill-challenge-points, .multiple-battles").prop("disabled", true)
});
var loadedLeaguePlayers = {};

function loadLeaguesPlayer($selector) {
    $("#leagues .lead_table_default").removeClass("lead_table_default");
    $selector.addClass("lead_table_default");
    var playerID = $selector.attr("sorting_id");
    var $leaguesRight = $("#leagues_right");
    if (loadedLeaguePlayers[playerID]) {
        $leaguesRight.html(loadedLeaguePlayers[playerID]);
        replaceImageSources();
        if (is_mobile_size()) leaguesMobile.openPlayerExpandedInfo($selector)
    } else {
        if (is_mobile_size()) loadingAnimation.start();
        var params = {
            namespace: "h\\Leagues",
            class: "Leagues",
            action: "get_opponent_info",
            opponent_id: playerID
        };
        hh_ajax(params, function(data) {
            loadedLeaguePlayers[playerID] = data.html;
            $leaguesRight.html(data.html);
            if (is_mobile_size()) {
                loadingAnimation.stop();
                leaguesMobile.openPlayerExpandedInfo($selector)
            }
        })
    }
}
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var Pachinko = function() {
    _createClass(Pachinko, null, [{
        key: "GREAT",
        get: function get() {
            return "great"
        }
    }, {
        key: "EPIC",
        get: function get() {
            return "epic"
        }
    }, {
        key: "EVENT",
        get: function get() {
            return "event"
        }
    }, {
        key: "DRAFT",
        get: function get() {
            return "draft"
        }
    }, {
        key: "MYTHIC",
        get: function get() {
            return "mythic"
        }
    }, {
        key: "GREAT_SC",
        get: function get() {
            return "pachinko1"
        }
    }, {
        key: "EPIC_HC",
        get: function get() {
            return "pachinko2"
        }
    }, {
        key: "EVENT_HC",
        get: function get() {
            return "pachinko3"
        }
    }, {
        key: "EPIC_DRAFT",
        get: function get() {
            return "pachinko4"
        }
    }, {
        key: "MYTHIC_HC",
        get: function get() {
            return "pachinko5"
        }
    }]);

    function Pachinko(definitions, globalInfo) {
        var _this = this;
        _classCallCheck(this, Pachinko);
        this.pachinkoGames = definitions;
        this.pachinkoInfo = globalInfo;
        this.pachinkoRewards = {};
        this.is_mobile = is_mobile();
        this.pachinkoAnimations = [];
        this.load_assets = PIXI.loader;
        this.load_assets.add("eventPachinko", IMAGES_URL + "/pictures/design/anim/pachinko/event/skeleton.json").add("epicPachinko", IMAGES_URL + "/pictures/design/anim/pachinko/epic/skeleton.json").add("greatPachinko", IMAGES_URL + "/pictures/design/anim/pachinko/great/skeleton.json").add("mythicPachinko", IMAGES_URL + "/pictures/design/anim/pachinko/mythic/skeleton.json");
        this.indexGame = this.loadPachinkoGameWithPriority();
        this.selectedGame = this.pachinkoGames[this.indexGame];
        this.globalScale = 1;
        this.resizeUnscaledContent();
        this.init();
        if (this.pachinkoGames.length > 3) {
            $("#content-unscaled .choosing-pachinko-game").niceScroll({
                horizrailenabled: false
            });
            this.updateSizesOverCanvas()
        }
        $(window).resize(function() {
            _this.resizeUnscaledContent();
            $("#content-unscaled canvas").remove();
            _this.buildPachinkoTypeButtons();
            _this.updateSizesOverCanvas()
        });
        $(window).on("orientationchange", function(event) {
            _this.resizeUnscaledContent();
            $("#content-unscaled canvas").remove();
            _this.buildPachinkoTypeButtons()
        })
    }
    _createClass(Pachinko, [{
        key: "loadPachinkoGameWithPriority",
        value: function loadPachinkoGameWithPriority() {
            if (this.pachinkoInfo.tutorial == 1 || this.pachinkoInfo.orbs_tutorial == 1) return this.getPachinkoGameIndexByType(Pachinko.EPIC);
            else {
                var mythicGame = this.getPachinkoGameData(Pachinko.MYTHIC);
                if (Object.keys(mythicGame).length !== 0)
                    if (mythicGame.content.games[0].button_type) return this.getPachinkoGameIndexByType(Pachinko.MYTHIC);
                    else if (this.pachinkoInfo.great_free) return this.getPachinkoGameIndexByType(Pachinko.GREAT)
            }
            return this.getPachinkoGameIndexByType(Pachinko.EVENT)
        }
    }, {
        key: "getPachinkoGameIndexByType",
        value: function getPachinkoGameIndexByType(type) {
            for (var index in this.pachinkoGames) {
                if (type == this.pachinkoGames[index].type) return index
            }
            return 0
        }
    }, {
        key: "init",
        value: function init() {
            var _this2 = this;
            this.buildPage();
            this.updateSizesOverCanvas();
            $("#bg_all").append('<div style="background-color: rgba(0, 0, 0, 0.35); position: absolute; top: 0; right: 0; bottom: 0; left: 0;"></div>');
            this.greatPachinkoFreeGameTimer(this.pachinkoInfo.next_game);
            var mythicGame = this.getPachinkoGameData(Pachinko.MYTHIC);
            if (Object.keys(mythicGame).length !== 0) this.mythicPachinkoFreeGameTimer(mythicGame.content.next_rotation_interval);
            this.runTimerNextPoolMythic();
            $("body").on("click", "#pachinko_whole .playing-zone button", function(event) {
                $(event.target).blur();
                _this2.playGame(event.target)
            });
            var epicGame = this.getPachinkoGameData(Pachinko.EPIC);
            var pendingRewards = epicGame.pending_rewards;
            if (pendingRewards.data && Object.keys(pendingRewards.data).length > 0) Reward.handlePopup(pendingRewards);
            $("body").on("pachinkoEvent", function(evt, eventInfo) {
                _this2.pachinkoEventHandler(eventInfo)
            });
            this.scrollToActivePachinkoGame(0)
        }
    }, {
        key: "scrollToActivePachinkoGame",
        value: function scrollToActivePachinkoGame() {
            var duration = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 400;
            if (this.pachinkoGames.length > 3) {
                var $scrollContainer = $(".choosing-pachinko-game");
                var scrollArea = $scrollContainer[0];
                var scrollOffset = scrollArea.scrollHeight - $scrollContainer.innerHeight();
                if (this.indexGame > 2) scrollElement(scrollArea, scrollOffset, duration);
                else if (!this.indexGame) scrollElement(scrollArea, -scrollOffset, duration)
            }
        }
    }, {
        key: "pachinkoEventHandler",
        value: function pachinkoEventHandler(eventInfo) {
            var _this3 = this;
            var params = {
                class: "Pachinko",
                action: "reroll",
                what: Pachinko.EPIC_HC,
                how_many: 10
            };
            if (eventInfo.type == "reroll" && eventInfo.state) {
                loadingAnimation.start();
                hh_ajax(params, function(data) {
                    loadingAnimation.stop();
                    var info = data.rewards;
                    info.can_reroll = data.can_reroll;
                    Reward.handlePopup(info)
                })
            } else {
                loadingAnimation.start();
                $.extend(params, {
                    action: "claim"
                });
                if (eventInfo.type == Pachinko.DRAFT) {
                    $.extend(params, {
                        what: Pachinko.EPIC_DRAFT,
                        how_many: 1,
                        id_girl: eventInfo.id_girl
                    })
                }
                hh_ajax(params, function(data) {
                    loadingAnimation.stop();
                    if (eventInfo.type == Pachinko.DRAFT) {
                        data.rewards.data.girlAnimation = true;
                        Reward.handlePopup(data.rewards)
                    }
                    if (data.girl_shards) _this3.removeWonElementsInTooltip(data)
                })
            }
        }
    }, {
        key: "playGame",
        value: function playGame(clickedElement) {
            var _this4 = this;
            var $clickedElement = $(clickedElement).closest("button");
            var playAttribute = $clickedElement.attr("play").split("|");
            var gameName = playAttribute[0];
            var price = parseInt(playAttribute[1]);
            var currency = playAttribute[2];
            var numberOfGames = parseInt($clickedElement.attr("nb_games"));
            var isOrbFreeGame = $clickedElement.attr("orbs") !== undefined;
            var isFreeGame = parseInt($clickedElement.attr("free")) > 0;
            var _runThisGame = function _runThisGame() {
                _this4.runGame(currency, playAttribute, $clickedElement)
            };
            var _confirmToRunThisGame = function _confirmToRunThisGame() {
                if (isOrbFreeGame || isFreeGame) {
                    _runThisGame()
                } else {
                    hc_confirm(price, function() {
                        _runThisGame()
                    })
                }
            };
            if (gameName == Pachinko.EPIC_HC) {
                if (this.pachinkoInfo.tutorial == 1) {
                    HHPopupManager.closeLastOpenedPopup();
                    $("#part_site_hider").hide();
                    $("#pachinko_free").remove();
                    this.pachinkoInfo.tutorial = 2;
                    _runThisGame()
                } else {
                    _confirmToRunThisGame()
                }
            } else if (isOrbFreeGame && !isFreeGame && (gameName != Pachinko.MYTHIC_HC || this.selectedGame.content.can_play)) _runThisGame();
            else if (gameName == Pachinko.EVENT_HC || gameName == Pachinko.EPIC_DRAFT) {
                _confirmToRunThisGame()
            } else if (gameName == Pachinko.MYTHIC_HC) {
                var mythicGame = this.getPachinkoGameData(Pachinko.MYTHIC);
                var firstGameButton = mythicGame.content.games[0];
                if (numberOfGames == 1 && firstGameButton.button_type > 0) {
                    _runThisGame();
                    firstGameButton.button_type = 0;
                    this.buildPlayingZoneContainer(mythicGame);
                    this.runTimerNextPoolMythic()
                } else {
                    if (!this.selectedGame.content.can_play) {
                        var options = {
                            show_over: true,
                            confirm: {
                                title: "",
                                body: GT.design.confirm_pachinko_play,
                                timer: this.selectedGame.content.next_rotation_interval
                            }
                        };
                        HHPopupManager.show("confirm_pachinko", options, function() {
                            _confirmToRunThisGame()
                        })
                    } else {
                        _confirmToRunThisGame()
                    }
                }
            } else if (gameName == Pachinko.GREAT_SC) {
                var greatGame = this.getPachinkoGameData(Pachinko.GREAT);
                var _firstGameButton = greatGame.content.games[0];
                if (numberOfGames == 1 && _firstGameButton.button_type > 0) {
                    _runThisGame();
                    var timeNextFreeGame = 86400;
                    setTimeout(function() {
                        _this4.greatPachinkoFreeGameTimer(timeNextFreeGame)
                    }, 1500);
                    this.pachinkoInfo.great_free = false;
                    this.pachinkoInfo.next_game = Date.now() + timeNextFreeGame * 1e3;
                    this.rebuildGreatPachinkoFirstButton(0)
                } else {
                    if (price > Hero.infos.soft_currency) {
                        notEnoughSoftCurrency(price - Hero.infos.soft_currency)
                    } else {
                        _runThisGame()
                    }
                }
            }
        }
    }, {
        key: "selectedBannerCssTranslate",
        value: function selectedBannerCssTranslate(element) {
            var translateX = 50 * this.globalScale;
            element.css({
                transform: "translate(" + translateX + "px, 0)"
            })
        }
    }, {
        key: "switchPachinkoGame",
        value: function switchPachinkoGame(element) {
            var _this5 = this;
            var $clickedElement = $(element).closest("div");
            if ($clickedElement.is("[selected]")) return;
            $(".game-simple-block").removeAttr("selected");
            $(".game-simple-block").css({
                transform: "translate(0px, 0)"
            });
            $clickedElement.attr("selected", "");
            this.selectedBannerCssTranslate($clickedElement);
            this.indexGame = parseInt($clickedElement.attr("index-game"), 10);
            this.selectedGame = this.pachinkoGames[this.indexGame];
            this.pachinkoAnimations.map(function(pixiApp, tabIndex) {
                if (tabIndex == _this5.indexGame) pixiApp.start();
                else pixiApp.stop()
            });
            this.buildPlayingZoneContainer(this.selectedGame);
            this.runTimerNextPoolMythic();
            this.scrollToActivePachinkoGame()
        }
    }, {
        key: "buildPlayingZoneContainer",
        value: function buildPlayingZoneContainer(game) {
            var playingZoneBlock = document.getElementById("playzone-replace-info");
            if (playingZoneBlock) playingZoneBlock.parentNode.removeChild(playingZoneBlock);
            document.querySelector(".playing-zone[type-panel]").setAttribute("type-panel", game.type);
            document.querySelector(".playing-zone[type-panel] .container").innerHTML += this.rightSidePlayingZone(game);
            this.buildFreeTutorialText();
            disableButtonIfNotEnoughKobans()
        }
    }, {
        key: "buildPage",
        value: function buildPage() {
            var body = "";
            this.leftSideChoosingPachinkoGame();
            body += '\n\t\t\t<div class="playing-zone" type-panel="' + this.selectedGame.type + '">\n\t\t\t\t<div class="border-gradient">\n\t\t\t\t\t<div class="wrapper">\n\t\t\t\t\t\t<div class="container">\n\t\t\t\t\t\t\t<a href="/home.html" class="close_cross">\n\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png"/>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t' + this.rightSidePlayingZone(this.selectedGame) + "\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>";
            document.querySelector("#pachinko_whole").innerHTML += body;
            this.buildPachinkoTypeButtons();
            this.buildFreeTutorialText()
        }
    }, {
        key: "buildFreeTutorialText",
        value: function buildFreeTutorialText() {
            if (this.pachinkoInfo.tutorial == 1) {
                $("#contains_all").append('\n\t\t\t\t<div id="pachinko_free">\n\t\t\t\t\t<img src="' + IMAGES_URL + '/pachinko_free.png?1"/>\n\t\t\t\t\t<span>' + GT.design.free_M + "</span>\n\t\t\t\t</div>");
                $("#pachinko_free").addClass("pachinko_free");
                if (!/[Р°-СЏРђ-РЇРЃС‘]/.test(GT.design.free_M)) $("#pachinko_free>span").addClass("pachinko_free_text");
                $("#pachinko_free>span").css("left", 40 - $("#pachinko_free>span").width() / 2);
                $('[type-panel="epic"] button').first().removeAttr("disabled")
            }
        }
    }, {
        key: "buildPachinkoTypeButtons",
        value: function buildPachinkoTypeButtons() {
            var _this6 = this;
            if (this.hasAnimations()) {
                for (var index in this.pachinkoGames) {
                    var thisGame = this.pachinkoGames[index].animation;
                    var selected = this.indexGame == index;
                    this.canvasAnimation(thisGame, index, selected)
                }
            }
            $(".choosing-pachinko-game .game-simple-block").on("click", function(event) {
                if ($("#part_site_hider").is(":visible")) return;
                _this6.switchPachinkoGame(event.target)
            });
            disableButtonIfNotEnoughKobans()
        }
    }, {
        key: "updateSizesOverCanvas",
        value: function updateSizesOverCanvas() {
            var scale = this.globalScale;
            var selectAllTxts = $(".game-simple-block");
            var scrollBar = $(".choosing-pachinko-game .nicescroll-rails");
            scrollBar.css({
                cssText: "\n\t\t\tright: " + -30 * scale + "px !important;\n\t\t\twidth: 4px;\n\t\t\tz-index: 3;\n\t\t\tcursor: grab;\n\t\t\tposition: absolute;\n\t\t\theight: 410px;\n\t\t\topacity: 1;\n\t\t\ttouch-action: none;\n\t\t\ttop: 10px !important;\n\t\t\tleft: auto !important;\n\t\t"
            });
            var textsObj = {
                title: {
                    obj: ".title-text",
                    fsize: 30,
                    top: -12
                },
                shadow: {
                    obj: ".title-text-shadow",
                    fsize: 30,
                    top: -12
                },
                ball: {
                    obj: ".ball-text",
                    fsize: 12,
                    width: 95,
                    top: 28,
                    left: 12
                },
                body: {
                    obj: ".body-text",
                    fsize: 16,
                    bottom: 34
                },
                bodyTimer: {
                    obj: ".body-text span",
                    fsize: 16
                },
                tape: {
                    obj: ".tape-text",
                    fsize: 14,
                    bottom: 4,
                    left: 125
                }
            };
            var self = this;
            selectAllTxts.each(function() {
                var selectedElement = $(this);
                selectedElement.css({
                    width: 510 * scale + "px"
                });
                selectedElement.find(textsObj.title.obj).css({
                    "font-size": textsObj.title.fsize * scale + "px",
                    top: textsObj.title.top * scale + "px"
                });
                selectedElement.find(textsObj.shadow.obj).css({
                    "font-size": textsObj.shadow.fsize * scale + "px",
                    top: textsObj.shadow.top * scale + "px"
                });
                selectedElement.find(textsObj.ball.obj).css({
                    "font-size": textsObj.ball.fsize * scale + "px",
                    width: textsObj.ball.width * scale + "px",
                    top: textsObj.ball.top * scale + "px",
                    left: textsObj.ball.left * scale + "px"
                });
                selectedElement.find(textsObj.body.obj).css({
                    "font-size": textsObj.body.fsize * scale + "px",
                    top: textsObj.body.top * scale + "px",
                    bottom: textsObj.body.bottom * scale + "px"
                });
                selectedElement.find(textsObj.bodyTimer.obj).css({
                    "font-size": textsObj.bodyTimer.fsize * scale + "px"
                });
                selectedElement.find(textsObj.tape.obj).css({
                    "font-size": textsObj.tape.fsize * scale + "px",
                    bottom: textsObj.tape.bottom * scale + "px",
                    left: textsObj.tape.left * scale + "px"
                });
                if (!self.hasAnimations()) {
                    selectedElement.find("img.static-baner").css({
                        width: 490 * scale + "px",
                        height: 175 * scale + "px"
                    })
                }
            })
        }
    }, {
        key: "hasAnimations",
        value: function hasAnimations() {
            return Hero.infos.no_pachinko_anim == null && !this.is_mobile || Hero.infos.no_pachinko_anim == false
        }
    }, {
        key: "leftSideChoosingPachinkoGame",
        value: function leftSideChoosingPachinkoGame() {
            var selectDefaultIndex = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.indexGame;
            var body = '<div class="choosing-pachinko-game">';
            for (var index in this.pachinkoGames) {
                var selectFirstGameDefault = index == selectDefaultIndex ? "selected" : "";
                var pachinkoGame = this.pachinkoGames[index];
                this.pachinkoRewards[this.pachinkoGames[index].type] = pachinkoGame.content.rewards;
                body += '\n\t\t\t\t<div class="game-simple-block" ' + selectFirstGameDefault + ' type-pachinko="' + pachinkoGame.type + '" index-game="' + index + '">';
                if (!this.hasAnimations()) {
                    body += '<img src="' + this.pachinkoGames[index].banner.background + '" alt="' + this.pachinkoGames[index].banner.txts.title + '" class="static-baner" style="margin-top: 6px; height: 175px">'
                }
                body += '\t<div class="txts">\n\t\t\t\t\t\t<p class="title-text ' + pachinkoGame.type + '">в… ' + pachinkoGame.banner.txts.title + ' в…</p>\n\t\t\t\t\t\t<p class="title-text-shadow ' + pachinkoGame.type + '">в… ' + pachinkoGame.banner.txts.title + " в…</p>";
                if (pachinkoGame.type == Pachinko.GREAT) {
                    body += '\n\t\t\t\t\t\t<p class="ball-text free_game_txt">' + pachinkoGame.banner.txts.ball + '</p>\n\t\t\t\t\t\t<p class="ball-text pachinko_change">' + pachinkoGame.banner.txts.ball_timer + "</p>"
                } else {
                    body += '\n\t\t\t\t\t\t<p class="ball-text">' + pachinkoGame.banner.txts.ball + "</p>"
                }
                body += '\t<p class="body-text">' + pachinkoGame.banner.txts.body + '</p>\n\t\t\t\t\t\t<p class="tape-text">' + pachinkoGame.banner.txts.tape + "</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>"
            }
            body += "</div>";
            document.querySelector("#content-unscaled").innerHTML += body;
            this.selectedBannerCssTranslate($(".game-simple-block[selected]"))
        }
    }, {
        key: "canvasAnimation",
        value: function canvasAnimation(anim_obj, index, selected) {
            var _this7 = this;
            PIXI.settings.SPRITE_MAX_TEXTURES = Math.min(PIXI.settings.SPRITE_MAX_TEXTURES, 16);
            PIXI.utils.skipHello();
            var animWidth = 490 * this.globalScale;
            var animHeight = 160 * this.globalScale;
            var app = new PIXI.Application(animWidth, animHeight, {
                forceCanvas: false,
                transparent: true,
                antialias: true,
                autoStart: true,
                interactive: true
            });
            document.querySelector(anim_obj.selector).appendChild(app.view);
            var anim = null;
            this.load_assets.load(function(loader, response) {
                anim = new PIXI.spine.Spine(response[anim_obj.spine_name].spineData);
                anim.skeleton.setToSetupPose();
                anim.state.timeScale = 1;
                var animContainer = new PIXI.Container;
                animContainer.addChild(anim);
                var localRect = anim.getLocalBounds();
                anim.position.set(-localRect.x, -localRect.y);
                var scale = Math.min(app.screen.width * 1 / animContainer.width, app.screen.height * 1 / animContainer.height);
                animContainer.scale.set(scale, scale);
                animContainer.position.set((app.screen.width - animContainer.width) * .5, (app.screen.height - animContainer.height) * .5);
                app.stage.addChild(animContainer);
                anim.state.setAnimation(0, anim_obj.anim_name, true);
                app.render();
                app.start();
                if (!selected) app.stop();
                _this7.pachinkoAnimations[index] = app
            })
        }
    }, {
        key: "rightSidePlayingZone",
        value: function rightSidePlayingZone() {
            var _this8 = this;
            var game = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.selectedGame;
            var body = "";
            var img = "";
            if (_typeof(game.content.background) === "object") {
                img += '<div class="pachinko_img">';
                for (var i in game.content.background) {
                    img += '<img src="' + game.content.background[i] + '">'
                }
                img += "</div>";
                setTimeout(function() {
                    if (_this8.imageRotator) {
                        _this8.imageRotator.stop();
                        delete _this8.imageRotator
                    }
                    _this8.imageRotator = new ImageFadeRotator;
                    _this8.imageRotator.itemInterval = 3e3;
                    _this8.imageRotator.run(".pachinko_img")
                }, 10)
            } else {
                img = '<div class="pachinko_img"><img src="' + game.content.background + '"></div>'
            }
            body += '\n\t\t<div id="playzone-replace-info">\n\t\t\t<div class="cover">\n\t\t\t\t' + this.buildMythicTooltipGirlPool() + "\n\t\t\t\t" + img + "\n\t\t\t\t<h2>" + game.banner.txts.title + '</h2>\n\t\t\t\t<h3 class="shadow-text">' + game.banner.txts.title + "</h3>\n\t\t\t\t<p>" + game.banner.txts.tape + "</p>\n\t\t\t</div>";
            body += this.buildPrizeListRightPanel(game);
            body += this.buildButtonsInnerRightPanel(game);
            var updateText = !this.pachinkoGames[this.indexGame].content.no_girl_text;
            var hasGirlsForType = !this.pachinkoInfo[game.type + "_no_girls"];
            if (hasGirlsForType && updateText || game.type == Pachinko.MYTHIC) {
                body += '<p class="graduation" rel="girls">' + (hasGirlsForType ? game.banner.txts.guarant : game.banner.txts.guarant_warning) + " " + game.banner.txts.subtext + "</p>";
                body += '<p class="graduation" rel="no_girls" style="display:none;">' + game.banner.txts.guarant_no_girls + " " + game.banner.txts.subtext + "</p>"
            } else {
                this.pachinkoGames[this.indexGame].content.no_girl_text = true;
                body += '<p class="graduation" rel="no_girls" >' + game.banner.txts.guarant_no_girls + " " + game.banner.txts.subtext + "</p>"
            }
            body += "\n\t\t</div>";
            return body
        }
    }, {
        key: "buildMythicTooltipGirlPool",
        value: function buildMythicTooltipGirlPool() {
            var mythicGame = this.getPachinkoGameData(Pachinko.MYTHIC);
            var html = "";
            if (this.selectedGame.id == mythicGame.id) {
                var girlsPool = JSON.stringify(mythicGame.content.girls_pool.girl_shards.plain_data);
                html += '\n\t\t\t<div class="blue_circular_btn pachinko-pool-girl girls_reward reward-ico" data-rewards=\'' + girlsPool + '\'>\n\t\t\t\t<span class="info_icn"></span>\n\t\t\t</div>\n\t\t\t'
            }
            return html
        }
    }, {
        key: "getPachinkoGameData",
        value: function getPachinkoGameData(type) {
            var copy = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
            var gameData = {};
            type = type.toLowerCase();
            switch (type) {
                case Pachinko.GREAT:
                case Pachinko.GREAT_SC:
                    type = Pachinko.GREAT;
                    break;
                case Pachinko.EVENT:
                case Pachinko.EVENT_HC:
                    type = Pachinko.EVENT;
                    break;
                case Pachinko.EPIC:
                case Pachinko.EPIC_HC:
                case Pachinko.EPIC_DRAFT:
                    type = Pachinko.EPIC;
                    break;
                case Pachinko.MYTHIC:
                case Pachinko.MYTHIC_HC:
                    type = Pachinko.MYTHIC;
                    break
            }
            for (var index in this.pachinkoGames) {
                var game = this.pachinkoGames[index];
                if (game.type == type) gameData = copy ? Object.assign({}, game) : game
            }
            return gameData
        }
    }, {
        key: "buildPrizeListRightPanel",
        value: function buildPrizeListRightPanel(game) {
            var body = '\n\t\t<div class="game-rewards">\n\t\t\t<div class="background">\n\t\t\t\t<span class="line"></span>\n\t\t\t\t<span class="line"></span>\n\t\t\t\t<span class="line"></span>\n\t\t\t</div>\n\n\t\t\t<div class="list-prizes">';
            var rewards = Object.keys(game.content.rewards).sort();
            for (var curIndex = 0; curIndex < rewards.length; curIndex++) {
                var tooltip_data = JSON.stringify(game.content.rewards[rewards[curIndex]].plain_data);
                body += "<div data-rewards='" + tooltip_data + "' class=\"girls_reward reward-ico " + rewards[curIndex] + '"></div>'
            }
            body += "\n\t\t\t</div>\n\t\t</div>";
            return body
        }
    }, {
        key: "buildButtonsInnerRightPanel",
        value: function buildButtonsInnerRightPanel(game) {
            var body = '\n\t\t\t<div class="btns-section">';
            var buttonData = void 0;
            for (var btnIndex = 0; btnIndex < game.content.games.length; btnIndex++) {
                buttonData = Object.assign({
                    pachinko_id: game.id,
                    pachinko_type: game.type
                }, game.content.games[btnIndex]);
                if (buttonData.button_type && (game.type == Pachinko.GREAT || game.type == Pachinko.MYTHIC)) {
                    body += this.buildInnerRightButton(buttonData, true)
                } else if (buttonData.orbs > 0 && (this.pachinkoInfo.tutorial != 1 || game.type != Pachinko.EPIC || buttonData.games_number != 1)) {
                    body += this.buildInnerRightButton(buttonData, false, true)
                } else {
                    body += this.buildInnerRightButton(buttonData)
                }
            }
            body += "\n\t\t\t</div>";
            return body
        }
    }, {
        key: "buildInnerRightButton",
        value: function buildInnerRightButton(buttonData) {
            var free = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
            var orbs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
            var getextNumGames = GT.design.pachinko_1_game;
            if (buttonData.games_number == 1) {
                if (buttonData.pachinko_type == Pachinko.EVENT) getextNumGames = GT.design.pachinko_nb_games.replace("[nb]", 4);
                else if (buttonData.button_type == -1) getextNumGames = GT.design.pachinko_draft
            } else if (!free) getextNumGames = GT.design.pachinko_nb_games.replace("[nb]", buttonData.games_number);
            var getextResource = void 0;
            if (free) getextResource = GT.design.free_F;
            else if (orbs) getextResource = "1/<span total_orbs>" + buttonData.orbs + '</span> <span class="orb_icon ' + buttonData.orbs_name + '" orb_name="' + buttonData.orbs_name + '"></span>';
            else getextResource = '<span class="' + (buttonData.currency_type == "soft_currency" ? "hudSC_mix_icn" : "hudHC_mix_icn") + '"></span> <span class="currency_cost">' + number_format_lang(buttonData.price_total) + "</span>";
            var attributeId = "pachinko" + buttonData.pachinko_id;
            var disabledDraftButton = void 0;
            if (buttonData.button_type == -1) {
                attributeId = Pachinko.EPIC_DRAFT;
                var girlShardsArray = void 0;
                var girlsLength = 0;
                for (var index in this.pachinkoGames) {
                    if (buttonData.pachinko_type == Pachinko.EPIC && buttonData.pachinko_type == this.pachinkoGames[index].type) {
                        girlShardsArray = this.pachinkoGames[index].content.rewards.girl_shards;
                        if (girlShardsArray) girlsLength = girlShardsArray.plain_data.length;
                        break
                    }
                }
                disabledDraftButton = girlsLength < 2
            }
            var playAttribute = attributeId + "|" + buttonData.price_total + "|" + buttonData.currency_type;
            var classAttribute = "orange_button_L";
            if (free || orbs) classAttribute = "blue_button_L";
            else if (buttonData.pachinko_type == Pachinko.GREAT) classAttribute = "green_button_L";
            var freeAttribute = "";
            if (buttonData.pachinko_type == Pachinko.GREAT || buttonData.pachinko_type == Pachinko.MYTHIC) {
                if (buttonData.button_type) freeAttribute = 'free="1"';
                else if (buttonData.games_number == 1) freeAttribute = 'free="0"'
            }
            var orbsAttribute = "";
            if (buttonData.orbs > 0) orbsAttribute = 'orbs="1"';
            var disabledAttribute = "";
            if (disabledDraftButton) disabledAttribute = "disabled";
            var priceAttribute = "";
            if (!(free || orbs)) {
                priceAttribute = "price=" + buttonData.price_total
            }
            var htmlAttributes = '\n\t\t\tclass="' + classAttribute + '"\n\t\t\tnb_games="' + buttonData.games_number + '"\n\t\t\tplay="' + playAttribute + '"\n\t\t\t' + priceAttribute + "\n\t\t\t" + freeAttribute + "\n\t\t\t" + orbsAttribute + "\n\t\t\t" + disabledAttribute;
            return "\n\t\t\t<button " + htmlAttributes + ">\n\t\t\t\t" + getextNumGames + " <br>\n\t\t\t\t" + getextResource + "\n\t\t\t</button>"
        }
    }, {
        key: "runGame",
        value: function runGame(currency, play, $button) {
            var _this9 = this;
            $button.prop("disabled", true);
            var game_orbs = parseInt($button.attr("orbs")) || "";
            var game_count = parseInt($button.attr("nb_games"));
            var game_free = parseInt($button.attr("free")) > 0;
            loadingAnimation.start();
            var params = {
                class: "Pachinko",
                action: "play",
                what: play[0],
                how_many: game_count,
                orbs: game_orbs
            };
            if (play[0] == Pachinko.MYTHIC_HC && !this.selectedGame.content.can_play) {
                params.confirmation = true
            }
            hh_ajax(params, function(data) {
                loadingAnimation.stop();
                $button.prop("disabled", false);
                Hero.updates(data.rewards.heroChangesUpdate);
                Hero.infos.hard_currency = data.rewards.heroChangesUpdate.hard_currency;
                disableButtonIfNotEnoughKobans();
                var reward = data.rewards;
                if (play[0] == Pachinko.EVENT_HC || play[0] == Pachinko.MYTHIC_HC) {
                    _this9.removeWonElementsInTooltip(data)
                }
                Reward.handlePopup(reward);
                var orbsData = reward.heroChangesUpdate.orbs;
                var currentGame = _this9.pachinkoGames[_this9.indexGame];
                var currentFirstButton = currentGame.content.games[0];
                if (_this9.pachinkoInfo.tutorial == 2 && currentFirstButton.button_type == 1 && game_count == 1) {
                    currentFirstButton.button_type = 0;
                    _this9.buildPlayingZoneContainer(currentGame)
                } else if (orbsData && !game_free) {
                    var orbName = $button.find(".orb_icon").attr("orb_name");
                    $button.find("span[total_orbs]").text("" + orbsData[orbName]);
                    _this9.updateAfterUsingAllOrbs(play[0], play[1], orbsData[orbName]);
                    _this9.runTimerNextPoolMythic()
                }
            })
        }
    }, {
        key: "updateAfterUsingAllOrbs",
        value: function updateAfterUsingAllOrbs(gameIdentifier, priceTotal, orbsTotal) {
            var gameObject = this.getPachinkoGameData(gameIdentifier);
            var buttons = gameObject.content.games;
            for (var i in buttons) {
                if (buttons[i].price_total == priceTotal) buttons[i].orbs = orbsTotal
            }
            this.buildPlayingZoneContainer(gameObject)
        }
    }, {
        key: "removeWonElementsInTooltip",
        value: function removeWonElementsInTooltip(data) {
            var _this10 = this;
            var personalization = void 0;
            try {
                var avatarObj = data.rewards.data.rewards.find(function(v) {
                    return v.hasOwnProperty("avatar_id")
                });
                personalization = avatarObj.avatar_id
            } catch (e) {
                personalization = undefined
            }
            var possibleWonRewards = {
                girl_shards: data.girl_shards,
                personalization: personalization
            };
            var isPachinkoVisible = this.selectedGame.type == this.pachinkoGames[this.indexGame].type;
            var _loop = function _loop(rewardKey) {
                var wonReward = possibleWonRewards[rewardKey];
                if (!wonReward) return "continue";
                for (var gameType in _this10.pachinkoRewards) {
                    var gameRewards = _this10.pachinkoRewards[gameType];
                    if (!gameRewards[rewardKey]) continue;
                    var rewardsCategory = gameRewards[rewardKey].plain_data;
                    for (var index = 0; index < rewardsCategory.length; index++) {
                        var reward = rewardsCategory[index];
                        var rewardID = 0;
                        var $tooltip = "";
                        if (rewardKey == "girl_shards") {
                            rewardID = reward.id_girl;
                            $tooltip = $(".girls_reward.girl_shards")
                        } else if (rewardKey == "personalization" && reward.ico) {
                            rewardID = reward.ico.indexOf("" + wonReward) != -1 ? parseInt(wonReward, 10) : false;
                            $tooltip = $(".reward-ico.personalization")
                        }
                        if (wonReward != rewardID) continue;
                        var girls_tooltip_index = $tooltip.data("rewards").findIndex(function(v) {
                            return v.id_girl == wonReward
                        });
                        var personalization_tooltip_index = $tooltip.data("rewards").findIndex(function(v) {
                            return v.ico.substring(v.ico.lastIndexOf("/") + 1, v.ico.lastIndexOf(".")) == wonReward
                        });
                        if (girls_tooltip_index > -1) {
                            $tooltip.data("rewards").splice(girls_tooltip_index, 1)
                        }
                        if (personalization_tooltip_index > -1) {
                            $tooltip.data("rewards").splice(personalization_tooltip_index, 1)
                        }
                        rewardsCategory.splice(index, 1);
                        if (!$tooltip.data("rewards").length) $tooltip.hide();
                        if (!rewardsCategory.length) {
                            delete gameRewards[rewardKey];
                            if (isPachinkoVisible && rewardKey == "girl_shards") {
                                if (_this10.selectedGame.type == Pachinko.MYTHIC) {
                                    $('#playzone-replace-info .graduation[rel="girls"]').html(_this10.selectedGame.banner.txts.guarant_warning);
                                    _this10.selectedGame.content.can_play = false
                                } else {
                                    $('#playzone-replace-info .graduation[rel="girls"]').hide();
                                    $('#playzone-replace-info .graduation[rel="no_girls"]').show()
                                }
                                _this10.pachinkoInfo[gameType + "_no_girls"] = true;
                                _this10.runTimerNextPoolMythic()
                            }
                        }
                        if (_this10.selectedGame.type == Pachinko.EPIC && isPachinkoVisible && rewardKey == "girl_shards" && rewardsCategory.length < 2) {
                            $(".playing-zone button").filter(function(index, element) {
                                if ($(element).attr("play").indexOf(Pachinko.EPIC_DRAFT) != -1) return $(element)
                            }).prop("disabled", true)
                        }
                    }
                }
            };
            for (var rewardKey in possibleWonRewards) {
                var _ret = _loop(rewardKey);
                if (_ret === "continue") continue
            }
        }
    }, {
        key: "runTimerNextPoolMythic",
        value: function runTimerNextPoolMythic() {
            var currentGame = this.selectedGame;
            if (currentGame.type == Pachinko.MYTHIC) {
                if (currentGame.content.can_play) return;
                var guarantText = $('#playzone-replace-info [rel="no_girls"]');
                if (guarantText.length) {
                    var htmlText = guarantText.html().replace("[timer]", '<span rel="mythic-timer-guarant"></span>');
                    guarantText.html(htmlText);
                    var nextRotationInterval = currentGame.content.next_rotation_interval;
                    if (nextRotationInterval > 0) {
                        if (HHTimers.timers) {
                            for (var timerKey in HHTimers.timers) {
                                var timer = HHTimers.timers[timerKey];
                                if (timer.$elm && timer.$elm.selector.indexOf("mythic-timer-guarant") > -1) {
                                    HHTimers.stopTimer(timer.id)
                                }
                            }
                        }
                        HHTimers.initDecTimer(guarantText.find('span[rel="mythic-timer-guarant"]'), nextRotationInterval, reload)
                    }
                }
            }
        }
    }, {
        key: "rebuildGreatPachinkoFirstButton",
        value: function rebuildGreatPachinkoFirstButton(buttonType) {
            var greatGame = this.getPachinkoGameData(Pachinko.GREAT);
            if (greatGame != this.pachinkoGames[this.indexGame]) return;
            var greatFirstButton = greatGame.content.games[0];
            if (greatFirstButton.button_type != buttonType) {
                greatFirstButton.button_type = buttonType;
                this.buildPlayingZoneContainer(greatGame)
            }
        }
    }, {
        key: "greatPachinkoFreeGameTimer",
        value: function greatPachinkoFreeGameTimer(time) {
            var _this11 = this;
            if (time > 0) {
                $(".free_game_txt").hide();
                $(".pachinko_change").show();
                HHTimers.initDecTimer($('.pachinko_change [rel="count"]'), time, function() {
                    $(".pachinko_change").hide();
                    $(".free_game_txt").show();
                    _this11.pachinkoInfo.next_game = 0;
                    _this11.rebuildGreatPachinkoFirstButton(1)
                })
            } else {
                $(".pachinko_change").hide();
                $(".free_game_txt").show()
            }
        }
    }, {
        key: "mythicPachinkoFreeGameTimer",
        value: function mythicPachinkoFreeGameTimer(time) {
            var gameBlockMythic = $('.game-simple-block[type-pachinko="mythic"]');
            if (!gameBlockMythic.length) return;
            var bodyTextMythic = gameBlockMythic.find(".body-text");
            var htmlBodyText = bodyTextMythic.html().replace("[timer]", '<span rel="mythic-timer"></span>');
            bodyTextMythic.html(htmlBodyText);
            this.updateSizesOverCanvas();
            if (time > 0) HHTimers.initDecTimer(gameBlockMythic.find('span[rel="mythic-timer"]'), time, reload)
        }
    }, {
        key: "resizeUnscaledContent",
        value: function resizeUnscaledContent() {
            var $containerRef = $("#contains_all");
            var $container = $("#content-unscaled");
            var width = $containerRef.width() * .55;
            var height = $containerRef.height();
            var scaleMatch = $containerRef.css("transform").match(/matrix\(((\d*\.)?\d+),/);
            if (scaleMatch && scaleMatch[1]) {
                this.globalScale = parseFloat(scaleMatch[1]);
                width *= this.globalScale;
                height *= this.globalScale
            }
            var headerHeight = is_mobile_size() ? 65 : 55;
            var header = headerHeight * this.globalScale;
            $container.width(width);
            $container.height(height - header);
            $container.css("left", $containerRef.css("left"));
            $container.css("top", header);
            this.selectedBannerCssTranslate($(".game-simple-block[selected]"))
        }
    }]);
    return Pachinko
}();
$(function() {
    if (!$("#pachinko_whole").length) return;
    new Pachinko(pachinkoDef, pachinkoVar)
});
var slotsActive = false;
var slots_dublicate = {};
var dragndrop = {};
var slots = {};
var statsMultiplierIndex = 0;
var statsMultiplier = [];
$(function() {
    if (!$("#shops").length) return;
    for (var index in Hero.infos.market_stats_purchase_steps) {
        var multiplier = Hero.infos.market_stats_purchase_steps[index];
        statsMultiplier.push({
            text: "x" + multiplier,
            nb: multiplier
        })
    }
    slots = {
        select: function select(selectedSlot) {
            if (selectedSlot !== "preselect" && selectedSlot !== null) {
                if (!selectedSlot.length) return;
                if (selectedSlot.is(".empty")) return;
                if (selectedSlot.closest("#equiped").length) return
            }
            $("#shops button").prop("disabled", true);
            $('#shops #shop button[rel="shop_reload"]').prop("disabled", false);
            disableButtonIfNotEnoughKobans();
            $('#shops button[rel="buy-stats-multiplier"]').prop("disabled", false);
            $(".slot").removeClass("selected potential");
            $("#girls_list .bar-potential").css("width", "0");
            if (selectedSlot == null) {
                $slot = null;
                return
            }
            if (selectedSlot === "preselect") {
                var preselectInfo = slots._preselect;
                var $tab = $("#" + preselectInfo.section + " ." + preselectInfo.tab + " .slot").not(".empty");
                if (!$tab.length) {
                    if (preselectInfo.section == "shop") slots.select($("#inventory ." + preselectInfo.tab + " .slot:eq(0)"));
                    else $(".slot").removeClass("selected");
                    return
                }
                do {
                    $slot = $tab.eq(preselectInfo.index);
                    preselectInfo.index--
                } while (!$slot.length && preselectInfo.index >= 0);
                if (!$slot.length) return
            } else $slot = selectedSlot;
            $slot.addClass("selected");
            $slot.Data = $slot.data("d");
            try {
                var type = $slot.Data.type
            } catch (e) {
                $(".slot").removeClass("selected");
                slotsActive = false;
                return
            }
            var areaContainsSlot = $slot.closest("div[id]").attr("id");
            var $actionButton = "";
            if (areaContainsSlot == "shop") {
                $actionButton = $('#shops #shop button[rel="buy"]');
                $actionButton.prop("disabled", false);
                if ($slot.Data.price_hc) {
                    $actionButton.find("span").attr("cur", "hard_currency").text(number_format_lang($slot.Data.price_hc));
                    $actionButton.removeClass("blue_text_button");
                    $actionButton.addClass("orange_text_button")
                } else {
                    $actionButton.find("span").attr("cur", "soft_currency").text(number_reduce($slot.Data.price));
                    $actionButton.removeClass("orange_text_button");
                    $actionButton.addClass("blue_text_button")
                }
            } else if (areaContainsSlot == "inventory") {
                $actionButton = $('#shops #inventory button[rel="sell"]');
                $actionButton.prop("disabled", false);
                $actionButton.find("span").text(number_reduce($slot.Data.price_sell));
                if (type == "booster") {
                    var _$boosters = $("#equiped .booster .slot.empty");
                    if (_$boosters.length) $('#shops #inventory button[rel="use"]').prop("disabled", false)
                } else if (type == "armor") $('#shops #inventory button[rel="use"]').prop("disabled", false)
            }
            var girlAffAndXP = null;
            if (type == "gift") girlAffAndXP = ["Affection", "aff"];
            else if (type == "potion") girlAffAndXP = ["Xp", "xp"];
            if (girlAffAndXP) {
                var girlData = $girl.data("g");
                var barPoints = girlData[girlAffAndXP[0]];
                if (!barPoints.maxed) {
                    if (areaContainsSlot == "inventory") {
                        if (!(type == "gift" && girlData.can_upgrade)) $('#shops #inventory button[rel="use"]').prop("disabled", false)
                    }
                    setTimeout(function() {
                        var value = parseInt($slot.Data.value, 10);
                        var statsPointsCopy = $.extend({}, barPoints);
                        statsPointsCopy.cur += value;
                        var percentage = girlBarRatio(statsPointsCopy);
                        $girl.find('.bar-wrap[rel="' + girlAffAndXP[1] + '"] .bar-potential').css("width", percentage)
                    }, 200)
                }
            }
            if (type == "booster") {
                var $boosters = $("#equiped .booster .slot.empty");
                if ($boosters.length) {
                    $boosters.first().addClass("potential")
                }
            } else if (type == "armor") {
                $("#equiped .armor .slot").removeClass("potential_old");
                $('#equiped .armor .slot[subtype="' + $slot.Data.subtype + '"]').addClass("potential_old");
                $('#equiped .armor .slot[subtype="' + $slot.Data.subtype + '"]').addClass("potential")
            }
            slots._fillPreselect(areaContainsSlot, $slot);
            disableButtonIfNotEnoughKobans()
        },
        _fillPreselect: function _fillPreselect(section, $slot) {
            slots._preselect = {
                section: section,
                tab: $slot.Data.type,
                index: $slot.index()
            }
        },
        slotAction: {
            normalizeRow: function normalizeRow(type) {
                var $invSlots = $("#inventory [tab]." + type + " .slot");
                var nbSlots = $invSlots.length;
                var nbItems = $invSlots.not(".empty").length;
                var nbEmpty = nbSlots - nbItems;
                var wantedEmpty = 0;
                if (is_mobile_size()) {
                    if (nbItems > 4) wantedEmpty = 0;
                    else wantedEmpty = 4 - nbItems
                } else {
                    if (nbItems < 8) wantedEmpty = 8 - nbItems;
                    else if (nbItems % 4 != 0) wantedEmpty = 4 - nbItems % 4
                }
                if (nbEmpty > wantedEmpty) $invSlots.filter(".empty").slice(0, nbEmpty - wantedEmpty).remove();
                else if (nbEmpty < wantedEmpty) {
                    var $tab = $("#inventory [tab]." + type + " .inventory_slots>div");
                    for (var i = nbEmpty; i < wantedEmpty; i++) {
                        $tab.append('<div class="slot empty"></div>')
                    }
                }
                mobile_inv_nav.update_slots($invSlots, type)
            },
            normalizeAllRow: function normalizeAllRow() {
                var types = {
                    armor: 1,
                    booster: 1,
                    gift: 1,
                    potion: 1
                };
                for (var type in types) {
                    slots.slotAction.normalizeRow(type)
                }
            },
            addInInventory: function addInInventory($s1, memberItemID, addSuccessCallback) {
                var itemType = $s1.data("d").type;
                var $inventoryTab = $("#inventory [tab]." + itemType);
                if (!memberItemID) memberItemID = $s1.data("d").id_m_i[0];
                var $slotCopy = void 0,
                    isStackable = void 0;
                if (itemType != "armor") {
                    $slotCopy = $inventoryTab.find('.slot[id_item="' + $s1.attr("id_item") + '"]');
                    isStackable = $slotCopy.length
                }
                if (isStackable) {
                    var countAvailable = $slotCopy.data("d").count;
                    countAvailable++;
                    $slotCopy.data("d").id_m_i.push(memberItemID);
                    slots.slotAction.stack_update($slotCopy, countAvailable)
                } else {
                    $slotCopy = $s1.clone(false);
                    $slotCopy.data("d", $s1.data("d"));
                    if (itemType == "armor") $inventoryTab.find(".inventory_slots>div").prepend($slotCopy);
                    else slots.slotAction._determinePosition($slotCopy, itemType);
                    $slots = $slots.add($slotCopy);
                    var slotItemData = $slotCopy.data("d");
                    slotItemData.id_m_i = [memberItemID];
                    slotItemData.equiped = "0";
                    $slotCopy.data("d", slotItemData);
                    slots.slotAction.normalizeRow(itemType);
                    if (addSuccessCallback && typeof addSuccessCallback == "function") addSuccessCallback($slotCopy)
                }
                return $slotCopy
            },
            _determinePosition: function _determinePosition($s, type) {
                var $loaded = $("#inventory [tab]." + type + " .slot").not(".empty");
                if ($loaded.length) {
                    $loaded.each(function(index) {
                        var $sl = $(this);
                        var $next = $sl.next();
                        var sl_idn = $sl.data("d").identifier;
                        var s_idn = $s.data("d").identifier;
                        var sl_data = {};
                        $.extend(true, sl_data, $sl.data("d"));
                        var s_data = {};
                        $.extend(true, s_data, $s.data("d"));
                        var next_data = {};
                        $.extend(true, next_data, $next.data("d"));
                        var rarity_arr = {
                            common: 1,
                            rare: 2,
                            epic: 3,
                            legendary: 4
                        };
                        if (rarity_arr[sl_data.rarity] < rarity_arr[s_data.rarity] && next_data.rarity) return true;
                        else if (sl_data.rarity == s_data.rarity) {
                            if (sl_idn < s_idn && rarity_arr[s_data.rarity] != rarity_arr[next_data.rarity]) $sl.after($s);
                            else if (sl_idn < s_idn && rarity_arr[s_data.rarity] == rarity_arr[next_data.rarity]) return true;
                            else if (sl_idn > s_idn) $sl.before($s);
                            return false
                        } else if (rarity_arr[sl_data.rarity] > rarity_arr[s_data.rarity]) {
                            $sl.before($s);
                            return false
                        } else if (index == $loaded.length - 1) {
                            $sl.after($s);
                            return false
                        }
                    })
                } else {
                    $("." + slots._preselect.tab + " .inventory_slots > div").prepend($s)
                }
            },
            equip: function equip($slot) {
                var $slotClone = $slot.clone(false);
                $slotClone.data("d", $slot.data("d"));
                var type = $slotClone.data("d").type;
                if (type == "booster") $("#equiped .booster .empty").first().replaceWith($slotClone);
                else {
                    $('#equiped .slot[subtype="' + $slotClone.data("d").subtype + '"]').replaceWith($slotClone);
                    var slotItemData = $slotClone.data("d");
                    slotItemData.equiped = "1";
                    $slotClone.data("d", slotItemData)
                }
                $slotClone.removeClass("selected");
                $("#equiped").trigger("equip-completed");
                return $slotClone
            },
            empty: function empty($s) {
                var $dad = $s.parent();
                $s.detach();
                $('<div class="slot empty"></div>').appendTo($dad)
            },
            remove: function remove($slot, id_m_i) {
                var countStackedElements = $slot.data("d").count;
                if (countStackedElements > 1) {
                    countStackedElements--;
                    $slot.data("d").id_m_i.pop();
                    slots.slotAction.stack_update($slot, countStackedElements)
                } else {
                    $slot.detach();
                    slots.slotAction.normalizeRow($slot.data("d").type)
                }
            },
            stack_update: function stack_update($slot, countStackedElements) {
                $slot.data("d").count = countStackedElements;
                $slot.find(".stack_num").toggle(countStackedElements > 1);
                $slot.find(".stack_num>span").text(countStackedElements)
            }
        },
        buy: function buy(buySuccessCallback) {
            if (!$slot.Data.price_hc && $slot.Data.price > Hero.infos.soft_currency) {
                notEnoughSoftCurrency($slot.Data.price - Hero.infos.soft_currency);
                return
            }
            $('#shops button[rel="buy"]').prop("disabled", true);
            slots.ajax("buy", function(data, $my_slot) {
                Hero.updates(data.changes, false);
                slots.slotAction.empty($my_slot);
                $my_slot = slots.slotAction.addInInventory($my_slot, data.id_m_i, buySuccessCallback);
                $("#shops").trigger("btnItemBought", $my_slot[0]);
                slots.load_item_shift++;
                slots.select("preselect")
            })
        },
        use: function use() {
            if (slotsActive) return;
            slotsActive = true;
            var type_i = $slot.Data.type;
            if (type_i == "gift") {
                slots.ajax("give_affection", function(data, $my_slot, $my_girl) {
                    slots.slotAction.remove($my_slot, data.id_m_i);
                    var $affValue = $my_girl.find('[rel="aff"] .aff_val');
                    var girl = $my_girl.data("g");
                    var currAff = girl.Affection.cur;
                    var diff = data.affection - currAff;
                    if (currAff + diff < 1e4) anim_number($affValue, currAff, diff);
                    else $affValue.text(number_reduce(data.affection));
                    girl["Affection"]["cur"] = data.affection;
                    glitter_me("affection");
                    $my_girl.find('[rel="aff"] .bar').width(girlBarRatio(girl.Affection));
                    if (data.can_upgrade.upgradable) {
                        var txt = $("#upg_txt").text();
                        $my_girl.find('.bar-wrap[rel="aff"]').addClass("upgrade button_glow").html('<a href="' + data.can_upgrade.quest + '">' + txt + "</a>");
                        $('#shops #inventory button[rel="use"]').prop("disabled", true);
                        girl["can_upgrade"] = true
                    }
                    slots.select("preselect")
                })
            } else if (type_i == "potion") {
                slots.ajax("give_xp", function(data, $my_slot, $my_girl) {
                    slots.slotAction.remove($my_slot, data.id_m_i);
                    var $xpValue = $my_girl.find('[rel="xp"] .xp_val');
                    var girl = $my_girl.data("g");
                    var current = girl.Xp.cur;
                    var diff = data.xp - current;
                    anim_number($xpValue, current, diff);
                    glitter_me("xp_shop");
                    var $level_holder = $my_girl.find(".level_target.level_target_squared div div");
                    var $level_holder_header = $("#girls_list > .level_target.level_target_squared div div");
                    $level_holder.text(data.level);
                    $level_holder.attr("chars", data.level.toString().length);
                    $level_holder_header.text(data.level);
                    $level_holder_header.attr("chars", data.level.toString().length);
                    if (!data.level_up) {
                        data.girl = $my_girl.data("g");
                        data.girl["Xp"]["cur"] = data.xp
                    } else {
                        data.girl.Name = girl.Name;
                        $my_girl.data("g", data.girl);
                        $my_girl.find('[rel="xp"] .xp_max').html(data.girl.Xp.max);
                        hh_format_number($my_girl.find('[rel="xp"] .xp_max'), data.girl.Xp.max)
                    }
                    if (data.level < Hero.infos.level) {
                        $my_girl.find('[rel="xp"] .bar').width(girlBarRatio(data.girl.Xp))
                    } else {
                        $my_girl.find('[rel="xp"]').html('<div class="over">' + GT.design.Maxed + "</div>");
                        $('#shops #inventory button[rel="use"]').prop("disabled", true)
                    }
                    slots.select("preselect")
                })
            } else {
                slots.ajax("use", function(data, $my_slot, $my_girl, id_m_i) {
                    slots.slotAction.remove($my_slot, id_m_i);
                    if (type_i == "armor" && data.item_old) {
                        var $whereItGoes = $('#equiped .slot[subtype="' + data.item_new.subtype + '"]');
                        $whereItGoes.data("d").id_m_i = data.item_old.id_m_i;
                        slots.slotAction.addInInventory($whereItGoes)
                    }
                    $my_slot = slots.slotAction.equip($my_slot);
                    if (type_i == "booster") {
                        var time = parseInt($my_slot.data("d").duration);
                        HHTimers.initDecTimer($my_slot.find("span[lifetime]"), time, function() {
                            booster_callback($my_slot)
                        })
                    }
                    Hero.updates(data.caracs);
                    slots.select("preselect")
                })
            }
        },
        sell: function sell(event) {
            if (slotsActive) return;
            slotsActive = true;
            slots.ajax("sell", function(data, $my_slot) {
                Hero.update("soft_currency", data.soft_currency, true);
                slots.load_item_shift--;
                slots.slotAction.remove($my_slot);
                slots.select("preselect")
            })
        },
        shop_reload: function shop_reload($me, price) {
            slots.select(null);
            var type = $("#shops #shops_left #shop div[tab].selected").attr("type");
            if (type == "quest") return;
            $me.prop("disabled", true);
            var params = {
                class: "Item",
                action: "shop_reload",
                type: type
            };
            hh_ajax(params, function(data) {
                Hero.update("hard_currency", data.hard_currency, false);
                $("#shops #shop [tab]." + type).empty().html(data.html);
                $me.prop("disabled", false);
                $slots = $slots.add($("#shops #shop [tab]." + type + " .slot"));
                disableButtonIfNotEnoughKobans()
            })
        },
        ajax: function ajax(action, callback) {
            var params = {
                class: "Item",
                action: action
            };
            if ($slot) {
                var slotData = $slot.data("d");
                var memberItemsLength = slotData.id_m_i.length;
                params.id_m_i = slotData.id_m_i[memberItemsLength - 1];
                params.id_item = slotData.id_item;
                params.type = slotData.type;
                params.hc = slotData.price_hc;
                if (slotData.type == "armor" && action == "buy") {
                    params.id_skin = slotData.id_skin;
                    params.id_equip = slotData.id_equip
                }
            }
            if ($girl) {
                params.who = $girl.attr("id_girl")
            }
            var $mySlot = $.extend(true, {}, $slot);
            var $myGirl = null;
            if ($girl) $myGirl = $.extend(true, {}, $girl);
            hh_ajax(params, function(data) {
                callback(data, $mySlot, $myGirl, params.id_m_i);
                slotsActive = false
            })
        }
    };
    slots.load_item_shift = 0;
    $(".girl-ico").click(function() {
        if ($(this).is(".not-selected")) {
            return
        } else {
            document.location.href = "/harem/" + $(this).attr("id_girl")
        }
    });

    function girl_select(index) {
        var list_g = [];
        $("#girls_list .girl-ico").each(function() {
            var id_g = $(this).attr("id_girl");
            var $number = $('#girls_list .number[id_girl="' + id_g + '"]');
            list_g.push([id_g, $(this), $number])
        });
        var g = 0;
        $girl = list_g[g][1];
        var lg = 138 + 7;
        $("#girls_list .g1>div").css("width", lg * list_g.length + "px");
        if (typeof index !== "undefined") {
            g = index;
            update_girl_selection()
        }
        $("#girls_list span[nav]").click(function() {
            var nav = $(this).attr("nav");
            if (nav == "left") {
                if (g <= 0) g = list_g.length;
                g--;
                var direction = "back"
            } else {
                if (g + 1 >= list_g.length) g = -1;
                g++;
                var direction = "forward"
            }
            update_girl_selection(direction)
        });

        function update_girl_selection(direction) {
            $girl = list_g[g][1];
            $("#girls_list .girl-ico").addClass("not-selected");
            $girl.removeClass("not-selected");
            $("#girls_list>.level_target_squared>div>div").attr("chars", $girl.data("g")["level"].length);
            $("#girls_list>.level_target_squared>div>div").text($girl.data("g")["level"]);
            $("#girls_list>h3").text($girl.data("g")["Name"]);
            $("#girls_list>.icon").attr("carac", $girl.data("g")["class"]);
            $("#girls_list .number[id_girl]").removeClass("selected");
            list_g[g][2].addClass("selected");
            var gm = list_g.length;
            if (gm <= 3) {
                var $girls = [];
                for (var i in list_g) {
                    $girls.push(list_g[i][1])
                }
                $girls[g].css("left", "145px");
                if (g == 0) $girls[1].css("left", 2 * 145 + "px");
                else if (g == 1) $girls[0].css("left", "0px");
                if (gm == 3) {
                    if (g == 0) $girls[2].css("left", 3 * 145 + "px");
                    else if (g == 1) $girls[2].css("left", 2 * 145 + "px");
                    else {
                        $girls[0].css("left", -145 + "px");
                        $girls[1].css("left", "0px")
                    }
                }
                return
            }
            var $girls = {};
            for (var i = -2; i <= 2; i++) {
                if (i == -2 && (!direction || direction === "back")) continue;
                if (i == 2 && (!direction || direction === "forward")) continue;
                $girls[String(i)] = list_g[(gm + g + i) % gm][1]
            }
            if (typeof direction === "string") {
                if (direction == "forward") {
                    $girls["1"].css("left", 145 * 3 + "px")
                } else {
                    $girls["-1"].css("left", "-145px")
                }
                for (var i in $girls) {
                    var i2 = parseInt(i) + 1;
                    $girls[i].velocity({
                        p: {
                            left: i2 * 145 + "px"
                        },
                        o: {
                            duration: 200,
                            easing: "linear"
                        }
                    })
                }
            } else {
                $girls["-1"].css("left", "0");
                $girls["0"].css("left", "145px");
                $girls["1"].css("left", "290px")
            }
            slots.select($slot)
        }
    }
    var mobile_inv_nav = {
        first_index: {
            armor: 0,
            booster: 0,
            gift: 0,
            potion: 0
        },
        init: function init() {
            this.n_left = $('#inventory span[nav="left"]').click(function() {
                mobile_inv_nav.move("left")
            });
            this.n_right = $('#inventory span[nav="right"]').click(function() {
                mobile_inv_nav.move("right")
            });
            this.update_all()
        },
        move: function move(direction) {
            var $sslots = $("#inventory div[tab].selected");
            var type;
            for (type in mobile_inv_nav.first_index) {
                if ($sslots.is("." + type)) break
            }
            $sslots = $sslots.find(".inventory_slots .slot");
            var selected_length = $sslots.length;
            if (direction == "right" && mobile_inv_nav.first_index[type] < selected_length - 4) mobile_inv_nav.first_index[type]++;
            else if (direction == "right" && mobile_inv_nav.first_index[type] >= selected_length - 4) {
                if (slots.armor_pack_load < 0) return;
                mobile_inv_nav.n_right.hide();
                if (type == "armor") {
                    armor_pack_load_ajax(function() {
                        selected_length = $sslots.length;
                        mobile_inv_nav.update_slots($sslots, type);
                        mobile_inv_nav.update_nav(type)
                    })
                }
                return
            } else if (direction == "left" && mobile_inv_nav.first_index[type] > 0) mobile_inv_nav.first_index[type]--;
            mobile_inv_nav.update_slots($sslots, type);
            mobile_inv_nav.update_nav(type)
        },
        update_slots: function update_slots($sslots, type) {
            var index = mobile_inv_nav.first_index[type];
            $sslots.each(function(i) {
                var hide = i < index || i > index + 3;
                $(this).toggleClass("mobile_hide", hide)
            })
        },
        update_all: function update_all() {
            var $sslots;
            for (var type in mobile_inv_nav.first_index) {
                $sslots = $("#inventory div[tab]." + type + " .inventory_slots .slot");
                mobile_inv_nav.update_slots($sslots, type)
            }
        },
        update_nav: function update_nav(type) {
            var length = $("#inventory div[tab]." + type + " .slot").length;
            var index = mobile_inv_nav.first_index[type];
            mobile_inv_nav.n_left.toggle(index > 0);
            if (slots.armor_pack_load < 0) mobile_inv_nav.n_right.toggle(index < length - 4);
            else mobile_inv_nav.n_right.toggle(index <= length - 4)
        }
    };

    function armor_pack_load_ajax(callback) {
        var $useB = $('button[rel="use"]');
        var $sellB = $('button[rel="sell"]');
        loadingAnimation.start($("#shops #inventory"));
        $useB.prop("disabled", true);
        $sellB.prop("disabled", true);
        slots.armor_pack_load++;
        hh_ajax({
            class: "Item",
            action: "armor_pack_load",
            pack: slots.armor_pack_load,
            shift: slots.load_item_shift
        }, function(data) {
            loadingAnimation.stop();
            $useB.prop("disabled", false);
            $sellB.prop("disabled", false);
            var $last = $("#inventory [tab].armor .slot").not(".empty").last();
            $("#shops #inventory [tab].armor>.inventory_slots>div>.slot.empty").remove();
            $("#shops #inventory [tab].armor>.inventory_slots>div").find($last).after(data.html);
            slots.slotAction.normalizeRow("armor");
            $slots = $slots.add($("#shops #inventory [tab].armor .slot"));
            if (data.last) slots.armor_pack_load = -100;
            if (callback) callback();
            dragndrop.initInventoryItemsDraggable($("#inventory > div.armor.selected > div > div > div.slot"))
        })
    }
    $("#equiped .booster .slot").not(".empty").each(function() {
        var now = Date.now();
        var $booster = $(this);
        var time = parseInt($booster.data("d").lifetime);
        time += 5;
        setTimeout(function() {
            slots.slotAction.empty($booster);
            hh_ajax({
                class: "Item",
                action: "ask_caracs"
            }, function(data) {
                Hero.updates(data.caracs)
            })
        }, time * 1e3 - now)
    });
    var booster_callback = function booster_callback($slot) {
        slots.slotAction.empty($slot);
        $slot.remove();
        slots.select(null)
    };
    $(".slot").each(function() {
        var $slot = $(this);
        var $exp = $slot.find("[expiration]");
        if ($exp.length) {
            var my_now = Date.now() / 1e3;
            var exp = $exp.attr("expiration");
            var remaining_time = exp - my_now;
            if (remaining_time < 0) return;
            HHTimers.initDecTimer($exp, remaining_time, function() {
                booster_callback($slot)
            })
        }
    });

    function girlBarRatio(a) {
        var pc = 100 * (a.cur - a.min) / (a.max - a.min);
        pc = pc > 100 ? 100 : Math.ceil(pc);
        return pc + "%"
    }
    $("#equiped plus").click(function() {
        var $caracToUpdate = $(this);
        if ($caracToUpdate.attr("disabled")) return;
        var carac = $caracToUpdate.attr("for_carac");
        var price = $caracToUpdate.next().attr("value");
        if (price > Hero.infos.soft_currency) {
            notEnoughSoftCurrency(price - Hero.infos.soft_currency);
            return
        }
        $caracToUpdate.attr("disabled", "disabled");
        var params = {
            class: "Hero",
            carac: carac,
            action: "update_stats",
            nb: statsMultiplier[statsMultiplierIndex].nb
        };
        hh_ajax(params, function(data) {
            Hero.update("soft_currency", 0 - price, true);
            Hero.update("carac" + carac, statsMultiplier[statsMultiplierIndex].nb, true);
            var $div = $('#equiped .hero_stats div[carac="endurance"]');
            var $tooltip = $div.children();
            hh_format_number($div, data.endurance, false);
            $div.append($tooltip);
            var $div2 = $('#equiped .hero_stats div[carac="chance"]');
            var $tooltip2 = $div2.children();
            hh_format_number($div2, Math.round(data.chance * 100) / 100, true);
            $div2.append($tooltip2);
            heroStatsPrices[carac] = data.statsPrices;
            plusBtnLogic($caracToUpdate, heroStatsPrices[carac]["prices"][statsMultiplier[statsMultiplierIndex].text])
        })
    });
    var $btnStatsMultiplier = $('button[rel="buy-stats-multiplier"]');
    $btnStatsMultiplier.html(statsMultiplier[statsMultiplierIndex].text);
    $btnStatsMultiplier.on("click", function() {
        statsMultiplierIndex++;
        statsMultiplierIndex = statsMultiplierIndex == statsMultiplier.length ? 0 : statsMultiplierIndex;
        $btnStatsMultiplier.html(statsMultiplier[statsMultiplierIndex].text);
        var curMultiplierCaracs = getMultiplierPrice();
        $("div[hero] [cur]").each(function(index, element) {
            var price = curMultiplierCaracs[index].val;
            plusBtnLogic($(element).parent().find("plus[hero_class]"), price)
        })
    });

    function getMultiplierPrice() {
        var multiplier = statsMultiplier[statsMultiplierIndex].text;
        var objNewPrices = Object.keys(heroStatsPrices).map(function(x) {
            return {
                carac: x,
                val: heroStatsPrices[x]["prices"][multiplier]
            }
        });
        return objNewPrices
    }

    function plusBtnLogic($el, nextPrice) {
        if (nextPrice == "max") {
            $el.attr("disabled", "disabled");
            $el.next().text(GT.design.Maxed)
        } else if (nextPrice == "n/a") {
            $el.attr("disabled", "disabled");
            $el.next().text("< " + statsMultiplier[statsMultiplierIndex].text)
        } else {
            var format = nextPrice > 1e4 ? number_reduce : number_format_lang;
            $el.removeAttr("disabled");
            $el.next().text(format(nextPrice)).attr("value", nextPrice)
        }
    }
    $("#shops").on("click", ".slot", function() {
        slots.select($(this));
        disableButtonIfNotEnoughKobans()
    });
    $('#shops button[rel="buy"]').click(function() {
        $(this).blur();
        var $field = $(this).find('[cur="hard_currency"]');
        if ($field.length) hc_confirm($field.text(), slots.buy);
        else slots.buy()
    });
    $('#shops button[rel="use"]').click(slots.use);
    $('#shops button[rel="sell"]').click(slots.sell);
    $('#shops button[rel="shop_reload"]').click(function() {
        var $me = $(this).blur();
        var price = $me.attr("price");
        hc_confirm(price, function() {
            slots.shop_reload($me, price)
        })
    });
    $("#type_item>div").click(function() {
        slots.select(null);
        var type = $(this).attr("type");
        $("#shops [tab], #type_item>div").removeClass("selected");
        $("#shops [tab]." + type).addClass("selected");
        $(this).addClass("selected");
        $(".inventory_slots>div").getNiceScroll().resize();
        var i_m_a_girl = type == "gift" || type == "potion";
        $("#girls_list").toggleClass("selected", i_m_a_girl);
        $("#equiped").toggleClass("selected", !i_m_a_girl);
        $('#inventory button[rel="use"]>span[rel="girl"]').toggle(i_m_a_girl);
        $('#inventory button[rel="use"]>span[rel="hero"]').toggle(!i_m_a_girl);
        mobile_inv_nav.update_nav(type)
    });
    var scroll = $(".inventory_slots>div")[0];
    slots.armor_pack_load = 0;
    $(scroll).scroll(function() {
        if (slots.armor_pack_load < 0) return;
        var top = scroll.scrollTop;
        var height = scroll.scrollHeight;
        var scrolledHeight = scroll.offsetHeight;
        if (height == Math.round(top + scrolledHeight)) armor_pack_load_ajax()
    });
    mobile_inv_nav.init();
    var id_girl = $.getQueryParam("girl") || "1";
    var index = $(".g1 div").find('[id_girl="' + id_girl + '"]').index("div[id_girl]");
    girl_select(index);
    var request_type = $.getQueryParam("type", "armor");
    $('#type_item>div[type="' + request_type + '"]').click();
    slots.select($("#inventory ." + request_type + " .slot:eq(0)"));
    slots.slotAction.normalizeAllRow();
    window.onresize = function(e) {
        slots.slotAction.normalizeAllRow()
    };
    var sec = $('.shop_count [rel="count"]').attr("time");
    HHTimers.initDecTimer($('.shop_count [rel="count"]'), sec, reload);
    setTimeout(function() {
        dragndrop = new DragAndDrop(document.getElementsByTagName("body")[0].getAttribute("page"));
        dragndrop.initEventListeners()
    }, 500)
});
var club_tabs = {
    tabs: {},
    switchTab: function switchTab(tabName, btnsContainer, h2Container) {
        var $clickedButton = $("#" + tabName);
        var tabData = this.tabs[tabName];
        if ($clickedButton.attr("active_btn") == "true") return;
        $("." + btnsContainer + " > button[active_btn]").removeAttr("active_btn");
        $clickedButton.attr("active_btn", "true");
        var classChangeCallback = function classChangeCallback() {
            if (tabData.view_version != "default") $(".border-gradient").addClass(tabData.view_version);
            else $(".border-gradient").removeClass("average_version smaller_version")
        };
        if (tabData.animate) setTimeout(classChangeCallback, 300);
        else classChangeCallback();
        if (tabData.title) $("." + h2Container + " > h2").text(tabData.title);
        var $oldBody = $("." + h2Container + " .visible-tab");
        var $newBody = $("." + tabData.body_class);
        if (tabData.animate) {
            $oldBody.fadeOut(300);
            setTimeout(function() {
                $newBody.fadeIn(700)
            }, 300)
        } else {
            $oldBody.hide();
            $newBody.show()
        }
        if (tabName == "club_champions") {
            $(".club_information").hide();
            $(".members_requests_tables").hide();
            $(".club_champions_details_container").show();
            $(".club_champions_panel").show();
            $(".club_champions_rewards_info").show()
        } else {
            $(".club_champions_rewards_info").hide();
            $(".club_information").show()
        }
        $oldBody.removeClass("visible-tab");
        $newBody.addClass("visible-tab");
        var scrollabeTable = $(".lead_table_view");
        if (scrollabeTable.length > 0) {
            scrollabeTable.niceScroll();
            create_scroll_checker(scrollabeTable)
        }
    }
};
$(function() {
    if (typeof GT == "undefined" || typeof GT.design == "undefined") return;
    club_tabs.tabs = {
        settings: {
            view_version: "average_version",
            title: Phoenix.__.General.settings,
            body_class: "settings_block",
            animate: false
        },
        clubs_upgrades: {
            view_version: "average_version",
            title: GT.design.clubs_total_upgrades,
            body_class: "upgrades_panel",
            animate: false
        },
        club_champions: {
            view_version: "default",
            title: " ",
            body_class: "club_champions_panel",
            animate: false
        },
        members_request: {
            view_version: "default",
            title: GT.design.my_club,
            body_class: "members_requests_tables",
            animate: false
        },
        create_club: {
            view_version: "smaller_version",
            title: GT.design.club_create,
            body_class: "create_club",
            animate: true
        },
        search_club: {
            view_version: "default",
            title: GT.design.search_for_clubs_text,
            body_class: "search_club",
            animate: true
        },
        chat_requests_resources: {
            view_version: "default",
            title: GT.design.club_request_link,
            body_class: "requests-resources",
            animate: false
        }
    }
});

function checkInputMaxLen(input_el, max_char) {
    var digits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    input_el.keypress(function() {
        var total_chars = max_char - 1;
        if (this.value.length > total_chars) {
            return
        }
        var patt = new RegExp(/\D/g);
        if (patt.test(this.value) && digits) {
            this.value = this.value.replace(/[^\d]/, "");
            this.value = this.value.replace(/\D/g, "")
        }
    })
}
$(function() {
    if (!$("body.page-clubs .club-container.clubs-list").length) return;
    if (!clubs_opened) return;
    $(".clubs_table").on("click", "tr", function() {
        var club = $(this);
        var club_id = club.attr("tr_club_id");
        club.attr("active", "");
        var info_btn = $(this).find("button.club_info");
        info_btn.css("display", "flex");
        info_btn.on("click", function() {
            global_club_info_btn(club_id)
        });
        club.siblings("tr[active]").find("button.club_info").css("display", "none");
        club.siblings("tr[active]").removeAttr("active")
    });
    $("button.club_info").on("click", function() {
        var club_id = $(this).closest("tr").attr("tr_club_id");
        global_club_info_btn(club_id)
    });
    var pinned_club_id = parseInt($(".pinned-block").attr("id"), 10);
    $(".pinned-block button.blue_circular_btn").on("click", function() {
        global_club_info_btn(pinned_club_id)
    });

    function global_club_info_btn(club_id) {
        window.location.href += (window.location.search ? "&" : "?") + ("view_club=" + club_id + "&prev_page=clubs.html")
    }
    $(".club_header > button").on("click", function(evt) {
        var $clicked_button = $(evt.target).is("button") ? $(evt.target) : $(evt.target).parent();
        var tab_name = $clicked_button.attr("id");
        club_tabs.switchTab(tab_name, "club_header", "club-container")
    });
    club_tabs.switchTab("search_club", "club_header", "club-container");
    var club_restriction_state = "request_only";
    $(".club_restrictions button[restriction]").on("click", function() {
        if ($(this).attr("ownstate") != "active") {
            $(this).attr("ownstate", "active");
            $('.club_restrictions button[restriction="' + club_restriction_state + '"]').removeAttr("ownstate");
            club_restriction_state = $(this).attr("restriction")
        }
    });
    $("#create_club_name").keyup(function() {
        var $createClubBtn = $("#button-create-club");
        var isEmpty = $(this).val().trim() == "";
        $createClubBtn.prop("disabled", isEmpty);
        disableButtonIfNotEnoughKobans()
    });
    $("#button-create-club").on("click", function() {
        $(this).blur();
        var minLevelRequired = parseInt($("#create_club_level_restriction").val(), 10);
        if (isNaN(minLevelRequired) || minLevelRequired < 0 || minLevelRequired > HH_MAX_LEVEL) {
            popup_message("" + GT.design.club_max_level);
            return
        }
        var params = {
            class: "Clubs",
            action: "create",
            club_name: $("#create_club_name").val(),
            status: club_restriction_state,
            level_restriction: minLevelRequired
        };
        hc_confirm(price_hc_create, function() {
            hh_ajax(params, function(data) {
                if (data.res == false) {
                    popup_message("Error creating the club.")
                } else {
                    window.location.href = "/clubs.html"
                }
            })
        })
    });
    checkInputMaxLen($("#create_club_name"), 24);
    checkInputMaxLen($("#create_club_level_restriction"), 3, true);
    $(".search_club > .lead_table_view").niceScroll();
    create_scroll_checker($("div.lead_table_view"));
    var requested_timer = $(".pinned-block .expires-timer");
    if (requested_timer.length) {
        var remaining_time = parseInt(requested_timer.attr("time"));
        if (remaining_time > 0) {
            HHTimers.initBarTimer(48 * 3600, remaining_time, $(".expires-timer"), {
                barElm: $(".expires-timer .bar"),
                textElm: $('.expires-timer [rel="timer"]')
            }, reload)
        }
    }
    if (requested_timer.length) {
        $(".search_club > .lead_table_view").addClass("pinned_view_table")
    }
    $(".club_header form>button.club-search-btn").click(function(event) {
        event.preventDefault();
        $(".search_club > .lead_table_view").niceScroll();
        create_scroll_checker($("div.search_clubs_results"));
        $("div.lead_table_view").addClass("search_clubs_results");
        var str = $(this).parent().find("input#search_by_name").val().trim();
        var params = {
            class: "Clubs",
            action: "search",
            str: str
        };
        hh_ajax(params, function(out) {
            $("#clubs_table_tbody").html(out.res)
        })
    });
    $(".club_header form>input#search_by_name").keyup(function() {
        var input_length = $(this).val();
        if (input_length.length < 1) {
            $("div.lead_table_view").removeClass("search_clubs_results");
            var params = {
                class: "Clubs",
                action: "search",
                str: null
            };
            hh_ajax(params, function(out) {
                $("#clubs_table_tbody").html(out.res)
            })
        }
    })
});
$(function() {
    if (!$("body.page-clubs .club-container.club_dashboard").length) return;
    var containerWithTables = $(".members_requests_tables .lead_table_view.members_table");
    containerWithTables.niceScroll();
    create_scroll_checker(containerWithTables);
    hideContributionsCol();
    $("div.tabs > h4").on("click", function() {
        containerWithTables.niceScroll().resize();
        hideContributionsCol()
    });

    function hideContributionsCol() {
        var contributeColumn = $('table th[column="contr"]');
        var $sortingIcons = $("span[sort_by] i");
        if ($(".requests").hasClass("selected")) {
            MembersTableSorting.preventClick = true;
            $sortingIcons.hide();
            contributeColumn.hide();
            contributeColumn.parent().addClass("requests-tab-selected")
        }
        if ($(".members").hasClass("selected")) {
            MembersTableSorting.preventClick = false;
            $sortingIcons.show();
            contributeColumn.show();
            contributeColumn.parent().removeClass("requests-tab-selected")
        }
    }

    function club_ajax(params, success_callback, error_msg) {
        hh_ajax(params, function(data) {
            if (data.res === false) {
                if (!error_msg) error_msg = "Error!";
                popup_message(error_msg)
            } else success_callback()
        })
    }
    $("#requests .expires-timer").each(function() {
        var remaining_time = parseInt($(this).attr("time"));
        if (remaining_time > 0) {
            HHTimers.initBarTimer(48 * 3600, remaining_time, $(".expires-timer"), {
                barElm: $(this).find(".bar"),
                textElm: $(this).find('[rel="timer"]')
            }, reload)
        }
    });
    $("body").on("click", function(e) {
        if (e.target.className == "moreOptions_flat_icn") {
            $("div.options").hide();
            var $options = $(e.target).parent().find("div.options");
            var points = $(e.target).parent().offset().top;
            var tableContainer = $(".lead_table_view.members_table").height();
            var menuHeight = $(e.target).parent().find("div.options").height();
            if (points + menuHeight - 100 > tableContainer) {
                $options.css("top", "-" + menuHeight + "px")
            }
            $options.show()
        } else if (e.target.className != "options") {
            $("div.options").hide()
        }
    });
    $('.options a[option="club_leave"]').on("click", function() {
        var params = {
            class: "Clubs",
            action: "leave",
            id: $(this).attr("rel")
        };
        var option = {
            confirm: {
                title: "",
                body: GT.design.leave_current_club,
                name: current_club_name
            }
        };
        HHPopupManager.show("confirmation_popup", option, function() {
            hh_ajax_then_reload(params)
        })
    });
    $('.options a[option="promote"], .options a[option="promote_leader"]').on("click", function() {
        popup_message("Promote (not active yet).")
    });
    $('.options a[option="demote"]').on("click", function() {
        popup_message("Demote (not active yet).")
    });
    $('.options a[option="kick"]').on("click", function() {
        var params = {
            class: "Clubs",
            action: "kick",
            id_club: current_id_club,
            id_member: $(this).attr("rel")
        };
        var option = {
            confirm: {
                title: "",
                body: GT.design.club_kick_member,
                name: current_club_name
            }
        };
        HHPopupManager.show("confirmation_popup", option, function() {
            club_ajax(params, function() {
                window.location.reload()
            }, "" + GT.design.club_cant_kick_member)
        })
    });
    $("#rename_club_name").keyup(function() {
        var $inputName = $(this);
        var $buttonChangeName = $inputName.closest(".club_name").find("button#change_club_name");
        if ($inputName.val().length >= 3 && $inputName.val().length <= 24) {
            $buttonChangeName.prop("disabled", false);
            $buttonChangeName.removeClass("inactive_btn");
            $buttonChangeName.addClass("orange_button_L")
        } else {
            $buttonChangeName.prop("disabled", true);
            $buttonChangeName.removeClass("orange_button_L");
            $buttonChangeName.addClass("inactive_btn")
        }
        if ($inputName.val() == $inputName.attr("placeholder")) {
            $buttonChangeName.prop("disabled", true);
            $buttonChangeName.removeClass("orange_button_L");
            $buttonChangeName.addClass("inactive_btn")
        }
        disableButtonIfNotEnoughKobans()
    });
    $(".approve_request").on("click", function() {
        var params = {
            class: "Clubs",
            action: "approve_request",
            type: current_id_club,
            id_club: current_id_club,
            id_member: $(this).attr("rel")
        };
        club_ajax(params, function() {
            window.location.href = "/clubs.html?tab=requests"
        })
    });
    $(".decline_request").on("click", function() {
        var params = {
            class: "Clubs",
            action: "decline_request",
            id_club: current_id_club,
            id_member: $(this).attr("rel")
        };
        club_ajax(params, function() {
            window.location.href = "/clubs.html?tab=requests"
        })
    });
    checkInputMaxLen($("#rename_club_name"), 24);
    checkInputMaxLen($("#new_club_level_restriction"), 3, true);
    $("#button_disband_club").on("click", function() {
        $(this).blur();
        if ($(this).attr("rel") > 1) {
            popup_message("" + GT.design.club_cant_disband);
            return false
        }
        var params = {
            class: "Clubs",
            action: "disband",
            id: current_id_club
        };
        var option = {
            confirm: {
                title: "",
                body: "" + GT.design.disband_club,
                name: current_club_name
            }
        };
        HHPopupManager.show("confirmation_popup", option, function() {
            hh_ajax_then_reload(params)
        })
    });
    $("#change_club_name").on("click", function() {
        $(this).blur();
        var heroHardCurrency = Hero.infos.hard_currency;
        var params = {
            class: "Clubs",
            action: "rename",
            id: current_id_club,
            name: $("#rename_club_name").val()
        };
        hc_confirm(price_hc_rename, function() {
            club_ajax(params, function() {
                window.location.href = "/clubs.html"
            }, "Error renaming.")
        })
    });
    $(".club_status button[status]").on("click", function() {
        if ($(this).attr("ownstate") == "active") return;
        $(".club_status button[status]").removeAttr("ownstate");
        $(this).attr("ownstate", "active");
        var clubStatus = $(this).attr("status");
        var params = {
            class: "Clubs",
            action: "change_status",
            id: current_id_club,
            status: clubStatus
        };
        club_ajax(params, function() {
            popup_message("" + Phoenix.__.General.change_success)
        }, "Error changing restriction.")
    });
    $("#button_club_level_restriction").on("click", function() {
        $(this).blur();
        var level = parseInt($("#new_club_level_restriction").val(), 10);
        var params = {
            class: "Clubs",
            action: "change_level_restriction",
            id: current_id_club,
            level: level
        };
        if (level < 0 || level > HH_MAX_LEVEL) {
            popup_message("" + GT.design.club_max_level);
            return
        }
        club_ajax(params, function() {
            popup_message("" + Phoenix.__.General.change_success)
        }, "Error changing level.")
    });
    if (typeof clubChampionsData !== "undefined" && Object.keys(clubChampionsData).length > 0) {
        for (var i = 0; i < clubChampionsData.champion.poses.length; i++) {
            var pose = clubChampionsData.champion.poses[i];
            $(".club-wrapper .club_champions_details_container .valid_poses").append('<img class="champion-pose" src="' + getBattlePositionImagePath(pose) + '">')
        }
        $(".club_champions_rewards_info").on("click", function() {
            HHPopupManager.show("club_champions_help_popup", {}, null)
        })
    }
    for (var upgrade in upgradesInformation.upgrades) {
        upgradesInformation.upgrades[upgrade].texts = {
            name: GT.design["clubup_" + upgrade + "_name"],
            desc: GT.design["clubup_" + upgrade + "_desc"],
            bonus: GT.design["clubup_" + upgrade + "_bonus"]
        }
    }
    var default_club_tab = typeof clubChampionsData !== "undefined" && Object.keys(clubChampionsData).length > 0 && !localStorageGetItem("club_champions_visited") ? "club_champions" : "members_request";
    var load_tab = _GET().club_tab ? _GET().club_tab : default_club_tab;
    club_tabs.switchTab(load_tab, "club_header", "club-container");
    if (default_club_tab === "club_champions") {
        localStorageSetItem("club_champions_visited", true)
    }
    $(".club_header button").on("click", function(evt) {
        var $clicked_button = $(evt.target).is("button") ? $(evt.target) : $(evt.target).parent();
        openTab($clicked_button);
        openFirstUpgrade($clicked_button.attr("id"))
    });
    var openTab = function openTab(tab) {
        var $tab = $(tab);
        var tab_name = $tab.attr("id");
        club_tabs.switchTab(tab_name, "club_header", "club-container")
    };
    var openFirstUpgrade = function openFirstUpgrade(tab_name) {
        var allUpgrades = $(".club_information .upgrades_block div[upgrade-name]");
        var firstUpgrade = allUpgrades.first();
        var upgradeName = firstUpgrade.attr("upgrade-name");
        var selectedUpgrade = "";
        allUpgrades.each(function(index, element) {
            var upgrade = $(element);
            if (upgrade.is("[selected_upgrade]")) selectedUpgrade = upgrade
        });
        if (tab_name == "clubs_upgrades") {
            firstUpgrade.attr("selected_upgrade", "");
            ClubUpgrade.open(upgradeName, upgradesInformation)
        } else if (tab_name != "clubs_upgrades" && selectedUpgrade !== "") selectedUpgrade.removeAttr("selected_upgrade")
    };
    $(".upgrades_block div[upgrade-name]").on("click", function(event) {
        var $clickedUpgrade = $(event.target);
        if ($clickedUpgrade.is("[selected_upgrade]")) return;
        var upgradeName = $clickedUpgrade.attr("upgrade-name");
        openTab("button#clubs_upgrades");
        $(".upgrades_block div[upgrade-name]").removeAttr("selected_upgrade");
        $clickedUpgrade.attr("selected_upgrade", "");
        ClubUpgrade.open(upgradeName, upgradesInformation)
    });
    $("#openChat").on("click", function() {
        $(".club-chat").toggle()
    })
});
$(function() {
    if (!$("body.page-clubs .club-container.club_view").length) return;
    var $cur_club_members = $(".lead_table_view");
    $cur_club_members.niceScroll();
    create_scroll_checker($cur_club_members);

    function club_view_ajax(params) {
        hh_ajax(params, function(data) {
            if (data.res == true) {
                window.location.href = "/clubs.html"
            }
        })
    }
    $("a.close_cross").on("click", function() {
        var page = $.getQueryParam("prev_page");
        var tab_param = $.getQueryParam("tab");
        var tab = tab_param ? "?tab=" + tab_param : "";
        window.location.href = "/" + page + tab
    });
    $('button[action="join"], button[action="request"]').on("click", function() {
        var action = $(this).attr("action");
        var tr_club_id = $(this).attr("tr_club_id");
        var make_action = function make_action(action) {
            if (action == "join") {
                join(tr_club_id)
            } else if (action == "request") {
                request(tr_club_id)
            } else {
                console.log("Unknown action. Type:", action)
            }
        };
        if (already_have_request) {
            var option = {
                confirm: {
                    title: "" + GT.design.club_btn_request,
                    body: "" + GT.design.active_request_club_popup,
                    name: ""
                }
            };
            HHPopupManager.show("confirmation_popup", option, function() {
                make_action(action)
            })
        } else {
            make_action(action)
        }
    });

    function join(id) {
        var params = {
            class: "Clubs",
            action: "join",
            id: id
        };
        var option = {
            confirm: {
                title: GT.design.club_join + "?",
                body: GT.design.club_confirm_join_btn + ' <span class="accent-this">' + current_club_name + "</span>?",
                name: current_club_name
            }
        };
        HHPopupManager.show("confirmation_popup", option, function() {
            club_view_ajax(params)
        })
    }

    function request(id) {
        var params = {
            class: "Clubs",
            action: "request",
            id: id
        };
        club_view_ajax(params)
    }
    $(".button-cancel-request").on("click", function() {
        var params = {
            class: "Clubs",
            action: "cancel_request",
            id: $(this).attr("rel")
        };
        var option = {
            confirm: {
                title: "",
                body: GT.design.club_cancel_request + "?",
                name: current_club_name
            }
        };
        HHPopupManager.show("confirmation_popup", option, function() {
            club_view_ajax(params)
        })
    })
});
$(function() {
    var in_clubs = $("#clubs").length;
    if (!in_clubs) return;
    $("#clubs_filters .search_form button").on("click", function(event) {
        ajaxContentSearch(event)
    });
    $("#clubs_filters .category_select").on("change", function(event) {
        ajaxContentChange(event)
    });

    function applyClubsPageAndScroll(html) {
        $("#clubs_right>.lead_table").html(html);
        if (!is_mobile_size()) $("#clubs_right>.lead_table>.lead_table_view").niceScroll()
    }

    function ajaxContentChange(event) {
        event.preventDefault();
        var $searchForm = $("#clubs_filters .search_form");
        var $submit = $searchForm.find('input[type="submit"]').prop("disabled", true);
        var params = {
            class: "TowerOfFame",
            namespace: "\\h\\Clubs",
            action: "leaderboard_clubs_change",
            ranking_field: $("#clubs_filters #field_select").val(),
            ranking_type: $("#clubs_filters #ranking_type_select").val() || "alltime"
        };
        hh_ajax(params, function(data) {
            applyClubsPageAndScroll(data.html);
            $submit.prop("disabled", false)
        })
    }

    function ajaxContentSearch(event) {
        event.preventDefault();
        var $searchForm = $("#clubs_filters .search_form");
        var $submit = $searchForm.find('input[type="submit"]').prop("disabled", true);
        var params = {
            class: "TowerOfFame",
            namespace: "\\h\\Clubs",
            action: "leaderboard_clubs_search",
            rank_search: $searchForm.find('input[name="rank_search"]').val(),
            ranking_field: $("#clubs_filters #field_select").val(),
            ranking_type: $("#clubs_filters #ranking_type_select").val() || "alltime"
        };
        hh_ajax(params, function(data) {
            applyClubsPageAndScroll(data.html);
            $submit.prop("disabled", false)
        })
    }
    var getItemText = function getItemText(item) {
        return item.text
    };
    var getItemHtml = function getItemHtml(item) {
        return '<span class="image_placeholder" style="background-image: url(' + IMAGES_URL + "/design_v2/leaderboard/" + item.value.toLowerCase() + '.svg);"></span>' + item.text
    };
    $("#clubs_filters .category_select select").selectric({
        optionsItemBuilder: getItemText,
        labelBuilder: getItemText
    });
    $("#clubs_filters .ranking_type_select select").selectric({
        optionsItemBuilder: getItemHtml,
        labelBuilder: getItemHtml
    });
    $("body").on("click", "#clubs_right .lead_table_nav a", function(event) {
        event.preventDefault();
        var $this = $(event.currentTarget);
        var action = $this.attr("lead_nav");
        if (action == "next" && clubs_page < clubs_last_page) clubs_page++;
        else if (action == "first" || action == "last") clubs_page = parseInt($this.attr("page_number"));
        else if (action == "prev" && clubs_page > 1) clubs_page--;
        else return;
        var params = {
            class: "TowerOfFame",
            namespace: "\\h\\Clubs",
            action: "leaderboard_clubs_change",
            rank_search: $("#clubs_filters .search_form input").val(),
            ranking_field: $("#clubs_filters #field_select").val(),
            ranking_type: $("#clubs_filters #ranking_type_select").val() || "alltime",
            page: clubs_page
        };
        hh_ajax(params, function(data) {
            applyClubsPageAndScroll(data.html)
        })
    })
});
var ClubUpgrade = {
    _enterData: function _enterData(upgradeName, info) {
        this.data = {
            upgradeName: upgradeName,
            info: info
        };
        this.data.upgrade = info.upgrades[upgradeName];
        this.data.isMaxed = this.data.upgrade.next_level == false;
        if (!this.data.isMaxed) {
            this.data.currency = this.data.upgrade.next_level_contribution_type;
            this.data.prices = info.contribution_options[this.data.upgrade.next_level_contribution_type];
            this.data.heroCurrency = this._getHeroCurrency(this.data.upgrade.next_level_contribution_type)
        }
    },
    _getHeroCurrency: function _getHeroCurrency(currencyType) {
        return Hero.infos[currencyType]
    },
    open: function open(name, info) {
        this._enterData(name, info);
        $(".upgrades_panel > *").remove();
        this._build(this.data)
    },
    _build: function _build(data) {
        var upgradeName = data.upgradeName,
            _data$upgrade = data.upgrade,
            contribution = _data$upgrade.contribution,
            next_level_contribution_amount = _data$upgrade.next_level_contribution_amount,
            bonus = _data$upgrade.bonus,
            next_level_bonus = _data$upgrade.next_level_bonus,
            texts = _data$upgrade.texts,
            level = _data$upgrade.level;
        var curContr = number_format_lang(contribution);
        var totalContr = number_format_lang(next_level_contribution_amount);
        var contrPerc = contribution / next_level_contribution_amount * 100;
        var currentBonus = data.upgradeName == "member_cap" ? bonus : (bonus * 100).toFixed(1) + "%";
        var nextBonus = data.upgradeName == "member_cap" ? next_level_bonus : (next_level_bonus * 100).toFixed(1) + "%";
        var body = '\n\t\t<div class="container" upgradeName="' + upgradeName + '">\n\t\t\t<h3>' + texts.name + '</h3>\n\n\t\t\t<div class="dark_subpanel_box ' + (this.data.isMaxed ? "is-maxed" : "") + '">\n\t\t\t\t<div class="upgrade_icon ' + upgradeName + '"></div>\n\n\t\t\t\t<p class="description">' + texts.desc + "</p>";
        if (!this.data.isMaxed) {
            body += '\n\t\t\t\t<p class="level-upgrade"><span>' + GT.design.Lvl + "</span> " + level + '</p>\n\n\t\t\t\t<div class="bar-wrap">\n\t\t\t\t\t<p class="status">' + curContr + " / " + totalContr + '</p>\n\t\t\t\t\t<div class="bar" style="width: ' + contrPerc + '%"></div>\n\t\t\t\t</div>';
            body += this._memberBonus(data, currentBonus, nextBonus);
            body += '</div>\n\n\t\t\t<div class="donate select-price-contribute">';
            for (var index = 0; index < data.prices.length; index++) {
                var diffNextContrAmoun = next_level_contribution_amount - contribution;
                var stateDisabled = data.heroCurrency < data.prices[index] || data.prices[index] > diffNextContrAmoun;
                body += '<button class="radio" price="' + data.prices[index] + '" ' + (stateDisabled ? "disabled" : "") + ">\n\t\t\t\t\t" + number_reduce(data.prices[index]) + ' <span cur="' + data.currency + '"></span>\n\t\t\t\t</button>'
            }
            body += '</div>\n\n\t\t\t<button class="' + (data.currency == "soft_currency" ? "green_button_L" : "orange_button_L") + '" send_donate_contribute>' + GT.design.clubup_label_contr_btn + "</button>\n\t\t</div>"
        } else {
            body += '\n\n\t\t\t<div class="bar-wrap">\n\t\t\t\t<p class="status">' + GT.design.Maxed + '</p>\n\t\t\t\t<div class="bar" style="width: 105%"></div>\n\t\t\t</div>\n\n\t\t\t<p class="member-bonus">\n\t\t\t\t' + GT.design.clubup_label_bonus + ': <span class="percentage">' + currentBonus + "</span>\n\t\t\t\t" + texts.bonus + "\n\t\t\t</p>\n\t\t</div>"
        }
        $(".upgrades_panel").append(body);
        $(".donate.select-price-contribute button").not("[disabled]").last().attr({
            state: "active",
            selected: ""
        })
    },
    _memberBonus: function _memberBonus(data, currentBonus, nextBonus) {
        var bonusTexts = {
            current: GT.design.clubup_label_bonus,
            next: GT.design.clubup_label_next_bonus,
            onMemberCap: false
        };
        if (data.upgradeName == "member_cap") {
            bonusTexts.current = GT.design.clubup_label_membercap_bonus;
            bonusTexts.next = GT.design.clubup_label_membercap_next_bonus;
            bonusTexts.onMemberCap = true
        }
        var plusChar = !bonusTexts.onMemberCap ? "+" : "";
        var membersOrPerc = function membersOrPerc(typeBonus) {
            return bonusTexts.onMemberCap ? typeBonus + 20 : typeBonus
        };
        var body = '\n\t\t<p class="member-bonus">\n\t\t\t' + bonusTexts.current + ':\n\t\t\t<span class="percentage">\n\t\t\t\t' + (plusChar + membersOrPerc(currentBonus)) + "\n\t\t\t</span>\n\t\t\t" + data.upgrade.texts.bonus + '\n\t\t</p>\n\n\t\t<p class="next-bonus">\n\t\t\t' + bonusTexts.next + ':\n\t\t\t<span class="percentage">\n\t\t\t\t' + (plusChar + membersOrPerc(nextBonus)) + "\n\t\t\t</span>\n\t\t\t" + data.upgrade.texts.bonus + "\n\t\t</p>";
        return body
    },
    addContributePoints: function addContributePoints(resData, clickedData) {
        var _this = this;
        this._updateUpgradesInfo(resData);
        var update = {
            curContr: resData.contribution,
            totalContr: resData.next_level_contribution_amount,
            totalContrInfo: resData.total_contribution,
            currencyType: resData.next_level_contribution_type,
            upgradeName: resData.feature_name,
            level: resData.level
        };
        var curContr = number_format_lang(update.curContr);
        var totalContr = number_format_lang(update.totalContr);
        var contrPerc = update.curContr / update.totalContr * 100;
        this._updateSmallBar(update);
        var barUpgradePanel = $(".upgrades_panel .bar-wrap");
        var status = barUpgradePanel.find("p.status");
        var bar = barUpgradePanel.find(".bar");
        status.text(curContr + " / " + totalContr);
        bar.css({
            width: contrPerc + "%"
        });
        $(".club_information .contribution_pts .num").text("" + update.totalContrInfo);
        var diffNextContrAmoun = update.totalContr - update.curContr;
        var $donateBtns = $(".donate.select-price-contribute button");
        $donateBtns.each(function(index, element) {
            var $element = $(element);
            if ($element.is("[disabled]")) return true;
            var price = $element.attr("price");
            var stateDisabled = _this._getHeroCurrency(update.currencyType) < price || price > diffNextContrAmoun;
            if (stateDisabled) {
                $element.prop("disabled", true);
                $donateBtns.removeAttr("state selected");
                $donateBtns.not("[disabled]").last().attr({
                    state: "active",
                    selected: ""
                })
            }
        })
    },
    _updateSmallBar: function _updateSmallBar(update) {
        var contrPerc = update.curContr / update.totalContr * 100;
        var numSelectCardUpgr = $(".club_information .upgrades_block div[selected_upgrade]").find("span.num");
        numSelectCardUpgr.text(update.level);
        var barSelectCardUpgr = $(".club_information .upgrades_block div[selected_upgrade]").find(".bar[style]");
        barSelectCardUpgr.css({
            width: contrPerc + "%"
        })
    },
    _updateUpgradesInfo: function _updateUpgradesInfo(resData) {
        var upInfo = upgradesInformation.upgrades[resData.feature_name];
        upInfo.bonus = resData.bonus;
        upInfo.contribution = resData.contribution;
        upInfo.level = resData.level;
        upInfo.next_level = resData.next_level;
        upInfo.next_level_bonus = resData.next_level_bonus;
        upInfo.next_level_contribution_amount = resData.next_level_contribution_amount;
        upInfo.next_level_contribution_type = resData.next_level_contribution_type;
        upgradesInformation.total_contributions = resData.total_contributions;
        upgradesInformation.total_levels = resData.total_upgrades
    },
    levelUp: function levelUp(resData) {
        this._updateUpgradesInfo(resData);
        var upName = resData.feature_name;
        var upgradeInfo = upgradesInformation.upgrades[upName];
        this.open(upName, upgradesInformation);
        if (resData.feature_name == "member_cap") {
            var maxMembers = $(".club_id span.max-members-club");
            var numMaxMembers = 20 + parseInt(upgradeInfo.bonus, 10);
            maxMembers.text(numMaxMembers)
        }
        $(".club_information .contribution_pts .num").text("" + resData.total_contribution);
        $(".club_information .upgrade_lvl .num").text("" + resData.total_upgrades);
        if (upgradeInfo.next_level) {
            var update = {
                curContr: resData.contribution,
                totalContr: resData.next_level_contribution_amount,
                level: resData.level
            };
            this._updateSmallBar(update)
        } else {
            var cardUpgrade = $('.upgrades_block div[upgrade-name="' + upName + '"]');
            cardUpgrade.find(".rank_and_bar").addClass("maxed");
            cardUpgrade.find(".rank_and_bar .bar-wrap").remove();
            cardUpgrade.find(".rank_and_bar .num").text(GT.design.Max)
        }
    }
};
$(function() {
    if (!$("body.page-clubs .club-container.club_dashboard").length) return;
    $("body").on("click", "button[send_donate_contribute]", function(event) {
        var $btn = $(event.target);
        var selectedRadio = $(".donate.select-price-contribute button[selected]");
        var price = parseInt(selectedRadio.attr("price"), 10);
        var currency = selectedRadio.find("span").attr("cur");
        var upgrade = $(".club_information .upgrades_block div[selected_upgrade]").attr("upgrade-name");
        var options = {
            class: "Clubs",
            action: "contribute",
            feature_name: upgrade,
            amount: price,
            kobans: currency == "hard_currency" ? "true" : ""
        };
        if (currency == "soft_currency") {
            if (Hero.infos.soft_currency < price) {
                notEnoughSoftCurrency(price - Hero.infos.soft_currency);
                return
            } else prepareAnimation()
        } else if (currency == "hard_currency") hc_confirm(price, function() {
            prepareAnimation()
        });

        function prepareAnimation() {
            loadingAnimation.start();
            $btn.prop("disabled", true);
            prepareAjax()
        }

        function prepareAjax() {
            hh_ajax(options, function(data) {
                var res = data.res;
                $btn.prop("disabled", false);
                loadingAnimation.stop();
                Hero.update(currency, 0 - price, true);
                if (res.leveled_up) {
                    ClubUpgrade.levelUp(res);
                    ClubUpgrade.open(upgrade, upgradesInformation)
                } else {
                    var buttonData = {
                        selected: selectedRadio,
                        price: price,
                        currency: currency
                    };
                    ClubUpgrade.addContributePoints(res, buttonData)
                }
            })
        }
    });
    $("body").on("click", ".donate.select-price-contribute", function(event) {
        var $btn = $(event.target);
        $(".donate.select-price-contribute > button").removeAttr("state selected");
        $btn.attr({
            state: "active",
            selected: ""
        })
    })
});
$(function() {
    if (!$("body.page-map").length) return;
    var map = {
        transition_active: false,
        navigateTo: function navigateTo(direction) {
            var section = sections[current_section][direction];
            if (!map.validateNav(section)) return;
            map.transition_active = true;
            current_section = section;
            map.updatePosition();
            map.updateArrows()
        },
        validateNav: function validateNav(section) {
            if (current_section === section) return false;
            if (map.transition_active === true) return false;
            if (!sections[section]) return false;
            return true
        },
        updatePosition: function updatePosition() {
            var translationPixels = sections[current_section].translationPixels;
            var $animatedObjects = $("#bg_all>div>*, #map>*");
            $animatedObjects.css("transform", "translateX(" + -translationPixels + "px)");
            $animatedObjects[0].addEventListener("transitionend", _transitionEnd);

            function _transitionEnd(e) {
                e.target.removeEventListener("transitionend", _transitionEnd);
                map.transition_active = false
            }
        },
        updateArrows: function updateArrows() {
            var $prev_world_arrow = $(".previous_world");
            var $next_world_arrow = $(".next_world");
            var section_data = sections[current_section];
            if (section_data.prev) $prev_world_arrow.delay(500).fadeIn();
            else $prev_world_arrow.fadeOut();
            if (section_data.next) $next_world_arrow.delay(500).fadeIn();
            else $next_world_arrow.fadeOut()
        }
    };
    map.updateArrows();
    $(".previous_world").click(function() {
        map.navigateTo("prev")
    });
    $(".next_world").click(function() {
        map.navigateTo("next")
    });
    $(document).on("keydown", function(e) {
        if (e.keyCode == 37) map.navigateTo("prev");
        else if (e.keyCode == 39) map.navigateTo("next")
    })
});
$(function() {
    if (!$("body.page-panel").length || !$("#personal_forms").length) return;
    $("#error_area span").hide();
    $(".panels__settings-switch .form-group select").selectric();
    if (is_mobile_size()) $("#validate_account").length ? $(".footer").appendTo($(".panels__change-user-info")) : $(".footer").appendTo($(".change-email"));

    function ajaxResponseMessage(element) {
        var $element = $(element);
        $(".error_area").not("#error_area").remove();
        var $ajaxMessage = $("#error_area").clone().removeAttr("id").show();
        $element.before($ajaxMessage);
        this.then = function(data) {
            $ajaxMessage.find('span[rel="wait"]').hide();
            if (data.error) $ajaxMessage.find("span").html(data.error);
            if (data.success) {
                if (data.send_email) $ajaxMessage.find('span[rel="success_send"]').show();
                else $ajaxMessage.find('span[rel="success_change"]').show()
            } else if (data.message) {
                $ajaxMessage.find('span[rel="custom_error"]').html(data.message);
                $ajaxMessage.find('span[rel="custom_error"]').show()
            } else {
                $ajaxMessage.find('span[rel="error"]').show()
            }
            setTimeout(function() {
                $ajaxMessage.hide()
            }, 2500)
        }
    }
    if (Hero.infos.no_pachinko_anim == null) {
        $("#personal_forms select[name=pachinko_anim]").val(is_mobile() ? "off" : "on")
    }
    $("#personal_forms select").change(function() {
        var val = $(this).val();
        var name = $(this).attr("name");
        var message = new ajaxResponseMessage($(this).parent());
        var params = {};
        if (name == "hc_confirm") {
            Hero.infos.hc_confirm = val == "off";
            params = {
                class: "Hero",
                action: "tuto_bunny",
                tuto_id: "hc_confirm",
                tuto_val: Hero.infos.hc_confirm ? 1 : 0
            }
        } else if (name == "sound") {
            Hero.infos.nosound = val == "off";
            hh_music.handler().play(!Hero.infos.nosound);
            params = {
                class: "Hero",
                action: "sound"
            }
        } else if (name == "pachinko_anim") {
            Hero.infos.no_pachinko_anim = val == "off";
            params = {
                class: "Hero",
                action: "no_pachinko_anim"
            }
        } else params = {
            class: "Hero",
            action: "save_field",
            field: name,
            value: val
        };
        hh_ajax(params, function(data) {
            message.then(data)
        })
    });

    function changeAjax($element, event) {
        event.preventDefault();
        var message = new ajaxResponseMessage($element.find('[type="submit"]'));
        var params = $element.serializeObject();
        params.module = "Member";
        params.action = $element.attr("id");
        Phoenix.ajax(params, function(data) {
            message.then(data)
        })
    }
    $('#change_password input[type="password"]').attr("value", "");
    $("#change_password, #change_email").submit(function(event) {
        changeAjax($(this), event)
    });
    $(".change_email_password").on("click", function() {
        var type = $(this).data("type");
        var url = $(this).data("url");
        $("#change-" + type + "-iframe").attr("src", url);
        $("#change-" + type + "-iframe").show();
        $("#go_back").css("display", "flex");
        $(".settings-container").hide();
        $("#go_back").on("click", function() {
            goBack("#go_back", "#change-" + type + "-iframe")
        });
        window.addEventListener("message", function(message) {
            if (message.data.action == "change_email") {
                var params = {
                    module: "Member",
                    action: "change_email",
                    email: message.data.new_email,
                    email_change_token: message.data.email_change_token
                };
                Phoenix.ajax(params, function(response) {
                    if (response.error) {
                        goBack("#go_back", "#change-email-iframe");
                        if (HHPopupManager.getLastOpenedPopup() == "popup_message") {
                            HHPopupManager.closeLastOpenedPopup()
                        }
                        popup_message(response.error)
                    }
                })
            }
        })
    });

    function goBack(goBackSelector, selectorToHide) {
        $(selectorToHide).hide();
        $(goBackSelector).hide();
        $(".settings-container").show()
    }
    $("#send_confirm_email").one("click", function() {
        var message = new ajaxResponseMessage(this);
        Phoenix.ajax({
            module: "Member",
            action: "resend_confirm_email"
        }, function(data) {
            message.then({
                success: data.success,
                send_email: true
            })
        })
    });
    var $buttons = $(".subscription button");
    $buttons.click(function() {
        var $button = $(this);
        var type = $button.attr("type");
        var params = {
            subscribe: {
                action: "Subscribe"
            },
            unsubscribe: {
                action: "Unsubscribe"
            }
        };
        var accessID = "";
        if (HH_UNIVERSE == "hentai" || HH_UNIVERSE == "dev_h1") accessID = "js18659b9hb52";
        else if (HH_UNIVERSE == "gay") accessID = "pc228fp0h9c16";
        else {
            alert("Subscription functions not enabled for this game, it's weird that you actually see it.");
            return
        }
        $buttons.prop("disabled", true);
        var message = new ajaxResponseMessage($(".subscription"));
        window.open("/images/favicon.ico", "subcription-target");
        setTimeout(function() {
            var url = "http://www.mailsoft.fr/index.php/lists/" + accessID + "/" + type + "?";
            var $form = $(".subscription form");
            $form.find('input[name="yt0"]').attr("value", params[type].action);
            $form.attr("action", url);
            $form.attr("target", "subcription-target");
            $form.submit();
            $buttons.prop("disabled", false);
            message.then({
                success: true
            })
        }, 300)
    });
    $("#redeem_code_button").click(function() {
        var message = new ajaxResponseMessage($(this).parent());
        loadingAnimation.start();
        var code = $("#redeem_code").val();
        var params = {
            class: "RedeemCode",
            action: "apply",
            code: code
        };
        hh_ajax(params, function(data) {
            loadingAnimation.stop();
            if (data.error) {
                message.then({
                    message: data.error
                });
                return
            }
            Reward.handlePopup(data)
        }, function(data) {
            loadingAnimation.stop();
            message.then({
                message: data
            })
        })
    })
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var REWARD_MODES = {
    UNCLAIMABLE_MODE: "UNCLAIMABLE_MODE",
    CLAIM_MODE: "CLAIM_MODE",
    CLAIMED_MODE: "CLAIMED_MODE"
};

function get_all_tier_rewards() {
    var all_rewards = [];
    for (var i = 0; i < season_tiers.length; i++) {
        var tier_rewards = {};
        var free_reward_data = void 0;
        var pass_reward_data = void 0;
        free_reward_data = season_tiers[i].free_reward.rewards[0];
        pass_reward_data = season_tiers[i].pass_reward.rewards[0];
        tier_rewards.free_reward = free_reward_data;
        tier_rewards.free_reward_picked = season_tiers[i].free_reward_picked != "" ? true : false;
        tier_rewards.pass_reward = pass_reward_data;
        tier_rewards.pass_reward_picked = season_tiers[i].pass_reward_picked != "" ? true : false;
        tier_rewards.is_current = season_tiers[i].is_current;
        tier_rewards.tier = season_tiers[i].tier;
        tier_rewards.mojo_required = season_tiers[i].mojo_required;
        all_rewards.push(tier_rewards)
    }
    return all_rewards
}

function get_initial_preview_reward_data(tier_num) {
    var is_claim = check_if_rewards_to_claim();
    var preview_tier_index = void 0;
    var reward_type = void 0;
    var preview_reward_data = {};
    if (is_claim) {
        for (var i = 0; i < tier_num; i++) {
            var free_is_picked = season_tiers[i].free_reward_picked != "" ? true : false;
            var pass_is_picked = true;
            if (SeasonsFunc.check_seasons_pass_active()) {
                pass_is_picked = season_tiers[i].pass_reward_picked != "" ? true : false
            }
            if (!(free_is_picked && pass_is_picked)) {
                preview_tier_index = i;
                reward_type = !free_is_picked ? "free_reward" : "pass_reward";
                break
            }
        }
        preview_reward_data.reward_data = season_tiers[preview_tier_index][reward_type].rewards[0];
        preview_reward_data.is_picked = false;
        preview_reward_data.is_current = season_tiers[preview_tier_index].is_current;
        preview_reward_data.tier = season_tiers[preview_tier_index].tier;
        preview_reward_data.is_free = reward_type == "free_reward" ? true : false;
        preview_reward_data.mojo_required = season_tiers[preview_tier_index].mojo_required;
        return preview_reward_data
    }
    var reward_mode = void 0;
    if (tier_num > 0) {
        reward_mode = REWARD_MODES.UNCLAIMABLE_MODE
    }
    var new_index = tier_num - 1;
    preview_reward_data.reward_data = season_tiers[new_index].free_reward.rewards[0];
    preview_reward_data.is_picked = true;
    preview_reward_data.is_current = season_tiers[new_index].is_current;
    preview_reward_data.tier = season_tiers[new_index].tier;
    preview_reward_data.is_free = true;
    preview_reward_data.reward_mode = reward_mode;
    preview_reward_data.mojo_required = season_tiers[new_index].mojo_required;
    return preview_reward_data
}

function get_leaderboard_data() {
    return leaderboard_data
}

function get_tier_reward(tier_num) {
    var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "free";
    var index = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    if (type == "free") {
        return season_tiers[tier_num - 1].free_reward.rewards[index]
    } else if (type == "pass") {
        return season_tiers[tier_num - 1].pass_reward.rewards[index]
    }
}

function get_reward_instance(tier_num) {
    var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "free";
    for (var i = 0; i < SeasonsData.rewards_storage.length; i++) {
        var current_pair = SeasonsData.rewards_storage[i];
        if (tier_num == current_pair.get_tier()) {
            if (type == "free") {
                return current_pair.free_reward
            } else {
                return current_pair.pass_reward
            }
        }
    }
}

function is_tier_reward_loot(tier_num) {
    var is_loot = season_tiers[tier_num - 1].loot != "" ? true : false;
    return is_loot
}

function get_current_tier() {
    if (season_tier && !isNaN(season_tier) && season_tier > 0) {
        return season_tier
    } else {
        return 0
    }
}

function get_target_tier() {
    if (season_tier && !isNaN(season_tier) && season_tier > 0) {
        return season_tier + 1
    } else {
        return 0
    }
}

function check_if_rewards_to_claim() {
    var current_tier = get_current_tier();
    for (var i = 0; i < current_tier; i++) {
        var free_reward_picked = season_tiers[i].free_reward_picked != "" ? true : false;
        var pass_reward_picked = season_tiers[i].pass_reward_picked != "" ? true : false;
        var tier = parseInt(season_tiers[i].tier);
        if (!free_reward_picked) {
            return true
        }
        if (season_has_pass) {
            if (!pass_reward_picked) {
                return true
            }
        }
    }
    return false
}

function check_if_rewards_to_claim_internal() {
    var current_tier = get_current_tier();
    for (var i = 0; i < current_tier; i++) {
        var free_reward_picked = SeasonsData.rewards_storage[i].free_reward.get_picked();
        var pass_reward_picked = SeasonsData.rewards_storage[i].pass_reward.get_picked();
        var tier = parseInt(season_tiers[i].tier);
        if (!free_reward_picked) {
            return true
        }
        if (SeasonsFunc.check_seasons_pass_active()) {
            if (!pass_reward_picked) {
                return true
            }
        }
    }
    return false
}
var SeasonsData = {
    scale_factor: 1.2,
    rewards_storage: [],
    seasons_cont: null,
    leaderboard_cont: null,
    rewards_container_1row: null,
    rewards_container_2row: null,
    seasons_btn: null,
    leaderboard_btn: null,
    reward_claim: null,
    ends_in_label: null,
    kisses_bar: null,
    rewards_container: null,
    leaderboard_list: null,
    leaderboard_rows: [],
    ldb_rank_w: "10%",
    ldb_avatar_w: "7%",
    ldb_name_w: "43%",
    ldb_pass_w: "15%",
    ldb_lvl_w: "15%",
    ldb_mojo_w: "10%",
    indicator_class_light: "number_indicator_s",
    indicator_class_dark: "number_indicator_invert_s",
    notification_btn: null,
    close_info_btn: null,
    info_window: null,
    rewards_data: null,
    add_kisses_btn: null,
    tier_ind: null,
    tier_ind_small: null,
    preview_reward_text: null,
    browser: detectBrowser(),
    waiting_reward_data: []
};
var SeasonsFunc = {
    change_tab: function change_tab(event) {
        switch (event.data.id) {
            case "seasons":
                if (SeasonsData.seasons_cont.css("display") == "none") {
                    SeasonsFunc.switch_seasons()
                }
                break;
            case "leaderboard":
                if (SeasonsData.leaderboard_cont.css("display") == "none") {
                    SeasonsFunc.switch_leaderboard()
                }
                break
        }
    },
    switch_seasons: function switch_seasons() {
        SeasonsData.seasons_cont.css({
            display: "block"
        });
        SeasonsData.leaderboard_cont.css({
            display: "none"
        });
        SeasonsData.seasons_btn.addClass("underline");
        SeasonsData.leaderboard_btn.removeClass("underline");
        SeasonsData.leaderboard_btn[0].style.animation = "seasons_scale_fade_out 0.3s forwards";
        SeasonsData.seasons_btn[0].style.animation = "seasons_scale_fade_in 0.3s forwards"
    },
    switch_leaderboard: function switch_leaderboard() {
        SeasonsData.leaderboard_cont.css({
            display: "block"
        });
        SeasonsData.seasons_cont.css({
            display: "none"
        });
        SeasonsData.leaderboard_btn.addClass("underline");
        SeasonsData.seasons_btn.removeClass("underline");
        SeasonsData.leaderboard_btn[0].style.animation = "seasons_scale_fade_in 0.3s forwards";
        SeasonsData.seasons_btn[0].style.animation = "seasons_scale_fade_out 0.3s forwards"
    },
    switch_leaderboard_row: function switch_leaderboard_row(index) {
        for (var i = 0; i < SeasonsData.leaderboard_rows.length; i++) {
            if (SeasonsData.leaderboard_rows[i].index != index) {
                SeasonsData.leaderboard_rows[i].set_inactive()
            }
        }
    },
    build_rewards: function build_rewards(rewards_data) {
        var scale_factor = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
        var reward_pairs_array = [];
        for (var i = 0; i < rewards_data.length; i++) {
            var rewards_pair = new RewardsPair(rewards_data[i].free_reward, rewards_data[i].pass_reward, rewards_data[i].free_reward_picked, rewards_data[i].pass_reward_picked, rewards_data[i].tier, rewards_data[i].mojo_required, get_target_tier(), scale_factor, this.proceed_claimed_reward);
            rewards_pair.initialize_rewards(get_target_tier());
            reward_pairs_array.push(rewards_pair)
        }
        return reward_pairs_array
    },
    place_all_rewards: function place_all_rewards(reward_pairs) {
        var rowItems = reward_pairs.length;
        var container_width = rowItems * reward_pairs[0].get_width();
        SeasonsData.rewards_container_1row.css("width", container_width + "px");
        for (var i = 0; i < reward_pairs.length; i++) {
            reward_pairs[i].add_to_container(SeasonsData.rewards_container_1row)
        }
    },
    init_leaderboard: function init_leaderboard() {
        var leaderboard_data = get_leaderboard_data();
        leaderboard_data.sort(function(item1, item2) {
            return item1.rank - item2.rank
        });
        var is_player_listed = false;
        for (var i = 0; i < leaderboard_data.length; i++) {
            leaderboard_data[i].index = i;
            leaderboard_data[i].click_callback = SeasonsFunc.switch_leaderboard_row;
            var lRow = new LeaderboardRow(leaderboard_data[i]);
            SeasonsData.leaderboard_rows.push(lRow);
            lRow.add_to_container(SeasonsData.leaderboard_list);
            if (leaderboard_data[i].is_hero) {
                is_player_listed = true
            }
        }
        if (!is_player_listed) {
            SeasonsFunc.create_player_row()
        }
    },
    create_player_row: function create_player_row() {
        var leaderboard_data = {};
        leaderboard_data.mojo = season_mojo_s;
        leaderboard_data.level = Hero.infos.level;
        leaderboard_data.tier = get_current_tier();
        leaderboard_data.nickname = Hero.infos.Name;
        leaderboard_data.rank = season_rank;
        leaderboard_data.avatar = $('[rel="avatar"]').first().find("img").attr("src");
        var leaderboard_row_player = new LeaderboardRow(leaderboard_data);
        $(leaderboard_row_player.row_element[0]).css({
            position: "fixed",
            bottom: "30px",
            width: "904px"
        });
        leaderboard_row_player.add_to_container(SeasonsData.leaderboard_list)
    },
    notification_on: function notification_on() {
        SeasonsData.seasons_btn.addClass("season_notif")
    },
    notification_off: function notification_off() {
        SeasonsData.seasons_btn.removeClass("season_notif")
    },
    show_season_pass_button: function show_season_pass_button() {
        SeasonsData.pass_btn_holder.css("display", "block");
        SeasonsFunc.proceed_pass_rewards_claim_text(false)
    },
    hide_season_pass_button: function hide_season_pass_button() {
        SeasonsData.pass_btn_holder.css("display", "none");
        SeasonsFunc.proceed_pass_rewards_claim_text(true)
    },
    check_seasons_pass_active: function check_seasons_pass_active() {
        if (SeasonsData.pass_btn_holder.css("display") == "none") {
            return true
        } else {
            return false
        }
    },
    proceed_pass_rewards_claim_text: function proceed_pass_rewards_claim_text(is_visible) {
        for (var i = 0; i < SeasonsData.rewards_storage.length; i++) {
            SeasonsData.rewards_storage[i].set_claim_text_on_pass_reward(is_visible)
        }
    },
    show_info: function show_info() {
        SeasonsData.info_window.css("display", "block")
    },
    hide_info: function hide_info() {
        SeasonsData.info_window.css("display", "none")
    },
    set_claim_button_mode: function set_claim_button_mode(is_enabled) {
        if (is_enabled) {
            SeasonsData.claim_btn.attr("disabled", false);
            SeasonsData.claim_btn.text(GT.design.season_claim)
        } else {
            SeasonsData.claim_btn.attr("disabled", true);
            SeasonsData.claim_btn.text(GT.design.season_claimed)
        }
    },
    set_claim_button_visible: function set_claim_button_visible(is_visible) {
        if (is_visible) {
            SeasonsData.claim_btn.css("visibility", "visible")
        } else {
            SeasonsFunc.set_claim_button_mode(false);
            SeasonsData.claim_btn.css("visibility", "hidden")
        }
    },
    set_add_kisses_button_mode: function set_add_kisses_button_mode(is_enabled) {
        if (is_enabled) {
            SeasonsData.add_kisses_btn.attr("disabled", false)
        } else {
            SeasonsData.add_kisses_btn.attr("disabled", true)
        }
    },
    set_end_in_text: function set_end_in_text(seconds) {
        var time_str = SeasonsData.ends_in_label.text() + " " + format_time_short(seconds);
        SeasonsData.ends_in_label.text(time_str)
    },
    set_mojo_progress: function set_mojo_progress() {
        var mojo_data = find_mojo_progress(get_current_tier(), season_mojo_s, season_tiers);
        $("#mojo_data").text(mojo_data.text);
        $(".tier_bar.orange_gradient").css("width", mojo_data.progress + "%")
    },
    show_rewards_popup: function show_rewards_popup(r_data) {
        var rewards_data = r_data;
        Reward.handlePopup(rewards_data)
    },
    show_season_end_popup: function show_season_end_popup() {
        var mojo_reset_data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
        var season_reset_data = null;
        if (mojo_reset_data && mojo_reset_data.current_season) {
            season_reset_data = mojo_reset_data
        } else if (season_reset && season_reset.current_season) {
            season_reset_data = season_reset
        }
        if (!season_reset_data) {
            return
        }
        var options = {
            no_close: true,
            prevent_events: true,
            show_over: true,
            custom_data: season_reset_data
        };
        HHPopupManager.show("season_end_popup", options)
    },
    set_notifications: function set_notifications() {
        var internal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
        var is_claim = void 0;
        if (internal) {
            is_claim = check_if_rewards_to_claim_internal()
        } else {
            is_claim = check_if_rewards_to_claim()
        }
        if (is_claim) {
            SeasonsFunc.notification_on()
        } else {
            SeasonsFunc.notification_off()
        }
    },
    claim_current_reward: function claim_current_reward(event) {
        SeasonsFunc.set_claim_button_mode(false);
        var reward_tier = SeasonsData.reward_claim.tier;
        var reward_is_free = SeasonsData.reward_claim.is_free;
        for (var i = 0; i < SeasonsData.waiting_reward_data.length; i++) {
            if (SeasonsData.waiting_reward_data[i].tier == reward_tier && SeasonsData.waiting_reward_data[i].is_free == reward_is_free) {
                return
            }
        }
        SeasonsData.waiting_reward_data.push({
            tier: reward_tier,
            is_free: reward_is_free
        });
        var key_str = reward_is_free ? "free_" : "pass_";
        key_str += reward_tier;
        var ajax_params = {
            class: "Season",
            namespace: "h\\Season",
            action: "claim",
            key: key_str
        };
        hh_ajax(ajax_params, function(data) {
            SeasonsFunc.on_claimed_success(reward_tier, reward_is_free, data.rewards)
        })
    },
    on_claimed_success: function on_claimed_success(tier, is_free, be_reward_data) {
        for (var i = 0; i < SeasonsData.waiting_reward_data.length; i++) {
            if (SeasonsData.waiting_reward_data[i].tier == tier && SeasonsData.waiting_reward_data[i].is_free == is_free) {
                SeasonsData.waiting_reward_data.splice(i, 1);
                break
            }
        }
        var reward_small = SeasonsFunc.get_reward(tier, is_free);
        SeasonsFunc.show_rewards_popup(be_reward_data);
        SeasonsData.reward_claim.set_claimed_mode();
        reward_small.set_claimed_mode();
        SeasonsFunc.set_notifications(true)
    },
    get_reward: function get_reward(tier, is_free) {
        var pair = SeasonsData.rewards_storage[tier - 1];
        if (is_free) {
            return pair.free_reward
        } else {
            return pair.pass_reward
        }
    },
    set_preview_reward: function set_preview_reward(data) {
        if (SeasonsData.reward_claim) {
            SeasonsData.reward_claim.destroy();
            SeasonsData.reward_claim = null
        }
        if (!data) {
            SeasonsFunc.set_claim_button_visible(false);
            SeasonsData.preview_reward_text.text("");
            return
        }
        if (data.is_picked) {
            SeasonsFunc.set_claim_button_mode(false)
        } else {
            SeasonsFunc.set_claim_button_mode(true)
        }
        if (data.reward_mode == REWARD_MODES.UNCLAIMABLE_MODE) {
            SeasonsFunc.set_claim_button_visible(false)
        } else {
            SeasonsFunc.set_claim_button_visible(true)
        }
        if (data.is_free) {
            SeasonsData.preview_reward_text.text(GT.design.season_free_reward)
        } else {
            SeasonsData.preview_reward_text.text(GT.design.season_pass_reward)
        }
        SeasonsData.reward_claim = new RewardSeasons(data.reward_data, data.is_picked, data.tier, season_tier, data.mojo_required, null, 2, false, data.is_free);
        var reward_placeholder = $("#reward_placeholder");
        SeasonsData.reward_claim.add_to_container(reward_placeholder);
        var tier_text = GT.design.season_tier + " " + data.tier;
        SeasonsData.tier_ind.text(tier_text)
    },
    on_seasons_pass_clicked: function on_seasons_pass_clicked() {
        if (GAME_FEATURE_NO_PAYMENT) {
            var price = hh_prices["season_pass"];
            hc_confirm(price, function() {
                var ajax_params = {
                    class: "SeasonPass",
                    namespace: "h\\Season",
                    action: "kobans_buy"
                };
                SeasonsData.season_pass_btn.attr("disabled", true);
                hh_ajax(ajax_params, SeasonsFunc.on_seasons_pass_activated, SeasonsFunc.on_seasons_pass_activation_failed)
            })
        } else {
            HHPopupManager.show("no_HC", {
                init_load: true,
                prevent_events: true,
                desired_tab: "season_pass"
            }, SeasonsFunc.on_seasons_pass_activated)
        }
    },
    on_seasons_pass_activated: function on_seasons_pass_activated() {
        if (GAME_FEATURE_NO_PAYMENT) {
            Hero.update("hard_currency", -hh_prices["season_pass"], true);
            SeasonsFunc.hide_season_pass_button()
        }
        SeasonsFunc.set_notifications(true)
    },
    on_seasons_pass_activation_failed: function on_seasons_pass_activation_failed() {
        SeasonsData.season_pass_btn.attr("disabled", false)
    },
    scroll_rewards: function scroll_rewards(event) {
        var scroll_coef = .25;
        if (SeasonsData.browser == "Firefox") {
            scroll_coef = 5
        }
        var x_scroll_new = SeasonsData.rewards_container[0].scrollLeft + event.deltaY * scroll_coef;
        SeasonsData.rewards_container[0].scrollTo(x_scroll_new, 0)
    },
    seasons_screen_fade_in: function seasons_screen_fade_in() {
        var seasons_tab_container = $("#seasons_tab_container");
        var tabs_switcher = $("#tabs_switcher");
        seasons_tab_container.animate({
            opacity: 1
        }, 350);
        tabs_switcher.animate({
            opacity: 1
        }, 250)
    }
};
$(function() {
    SeasonsData.rewards_container_1row = $("#seasons_row1");
    if (!SeasonsData.rewards_container_1row[0]) {
        return
    }
    SeasonsData.rewards_container_2row = $("#seasons_row2");
    SeasonsData.seasons_cont = $("#seasons_tab_container");
    SeasonsData.leaderboard_cont = $("#leaderboard_tab_container");
    SeasonsData.seasons_btn = $("#seasons_btn");
    SeasonsData.leaderboard_btn = $("#leaderboard_btn");
    SeasonsData.ends_in_label = $("#seasons_tab_sub_title");
    SeasonsData.leaderboard_list = $(".leaderboard_list");
    SeasonsData.pass_btn_holder = $("#gsp_btn_holder");
    SeasonsData.season_pass_btn = $("#get_seasons_pass_btn");
    SeasonsData.kisses_bar = $("#kisses_bar");
    SeasonsData.claim_btn = $("#claim_btn_s");
    SeasonsData.info_window = $("#info_container");
    SeasonsData.notification_btn = $(".button-notification-action.notif_button_s");
    SeasonsData.close_info_btn = $("#close_info");
    SeasonsData.new_kiss_in = $("#info_s");
    SeasonsData.add_kisses_btn = $("#add_kisses");
    SeasonsData.tier_ind = $("#tier_text_s");
    SeasonsData.tier_ind_small = $("#tier_indicator");
    SeasonsData.preview_reward_text = $("#preview_reward_text_s");
    SeasonsData.rewards_container = $("#rewards_cont_scroll");
    if (seasons_images) {
        $.each(["left", "right"], function(index, side) {
            if (!seasons_images.hasOwnProperty(index)) {
                return
            }
            var $girl_preview = $("#" + side + "_girl").attr("src", seasons_images[index]["avatar"].toImageUrl("ava"));
            if (isGirlInCollection(seasons_images[index]["id_girl"], SITTING_GIRLS_AVATARS_IDS)) {
                $girl_preview.css("top", "-70px")
            }
        })
    }
    SeasonsData.seasons_btn.on("click", {
        id: "seasons"
    }, SeasonsFunc.change_tab);
    SeasonsData.leaderboard_btn.on("click", {
        id: "leaderboard"
    }, SeasonsFunc.change_tab);
    SeasonsData.claim_btn.on("click", null, SeasonsFunc.claim_current_reward);
    SeasonsData.notification_btn.on("click", null, SeasonsFunc.show_info);
    SeasonsData.close_info_btn.on("click", null, SeasonsFunc.hide_info);
    SeasonsData.rewards_data = get_all_tier_rewards();
    SeasonsData.rewards_storage = SeasonsFunc.build_rewards(SeasonsData.rewards_data, SeasonsData.scale_factor);
    SeasonsFunc.place_all_rewards(SeasonsData.rewards_storage);
    SeasonsFunc.init_leaderboard();
    SeasonsFunc.switch_seasons();
    SeasonsFunc.set_notifications();
    if (season_has_pass == 0) {
        SeasonsFunc.show_season_pass_button()
    } else {
        SeasonsFunc.hide_season_pass_button()
    }
    SeasonsFunc.set_end_in_text(season_sec_untill_event_end);
    SeasonsData.tier_ind_small.text(season_tier);
    SeasonsFunc.set_mojo_progress();
    SeasonsData.season_pass_btn.on("click", null, SeasonsFunc.on_seasons_pass_clicked);
    var season_pass_value_label = $("#kobans_amount");
    if (season_pass_value_label.length > 0) {
        var value = hh_prices["season_pass"];
        season_pass_value_label.text(value)
    }
    var tier_number = get_current_tier();
    if (tier_number == 0) {
        tier_number = 1
    }
    var fd_data = get_initial_preview_reward_data(tier_number);
    if (fd_data) {
        SeasonsFunc.set_preview_reward(fd_data)
    } else {
        SeasonsFunc.set_preview_reward(null)
    }
    setTimeout(SeasonsFunc.seasons_screen_fade_in, 250);
    document.body.addEventListener("wheel", SeasonsFunc.scroll_rewards);
    var rewardPairWidth = parseFloat(getComputedStyle($(".rewards_pair")[0]).width);
    var scrollOffset = (get_target_tier() - 7) * rewardPairWidth;
    SeasonsData.rewards_container[0].scrollTo(scrollOffset, 0);
    if (season_reset && season_reset.current_season && season_reset.current_season.name) {
        SeasonsFunc.show_season_end_popup()
    }
});

function init_season_arena() {
    SeasonsData.tier_ind_small = $("#tier_indicator");
    SeasonsData.tier_ind_small.text(season_tier);
    SeasonsFunc.set_mojo_progress();
    $(".opponents_arena").on("click", ".btn_season_perform:not(.disabled)", function() {
        if (parseInt(Hero.energies.kiss.amount) <= 0) {
            var options = {
                energy: "kiss",
                sliding: false
            };
            HHPopupManager.show("no_energy_kiss", options)
        } else {
            document.location.href = $(this).attr("href")
        }
    });
    selectSeasonArenaOpponent($(".season_arena_opponent_container").first(), $("#player_defence_stat"));
    $(".opponents_arena").on("click", ".season_arena_opponent_container", function() {
        selectSeasonArenaOpponent($(this), $("#player_defence_stat"))
    });
    if (season_reset && season_reset.current_season && season_reset.current_season.name) {
        SeasonsFunc.show_season_end_popup()
    }
}

function updateDefenceStats($defenceRange, $defenceIcon, newClass, caracs) {
    $defenceIcon.attr("carac", "def" + newClass);
    $defenceRange.text(number_format_lang(caracs["def_carac" + newClass]) + "-" + number_format_lang(caracs["def_carac" + newClass + "_max"]))
}

function selectSeasonArenaOpponent($currentOpponent, $playerContainer) {
    var selectedClass = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "selected_opponent";
    if ($currentOpponent.length > 0) {
        var $playerDefenceRange = $playerContainer.find(".cjs_player_defence_range");
        var $playerDefenceIcon = $playerContainer.find(".cjs_player_defence_icon");
        var playerCaracs = JSON.parse($playerContainer.attr("ca-player-caracs"));
        var opponentStats = JSON.parse($currentOpponent.find(".cjs_opponent_stats").attr("ca-opponent-stats"));
        $("." + selectedClass).removeClass(selectedClass);
        $currentOpponent.addClass(selectedClass);
        $playerContainer.attr("hh_title", GT.design.carac_def.replace("[class]", GT.classes[opponentStats.class]));
        updateDefenceStats($playerDefenceRange, $playerDefenceIcon, opponentStats.class, playerCaracs)
    }
}
var RewardsPair = function() {
    function RewardsPair(free_reward_data, pass_reward_data, free_picked, pass_picked, tier_num, mojo_required, target_tier) {
        var scale_factor = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 1.5;
        var claimed_callback = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : null;
        _classCallCheck(this, RewardsPair);
        this.tier_num = tier_num;
        this.target_tier = target_tier;
        this.parent_container;
        this.claimed_callback = claimed_callback;
        this.create(free_reward_data, pass_reward_data, free_picked, pass_picked, tier_num, mojo_required, scale_factor)
    }
    _createClass(RewardsPair, [{
        key: "create",
        value: function create(free_reward_data, pass_reward_data, free_picked, pass_picked, tier_num, mojo_required) {
            var scale_factor = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 1.5;
            this.tier_num_indicator = $('<div class = "number_indicator_s"></div>');
            this.tier_num_indicator.text(tier_num);
            this.rp_container = $('<div class = "rewards_pair"></div>');
            this.free_reward = new RewardSeasons(free_reward_data, free_picked, this.tier_num, this.target_tier, mojo_required, this.claimed_callback, scale_factor, true, true);
            this.pass_reward = new RewardSeasons(pass_reward_data, pass_picked, this.tier_num, this.target_tier, mojo_required, this.claimed_callback, scale_factor, true, false);
            this.free_reward.add_to_container(this.rp_container);
            this.pass_reward.add_to_container(this.rp_container);
            this.rp_container.append(this.tier_num_indicator);
            this.rp_container.css("width", this.get_width() + "px")
        }
    }, {
        key: "add_to_container",
        value: function add_to_container(parent_container) {
            if (this.rp_container[0].parentElement != parent_container) {
                this.parent_container = $(parent_container);
                this.parent_container.append(this.rp_container)
            }
        }
    }, {
        key: "get_width",
        value: function get_width() {
            return this.free_reward.get_width()
        }
    }, {
        key: "get_tier",
        value: function get_tier() {
            return this.tier_num
        }
    }, {
        key: "set_indicator_clicked",
        value: function set_indicator_clicked() {
            set_indicator_class(SeasonsData.indicator_class_dark)
        }
    }, {
        key: "set_indicator_unclicked",
        value: function set_indicator_unclicked() {
            set_indicator_class(SeasonsData.indicator_class_light)
        }
    }, {
        key: "set_indicator_class",
        value: function set_indicator_class(ind_class) {
            this.tier_num_indicator.removeClass();
            this.tier_num_indicator.addClass(ind_class)
        }
    }, {
        key: "initialize_rewards",
        value: function initialize_rewards(target_tier) {
            if (this.tier_num < target_tier) {
                this.tier_num_indicator.removeClass();
                this.tier_num_indicator.addClass("number_indicator_s number_indicator_darker")
            } else if (this.tier_num == target_tier) {
                this.tier_num_indicator.removeClass();
                this.tier_num_indicator.addClass("number_indicator_s number_indicator_s brighter")
            } else if (this.tier_num > target_tier) {
                this.tier_num_indicator.removeClass();
                this.tier_num_indicator.addClass("number_indicator_invert_s")
            }
        }
    }, {
        key: "set_claim_text_on_pass_reward",
        value: function set_claim_text_on_pass_reward(is_visible) {
            this.pass_reward.set_claim_text(is_visible)
        }
    }, {
        key: "claim_reward",
        value: function claim_reward() {
            var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "free";
            if (type == "free") {
                this.free_reward.claim_reward()
            } else if (type == "pass") {
                this.pass_reward.claim_reward()
            }
        }
    }]);
    return RewardsPair
}();
var RewardSeasons = function() {
    function RewardSeasons(reward_data, is_picked, tier, target_tier, mojo_required) {
        var claimed_callback = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;
        var scale_factor = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 1;
        var interaction = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : true;
        var is_free = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : true;
        _classCallCheck(this, RewardSeasons);
        this.reward_data = reward_data;
        this.is_picked = is_picked;
        this.tier = tier;
        this.target_tier = target_tier;
        this.claimed_callback = claimed_callback;
        this.scale_factor = scale_factor;
        this.interaction = interaction;
        this.is_free = is_free;
        this.is_current = reward_data.is_current;
        this.mojo_required = mojo_required;
        this.reward_mode;
        this.margin = 40 * scale_factor * 1.5 * .3;
        this.reward_element;
        this.parent_container;
        this.on_click = this.on_click.bind(this);
        this.set_claimed_mode = this.set_claimed_mode.bind(this);
        this.create(this.reward_data);
        this.set_mode_and_view()
    }
    _createClass(RewardSeasons, [{
        key: "create",
        value: function create(reward_data) {
            var type = reward_data.type,
                value = reward_data.value,
                slot_class = reward_data.slot_class,
                currency = reward_data.currency,
                ico = reward_data.ico,
                rarity = reward_data.rarity,
                name = reward_data.name,
                previous_value = reward_data.previous_value,
                display = reward_data.display;
            slot_class = slot_class ? "slot" : false;
            currency = currency ? 'cur="' + type + '"' : "";
            this.reward_element = $('<div class= "reward_wrapper_s"></div>');
            var r_html = void 0;
            if (type == "girl_shards") {
                r_html = RewardsBuilder.buildShardsSlot(reward_data, value - previous_value, {
                    "additional-tooltip-info": {
                        mojo_required: this.mojo_required,
                        tier: this.tier,
                        scale: this.scale_factor
                    }
                })
            } else {
                r_html = RewardsBuilder.buildSlot(reward_data, {
                    "additional-tooltip-info": {
                        mojo_required: this.mojo_required,
                        tier: this.tier,
                        scale: this.scale_factor
                    }
                })
            }
            this.reward_element.append(r_html);
            this.white_frame = $('<div class = "frame_white_s"/>');
            this.hover_frame = $('<div class = "frame_violet_s"/>');
            this.passed_tier_frame = $('<div class = "frame_violet_big_s"/>');
            this.passed_tier_frame.css("display", "none");
            this.target_tier_frame = $('<div class = "frame_yellow_s" style= "z-index: 2000;"/>');
            this.target_tier_frame.css("display", "none");
            this.claim_text = $('<div class= "claim_text">' + GT.design.season_claim + "</div>");
            if (this.is_free) {
                this.claim_text.css("top", "-35%")
            }
            this.darker_frame = $('<div class = "frame_dark_s"/>');
            this.darker_frame.css("display", "none");
            this.tick = $('<img class = "tick_s" src = "' + IMAGES_URL + '/clubs/ic_Tick.png"/>');
            this.tick.css("display", "none");
            this.white_frame.insertBefore(this.reward_element.find(".slot, .shards_girl_ico"));
            if (this.interaction) {
                this.passed_tier_frame.insertBefore(this.reward_element.find(".frame_white_s"));
                this.passed_tier_frame.append(this.claim_text);
                this.reward_element.append(this.target_tier_frame);
                this.reward_element.append(this.tick);
                this.reward_element.append(this.hover_frame);
                this.reward_element.on("click", {
                    tier: this.tier
                }, this.on_click)
            }
            this.reward_element.append(this.darker_frame);
            var margin_str = this.margin;
            var margin_bottom = this.margin * .3;
            if (!this.interaction) {
                margin_str = 5;
                margin_bottom = ""
            }
            this.reward_element.css({
                transform: "scale(" + this.scale_factor + ")",
                margin: margin_str + "px",
                "margin-left": margin_str * .73 + "px"
            });
            if (this.is_free) {
                this.reward_element.css({
                    "margin-bottom": margin_bottom + "px"
                })
            }
            var spanTag = this.reward_element.find("span");
            if (spanTag) {
                spanTag.css({
                    "border-radius": "5px"
                })
            }
        }
    }, {
        key: "add_to_container",
        value: function add_to_container(parent_container) {
            if (this.reward_element[0].parentElement != parent_container) {
                this.parent_container = $(parent_container);
                this.parent_container.append(this.reward_element)
            }
        }
    }, {
        key: "add_to_container_before",
        value: function add_to_container_before(parent_container, element_before_id) {
            if (this.reward_element[0].parentElement != parent_container) {
                this.parent_container = $(parent_container);
                var element_before = this.parent_container.find("#" + element_before_id);
                this.reward_element.insertBefore(element_before)
            }
        }
    }, {
        key: "set_mode_and_view",
        value: function set_mode_and_view() {
            if (this.tier == this.target_tier) {
                this.set_target_tier_view();
                this.set_unclaimable_mode()
            } else if (this.tier < this.target_tier) {
                this.set_passed_tier_view();
                if (!this.is_picked) {
                    this.set_claim_mode()
                } else {
                    this.set_claimed_mode()
                }
            } else if (this.tier > this.target_tier) {
                this.set_higher_tier_view();
                this.set_unclaimable_mode()
            }
        }
    }, {
        key: "get_reward_data",
        value: function get_reward_data() {
            return this.reward_data
        }
    }, {
        key: "set_claim_mode",
        value: function set_claim_mode() {
            this.reward_mode = REWARD_MODES.CLAIM_MODE;
            this.claim_text.css("display", "block");
            this.tick.css("display", "none");
            this.darker_frame.css("display", "none");
            this.is_picked = false
        }
    }, {
        key: "set_claimed_mode",
        value: function set_claimed_mode() {
            this.reward_mode = REWARD_MODES.CLAIMED_MODE;
            this.claim_text.css("display", "none");
            this.tick.css("display", "block");
            this.darker_frame.css("display", "block");
            this.is_picked = true
        }
    }, {
        key: "set_unclaimable_mode",
        value: function set_unclaimable_mode() {
            this.reward_mode = REWARD_MODES.UNCLAIMABLE_MODE;
            this.darker_frame.css("display", "block")
        }
    }, {
        key: "set_higher_tier_view",
        value: function set_higher_tier_view() {
            this.claim_text.css("display", "none");
            this.tick.css("display", "none");
            this.darker_frame.css("display", "block");
            this.passed_tier_frame.css("display", "none");
            this.target_tier_frame.css("display", "none");
            this.hover_frame.css("display", "block")
        }
    }, {
        key: "set_target_tier_view",
        value: function set_target_tier_view() {
            this.target_tier_frame.css("display", "block");
            this.claim_text.css("display", "none");
            this.tick.css("display", "none");
            this.darker_frame.css("display", "block");
            this.passed_tier_frame.css("display", "none");
            this.hover_frame.css("display", "block")
        }
    }, {
        key: "set_passed_tier_view",
        value: function set_passed_tier_view() {
            this.target_tier_frame.css("display", "none");
            this.claim_text.css("display", "none");
            this.tick.css("display", "none");
            this.darker_frame.css("display", "none");
            this.passed_tier_frame.css("display", "block");
            this.hover_frame.css("display", "block")
        }
    }, {
        key: "set_claim_text",
        value: function set_claim_text(is_visible) {
            if (is_visible && !this.is_picked) {
                this.claim_text.css("display", "block")
            } else {
                this.claim_text.css("display", "none")
            }
        }
    }, {
        key: "get_picked",
        value: function get_picked() {
            return this.is_picked
        }
    }, {
        key: "on_click",
        value: function on_click(event) {
            var reward_info = {
                reward_data: this.reward_data,
                is_picked: this.is_picked,
                tier: this.tier,
                target_tier: this.target_tier,
                mojo_required: this.mojo_required,
                claimed_callback: this.claimed_callback,
                scale_factor: this.scale_factor,
                is_free: this.is_free,
                reward_mode: this.reward_mode
            };
            SeasonsFunc.set_preview_reward(reward_info)
        }
    }, {
        key: "destroy",
        value: function destroy() {
            this.reward_element.remove()
        }
    }, {
        key: "get_width",
        value: function get_width() {
            return 40 * this.scale_factor + this.margin
        }
    }]);
    return RewardSeasons
}();
var LeaderboardRow = function() {
    function LeaderboardRow(leaderboard_data) {
        _classCallCheck(this, LeaderboardRow);
        this.rank = leaderboard_data.rank;
        this.avatar_url = leaderboard_data.avatar;
        this.name = leaderboard_data.nickname;
        this.pass_tier = leaderboard_data.tier;
        this.lvl = leaderboard_data.level;
        this.mojo = leaderboard_data.mojo;
        this.is_hero = leaderboard_data.is_hero != "" ? true : false;
        this.index = leaderboard_data.index;
        this.click_callback = leaderboard_data.click_callback;
        this.row_element;
        this.parent_container;
        this.on_click = this.on_click.bind(this);
        this.create()
    }
    _createClass(LeaderboardRow, [{
        key: "add_to_container",
        value: function add_to_container(parent_container) {
            if (this.row_element[0].parentElement != parent_container) {
                this.parent_container = $(parent_container);
                this.parent_container.append(this.row_element)
            }
        }
    }, {
        key: "create",
        value: function create() {
            this.row_element = $('<div class = "leaderboard_row">\n                                <div style = "width: ' + SeasonsData.ldb_rank_w + '">' + this.rank + '</div>\n                                <div  style = "width: ' + SeasonsData.ldb_avatar_w + ';">\n                                    <div class = "square-avatar-wrapper" style = "transform: translateY(-4px)">\n                                        <img src = "' + this.avatar_url + '"></img>\n                                    </div>\n                                </div>\n                                <div style = "width: ' + SeasonsData.ldb_name_w + '">' + this.name + '</div>\n                                <div style = "width: ' + SeasonsData.ldb_pass_w + '">' + this.pass_tier + '</div>\n                                <div style = "width: ' + SeasonsData.ldb_lvl_w + '">' + this.lvl + '</div>\n                                <div style = "width: ' + SeasonsData.ldb_mojo_w + '">' + this.mojo + "</div>\n                              </div>");
            this.row_element.on("click", {
                id: this.rank
            }, this.on_click);
            if (this.is_hero) {
                this.set_own()
            }
        }
    }, {
        key: "on_click",
        value: function on_click(event) {
            this.set_active();
            if (this.click_callback) {
                this.click_callback(this.index)
            }
        }
    }, {
        key: "set_own",
        value: function set_own() {
            this.row_element.css("color", "#2296e4")
        }
    }, {
        key: "set_normal",
        value: function set_normal() {
            this.row_element.css("color", "white")
        }
    }, {
        key: "set_active",
        value: function set_active() {
            this.row_element.addClass("leaderboard_row_active")
        }
    }, {
        key: "set_inactive",
        value: function set_inactive() {
            this.row_element.removeClass("leaderboard_row_active")
        }
    }]);
    return LeaderboardRow
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var Girl = function() {
    function Girl(girlData) {
        _classCallCheck(this, Girl);
        this.gData = girlData;
        this.gId = girlData.id_girl;
        this.readyForCollect = girlData.pay_in <= 0;
        this._noDoubleClick = false;
        this._hoverTimerInterval = 0;
        if (!this.readyForCollect) {
            this._updateSalaryTimerTxt();
            this.updateSalaryTimerBar()
        }
        this.returnToUpdateCallback = null
    }
    _createClass(Girl, [{
        key: "showInRight",
        value: function showInRight() {
            var $right = this._getRight();
            if (!is_mobile()) $right.find(".girl_infos_area").niceScroll({
                horizrailenabled: false
            });
            $("#harem_left>.girls_list [girl].opened").removeClass("opened");
            $('#harem_left>.girls_list [girl="' + this.gId + '"]').addClass("opened");
            $("#harem_right>.opened").remove();
            history.pushState({
                girl: this.gId
            }, "", "/harem/" + this.gId);
            window.onpopstate = function(event) {
                if (event.state && event.state.girl) girls[event.state.girl].showInRight()
            };
            var body = this._buildRightPartBody();
            $("#harem_right").append(body);
            if (!is_mobile()) $("#harem_right>.opened .girl_infos_area").niceScroll({
                horizrailenabled: false
            });
            if (this.gData.ref.variations.length > 4) {
                $("#harem_right .opened .missing_girl .push_down_variation_block").css("overflow-y", "auto");
                $("#harem_right .opened .missing_girl .push_down_variation_block").niceScroll({
                    horizrailenabled: false
                })
            }
            appear_anim.appear_all()
        }
    }, {
        key: "_getLeft",
        value: function _getLeft() {
            return $('#harem_left>.girls_list div[girl="' + this.gId + '"]')
        }
    }, {
        key: "_getRight",
        value: function _getRight() {
            return $('#harem_right>[girl="' + this.gId + '"]')
        }
    }, {
        key: "_buildRightPartBody",
        value: function _buildRightPartBody() {
            this.nb_grades = parseInt(this.gData.nb_grades, 10);
            var body = "";
            body += '<div girl="' + this.gId + '" class="opened">';
            body += this.gData.own ? this._buildBodyOwnedGirl() : this._buildBodyNotOwnedGirl();
            body += "</div>";
            return body
        }
    }, {
        key: "_buildBodyNotOwnedGirl",
        value: function _buildBodyNotOwnedGirl() {
            var body = "";
            var linkAttribute = this._getGirlLinkIfAvailable();
            var isActiveEvent = this.gData.source_selector[0] == "event" && this.gData.source_selector[3] == "active";
            var eventTimer = "";
            if (isActiveEvent) {
                eventTimer = '<p class="event-timer-end">\n\t\t\t\t\t\t     ' + GT.design.contests_ends_in + ': <span rel="event-timer"></span>\n\t\t\t\t\t\t</p>'
            }
            var girlSentence = this.gData.source_sentence;
            if (isActiveEvent && this.gData.source_selector[2] == "mission") {
                if (eventWidgetClass.mission_data.done_missions_count >= eventWidgetClass.mission_data.need_done) {
                    girlSentence = eventWidgetClass.getMissionsWaitText()
                } else {
                    girlSentence = eventWidgetClass.getMissionsText()
                }
            }
            body += this._buildDatingTokensInfo(true);
            girlSentence = girlSentence.replace("[leagues]", '<i><a href="/tower-of-fame.html">' + GT.design.leagues_name + "</a></i>").replace("[seasons]", '<i><a href="/season-arena.html">' + GT.design.Seasons + "</a></i>");
            body += '<div class="middle_part missing_girl">\n\t\t\t\t\t<div class="dialog-box" ' + linkAttribute + ">\n\t\t\t\t\t\t<p>" + girlSentence + "</p>\n\t\t\t\t\t\t" + eventTimer + '\n\t\t\t\t\t</div>\n\t\t\t\t\t<img src="' + this.gData.avatar.toImageUrl("avb") + '" class="avatar" style="height: 395px;"/>';
            body += this._buildHTMLGirlVariants();
            body += "</div>";
            var shards = this.gData.shards || 0;
            if (shards) {
                body += '<div class="missing_girl_content">';
                if (this.gData.dating_tokens_required && this.gData.dating_tokens_required > 0) {
                    body += '<div class="dating_info_container">\n\t\t\t\t\t\t\t<p>' + GT.design.dating_help_text + "</p>\n\t\t\t\t\t\t</div>";
                    body += '<div class="dating_container">\n\t\t\t\t\t\t\t<button ' + (total_dating_tokens < this.gData.dating_tokens_required ? "disabled" : "") + ' id="date-button" data-id-girl="' + this.gData.id_girl + '" class="green_button_L redesign">\n\t\t\t\t\t\t\t\t<div class="dating_button_content">\n\t\t\t\t\t\t\t\t\t' + GT.design.Date + '\n\t\t\t\t\t\t\t\t\t<div class="dating_tokens_required">\n\t\t\t\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design/ic_DatingTokens.png">\n\t\t\t\t\t\t\t\t\t\t' + this.gData.dating_tokens_required + "\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>"
                }
                body += "</div>"
            }
            return body
        }
    }, {
        key: "_getGirlLinkIfAvailable",
        value: function _getGirlLinkIfAvailable(girl_datas) {
            girl_datas = girl_datas || this.gData;
            var sourceSelector = girl_datas.source_selector;
            var trollWorld = sourceSelector[0] == "event" ? sourceSelector[5] : sourceSelector[1];
            var hasReachedGirlWorld = Hero.infos.questing.id_world >= trollWorld;
            var link = "";
            if (sourceSelector[2] == "troll" && hasReachedGirlWorld) link = "/battle.html?id_troll=" + sourceSelector[3];
            else if (sourceSelector[0] == "world" && hasReachedGirlWorld) link = "/world/" + sourceSelector[1];
            else if (sourceSelector[0] == "pachinko" || sourceSelector[0] == "event" && sourceSelector[2] == "pachinko") link = "/pachinko.html";
            else if (sourceSelector[0] == "event" && sourceSelector[2] == "mission") link = "/activities.html?tab=missions";
            else if (sourceSelector[0] == "champion" && sourceSelector[1]) link = "/champions/" + sourceSelector[1];
            else if (sourceSelector[0] == "club_champion" && sourceSelector[1]) link = "/clubs.html";
            else if (sourceSelector[0] == "places_of_power") link = "/activities.html?tab=pop";
            else if (sourceSelector[0] == "season" && sourceSelector[1]) link = "/season.html";
            if (link) {
                return 'data-link="' + link + '"'
            }
            return ""
        }
    }, {
        key: "_buildBodyOwnedGirl",
        value: function _buildBodyOwnedGirl() {
            var body = "";
            body += this._buildLeftSliderHTML();
            body += this._buildRightExpandedInfoHTML();
            return body
        }
    }, {
        key: "_buildLeftSliderHTML",
        value: function _buildLeftSliderHTML() {
            var _this = this;
            var body = "";
            body += '<div class="middle_part">';
            var show_full_name = this.gData.graded >= 2 || this.gData.graded == this.gData.nb_grades;
            var attributes = show_full_name && this.gData.first_time_info ? 'class="new-information" style="display: none;"' : "";
            var girlName = show_full_name ? this.gData.ref.full_name : this.gData.Name;
            var girlClass = function girlClass() {
                var hide = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
                return '<span carac="class' + _this.gData.class + '" ' + (hide == true ? 'style="display:none;"' : "") + "></span>"
            };
            body += "<h3 " + attributes + ">" + girlName + girlClass() + "</h3>";
            var rarity = this.gData.rarity;
            var appearAva = this.gData.first_time_info ? "appear" : "";
            var avatarSrc = this.gData.avatar;
            body += '<p class="girl-rarity ' + rarity + '">' + girlClass(true) + " " + GT.design["girls_rarity_" + rarity] + '</p>\n\t\t\t\t<div class="avatar-box">\n\t\t\t\t\t<img src="' + avatarSrc.toImageUrl("ava") + '" class="avatar" ' + appearAva + " />";
            if (this.gData.first_time_info) body += '<img src="' + this.gData.avatar_old.toImageUrl("ava") + '" class="avatar" unappear />';
            body += "</div>";
            if (this.gData.first_time_info) this.gData.first_time_info = false;
            var pgg = "undefined" !== typeof this.gData.fav_graded && this.gData.fav_graded != "-1" ? this.gData.fav_graded : this.gData.graded;
            pgg = parseInt(pgg, 10);
            if (!guest_mode) {
                body += '<div class="diamond-bar">';
                for (var i = 0; i < this.nb_grades + 1; i++) {
                    var selected = pgg === i ? "selected" : "";
                    var locked = 0 < i && i > this.gData.graded ? "locked" : "unlocked";
                    body += '<div class="diamond ' + selected + " " + locked + '" grade="' + i + '"></div>'
                }
                body += "</div>"
            }
            body += "</div>";
            return body
        }
    }, {
        key: "_buildRightExpandedInfoHTML",
        value: function _buildRightExpandedInfoHTML() {
            var body = "";
            body += '<div class="girl_infos_area" style="overflow-x:hidden">';
            body += this._buildDatingTokensInfo(false);
            body += '\t<div class="mobile-tab-harem-girl dark_subpanel_box ">\n\t\t\t\t\t\t<ul class="tab-head" data="module-tab-system-harem">\n\t\t\t\t\t\t\t<li data="stats" activate="true">' + GT.design.haremdex_stats + '</li>\n\t\t\t\t\t\t\t<li data="bio" activate="false">' + GT.design.haremdex_bio + '</li>\n\t\t\t\t\t\t\t<li data="variants" activate="false">' + GT.design.haremdex_short_variants + '</li>\n\t\t\t\t\t\t</ul>\n\n\t\t\t\t\t\t<div class="tab-body">\n\t\t\t\t\t\t\t<div tab-data="stats" display-content data-placeholder></div>\n\t\t\t\t\t\t\t<div tab-data="bio" data-placeholder></div>\n\t\t\t\t\t\t\t<div tab-data="variants" data-placeholder></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>';
            body += this._buildExperienceBlockHTML();
            body += this._buildAffectionBlockHTML();
            var incomePerHour = number_format_lang(this.gData.salary_per_hour) + "/" + GT.time.h;
            body += '<div class="girl_line" data-block="income">\n\t\t\t\t\t<h4 class="revenue-title">\n\t\t\t\t\t\t' + GT.design.haremdex_income + ':<span class="salary" cur="soft_currency"> ' + incomePerHour + "</span>\n\t\t\t\t\t</h4>\n\t\t\t\t</div>";
            body += this._buildStatsBlockHTML();
            body += this._buildBiographyBlockHTML();
            body += this._buildHTMLGirlVariants();
            body += "</div>";
            return body
        }
    }, {
        key: "_buildExperienceBlockHTML",
        value: function _buildExperienceBlockHTML() {
            var experienceBlock = "";
            if (this.gData.Xp.maxed === true) experienceBlock += '<a class="grey_text_button">' + GT.design.Maxed + "</a>";
            else {
                experienceBlock += '<div class="girl_bar bar-wrap">\n\t\t\t\t\t\t\t\t\t<div class="bar" style="width: ' + Math.round(100 * this.gData.Xp.ratio) + '%"></div>\n\t\t\t\t\t\t\t\t</div>';
                if (this.gData.level < HH_MAX_LEVEL) {
                    experienceBlock += '<plus shop="potion"><span class="hudPlus_mix_icn"></span></plus>\n\t\t\t\t\t\t\t\t\t<div class="girl_exp_left">' + GT.design.points_left + ": " + this.gData.Xp.left + "</div>"
                }
            }
            var body = "";
            body += '<div class="girl_line" data-block="experience">\n\t\t\t\t\t<div class="girl_subblock">\n\t\t\t\t\t\t<div class="present-block">\n\t\t\t\t\t\t\t<h4>' + GT.design.Experience + ':</h4>\n\t\t\t\t\t\t\t<div class="girl-level">\n\t\t\t\t\t\t\t\t<span class="lvl-style">' + GT.design.Lvl + '</span>\n\t\t\t\t\t\t\t\t<span rel="level">' + this.gData.level + "</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t" + experienceBlock + "\n\t\t\t\t\t</div>\n\t\t\t\t</div>";
            return body
        }
    }, {
        key: "_buildAffectionBlockHTML",
        value: function _buildAffectionBlockHTML() {
            var girlQuests = "";
            for (var i = 1; i <= this.nb_grades; i++) {
                var quest = this.gData.quests[i];
                if (quest["status"] == "done") {
                    girlQuests += '<a href="' + quest["url"] + '" title="' + quest["Name"] + '" class="done">\n\t\t\t\t\t\t\t\t\t<g></g>\n\t\t\t\t\t\t\t\t</a>'
                } else {
                    girlQuests += '<a class="later" title="' + quest["Name"] + '">\n\t\t\t\t\t\t\t\t\t<g class="grey"></g>\n\t\t\t\t\t\t\t\t</a>'
                }
            }
            var upgradeButton = "";
            if (this.gData.Affection.maxed === true) upgradeButton += '<a class="grey_text_button red">' + GT.design.Maxed + "</a>";
            else {
                var barPercentage = Math.round(100 * this.gData.Affection.ratio);
                var upgradeBar = this.gData.can_upgrade ? '<p class="upgrade_star">' + GT.design.upgrade + "</p>" : '<div class="bar red" style="width:' + barPercentage + '%"></div>';
                upgradeButton += '<div class="girl_bar bar-wrap">\n\t\t\t\t\t\t\t\t' + upgradeBar + "\n\t\t\t\t\t\t\t</div>";
                var affectionLeftText = GT.design.points_left + ": " + number_format_lang(this.gData.Affection.left);
                var style = this.gData.can_upgrade ? 'style="display: none"' : "";
                upgradeButton += '<div class="girl_exp_left"' + style + ">" + affectionLeftText + "</div>"
            }
            if (this.gData.Affection.maxed === false && this.gData.can_upgrade === false) upgradeButton += '<plus shop="gift"><span class="hudPlus_mix_icn"></span></plus>';
            else if (this.gData.can_upgrade) {
                upgradeButton += '<a class="upgrade_girl green_circular_btn" href="' + this.gData.quests.for_upgrade.url + '">\n\t\t\t\t\t\t\t\t<span class="upgrade-icon"></span>\n\t\t\t\t\t\t\t</a>'
            }
            var body = "";
            body += '<div class="girl_line" data-block="affection">\n\t\t\t\t\t<div class="girl_subblock">\n\t\t\t\t\t\t<div class="present-block">\n\t\t\t\t\t\t\t<h4>' + GT.design.Affection + ':</h4>\n\t\t\t\t\t\t\t<div class="girl_quests ' + (this.nb_grades > 5 ? "more_stars" : "less_stars") + '">' + girlQuests + "</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t" + upgradeButton + "\n\t\t\t\t\t</div>\n\t\t\t\t</div>";
            return body
        }
    }, {
        key: "_buildStatsBlockHTML",
        value: function _buildStatsBlockHTML() {
            var caracs = "";
            for (var i = 1; i <= 3; i++) {
                var caracValue = this.gData["caracs"]["carac" + i];
                caracs += '\n\t\t\t<div class="carac_girl">\n\t\t\t\t<div carac="' + i + '">\n\t\t\t\t\t<br/>\n\t\t\t\t\t' + formatGirlCarac(caracValue) + "\n\t\t\t\t</div>\n\t\t\t</div>"
            }
            var body = "";
            body += '<div class="girl_caracs girl_subblock stats_complex" data-block="carac-figure">\n\t\t\t\t\t<h4>' + GT.design.haremdex_stats + ':</h4>\n\t\t\t\t\t<div class="stats_box">\n\t\t\t\t\t\t<div class="girl_pos">\n\t\t\t\t\t\t\t<img src="' + getBattlePositionImagePath(this.gData.figure) + '" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t' + caracs + "\n\t\t\t\t\t</div>\n\t\t\t\t</div>";
            return body
        }
    }, {
        key: "_buildBiographyBlockHTML",
        value: function _buildBiographyBlockHTML() {
            var girlRef = this.gData.ref;
            var isOneGradeGirl = this.gData.nb_grades == 1;
            var biographyDefinition = [{
                info: girlRef.hair,
                grade: 0,
                getext: GT.design.haremdex_hair_color
            }, {
                info: girlRef.eyes,
                grade: 0,
                getext: GT.design.haremdex_eye_color
            }, {
                info: girlRef.zodiac,
                grade: 0,
                getext: GT.design.haremdex_zodiac_sign
            }, {
                info: girlRef.anniv,
                grade: 3,
                getext: GT.design.haremdex_birthday
            }, {
                info: girlRef.location,
                grade: isOneGradeGirl ? 2 : 1,
                getext: GT.design.haremdex_location
            }, {
                info: girlRef.career,
                grade: isOneGradeGirl ? 2 : 1,
                getext: GT.design.haremdex_carrier
            }, {
                info: girlRef.hobbies.food,
                grade: 2,
                getext: GT.design.haremdex_favorite_food
            }, {
                info: girlRef.hobbies.hobby,
                grade: 3,
                getext: GT.design.haremdex_hobby
            }, {
                info: girlRef.hobbies.fetish,
                grade: 3,
                getext: GT.design.haremdex_fetish
            }, {
                info: girlRef.desc,
                grade: isOneGradeGirl ? 2 : 1,
                getext: "",
                isDescription: true
            }];
            var girlBioProps = "";
            for (var i = 0; i < biographyDefinition.length; i++) {
                if (this.gData.graded >= biographyDefinition[i]["grade"]) {
                    var newGradeAttribute = "";
                    if (this.gData.first_time_info && this.gData.graded == biographyDefinition[i]["grade"]) newGradeAttribute = 'class="new-information" style="display: none;"';
                    var descriptionTitle = biographyDefinition[i]["getext"];
                    var descriptionBodyAttibute = 'class="desc"';
                    if (!biographyDefinition[i].isDescription) {
                        descriptionTitle += ":";
                        descriptionBodyAttibute = ""
                    }
                    girlBioProps += "<li " + newGradeAttribute + '>\n\t\t\t\t\t\t\t\t\t<span class="characteristic">' + descriptionTitle + "</span>\n\t\t\t\t\t\t\t\t\t<span " + descriptionBodyAttibute + ">" + biographyDefinition[i]["info"] + "</span>\n\t\t\t\t\t\t\t\t</li>"
                }
            }
            var body = '<div class="girl_line" data-block="bio">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t' + girlBioProps + "\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>";
            return body
        }
    }, {
        key: "_buildHTMLGirlVariants",
        value: function _buildHTMLGirlVariants() {
            var body = "";
            if (this.gData.ref.variations.length > 1) {
                body += '<div class="variation_block ' + (this.gData.ref.variations.length > 4 ? "push_down_variation_block" : "") + '" data-block="girl-variations" id="variations_girl_component">\n\t\t\t\t\t\t<h4>' + GT.design.haremdex_variations + "</h4>";
                for (var i = 0; i < this.gData.ref.variations.length; i++) {
                    var girl = girlsDataList[this.gData.ref.variations[i]];
                    var shards = girl.shards || 0;
                    var markOpened = girl.id_girl == this.gId ? " mark_open" : "";
                    body += '<div class="big_border' + markOpened + '">';
                    var girlOwnStatus = girl.own ? "you_own" : "is_missing";
                    var girlLevel = "";
                    if (girl.own) girlLevel += '<div class="lvl"><span>' + GT.design.Lvl + "</span> <span>" + girl.level + "</span></div>";
                    body += '<div girl="' + girl.id_girl + '" rarity="' + girl.rarity + '" class="variation_girl ' + girlOwnStatus + '">\n\t\t\t\t\t\t\t\t<img src="' + girl.ico.toImageUrl("ico") + '" class="girl_ava"/>\n\t\t\t\t\t\t\t\t<div class="g_infos">\n\t\t\t\t\t\t\t\t\t' + girlLevel + '\n\t\t\t\t\t\t\t\t\t<div class="graded">' + girl.Graded2 + "</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>"
                }
                for (var _i = 0; _i < 4; _i++) {
                    body += '<div class="flexbox-fix-empty"></div>'
                }
                body += "</div>"
            }
            return body
        }
    }, {
        key: "_buildDatingTokensInfo",
        value: function _buildDatingTokensInfo() {
            var isAbsolutePosition = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
            return '<div id="dating_tokens_container"\n\t\t\t\t\t\tstyle=' + (isAbsolutePosition ? "position:absolute;top:15px;" : "") + '>\n\t\t\t\t\t<div generic-tooltip="<p>' + GT.design.dating_tokens + "</p><p>" + GT.design.dating_help_text + '</p>">\n\t\t\t\t\t\t<span id="dating-tokens-amount">' + total_dating_tokens + '</span>\n\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design/ic_DatingTokens.png">\n\t\t\t\t\t</div>\n\t\t\t\t</div>'
        }
    }, {
        key: "checkSalaryState",
        value: function checkSalaryState() {
            if (!this.gData.own) return;
            this.switchSalaryCollectState(this.gData.pay_in <= 0);
            this._updateSalaryTimerTxt();
            this.updateSalaryTimerBar()
        }
    }, {
        key: "switchSalaryCollectState",
        value: function switchSalaryCollectState(isReady) {
            this._getLeft().find(".salary").toggleClass("loads", !isReady);
            this.readyForCollect = isReady;
            Collect.check_state()
        }
    }, {
        key: "resetSalary",
        value: function resetSalary() {
            this.gData.pay_in = this.gData.pay_time + 60;
            this._resetSalaryDisplay()
        }
    }, {
        key: "_resetSalaryDisplay",
        value: function _resetSalaryDisplay() {
            this.switchSalaryCollectState(false);
            this._updateSalaryTimerTxt();
            this.updateSalaryTimerBar();
            if (this.returnToUpdateCallback) this.returnToUpdateCallback(this.gId)
        }
    }, {
        key: "_updateSalaryTimerTxt",
        value: function _updateSalaryTimerTxt() {
            var $count = this._getLeft().find(".salary").find('[rel="count"]');
            var oldHtml = $count.html();
            var newHtml = format_time_short(this.gData.pay_in);
            if (oldHtml != newHtml) $count.html(newHtml)
        }
    }, {
        key: "updateSalaryTimerBar",
        value: function updateSalaryTimerBar() {
            var percentReloadSalary = 10 + (this.gData.pay_time - this.gData.pay_in) / this.gData.pay_time * 90;
            this._getLeft().find(".bar").css("width", percentReloadSalary + "%")
        }
    }, {
        key: "onSalaryBtnClicked",
        value: function onSalaryBtnClicked(event) {
            var _this2 = this;
            if (this._noDoubleClick) return;
            this._noDoubleClick = true;
            var params = {
                class: "Girl",
                id_girl: this.gId,
                action: "get_salary"
            };
            hh_ajax(params, function(data) {
                _this2.gData.pay_in = data.time + 60;
                _this2._noDoubleClick = false;
                _this2._resetSalaryDisplay();
                Hero.update("soft_currency", data.money, true);
                movingStars(event, "$")
            }, function(err) {
                _this2._noDoubleClick = false;
                _this2._resetSalaryDisplay();
                console.log(err);
                popup_message(err)
            })
        }
    }, {
        key: "initSalaryHover",
        value: function initSalaryHover() {
            var _this3 = this;
            if (this.readyForCollect) return -1;
            this._updateSalaryTimerTxt();
            this._getLeft().find(".salary").find(".over.count").show();
            this._hoverTimerInterval = setInterval(function() {
                _this3._updateSalaryTimerTxt();
                if (_this3.readyForCollect) _this3.clearSalaryHover();
                if (GirlSalaryManager.DEBUG) console.log("timer update", _this3.gData.pay_in)
            }, 1e3);
            return this._hoverTimerInterval
        }
    }, {
        key: "clearSalaryHover",
        value: function clearSalaryHover() {
            clearInterval(this._hoverTimerInterval);
            this._getLeft().find(".salary").find(".over.count").hide()
        }
    }]);
    return Girl
}();
var GirlSalaryManager = {
    girlsMap: {},
    girlsListMin: [],
    girlsListSec: [],
    startedHomepageTimerInfo: {},
    updateMinInterval: 0,
    updateSecInterval: 0,
    hoverIntervals: {},
    minRunningLock: false,
    isMinRunning: false,
    isSecRunning: false,
    is_home: false,
    DEBUG: false,
    init: function init(ownedGirlsMap, is_home) {
        if (Object.keys(this.girlsMap).length) this.reset();
        this.girlsMap = ownedGirlsMap;
        this.is_home = is_home;
        for (var gId in this.girlsMap) {
            var girlObj = this.girlsMap[gId];
            girlObj.checkSalaryState();
            girlObj.returnToUpdateCallback = $.proxy(GirlSalaryManager.returnToUpdatingList, GirlSalaryManager);
            if (girlObj.gData.pay_in > 0) {
                if (girlObj.gData.pay_in < HHTimers.thresholdSec) this.girlsListSec.push(girlObj);
                else this.girlsListMin.push(girlObj)
            }
        }
        var homepageBarList = false;
        if (this.girlsListMin.length > 0) {
            this.initMinTimer();
            if (is_home) homepageBarList = this.girlsListMin
        }
        if (this.girlsListSec.length > 0) {
            this.initSecTimer();
            if (is_home) homepageBarList = this.girlsListSec
        }
        if (homepageBarList) this.initHomepageBar(homepageBarList.sort(function(g, g2) {
            return g.gData.pay_in - g2.gData.pay_in
        }))
    },
    reset: function reset() {
        clearInterval(this.updateSecInterval);
        clearInterval(this.updateMinInterval);
        this.girlsMap = {};
        this.girlsListMin = [];
        this.girlsListSec = [];
        this.updateMinInterval = 0;
        this.updateSecInterval = 0;
        this.hoverIntervals = {};
        this.minRunningLock = false;
        this.isMinRunning = false;
        this.isSecRunning = false;
        this.is_home = false
    },
    returnToUpdatingList: function returnToUpdatingList(gId) {
        var girlObj = this.girlsMap[gId];
        if (girlObj.gData.pay_in < HHTimers.thresholdSec) this.girlsListSec.push(girlObj);
        else this.girlsListMin.push(girlObj);
        if (!this.isMinRunning && this.girlsListMin.length > 0) this.initMinTimer();
        if (!this.isSecRunning && this.girlsListSec.length > 0) this.initSecTimer()
    },
    initMinTimer: function initMinTimer() {
        if (GirlSalaryManager.DEBUG) console.log("initMinTimer");
        this.isMinRunning = true;
        var self = this;
        this.updateMinInterval = setInterval(function() {
            self.updateTimeMin()
        }, 6e4)
    },
    clearMinTimer: function clearMinTimer() {
        clearInterval(this.updateMinInterval);
        this.isMinRunning = false
    },
    initSecTimer: function initSecTimer() {
        if (GirlSalaryManager.DEBUG) console.log("initSecTimer");
        this.isSecRunning = true;
        var self = this;
        this.updateSecInterval = setInterval(function() {
            self.updateTimeSec()
        }, 1e3)
    },
    clearSecTimer: function clearSecTimer() {
        clearInterval(this.updateSecInterval);
        this.isSecRunning = false
    },
    initGirlSalaryHover: function initGirlSalaryHover(gId) {
        this.clearAllHoverIntervals();
        var newHoverInterval = this.girlsMap[gId].initSalaryHover();
        if (newHoverInterval > -1) {
            this.hoverIntervals[gId] = newHoverInterval
        }
    },
    clearGirlSalaryHover: function clearGirlSalaryHover(gId) {
        this.girlsMap[gId].clearSalaryHover();
        if (this.hoverIntervals[gId]) {
            delete this.hoverIntervals[gId]
        }
    },
    clearAllHoverIntervals: function clearAllHoverIntervals() {
        for (var gId in this.hoverIntervals) {
            this.girlsMap[gId].clearSalaryHover()
        }
        this.hoverIntervals = {}
    },
    initHomepageBar: function initHomepageBar(girlsList) {
        var bar = $("#collect_all_bar");
        bar.show();
        this.prepareData(girlsList)
    },
    updateHomepageBar: function updateHomepageBar(girlInfo) {
        var bar = $("#collect_all_bar>.outbar");
        var perc_reload_salary = 10 + (girlInfo.totalTimer - girlInfo.gData.pay_in) / girlInfo.totalTimer * 90;
        bar.find(".bar").css("width", perc_reload_salary + "%")
    },
    updateHomepageText: function updateHomepageText(girlInfo, money) {
        var bar = $("#collect_all_bar");
        var button = $("#collect_all").find(".sum");
        if (girlInfo.gData.pay_in == 1) {
            $("#collect_all").addClass("general_glow");
            setTimeout(function() {
                $("#collect_all").removeClass("general_glow");
                button.text(number_format_lang(parseInt(button.attr("amount"), 10) + money));
                button.attr("amount", parseInt(button.attr("amount"), 10) + money)
            }, 1e3)
        }
        bar.find(".in>span").text(format_time_short(girlInfo.gData.pay_in));
        bar.find(".money>span").text(number_format_lang(money))
    },
    updateHomepageTimer: function updateHomepageTimer() {
        var bar = $("#collect_all_bar");
        if (bar.css("display") == "none") bar.show();
        if (this.girlsListSec.length) this.prepareData(this.girlsListSec);
        else if (this.girlsListMin.length) this.prepareData(this.girlsListMin);
        else bar.hide()
    },
    prepareData: function prepareData(girlsList) {
        var sortedArr = girlsList.sort(function(g, g2) {
            return g.gData.pay_in - g2.gData.pay_in
        });
        var nextGirl = sortedArr[0];
        if (!(Object.keys(this.startedHomepageTimerInfo).length && this.startedHomepageTimerInfo[nextGirl.gId])) {
            this.startedHomepageTimerInfo[nextGirl.gId] = nextGirl.gData.pay_in;
            nextGirl.totalTimer = nextGirl.gData.pay_in
        }
        var nextMoney = sortedArr[0].gData.salary;
        for (var i = 1; i < sortedArr.length; i++) {
            if (sortedArr[0].gData.pay_in == sortedArr[i].gData.pay_in) nextMoney += sortedArr[i].gData.salary;
            else break
        }
        this.updateHomepageBar(nextGirl);
        this.updateHomepageText(nextGirl, nextMoney)
    },
    updateTimeMin: function updateTimeMin() {
        if (GirlSalaryManager.DEBUG) console.log("update MIN");
        this.minRunningLock = true;
        var newMinList = [];
        var length = this.girlsListMin.length;
        for (var i = 0; i < length; i++) {
            var girl = this.girlsListMin[i];
            if (!girl.readyForCollect && girl.gData.pay_in > 0) {
                girl.gData.pay_in -= 60;
                if (girl.gData.pay_in > 0 && girl.gData.pay_in < HHTimers.thresholdSec) this.girlsListSec.push(girl);
                else if (girl.gData.pay_in >= HHTimers.thresholdSec) newMinList.push(girl);
                if (!$("#harem_left .girls_list").hasClass("grid_view")) girl.updateSalaryTimerBar()
            }
            if (!girl.readyForCollect && girl.gData.pay_in <= 0) girl.switchSalaryCollectState(true)
        }
        this.girlsListMin = newMinList;
        if (this.is_home && this.girlsListMin.length) this.updateHomepageTimer();
        if (!this.isSecRunning && this.girlsListSec.length > 0) this.initSecTimer();
        if (this.girlsListMin.length == 0) this.clearMinTimer();
        this.minRunningLock = false
    },
    updateTimeSec: function updateTimeSec() {
        if (GirlSalaryManager.DEBUG) console.log("update SEC len=" + this.girlsListSec.length);
        if (this.minRunningLock) return;
        var newSecList = [];
        var length = this.girlsListSec.length;
        for (var i = 0; i < length; i++) {
            var girl = this.girlsListSec[i];
            if (!girl.readyForCollect && girl.gData.pay_in > 0) {
                girl.gData.pay_in -= 1;
                if (!$("#harem_left .girls_list").hasClass("grid_view")) {
                    if (!(girl.gData.pay_in % 5)) girl.updateSalaryTimerBar()
                }
            }
            if (!girl.readyForCollect && girl.gData.pay_in <= 0) girl.switchSalaryCollectState(true);
            if (girl.gData.pay_in > 0) newSecList.push(girl)
        }
        this.girlsListSec = newSecList;
        if (this.is_home && this.girlsListSec.length) this.updateHomepageTimer();
        if (this.isSecRunning && this.girlsListSec.length == 0) {
            this.clearSecTimer();
            if (this.is_home && this.girlsListMin.length) this.updateHomepageTimer()
        }
    }
};

function select_chosen_girl(id) {
    var girl_element = document.querySelector('div[id_girl="' + id + '"]');
    var girlOffset = girl_element.offsetTop;
    var container = document.querySelector(".girls_list");
    var startOffset = container.scrollTop;
    var offsetAdjustment = 75;
    girlOffset -= offsetAdjustment;
    if (girlOffset == startOffset) {
        return
    }
    var animDuration = 1e3;
    var intervalDuration = 50;
    var length = Math.abs(girlOffset - startOffset);
    var scrollSpeed = Math.round(length / (animDuration / intervalDuration));
    if (scrollSpeed == 0) return;
    var interval;
    var prevOffset;
    var scrollAnim = function scrollAnim() {
        var offset = container.scrollTop;
        if (startOffset > girlOffset) {
            offset -= scrollSpeed;
            if (offset < girlOffset) offset = girlOffset
        } else if (startOffset < girlOffset) {
            offset += scrollSpeed;
            if (offset > girlOffset) offset = girlOffset
        }
        container.scrollTop = offset;
        if (offset == girlOffset || prevOffset == offset) {
            clearInterval(interval)
        }
        prevOffset = offset
    };
    interval = setInterval(scrollAnim, intervalDuration)
}

function filterGirls($girls_wrapper) {
    var filtered = all_possible_girls;
    if ($('input[name="find"]').val()) filtered = hh_filter_girls_list(filtered, "name", $('input[name="find"]').val());
    var $shardsStateActive = $('button.shards-state[shardsstate="active"]');
    if ($shardsStateActive.length) {
        var value = [];
        var min = value[0];
        var max = value[1];
        $shardsStateActive.each(function() {
            if ($(this).hasClass("owned")) {
                min = min ? min : 100;
                max = 100
            }
            if ($(this).hasClass("inprogress")) {
                min = min ? Math.min(min, 1) : 1;
                max = max ? Math.max(max, 99) : 99
            }
            if ($(this).hasClass("notowned")) {
                min = 0;
                max = max ? max : 0
            }
            value = [min, max]
        });
        filtered = hh_filter_girls_list(filtered, "shards", value)
    }
    var $caracActive = $('button.carac-state[caracstate="active"]');
    var activeCaracs = {};
    if (!$caracActive.length) {
        activeCaracs = {
            0: 1,
            1: 2,
            3: 3
        }
    } else {
        $caracActive.each(function(index) {
            activeCaracs[index] = $(this).attr("carac")
        })
    }
    filtered = hh_filter_girls_list(filtered, "class", activeCaracs);
    var figId = parseInt($('select[name="positions"] option:selected').attr("id_figure"), 10);
    if (figId > 0) filtered = hh_filter_girls_list(filtered, "positions", figId);
    var rarity = $('select[name="rarity"]').find("option:selected").attr("value");
    if (rarity != "all") filtered = hh_filter_girls_list(filtered, "rarity", rarity);
    var listType = $('select[name="lists"]').find("option:selected").attr("value");
    if (listType != "all") {
        var secondType = undefined;
        if (listType == "event" || listType == "world") {
            $('select[name="' + listType + '"]').show();
            secondType = $('select[name="' + listType + '"]').find("option:selected").attr("value")
        }
        filtered = hh_filter_girls_list(filtered, listType, secondType)
    }
    hh_show_filtered_girls($girls_wrapper, filtered);
    if (!is_mobile_device()) $(".girls_list").getNiceScroll().resize()
}
var ownedGirls = {};

function toggleFilterBlock(btn) {
    var $btn = btn;
    var $filtering_block = $("#filtering_girls");
    var $middle_part_dex = $("#harem_left");
    var $right_part_dex = $("#harem_right");
    if ($btn.find("span").hasClass("search_open_icn")) {
        $btn.find("span").removeClass("search_open_icn");
        $btn.find("span").addClass("search_close_icn");
        if (!$filtering_block.hasClass("original_position")) {
            $filtering_block.addClass("original_position");
            $middle_part_dex.addClass("original_position");
            $right_part_dex.addClass("original_position")
        }
    } else {
        $btn.find("span").removeClass("search_close_icn");
        $btn.find("span").addClass("search_open_icn");
        if ($filtering_block.hasClass("original_position")) {
            $filtering_block.removeClass("original_position");
            $middle_part_dex.removeClass("original_position");
            $right_part_dex.removeClass("original_position")
        }
    }
}
$(function() {
    if (!$("#harem_whole").length) return;
    var isSafariRegex = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
    if (isSafariRegex) {
        if (!!window.performance && window.performance.navigation.type === 2) {
            reload()
        }
    }
    for (var girlId in girlsDataList) {
        girls[girlId] = new Girl(girlsDataList[girlId]);
        if (girlsDataList[girlId].own) {
            ownedGirls[girlId] = girls[girlId]
        }
    }
    if (!is_mobile_device()) $("#harem_right>.opened .girl_infos_area").niceScroll({
        horizrailenabled: false
    });
    var setting_name = "girls_view";
    var setting_state = localStorageGetItem(setting_name);
    var $girls_view_btn = $("button#change_girls_view");
    var $girls_list_harem = $("#harem_left .girls_list");
    var clickState;
    if (!setting_state || !Tutorial.data.home1) {
        $girls_view_btn.find("span").addClass("nav_grid_icn");
        clickState = false
    } else if (setting_state) {
        clickState = true;
        setViewOnInit(setting_state)
    }

    function setGridView() {
        $(".shards_bar_wrapper").find(".shards").attr("class", "shards small");
        $girls_list_harem.addClass("grid_view");
        $girls_view_btn.find("span").removeClass("nav_grid_icn");
        $girls_view_btn.find("span").addClass("nav_list_icn");
        clickState = true
    }

    function setListView() {
        $(".shards_bar_wrapper").find(".shards").attr("class", "shards");
        $girls_list_harem.removeClass("grid_view");
        $girls_view_btn.find("span").removeClass("nav_list_icn");
        $girls_view_btn.find("span").addClass("nav_grid_icn");
        clickState = false
    }

    function setViewOnInit(state) {
        if (setting_state === "list") setListView();
        else if (setting_state === "grid") setGridView()
    }
    $girls_view_btn.click(function() {
        if (clickState === true) {
            setListView();
            localStorageSetItem(setting_name, "list")
        } else if (clickState === false) {
            setGridView();
            localStorageSetItem(setting_name, "grid")
        }
        $(".girls_list").getNiceScroll().resize();
        var girlID = $("#harem_right div[girl]").first().attr("girl");
        select_chosen_girl(girlID);
        initImageLoadingVariables();
        checkAndLoadVisibleImages()
    });
    var filterButtonSelect = "button#filter_girls";
    $("body").on("click", filterButtonSelect, function() {
        toggleFilterBlock($(this))
    });
    if (!is_mobile_device()) $(".girls_list").niceScroll();
    if ($("div[girl]").hasClass("opened")) $("#harem_right").show();
    else {
        var onLoadGirl = $("#harem_left div[girl]").first().attr("girl");
        girls[onLoadGirl].showInRight()
    }
    var isMobile = is_mobile_device();
    var girlsSelector = "div.girls_list>div[id_girl]>div[girl]";
    $("body").on("click", girlsSelector, function(e) {
        if (is_cheat_click(arguments[0])) return false;
        var gId = $(this).attr("girl");
        var girlObj = girls[gId];
        if (girlObj.gData.own) {
            if (girlObj.readyForCollect) girlObj.onSalaryBtnClicked(e);
            else if (isMobile) GirlSalaryManager.initGirlSalaryHover(gId)
        }
        girlObj.showInRight();
        localStorageSetItem("last_open_girl", gId);
        getHtmlOfGirlInfo();
        assignEventListenersTabs();
        if (girlObj.gData.own === false && girlObj.gData.source_selector[0] == "event" && girlObj.gData.source_selector[3] == "active" && eventWidgetClass.event_data.seconds_until_event_end > 0) {
            HHTimers.initSimpleTimerTxt($('p.event-timer-end span[rel="event-timer"]'), eventWidgetClass.event_data.seconds_until_event_end, "", "")
        }
    });

    function initSalaryDisplay(element) {
        var gId = $(element).attr("girl");
        var girlObj = girls[gId];
        if (girlObj.gData.own) GirlSalaryManager.initGirlSalaryHover(gId)
    }
    if (!isMobile) {
        $("body").on("mouseenter", girlsSelector, function() {
            initSalaryDisplay(this)
        }).on("mouseleave", girlsSelector, function() {
            initSalaryDisplay(this)
        })
    }
    GirlSalaryManager.init(ownedGirls, false);
    var girlVariant = "#variations_girl_component>.big_border>div[girl], .girl-variations>.big_border>div[girl]";
    $("body").on("click", girlVariant, function(e) {
        var girlID = $(this).attr("girl");
        girls[girlID].showInRight();
        getHtmlOfGirlInfo();
        assignEventListenersTabs();
        if (!is_mobile()) $('#harem_left div[girl="' + girlID + '"]').getNiceScroll().resize();
        select_chosen_girl(girlID)
    });
    var selectShopBtn = "plus[shop]";
    $("body").on("click", selectShopBtn, function(e) {
        if (Hero.infos.guest) {
            hh_register()
        } else {
            document.location.href = "/shop.html?type=" + $(this).attr("shop") + "&girl=" + $(this).closest("div[girl]").attr("girl")
        }
    });
    var findMeIn = ".missing_girl .dialog-box[data-link]";
    $("body").on("click", findMeIn, function(e) {
        document.location.href = $(this).attr("data-link")
    });
    $("#harem_whole").on("click", "#date-button", function() {
        var $this = $(this);
        var girlId = $this.data("idGirl");
        $this.prop("disabled", true);
        hh_ajax({
            class: "Girl",
            action: "date",
            id_girl: girlId
        }, function(data) {
            var $heroDatingTokens = $("#dating-tokens-amount");
            var heroDatingTokensAmount = parseInt($heroDatingTokens.text(), 10);
            var datingTokensSubstract = parseInt($(".dating_tokens_required").text(), 10) * -1;
            anim_number($heroDatingTokens, heroDatingTokensAmount, datingTokensSubstract);
            data.rewards.redirectUrl = "/harem/" + girlId;
            Reward.handlePopup(data.rewards)
        })
    });
    var filterGirlsCallback = function filterGirlsCallback() {
        filterGirls("#harem_left>.girls_list");
        initImageLoadingVariables();
        checkAndLoadVisibleImages()
    };
    $('input[name="find"]').on("keyup", filterGirlsCallback);
    $('select[name="lists"], select[name="world"], select[name="event"]').change(function() {
        var option = $(this).find("option:selected").attr("value");
        if (option != "world") {
            $('select[name="world"]').hide()
        }
        if (option != "event") {
            $('select[name="event"]').hide()
        }
        filterGirlsCallback()
    });
    $('select[name="positions"]').change(filterGirlsCallback);
    $('select[name="rarity"]').change(filterGirlsCallback);
    var $buttonShardsState = $("button.shards-state");
    $buttonShardsState.click(function() {
        var element = $(this);
        if (!element.attr("shardsstate")) element.attr("shardsstate", "active");
        else element.removeAttr("shardsstate");
        filterGirlsCallback()
    });
    var $buttonCaracState = $("button.carac-state");
    var positions_select = $("div.girl-figure option");
    $buttonCaracState.click(function() {
        var element = $(this);
        if (!element.attr("caracstate")) {
            element.attr("caracstate", "active")
        } else {
            element.removeAttr("caracstate")
        }
        var selected_class = [];
        $buttonCaracState.each(function() {
            var carac = $(this).attr("carac") && $(this).attr("caracstate");
            if (carac) {
                selected_class.push($(this).attr("carac"))
            }
        });
        if (selected_class.length == 0) {
            $("div.girl-figure .selectric-items li").show()
        } else {
            positions_select.each(function() {
                var option = $(this);
                var class_figure = option.attr("for_class");
                var id_figure = option.attr("id_figure");
                for (var indexs = 1; indexs <= selected_class.length; indexs++) {
                    if (selected_class.indexOf(class_figure) >= 0) {
                        $('div.girl-figure .selectric-items li[data-index="' + id_figure + '"]').show()
                    } else {
                        $('div.girl-figure .selectric-items li[data-index="' + id_figure + '"]').hide()
                    }
                }
            })
        }
        filterGirlsCallback()
    });
    var all_girls_ids = Object.keys(all_possible_girls);
    var girls_list = [];
    for (var i = 0; i < all_girls_ids.length; i++) {
        var $this_element = $('#harem_left div[id_girl="' + all_girls_ids[i] + '"]').html();
        all_possible_girls[all_girls_ids[i]].html = $this_element;
        all_possible_girls[all_girls_ids[i]].id_girl = all_girls_ids[i];
        girls_list[i] = all_possible_girls[all_girls_ids[i]]
    }

    function sortDateAcquired(a, b) {
        if (a.own && b.own) {
            var dateA = new Date(a.date_added).getTime();
            var dateB = new Date(b.date_added).getTime();
            return dateA - dateB
        } else if (a.own && !b.own) return -1;
        else if (!a.own && b.own) return 1;
        else return b.shards - a.shards
    }

    function sortByName(a, b) {
        var nameA = a.name.toUpperCase();
        var nameB = b.name.toUpperCase();
        if (a.own == b.own) {
            if (nameA < nameB) return -1;
            if (nameA > nameB) return 1;
            return 0
        } else if (a.own && !b.own) return -1;
        else if (!a.own && b.own) return 1
    }

    function sortByGrade(a, b) {
        if (a.own && b.own) return b.graded - a.graded;
        else if (a.own && !b.own) return -1;
        else if (!a.own && b.own) return 1
    }
    var storedSort = localStorageGetItem("sort_by");
    if (storedSort == "name") girls_list.sort(sortByName);
    else if (storedSort == "grade") girls_list.sort(sortByGrade);
    else girls_list.sort(sortDateAcquired);
    updateSortedHTML();

    function updateSortedHTML() {
        var oldElements = document.querySelectorAll("#harem_left div[id_girl]");
        for (var _i = 0, len = oldElements.length; _i < len; _i++) {
            var elm = oldElements[_i];
            elm.parentNode.removeChild(elm)
        }
        var htmlToInsert = "";
        for (var n = 0, _len = girls_list.length; n < _len; n++) {
            var _girlId = girls_list[n].id_girl;
            var html = girls_list[n].html;
            htmlToInsert += '<div id_girl="' + _girlId + '"> ' + html + "</div>"
        }
        $("#harem_left>.girls_list").append(htmlToInsert);
        for (var _girlId2 in ownedGirls) {
            ownedGirls[_girlId2].checkSalaryState()
        }
        filterGirlsCallback();
        var girlToLoad = document.location.pathname.split("harem/")[1] || "1";
        select_chosen_girl(girlToLoad);
        girls[girlToLoad].showInRight()
    }

    function loadGirlIconsProgressive(list) {
        var $elm = $(list.shift()),
            imgUrl = $elm.attr("data-src");
        $elm.attr("src", imgUrl.toImageUrl("ico"));
        $elm.on("load", function() {
            $elm.off();
            $elm.removeAttr("data-src");
            $elm.parent().removeClass("rotate_carrot");
            var girlId = $elm.closest("[girl]").attr("girl");
            all_possible_girls[girlId].html = all_possible_girls[girlId].html.replace("data-src", "src");
            if (list.length) {
                loadGirlIconsProgressive(list)
            }
        })
    }

    function loadGirlIcons(list) {
        var listLength = list.length;
        for (var i = 0; i < listLength; i++) {
            var $elm = $(list[i]);
            $elm.parent().addClass("rotate_carrot")
        }
        loadGirlIconsProgressive(list)
    }
    var viewHeight, childHeight, girlScrollableList;

    function initImageLoadingVariables() {
        viewHeight = $(".girls_list").height();
        childHeight = $(".girls_list div[id_girl]").first().height();
        girlScrollableList = $(".girls_list")[0]
    }

    function checkAndLoadVisibleImages() {
        var scrollPos = girlScrollableList.scrollTop;
        var isGridView = $(girlScrollableList).hasClass("grid_view");
        var calculatedChildHeight = isGridView ? childHeight / 4 : childHeight;
        var viewCapacity = Math.ceil(viewHeight / calculatedChildHeight);
        var childIndexStart = Math.floor(scrollPos / calculatedChildHeight);
        var childIndexEnd = childIndexStart + viewCapacity;
        childIndexStart -= isGridView ? 4 : 1;
        childIndexEnd += isGridView ? 4 : 1;
        if (childIndexStart < 0) childIndexStart = 0;
        var images = $(".girls_list div[id_girl]:visible .left img").toArray().slice(childIndexStart, childIndexEnd + 1);
        var imagesLength = images.length;
        var imagesToLoad = [];
        for (var i = 0; i < imagesLength; i++) {
            if (images[i].hasAttribute("data-src") && !$(images[i]).parent().hasClass("rotate_carrot")) imagesToLoad.push(images[i])
        }
        if (imagesToLoad && imagesToLoad.length) loadGirlIcons(imagesToLoad)
    }
    $(".girls_list").on("scroll", function(evt) {
        checkAndLoadVisibleImages()
    });
    $('select[name="sort_by"]').change(function() {
        var sel = $(this).attr("name");
        var option = $(this).val();
        if (option == "grade") {
            girls_list.sort(sortByGrade);
            updateSortedHTML()
        } else if (option == "name") {
            girls_list.sort(sortByName);
            updateSortedHTML()
        } else {
            girls_list.sort(sortDateAcquired);
            updateSortedHTML()
        }
        localStorageSetItem("sort_by", option)
    });
    var stored_sort_by = localStorageGetItem("sort_by");
    if (stored_sort_by) $('select[name="sort_by"]').val(stored_sort_by);
    var getItemFigure = function getItemFigure(item) {
        return item.value != "all" ? '<span style="background-image: url(' + getBattlePositionImagePath(item.index) + ')"></span>' + item.text : item.text
    };
    var getItemText = function getItemText(item) {
        return item.text
    };
    $(".select-group.girl-figure select").selectric({
        optionsItemBuilder: getItemFigure,
        labelBuilder: getItemFigure
    });
    $('.select-group select[name="rarity"]').selectric({
        optionsItemBuilder: getItemText,
        labelBuilder: getItemText
    });
    if (!is_mobile()) {
        $(".select-group.girl-figure select").on("selectric-open", function(event, element, selectric) {
            $("#filtering_girls .girl-figure .selectric-scroll").getNiceScroll().remove();
            $("#filtering_girls .girl-figure .selectric-scroll").niceScroll()
        })
    }

    function getHtmlOfGirlInfo() {
        if (!is_mobile_size()) return;
        var $girlInfoArea = $("#harem_right .girl_infos_area");
        var tabsContent = [{
            tabName: "stats",
            $elements: [{
                name: "carac-figure",
                $el: $girlInfoArea.find('[data-block="carac-figure"]'),
                html: ""
            }, {
                name: "income",
                $el: $girlInfoArea.find('[data-block="income"]'),
                html: ""
            }, {
                name: "experience",
                $el: $girlInfoArea.find('[data-block="experience"]'),
                html: ""
            }, {
                name: "affection",
                $el: $girlInfoArea.find('[data-block="affection"]'),
                html: ""
            }]
        }, {
            tabName: "bio",
            $elements: [{
                name: "bio",
                $el: $girlInfoArea.find('[data-block="bio"]'),
                html: ""
            }]
        }, {
            tabName: "variants",
            $elements: [{
                name: "girl-variations",
                $el: $girlInfoArea.find('[data-block="girl-variations"]'),
                html: ""
            }]
        }];
        if ($(".mobile-tab-harem-girl").is(":visible")) {
            for (var tabIndex in tabsContent) {
                var tabBlocks = tabsContent[tabIndex].$elements;
                var tabName = tabsContent[tabIndex].tabName;
                for (var blockIndex in tabBlocks) {
                    var element = tabBlocks[blockIndex];
                    var elHTML = checkAndGetHTML(element.$el);
                    if (elHTML.length) {
                        element.html = '\n\t\t\t\t\t\t<div class="' + element.name + '">\n\t\t\t\t\t\t\t' + elHTML + "\n\t\t\t\t\t\t</div>";
                        $girlInfoArea.find('.mobile-tab-harem-girl [tab-data="' + tabName + '"]').append(element.html)
                    }
                }
                if (!$.trim($girlInfoArea.find('.mobile-tab-harem-girl [tab-data="' + tabName + '"]').html()).length) {
                    $girlInfoArea.find('.mobile-tab-harem-girl .tab-head [data="' + tabName + '"]').attr("no-data", "")
                }
            }
        }

        function checkAndGetHTML($element) {
            var html = $element.length ? $element.html() : "";
            return html
        }
    }
    getHtmlOfGirlInfo();

    function assignEventListenersTabs() {
        if (!is_mobile_size()) return;
        $(".mobile-tab-harem-girl .tab-head > li").on("click", function() {
            var $clickedEl = $(this);
            if ($clickedEl.attr("activate") == "true" || $clickedEl.is('[no-data=""]')) return;
            $clickedEl.attr("activate", "true");
            $clickedEl.siblings().each(function() {
                $(this).attr("activate", "false")
            });
            $(".mobile-tab-harem-girl .tab-body [display-content]").removeAttr("display-content");
            $('.mobile-tab-harem-girl .tab-body [tab-data="' + $clickedEl.attr("data") + '"]').attr("display-content", "")
        })
    }
    assignEventListenersTabs();
    $("#admin_cheat #reset_bunny").click(function() {
        if (!confirm("This will reset Bunny to level 1 and grade 0. Are you sure?")) return;
        hh_ajax_then_reload({
            class: "Hero",
            action: "reset_bunny"
        })
    });
    $("#admin_cheat #remove_bonus_girls").click(function() {
        if (!confirm("This will empty your harem by removing all girls from troll/pachinko. Are you sure?")) return;
        hh_ajax_then_reload({
            class: "Hero",
            action: "remove_bonus_girls"
        })
    });
    $("#admin_cheat #upgrade_my_girl").click(function() {
        var gId = document.location.href.split("harem/")[1];
        if (!gId) {
            alert("I don't know which girl is selected. Sorry.");
            return
        }
        if (!confirm("This will add enough affection to girl #" + gId + " so she gets to next grade quest. Are you sure?")) return;
        hh_ajax_then_reload({
            class: "Hero",
            action: "upgrade_my_girl",
            girl: gId
        })
    });
    $("#admin_cheat #fill_timers").click(function() {
        if (!confirm("This will finish the timers of all your girls. Are you sure?")) return;
        hh_ajax_then_reload({
            class: "Hero",
            action: "fill_timers"
        })
    })
});
$(function() {
    if (!$("#missions, #contests, #pop").length || $(".page-panel").length) return;
    var pop = void 0;
    if (typeof pop_index != "undefined" && typeof pop_data != "undefined") pop = new PlacesOfPower(pop_data, pop_index, pop_list);
    $(".tabs h4").on("click", function() {
        if ($(".tabs h4.missions.selected").length) {
            switchTab("missions")
        } else if ($(".tabs h4.contests.selected").length) {
            switchTab("contests")
        } else if ($(".tabs h4.pop.selected").length) {
            switchTab("pop")
        }
    });

    function switchTab(tab) {
        switch (tab) {
            case "missions":
                $("#activities").attr("active", "missions");
                $(".missions_wrap").getNiceScroll().resize();
                scrollMissions(true);
                $(".close_cross").show();
                break;
            case "contests":
                $("#activities").attr("active", "contests");
                $(".close_cross").show();
                if (!areTitlesAdjusted) adjustContestTitleBgr();
                $(".scroll_area").getNiceScroll().resize();
                $(".lead_table_view").getNiceScroll().resize();
                var $activeContest = $(".contest_header.in_progress").last();
                if (!$activeContest.length) $activeContest = $(".contest_header.ended").last();
                if ($activeContest.length && (!$currentContest || $currentContest != $activeContest))
                    if (!$activeContest.siblings("div.contest_body").is(":visible")) $activeContest.click();
                    else showRankTable(parseInt($activeContest.parent().attr("id_contest"), 10), true);
                break;
            case "pop":
                $("#activities").attr("active", "pop");
                if (pop) {
                    if (!pop.listActive) $(".close_cross").hide();
                    pop.updateCentralElements();
                    $(".pop_list").getNiceScroll().resize()
                }
                break
        }
        applyMobileColorBackground()
    }
    var observer = new MutationObserver(function(mutations) {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;
        try {
            for (var _iterator = mutations[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                var mutation = _step.value;
                var _arr = ["missions", "contests", "pop"];
                for (var _i = 0; _i < _arr.length; _i++) {
                    var tab = _arr[_i];
                    if (mutation.target == $("#" + tab)[0]) {
                        if (mutation.attributeName === "style" && window.getComputedStyle($("#" + tab)[0]).getPropertyValue("display") !== "none") {
                            if ($("#activities").attr("active") != tab) {
                                switchTab(tab)
                            }
                            return
                        }
                    }
                }
            }
        } catch (err) {
            _didIteratorError = true;
            _iteratorError = err
        } finally {
            try {
                if (!_iteratorNormalCompletion && _iterator.return) {
                    _iterator.return()
                }
            } finally {
                if (_didIteratorError) {
                    throw _iteratorError
                }
            }
        }
    });
    if ($("#pop")[0]) {
        observer.observe($("#pop")[0], {
            attributes: true
        })
    }
    observer.observe($("#missions")[0], {
        attributes: true
    });
    observer.observe($("#contests")[0], {
        attributes: true
    });
    var claimedGift = false;
    var missionTimer = void 0;
    if (act_tab.identifyTab() == "missions") scrollMissions(true, 200);
    if (!player_missions) {
        $("#missions_counter").hide();
        if (mission_gift == 0) displayGift();
        else displayAfterGift()
    } else HHTimers.initDecTimer($("#missions_counter span"), next_update, reload);
    $("#missions .mission_object").each(function() {
        var data = $(this).data("d");
        if (data.remaining_time > 0) setMissionTimer(data.duration, data.remaining_time, $(this))
    });
    $(".missions_wrap").niceScroll();
    $("#missions .mission_button .duration").each(function() {
        var duration = $(this).text();
        $(this).html(format_time_short(duration))
    });

    function scrollMissions(animated) {
        var delay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var $finished_mission_button = $('.mission_object [rel="claim"]').filter(":visible");
        var $mission_button = $finished_mission_button.length ? $finished_mission_button : $('.mission_object [rel="finish"]').filter(":visible");
        if ($mission_button) {
            var $mission_object = $mission_button.parents(".mission_object");
            var offset = $mission_object.index() * ($mission_object.outerHeight() + 4);
            var scrollTop = $(".missions_wrap")[0].scrollTop;
            var distance = offset - scrollTop;
            if (animated && distance) {
                var duration = 200 + Math.abs(distance);
                scrollElement($(".missions_wrap")[0], distance, duration, delay)
            } else $(".missions_wrap").scrollTop(offset)
        }
    }

    function setMissionTimer(duration, remaining_time, $mission) {
        missionTimer = HHTimers.initBarTimer(duration, remaining_time, $mission.find(".finish_in_bar"), null, null, {
            threshold: "second"
        });
        missionTimer.onUpdate = function(timer) {
            var $mission = timer.$elm.closest(".mission_object");
            if (!$mission.length) return;
            var data = $mission.data("d");
            var currentPrice = Math.ceil(hh_prices.daily_missions_cost_per_minute * (timer.remainingTime / 60));
            if (currentPrice != data.remaining_cost) {
                $mission.find('button[rel="finish"] span').html(number_format_lang(currentPrice));
                data.remaining_cost = currentPrice
            }
        };
        missionTimer.onComplete = function(timer) {
            var $parent = timer.$elm.closest(".mission_button");
            $parent.find('[rel="finish"]').hide();
            $parent.find('[rel="claim"]').show();
            $('.mission_button button[rel="mission_start"]').prop("disabled", false);
            showDurationText();
            act_tab.notificationToggle();
            if (act_tab.identifyTab() == "missions") scrollMissions(true)
        }
    }

    function showDurationText() {
        $('.mission_button button[rel="mission_start" style="display:none"]').parent().find(".duration").show()
    }
    $('#missions button[rel="mission_start"]').click(function() {
        $(this).parent().find(".duration").hide();
        missionAjax($(this), "start")
    });
    $('#missions button[rel="finish"]').click(function() {
        var $button = $(this);
        $button.blur();
        showDurationText();
        hc_confirm($button.closest(".mission_object").data("d").remaining_cost, function() {
            missionAjax($button, "finish")
        })
    });
    $('#missions button[rel="claim"]').click(function() {
        $('#missions button[rel="claim"]').prop("disabled", true);
        missionAjax($(this), "claim")
    });

    function displayGift() {
        $(".end_gift").show();
        $("#missions>div").css("height", "100%");
        HHTimers.initDecTimer($(".end_gift span"), next_update, reload)
    }

    function displayAfterGift() {
        $(".after_gift").show();
        HHTimers.initDecTimer($(".after_gift span"), next_update, reload)
    }
    $(".end_gift button").on("click", function() {
        claimedGift = true;
        var params = {
            class: "Missions",
            action: "give_gift"
        };
        hh_ajax(params, function(data) {
            var reward = data.rewards;
            reward.callback = "handleMissionPopup";
            reward.callbackArgs = {
                isGiftClaimed: claimedGift,
                displayGift: displayGift,
                displayAfterGift: displayAfterGift
            };
            Reward.handlePopup(reward)
        })
    });

    function missionAjax($selector, purpose) {
        var $parent = $selector.closest(".mission_object");
        var missionData = $parent.data("d");
        var action = "";
        switch (purpose) {
            case "start":
                $('.mission_button button[rel="mission_start"]').prop("disabled", true);
                action = "start_mission";
                break;
            case "finish":
                $parent.find(".finish_in_bar").hide();
                missionTimer.destroy();
                action = "finish_mission";
                break;
            case "claim":
                $parent.closest(".mission_object").hide("blind", function() {
                    $(this).remove()
                });
                action = "claim_reward";
                break;
            default:
                throw new Error("Impossible mission ajax purpose: " + purpose)
        }
        $selector.hide();
        var params = {
            class: "Missions",
            action: action,
            id_mission: missionData.id_mission,
            id_member_mission: missionData.id_member_mission
        };
        hh_ajax(params, function(data) {
            if (purpose == "start") {
                $parent.find('[rel="finish"]').show();
                setMissionTimer(missionData.duration, false, $parent);
                disableButtonIfNotEnoughKobans()
            } else if (purpose == "finish") {
                $parent.find('[rel="claim"]').show();
                $('#missions button[rel="mission_start"]').prop("disabled", false);
                Hero.updates(data.changes, true);
                act_tab.notificationToggle()
            } else if (data.rewards) {
                var reward = data.rewards;
                reward.callback = "handleMissionPopup";
                reward.callbackArgs = {
                    isGiftClaimed: claimedGift,
                    displayGift: displayGift,
                    displayAfterGift: displayAfterGift
                };
                Reward.handlePopup(reward);
                act_tab.notificationToggle()
            }
        })
    }
    var $currentContest = void 0;
    var areTitlesAdjusted = void 0;
    $("#contests .contest .contest_timer").each(function() {
        createNewContestTimer($(this), function(timer) {
            var $parent = timer.$elm.closest(".personal_rewards");
            $parent.find('[rel="claim"]').show();
            act_tab.notificationToggle()
        })
    });
    newContestsTimerCheck();
    $(".scroll_area").niceScroll();
    $(".contest_header").click(function(event) {
        if (event.target.localName == "button") return;
        $currentContest = $(this);
        var id = $currentContest.parent().attr("id_contest");
        var $body = $currentContest.siblings("div.contest_body");
        if ($body.is(":visible")) {
            $body.removeClass("show");
            $(".right_part>.ranking").hide();
            $(".right_part>.info").show();
            $(".scroll_area").getNiceScroll().resize();
            $(this).removeClass("contest_header_active");
            $currentContest = null
        } else {
            $("div.contest_body").removeClass("show");
            $body.addClass("show");
            $(".right_part>.ranking").hide();
            $(".right_part>.info").hide();
            $('.ranking[id_contest="' + id + '"]>.lead_table_view').niceScroll();
            $(".scroll_area").getNiceScroll().resize();
            $(".contest_header").removeClass("contest_header_active");
            $(this).addClass("contest_header_active");
            showRankTable(id, false, true);
            scrollContests(id, showRankTable, id, true)
        }
    });
    if (act_tab.identifyTab() == "contests") {
        adjustContestTitleBgr();
        var $activeContest = $(".contest_header.in_progress");
        if ($activeContest.length) $activeContest.last().click();
        else $(".contest_header.ended").last().click()
    }

    function adjustContestTitleBgr() {
        $("#contests .contest_title").each(function() {
            var $background = $(this).parent().children().first();
            if ($(this).height() > 30 && !$background.hasClass("shadow_full")) {
                $background.removeClass("shadow_quad");
                $background.addClass("shadow_half")
            }
        });
        areTitlesAdjusted = true
    }
    $(".contest_header").find('button[rel="claim"]').click(function() {
        var $activeButtons = $(".contest_header").find('button[rel="claim"]');
        $activeButtons.prop("disabled", true);
        var $contest = $(this).closest(".contest");
        var id = parseInt($contest.attr("id_contest"), 10);
        var params = {
            namespace: "h\\Contest",
            class: "Contest",
            action: "give_reward",
            id_contest: id
        };
        hh_ajax(params, function(data) {
            $activeButtons.prop("disabled", false);
            $contest.hide("blind", function() {
                $(this).remove();
                act_tab.notificationToggle();
                newContestsTimerCheck()
            });
            if ($('.ranking[id_contest="' + id + '"]').is(":visible")) {
                $('.ranking[id_contest="' + id + '"]').hide();
                $(".info").show()
            }
            Reward.handlePopup(data.rewards)
        })
    });

    function newContestsTimerCheck() {
        var $timerContainer = void 0;
        var $nextContestTimer = $("#contests .next_contest");
        if (!$(".contest").length) {
            $nextContestTimer.hide();
            $timerContainer = $("#contests .no_contests").show()
        } else {
            $timerContainer = $nextContestTimer
        }
        createNewContestTimer($timerContainer.find(".contest_timer"), reload)
    }

    function createNewContestTimer($newContestsTimer, callback) {
        var contestTimer = HHTimers.initBarTimer($newContestsTimer.data("duration"), $newContestsTimer.data("remaining_time"), $newContestsTimer);
        contestTimer.onComplete = callback
    }
    $(".donate button").click(function() {
        donateSC($(this))
    });

    function donateSC($button) {
        var contestID = parseInt($button.parents("div.contest").attr("id_contest"), 10);
        var params = {
            namespace: "h\\Contest",
            class: "Contest",
            action: "contest_action",
            id_cluster: $button.attr("data-cluster-id"),
            action_type: $button.attr("data-action-type"),
            action_subtype: $button.attr("data-action-subtype")
        };
        hh_ajax(params, function(data) {
            var moneyPaid = data.paid;
            var newRankingsHTML = data.html.trim();
            var newRankingsUpdate = $(newRankingsHTML).find(".leadTable").html();
            Hero.update("soft_currency", 0 - moneyPaid, true);
            $('#contests .right_part div[id_contest="' + contestID + '"] .leadTable').html(newRankingsUpdate);
            var $animatedElement = $('#contests .right_part div[id_contest="' + contestID + '"] .leadTable .lead_table_default .cont_points_number span');
            $animatedElement.css("transform", "scale(1.5)");
            setTimeout(function() {
                $animatedElement.css("transform", "scale(1)")
            }, 400);
            var $leftContainer = $('#contests .left_part div[id_contest="' + contestID + '"]');
            var $rankElm = $leftContainer.find(".contest_header .rank");
            $rankElm.html(data.rank);
            showRankTable(contestID);
            var $currentRewardElm = $leftContainer.find(".reward_position.pink");
            var currentRewardIndeX = parseInt($currentRewardElm.data("reward-index"), 10);
            var newRewardIndex = data.rewards_position;
            if (newRewardIndex != currentRewardIndeX) {
                $currentRewardElm.removeClass("pink");
                var $rankRewards = $leftContainer.find(".reward_position[data-reward-index=" + newRewardIndex + "]");
                $rankRewards.addClass("pink");
                var $newPersonalRewards = $leftContainer.find(".contest_header .personal_rewards .reward_wrap");
                $newPersonalRewards.html($rankRewards.find(".reward_wrap").html())
            }
        })
    }

    function showRankTable(contestId) {
        var animated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
        var initial = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
        var $scrollWrapper = $('.right_part>.ranking[id_contest="' + contestId + '"]').show().find(".lead_table_view");
        if (initial) {
            $scrollWrapper[0].scrollTop = 0;
            return
        }
        var $playerRow = $scrollWrapper.find("tr.lead_table_default");
        var elementOff = $playerRow[0].offsetTop + $playerRow.outerHeight();
        var scrollOffset = elementOff - $scrollWrapper.outerHeight();
        if (elementOff != $scrollWrapper.outerHeight()) {
            if (animated) {
                $scrollWrapper[0].scrollTop = 0;
                scrollElement($scrollWrapper[0], scrollOffset, 200 + Math.abs(scrollOffset / 2))
            } else $scrollWrapper[0].scrollTop = scrollOffset
        }
        $scrollWrapper.getNiceScroll().resize()
    }

    function scrollContests(id, callback) {
        var wrap = $(".scroll_area")[0];
        var $contest = $('.contest[id_contest="' + id + '"]')[0];
        var offset = $contest.offsetTop - 80 - wrap.scrollTop;
        for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
            args[_key - 2] = arguments[_key]
        }
        scrollElement(wrap, offset, 200 + Math.abs(offset), 0, callback, args)
    }
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var PlacesOfPower = function() {
    _createClass(PlacesOfPower, null, [{
        key: "POP_RELOAD",
        get: function get() {
            return true
        }
    }, {
        key: "THUMB_SELECTED",
        get: function get() {
            return "pop_thumb_selected"
        }
    }, {
        key: "STATUS_CAN_START",
        get: function get() {
            return "can_start"
        }
    }, {
        key: "STATUS_IN_PROGRESS",
        get: function get() {
            return "in_progress"
        }
    }, {
        key: "STATUS_PENDING_REWARD",
        get: function get() {
            return "pending_reward"
        }
    }]);

    function PlacesOfPower(data, index, list) {
        _classCallCheck(this, PlacesOfPower);
        this.popIndex = index;
        this.listActive = list;
        this.allPopData = data;
        this.popMinRequiredPower = 5;
        this.updatePopIndex(this.popIndex);
        if (typeof this.allPopGirls == "undefined") {
            return
        }
        this.$popImage = $(".pop_left_part div img");
        this.$popThumb = $(".pop_thumb");
        this.$popThumbClaim = $('button[rel="pop_thumb_claim"]');
        this.$popThumbInfo = $('button[rel="pop_thumb_info"]');
        this.$popAction = $('button[rel="pop_action"]');
        this.$popFinish = $('button[rel="pop_finish"]');
        this.$popClaim = $('button[rel="pop_claim"]');
        this.$popAutoAssign = $('button[rel="pop_auto_assign"]');
        this.$popLevelUp = $('button[rel="pop_levelup"]');
        this.$popBackButton = $(".back_button");
        this.$popActiveSign = $(".pop_active_sign");
        this.$popRemaining = $(".pop_remaining");
        this.$popCentralBar = $(".pop_central_part .hh_bar");
        this.$popGirlsList = $(".pop_right_part .grid_view");
        this.$popPowerBar = $(".pop_right_part .hh_bar .frontbar");
        this.$popInfo = $(".pop_central_part .info");
        this.addEventListeners();
        this.init()
    }
    _createClass(PlacesOfPower, [{
        key: "init",
        value: function init() {
            if (this.listActive) {
                this.buildRewards();
                this.showPopList()
            } else {
                this.showPopPage()
            }
        }
    }, {
        key: "updatePopIndex",
        value: function updatePopIndex(index) {
            this.popIndex = index || $(".pop_thumb").first().attr("pop_id");
            if (this.allPopData[this.popIndex].locked) {
                throw new Error("PoP#" + this.popIndex + " is still locked!")
            }
            this.popCurrentId = this.allPopData[this.popIndex].id_places_of_power;
            this.popCurrentData = this.getCurrentData();
            this.popCurrentStatus = this.popCurrentData.status;
            this.isTempPop = this.popCurrentData.type === "temp";
            this.ajaxClass = this.isTempPop ? "TempPlaceOfPower" : "PlaceOfPower";
            this.allPopGirls = this.popCurrentData.girls;
            this.popCurrentCarac = this.popCurrentData.criteria;
            this.popLevelPower = this.popCurrentData.level_power;
            this.popMaxTeamPower = this.popCurrentData.max_team_power;
            this.popTimeToFinish = parseInt(this.popCurrentData.time_to_finish);
            this.popRemainingTime = parseInt(this.popCurrentData.remaining_time);
            this.popFinishCost = this.getFinishPrice(this.popRemainingTime);
            this.popLevelUpCost = this.popCurrentData.levelup_cost;
            this.popCurrentLevel = parseInt(this.popCurrentData.level);
            this.popRewards = this.popCurrentData.rewards;
            this.popGirl = this.popCurrentData.girl;
            this.popGirlAvatar = this.popGirl ? this.popGirl.avatar.toImageUrl("ava") : null;
            this.popGirlShards = this.popGirl ? this.popGirl.shards : null;
            this.popGirlName = this.popGirl ? this.popGirl.name : null
        }
    }, {
        key: "canStart",
        value: function canStart() {
            return this.popCurrentStatus === PlacesOfPower.STATUS_CAN_START
        }
    }, {
        key: "isInProgress",
        value: function isInProgress() {
            return this.popCurrentStatus === PlacesOfPower.STATUS_IN_PROGRESS
        }
    }, {
        key: "hasPendingReward",
        value: function hasPendingReward() {
            return this.popCurrentStatus === PlacesOfPower.STATUS_PENDING_REWARD
        }
    }, {
        key: "changeCurrentStatus",
        value: function changeCurrentStatus(status) {
            this.popCurrentStatus = status;
            this.popCurrentData.status = status
        }
    }, {
        key: "getCurrentData",
        value: function getCurrentData() {
            for (var pop in this.allPopData) {
                var popData = this.allPopData[pop];
                if (popData.id_places_of_power == this.popCurrentId) {
                    return popData
                }
            }
            throw new Error("No PoP id matches")
        }
    }, {
        key: "addEventListeners",
        value: function addEventListeners() {
            var _this2 = this;
            if (!PlacesOfPower.POP_RELOAD) {
                window.onpopstate = function(event) {
                    var currentTab = $("#activities").attr("active");
                    if (event.state && event.state.hasOwnProperty("highlight")) {
                        if (currentTab != "pop") {
                            act_tab.showTab("pop")
                        }
                        _this2.updatePopIndex(event.state.index);
                        _this2.listActive = !event.state.index;
                        _this2.init();
                        _this2.thumbClick({
                            currentTarget: $("[pop_id=" + event.state.highlight + "]")
                        }, true)
                    } else if (event.state && event.state.hasOwnProperty("tab")) {
                        if (currentTab == event.state.tab && event.state.tab == "pop") {
                            _this2.listActive = true;
                            _this2.init()
                        } else {
                            act_tab.showTab(event.state.tab)
                        }
                    } else {
                        act_tab.showTab(act_tab.first_tab)
                    }
                }
            }
            var availablePops = 0;
            for (var pop in this.allPopData) {
                if (!this.allPopData[pop].locked) {
                    availablePops++
                }
            }
            if (availablePops > 1) {
                this.$popThumb.on("click", this.thumbClick.bind(this))
            } else {
                this.$popThumb.css("cursor", "auto")
            }
            this.$popBackButton.on("click", this.backButtonClick.bind(this));
            this.$popThumbInfo.on("click", this.thumbInfoClick.bind(this));
            this.$popThumbClaim.on("click", this.thumbClaimClick.bind(this))
        }
    }, {
        key: "thumbClick",
        value: function thumbClick(event, force) {
            var $currentPop = $(event.currentTarget);
            var thumbIndex = $currentPop.attr("pop_id");
            var thumbSelected = $currentPop.attr("selected");
            this.$popThumb.each(function() {
                if ($(this).attr("selected")) {
                    $(this).removeClass(PlacesOfPower.THUMB_SELECTED);
                    $(this).removeAttr("selected")
                }
            });
            if (thumbSelected && !force) {
                $currentPop.removeClass(PlacesOfPower.THUMB_SELECTED);
                $currentPop.removeAttr("selected")
            } else {
                $currentPop.addClass(PlacesOfPower.THUMB_SELECTED);
                $currentPop.attr("selected", "")
            }
            this.updatePopIndex(thumbIndex);
            this.changeGirlImage(this.popGirlAvatar, false);
            this.updateGirlShards();
            this.buildRewards(false)
        }
    }, {
        key: "backButtonClick",
        value: function backButtonClick(event) {
            if (PlacesOfPower.POP_RELOAD) {
                window.location = "/activities.html?tab=pop";
                return
            }
            if (this.isInProgress()) {
                this.popRemainingTime = this.popProgressTimer.remainingTime;
                this.popCurrentData.remaining_time = this.popRemainingTime
            }
            this.showPopList();
            history.pushState({
                index: 0,
                highlight: parseInt(this.popIndex)
            }, "", "/activities.html?tab=pop");
            this.thumbClick({
                currentTarget: $("[pop_id=" + this.popIndex + "]")
            }, true)
        }
    }, {
        key: "thumbInfoClick",
        value: function thumbInfoClick(event) {
            event.stopPropagation();
            var index = $(event.currentTarget).parent().attr("pop_id");
            if (PlacesOfPower.POP_RELOAD) {
                window.location = "/activities.html?tab=pop&index=" + index;
                return
            }
            this.updatePopIndex(index);
            this.changeGirlImage(this.popGirlAvatar, false);
            this.updateGirlShards();
            this.buildRewards(false);
            this.showPopPage();
            var url = window.location.href;
            if (url.match(/index=/)) {
                url = url.replace(/index=[^&]*/, "index=" + index)
            } else {
                url = url_add_param(url, "index=" + index)
            }
            history.pushState({
                index: index,
                highlight: index
            }, "", url)
        }
    }, {
        key: "thumbClaimClick",
        value: function thumbClaimClick(event) {
            event.stopPropagation();
            var index = $(event.currentTarget).parent().attr("pop_id");
            this.updatePopIndex(index);
            this.changeGirlImage(this.popGirlAvatar);
            this.buildRewards(false);
            this.claimAction()
        }
    }, {
        key: "changeGirlImage",
        value: function changeGirlImage(src) {
            var _this3 = this;
            var hide = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
            $(".pop_girl_coming_soon").hide();
            if (!src) {
                src = IMAGES_URL + "/pictures/girls/1/avb0.png?a=1".toImageUrl("ava");
                if (!this.isTempPop) {
                    $(".pop_girl_coming_soon").show()
                }
            }
            if (hide) {
                this.$popImage.hide();
                this.$popImage[0].onload = function() {
                    _this3.$popImage.show()
                }
            }
            this.$popImage.attr("src", src)
        }
    }, {
        key: "showPopList",
        value: function showPopList() {
            this.listActive = true;
            this.showListView();
            this.repositionRewardElements();
            this.updateThumbs();
            if (this.popProgressTimer && !PlacesOfPower.POP_RELOAD) {
                this.popProgressTimer.destroy()
            }
            var _this = this;
            this.$popThumb.each(function() {
                var $thumb = $(this);
                if ($thumb.attr("status") === PlacesOfPower.STATUS_IN_PROGRESS) {
                    _this.startThumbProgressTimer($thumb)
                }
            });
            $(".pop_list").niceScroll()
        }
    }, {
        key: "startThumbProgressTimer",
        value: function startThumbProgressTimer($thumb) {
            var data = this.allPopData[$thumb.attr("pop_id")];
            var remainingTime = data.remaining_time;
            $thumb.find(".pop_thumb_remaining").find("span").html(format_time_short(remainingTime));
            this.setPopThumbTimer($thumb, data)
        }
    }, {
        key: "showPopPage",
        value: function showPopPage() {
            this.listActive = false;
            this.showPageView();
            if (!this.allPopGirls || !this.allPopData) {
                throw new Error("Data for PoP is missing")
            }
            this.buildPlacesOfPower(true, true);
            if (this.isInProgress()) {
                this.setPopTimer()
            }
            if (this.isTempPop) {
                HHTimers.initDecTimer(this.$popActiveSign.find("span:last"), this.popCurrentData.ends_in, reload)
            }
            this.repositionRewardElements()
        }
    }, {
        key: "showListView",
        value: function showListView() {
            this.toggleView()
        }
    }, {
        key: "showPageView",
        value: function showPageView() {
            this.toggleView("hide", "show", "flex", "list", "page")
        }
    }, {
        key: "toggleView",
        value: function toggleView() {
            var defaultShow = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "show";
            var defaultHide = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "hide";
            var display = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "none";
            var removedClass = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "page";
            var addedClass = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : "list";
            $(".pop_right_part")[defaultHide]();
            $(".pop_central_part")[defaultHide]();
            $(".pop_list")[defaultShow]();
            $(".pop_left_part").removeClass("pop_left_part_" + removedClass).addClass("pop_left_part_" + addedClass);
            $(".pop_rewards_container").removeClass("pop_rewards_" + removedClass).addClass("pop_rewards_" + addedClass);
            this.$popImage.removeClass("pop_left_fade_" + removedClass).addClass("pop_left_fade_" + addedClass);
            $(".left_shadow_gradient")[defaultHide]();
            $(".shards_bar_wrapper").removeClass("shards_bar_" + removedClass).addClass("shards_bar_" + addedClass);
            $(".pop_rewards_next_level").css("display", display);
            $(".close_cross")[defaultShow]()
        }
    }, {
        key: "setPopThumbTimer",
        value: function setPopThumbTimer($thumb, data) {
            var _this4 = this;
            var $bar = $thumb.find(".pop_thumb_progress_bar .hh_bar");
            var popThumbTimer = HHTimers.initBarTimer(data.time_to_finish, data.remaining_time, $bar);
            $bar.find(".frontbar").css("width", (1 - data.remaining_time / data.time_to_finish) * 100 + "%");
            popThumbTimer.onUpdate = function(timer) {
                $thumb.find(".pop_thumb_remaining").find("span").html(format_time_short(timer.remainingTime))
            };
            popThumbTimer.onComplete = function(timer) {
                timer.destroy();
                _this4.updateThumb($thumb, PlacesOfPower.STATUS_PENDING_REWARD)
            }
        }
    }, {
        key: "updateThumb",
        value: function updateThumb($thumb, status) {
            switch (status) {
                case PlacesOfPower.STATUS_IN_PROGRESS:
                    $thumb.addClass("pop_thumb_expanded");
                    $thumb.find(".pop_thumb_progress_bar").show();
                    $thumb.find(".pop_thumb_space").show();
                    break;
                case PlacesOfPower.STATUS_CAN_START:
                    $thumb.removeClass("pop_thumb_expanded");
                    $thumb.addClass("pop_thumb_active");
                    $thumb.parent().find(".collect_notif").hide();
                    $thumb.find(".pop_thumb_progress_bar").hide();
                    $thumb.find(".pop_thumb_space").hide();
                    $thumb.find('button[rel="pop_thumb_info"]').show();
                    $thumb.find('button[rel="pop_thumb_claim"]').hide();
                    break;
                case PlacesOfPower.STATUS_PENDING_REWARD:
                    $thumb.removeClass("pop_thumb_expanded");
                    $thumb.addClass("pop_thumb_active");
                    $thumb.parent().find(".collect_notif").show();
                    $thumb.find(".pop_thumb_progress_bar").hide();
                    $thumb.find(".pop_thumb_space").hide();
                    $thumb.find('button[rel="pop_thumb_info"]').hide();
                    $thumb.find('button[rel="pop_thumb_claim"]').show();
                    break
            }
            $thumb.attr("status", status)
        }
    }, {
        key: "updateThumbs",
        value: function updateThumbs() {
            var _this = this;
            this.$popThumb.filter("[status]").each(function() {
                var $thumb = $(this);
                var _status = $thumb.attr("status");
                var newStatus = _this.allPopData[$thumb.attr("pop_id")].status;
                if (_status != newStatus) {
                    if (_status == PlacesOfPower.STATUS_CAN_START && newStatus == PlacesOfPower.STATUS_IN_PROGRESS) {
                        _this.startThumbProgressTimer($thumb)
                    }
                    _this.updateThumb($thumb, newStatus)
                }
                $thumb.find(".pop_thumb_level").find("span:first-child").html("" + GT.design.Lvl + _this.allPopData[$thumb.attr("pop_id")].level)
            })
        }
    }, {
        key: "buildPlacesOfPower",
        value: function buildPlacesOfPower(rebuildRewards, updateElements) {
            var _this5 = this;
            if (updateElements) {
                this.updateCentralElements()
            }
            this.popAvailableGirls = this.allPopGirls.filter(function(girl) {
                return girl.assigned == -1 || girl.assigned == _this5.popCurrentId
            });
            this.buildGirls();
            if (rebuildRewards) {
                this.buildRewards()
            }
            if (this.canStart()) {
                for (var key in this.allPopGirls) {
                    if (this.allPopGirls[key].assigned == this.popCurrentId) this.allPopGirls[key].assigned = -1
                }
                $("div[girl]").css("cursor", "pointer");
                $("div[girl]").off("click").on("click", this.selectGirl.bind(this));
                this.$popAutoAssign.off("click").on("click", this.autoAssignGirls.bind(this));
                this.$popAction.off("click").on("click", this.startAction.bind(this));
                this.$popLevelUp.off("click").on("click", this.levelUpClick.bind(this))
            } else if (this.isInProgress()) {
                this.$popFinish.off("click").on("click", this.skipAction.bind(this))
            } else {
                this.$popClaim.off("click").on("click", this.claimAction.bind(this))
            }
            this.popCurrentPower = this.calculateSelectedGirls();
            this.updatePopDisplay()
        }
    }, {
        key: "updateCentralElements",
        value: function updateCentralElements() {
            var $popDescriptionText = $(".pop_central_part .info").find(".pop_description_text");
            $popDescriptionText.html(this.popCurrentData.description);
            var topMarginAdjust = (100 - $popDescriptionText.height()) / 2;
            this.$popInfo.find(".pop_power_needed").css({
                display: "block",
                "margin-top": topMarginAdjust + "px"
            });
            var $popTitle = this.$popInfo.find("h3");
            $popTitle.html(this.popCurrentData.title);
            if ($popTitle.height() > 40 && (this.isTempPop || this.popCurrentLevel < 10)) {
                $popTitle.removeClass("pop_title_big").addClass("pop_title_small");
                this.$popInfo.find(".pop_description_content").css({
                    "margin-top": "0",
                    height: "90px"
                })
            } else {
                $popTitle.removeClass("pop_title_small").addClass("pop_title_big");
                this.$popInfo.find(".pop_description_content").attr("style", "")
            }
            this.updatePowerNeeded()
        }
    }, {
        key: "updatePowerNeeded",
        value: function updatePowerNeeded() {
            var caracId = this.popCurrentCarac.match(/\d+/);
            $(".pop_power_needed_number").html('\n\t\t\t<span class="icon" carac="' + caracId + '" style="display:inline;"></span>\n\t\t\t<span>' + this.popCurrentData.level_power.toLocaleString() + "</span>");
            $(".pop_level").html("\n\t\t\t<span>" + GT.design.pop_level_txt + " " + this.popCurrentLevel + (this.isTempPop ? "" : "/10") + '</span>\n\t\t\t<span class="icon" carac="' + caracId + '"></span>');
            var $pop_needed_next = $(".pop_power_needed_next");
            if (this.isTempPop || this.popCurrentLevel == 10) {
                $pop_needed_next.css("visibility", "hidden");
                this.$popLevelUp.hide()
            } else {
                $pop_needed_next.html("\n\t\t\t\t<span>" + GT.design.Lvl + (parseInt(this.popCurrentLevel) + 1) + ':</span>\n\t\t\t\t<span></span>\n\t\t\t\t<span class="icon" carac="' + caracId + '"></span>\n\t\t\t\t<span>' + this.popCurrentData.next_level_power.toLocaleString() + "</span>");
                $pop_needed_next.css("visibility", "visible")
            }
        }
    }, {
        key: "repositionRewardElements",
        value: function repositionRewardElements() {
            if (this.listActive) {
                $(".slot").addClass("slot_list");
                $(".shards_girl_ico").addClass("slot_list");
                $(".pop_rewards").removeClass("pop_rewards_wrap_page")
            } else {
                $(".slot").removeClass("slot_list");
                $(".shards_girl_ico").removeClass("slot_list");
                $(".pop_rewards").addClass("pop_rewards_wrap_page")
            }
        }
    }, {
        key: "buildGirls",
        value: function buildGirls() {
            this.$popGirlsList.getNiceScroll().remove();
            if (!this.popAvailableGirls.length) return;
            var caracId = this.popCurrentCarac.match(/\d+/);
            var popGirlsHTML = "";
            for (var key in this.popAvailableGirls) {
                var girl = this.popAvailableGirls[key];
                if (this.canStart() || (this.isInProgress() || this.hasPendingReward()) && girl.assigned == this.popCurrentId) {
                    var girlClass = !this.canStart() ? "assigned" : girl.selected ? "pop_selected" : "not_selected";
                    popGirlsHTML += '<div girl="' + girl.id_girl + '" skill="' + girl[this.popCurrentCarac] + '" class="' + girlClass + '">\n\t\t\t\t\t<div class="girl_action" rarity="' + girl.rarity + '">\n\t\t\t\t\t\t<img src="' + girl.avatar.toImageUrl("ico") + '" draggable="false">\n\t\t\t\t\t\t<div class="girl_action_description">\n\t\t\t\t\t\t\t<div class="girl_carac_icon">\n\t\t\t\t\t\t\t\t<div class="icon" carac="' + caracId + '"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="skill">' + number_reduce(Math.ceil(girl[this.popCurrentCarac])) + "</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>"
                }
            }
            this.$popGirlsList[0].innerHTML = popGirlsHTML;
            this.$popGirlsList.niceScroll()
        }
    }, {
        key: "buildRewards",
        value: function buildRewards() {
            var _this6 = this;
            var buildNextLevel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
            var currentLevelData = this.popRewards[0];
            if (currentLevelData.hasOwnProperty("shards") && currentLevelData.shards.length) {
                currentLevelData.shards[0].position_img = this.popGirl.position_img;
                currentLevelData.shards[0].salary_per_hour = this.popGirl.salary_per_hour;
                currentLevelData.shards[0].Graded2 = this.popGirl.Graded2;
                currentLevelData.shards[0].level = this.popGirl.level
            }
            if (currentLevelData.surplus_item) {
                delete currentLevelData.surplus_item
            }
            var rewardString = JSON.stringify(currentLevelData).replace("'", "&apos;");
            $(".pop_rewards")[0].innerHTML = '<div class="pop_rewards_display reward_wrap" data-reward-display=\'' + rewardString + '\'></div>\n\t\t\t<div class="pop_rewards_next_level"></div>';
            RewardsBuilder.isPreview = false;
            var rewardPreviewHTML = RewardsBuilder.buildPreviewHtml(currentLevelData);
            $(".pop_rewards_display").prepend(rewardPreviewHTML);
            $("#pop_info .shards_girl_ico .shards").removeAttr("shards").css("pointer-events", "none");
            this.repositionRewardElements();
            if (this.isTempPop || this.popCurrentLevel == 10 || !buildNextLevel) {
                return
            }
            var nextLevelShards = void 0;
            var nextLevelRewards = [];
            var nextLevelData = this.popRewards[1];
            var rewardsData = RewardsBuilder.reformatRewards(nextLevelData);
            for (var key in rewardsData) {
                var rewardDataKey = rewardsData[key];
                if (rewardDataKey.type == "girl_shards" && this.popGirl) {
                    nextLevelShards = RewardsBuilder.buildShardsValue(rewardDataKey.value, rewardDataKey.name, rewardDataKey.value - rewardDataKey.previous_value, true)
                } else {
                    nextLevelRewards.push(RewardsBuilder.buildSlot(rewardDataKey))
                }
            }
            var nextLevelRewardsHTML = "";
            if (this.popGirlShards < 100 && this.popGirl) {
                nextLevelRewardsHTML += '<span class="shards_description">' + GT.design.Lvl + (this.popCurrentLevel + 1) + ": " + nextLevelShards + "</span>"
            }
            nextLevelRewards.forEach(function(reward) {
                nextLevelRewardsHTML += '<span class="reward_description">' + GT.design.Lvl + (_this6.popCurrentLevel + 1) + ": " + reward + "</span>"
            });
            $(".pop_rewards_next_level").html(nextLevelRewardsHTML)
        }
    }, {
        key: "calculateSelectedGirls",
        value: function calculateSelectedGirls() {
            var result = 0;
            $(this.canStart() ? ".pop_selected" : ".assigned").each(function() {
                result += Number($(this).attr("skill"))
            });
            return result
        }
    }, {
        key: "getSelectedGirlsArray",
        value: function getSelectedGirlsArray() {
            var array = [];
            $(".pop_selected").each(function() {
                array.push(parseInt($(this).attr("girl")))
            });
            return array
        }
    }, {
        key: "selectGirl",
        value: function selectGirl(evt) {
            $(evt.currentTarget).toggleClass("pop_selected not_selected");
            this.popCurrentPower = this.calculateSelectedGirls();
            this.updatePopDisplay()
        }
    }, {
        key: "autoAssignGirls",
        value: function autoAssignGirls(evt) {
            var _this7 = this;
            $("div[girl]").attr("class", "not_selected");
            this.popCurrentPower = 0;
            var reducer = function reducer(accumulator, currentValue) {
                return (accumulator[_this7.popCurrentCarac] || accumulator) + currentValue[_this7.popCurrentCarac]
            };
            var girlsTotalPower = this.popAvailableGirls.reduce(reducer, 0);
            if (girlsTotalPower < this.popMaxTeamPower) {
                $(".grid_view .not_selected").attr("class", "pop_selected");
                this.popCurrentPower = this.calculateSelectedGirls()
            } else {
                while (this.popCurrentPower < this.popMaxTeamPower) {
                    $(".grid_view .not_selected").first().attr("class", "pop_selected");
                    this.popCurrentPower = this.calculateSelectedGirls()
                }
            }
            this.updatePopDisplay();
            this.$popAutoAssign.prop("disabled", true)
        }
    }, {
        key: "startAction",
        value: function startAction(evt) {
            var _this8 = this;
            var girlsArray = this.getSelectedGirlsArray();
            var params = {
                namespace: "h\\PlacesOfPower",
                class: this.ajaxClass,
                action: "start",
                id_place_of_power: this.popCurrentId,
                selected_girls: girlsArray
            };
            this.$popAction.prop("disabled", true);
            hh_ajax(params, function(data) {
                var _loop = function _loop(arrayKey) {
                    for (var key in _this8.allPopGirls) {
                        if (girlsArray[arrayKey] == parseInt(_this8.allPopGirls[key].id_girl)) {
                            if (PlacesOfPower.POP_RELOAD) {
                                _this8.allPopGirls[key].assigned = _this8.popCurrentId
                            } else {
                                for (var pop in _this8.allPopData) {
                                    if (!_this8.allPopData[pop].locked) {
                                        var girl = _this8.allPopData[pop].girls.find(function(girl) {
                                            return parseInt(girl.id_girl) == girlsArray[arrayKey]
                                        });
                                        if (girl) {
                                            girl.assigned = _this8.popCurrentId
                                        }
                                    }
                                }
                            }
                        }
                    }
                };
                for (var arrayKey in girlsArray) {
                    _loop(arrayKey)
                }
                if (!PlacesOfPower.POP_RELOAD) {
                    _this8.popRemainingTime = _this8.getTotalPopTime();
                    _this8.popCurrentData.remaining_time = _this8.popRemainingTime;
                    _this8.popCurrentData.time_to_finish = _this8.popRemainingTime;
                    _this8.popTimeToFinish = _this8.popRemainingTime
                }
                _this8.setPopTimer();
                _this8.changeCurrentStatus(PlacesOfPower.STATUS_IN_PROGRESS);
                _this8.buildPlacesOfPower()
            })
        }
    }, {
        key: "skipAction",
        value: function skipAction(evt) {
            var _this9 = this;
            var params = {
                namespace: "h\\PlacesOfPower",
                class: this.ajaxClass,
                action: "skip",
                id_place_of_power: this.popCurrentId
            };
            hc_confirm(this.popFinishCost || this.getFinishPrice(this.getTotalPopTime()), function() {
                _this9.$popFinish.prop("disabled", true);
                hh_ajax(params, function(data) {
                    _this9.popProgressTimer.destroy();
                    Hero.updates(data.changes, true);
                    _this9.changeCurrentStatus(PlacesOfPower.STATUS_PENDING_REWARD);
                    _this9.buildPlacesOfPower()
                })
            })
        }
    }, {
        key: "claimAction",
        value: function claimAction(evt) {
            var params = {
                namespace: "h\\PlacesOfPower",
                class: this.ajaxClass,
                action: "claim",
                id_place_of_power: this.popCurrentId
            };
            if (evt) {
                this.$popClaim.prop("disabled", true)
            } else {
                this.$popThumbClaim.prop("disabled", true)
            }
            hh_ajax(params, this.claimSuccessful.bind(this))
        }
    }, {
        key: "claimSuccessful",
        value: function claimSuccessful(data) {
            var reward = data.rewards;
            if (PlacesOfPower.POP_RELOAD) {
                if (this.listActive || data.pop_unavailable) {
                    reward.redirectUrl = "/activities.html?tab=pop"
                }
            } else {
                for (var pop in this.allPopData) {
                    var popData = this.allPopData[pop];
                    if (popData.id_places_of_power != this.popCurrentId && !popData.locked) {
                        for (var key in popData.girls) {
                            if (popData.girls[key].assigned == this.popCurrentId) {
                                popData.girls[key].assigned = -1
                            }
                        }
                    }
                }
                this.$popThumbClaim.prop("disabled", false)
            }
            if (reward.data.shards) {
                this.updateGirlShards(reward.data.shards[0])
            }
            if (this.popGirlShards === 100) {
                reward.redirectUrl = window.location.href
            }
            Reward.handlePopup(reward);
            Hero.updates(reward.data.heroChangesUpdate, true);
            this.changeCurrentStatus(PlacesOfPower.STATUS_CAN_START);
            this.buildPlacesOfPower();
            this.updateThumbs()
        }
    }, {
        key: "updateGirlShards",
        value: function updateGirlShards(shardsData) {
            if (shardsData) {
                this.popGirlShards = shardsData.value
            }
            if (!this.popGirl) {
                $(".shards_bar_wrapper").hide()
            } else {
                $(".shards_bar_wrapper").show();
                var $girlShardsElement = $(".pop_left_part .shards_bar_wrapper .shards");
                if (this.popGirlShards >= 100) {
                    this.popGirlShards = 100;
                    $(".pop_rewards_display .shards_girl_ico").hide();
                    $(".shards_description").hide();
                    $girlShardsElement.removeAttr("shards")
                } else {
                    $girlShardsElement.attr("shards", this.popGirlShards);
                    $girlShardsElement.attr("name", this.popGirlName)
                }
                $girlShardsElement.find("span")[1].innerHTML = this.popGirlShards + "/100";
                $(".basic-progress-bar-fill").css("width", this.popGirlShards + "%")
            }
        }
    }, {
        key: "levelUpClick",
        value: function levelUpClick(evt) {
            var _this10 = this;
            var params = {
                namespace: "h\\PlacesOfPower",
                class: this.ajaxClass,
                action: "levelup",
                id_place_of_power: this.popCurrentId
            };
            hc_confirm(this.popLevelUpCost, function() {
                _this10.$popLevelUp.prop("disabled", true);
                hh_ajax(params, _this10.levelUpSuccessful.bind(_this10))
            })
        }
    }, {
        key: "levelUpSuccessful",
        value: function levelUpSuccessful(data) {
            this.popCurrentData.level++;
            this.popCurrentData.level_power = data.level_power;
            this.popCurrentData.max_team_power = data.max_team_power;
            this.popCurrentData.next_level_power = data.next_level_power;
            this.popCurrentLevel = this.popCurrentData.level;
            this.popLevelPower = this.popCurrentData.level_power;
            this.popMaxTeamPower = this.popCurrentData.max_team_power;
            this.popRewards[0] = data.rewards[0];
            if (this.popRewards[0].hasOwnProperty("shards")) {
                this.popRewards[0].shards[0].position_img = this.popCurrentData.girl_position_img;
                this.popRewards[0].shards[0].salary_per_hour = this.popCurrentData.girl_salary_per_hour
            }
            this.popRewards[1] = data.rewards[1];
            this.buildPlacesOfPower(true);
            this.$popAutoAssign.prop("disabled", false);
            this.updatePowerNeeded();
            Hero.updates(data.changes, true)
        }
    }, {
        key: "updateFinishPriceDisplay",
        value: function updateFinishPriceDisplay(price) {
            this.$popFinish.find("span").html(number_format_lang(price))
        }
    }, {
        key: "getFinishPrice",
        value: function getFinishPrice(remainingTime) {
            return Math.ceil(hh_prices.daily_missions_cost_per_minute * (remainingTime / 60))
        }
    }, {
        key: "setPopTimer",
        value: function setPopTimer() {
            var _this11 = this;
            this.updateFinishPriceDisplay(this.getFinishPrice(this.popRemainingTime));
            this.popProgressTimer = HHTimers.initBarTimer(this.popTimeToFinish, this.popRemainingTime, this.$popCentralBar, null, null, {
                threshold: "second"
            });
            this.$popCentralBar.find(".frontbar").css("width", (1 - this.popRemainingTime / this.popTimeToFinish) * 100 + "%");
            this.popProgressTimer.onUpdate = function(timer) {
                _this11.updatePopTime(_this11.$popRemaining, timer.remainingTime);
                var currentPrice = _this11.getFinishPrice(timer.remainingTime);
                if (currentPrice != _this11.popFinishCost) {
                    _this11.updateFinishPriceDisplay(currentPrice);
                    _this11.popFinishCost = currentPrice
                }
            };
            this.popProgressTimer.onComplete = function(timer) {
                _this11.popProgressTimer.destroy();
                _this11.changeCurrentStatus(PlacesOfPower.STATUS_PENDING_REWARD);
                _this11.buildPlacesOfPower()
            }
        }
    }, {
        key: "updatePopTime",
        value: function updatePopTime($displayObject, time) {
            var timeRemainingString = format_time_short(time);
            $displayObject.find("span").html(timeRemainingString)
        }
    }, {
        key: "getPowerPercent",
        value: function getPowerPercent() {
            var percent = 100 * this.popCurrentPower / this.popMaxTeamPower;
            if (percent > 100) percent = 100;
            return percent
        }
    }, {
        key: "getTotalPopTime",
        value: function getTotalPopTime() {
            var limitedPower = this.popCurrentPower > this.popMaxTeamPower ? this.popMaxTeamPower : this.popCurrentPower;
            return Math.ceil(this.popLevelPower / limitedPower) * 60
        }
    }, {
        key: "updatePopDisplay",
        value: function updatePopDisplay() {
            $(".acting-power-text")[0].innerHTML = number_reduce(Math.ceil(this.popCurrentPower)) + " / " + number_reduce(this.popMaxTeamPower);
            var powerPercent = this.getPowerPercent();
            $(".pop_right_part .hh_bar").find(".minimumbar").css("width", this.popMinRequiredPower + "%");
            if (this.popCurrentPower && (this.canStart() || !this.popRemainingTime)) {
                this.popRemainingTime = this.getTotalPopTime();
                this.popTimeToFinish = this.popRemainingTime
            }
            this.updatePopTime(this.$popRemaining, this.popRemainingTime);
            this.$popAutoAssign.css("display", "block");
            if (this.isTempPop) {
                this.$popLevelUp.hide();
                this.$popActiveSign.show()
            } else {
                this.$popActiveSign.hide();
                if (this.popCurrentLevel < 10) {
                    this.$popLevelUp.show()
                }
            }
            this.$popClaim.hide();
            if (this.canStart()) {
                var enableAutoAssignAction = !this.popAvailableGirls.length;
                this.$popAutoAssign.prop("disabled", enableAutoAssignAction);
                this.$popCentralBar.hide();
                this.$popFinish.hide();
                this.$popAction.show();
                this.$popLevelUp.prop("disabled", false);
                if (powerPercent < this.popMinRequiredPower) {
                    this.$popPowerBar.addClass("below_minimum");
                    this.$popRemaining.hide();
                    this.$popAction.prop("disabled", true)
                } else {
                    this.$popPowerBar.removeClass("below_minimum");
                    this.$popRemaining.show();
                    this.$popRemaining.addClass("pop_remaining_state");
                    this.$popAction.prop("disabled", enableAutoAssignAction)
                }
            } else if (this.isInProgress()) {
                this.$popCentralBar.show();
                this.$popRemaining.show();
                this.$popPowerBar.removeClass("below_minimum");
                this.$popRemaining.removeClass("pop_remaining_state");
                this.$popFinish.show();
                this.$popFinish.prop("disabled", false);
                this.$popAction.hide();
                this.$popAction.prop("disabled", true);
                this.$popAutoAssign.prop("disabled", true);
                this.$popLevelUp.prop("disabled", true)
            } else {
                this.$popAction.hide();
                this.$popPowerBar.removeClass("below_minimum");
                this.$popCentralBar.hide();
                this.$popRemaining.hide();
                this.$popFinish.hide();
                this.$popClaim.css("display", "block");
                this.$popClaim.prop("disabled", false);
                this.$popLevelUp.prop("disabled", true);
                this.$popAutoAssign.prop("disabled", true)
            }
            act_tab.notificationToggle();
            this.$popPowerBar.css("width", powerPercent + "%")
        }
    }]);
    return PlacesOfPower
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var TemplatePoA = function() {
    function TemplatePoA(eventData) {
        _classCallCheck(this, TemplatePoA);
        this.eventData = eventData;
        this.claimAjax = []
    }
    _createClass(TemplatePoA, [{
        key: "initTemplate",
        value: function initTemplate(name, canParticipate) {
            var html = this.buildHeader(name);
            if (canParticipate) {
                html += this.buildObjectivesBlock(true);
                html += this.buildButtonsBar()
            }
            $("#path_of_attraction > .container").append(html)
        }
    }, {
        key: "buildHeader",
        value: function buildHeader(title) {
            var html = '<div class="event-header">\n\t\t\t\t\t\t<h2>\n\t\t\t\t\t\t\t' + title + '\n\t\t\t\t\t\t</h2>\n\n\t\t\t\t\t\t<a href="/home.html" class="close_cross">\n\t\t\t\t\t\t\t<img src="' + IMAGES_URL + '/design_v2/close_cross_icon.png"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>';
            html += '<p class="event-timer-end">\n\t\t\t\t\t' + GT.design.contests_ends_in + ': <span rel="path-event-timer"></span>\n\t\t\t\t</p>';
            return html
        }
    }, {
        key: "buildObjectivesBlock",
        value: function buildObjectivesBlock(parentContainer) {
            RewardsBuilder.isPreview = false;
            var allObjectives = this.eventData.objectives;
            var html = parentContainer ? '<div class="all-objectives">' : "";
            for (var i = 0; i < allObjectives.length; i++) {
                html += this.buildObjective(allObjectives[i])
            }
            html += parentContainer ? "</div>" : "";
            return html
        }
    }, {
        key: "buildObjective",
        value: function buildObjective(objective) {
            var html = '<div class="\n\t\t\t\t\t\tobjective\n\t\t\t\t\t\t' + (objective.is_current_objective ? "expand" : "") + "\n\t\t\t\t\t\t" + (objective.objective_progress >= objective.objective_target ? "completed" : "in-progress") + '\n\t\t\t\t\t">';
            var free_reward = objective.locked_reward.rewards ? objective.free_reward : objective.free_reward.girls;
            var locked_reward = objective.locked_reward.rewards ? objective.locked_reward : objective.locked_reward.girls;
            var free_reward_string = JSON.stringify(free_reward).replace(/'/g, "&apos;").replace(/&quot;/g, "&amp;quot;");
            var locked_reward_string = JSON.stringify(locked_reward).replace(/'/g, "&apos;").replace(/&quot;/g, "&amp;quot;");
            html += '<div class="golden-block\n\t\t\t\t\t' + (this.eventData.unlocked ? "" : " locked ") + "\n\t\t\t\t\t" + (objective.locked_reward_picked ? " picked-reward " : "") + '\n\t\t\t\t">\n\t\t\t\t\t<div class="green-tick-icon"></div>\n\n\t\t\t\t\t<span class="locked-icon"></span>\n\n\t\t\t\t\t<div class="reward_wrap" data-reward-display=\'' + locked_reward_string + "'>\n\t\t\t\t\t</div>\n\t\t\t\t</div>";
            html += '\n\t\t\t<div class="free-block\n\t\t\t\t' + (objective.free_reward_picked ? "picked-reward" : "") + '\n\t\t\t">\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="green-tick-icon"></div>\n\n\t\t\t\t\t<div class="reward_wrap" data-reward-display=\'' + free_reward_string + '\'>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="objective-text">\n\t\t\t\t\t\t<h4>' + objective.objective_text + "</h4>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t" + (objective.objective_progress ? number_format_lang(objective.objective_progress) : 0) + "\n\t\t\t\t\t\t\t/\n\t\t\t\t\t\t\t" + number_format_lang(objective.objective_target) + "\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>";
            html += this.buildClaimBtnPerObjective(objective);
            html += "</div>";
            html += this.buildProgressBar(objective);
            html += '<div class="objective-counter">\n\t\t\t\t\t<span>' + decimal2roman(parseInt(objective.num_step, 10)) + "</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t";
            html += "</div>";
            return html
        }
    }, {
        key: "buildClaimBtnPerObjective",
        value: function buildClaimBtnPerObjective(objective) {
            this.claimAjax[objective.num_step] = [];
            var canClaimFree = !objective.free_reward_picked;
            var canClaimLocked = this.eventData.unlocked && !objective.locked_reward_picked;
            var isCompleted = parseInt(objective.objective_progress, 10) >= parseInt(objective.objective_target, 10);
            if (isCompleted) {
                if (canClaimFree) this.claimAjax[objective.num_step].push("free_" + objective.num_step);
                if (canClaimLocked) this.claimAjax[objective.num_step].push("locked_" + objective.num_step)
            } else this.claimAjax[objective.num_step] = [];
            var html = "";
            if (Array.isArray(this.claimAjax[objective.num_step]) && this.claimAjax[objective.num_step].length && isCompleted) html += '<button class="claim-btn red_button_L" objective-index="' + objective.num_step + '">' + GT.design.poa_btn_claim + "</button>";
            return html
        }
    }, {
        key: "buildProgressBar",
        value: function buildProgressBar(objective) {
            var isCompleted = objective.objective_progress >= objective.objective_target;
            var colorProgressBar = isCompleted ? objective.free_reward_picked && !this.eventData.unlocked || this.eventData.unlocked && objective.locked_reward_picked && objective.free_reward_picked ? "green-mode" : "blue-mode" : "";
            var percentage = 0;
            var html = "";
            if (objective.objective_progress) {
                percentage = (objective.objective_progress / objective.objective_target * 100).toFixed(2);
                html = '<div class="objective-progress ' + colorProgressBar + '" style="width: ' + percentage + '%"></div>'
            }
            return html
        }
    }, {
        key: "buildButtonsBar",
        value: function buildButtonsBar() {
            var html = '<div class="buttons-bar">';
            if (!this.eventData.unlocked) {
                html += '<button class="poa-btn orange_button_L unlock-feature" price="' + hh_prices.unlock_path_of_attraction + '">\n\t\t\t\t\t\t<p>' + GT.design.poa_unlock_feature + '</p>\n\t\t\t\t\t\t<p><span class="strikethrough">27,000</span> ' + number_format_lang(hh_prices.unlock_path_of_attraction) + ' <span cur="hard_currency"></span></p>\n\t\t\t\t\t</button>'
            }
            html += this.prepareGoToBtns();
            html += "</div>";
            return html
        }
    }, {
        key: "prepareGoToBtns",
        value: function prepareGoToBtns() {
            var curObjectiveStep = parseInt(this.eventData.current_step, 10);
            if (curObjectiveStep > this.eventData.objectives.length) return "";
            var objectiveIndex = curObjectiveStep - 1;
            var currentObjective = this.eventData.objectives[objectiveIndex];
            var objectName = currentObjective.objective_name;
            var identifiers = {
                spend_nrj: [{
                    label: GT.design.current_quest,
                    link: Hero.infos.questing.current_url
                }, {
                    label: GT.design.Champions,
                    link: "/champions-help.html"
                }],
                xp_girl: [{
                    label: GT.design.Market,
                    link: "/shop.html?type=potion"
                }],
                defeat_troll: [{
                    label: currentObjective.objective_text,
                    link: "/battle.html?id_troll=" + (Hero.infos.questing.id_world - 1)
                }],
                defeat_pvp: [{
                    label: GT.design.Season,
                    link: "/season-arena.html"
                }],
                score_contest_points: [{
                    label: GT.design.contests,
                    link: "/activities.html?tab=contests"
                }],
                defeat_pvp_arena_leagues: [{
                    label: GT.design.Season,
                    link: "/season-arena.html"
                }, {
                    label: GT.design.lead_main_title,
                    link: "/tower-of-fame.html?tab=leagues"
                }],
                sell_item: [{
                    label: GT.design.Market,
                    link: "/shop.html"
                }],
                spend_sc: [{
                    label: GT.design.Market,
                    link: "/shop.html"
                }, {
                    label: GT.design.Pachinko,
                    link: "/pachinko.html"
                }],
                challenge_champion: [{
                    label: GT.design.Champions,
                    link: "/champions-map.html"
                }],
                use_orbs: [{
                    label: GT.design.Pachinko,
                    link: "/pachinko.html"
                }],
                complete_dm: [{
                    label: GT.design.missions,
                    link: "/activities.html?tab=missions"
                }]
            };
            var html = "";
            if (typeof identifiers[objectName] !== "undefined") {
                for (var i = 0; i < identifiers[objectName].length; i++) {
                    html += '\n\t\t\t\t\t<a href="' + identifiers[objectName][i].link + '"\n\t\t\t\t\tclass="poa-btn btn-link-to blue_button_L">\n\t\t\t\t\t\t' + GT.design.town_event_goto_troll + " " + identifiers[objectName][i].label + "\n\t\t\t\t\t</a>"
                }
            } else console.log("ERROR: missing defined object name!");
            return html
        }
    }, {
        key: "_reBuildObjectives",
        value: function _reBuildObjectives() {
            var $allObjectives = $(".all-objectives");
            $allObjectives.children().remove();
            $allObjectives.getNiceScroll().remove();
            $(this.buildObjectivesBlock(false)).appendTo($allObjectives);
            RewardsBuilder.init();
            $allObjectives.niceScroll();
            this.scrollToObjective($allObjectives)
        }
    }, {
        key: "scrollToObjective",
        value: function scrollToObjective($allObjectives) {
            var objectiveTop = $allObjectives.find(".completed, .expand").last().position().top / FullSize.scale;
            var scrollTop = objectiveTop - $allObjectives.position().top / FullSize.scale;
            $allObjectives.animate({
                scrollTop: scrollTop
            }, "slow")
        }
    }, {
        key: "updateEventData",
        value: function updateEventData(updatedEventData) {
            if (this.eventData.unlocked != this.updateEventData.unlocked) {
                this.eventData = updatedEventData;
                this._reBuildObjectives()
            }
        }
    }]);
    return TemplatePoA
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var InteractionsPoA = function() {
    function InteractionsPoA(eventData) {
        _classCallCheck(this, InteractionsPoA);
        if (typeof eventData != "undefined") {
            this.eventData = $.extend({}, eventData);
            this.template = new TemplatePoA(this.eventData);
            this.init()
        } else {
            this.redirectToHome()
        }
    }
    _createClass(InteractionsPoA, [{
        key: "init",
        value: function init() {
            var _this = this;
            var name = this.eventData.name ? this.eventData.name : this.eventData.event_name;
            var canParticipate = typeof this.eventData.can_participate !== "undefined" ? this.eventData.can_participate : true;
            this.prepareBackground(canParticipate);
            this.template.initTemplate(name, canParticipate);
            if (canParticipate) {
                $("body").on("click", ".unlock-feature", function(event) {
                    var $clicked = $(event.target);
                    $clicked.prop("disabled", true);
                    hc_confirm($clicked.attr("price"), function() {
                        var params = {
                            class: "PathOfAttraction",
                            action: "unlock"
                        };
                        hh_ajax(params, function(data) {
                            Hero.update("hard_currency", -hh_prices.unlock_path_of_attraction, true);
                            $clicked.remove();
                            _this.eventData.unlocked = true;
                            _this.template.updateEventData(_this.eventData, true)
                        })
                    })
                });
                $("body").on("click", ".claim-btn", function(event) {
                    var $clicked = $(event.target);
                    var objectiveIndex = $clicked.attr("objective-index");
                    var objectiveClaimData = _this.template.claimAjax[objectiveIndex][0];
                    $clicked.prop("disabled", true);
                    var params = {
                        class: "PathOfAttraction",
                        action: "claim",
                        claim_key: objectiveClaimData
                    };
                    var claimFree = objectiveClaimData.indexOf("free_" + objectiveIndex) > -1;
                    var claimLocked = objectiveClaimData.indexOf("locked_" + objectiveIndex) > -1;
                    hh_ajax(params, function(data) {
                        var indexInObjectivesArray = parseInt(objectiveIndex, 10) - 1;
                        if (claimFree) _this.eventData.objectives[indexInObjectivesArray].free_reward_picked = true;
                        else if (claimLocked) _this.eventData.objectives[indexInObjectivesArray].locked_reward_picked = true;
                        _this.template.updateEventData(_this.eventData, false);
                        Reward.handlePopup(data.rewards)
                    })
                });
                $(".all-objectives").niceScroll();
                this.template.scrollToObjective($(".all-objectives"));
                RewardsBuilder.init()
            }
            HHTimers.initSimpleTimerTxt($('p.event-timer-end span[rel="path-event-timer"]'), this.eventData.seconds_until_event_end, this.redirectToHome, "")
        }
    }, {
        key: "redirectToHome",
        value: function redirectToHome() {
            document.location.href = "/home.html"
        }
    }, {
        key: "prepareBackground",
        value: function prepareBackground(canParticipate) {
            var $bgAll = $("#bg_all");
            var $pathPreviewGirls = $(".path-event-preview-girls").show();
            if (canParticipate) {
                var freeGirls = this.eventData.event_images.free;
                var lockedGirls = this.eventData.event_images.locked;
                freeGirls.forEach(function(girl) {
                    $pathPreviewGirls.append('<img class="path-event-girl free-girl-avatar" src="' + girl.toImageUrl("ava") + '"/>')
                });
                lockedGirls.forEach(function(girl) {
                    $pathPreviewGirls.append('<img class="path-event-girl locked-girl-avatar" src="' + girl.toImageUrl("ava") + '"/>')
                })
            } else {
                var bunnyAvatar = (IMAGES_URL + "/pictures/girls/1/ava1.png").toImageUrl("ava");
                $pathPreviewGirls.append('<img class="path-event-girl" src="' + bunnyAvatar + '"/>');
                $("#path_of_attraction .container").append('<div class="dialog-box"><p>' + this.eventData.participation_info + "</p></div>")
            }
            $bgAll.after().append('<div id="path-of-attraction-overlay-bg"></div>')
        }
    }]);
    return InteractionsPoA
}();
$(function() {
    if (!$("body.page-path_of_attraction").length) return;
    new InteractionsPoA(pathOfAttractionData)
});
$(function() {
    if (!$("#events").length || !$("body.page-event").length || $(".page-panel").length) return;
    var activeEventKey = $("#events").attr("active");
    selectActiveTab();
    showActiveEvent();
    $(".event-title").on("click", function() {
        activeEventKey = $(this).attr("rel");
        clearCurrentEvent();
        selectActiveTab();
        showActiveEvent()
    });

    function selectActiveTab() {
        $(".event-title").removeClass("selected");
        $("[rel=" + activeEventKey + "]").addClass("selected");
        $("#events").attr("active", activeEventKey)
    }

    function showActiveEvent() {
        if (typeof eventData !== "undefined") {
            var activeEvent = eventData[activeEventKey];
            if (activeEvent.type === "mythic_event") {
                new MythicEvent(activeEvent)
            } else {
                new GenericEvent(activeEvent)
            }
        }
    }

    function clearCurrentEvent() {
        $(".event-contents").empty();
        $(".event-icons").empty();
        $(".event-timer").empty()
    }
});
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var EventWidget = function() {
    function EventWidget() {
        _classCallCheck(this, EventWidget);
        this.init()
    }
    _createClass(EventWidget, [{
        key: "_hasAnnivArenaGirl",
        value: function _hasAnnivArenaGirl(girlId) {
            girlId = parseInt(girlId, 10);
            return this.event_data.key == "anniv" && girlId == 823452
        }
    }, {
        key: "_isGirlFromTroll",
        value: function _isGirlFromTroll(gData) {
            if (girlsDataList[gData.id_girl]) {
                return false
            }
            if (!gData.troll || !gData.troll.name) {
                return false
            }
            return true
        }
    }, {
        key: "init",
        value: function init() {
            if (typeof event_path_of_attraction != "undefined") {
                this.initPathOfAttraction()
            }
            if (typeof event_data != "undefined") {
                this.initEventWidget()
            } else if (typeof event_coming_soon != "undefined") {
                this.initComingSoon(event_coming_soon)
            }
            if (typeof mythic_event_data != "undefined") {
                this.initMythicEvent()
            } else if (typeof mythic_coming_soon != "undefined") {
                this.initComingSoon(mythic_coming_soon)
            }
            if (typeof kinky_event_data != "undefined") {
                this.initKCEvent()
            } else if (typeof kinky_coming_soon != "undefined") {
                this.initComingSoon(kinky_coming_soon)
            }
        }
    }, {
        key: "initComingSoon",
        value: function initComingSoon(data) {
            this.initThumbnailTimer(data)
        }
    }, {
        key: "initMythicEvent",
        value: function initMythicEvent() {
            this.initThumbnailTimer(mythic_event_data);
            $(document).on("click", '[rel="' + mythic_event_data.type + '"]', function() {
                document.location.href = "/event.html"
            })
        }
    }, {
        key: "initKCEvent",
        value: function initKCEvent() {
            this.initThumbnailTimer(kinky_event_data);
            $(document).on("click", '[rel="' + kinky_event_data.type + '"]', function() {
                document.location.href = "/event.html"
            })
        }
    }, {
        key: "initEventWidget",
        value: function initEventWidget() {
            var _this = this;
            this.event_data = event_data;
            if (typeof event_mission_data != "undefined") {
                this.mission_data = event_mission_data
            }
            $(document).on("click", '[rel="' + this.event_data.type + '"], .event-widget .widget a.close_cross', function() {
                _this.toggleWidgetState()
            });
            this.initThumbnailTimer(this.event_data);
            this.bodyConstructorWidget();
            var totalRewardsNum = $('[type_reward="item"]').length + $('[type_reward="girl"]').length;
            if (totalRewardsNum > 6) {
                var calcWidthTape = totalRewardsNum * 71;
                $(".rewards-block-tape").css({
                    width: calcWidthTape + "px",
                    "padding-right": "8px"
                })
            }
        }
    }, {
        key: "initPathOfAttraction",
        value: function initPathOfAttraction() {
            this.initThumbnailTimer(event_path_of_attraction);
            $(document).on("click", '[rel="' + event_path_of_attraction.type + '"]', function() {
                document.location.href = "/path-of-attraction.html"
            })
        }
    }, {
        key: "initThumbnailTimer",
        value: function initThumbnailTimer(data) {
            var requestedTimer = $(".event-timer.bar-wrapper").find('[rel="' + data.type + '"]');
            this.setEventTimes(data);
            if (requestedTimer.length && this.remainingTime > 0) {
                HHTimers.initBarTimer(this.totalEventDuration, this.remainingTime, requestedTimer, {
                    barElm: requestedTimer.find(".bar.progress-timer"),
                    textElm: requestedTimer.find('[rel="count"]')
                }, reload)
            }
        }
    }, {
        key: "initWidgetTimer",
        value: function initWidgetTimer(shouldInitiateTimer) {
            var requestedTimer = $(".event-timer-widged.bar-wrapper");
            if (requestedTimer.length && this.remainingTime > 0 && shouldInitiateTimer && !this.widgetTimer) {
                this.widgetTimer = HHTimers.initBarTimer(this.totalEventDuration, this.remainingTime, requestedTimer, {
                    barElm: requestedTimer.find(".bar.red"),
                    textElm: requestedTimer.find('[rel="count"]')
                }, reload)
            }
        }
    }, {
        key: "toggleWidgetState",
        value: function toggleWidgetState() {
            this.setEventTimes();
            $(".event-widget .widget").toggle();
            $(".event-thumbnail").toggle();
            var isVisible = $(".event-widget .widget").is(":visible");
            this.initWidgetTimer(isVisible);
            if (isVisible) {
                if (is_mobile_device()) {
                    $(".event-widget .widget .scroll-area").css("overflow", "auto")
                } else {
                    $(".event-widget .widget .scroll-area").niceScroll().resize()
                }
            }
        }
    }, {
        key: "setEventTimes",
        value: function setEventTimes(data) {
            var event_data = data || this.event_data;
            this.remainingTime = event_data.seconds_until_event_end || event_data.seconds_until_event_start;
            this.totalEventDuration = event_data.event_duration_seconds || event_data.total_time_seconds
        }
    }, {
        key: "bodyConstructorWidget",
        value: function bodyConstructorWidget() {
            var _this2 = this;
            $(".rewards-block-tape").append(this.buildTapeWithRewards());
            $(".rewards-stats").append(this.buildRewardsStats());
            $(".rewards-block-tape > div").on("click", function(event) {
                var $element = $(event.target);
                if (!$element.is("[active_view]")) {
                    _this2.pushInfoToBuildRewardContent(event)
                }
            })
        }
    }, {
        key: "buildTapeWithRewards",
        value: function buildTapeWithRewards() {
            var body = "";
            var countRewardSlots = 0;
            if (this.event_data.rewards) {
                countRewardSlots++;
                var wasRewardWon = this.mission_data.done_missions_count >= this.mission_data.need_done && this.mission_data.missions_reward_collected ? "reward_was_won" : "";
                body += '\n\t\t\t\t<div type_reward="item" ' + wasRewardWon + ' class="set_items_box">\n\t\t\t\t\t<img src="' + IMAGES_URL + '/pictures/misc/events/calendar_revival.png">\n\t\t\t\t</div>\n\t\t\t'
            }
            var girlsHtmlArray = [];
            for (var girlIndex = 0; girlIndex < this.event_data.girls.length; girlIndex++) {
                var currentGirl = this.event_data.girls[girlIndex];
                if (girlsDataList[currentGirl.id_girl]) currentGirl.owned_girl = true;
                var order = 0;
                if (currentGirl.is_missions_reward || currentGirl.is_legendary_contest_reward) order = 1;
                else if (currentGirl.troll) order = 2;
                else if (currentGirl.is_pachinko_reward) order = 3;
                var html = "\n\t\t\t\t<div " + (girlIndex == 0 ? "active_view" : "") + '\n\t\t\t\t\ttype_reward="girl" index="' + girlIndex + '"\n\t\t\t\t\tgirl="' + currentGirl.id_girl + '"\n\t\t\t\t\trarity="' + currentGirl.rarity + '"\n\t\t\t\t\t' + (currentGirl.owned_girl ? "reward_was_won" : "") + '\n\t\t\t\t\tclass="girl_reward"\n\t\t\t\t>\n\n\t\t\t\t\t<img src="' + currentGirl.ico.toImageUrl("ico") + '" class="girl_ava">\n\t\t\t\t</div>\n\t\t\t';
                girlsHtmlArray.push({
                    order: order,
                    html: html,
                    rarity: currentGirl.rarity
                });
                countRewardSlots++
            }
            for (var i = 0; i < girlsHtmlArray.length; i++) {
                if (girlsHtmlArray[i].rarity == "legendary") {
                    girlsHtmlArray[i].order = 4
                }
            }
            girlsHtmlArray.sort(function(a, b) {
                var a_order = a.order;
                var b_order = b.order;
                return a_order - b_order
            });
            for (var index = 0; index < girlsHtmlArray.length; index++) {
                body += girlsHtmlArray[index].html
            }
            if (countRewardSlots < 6) {
                for (var step = 0; step < 6 - countRewardSlots; step++) {
                    body += '<div class="empty-flex-element"></div>'
                }
            }
            return body
        }
    }, {
        key: "buildRewardsStats",
        value: function buildRewardsStats() {
            var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "girl";
            var index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
            var body = "";
            switch (type) {
                case "item":
                    var itemsData = this.event_data.rewards.data.rewards;
                    var html = "";
                    for (var i = 0; i < itemsData.length; i++) {
                        html += itemsData[i].value
                    }
                    body += this.buildItemReward(html);
                    break;
                case "girl":
                    var girlData = this.event_data.girls[index];
                    body += this.buildGirlReward(girlData);
                    break
            }
            return body
        }
    }, {
        key: "buildGirlReward",
        value: function buildGirlReward(gData) {
            if (typeof gData == "undefined") {
                return ""
            }
            var pathButton = {
                name: "",
                path: "",
                href: "",
                disabled: false
            };
            var is_troll_girl = this._isGirlFromTroll(gData);
            if (this._hasAnnivArenaGirl(gData.id_girl) && !girlsDataList[gData.id_girl]) {
                pathButton.path = "arena";
                pathButton.name = GT.design.Season;
                pathButton.href = "/season-arena.html"
            } else if (gData.is_missions_reward && !this.mission_data.missions_reward_collected) {
                pathButton.path = "missions";
                pathButton.name = GT.design.missions;
                pathButton.href = "/activities.html?tab=missions"
            } else if (gData.is_legendary_contest_reward && !girlsDataList[gData.id_girl]) {
                pathButton.path = "contests";
                pathButton.name = GT.design.contests;
                pathButton.href = "/activities.html?tab=contests"
            } else if (is_troll_girl) {
                pathButton.path = "troll";
                pathButton.name = gData.troll.name;
                pathButton.href = "/battle.html?id_troll=" + gData.troll.id_troll;
                if (Hero.infos.questing.id_world - 1 < parseInt(gData.troll.id_troll, 10)) {
                    pathButton.disabled = true;
                    pathButton.href = ""
                }
            } else if (gData.is_pachinko_reward && !girlsDataList[gData.id_girl]) {
                pathButton.path = "pachinko";
                pathButton.name = GT.design.Pachinko;
                pathButton.href = "/pachinko.html"
            } else if (girlsDataList[gData.id_girl]) {
                pathButton.path = "harem";
                pathButton.name = GT.design.Harem;
                pathButton.href = "/harem/" + gData.id_girl
            } else {
                console.log("Unsupported case: this girl is not in missions, troll, pachinko and the player does not have her.")
            }
            var GirlClass = new Girl(gData);
            var linkAttribute = GirlClass._getGirlLinkIfAvailable(gData);
            var winShardHtml = RewardsBuilder.buildShardsDisplay(gData.shards, gData.name, null, true);
            var body = this.buildGirlBiggestAvatar(gData) + " " + winShardHtml + '\n\t\t\t<div class="dialog-box girl" ' + linkAttribute + ">" + this.buildGirlMessageDialogBox(gData) + '</div>\n\t\t\t<div class="reward-information">\n\t\t\t\t<h3 class="name-reward">' + gData.name + '</h3>\n\n\t\t\t\t<div class="carac_girl">\n\t\t\t\t\t<div carac="1">' + gData.caracs.carac1 + '</div>\n\t\t\t\t\t<div carac="2">' + gData.caracs.carac2 + '</div>\n\t\t\t\t\t<div carac="3">' + gData.caracs.carac3 + '</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="icons-info">\n\t\t\t\t\t<img class="skill" src="' + IMAGES_URL + "/caracs/" + girlsSkillImages[gData.class - 1] + '">\n\t\t\t\t\t<img class="position" src="' + getBattlePositionImagePath(gData.figure) + '">\n\t\t\t\t\t<div carac="' + gData.class + '"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<a go_to="' + pathButton.path + '" href="' + pathButton.href + '" event_reward_id="' + gData.id_girl + '">\n\t\t\t\t<button class="blue_button_L"  ' + (pathButton.disabled ? "disabled" : "") + ">";
            var gotoGetextVar = GT.design.town_event_goto;
            switch (pathButton.path) {
                case "troll":
                    gotoGetextVar = GT.design.town_event_goto_troll;
                    break;
                case "missions":
                case "contests":
                    gotoGetextVar = GT.design.town_event_goto_missions;
                    break
            }
            body += gotoGetextVar + " " + pathButton.name;
            body += "</button>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t";
            return body
        }
    }, {
        key: "buildGirlBiggestAvatar",
        value: function buildGirlBiggestAvatar(girlData) {
            var positioningUpwards = "";
            if (isGirlInCollection(girlData.id_girl, SITTING_GIRLS_AVATARS_IDS)) {
                positioningUpwards = "avatars-drawn-bottom-part"
            }
            var html = '<div class="reward ' + positioningUpwards + '">\n\t\t\t\t\t\t<img src="' + girlData.avatar.toImageUrl("ava") + '">\n\t\t\t\t\t</div>';
            return html
        }
    }, {
        key: "buildItemReward",
        value: function buildItemReward(html) {
            var body = '\n\t\t\t<div class="special_position_items">\n\t\t\t\t<div class="dialog-box">\n\t\t\t\t';
            if (this.mission_data.done_missions_count < this.mission_data.need_done) {
                var GT_itemsDialogboxLeftDays = this.getMissionsText(GT.design.event_missions_getme_all_items);
                body += "<p>" + GT_itemsDialogboxLeftDays + "</p>"
            } else {
                if (this.mission_data.missions_reward_collected) {
                    body += "<p>" + GT.design.items_event_ready_equip + "</p>"
                } else {
                    body += "<p>" + this.getMissionsWaitText() + "</p>"
                }
            }
            body += '\n\t\t\t\t</div>\n\n\t\t\t\t<div class="items-container">\n\t\t\t\t\t' + html + "\n\t\t\t\t</div>";
            if (this.mission_data.missions_reward_collected) {
                body += '\n\t\t\t\t\t<a go_to="missions" href="/shop.html">\n\t\t\t\t\t\t<button class="blue_button_L">' + GT.design.town_event_goto + " " + GT.design.Market + "</button>\n\t\t\t\t\t</a>"
            } else {
                body += '\n\t\t\t\t\t<a go_to="missions" href="/activities.html?tab=missions">\n\t\t\t\t\t\t<button class="blue_button_L">' + GT.design.town_event_goto_missions + " " + GT.design.missions + "</button>\n\t\t\t\t\t</a>"
            }
            body += "</div>";
            return body
        }
    }, {
        key: "buildGirlMessageDialogBox",
        value: function buildGirlMessageDialogBox(gData) {
            var body = "";
            if (gData.owned_girl) {
                body += "<p>" + GT.design.girl_town_event_owned_v2 + "</p>";
                return body
            }
            if (gData.is_missions_reward && this.mission_data.done_missions_count >= this.mission_data.need_done) {
                body += "<p>" + this.getMissionsWaitText() + "</p>";
                return body
            }
            if (gData.is_missions_reward) {
                body += "<p>" + this.getMissionsText() + "</p>"
            } else {
                body += "<p>" + gData.source_sentence + "</p>"
            }
            return body
        }
    }, {
        key: "getMissionsWaitText",
        value: function getMissionsWaitText() {
            var text = GT.design.items_wait_finalday_event;
            return text.replace("[num_missions_done]", this.mission_data.need_done)
        }
    }, {
        key: "getMissionsText",
        value: function getMissionsText(text) {
            text = text || GT.design.event_missions_getme_all_girl;
            text += "<br>";
            text += GT.design.event_missions_getme_completion;
            text = text.replace("[num_missions_reward]", this.mission_data.need_done);
            text = text.replace("[num_missions_total]", this.mission_data.need_done);
            text = text.replace("[num_missions_done]", this.mission_data.done_missions_count);
            return text
        }
    }, {
        key: "pushInfoToBuildRewardContent",
        value: function pushInfoToBuildRewardContent(event) {
            var $clicked = $(event.target);
            var type_reward = $clicked.attr("type_reward");
            $(".rewards-block-tape > div").removeAttr("active_view");
            $clicked.attr("active_view", "");
            var body = "";
            switch (type_reward) {
                case "item":
                    body = this.buildRewardsStats(type_reward, null);
                    $(".rewards-stats > *").fadeOut();
                    $(".rewards-stats > *").remove();
                    $(".rewards-stats").append(body);
                    break;
                case "girl":
                    var girl_index = $clicked.attr("index");
                    var girl_id = $clicked.attr("girl");
                    body += this.buildRewardsStats(type_reward, girl_index);
                    $(".rewards-stats > *").fadeOut();
                    $(".rewards-stats > *").remove();
                    $(".rewards-stats").append(body);
                    break;
                default:
                    this.buildRewardsStats("girl", 0)
            }
        }
    }]);
    return EventWidget
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var GenericEvent = function() {
    function GenericEvent() {
        var eventData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        _classCallCheck(this, GenericEvent);
        this.handleProblems(eventData);
        this.setEventData(eventData);
        this.initEventTimer();
        this.buildContent()
    }
    _createClass(GenericEvent, [{
        key: "handleProblems",
        value: function handleProblems(eventData) {
            if (!eventData || Object.keys(eventData).length === 0) {
                throw new Error("No event data")
            } else if (eventData.girls.length < 1) {
                throw new Error(eventData.girlMissingErrorMessage || "An event girl is not available right now.")
            }
        }
    }, {
        key: "setEventData",
        value: function setEventData(eventData) {
            this.eventData = eventData;
            this.prizeGirls = this.eventData.girls;
            this.contentRoot = $(".event-contents");
            this.iconsRoot = $(".event-icons");
            this.activeGirl = this.prizeGirls[0]
        }
    }, {
        key: "buildContent",
        value: function buildContent() {
            this.contentRoot.append(this.buildPrizeGirls());
            this.iconsRoot.append(this.buildGirlIcons());
            if (this.prizeGirls.length > 1) {
                this.handleIconClicking()
            }
        }
    }, {
        key: "buildPrizeGirls",
        value: function buildPrizeGirls() {
            var winShardHtml = RewardsBuilder.buildShardsDisplay(this.activeGirl.shards, this.activeGirl.name, null, true);
            var starsHtml = "";
            for (var star = 0; star < this.activeGirl.nb_grades; star++) {
                starsHtml += this.activeGirl.graded <= star ? '<g class="grey"></g>' : "<g></g>"
            }
            var incomeHtml = "";
            if (this.isGirlOwned()) {
                incomeHtml = '\n\t\t\t\t<div class="girl-income">\n\t\t\t\t\t' + GT.design.haremdex_income + ': <span cur="soft_currency"></span> ' + this.activeGirl.salary_per_hour + "/" + GT.time.h + "\n\t\t\t\t</div>"
            }
            var body = this.buildGirlBiggestAvatar() + " " + winShardHtml + "\n\t\t\t" + this.buildGirlInfo() + '\n\t\t\t<div class="girl-where-to-find">\n\t\t\t\t' + this.buildWhereToFindText() + "\n\t\t\t\t" + this.generateButtons() + "\n\t\t\t</div>\n\t\t";
            return body
        }
    }, {
        key: "generateButtons",
        value: function generateButtons() {
            var _this = this;
            var pathButtons = this.createButtonDetails();
            var buttons = "";
            pathButtons.forEach(function(_ref) {
                var path = _ref.path,
                    href = _ref.href,
                    disabled = _ref.disabled,
                    name = _ref.name;
                buttons += '\n            <a go_to="' + path + '" href="' + href + '" event_reward_id="' + _this.activeGirl.id_girl + '">\n                <button class="blue_button_L"  ' + (disabled ? "disabled" : "") + ">\n                    " + GT.design.town_event_goto_troll + " " + name + "\n                </button>\n            </a>\n            "
            });
            return buttons
        }
    }, {
        key: "createButtonDetails",
        value: function createButtonDetails() {
            if (this.isGirlOwned()) {
                return [{
                    path: "harem",
                    name: GT.design.Harem,
                    href: "/harem/" + this.activeGirl.id_girl
                }]
            } else if (this._hasAnnivArenaGirl(this.activeGirl.id_girl)) {
                return [{
                    path: "arena",
                    name: GT.design.Season,
                    href: "/season-arena.html"
                }]
            } else if (this.activeGirl.is_missions_reward && !this.mission_data.missions_reward_collected) {
                return [{
                    path: "missions",
                    name: GT.design.missions,
                    href: "/activities.html?tab=missions"
                }]
            } else if (this.activeGirl.is_legendary_contest_reward) {
                return [{
                    path: "contests",
                    name: GT.design.contests,
                    href: "/activities.html?tab=contests"
                }]
            } else if (this._isGirlFromTroll()) {
                if (Hero.infos.questing.id_world - 1 < parseInt(this.activeGirl.troll.id_troll, 10)) {
                    return [{
                        path: "troll",
                        name: this.activeGirl.troll.name,
                        href: "",
                        disabled: true
                    }]
                } else {
                    return [{
                        path: "troll",
                        name: this.activeGirl.troll.name,
                        href: "/battle.html?id_troll=" + this.activeGirl.troll.id_troll
                    }]
                }
            } else if (this.activeGirl.is_pachinko_reward) {
                return [{
                    path: "pachinko",
                    name: GT.design.Pachinko,
                    href: "/pachinko.html"
                }]
            } else if (this._isGirlFromKinkyCumpetition()) {
                return [{
                    path: "season",
                    name: GT.design.Seasons,
                    href: "season-arena.html"
                }, {
                    path: "leagues",
                    name: GT.design.leagues_name,
                    href: "tower-of-fame.html"
                }]
            } else {
                console.log("Unsupported case: this girl is not in missions, troll, pachinko, kinky cumpetition and the player does not have her.");
                return [{
                    path: "",
                    name: "",
                    href: "",
                    disabled: true
                }]
            }
        }
    }, {
        key: "_hasAnnivArenaGirl",
        value: function _hasAnnivArenaGirl(girlId) {
            girlId = parseInt(girlId, 10);
            return this.eventData.key == "anniv" && girlId == 823452
        }
    }, {
        key: "_isGirlFromTroll",
        value: function _isGirlFromTroll() {
            if (this.isGirlOwned()) {
                return false
            }
            if (!this.activeGirl.troll || !this.activeGirl.troll.name) {
                return false
            }
            return true
        }
    }, {
        key: "_isGirlFromKinkyCumpetition",
        value: function _isGirlFromKinkyCumpetition() {
            return this.activeGirl.is_kinky_reward === true
        }
    }, {
        key: "isGirlOwned",
        value: function isGirlOwned() {
            return this.activeGirl.shards >= 100
        }
    }, {
        key: "buildGirlBiggestAvatar",
        value: function buildGirlBiggestAvatar() {
            var positioningUpwards = "";
            if (isGirlInCollection(this.activeGirl.id_girl, SITTING_GIRLS_AVATARS_IDS)) {
                positioningUpwards = "avatars-drawn-bottom-part"
            }
            var html = '\n            <div class="generic-girl-image ' + positioningUpwards + '">\n                <img src="' + this.activeGirl.avatar.toImageUrl("ava") + '">\n            </div>';
            return html
        }
    }, {
        key: "buildGirlInfo",
        value: function buildGirlInfo() {
            var body = '\n            <div class="new_girl_info rarity-styling ' + this.activeGirl.rarity + '-border">\n                <h5 class="' + this.activeGirl.rarity + '-text">' + this.activeGirl.name + '</h5>\n                <div class="girl_tooltip_level ' + this.activeGirl.rarity + '-text">< ' + this.activeGirl.level + " " + GT.design.Lvl + " " + GT.design["girls_rarity_" + this.activeGirl.rarity] + " " + GT.design.girl + ' ></div>\n                <div class="girl_tooltip_grade">' + this.activeGirl.Graded2 + '</div>\n                <div class="icons girl_tooltip_positions">\n                    <span carac="carac' + this.activeGirl.class + '"></span>\n                    <div class="girl_tooltip_img_container">\n                        <img class="position" src="' + getBattlePositionImagePath(this.activeGirl.position_img) + '">\n                    </div>\n                </div>\n                <div class="caracs">\n                    <span carac="carac1"><span>' + formatGirlCarac(this.activeGirl.caracs.carac1) + '</span></span>\n                    <span carac="carac2"><span>' + formatGirlCarac(this.activeGirl.caracs.carac2) + '</span></span>\n                    <span carac="carac3"><span>' + formatGirlCarac(this.activeGirl.caracs.carac3) + '</span></span>\n                </div>\n                <div class="income">\n                    ' + GT.design.haremdex_income + ':\n                    <span><span cur="soft_currency"></span>' + number_format_lang(this.activeGirl.salary_per_hour) + "/" + GT.time.h + "</span>\n                </div>\n            </div>";
            return body
        }
    }, {
        key: "initEventTimer",
        value: function initEventTimer() {
            var requestedTimer = $(".event-timer");
            if (requestedTimer.length && this.eventData.seconds_until_event_end > 0) {
                HHTimers.initSimpleTimerTxt(requestedTimer.find('[rel="count"]'), this.eventData.seconds_until_event_end, reload)
            }
        }
    }, {
        key: "buildWhereToFindText",
        value: function buildWhereToFindText() {
            var text = "";
            if (this.isGirlOwned()) {
                text += "<p>" + GT.design.girl_town_event_owned_v2 + "</p>";
                return text
            }
            text += "<p>" + this.activeGirl.source_sentence + "</p>";
            text = text.replace("[leagues]", GT.design.leagues_name).replace("[seasons]", GT.design.Season);
            return text
        }
    }, {
        key: "buildGirlIcons",
        value: function buildGirlIcons() {
            var _this2 = this;
            var body = "";
            this.prizeGirls.forEach(function(girl, girlIndex) {
                body += "\n                <div " + (girlIndex == 0 ? "active_view" : "") + '\n                    girl="' + girl.id_girl + '"\n                    rarity="' + girl.rarity + '"\n                    girl_index="' + girlIndex + '"\n                    ' + (girl.shards >= 100 ? "reward_was_won" : "") + '\n                    class="girl_reward ' + (_this2.prizeGirls.length > 1 ? "girl-hoverable" : "") + '"\n\t\t\t    >\n\n\t\t\t\t<img src="' + girl.ico.toImageUrl("ico") + '" class="girl_ava">\n\t\t\t</div>'
            });
            return body
        }
    }, {
        key: "handleIconClicking",
        value: function handleIconClicking() {
            var _this3 = this;
            $(".event-icons > div").on("click", function(event) {
                var $element = $(event.target);
                $(".event-icons > div").removeAttr("active_view");
                $element.attr("active_view", "");
                _this3.changeActiveGirl($element.attr("girl_index"))
            })
        }
    }, {
        key: "changeActiveGirl",
        value: function changeActiveGirl(girlIndex) {
            this.activeGirl = this.prizeGirls[girlIndex];
            this.contentRoot.empty();
            this.contentRoot.append(this.buildPrizeGirls())
        }
    }]);
    return GenericEvent
}();
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass)
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass
}
var MythicEvent = function(_GenericEvent) {
    _inherits(MythicEvent, _GenericEvent);

    function MythicEvent(eventData) {
        _classCallCheck(this, MythicEvent);
        eventData.girlMissingErrorMessage = "A Mythic girl is not available right now.";
        var _this = _possibleConstructorReturn(this, (MythicEvent.__proto__ || Object.getPrototypeOf(MythicEvent)).call(this, eventData));
        _this.buildMythicContent();
        if (_this.eventData.event_data.next_tranche) {
            _this.initNextTrancheTimer()
        }
        return _this
    }
    _createClass(MythicEvent, [{
        key: "buildMythicContent",
        value: function buildMythicContent() {
            this.contentRoot.append(this.buildTotalShardsDisplay());
            this.contentRoot.append(this.buildNextTrancheDisplay())
        }
    }, {
        key: "initNextTrancheTimer",
        value: function initNextTrancheTimer() {
            var requestedTimer = $(".mythic-shards-next-tranche");
            if (requestedTimer.length && this.eventData.event_data.next_tranche_in > 0) {
                HHTimers.initSimpleTimerTxt(requestedTimer.find('[rel="count"]'), this.eventData.event_data.next_tranche_in, reload)
            }
        }
    }, {
        key: "buildTotalShardsDisplay",
        value: function buildTotalShardsDisplay() {
            var shardsRemaining = number_format_lang(this.eventData.event_data.shards_available);
            var body = '\n\t\t\t<div class="mythic-girl-total-shards">\n\t\t\t\t' + GT.design.event_total_shards_remaining + " <span>" + shardsRemaining + "</span>\n\t\t\t</div>\n\t\t";
            return body
        }
    }, {
        key: "buildNextTrancheDisplay",
        value: function buildNextTrancheDisplay() {
            var body = '<div class="mythic-shards-next-tranche">';
            if (!this.eventData.event_data.next_tranche) {
                body += GT.design.event_shards_last_tranche
            } else {
                var trancheAmount = number_format_lang(this.eventData.event_data.tranche_shards);
                body += "<span>" + trancheAmount + "</span> " + GT.design.event_shards_next_tranche + ' <span rel="count"></span>'
            }
            return body + "</div>"
        }
    }]);
    return MythicEvent
}(GenericEvent);
$(function() {
    if (!$("#ticketing-page").length) return;
    var __ = Phoenix.__.Ticketing;
    var params = {
        call: "Ticketing",
        ph_ajax: "Phoenix\\Ticketing\\Ticketing"
    };
    if ($("form#create_ticket").length) {
        $(".support__ticket-form #category select").selectric();
        $("form#create_ticket").submit(function(event) {
            event.preventDefault();
            var $form = $(this);
            var $sendTicket = $form.find('input[type="submit"]');
            $sendTicket.prop("disabled", true);
            var formInputs = {
                category: {
                    el: $form.find('#category select[name="ticket_category"]'),
                    appendTo: $form.find("#category > div > div.selectric"),
                    text: __.error_unfilled_category
                },
                subject: {
                    el: $form.find('input[name="ticket_subject"]'),
                    appendTo: "",
                    text: __.error_unfilled_subject
                }
            };
            var subject_length = formInputs.subject.el.val().length;
            if (subject_length > 80) {
                popup_message(__.error_long_subject + " " + subject_length);
                $sendTicket.prop("disabled", false);
                return
            }
            formInputs.category.val = formInputs.category.el.val();
            formInputs.subject.val = formInputs.subject.el.val();
            params.action = "post_ticket";
            var errors = [];
            for (var input in formInputs) {
                var _formInputs$input = formInputs[input],
                    el = _formInputs$input.el,
                    text = _formInputs$input.text,
                    appendTo = _formInputs$input.appendTo,
                    val = _formInputs$input.val;
                if (checkEmptyInputs(el, text, appendTo)) errors.push(input);
                else params[input] = val
            }
            if (errors.length) {
                $sendTicket.prop("disabled", false);
                return
            }
            var params_ajax = {
                type: "POST",
                url: "/support.html",
                dataType: "json",
                data: params
            };
            $.ajax(params_ajax).done(function(data) {
                if (!data.success) {
                    popup_message(data.error);
                    $sendTicket.prop("disabled", false)
                } else {
                    window.location = "/support.html?id_ticket=" + data.id_ticket
                }
            })
        })
    }
    if ($(".support__ticket").length) {
        var GET = _GET();
        var id_ticket = GET.id_ticket;
        $(".messages-history").niceScroll();
        $(".special-case-nicescroll").niceScroll();
        $(".special-case-nicescroll>textarea").on("input", function() {
            $(this).css("height", this.scrollHeight + "px")
        });
        $(".special-case-nicescroll>textarea").one("click", function() {
            $(".message .input-field").css({
                height: "220px"
            });
            $(".message .input-field .special-case-nicescroll").css({
                height: "218px"
            });
            $(".support__ticket .messages-history").css({
                height: "125px"
            });
            $(".support__ticket .messages-history").niceScroll()
        });
        $("#ticket-message-form").on("submit", function(event) {
            event.preventDefault();
            $('input[name="send_ticket_answer"]').prop("disabled", true);
            var message = $('textarea[name="ticket_answer"]').val();
            if (checkEmptyInputs($('textarea[name="ticket_answer"]'), __.error_unfilled_desc, $("#ticket-message-form div.message"))) {
                $('input[name="send_ticket_answer"]').prop("disabled", false);
                return
            }
            params.action = "post_answer";
            params.id_ticket = id_ticket;
            params.message = message;
            var params_ajax = {
                type: "POST",
                url: "/support.html",
                dataType: "json",
                data: params
            };
            $.ajax(params_ajax).done(function(data) {
                if (!data.success) {
                    popup_message(data.error);
                    $('input[name="send_ticket_answer"]').prop("disabled", false)
                } else {
                    location.reload()
                }
            })
        });
        if ($("#select-img-file").length) {
            var idLastMessage = $('input[name="last_message_id"]').val() ? $('input[name="last_message_id"]').val() : 0;
            params.action = "upload_file";
            params.id_ticket = id_ticket;
            var dropzone = new Dropzone("#select-img-file", {
                url: "/support.html",
                createImageThumbnails: false,
                previewsContainer: ".ticket-attachments",
                previewTemplate: '<p class="name-file"> ' + __.attach_text + ' <span class="file-name" data-dz-name></span> <span data-dz-errormessage></span></p>',
                renameFile: "files",
                maxFilesize: 5,
                acceptedFiles: "image/png,image/jpg,image/jpeg,text/plain",
                params: params,
                init: function init() {
                    this.on("complete", function(data) {
                        $(".support__ticket .messages-history").niceScroll().resize()
                    })
                }
            })
        }
    }
    if ($("#tickets_log > table > tbody.body-table tr").length > 8 || $(".ticket_table tbody.body-table tr").length > 8) $(".ticket-list__ticket-table-container").niceScroll();

    function checkEmptyInputs($input, message) {
        var $appendTo = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";
        var isEmpty = false;
        var $appendToEl = $($appendTo);
        var inputValue = $input.val();
        if (inputValue === null || inputValue.trim() == "") {
            if ($appendToEl.length) $input = $appendToEl;
            var widthMsg = $input.css("width");
            if ($input.siblings(".error-msg").length == 0) $input.after('<p class="error-msg" style="width: ' + widthMsg + '">' + message + "</p>");
            isEmpty = true
        }
        setTimeout(function() {
            $input.siblings(".error-msg").remove()
        }, 3e3);
        return isEmpty
    }
});
(function() {
    "use strict";

    function e() {}

    function t(e, t) {
        for (var n = e.length; n--;)
            if (e[n].listener === t) return n;
        return -1
    }

    function n(e) {
        return function() {
            return this[e].apply(this, arguments)
        }
    }
    var i = e.prototype,
        r = this,
        s = r.EventEmitter;
    i.getListeners = function(e) {
        var t, n, i = this._getEvents();
        if ("object" == typeof e) {
            t = {};
            for (n in i) i.hasOwnProperty(n) && e.test(n) && (t[n] = i[n])
        } else t = i[e] || (i[e] = []);
        return t
    }, i.flattenListeners = function(e) {
        var t, n = [];
        for (t = 0; t < e.length; t += 1) n.push(e[t].listener);
        return n
    }, i.getListenersAsObject = function(e) {
        var t, n = this.getListeners(e);
        return n instanceof Array && (t = {}, t[e] = n), t || n
    }, i.addListener = function(e, n) {
        var i, r = this.getListenersAsObject(e),
            s = "object" == typeof n;
        for (i in r) r.hasOwnProperty(i) && -1 === t(r[i], n) && r[i].push(s ? n : {
            listener: n,
            once: !1
        });
        return this
    }, i.on = n("addListener"), i.addOnceListener = function(e, t) {
        return this.addListener(e, {
            listener: t,
            once: !0
        })
    }, i.once = n("addOnceListener"), i.defineEvent = function(e) {
        return this.getListeners(e), this
    }, i.defineEvents = function(e) {
        for (var t = 0; t < e.length; t += 1) this.defineEvent(e[t]);
        return this
    }, i.removeListener = function(e, n) {
        var i, r, s = this.getListenersAsObject(e);
        for (r in s) s.hasOwnProperty(r) && (i = t(s[r], n), -1 !== i && s[r].splice(i, 1));
        return this
    }, i.off = n("removeListener"), i.addListeners = function(e, t) {
        return this.manipulateListeners(!1, e, t)
    }, i.removeListeners = function(e, t) {
        return this.manipulateListeners(!0, e, t)
    }, i.manipulateListeners = function(e, t, n) {
        var i, r, s = e ? this.removeListener : this.addListener,
            o = e ? this.removeListeners : this.addListeners;
        if ("object" != typeof t || t instanceof RegExp)
            for (i = n.length; i--;) s.call(this, t, n[i]);
        else
            for (i in t) t.hasOwnProperty(i) && (r = t[i]) && ("function" == typeof r ? s.call(this, i, r) : o.call(this, i, r));
        return this
    }, i.removeEvent = function(e) {
        var t, n = typeof e,
            i = this._getEvents();
        if ("string" === n) delete i[e];
        else if ("object" === n)
            for (t in i) i.hasOwnProperty(t) && e.test(t) && delete i[t];
        else delete this._events;
        return this
    }, i.removeAllListeners = n("removeEvent"), i.emitEvent = function(e, t) {
        var n, i, r, s, o = this.getListenersAsObject(e);
        for (r in o)
            if (o.hasOwnProperty(r))
                for (i = o[r].length; i--;) n = o[r][i], n.once === !0 && this.removeListener(e, n.listener), s = n.listener.apply(this, t || []), s === this._getOnceReturnValue() && this.removeListener(e, n.listener);
        return this
    }, i.trigger = n("emitEvent"), i.emit = function(e) {
        var t = Array.prototype.slice.call(arguments, 1);
        return this.emitEvent(e, t)
    }, i.setOnceReturnValue = function(e) {
        return this._onceReturnValue = e, this
    }, i._getOnceReturnValue = function() {
        return this.hasOwnProperty("_onceReturnValue") ? this._onceReturnValue : !0
    }, i._getEvents = function() {
        return this._events || (this._events = {})
    }, e.noConflict = function() {
        return r.EventEmitter = s, e
    }, "function" == typeof define && define.amd ? define("eventEmitter/EventEmitter", [], function() {
        return e
    }) : "object" == typeof module && module.exports ? module.exports = e : this.EventEmitter = e
}).call(this),
    function(e) {
        function t(t) {
            var n = e.event;
            return n.target = n.target || n.srcElement || t, n
        }
        var n = document.documentElement,
            i = function() {};
        n.addEventListener ? i = function(e, t, n) {
            e.addEventListener(t, n, !1)
        } : n.attachEvent && (i = function(e, n, i) {
            e[n + i] = i.handleEvent ? function() {
                var n = t(e);
                i.handleEvent.call(i, n)
            } : function() {
                var n = t(e);
                i.call(e, n)
            }, e.attachEvent("on" + n, e[n + i])
        });
        var r = function() {};
        n.removeEventListener ? r = function(e, t, n) {
            e.removeEventListener(t, n, !1)
        } : n.detachEvent && (r = function(e, t, n) {
            e.detachEvent("on" + t, e[t + n]);
            try {
                delete e[t + n]
            } catch (i) {
                e[t + n] = void 0
            }
        });
        var s = {
            bind: i,
            unbind: r
        };
        "function" == typeof define && define.amd ? define("eventie/eventie", s) : e.eventie = s
    }(this),
    function(e, t) {
        "use strict";
        "function" == typeof define && define.amd ? define(["eventEmitter/EventEmitter", "eventie/eventie"], function(n, i) {
            return t(e, n, i)
        }) : "object" == typeof module && module.exports ? module.exports = t(e, require("wolfy87-eventemitter"), require("eventie")) : e.imagesLoaded = t(e, e.EventEmitter, e.eventie)
    }(window, function(e, t, n) {
        function i(e, t) {
            for (var n in t) e[n] = t[n];
            return e
        }

        function r(e) {
            return "[object Array]" == f.call(e)
        }

        function s(e) {
            var t = [];
            if (r(e)) t = e;
            else if ("number" == typeof e.length)
                for (var n = 0; n < e.length; n++) t.push(e[n]);
            else t.push(e);
            return t
        }

        function o(e, t, n) {
            if (!(this instanceof o)) return new o(e, t, n);
            "string" == typeof e && (e = document.querySelectorAll(e)), this.elements = s(e), this.options = i({}, this.options), "function" == typeof t ? n = t : i(this.options, t), n && this.on("always", n), this.getImages(), u && (this.jqDeferred = new u.Deferred);
            var r = this;
            setTimeout(function() {
                r.check()
            })
        }

        function h(e) {
            this.img = e
        }

        function a(e, t) {
            this.url = e, this.element = t, this.img = new Image
        }
        var u = e.jQuery,
            c = e.console,
            f = Object.prototype.toString;
        o.prototype = new t, o.prototype.options = {}, o.prototype.getImages = function() {
            this.images = [];
            for (var e = 0; e < this.elements.length; e++) {
                var t = this.elements[e];
                this.addElementImages(t)
            }
        }, o.prototype.addElementImages = function(e) {
            "IMG" == e.nodeName && this.addImage(e), this.options.background === !0 && this.addElementBackgroundImages(e);
            var t = e.nodeType;
            if (t && d[t]) {
                for (var n = e.querySelectorAll("img"), i = 0; i < n.length; i++) {
                    var r = n[i];
                    this.addImage(r)
                }
                if ("string" == typeof this.options.background) {
                    var s = e.querySelectorAll(this.options.background);
                    for (i = 0; i < s.length; i++) {
                        var o = s[i];
                        this.addElementBackgroundImages(o)
                    }
                }
            }
        };
        var d = {
            1: !0,
            9: !0,
            11: !0
        };
        o.prototype.addElementBackgroundImages = function(e) {
            for (var t = m(e), n = /url\(['"]*([^'"\)]+)['"]*\)/gi, i = n.exec(t.backgroundImage); null !== i;) {
                var r = i && i[1];
                r && this.addBackground(r, e), i = n.exec(t.backgroundImage)
            }
        };
        var m = e.getComputedStyle || function(e) {
            return e.currentStyle
        };
        return o.prototype.addImage = function(e) {
            var t = new h(e);
            this.images.push(t)
        }, o.prototype.addBackground = function(e, t) {
            var n = new a(e, t);
            this.images.push(n)
        }, o.prototype.check = function() {
            function e(e, n, i) {
                setTimeout(function() {
                    t.progress(e, n, i)
                })
            }
            var t = this;
            if (this.progressedCount = 0, this.hasAnyBroken = !1, !this.images.length) return void this.complete();
            for (var n = 0; n < this.images.length; n++) {
                var i = this.images[n];
                i.once("progress", e), i.check()
            }
        }, o.prototype.progress = function(e, t, n) {
            this.progressedCount++, this.hasAnyBroken = this.hasAnyBroken || !e.isLoaded, this.emit("progress", this, e, t), this.jqDeferred && this.jqDeferred.notify && this.jqDeferred.notify(this, e), this.progressedCount == this.images.length && this.complete(), this.options.debug && c && c.log("progress: " + n, e, t)
        }, o.prototype.complete = function() {
            var e = this.hasAnyBroken ? "fail" : "done";
            if (this.isComplete = !0, this.emit(e, this), this.emit("always", this), this.jqDeferred) {
                var t = this.hasAnyBroken ? "reject" : "resolve";
                this.jqDeferred[t](this)
            }
        }, h.prototype = new t, h.prototype.check = function() {
            var e = this.getIsImageComplete();
            return e ? void this.confirm(0 !== this.img.naturalWidth, "naturalWidth") : (this.proxyImage = new Image, n.bind(this.proxyImage, "load", this), n.bind(this.proxyImage, "error", this), n.bind(this.img, "load", this), n.bind(this.img, "error", this), void(this.proxyImage.src = this.img.src))
        }, h.prototype.getIsImageComplete = function() {
            return this.img.complete && void 0 !== this.img.naturalWidth
        }, h.prototype.confirm = function(e, t) {
            this.isLoaded = e, this.emit("progress", this, this.img, t)
        }, h.prototype.handleEvent = function(e) {
            var t = "on" + e.type;
            this[t] && this[t](e)
        }, h.prototype.onload = function() {
            this.confirm(!0, "onload"), this.unbindEvents()
        }, h.prototype.onerror = function() {
            this.confirm(!1, "onerror"), this.unbindEvents()
        }, h.prototype.unbindEvents = function() {
            n.unbind(this.proxyImage, "load", this), n.unbind(this.proxyImage, "error", this), n.unbind(this.img, "load", this), n.unbind(this.img, "error", this)
        }, a.prototype = new h, a.prototype.check = function() {
            n.bind(this.img, "load", this), n.bind(this.img, "error", this), this.img.src = this.url;
            var e = this.getIsImageComplete();
            e && (this.confirm(0 !== this.img.naturalWidth, "naturalWidth"), this.unbindEvents())
        }, a.prototype.unbindEvents = function() {
            n.unbind(this.img, "load", this), n.unbind(this.img, "error", this)
        }, a.prototype.confirm = function(e, t) {
            this.isLoaded = e, this.emit("progress", this, this.element, t)
        }, o.makeJQueryPlugin = function(t) {
            t = t || e.jQuery, t && (u = t, u.fn.imagesLoaded = function(e, t) {
                var n = new o(this, e, t);
                return n.jqDeferred.promise(u(this))
            })
        }, o.makeJQueryPlugin(), o
    });
! function(e) {
    "function" == typeof define && define.amd ? define(["jquery"], e) : "object" == typeof module && module.exports ? module.exports = function(t, s) {
        return void 0 === s && (s = "undefined" != typeof window ? require("jquery") : require("jquery")(t)), e(s), s
    } : e(jQuery)
}(function(e) {
    "use strict";
    var t = e(document),
        s = e(window),
        i = "selectric",
        l = "Input Items Open Disabled TempShow HideSelect Wrapper Focus Hover Responsive Above Scroll Group GroupLabel",
        n = ".sl",
        a = ["a", "e", "i", "o", "u", "n", "c", "y"],
        o = [/[\xE0-\xE5]/g, /[\xE8-\xEB]/g, /[\xEC-\xEF]/g, /[\xF2-\xF6]/g, /[\xF9-\xFC]/g, /[\xF1]/g, /[\xE7]/g, /[\xFD-\xFF]/g],
        r = function(t, s) {
            var i = this;
            i.element = t, i.$element = e(t), i.state = {
                multiple: !!i.$element.attr("multiple"),
                enabled: !1,
                opened: !1,
                currValue: -1,
                selectedIdx: -1,
                highlightedIdx: -1
            }, i.eventTriggers = {
                open: i.open,
                close: i.close,
                destroy: i.destroy,
                refresh: i.refresh,
                init: i.init
            }, i.init(s)
        };
    r.prototype = {
        utils: {
            isMobile: function() {
                return /android|ip(hone|od|ad)/i.test(navigator.userAgent)
            },
            escapeRegExp: function(e) {
                return e.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
            },
            replaceDiacritics: function(e) {
                for (var t = o.length; t--;) e = e.toLowerCase().replace(o[t], a[t]);
                return e
            },
            format: function(e) {
                var t = arguments;
                return ("" + e).replace(/\{(?:(\d+)|(\w+))\}/g, function(e, s, i) {
                    return i && t[1] ? t[1][i] : t[s]
                })
            },
            nextEnabledItem: function(e, t) {
                for (; e[t = (t + 1) % e.length].disabled;);
                return t
            },
            previousEnabledItem: function(e, t) {
                for (; e[t = (t > 0 ? t : e.length) - 1].disabled;);
                return t
            },
            toDash: function(e) {
                return e.replace(/([a-z])([A-Z])/g, "$1-$2").toLowerCase()
            },
            triggerCallback: function(t, s) {
                var l = s.element,
                    n = s.options["on" + t],
                    a = [l].concat([].slice.call(arguments).slice(1));
                e.isFunction(n) && n.apply(l, a), e(l).trigger(i + "-" + this.toDash(t), a)
            },
            arrayToClassname: function(t) {
                var s = e.grep(t, function(e) {
                    return !!e
                });
                return e.trim(s.join(" "))
            }
        },
        init: function(t) {
            var s = this;
            if (s.options = e.extend(!0, {}, e.fn[i].defaults, s.options, t), s.utils.triggerCallback("BeforeInit", s), s.destroy(!0), s.options.disableOnMobile && s.utils.isMobile()) return void(s.disableOnMobile = !0);
            s.classes = s.getClassNames();
            var l = e("<input/>", {
                    class: s.classes.input,
                    readonly: s.utils.isMobile()
                }),
                n = e("<div/>", {
                    class: s.classes.items,
                    tabindex: -1
                }),
                a = e("<div/>", {
                    class: s.classes.scroll
                }),
                o = e("<div/>", {
                    class: s.classes.prefix,
                    html: s.options.arrowButtonMarkup
                }),
                r = e("<span/>", {
                    class: "label"
                }),
                u = s.$element.wrap("<div/>").parent().append(o.prepend(r), n, l),
                p = e("<div/>", {
                    class: s.classes.hideselect
                });
            s.elements = {
                input: l,
                items: n,
                itemsScroll: a,
                wrapper: o,
                label: r,
                outerWrapper: u
            }, s.options.nativeOnMobile && s.utils.isMobile() && (s.elements.input = void 0, p.addClass(s.classes.prefix + "-is-native"), s.$element.on("change", function() {
                s.refresh()
            })), s.$element.on(s.eventTriggers).wrap(p), s.originalTabindex = s.$element.prop("tabindex"), s.$element.prop("tabindex", -1), s.populate(), s.activate(), s.utils.triggerCallback("Init", s)
        },
        activate: function() {
            var e = this,
                t = e.elements.items.closest(":visible").children(":hidden").addClass(e.classes.tempshow),
                s = e.$element.width();
            t.removeClass(e.classes.tempshow), e.utils.triggerCallback("BeforeActivate", e), e.elements.outerWrapper.prop("class", e.utils.arrayToClassname([e.classes.wrapper, e.$element.prop("class").replace(/\S+/g, e.classes.prefix + "-$&"), e.options.responsive ? e.classes.responsive : ""])), e.options.inheritOriginalWidth && s > 0 && e.elements.outerWrapper.width(s), e.unbindEvents(), e.$element.prop("disabled") ? (e.elements.outerWrapper.addClass(e.classes.disabled), e.elements.input && e.elements.input.prop("disabled", !0)) : (e.state.enabled = !0, e.elements.outerWrapper.removeClass(e.classes.disabled), e.$li = e.elements.items.removeAttr("style").find("li"), e.bindEvents()), e.utils.triggerCallback("Activate", e)
        },
        getClassNames: function() {
            var t = this,
                s = t.options.customClass,
                i = {};
            return e.each(l.split(" "), function(e, l) {
                var n = s.prefix + l;
                i[l.toLowerCase()] = s.camelCase ? n : t.utils.toDash(n)
            }), i.prefix = s.prefix, i
        },
        setLabel: function() {
            var t = this,
                s = t.options.labelBuilder;
            if (t.state.multiple) {
                var i = e.isArray(t.state.currValue) ? t.state.currValue : [t.state.currValue];
                i = 0 === i.length ? [0] : i;
                var l = e.map(i, function(s) {
                    return e.grep(t.lookupItems, function(e) {
                        return e.index === s
                    })[0]
                });
                l = e.grep(l, function(t) {
                    return l.length > 1 || 0 === l.length ? "" !== e.trim(t.value) : t
                }), l = e.map(l, function(i) {
                    return e.isFunction(s) ? s(i) : t.utils.format(s, i)
                }), t.options.multiple.maxLabelEntries && (l.length >= t.options.multiple.maxLabelEntries + 1 ? (l = l.slice(0, t.options.multiple.maxLabelEntries), l.push(e.isFunction(s) ? s({
                    text: "..."
                }) : t.utils.format(s, {
                    text: "..."
                }))) : l.slice(l.length - 1)), t.elements.label.html(l.join(t.options.multiple.separator))
            } else {
                var n = t.lookupItems[t.state.currValue];
                t.elements.label.html(e.isFunction(s) ? s(n) : t.utils.format(s, n))
            }
        },
        populate: function() {
            var t = this,
                s = t.$element.children(),
                i = t.$element.find("option"),
                l = i.filter(":selected"),
                n = i.index(l),
                a = 0,
                o = t.state.multiple ? [] : 0;
            l.length > 1 && t.state.multiple && (n = [], l.each(function() {
                n.push(e(this).index())
            })), t.state.currValue = ~n ? n : o, t.state.selectedIdx = t.state.currValue, t.state.highlightedIdx = t.state.currValue, t.items = [], t.lookupItems = [], s.length && (s.each(function(s) {
                var i = e(this);
                if (i.is("optgroup")) {
                    var l = {
                        element: i,
                        label: i.prop("label"),
                        groupDisabled: i.prop("disabled"),
                        items: []
                    };
                    i.children().each(function(s) {
                        var i = e(this);
                        l.items[s] = t.getItemData(a, i, l.groupDisabled || i.prop("disabled")), t.lookupItems[a] = l.items[s], a++
                    }), t.items[s] = l
                } else t.items[s] = t.getItemData(a, i, i.prop("disabled")), t.lookupItems[a] = t.items[s], a++
            }), t.setLabel(), t.elements.items.append(t.elements.itemsScroll.html(t.getItemsMarkup(t.items))))
        },
        getItemData: function(t, s, i) {
            var l = this;
            return {
                index: t,
                element: s,
                value: s.val(),
                className: s.prop("class"),
                text: s.html(),
                slug: e.trim(l.utils.replaceDiacritics(s.html())),
                selected: s.prop("selected"),
                disabled: i
            }
        },
        getItemsMarkup: function(t) {
            var s = this,
                i = "<ul>";
            return e.isFunction(s.options.listBuilder) && s.options.listBuilder && (t = s.options.listBuilder(t)), e.each(t, function(t, l) {
                void 0 !== l.label ? (i += s.utils.format('<ul class="{1}"><li class="{2}">{3}</li>', s.utils.arrayToClassname([s.classes.group, l.groupDisabled ? "disabled" : "", l.element.prop("class")]), s.classes.grouplabel, l.element.prop("label")), e.each(l.items, function(e, t) {
                    i += s.getItemMarkup(t.index, t)
                }), i += "</ul>") : i += s.getItemMarkup(l.index, l)
            }), i + "</ul>"
        },
        getItemMarkup: function(t, s) {
            var i = this,
                l = i.options.optionsItemBuilder,
                n = {
                    value: s.value,
                    text: s.text,
                    slug: s.slug,
                    index: s.index
                };
            return i.utils.format('<li data-index="{1}" class="{2}">{3}</li>', t, i.utils.arrayToClassname([s.className, t === i.items.length - 1 ? "last" : "", s.disabled ? "disabled" : "", s.selected ? "selected" : ""]), e.isFunction(l) ? i.utils.format(l(s), s) : i.utils.format(l, n))
        },
        unbindEvents: function() {
            var e = this;
            e.elements.wrapper.add(e.$element).add(e.elements.outerWrapper).add(e.elements.input).off(n)
        },
        bindEvents: function() {
            var t = this;
            t.elements.outerWrapper.on("mouseenter" + n + " mouseleave" + n, function(s) {
                e(this).toggleClass(t.classes.hover, "mouseenter" === s.type), t.options.openOnHover && (clearTimeout(t.closeTimer), "mouseleave" === s.type ? t.closeTimer = setTimeout(e.proxy(t.close, t), t.options.hoverIntentTimeout) : t.open())
            }), t.elements.wrapper.on("click" + n, function(e) {
                t.state.opened ? t.close() : t.open(e)
            }), t.options.nativeOnMobile && t.utils.isMobile() || (t.$element.on("focus" + n, function() {
                t.elements.input.focus()
            }), t.elements.input.prop({
                tabindex: t.originalTabindex,
                disabled: !1
            }).on("keydown" + n, e.proxy(t.handleKeys, t)).on("focusin" + n, function(e) {
                t.elements.outerWrapper.addClass(t.classes.focus), t.elements.input.one("blur", function() {
                    t.elements.input.blur()
                }), t.options.openOnFocus && !t.state.opened && t.open(e)
            }).on("focusout" + n, function() {
                t.elements.outerWrapper.removeClass(t.classes.focus)
            }).on("input propertychange", function() {
                var s = t.elements.input.val(),
                    i = new RegExp("^" + t.utils.escapeRegExp(s), "i");
                clearTimeout(t.resetStr), t.resetStr = setTimeout(function() {
                    t.elements.input.val("")
                }, t.options.keySearchTimeout), s.length && e.each(t.items, function(e, s) {
                    if (!s.disabled && i.test(s.text) || i.test(s.slug)) return void t.highlight(e)
                })
            })), t.$li.on({
                mousedown: function(e) {
                    e.preventDefault(), e.stopPropagation()
                },
                click: function() {
                    return t.select(e(this).data("index")), !1
                }
            })
        },
        handleKeys: function(t) {
            var s = this,
                i = t.which,
                l = s.options.keys,
                n = e.inArray(i, l.previous) > -1,
                a = e.inArray(i, l.next) > -1,
                o = e.inArray(i, l.select) > -1,
                r = e.inArray(i, l.open) > -1,
                u = s.state.highlightedIdx,
                p = n && 0 === u || a && u + 1 === s.items.length,
                c = 0;
            if (13 !== i && 32 !== i || t.preventDefault(), n || a) {
                if (!s.options.allowWrap && p) return;
                n && (c = s.utils.previousEnabledItem(s.lookupItems, u)), a && (c = s.utils.nextEnabledItem(s.lookupItems, u)), s.highlight(c)
            }
            return o && s.state.opened ? (s.select(u), void(s.state.multiple && s.options.multiple.keepMenuOpen || s.close())) : void(r && !s.state.opened && s.open())
        },
        refresh: function() {
            var e = this;
            e.populate(), e.activate(), e.utils.triggerCallback("Refresh", e)
        },
        setOptionsDimensions: function() {
            var e = this,
                t = e.elements.items.closest(":visible").children(":hidden").addClass(e.classes.tempshow),
                s = e.options.maxHeight,
                i = e.elements.items.outerWidth(),
                l = e.elements.wrapper.outerWidth() - (i - e.elements.items.width());
            !e.options.expandToItemText || l > i ? e.finalWidth = l : (e.elements.items.css("overflow", "scroll"), e.elements.outerWrapper.width(9e4), e.finalWidth = e.elements.items.width(), e.elements.items.css("overflow", ""), e.elements.outerWrapper.width("")), e.elements.items.width(e.finalWidth).height() > s && e.elements.items.height(s), t.removeClass(e.classes.tempshow)
        },
        isInViewport: function() {
            var e = this,
                t = s.scrollTop(),
                i = s.height(),
                l = e.elements.outerWrapper.offset().top,
                n = e.elements.outerWrapper.outerHeight(),
                a = l + n + e.itemsHeight <= t + i,
                o = l - e.itemsHeight > t,
                r = !a && o;
            e.elements.outerWrapper.toggleClass(e.classes.above, r)
        },
        detectItemVisibility: function(t) {
            var s = this,
                i = s.$li.filter("[data-index]");
            s.state.multiple && (t = e.isArray(t) && 0 === t.length ? 0 : t, t = e.isArray(t) ? Math.min.apply(Math, t) : t);
            var l = i.eq(t).outerHeight(),
                n = i[t].offsetTop,
                a = s.elements.itemsScroll.scrollTop(),
                o = n + 2 * l;
            s.elements.itemsScroll.scrollTop(o > a + s.itemsHeight ? o - s.itemsHeight : n - l < a ? n - l : a)
        },
        open: function(s) {
            var l = this;
            return (!l.options.nativeOnMobile || !l.utils.isMobile()) && (l.utils.triggerCallback("BeforeOpen", l), s && (s.preventDefault(), l.options.stopPropagation && s.stopPropagation()), void(l.state.enabled && (l.setOptionsDimensions(), e("." + l.classes.hideselect, "." + l.classes.open).children()[i]("close"), l.state.opened = !0, l.itemsHeight = l.elements.items.outerHeight(), l.itemsInnerHeight = l.elements.items.height(), l.elements.outerWrapper.addClass(l.classes.open), l.elements.input.val(""), s && "focusin" !== s.type && l.elements.input.focus(), setTimeout(function() {
                t.on("click" + n, e.proxy(l.close, l)).on("scroll" + n, e.proxy(l.isInViewport, l))
            }, 1), l.isInViewport(), l.options.preventWindowScroll && t.on("mousewheel" + n + " DOMMouseScroll" + n, "." + l.classes.scroll, function(t) {
                var s = t.originalEvent,
                    i = e(this).scrollTop(),
                    n = 0;
                "detail" in s && (n = s.detail * -1), "wheelDelta" in s && (n = s.wheelDelta), "wheelDeltaY" in s && (n = s.wheelDeltaY), "deltaY" in s && (n = s.deltaY * -1), (i === this.scrollHeight - l.itemsInnerHeight && n < 0 || 0 === i && n > 0) && t.preventDefault()
            }), l.detectItemVisibility(l.state.selectedIdx), l.highlight(l.state.multiple ? -1 : l.state.selectedIdx), l.utils.triggerCallback("Open", l))))
        },
        close: function() {
            var e = this;
            e.utils.triggerCallback("BeforeClose", e), t.off(n), e.elements.outerWrapper.removeClass(e.classes.open), e.state.opened = !1, e.utils.triggerCallback("Close", e)
        },
        change: function() {
            var t = this;
            t.utils.triggerCallback("BeforeChange", t), t.state.multiple ? (e.each(t.lookupItems, function(e) {
                t.lookupItems[e].selected = !1, t.$element.find("option").prop("selected", !1)
            }), e.each(t.state.selectedIdx, function(e, s) {
                t.lookupItems[s].selected = !0, t.$element.find("option").eq(s).prop("selected", !0)
            }), t.state.currValue = t.state.selectedIdx, t.setLabel(), t.utils.triggerCallback("Change", t)) : t.state.currValue !== t.state.selectedIdx && (t.$element.prop("selectedIndex", t.state.currValue = t.state.selectedIdx).data("value", t.lookupItems[t.state.selectedIdx].text), t.setLabel(), t.utils.triggerCallback("Change", t))
        },
        highlight: function(e) {
            var t = this,
                s = t.$li.filter("[data-index]").removeClass("highlighted");
            t.utils.triggerCallback("BeforeHighlight", t), void 0 === e || e === -1 || t.lookupItems[e].disabled || (s.eq(t.state.highlightedIdx = e).addClass("highlighted"), t.detectItemVisibility(e), t.utils.triggerCallback("Highlight", t))
        },
        select: function(t) {
            var s = this,
                i = s.$li.filter("[data-index]");
            if (s.utils.triggerCallback("BeforeSelect", s, t), void 0 !== t && t !== -1 && !s.lookupItems[t].disabled) {
                if (s.state.multiple) {
                    s.state.selectedIdx = e.isArray(s.state.selectedIdx) ? s.state.selectedIdx : [s.state.selectedIdx];
                    var l = e.inArray(t, s.state.selectedIdx);
                    l !== -1 ? s.state.selectedIdx.splice(l, 1) : s.state.selectedIdx.push(t), i.removeClass("selected").filter(function(t) {
                        return e.inArray(t, s.state.selectedIdx) !== -1
                    }).addClass("selected")
                } else i.removeClass("selected").eq(s.state.selectedIdx = t).addClass("selected");
                s.state.multiple && s.options.multiple.keepMenuOpen || s.close(), s.change(), s.utils.triggerCallback("Select", s, t)
            }
        },
        destroy: function(e) {
            var t = this;
            t.state && t.state.enabled && (t.elements.items.add(t.elements.wrapper).add(t.elements.input).remove(), e || t.$element.removeData(i).removeData("value"), t.$element.prop("tabindex", t.originalTabindex).off(n).off(t.eventTriggers).unwrap().unwrap(), t.state.enabled = !1)
        }
    }, e.fn[i] = function(t) {
        return this.each(function() {
            var s = e.data(this, i);
            s && !s.disableOnMobile ? "string" == typeof t && s[t] ? s[t]() : s.init(t) : e.data(this, i, new r(this, t))
        })
    }, e.fn[i].defaults = {
        onChange: function(t) {
            e(t).change()
        },
        maxHeight: 300,
        keySearchTimeout: 500,
        arrowButtonMarkup: '<b class="button">&#x25be;</b>',
        disableOnMobile: !1,
        nativeOnMobile: !0,
        openOnFocus: !0,
        openOnHover: !1,
        hoverIntentTimeout: 500,
        expandToItemText: !1,
        responsive: !1,
        preventWindowScroll: !0,
        inheritOriginalWidth: !1,
        allowWrap: !0,
        stopPropagation: !0,
        optionsItemBuilder: "{text}",
        labelBuilder: "{text}",
        listBuilder: !1,
        keys: {
            previous: [37, 38],
            next: [39, 40],
            select: [9, 13, 27],
            open: [13, 32, 37, 38, 39, 40],
            close: [9, 27]
        },
        customClass: {
            prefix: i,
            camelCase: !1
        },
        multiple: {
            separator: ", ",
            keepMenuOpen: !0,
            maxLabelEntries: !1
        }
    }
});
(function() {
    "use strict";
    var document = typeof window !== "undefined" && typeof window.document !== "undefined" ? window.document : {};
    var isCommonjs = typeof module !== "undefined" && module.exports;
    var keyboardAllowed = typeof Element !== "undefined" && "ALLOW_KEYBOARD_INPUT" in Element;
    var fn = function() {
        var val;
        var fnMap = [
            ["requestFullscreen", "exitFullscreen", "fullscreenElement", "fullscreenEnabled", "fullscreenchange", "fullscreenerror"],
            ["webkitRequestFullscreen", "webkitExitFullscreen", "webkitFullscreenElement", "webkitFullscreenEnabled", "webkitfullscreenchange", "webkitfullscreenerror"],
            ["webkitRequestFullScreen", "webkitCancelFullScreen", "webkitCurrentFullScreenElement", "webkitCancelFullScreen", "webkitfullscreenchange", "webkitfullscreenerror"],
            ["mozRequestFullScreen", "mozCancelFullScreen", "mozFullScreenElement", "mozFullScreenEnabled", "mozfullscreenchange", "mozfullscreenerror"],
            ["msRequestFullscreen", "msExitFullscreen", "msFullscreenElement", "msFullscreenEnabled", "MSFullscreenChange", "MSFullscreenError"]
        ];
        var i = 0;
        var l = fnMap.length;
        var ret = {};
        for (; i < l; i++) {
            val = fnMap[i];
            if (val && val[1] in document) {
                for (i = 0; i < val.length; i++) {
                    ret[fnMap[0][i]] = val[i]
                }
                return ret
            }
        }
        return false
    }();
    var eventNameMap = {
        change: fn.fullscreenchange,
        error: fn.fullscreenerror
    };
    var screenfull = {
        request: function(elem) {
            return new Promise(function(resolve) {
                var request = fn.requestFullscreen;
                var onFullScreenEntered = function() {
                    this.off("change", onFullScreenEntered);
                    resolve()
                }.bind(this);
                elem = elem || document.documentElement;
                if (/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)) {
                    elem[request]()
                } else {
                    elem[request](keyboardAllowed ? Element.ALLOW_KEYBOARD_INPUT : {})
                }
                this.on("change", onFullScreenEntered)
            }.bind(this))
        },
        exit: function() {
            return new Promise(function(resolve) {
                var onFullScreenExit = function() {
                    this.off("change", onFullScreenExit);
                    resolve()
                }.bind(this);
                document[fn.exitFullscreen]();
                this.on("change", onFullScreenExit)
            }.bind(this))
        },
        toggle: function(elem) {
            return this.isFullscreen ? this.exit() : this.request(elem)
        },
        onchange: function(callback) {
            this.on("change", callback)
        },
        onerror: function(callback) {
            this.on("error", callback)
        },
        on: function(event, callback) {
            var eventName = eventNameMap[event];
            if (eventName) {
                document.addEventListener(eventName, callback, false)
            }
        },
        off: function(event, callback) {
            var eventName = eventNameMap[event];
            if (eventName) {
                document.removeEventListener(eventName, callback, false)
            }
        },
        raw: fn
    };
    if (!fn) {
        if (isCommonjs) {
            module.exports = false
        } else {
            window.screenfull = false
        }
        return
    }
    Object.defineProperties(screenfull, {
        isFullscreen: {
            get: function() {
                return Boolean(document[fn.fullscreenElement])
            }
        },
        element: {
            enumerable: true,
            get: function() {
                return document[fn.fullscreenElement]
            }
        },
        enabled: {
            enumerable: true,
            get: function() {
                return Boolean(document[fn.fullscreenEnabled])
            }
        }
    });
    if (isCommonjs) {
        module.exports = screenfull
    } else {
        window.screenfull = screenfull
    }
})();
! function(a) {
    function b(a) {
        var b = a.length,
            d = c.type(a);
        return "function" === d || c.isWindow(a) ? !1 : 1 === a.nodeType && b ? !0 : "array" === d || 0 === b || "number" == typeof b && b > 0 && b - 1 in a
    }
    if (!a.jQuery) {
        var c = function(a, b) {
            return new c.fn.init(a, b)
        };
        c.isWindow = function(a) {
            return null != a && a == a.window
        }, c.type = function(a) {
            return null == a ? a + "" : "object" == typeof a || "function" == typeof a ? e[g.call(a)] || "object" : typeof a
        }, c.isArray = Array.isArray || function(a) {
            return "array" === c.type(a)
        }, c.isPlainObject = function(a) {
            var b;
            if (!a || "object" !== c.type(a) || a.nodeType || c.isWindow(a)) return !1;
            try {
                if (a.constructor && !f.call(a, "constructor") && !f.call(a.constructor.prototype, "isPrototypeOf")) return !1
            } catch (d) {
                return !1
            }
            for (b in a);
            return void 0 === b || f.call(a, b)
        }, c.each = function(a, c, d) {
            var e, f = 0,
                g = a.length,
                h = b(a);
            if (d) {
                if (h)
                    for (; g > f && (e = c.apply(a[f], d), e !== !1); f++);
                else
                    for (f in a)
                        if (e = c.apply(a[f], d), e === !1) break
            } else if (h)
                for (; g > f && (e = c.call(a[f], f, a[f]), e !== !1); f++);
            else
                for (f in a)
                    if (e = c.call(a[f], f, a[f]), e === !1) break;
            return a
        }, c.data = function(a, b, e) {
            if (void 0 === e) {
                var f = a[c.expando],
                    g = f && d[f];
                if (void 0 === b) return g;
                if (g && b in g) return g[b]
            } else if (void 0 !== b) {
                var f = a[c.expando] || (a[c.expando] = ++c.uuid);
                return d[f] = d[f] || {}, d[f][b] = e, e
            }
        }, c.removeData = function(a, b) {
            var e = a[c.expando],
                f = e && d[e];
            f && c.each(b, function(a, b) {
                delete f[b]
            })
        }, c.extend = function() {
            var a, b, d, e, f, g, h = arguments[0] || {},
                i = 1,
                j = arguments.length,
                k = !1;
            for ("boolean" == typeof h && (k = h, h = arguments[i] || {}, i++), "object" != typeof h && "function" !== c.type(h) && (h = {}), i === j && (h = this, i--); j > i; i++)
                if (null != (f = arguments[i]))
                    for (e in f) a = h[e], d = f[e], h !== d && (k && d && (c.isPlainObject(d) || (b = c.isArray(d))) ? (b ? (b = !1, g = a && c.isArray(a) ? a : []) : g = a && c.isPlainObject(a) ? a : {}, h[e] = c.extend(k, g, d)) : void 0 !== d && (h[e] = d));
            return h
        }, c.queue = function(a, d, e) {
            function f(a, c) {
                var d = c || [];
                return null != a && (b(Object(a)) ? ! function(a, b) {
                    for (var c = +b.length, d = 0, e = a.length; c > d;) a[e++] = b[d++];
                    if (c !== c)
                        for (; void 0 !== b[d];) a[e++] = b[d++];
                    return a.length = e, a
                }(d, "string" == typeof a ? [a] : a) : [].push.call(d, a)), d
            }
            if (a) {
                d = (d || "fx") + "queue";
                var g = c.data(a, d);
                return e ? (!g || c.isArray(e) ? g = c.data(a, d, f(e)) : g.push(e), g) : g || []
            }
        }, c.dequeue = function(a, b) {
            c.each(a.nodeType ? [a] : a, function(a, d) {
                b = b || "fx";
                var e = c.queue(d, b),
                    f = e.shift();
                "inprogress" === f && (f = e.shift()), f && ("fx" === b && e.unshift("inprogress"), f.call(d, function() {
                    c.dequeue(d, b)
                }))
            })
        }, c.fn = c.prototype = {
            init: function(a) {
                if (a.nodeType) return this[0] = a, this;
                throw new Error("Not a DOM node.")
            },
            offset: function() {
                var b = this[0].getBoundingClientRect ? this[0].getBoundingClientRect() : {
                    top: 0,
                    left: 0
                };
                return {
                    top: b.top + (a.pageYOffset || document.scrollTop || 0) - (document.clientTop || 0),
                    left: b.left + (a.pageXOffset || document.scrollLeft || 0) - (document.clientLeft || 0)
                }
            },
            position: function() {
                function a() {
                    for (var a = this.offsetParent || document; a && "html" === !a.nodeType.toLowerCase && "static" === a.style.position;) a = a.offsetParent;
                    return a || document
                }
                var b = this[0],
                    a = a.apply(b),
                    d = this.offset(),
                    e = /^(?:body|html)$/i.test(a.nodeName) ? {
                        top: 0,
                        left: 0
                    } : c(a).offset();
                return d.top -= parseFloat(b.style.marginTop) || 0, d.left -= parseFloat(b.style.marginLeft) || 0, a.style && (e.top += parseFloat(a.style.borderTopWidth) || 0, e.left += parseFloat(a.style.borderLeftWidth) || 0), {
                    top: d.top - e.top,
                    left: d.left - e.left
                }
            }
        };
        var d = {};
        c.expando = "velocity" + (new Date).getTime(), c.uuid = 0;
        for (var e = {}, f = e.hasOwnProperty, g = e.toString, h = "Boolean Number String Function Array Date RegExp Object Error".split(" "), i = 0; i < h.length; i++) e["[object " + h[i] + "]"] = h[i].toLowerCase();
        c.fn.init.prototype = c.fn, a.Velocity = {
            Utilities: c
        }
    }
}(window),
function(a) {
    "object" == typeof module && "object" == typeof module.exports ? module.exports = a() : "function" == typeof define && define.amd ? define(a) : a()
}(function() {
    return function(a, b, c, d) {
        function e(a) {
            for (var b = -1, c = a ? a.length : 0, d = []; ++b < c;) {
                var e = a[b];
                e && d.push(e)
            }
            return d
        }

        function f(a) {
            return p.isWrapped(a) ? a = [].slice.call(a) : p.isNode(a) && (a = [a]), a
        }

        function g(a) {
            var b = m.data(a, "velocity");
            return null === b ? d : b
        }

        function h(a) {
            return function(b) {
                return Math.round(b * a) * (1 / a)
            }
        }

        function i(a, c, d, e) {
            function f(a, b) {
                return 1 - 3 * b + 3 * a
            }

            function g(a, b) {
                return 3 * b - 6 * a
            }

            function h(a) {
                return 3 * a
            }

            function i(a, b, c) {
                return ((f(b, c) * a + g(b, c)) * a + h(b)) * a
            }

            function j(a, b, c) {
                return 3 * f(b, c) * a * a + 2 * g(b, c) * a + h(b)
            }

            function k(b, c) {
                for (var e = 0; p > e; ++e) {
                    var f = j(c, a, d);
                    if (0 === f) return c;
                    var g = i(c, a, d) - b;
                    c -= g / f
                }
                return c
            }

            function l() {
                for (var b = 0; t > b; ++b) x[b] = i(b * u, a, d)
            }

            function m(b, c, e) {
                var f, g, h = 0;
                do {
                    g = c + (e - c) / 2, f = i(g, a, d) - b, f > 0 ? e = g : c = g
                } while (Math.abs(f) > r && ++h < s);
                return g
            }

            function n(b) {
                for (var c = 0, e = 1, f = t - 1; e != f && x[e] <= b; ++e) c += u;
                --e;
                var g = (b - x[e]) / (x[e + 1] - x[e]),
                    h = c + g * u,
                    i = j(h, a, d);
                return i >= q ? k(b, h) : 0 == i ? h : m(b, c, c + u)
            }

            function o() {
                y = !0, (a != c || d != e) && l()
            }
            var p = 4,
                q = .001,
                r = 1e-7,
                s = 10,
                t = 11,
                u = 1 / (t - 1),
                v = "Float32Array" in b;
            if (4 !== arguments.length) return !1;
            for (var w = 0; 4 > w; ++w)
                if ("number" != typeof arguments[w] || isNaN(arguments[w]) || !isFinite(arguments[w])) return !1;
            a = Math.min(a, 1), d = Math.min(d, 1), a = Math.max(a, 0), d = Math.max(d, 0);
            var x = v ? new Float32Array(t) : new Array(t),
                y = !1,
                z = function(b) {
                    return y || o(), a === c && d === e ? b : 0 === b ? 0 : 1 === b ? 1 : i(n(b), c, e)
                };
            z.getControlPoints = function() {
                return [{
                    x: a,
                    y: c
                }, {
                    x: d,
                    y: e
                }]
            };
            var A = "generateBezier(" + [a, c, d, e] + ")";
            return z.toString = function() {
                return A
            }, z
        }

        function j(a, b) {
            var c = a;
            return p.isString(a) ? t.Easings[a] || (c = !1) : c = p.isArray(a) && 1 === a.length ? h.apply(null, a) : p.isArray(a) && 2 === a.length ? u.apply(null, a.concat([b])) : p.isArray(a) && 4 === a.length ? i.apply(null, a) : !1, c === !1 && (c = t.Easings[t.defaults.easing] ? t.defaults.easing : s), c
        }

        function k(a) {
            if (a) {
                var b = (new Date).getTime(),
                    c = t.State.calls.length;
                c > 1e4 && (t.State.calls = e(t.State.calls));
                for (var f = 0; c > f; f++)
                    if (t.State.calls[f]) {
                        var h = t.State.calls[f],
                            i = h[0],
                            j = h[2],
                            n = h[3],
                            o = !!n,
                            q = null;
                        n || (n = t.State.calls[f][3] = b - 16);
                        for (var r = Math.min((b - n) / j.duration, 1), s = 0, u = i.length; u > s; s++) {
                            var w = i[s],
                                y = w.element;
                            if (g(y)) {
                                var z = !1;
                                if (j.display !== d && null !== j.display && "none" !== j.display) {
                                    if ("flex" === j.display) {
                                        var A = ["-webkit-box", "-moz-box", "-ms-flexbox", "-webkit-flex"];
                                        m.each(A, function(a, b) {
                                            v.setPropertyValue(y, "display", b)
                                        })
                                    }
                                    v.setPropertyValue(y, "display", j.display)
                                }
                                j.visibility !== d && "hidden" !== j.visibility && v.setPropertyValue(y, "visibility", j.visibility);
                                for (var B in w)
                                    if ("element" !== B) {
                                        var C, D = w[B],
                                            E = p.isString(D.easing) ? t.Easings[D.easing] : D.easing;
                                        if (1 === r) C = D.endValue;
                                        else {
                                            var F = D.endValue - D.startValue;
                                            if (C = D.startValue + F * E(r, j, F), !o && C === D.currentValue) continue
                                        }
                                        if (D.currentValue = C, "tween" === B) q = C;
                                        else {
                                            if (v.Hooks.registered[B]) {
                                                var G = v.Hooks.getRoot(B),
                                                    H = g(y).rootPropertyValueCache[G];
                                                H && (D.rootPropertyValue = H)
                                            }
                                            var I = v.setPropertyValue(y, B, D.currentValue + (0 === parseFloat(C) ? "" : D.unitType), D.rootPropertyValue, D.scrollData);
                                            v.Hooks.registered[B] && (g(y).rootPropertyValueCache[G] = v.Normalizations.registered[G] ? v.Normalizations.registered[G]("extract", null, I[1]) : I[1]), "transform" === I[0] && (z = !0)
                                        }
                                    } j.mobileHA && g(y).transformCache.translate3d === d && (g(y).transformCache.translate3d = "(0px, 0px, 0px)", z = !0), z && v.flushTransformCache(y)
                            }
                        }
                        j.display !== d && "none" !== j.display && (t.State.calls[f][2].display = !1), j.visibility !== d && "hidden" !== j.visibility && (t.State.calls[f][2].visibility = !1), j.progress && j.progress.call(h[1], h[1], r, Math.max(0, n + j.duration - b), n, q), 1 === r && l(f)
                    }
            }
            t.State.isTicking && x(k)
        }

        function l(a, b) {
            if (!t.State.calls[a]) return !1;
            for (var c = t.State.calls[a][0], e = t.State.calls[a][1], f = t.State.calls[a][2], h = t.State.calls[a][4], i = !1, j = 0, k = c.length; k > j; j++) {
                var l = c[j].element;
                if (b || f.loop || ("none" === f.display && v.setPropertyValue(l, "display", f.display), "hidden" === f.visibility && v.setPropertyValue(l, "visibility", f.visibility)), f.loop !== !0 && (m.queue(l)[1] === d || !/\.velocityQueueEntryFlag/i.test(m.queue(l)[1])) && g(l)) {
                    g(l).isAnimating = !1, g(l).rootPropertyValueCache = {};
                    var n = !1;
                    m.each(v.Lists.transforms3D, function(a, b) {
                        var c = /^scale/.test(b) ? 1 : 0,
                            e = g(l).transformCache[b];
                        g(l).transformCache[b] !== d && new RegExp("^\\(" + c + "[^.]").test(e) && (n = !0, delete g(l).transformCache[b])
                    }), f.mobileHA && (n = !0, delete g(l).transformCache.translate3d), n && v.flushTransformCache(l), v.Values.removeClass(l, "velocity-animating")
                }
                if (!b && f.complete && !f.loop && j === k - 1) try {
                    f.complete.call(e, e)
                } catch (o) {
                    setTimeout(function() {
                        throw o
                    }, 1)
                }
                h && f.loop !== !0 && h(e), g(l) && f.loop === !0 && !b && (m.each(g(l).tweensContainer, function(a, b) {
                    /^rotate/.test(a) && 360 === parseFloat(b.endValue) && (b.endValue = 0, b.startValue = 360), /^backgroundPosition/.test(a) && 100 === parseFloat(b.endValue) && "%" === b.unitType && (b.endValue = 0, b.startValue = 100)
                }), t(l, "reverse", {
                    loop: !0,
                    delay: f.delay
                })), f.queue !== !1 && m.dequeue(l, f.queue)
            }
            t.State.calls[a] = !1;
            for (var p = 0, q = t.State.calls.length; q > p; p++)
                if (t.State.calls[p] !== !1) {
                    i = !0;
                    break
                } i === !1 && (t.State.isTicking = !1, delete t.State.calls, t.State.calls = [])
        }
        var m, n = function() {
                if (c.documentMode) return c.documentMode;
                for (var a = 7; a > 4; a--) {
                    var b = c.createElement("div");
                    if (b.innerHTML = "\x3c!--[if IE " + a + "]><span></span><![endif]--\x3e", b.getElementsByTagName("span").length) return b = null, a
                }
                return d
            }(),
            o = function() {
                var a = 0;
                return b.webkitRequestAnimationFrame || b.mozRequestAnimationFrame || function(b) {
                    var c, d = (new Date).getTime();
                    return c = Math.max(0, 16 - (d - a)), a = d + c, setTimeout(function() {
                        b(d + c)
                    }, c)
                }
            }(),
            p = {
                isString: function(a) {
                    return "string" == typeof a
                },
                isArray: Array.isArray || function(a) {
                    return "[object Array]" === Object.prototype.toString.call(a)
                },
                isFunction: function(a) {
                    return "[object Function]" === Object.prototype.toString.call(a)
                },
                isNode: function(a) {
                    return a && a.nodeType
                },
                isNodeList: function(a) {
                    return "object" == typeof a && /^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(a)) && a.length !== d && (0 === a.length || "object" == typeof a[0] && a[0].nodeType > 0)
                },
                isWrapped: function(a) {
                    return a && (a.jquery || b.Zepto && b.Zepto.zepto.isZ(a))
                },
                isSVG: function(a) {
                    return b.SVGElement && a instanceof b.SVGElement
                },
                isEmptyObject: function(a) {
                    for (var b in a) return !1;
                    return !0
                }
            },
            q = !1;
        if (a.fn && a.fn.jquery ? (m = a, q = !0) : m = b.Velocity.Utilities, 8 >= n && !q) throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");
        if (7 >= n) return void(jQuery.fn.velocity = jQuery.fn.animate);
        var r = 400,
            s = "swing",
            t = {
                State: {
                    isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                    isAndroid: /Android/i.test(navigator.userAgent),
                    isGingerbread: /Android 2\.3\.[3-7]/i.test(navigator.userAgent),
                    isChrome: b.chrome,
                    isFirefox: /Firefox/i.test(navigator.userAgent),
                    prefixElement: c.createElement("div"),
                    prefixMatches: {},
                    scrollAnchor: null,
                    scrollPropertyLeft: null,
                    scrollPropertyTop: null,
                    isTicking: !1,
                    calls: []
                },
                CSS: {},
                Utilities: m,
                Redirects: {},
                Easings: {},
                Promise: b.Promise,
                defaults: {
                    queue: "",
                    duration: r,
                    easing: s,
                    begin: d,
                    complete: d,
                    progress: d,
                    display: d,
                    visibility: d,
                    loop: !1,
                    delay: !1,
                    mobileHA: !0,
                    _cacheValues: !0
                },
                init: function(a) {
                    m.data(a, "velocity", {
                        isSVG: p.isSVG(a),
                        isAnimating: !1,
                        computedStyle: null,
                        tweensContainer: null,
                        rootPropertyValueCache: {},
                        transformCache: {}
                    })
                },
                hook: null,
                mock: !1,
                version: {
                    major: 1,
                    minor: 2,
                    patch: 2
                },
                debug: !1
            };
        b.pageYOffset !== d ? (t.State.scrollAnchor = b, t.State.scrollPropertyLeft = "pageXOffset", t.State.scrollPropertyTop = "pageYOffset") : (t.State.scrollAnchor = c.documentElement || c.body.parentNode || c.body, t.State.scrollPropertyLeft = "scrollLeft", t.State.scrollPropertyTop = "scrollTop");
        var u = function() {
            function a(a) {
                return -a.tension * a.x - a.friction * a.v
            }

            function b(b, c, d) {
                var e = {
                    x: b.x + d.dx * c,
                    v: b.v + d.dv * c,
                    tension: b.tension,
                    friction: b.friction
                };
                return {
                    dx: e.v,
                    dv: a(e)
                }
            }

            function c(c, d) {
                var e = {
                        dx: c.v,
                        dv: a(c)
                    },
                    f = b(c, .5 * d, e),
                    g = b(c, .5 * d, f),
                    h = b(c, d, g),
                    i = 1 / 6 * (e.dx + 2 * (f.dx + g.dx) + h.dx),
                    j = 1 / 6 * (e.dv + 2 * (f.dv + g.dv) + h.dv);
                return c.x = c.x + i * d, c.v = c.v + j * d, c
            }
            return function d(a, b, e) {
                var f, g, h, i = {
                        x: -1,
                        v: 0,
                        tension: null,
                        friction: null
                    },
                    j = [0],
                    k = 0,
                    l = 1e-4,
                    m = .016;
                for (a = parseFloat(a) || 500, b = parseFloat(b) || 20, e = e || null, i.tension = a, i.friction = b, f = null !== e, f ? (k = d(a, b), g = k / e * m) : g = m;;)
                    if (h = c(h || i, g), j.push(1 + h.x), k += 16, !(Math.abs(h.x) > l && Math.abs(h.v) > l)) break;
                return f ? function(a) {
                    return j[a * (j.length - 1) | 0]
                } : k
            }
        }();
        t.Easings = {
            linear: function(a) {
                return a
            },
            swing: function(a) {
                return .5 - Math.cos(a * Math.PI) / 2
            },
            spring: function(a) {
                return 1 - Math.cos(4.5 * a * Math.PI) * Math.exp(6 * -a)
            }
        }, m.each([
            ["ease", [.25, .1, .25, 1]],
            ["ease-in", [.42, 0, 1, 1]],
            ["ease-out", [0, 0, .58, 1]],
            ["ease-in-out", [.42, 0, .58, 1]],
            ["easeInSine", [.47, 0, .745, .715]],
            ["easeOutSine", [.39, .575, .565, 1]],
            ["easeInOutSine", [.445, .05, .55, .95]],
            ["easeInQuad", [.55, .085, .68, .53]],
            ["easeOutQuad", [.25, .46, .45, .94]],
            ["easeInOutQuad", [.455, .03, .515, .955]],
            ["easeInCubic", [.55, .055, .675, .19]],
            ["easeOutCubic", [.215, .61, .355, 1]],
            ["easeInOutCubic", [.645, .045, .355, 1]],
            ["easeInQuart", [.895, .03, .685, .22]],
            ["easeOutQuart", [.165, .84, .44, 1]],
            ["easeInOutQuart", [.77, 0, .175, 1]],
            ["easeInQuint", [.755, .05, .855, .06]],
            ["easeOutQuint", [.23, 1, .32, 1]],
            ["easeInOutQuint", [.86, 0, .07, 1]],
            ["easeInExpo", [.95, .05, .795, .035]],
            ["easeOutExpo", [.19, 1, .22, 1]],
            ["easeInOutExpo", [1, 0, 0, 1]],
            ["easeInCirc", [.6, .04, .98, .335]],
            ["easeOutCirc", [.075, .82, .165, 1]],
            ["easeInOutCirc", [.785, .135, .15, .86]]
        ], function(a, b) {
            t.Easings[b[0]] = i.apply(null, b[1])
        });
        var v = t.CSS = {
            RegEx: {
                isHex: /^#([A-f\d]{3}){1,2}$/i,
                valueUnwrap: /^[A-z]+\((.*)\)$/i,
                wrappedValueAlreadyExtracted: /[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,
                valueSplit: /([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi
            },
            Lists: {
                colors: ["fill", "stroke", "stopColor", "color", "backgroundColor", "borderColor", "borderTopColor", "borderRightColor", "borderBottomColor", "borderLeftColor", "outlineColor"],
                transformsBase: ["translateX", "translateY", "scale", "scaleX", "scaleY", "skewX", "skewY", "rotateZ"],
                transforms3D: ["transformPerspective", "translateZ", "scaleZ", "rotateX", "rotateY"]
            },
            Hooks: {
                templates: {
                    textShadow: ["Color X Y Blur", "black 0px 0px 0px"],
                    boxShadow: ["Color X Y Blur Spread", "black 0px 0px 0px 0px"],
                    clip: ["Top Right Bottom Left", "0px 0px 0px 0px"],
                    backgroundPosition: ["X Y", "0% 0%"],
                    transformOrigin: ["X Y Z", "50% 50% 0px"],
                    perspectiveOrigin: ["X Y", "50% 50%"]
                },
                registered: {},
                register: function() {
                    for (var a = 0; a < v.Lists.colors.length; a++) {
                        var b = "color" === v.Lists.colors[a] ? "0 0 0 1" : "255 255 255 1";
                        v.Hooks.templates[v.Lists.colors[a]] = ["Red Green Blue Alpha", b]
                    }
                    var c, d, e;
                    if (n)
                        for (c in v.Hooks.templates) {
                            d = v.Hooks.templates[c], e = d[0].split(" ");
                            var f = d[1].match(v.RegEx.valueSplit);
                            "Color" === e[0] && (e.push(e.shift()), f.push(f.shift()), v.Hooks.templates[c] = [e.join(" "), f.join(" ")])
                        }
                    for (c in v.Hooks.templates) {
                        d = v.Hooks.templates[c], e = d[0].split(" ");
                        for (var a in e) {
                            var g = c + e[a],
                                h = a;
                            v.Hooks.registered[g] = [c, h]
                        }
                    }
                },
                getRoot: function(a) {
                    var b = v.Hooks.registered[a];
                    return b ? b[0] : a
                },
                cleanRootPropertyValue: function(a, b) {
                    return v.RegEx.valueUnwrap.test(b) && (b = b.match(v.RegEx.valueUnwrap)[1]), v.Values.isCSSNullValue(b) && (b = v.Hooks.templates[a][1]), b
                },
                extractValue: function(a, b) {
                    var c = v.Hooks.registered[a];
                    if (c) {
                        var d = c[0],
                            e = c[1];
                        return b = v.Hooks.cleanRootPropertyValue(d, b), b.toString().match(v.RegEx.valueSplit)[e]
                    }
                    return b
                },
                injectValue: function(a, b, c) {
                    var d = v.Hooks.registered[a];
                    if (d) {
                        var e, f, g = d[0],
                            h = d[1];
                        return c = v.Hooks.cleanRootPropertyValue(g, c), e = c.toString().match(v.RegEx.valueSplit), e[h] = b, f = e.join(" ")
                    }
                    return c
                }
            },
            Normalizations: {
                registered: {
                    clip: function(a, b, c) {
                        switch (a) {
                            case "name":
                                return "clip";
                            case "extract":
                                var d;
                                return v.RegEx.wrappedValueAlreadyExtracted.test(c) ? d = c : (d = c.toString().match(v.RegEx.valueUnwrap), d = d ? d[1].replace(/,(\s+)?/g, " ") : c), d;
                            case "inject":
                                return "rect(" + c + ")"
                        }
                    },
                    blur: function(a, b, c) {
                        switch (a) {
                            case "name":
                                return t.State.isFirefox ? "filter" : "-webkit-filter";
                            case "extract":
                                var d = parseFloat(c);
                                if (!d && 0 !== d) {
                                    var e = c.toString().match(/blur\(([0-9]+[A-z]+)\)/i);
                                    d = e ? e[1] : 0
                                }
                                return d;
                            case "inject":
                                return parseFloat(c) ? "blur(" + c + ")" : "none"
                        }
                    },
                    opacity: function(a, b, c) {
                        if (8 >= n) switch (a) {
                            case "name":
                                return "filter";
                            case "extract":
                                var d = c.toString().match(/alpha\(opacity=(.*)\)/i);
                                return c = d ? d[1] / 100 : 1;
                            case "inject":
                                return b.style.zoom = 1, parseFloat(c) >= 1 ? "" : "alpha(opacity=" + parseInt(100 * parseFloat(c), 10) + ")"
                        } else switch (a) {
                            case "name":
                                return "opacity";
                            case "extract":
                                return c;
                            case "inject":
                                return c
                        }
                    }
                },
                register: function() {
                    9 >= n || t.State.isGingerbread || (v.Lists.transformsBase = v.Lists.transformsBase.concat(v.Lists.transforms3D));
                    for (var a = 0; a < v.Lists.transformsBase.length; a++) ! function() {
                        var b = v.Lists.transformsBase[a];
                        v.Normalizations.registered[b] = function(a, c, e) {
                            switch (a) {
                                case "name":
                                    return "transform";
                                case "extract":
                                    return g(c) === d || g(c).transformCache[b] === d ? /^scale/i.test(b) ? 1 : 0 : g(c).transformCache[b].replace(/[()]/g, "");
                                case "inject":
                                    var f = !1;
                                    switch (b.substr(0, b.length - 1)) {
                                        case "translate":
                                            f = !/(%|px|em|rem|vw|vh|\d)$/i.test(e);
                                            break;
                                        case "scal":
                                        case "scale":
                                            t.State.isAndroid && g(c).transformCache[b] === d && 1 > e && (e = 1), f = !/(\d)$/i.test(e);
                                            break;
                                        case "skew":
                                            f = !/(deg|\d)$/i.test(e);
                                            break;
                                        case "rotate":
                                            f = !/(deg|\d)$/i.test(e)
                                    }
                                    return f || (g(c).transformCache[b] = "(" + e + ")"), g(c).transformCache[b]
                            }
                        }
                    }();
                    for (var a = 0; a < v.Lists.colors.length; a++) ! function() {
                        var b = v.Lists.colors[a];
                        v.Normalizations.registered[b] = function(a, c, e) {
                            switch (a) {
                                case "name":
                                    return b;
                                case "extract":
                                    var f;
                                    if (v.RegEx.wrappedValueAlreadyExtracted.test(e)) f = e;
                                    else {
                                        var g, h = {
                                            black: "rgb(0, 0, 0)",
                                            blue: "rgb(0, 0, 255)",
                                            gray: "rgb(128, 128, 128)",
                                            green: "rgb(0, 128, 0)",
                                            red: "rgb(255, 0, 0)",
                                            white: "rgb(255, 255, 255)"
                                        };
                                        /^[A-z]+$/i.test(e) ? g = h[e] !== d ? h[e] : h.black : v.RegEx.isHex.test(e) ? g = "rgb(" + v.Values.hexToRgb(e).join(" ") + ")" : /^rgba?\(/i.test(e) || (g = h.black), f = (g || e).toString().match(v.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g, " ")
                                    }
                                    return 8 >= n || 3 !== f.split(" ").length || (f += " 1"), f;
                                case "inject":
                                    return 8 >= n ? 4 === e.split(" ").length && (e = e.split(/\s+/).slice(0, 3).join(" ")) : 3 === e.split(" ").length && (e += " 1"), (8 >= n ? "rgb" : "rgba") + "(" + e.replace(/\s+/g, ",").replace(/\.(\d)+(?=,)/g, "") + ")"
                            }
                        }
                    }()
                }
            },
            Names: {
                camelCase: function(a) {
                    return a.replace(/-(\w)/g, function(a, b) {
                        return b.toUpperCase()
                    })
                },
                SVGAttribute: function(a) {
                    var b = "width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";
                    return (n || t.State.isAndroid && !t.State.isChrome) && (b += "|transform"), new RegExp("^(" + b + ")$", "i").test(a)
                },
                prefixCheck: function(a) {
                    if (t.State.prefixMatches[a]) return [t.State.prefixMatches[a], !0];
                    for (var b = ["", "Webkit", "Moz", "ms", "O"], c = 0, d = b.length; d > c; c++) {
                        var e;
                        if (e = 0 === c ? a : b[c] + a.replace(/^\w/, function(a) {
                                return a.toUpperCase()
                            }), p.isString(t.State.prefixElement.style[e])) return t.State.prefixMatches[a] = e, [e, !0]
                    }
                    return [a, !1]
                }
            },
            Values: {
                hexToRgb: function(a) {
                    var b, c = /^#?([a-f\d])([a-f\d])([a-f\d])$/i,
                        d = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;
                    return a = a.replace(c, function(a, b, c, d) {
                        return b + b + c + c + d + d
                    }), b = d.exec(a), b ? [parseInt(b[1], 16), parseInt(b[2], 16), parseInt(b[3], 16)] : [0, 0, 0]
                },
                isCSSNullValue: function(a) {
                    return 0 == a || /^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(a)
                },
                getUnitType: function(a) {
                    return /^(rotate|skew)/i.test(a) ? "deg" : /(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(a) ? "" : "px"
                },
                getDisplayType: function(a) {
                    var b = a && a.tagName.toString().toLowerCase();
                    return /^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(b) ? "inline" : /^(li)$/i.test(b) ? "list-item" : /^(tr)$/i.test(b) ? "table-row" : /^(table)$/i.test(b) ? "table" : /^(tbody)$/i.test(b) ? "table-row-group" : "block"
                },
                addClass: function(a, b) {
                    a.classList ? a.classList.add(b) : a.className += (a.className.length ? " " : "") + b
                },
                removeClass: function(a, b) {
                    a.classList ? a.classList.remove(b) : a.className = a.className.toString().replace(new RegExp("(^|\\s)" + b.split(" ").join("|") + "(\\s|$)", "gi"), " ")
                }
            },
            getPropertyValue: function(a, c, e, f) {
                function h(a, c) {
                    function e() {
                        j && v.setPropertyValue(a, "display", "none")
                    }
                    var i = 0;
                    if (8 >= n) i = m.css(a, c);
                    else {
                        var j = !1;
                        if (/^(width|height)$/.test(c) && 0 === v.getPropertyValue(a, "display") && (j = !0, v.setPropertyValue(a, "display", v.Values.getDisplayType(a))), !f) {
                            if ("height" === c && "border-box" !== v.getPropertyValue(a, "boxSizing").toString().toLowerCase()) {
                                var k = a.offsetHeight - (parseFloat(v.getPropertyValue(a, "borderTopWidth")) || 0) - (parseFloat(v.getPropertyValue(a, "borderBottomWidth")) || 0) - (parseFloat(v.getPropertyValue(a, "paddingTop")) || 0) - (parseFloat(v.getPropertyValue(a, "paddingBottom")) || 0);
                                return e(), k
                            }
                            if ("width" === c && "border-box" !== v.getPropertyValue(a, "boxSizing").toString().toLowerCase()) {
                                var l = a.offsetWidth - (parseFloat(v.getPropertyValue(a, "borderLeftWidth")) || 0) - (parseFloat(v.getPropertyValue(a, "borderRightWidth")) || 0) - (parseFloat(v.getPropertyValue(a, "paddingLeft")) || 0) - (parseFloat(v.getPropertyValue(a, "paddingRight")) || 0);
                                return e(), l
                            }
                        }
                        var o;
                        o = g(a) === d ? b.getComputedStyle(a, null) : g(a).computedStyle ? g(a).computedStyle : g(a).computedStyle = b.getComputedStyle(a, null), "borderColor" === c && (c = "borderTopColor"), i = 9 === n && "filter" === c ? o.getPropertyValue(c) : o[c], ("" === i || null === i) && (i = a.style[c]), e()
                    }
                    if ("auto" === i && /^(top|right|bottom|left)$/i.test(c)) {
                        var p = h(a, "position");
                        ("fixed" === p || "absolute" === p && /top|left/i.test(c)) && (i = m(a).position()[c] + "px")
                    }
                    return i
                }
                var i;
                if (v.Hooks.registered[c]) {
                    var j = c,
                        k = v.Hooks.getRoot(j);
                    e === d && (e = v.getPropertyValue(a, v.Names.prefixCheck(k)[0])), v.Normalizations.registered[k] && (e = v.Normalizations.registered[k]("extract", a, e)), i = v.Hooks.extractValue(j, e)
                } else if (v.Normalizations.registered[c]) {
                    var l, o;
                    l = v.Normalizations.registered[c]("name", a), "transform" !== l && (o = h(a, v.Names.prefixCheck(l)[0]), v.Values.isCSSNullValue(o) && v.Hooks.templates[c] && (o = v.Hooks.templates[c][1])), i = v.Normalizations.registered[c]("extract", a, o)
                }
                if (!/^[\d-]/.test(i))
                    if (g(a) && g(a).isSVG && v.Names.SVGAttribute(c))
                        if (/^(height|width)$/i.test(c)) try {
                            i = a.getBBox()[c]
                        } catch (p) {
                            i = 0
                        } else i = a.getAttribute(c);
                        else i = h(a, v.Names.prefixCheck(c)[0]);
                return v.Values.isCSSNullValue(i) && (i = 0), t.debug >= 2 && console.log("Get " + c + ": " + i), i
            },
            setPropertyValue: function(a, c, d, e, f) {
                var h = c;
                if ("scroll" === c) f.container ? f.container["scroll" + f.direction] = d : "Left" === f.direction ? b.scrollTo(d, f.alternateValue) : b.scrollTo(f.alternateValue, d);
                else if (v.Normalizations.registered[c] && "transform" === v.Normalizations.registered[c]("name", a)) v.Normalizations.registered[c]("inject", a, d), h = "transform", d = g(a).transformCache[c];
                else {
                    if (v.Hooks.registered[c]) {
                        var i = c,
                            j = v.Hooks.getRoot(c);
                        e = e || v.getPropertyValue(a, j), d = v.Hooks.injectValue(i, d, e), c = j
                    }
                    if (v.Normalizations.registered[c] && (d = v.Normalizations.registered[c]("inject", a, d), c = v.Normalizations.registered[c]("name", a)), h = v.Names.prefixCheck(c)[0], 8 >= n) try {
                        a.style[h] = d
                    } catch (k) {
                        t.debug && console.log("Browser does not support [" + d + "] for [" + h + "]")
                    } else g(a) && g(a).isSVG && v.Names.SVGAttribute(c) ? a.setAttribute(c, d) : a.style[h] = d;
                    t.debug >= 2 && console.log("Set " + c + " (" + h + "): " + d)
                }
                return [h, d]
            },
            flushTransformCache: function(a) {
                function b(b) {
                    return parseFloat(v.getPropertyValue(a, b))
                }
                var c = "";
                if ((n || t.State.isAndroid && !t.State.isChrome) && g(a).isSVG) {
                    var d = {
                        translate: [b("translateX"), b("translateY")],
                        skewX: [b("skewX")],
                        skewY: [b("skewY")],
                        scale: 1 !== b("scale") ? [b("scale"), b("scale")] : [b("scaleX"), b("scaleY")],
                        rotate: [b("rotateZ"), 0, 0]
                    };
                    m.each(g(a).transformCache, function(a) {
                        /^translate/i.test(a) ? a = "translate" : /^scale/i.test(a) ? a = "scale" : /^rotate/i.test(a) && (a = "rotate"), d[a] && (c += a + "(" + d[a].join(" ") + ") ", delete d[a])
                    })
                } else {
                    var e, f;
                    m.each(g(a).transformCache, function(b) {
                        return e = g(a).transformCache[b], "transformPerspective" === b ? (f = e, !0) : (9 === n && "rotateZ" === b && (b = "rotate"), void(c += b + e + " "))
                    }), f && (c = "perspective" + f + " " + c)
                }
                v.setPropertyValue(a, "transform", c)
            }
        };
        v.Hooks.register(), v.Normalizations.register(), t.hook = function(a, b, c) {
            var e = d;
            return a = f(a), m.each(a, function(a, f) {
                if (g(f) === d && t.init(f), c === d) e === d && (e = t.CSS.getPropertyValue(f, b));
                else {
                    var h = t.CSS.setPropertyValue(f, b, c);
                    "transform" === h[0] && t.CSS.flushTransformCache(f), e = h
                }
            }), e
        };
        var w = function() {
            function a() {
                return h ? B.promise || null : i
            }

            function e() {
                function a() {
                    function a(a, b) {
                        var c = d,
                            e = d,
                            g = d;
                        return p.isArray(a) ? (c = a[0], !p.isArray(a[1]) && /^[\d-]/.test(a[1]) || p.isFunction(a[1]) || v.RegEx.isHex.test(a[1]) ? g = a[1] : (p.isString(a[1]) && !v.RegEx.isHex.test(a[1]) || p.isArray(a[1])) && (e = b ? a[1] : j(a[1], h.duration), a[2] !== d && (g = a[2]))) : c = a, b || (e = e || h.easing), p.isFunction(c) && (c = c.call(f, y, x)), p.isFunction(g) && (g = g.call(f, y, x)), [c || 0, e, g]
                    }

                    function l(a, b) {
                        var c, d;
                        return d = (b || "0").toString().toLowerCase().replace(/[%A-z]+$/, function(a) {
                            return c = a, ""
                        }), c || (c = v.Values.getUnitType(a)), [d, c]
                    }

                    function n() {
                        var a = {
                                myParent: f.parentNode || c.body,
                                position: v.getPropertyValue(f, "position"),
                                fontSize: v.getPropertyValue(f, "fontSize")
                            },
                            d = a.position === I.lastPosition && a.myParent === I.lastParent,
                            e = a.fontSize === I.lastFontSize;
                        I.lastParent = a.myParent, I.lastPosition = a.position, I.lastFontSize = a.fontSize;
                        var h = 100,
                            i = {};
                        if (e && d) i.emToPx = I.lastEmToPx, i.percentToPxWidth = I.lastPercentToPxWidth, i.percentToPxHeight = I.lastPercentToPxHeight;
                        else {
                            var j = g(f).isSVG ? c.createElementNS("http://www.w3.org/2000/svg", "rect") : c.createElement("div");
                            t.init(j), a.myParent.appendChild(j), m.each(["overflow", "overflowX", "overflowY"], function(a, b) {
                                t.CSS.setPropertyValue(j, b, "hidden")
                            }), t.CSS.setPropertyValue(j, "position", a.position), t.CSS.setPropertyValue(j, "fontSize", a.fontSize), t.CSS.setPropertyValue(j, "boxSizing", "content-box"), m.each(["minWidth", "maxWidth", "width", "minHeight", "maxHeight", "height"], function(a, b) {
                                t.CSS.setPropertyValue(j, b, h + "%")
                            }), t.CSS.setPropertyValue(j, "paddingLeft", h + "em"), i.percentToPxWidth = I.lastPercentToPxWidth = (parseFloat(v.getPropertyValue(j, "width", null, !0)) || 1) / h, i.percentToPxHeight = I.lastPercentToPxHeight = (parseFloat(v.getPropertyValue(j, "height", null, !0)) || 1) / h, i.emToPx = I.lastEmToPx = (parseFloat(v.getPropertyValue(j, "paddingLeft")) || 1) / h, a.myParent.removeChild(j)
                        }
                        return null === I.remToPx && (I.remToPx = parseFloat(v.getPropertyValue(c.body, "fontSize")) || 16), null === I.vwToPx && (I.vwToPx = parseFloat(b.innerWidth) / 100, I.vhToPx = parseFloat(b.innerHeight) / 100), i.remToPx = I.remToPx, i.vwToPx = I.vwToPx, i.vhToPx = I.vhToPx, t.debug >= 1 && console.log("Unit ratios: " + JSON.stringify(i), f), i
                    }
                    if (h.begin && 0 === y) try {
                        h.begin.call(o, o)
                    } catch (r) {
                        setTimeout(function() {
                            throw r
                        }, 1)
                    }
                    if ("scroll" === C) {
                        var u, w, z, A = /^x$/i.test(h.axis) ? "Left" : "Top",
                            D = parseFloat(h.offset) || 0;
                        h.container ? p.isWrapped(h.container) || p.isNode(h.container) ? (h.container = h.container[0] || h.container, u = h.container["scroll" + A], z = u + m(f).position()[A.toLowerCase()] + D) : h.container = null : (u = t.State.scrollAnchor[t.State["scrollProperty" + A]], w = t.State.scrollAnchor[t.State["scrollProperty" + ("Left" === A ? "Top" : "Left")]], z = m(f).offset()[A.toLowerCase()] + D), i = {
                            scroll: {
                                rootPropertyValue: !1,
                                startValue: u,
                                currentValue: u,
                                endValue: z,
                                unitType: "",
                                easing: h.easing,
                                scrollData: {
                                    container: h.container,
                                    direction: A,
                                    alternateValue: w
                                }
                            },
                            element: f
                        }, t.debug && console.log("tweensContainer (scroll): ", i.scroll, f)
                    } else if ("reverse" === C) {
                        if (!g(f).tweensContainer) return void m.dequeue(f, h.queue);
                        "none" === g(f).opts.display && (g(f).opts.display = "auto"), "hidden" === g(f).opts.visibility && (g(f).opts.visibility = "visible"), g(f).opts.loop = !1, g(f).opts.begin = null, g(f).opts.complete = null, s.easing || delete h.easing, s.duration || delete h.duration, h = m.extend({}, g(f).opts, h);
                        var E = m.extend(!0, {}, g(f).tweensContainer);
                        for (var F in E)
                            if ("element" !== F) {
                                var G = E[F].startValue;
                                E[F].startValue = E[F].currentValue = E[F].endValue, E[F].endValue = G, p.isEmptyObject(s) || (E[F].easing = h.easing), t.debug && console.log("reverse tweensContainer (" + F + "): " + JSON.stringify(E[F]), f)
                            } i = E
                    } else if ("start" === C) {
                        var E;
                        g(f).tweensContainer && g(f).isAnimating === !0 && (E = g(f).tweensContainer), m.each(q, function(b, c) {
                            if (RegExp("^" + v.Lists.colors.join("$|^") + "$").test(b)) {
                                var e = a(c, !0),
                                    f = e[0],
                                    g = e[1],
                                    h = e[2];
                                if (v.RegEx.isHex.test(f)) {
                                    for (var i = ["Red", "Green", "Blue"], j = v.Values.hexToRgb(f), k = h ? v.Values.hexToRgb(h) : d, l = 0; l < i.length; l++) {
                                        var m = [j[l]];
                                        g && m.push(g), k !== d && m.push(k[l]), q[b + i[l]] = m
                                    }
                                    delete q[b]
                                }
                            }
                        });
                        for (var H in q) {
                            var K = a(q[H]),
                                L = K[0],
                                M = K[1],
                                N = K[2];
                            H = v.Names.camelCase(H);
                            var O = v.Hooks.getRoot(H),
                                P = !1;
                            if (g(f).isSVG || "tween" === O || v.Names.prefixCheck(O)[1] !== !1 || v.Normalizations.registered[O] !== d) {
                                (h.display !== d && null !== h.display && "none" !== h.display || h.visibility !== d && "hidden" !== h.visibility) && /opacity|filter/.test(H) && !N && 0 !== L && (N = 0), h._cacheValues && E && E[H] ? (N === d && (N = E[H].endValue + E[H].unitType), P = g(f).rootPropertyValueCache[O]) : v.Hooks.registered[H] ? N === d ? (P = v.getPropertyValue(f, O), N = v.getPropertyValue(f, H, P)) : P = v.Hooks.templates[O][1] : N === d && (N = v.getPropertyValue(f, H));
                                var Q, R, S, T = !1;
                                if (Q = l(H, N), N = Q[0], S = Q[1], Q = l(H, L), L = Q[0].replace(/^([+-\/*])=/, function(a, b) {
                                        return T = b, ""
                                    }), R = Q[1], N = parseFloat(N) || 0, L = parseFloat(L) || 0, "%" === R && (/^(fontSize|lineHeight)$/.test(H) ? (L /= 100, R = "em") : /^scale/.test(H) ? (L /= 100, R = "") : /(Red|Green|Blue)$/i.test(H) && (L = L / 100 * 255, R = "")), /[\/*]/.test(T)) R = S;
                                else if (S !== R && 0 !== N)
                                    if (0 === L) R = S;
                                    else {
                                        e = e || n();
                                        var U = /margin|padding|left|right|width|text|word|letter/i.test(H) || /X$/.test(H) || "x" === H ? "x" : "y";
                                        switch (S) {
                                            case "%":
                                                N *= "x" === U ? e.percentToPxWidth : e.percentToPxHeight;
                                                break;
                                            case "px":
                                                break;
                                            default:
                                                N *= e[S + "ToPx"]
                                        }
                                        switch (R) {
                                            case "%":
                                                N *= 1 / ("x" === U ? e.percentToPxWidth : e.percentToPxHeight);
                                                break;
                                            case "px":
                                                break;
                                            default:
                                                N *= 1 / e[R + "ToPx"]
                                        }
                                    } switch (T) {
                                    case "+":
                                        L = N + L;
                                        break;
                                    case "-":
                                        L = N - L;
                                        break;
                                    case "*":
                                        L = N * L;
                                        break;
                                    case "/":
                                        L = N / L
                                }
                                i[H] = {
                                    rootPropertyValue: P,
                                    startValue: N,
                                    currentValue: N,
                                    endValue: L,
                                    unitType: R,
                                    easing: M
                                }, t.debug && console.log("tweensContainer (" + H + "): " + JSON.stringify(i[H]), f)
                            } else t.debug && console.log("Skipping [" + O + "] due to a lack of browser support.")
                        }
                        i.element = f
                    }
                    i.element && (v.Values.addClass(f, "velocity-animating"), J.push(i), "" === h.queue && (g(f).tweensContainer = i, g(f).opts = h), g(f).isAnimating = !0, y === x - 1 ? (t.State.calls.push([J, o, h, null, B.resolver]), t.State.isTicking === !1 && (t.State.isTicking = !0, k())) : y++)
                }
                var e, f = this,
                    h = m.extend({}, t.defaults, s),
                    i = {};
                switch (g(f) === d && t.init(f), parseFloat(h.delay) && h.queue !== !1 && m.queue(f, h.queue, function(a) {
                        t.velocityQueueEntryFlag = !0, g(f).delayTimer = {
                            setTimeout: setTimeout(a, parseFloat(h.delay)),
                            next: a
                        }
                    }), h.duration.toString().toLowerCase()) {
                    case "fast":
                        h.duration = 200;
                        break;
                    case "normal":
                        h.duration = r;
                        break;
                    case "slow":
                        h.duration = 600;
                        break;
                    default:
                        h.duration = parseFloat(h.duration) || 1
                }
                t.mock !== !1 && (t.mock === !0 ? h.duration = h.delay = 1 : (h.duration *= parseFloat(t.mock) || 1, h.delay *= parseFloat(t.mock) || 1)), h.easing = j(h.easing, h.duration), h.begin && !p.isFunction(h.begin) && (h.begin = null), h.progress && !p.isFunction(h.progress) && (h.progress = null), h.complete && !p.isFunction(h.complete) && (h.complete = null), h.display !== d && null !== h.display && (h.display = h.display.toString().toLowerCase(), "auto" === h.display && (h.display = t.CSS.Values.getDisplayType(f))), h.visibility !== d && null !== h.visibility && (h.visibility = h.visibility.toString().toLowerCase()), h.mobileHA = h.mobileHA && t.State.isMobile && !t.State.isGingerbread, h.queue === !1 ? h.delay ? setTimeout(a, h.delay) : a() : m.queue(f, h.queue, function(b, c) {
                    return c === !0 ? (B.promise && B.resolver(o), !0) : (t.velocityQueueEntryFlag = !0, void a(b))
                }), "" !== h.queue && "fx" !== h.queue || "inprogress" === m.queue(f)[0] || m.dequeue(f)
            }
            var h, i, n, o, q, s, u = arguments[0] && (arguments[0].p || m.isPlainObject(arguments[0].properties) && !arguments[0].properties.names || p.isString(arguments[0].properties));
            if (p.isWrapped(this) ? (h = !1, n = 0, o = this, i = this) : (h = !0, n = 1, o = u ? arguments[0].elements || arguments[0].e : arguments[0]), o = f(o)) {
                u ? (q = arguments[0].properties || arguments[0].p, s = arguments[0].options || arguments[0].o) : (q = arguments[n], s = arguments[n + 1]);
                var x = o.length,
                    y = 0;
                if (!/^(stop|finish|finishAll)$/i.test(q) && !m.isPlainObject(s)) {
                    var z = n + 1;
                    s = {};
                    for (var A = z; A < arguments.length; A++) p.isArray(arguments[A]) || !/^(fast|normal|slow)$/i.test(arguments[A]) && !/^\d/.test(arguments[A]) ? p.isString(arguments[A]) || p.isArray(arguments[A]) ? s.easing = arguments[A] : p.isFunction(arguments[A]) && (s.complete = arguments[A]) : s.duration = arguments[A]
                }
                var B = {
                    promise: null,
                    resolver: null,
                    rejecter: null
                };
                h && t.Promise && (B.promise = new t.Promise(function(a, b) {
                    B.resolver = a, B.rejecter = b
                }));
                var C;
                switch (q) {
                    case "scroll":
                        C = "scroll";
                        break;
                    case "reverse":
                        C = "reverse";
                        break;
                    case "finish":
                    case "finishAll":
                    case "stop":
                        m.each(o, function(a, b) {
                            g(b) && g(b).delayTimer && (clearTimeout(g(b).delayTimer.setTimeout), g(b).delayTimer.next && g(b).delayTimer.next(), delete g(b).delayTimer), "finishAll" !== q || s !== !0 && !p.isString(s) || (m.each(m.queue(b, p.isString(s) ? s : ""), function(a, b) {
                                p.isFunction(b) && b()
                            }), m.queue(b, p.isString(s) ? s : "", []))
                        });
                        var D = [];
                        return m.each(t.State.calls, function(a, b) {
                            b && m.each(b[1], function(c, e) {
                                var f = s === d ? "" : s;
                                return f === !0 || b[2].queue === f || s === d && b[2].queue === !1 ? void m.each(o, function(c, d) {
                                    d === e && ((s === !0 || p.isString(s)) && (m.each(m.queue(d, p.isString(s) ? s : ""), function(a, b) {
                                        p.isFunction(b) && b(null, !0)
                                    }), m.queue(d, p.isString(s) ? s : "", [])), "stop" === q ? (g(d) && g(d).tweensContainer && f !== !1 && m.each(g(d).tweensContainer, function(a, b) {
                                        b.endValue = b.currentValue
                                    }), D.push(a)) : ("finish" === q || "finishAll" === q) && (b[2].duration = 1))
                                }) : !0
                            })
                        }), "stop" === q && (m.each(D, function(a, b) {
                            l(b, !0)
                        }), B.promise && B.resolver(o)), a();
                    default:
                        if (!m.isPlainObject(q) || p.isEmptyObject(q)) {
                            if (p.isString(q) && t.Redirects[q]) {
                                var E = m.extend({}, s),
                                    F = E.duration,
                                    G = E.delay || 0;
                                return E.backwards === !0 && (o = m.extend(!0, [], o).reverse()), m.each(o, function(a, b) {
                                    parseFloat(E.stagger) ? E.delay = G + parseFloat(E.stagger) * a : p.isFunction(E.stagger) && (E.delay = G + E.stagger.call(b, a, x)), E.drag && (E.duration = parseFloat(F) || (/^(callout|transition)/.test(q) ? 1e3 : r), E.duration = Math.max(E.duration * (E.backwards ? 1 - a / x : (a + 1) / x), .75 * E.duration, 200)), t.Redirects[q].call(b, b, E || {}, a, x, o, B.promise ? B : d)
                                }), a()
                            }
                            var H = "Velocity: First argument (" + q + ") was not a property map, a known action, or a registered redirect. Aborting.";
                            return B.promise ? B.rejecter(new Error(H)) : console.log(H), a()
                        }
                        C = "start"
                }
                var I = {
                        lastParent: null,
                        lastPosition: null,
                        lastFontSize: null,
                        lastPercentToPxWidth: null,
                        lastPercentToPxHeight: null,
                        lastEmToPx: null,
                        remToPx: null,
                        vwToPx: null,
                        vhToPx: null
                    },
                    J = [];
                m.each(o, function(a, b) {
                    p.isNode(b) && e.call(b)
                });
                var K, E = m.extend({}, t.defaults, s);
                if (E.loop = parseInt(E.loop), K = 2 * E.loop - 1, E.loop)
                    for (var L = 0; K > L; L++) {
                        var M = {
                            delay: E.delay,
                            progress: E.progress
                        };
                        L === K - 1 && (M.display = E.display, M.visibility = E.visibility, M.complete = E.complete), w(o, "reverse", M)
                    }
                return a()
            }
        };
        t = m.extend(w, t), t.animate = w;
        var x = b.requestAnimationFrame || o;
        return t.State.isMobile || c.hidden === d || c.addEventListener("visibilitychange", function() {
            c.hidden ? (x = function(a) {
                return setTimeout(function() {
                    a(!0)
                }, 16)
            }, k()) : x = b.requestAnimationFrame || o
        }), a.Velocity = t, a !== b && (a.fn.velocity = w, a.fn.velocity.defaults = t.defaults), m.each(["Down", "Up"], function(a, b) {
            t.Redirects["slide" + b] = function(a, c, e, f, g, h) {
                var i = m.extend({}, c),
                    j = i.begin,
                    k = i.complete,
                    l = {
                        height: "",
                        marginTop: "",
                        marginBottom: "",
                        paddingTop: "",
                        paddingBottom: ""
                    },
                    n = {};
                i.display === d && (i.display = "Down" === b ? "inline" === t.CSS.Values.getDisplayType(a) ? "inline-block" : "block" : "none"), i.begin = function() {
                    j && j.call(g, g);
                    for (var c in l) {
                        n[c] = a.style[c];
                        var d = t.CSS.getPropertyValue(a, c);
                        l[c] = "Down" === b ? [d, 0] : [0, d]
                    }
                    n.overflow = a.style.overflow, a.style.overflow = "hidden"
                }, i.complete = function() {
                    for (var b in n) a.style[b] = n[b];
                    k && k.call(g, g), h && h.resolver(g)
                }, t(a, l, i)
            }
        }), m.each(["In", "Out"], function(a, b) {
            t.Redirects["fade" + b] = function(a, c, e, f, g, h) {
                var i = m.extend({}, c),
                    j = {
                        opacity: "In" === b ? 1 : 0
                    },
                    k = i.complete;
                i.complete = e !== f - 1 ? i.begin = null : function() {
                    k && k.call(g, g), h && h.resolver(g)
                }, i.display === d && (i.display = "In" === b ? "auto" : "none"), t(this, j, i)
            }
        }), t
    }(window.jQuery || window.Zepto || window, window, document)
});
! function(t) {
    if ("object" == typeof exports && "undefined" != typeof module) module.exports = t();
    else if ("function" == typeof define && define.amd) define([], t);
    else {
        var e;
        e = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this, e.PIXI = t()
    }
}(function() {
    var t;
    return function() {
        function t(e, r, n) {
            function i(s, a) {
                if (!r[s]) {
                    if (!e[s]) {
                        var u = "function" == typeof require && require;
                        if (!a && u) return u(s, !0);
                        if (o) return o(s, !0);
                        var h = new Error("Cannot find module '" + s + "'");
                        throw h.code = "MODULE_NOT_FOUND", h
                    }
                    var l = r[s] = {
                        exports: {}
                    };
                    e[s][0].call(l.exports, function(t) {
                        var r = e[s][1][t];
                        return i(r || t)
                    }, l, l.exports, t, e, r, n)
                }
                return r[s].exports
            }
            for (var o = "function" == typeof require && require, s = 0; s < n.length; s++) i(n[s]);
            return i
        }
        return t
    }()({
        1: [function(t, e, r) {
            "use strict";
            "use restrict";

            function n(t) {
                var e = 32;
                return t &= -t, t && e--, 65535 & t && (e -= 16), 16711935 & t && (e -= 8), 252645135 & t && (e -= 4), 858993459 & t && (e -= 2), 1431655765 & t && (e -= 1), e
            }
            r.INT_BITS = 32, r.INT_MAX = 2147483647, r.INT_MIN = -1 << 31, r.sign = function(t) {
                return (t > 0) - (t < 0)
            }, r.abs = function(t) {
                var e = t >> 31;
                return (t ^ e) - e
            }, r.min = function(t, e) {
                return e ^ (t ^ e) & -(t < e)
            }, r.max = function(t, e) {
                return t ^ (t ^ e) & -(t < e)
            }, r.isPow2 = function(t) {
                return !(t & t - 1 || !t)
            }, r.log2 = function(t) {
                var e, r;
                return e = (t > 65535) << 4, t >>>= e, r = (t > 255) << 3, t >>>= r, e |= r, r = (t > 15) << 2, t >>>= r, e |= r, r = (t > 3) << 1, t >>>= r, (e |= r) | t >> 1
            }, r.log10 = function(t) {
                return t >= 1e9 ? 9 : t >= 1e8 ? 8 : t >= 1e7 ? 7 : t >= 1e6 ? 6 : t >= 1e5 ? 5 : t >= 1e4 ? 4 : t >= 1e3 ? 3 : t >= 100 ? 2 : t >= 10 ? 1 : 0
            }, r.popCount = function(t) {
                return t -= t >>> 1 & 1431655765, 16843009 * ((t = (858993459 & t) + (t >>> 2 & 858993459)) + (t >>> 4) & 252645135) >>> 24
            }, r.countTrailingZeros = n, r.nextPow2 = function(t) {
                return t += 0 === t, --t, t |= t >>> 1, t |= t >>> 2, t |= t >>> 4, t |= t >>> 8, (t |= t >>> 16) + 1
            }, r.prevPow2 = function(t) {
                return t |= t >>> 1, t |= t >>> 2, t |= t >>> 4, t |= t >>> 8, (t |= t >>> 16) - (t >>> 1)
            }, r.parity = function(t) {
                return t ^= t >>> 16, t ^= t >>> 8, t ^= t >>> 4, 27030 >>> (t &= 15) & 1
            };
            var i = new Array(256);
            ! function(t) {
                for (var e = 0; e < 256; ++e) {
                    var r = e,
                        n = e,
                        i = 7;
                    for (r >>>= 1; r; r >>>= 1) n <<= 1, n |= 1 & r, --i;
                    t[e] = n << i & 255
                }
            }(i), r.reverse = function(t) {
                return i[255 & t] << 24 | i[t >>> 8 & 255] << 16 | i[t >>> 16 & 255] << 8 | i[t >>> 24 & 255]
            }, r.interleave2 = function(t, e) {
                return t &= 65535, t = 16711935 & (t | t << 8), t = 252645135 & (t | t << 4), t = 858993459 & (t | t << 2), t = 1431655765 & (t | t << 1), e &= 65535, e = 16711935 & (e | e << 8), e = 252645135 & (e | e << 4), e = 858993459 & (e | e << 2), e = 1431655765 & (e | e << 1), t | e << 1
            }, r.deinterleave2 = function(t, e) {
                return t = t >>> e & 1431655765, t = 858993459 & (t | t >>> 1), t = 252645135 & (t | t >>> 2), t = 16711935 & (t | t >>> 4), (t = 65535 & (t | t >>> 16)) << 16 >> 16
            }, r.interleave3 = function(t, e, r) {
                return t &= 1023, t = 4278190335 & (t | t << 16), t = 251719695 & (t | t << 8), t = 3272356035 & (t | t << 4), t = 1227133513 & (t | t << 2), e &= 1023, e = 4278190335 & (e | e << 16), e = 251719695 & (e | e << 8), e = 3272356035 & (e | e << 4), e = 1227133513 & (e | e << 2), t |= e << 1, r &= 1023, r = 4278190335 & (r | r << 16), r = 251719695 & (r | r << 8), r = 3272356035 & (r | r << 4), r = 1227133513 & (r | r << 2), t | r << 2
            }, r.deinterleave3 = function(t, e) {
                return t = t >>> e & 1227133513, t = 3272356035 & (t | t >>> 2), t = 251719695 & (t | t >>> 4), t = 4278190335 & (t | t >>> 8), (t = 1023 & (t | t >>> 16)) << 22 >> 22
            }, r.nextCombination = function(t) {
                var e = t | t - 1;
                return e + 1 | (~e & -~e) - 1 >>> n(t) + 1
            }
        }, {}],
        2: [function(t, e, r) {
            "use strict";

            function n(t, e, r) {
                r = r || 2;
                var n = e && e.length,
                    o = n ? e[0] * r : t.length,
                    a = i(t, 0, o, r, !0),
                    u = [];
                if (!a) return u;
                var h, l, d, f, p, v, y;
                if (n && (a = c(t, e, a, r)), t.length > 80 * r) {
                    h = d = t[0], l = f = t[1];
                    for (var g = r; g < o; g += r) p = t[g], v = t[g + 1], p < h && (h = p), v < l && (l = v), p > d && (d = p), v > f && (f = v);
                    y = Math.max(d - h, f - l), y = 0 !== y ? 1 / y : 0
                }
                return s(a, u, r, h, l, y), u
            }

            function i(t, e, r, n, i) {
                var o, s;
                if (i === A(t, e, r, n) > 0)
                    for (o = e; o < r; o += n) s = P(o, t[o], t[o + 1], s);
                else
                    for (o = r - n; o >= e; o -= n) s = P(o, t[o], t[o + 1], s);
                return s && T(s, s.next) && (C(s), s = s.next), s
            }

            function o(t, e) {
                if (!t) return t;
                e || (e = t);
                var r, n = t;
                do {
                    if (r = !1, n.steiner || !T(n, n.next) && 0 !== x(n.prev, n, n.next)) n = n.next;
                    else {
                        if (C(n), (n = e = n.prev) === n.next) break;
                        r = !0
                    }
                } while (r || n !== e);
                return e
            }

            function s(t, e, r, n, i, c, d) {
                if (t) {
                    !d && c && v(t, n, i, c);
                    for (var f, p, y = t; t.prev !== t.next;)
                        if (f = t.prev, p = t.next, c ? u(t, n, i, c) : a(t)) e.push(f.i / r), e.push(t.i / r), e.push(p.i / r), C(t), t = p.next, y = p.next;
                        else if ((t = p) === y) {
                        d ? 1 === d ? (t = h(t, e, r), s(t, e, r, n, i, c, 2)) : 2 === d && l(t, e, r, n, i, c) : s(o(t), e, r, n, i, c, 1);
                        break
                    }
                }
            }

            function a(t) {
                var e = t.prev,
                    r = t,
                    n = t.next;
                if (x(e, r, n) >= 0) return !1;
                for (var i = t.next.next; i !== t.prev;) {
                    if (_(e.x, e.y, r.x, r.y, n.x, n.y, i.x, i.y) && x(i.prev, i, i.next) >= 0) return !1;
                    i = i.next
                }
                return !0
            }

            function u(t, e, r, n) {
                var i = t.prev,
                    o = t,
                    s = t.next;
                if (x(i, o, s) >= 0) return !1;
                for (var a = i.x < o.x ? i.x < s.x ? i.x : s.x : o.x < s.x ? o.x : s.x, u = i.y < o.y ? i.y < s.y ? i.y : s.y : o.y < s.y ? o.y : s.y, h = i.x > o.x ? i.x > s.x ? i.x : s.x : o.x > s.x ? o.x : s.x, l = i.y > o.y ? i.y > s.y ? i.y : s.y : o.y > s.y ? o.y : s.y, c = g(a, u, e, r, n), d = g(h, l, e, r, n), f = t.prevZ, p = t.nextZ; f && f.z >= c && p && p.z <= d;) {
                    if (f !== t.prev && f !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, f.x, f.y) && x(f.prev, f, f.next) >= 0) return !1;
                    if (f = f.prevZ, p !== t.prev && p !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, p.x, p.y) && x(p.prev, p, p.next) >= 0) return !1;
                    p = p.nextZ
                }
                for (; f && f.z >= c;) {
                    if (f !== t.prev && f !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, f.x, f.y) && x(f.prev, f, f.next) >= 0) return !1;
                    f = f.prevZ
                }
                for (; p && p.z <= d;) {
                    if (p !== t.prev && p !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, p.x, p.y) && x(p.prev, p, p.next) >= 0) return !1;
                    p = p.nextZ
                }
                return !0
            }

            function h(t, e, r) {
                var n = t;
                do {
                    var i = n.prev,
                        o = n.next.next;
                    !T(i, o) && w(i, n, n.next, o) && S(i, o) && S(o, i) && (e.push(i.i / r), e.push(n.i / r), e.push(o.i / r), C(n), C(n.next), n = t = o), n = n.next
                } while (n !== t);
                return n
            }

            function l(t, e, r, n, i, a) {
                var u = t;
                do {
                    for (var h = u.next.next; h !== u.prev;) {
                        if (u.i !== h.i && b(u, h)) {
                            var l = M(u, h);
                            return u = o(u, u.next), l = o(l, l.next), s(u, e, r, n, i, a), void s(l, e, r, n, i, a)
                        }
                        h = h.next
                    }
                    u = u.next
                } while (u !== t)
            }

            function c(t, e, r, n) {
                var s, a, u, h, l, c = [];
                for (s = 0, a = e.length; s < a; s++) u = e[s] * n, h = s < a - 1 ? e[s + 1] * n : t.length, l = i(t, u, h, n, !1), l === l.next && (l.steiner = !0), c.push(m(l));
                for (c.sort(d), s = 0; s < c.length; s++) f(c[s], r), r = o(r, r.next);
                return r
            }

            function d(t, e) {
                return t.x - e.x
            }

            function f(t, e) {
                if (e = p(t, e)) {
                    var r = M(e, t);
                    o(r, r.next)
                }
            }

            function p(t, e) {
                var r, n = e,
                    i = t.x,
                    o = t.y,
                    s = -1 / 0;
                do {
                    if (o <= n.y && o >= n.next.y && n.next.y !== n.y) {
                        var a = n.x + (o - n.y) * (n.next.x - n.x) / (n.next.y - n.y);
                        if (a <= i && a > s) {
                            if (s = a, a === i) {
                                if (o === n.y) return n;
                                if (o === n.next.y) return n.next
                            }
                            r = n.x < n.next.x ? n : n.next
                        }
                    }
                    n = n.next
                } while (n !== e);
                if (!r) return null;
                if (i === s) return r.prev;
                var u, h = r,
                    l = r.x,
                    c = r.y,
                    d = 1 / 0;
                for (n = r.next; n !== h;) i >= n.x && n.x >= l && i !== n.x && _(o < c ? i : s, o, l, c, o < c ? s : i, o, n.x, n.y) && ((u = Math.abs(o - n.y) / (i - n.x)) < d || u === d && n.x > r.x) && S(n, t) && (r = n, d = u), n = n.next;
                return r
            }

            function v(t, e, r, n) {
                var i = t;
                do {
                    null === i.z && (i.z = g(i.x, i.y, e, r, n)), i.prevZ = i.prev, i.nextZ = i.next, i = i.next
                } while (i !== t);
                i.prevZ.nextZ = null, i.prevZ = null, y(i)
            }

            function y(t) {
                var e, r, n, i, o, s, a, u, h = 1;
                do {
                    for (r = t, t = null, o = null, s = 0; r;) {
                        for (s++, n = r, a = 0, e = 0; e < h && (a++, n = n.nextZ); e++);
                        for (u = h; a > 0 || u > 0 && n;) 0 !== a && (0 === u || !n || r.z <= n.z) ? (i = r, r = r.nextZ, a--) : (i = n, n = n.nextZ, u--), o ? o.nextZ = i : t = i, i.prevZ = o, o = i;
                        r = n
                    }
                    o.nextZ = null, h *= 2
                } while (s > 1);
                return t
            }

            function g(t, e, r, n, i) {
                return t = 32767 * (t - r) * i, e = 32767 * (e - n) * i, t = 16711935 & (t | t << 8), t = 252645135 & (t | t << 4), t = 858993459 & (t | t << 2), t = 1431655765 & (t | t << 1), e = 16711935 & (e | e << 8), e = 252645135 & (e | e << 4), e = 858993459 & (e | e << 2), e = 1431655765 & (e | e << 1), t | e << 1
            }

            function m(t) {
                var e = t,
                    r = t;
                do {
                    e.x < r.x && (r = e), e = e.next
                } while (e !== t);
                return r
            }

            function _(t, e, r, n, i, o, s, a) {
                return (i - s) * (e - a) - (t - s) * (o - a) >= 0 && (t - s) * (n - a) - (r - s) * (e - a) >= 0 && (r - s) * (o - a) - (i - s) * (n - a) >= 0
            }

            function b(t, e) {
                return t.next.i !== e.i && t.prev.i !== e.i && !E(t, e) && S(t, e) && S(e, t) && O(t, e)
            }

            function x(t, e, r) {
                return (e.y - t.y) * (r.x - e.x) - (e.x - t.x) * (r.y - e.y)
            }

            function T(t, e) {
                return t.x === e.x && t.y === e.y
            }

            function w(t, e, r, n) {
                return !!(T(t, e) && T(r, n) || T(t, n) && T(r, e)) || x(t, e, r) > 0 != x(t, e, n) > 0 && x(r, n, t) > 0 != x(r, n, e) > 0
            }

            function E(t, e) {
                var r = t;
                do {
                    if (r.i !== t.i && r.next.i !== t.i && r.i !== e.i && r.next.i !== e.i && w(r, r.next, t, e)) return !0;
                    r = r.next
                } while (r !== t);
                return !1
            }

            function S(t, e) {
                return x(t.prev, t, t.next) < 0 ? x(t, e, t.next) >= 0 && x(t, t.prev, e) >= 0 : x(t, e, t.prev) < 0 || x(t, t.next, e) < 0
            }

            function O(t, e) {
                var r = t,
                    n = !1,
                    i = (t.x + e.x) / 2,
                    o = (t.y + e.y) / 2;
                do {
                    r.y > o != r.next.y > o && r.next.y !== r.y && i < (r.next.x - r.x) * (o - r.y) / (r.next.y - r.y) + r.x && (n = !n), r = r.next
                } while (r !== t);
                return n
            }

            function M(t, e) {
                var r = new R(t.i, t.x, t.y),
                    n = new R(e.i, e.x, e.y),
                    i = t.next,
                    o = e.prev;
                return t.next = e, e.prev = t, r.next = i, i.prev = r, n.next = r, r.prev = n, o.next = n, n.prev = o, n
            }

            function P(t, e, r, n) {
                var i = new R(t, e, r);
                return n ? (i.next = n.next, i.prev = n, n.next.prev = i, n.next = i) : (i.prev = i, i.next = i), i
            }

            function C(t) {
                t.next.prev = t.prev, t.prev.next = t.next, t.prevZ && (t.prevZ.nextZ = t.nextZ), t.nextZ && (t.nextZ.prevZ = t.prevZ)
            }

            function R(t, e, r) {
                this.i = t, this.x = e, this.y = r, this.prev = null, this.next = null, this.z = null, this.prevZ = null, this.nextZ = null, this.steiner = !1
            }

            function A(t, e, r, n) {
                for (var i = 0, o = e, s = r - n; o < r; o += n) i += (t[s] - t[o]) * (t[o + 1] + t[s + 1]), s = o;
                return i
            }
            e.exports = n, e.exports.default = n, n.deviation = function(t, e, r, n) {
                var i = e && e.length,
                    o = i ? e[0] * r : t.length,
                    s = Math.abs(A(t, 0, o, r));
                if (i)
                    for (var a = 0, u = e.length; a < u; a++) {
                        var h = e[a] * r,
                            l = a < u - 1 ? e[a + 1] * r : t.length;
                        s -= Math.abs(A(t, h, l, r))
                    }
                var c = 0;
                for (a = 0; a < n.length; a += 3) {
                    var d = n[a] * r,
                        f = n[a + 1] * r,
                        p = n[a + 2] * r;
                    c += Math.abs((t[d] - t[p]) * (t[f + 1] - t[d + 1]) - (t[d] - t[f]) * (t[p + 1] - t[d + 1]))
                }
                return 0 === s && 0 === c ? 0 : Math.abs((c - s) / s)
            }, n.flatten = function(t) {
                for (var e = t[0][0].length, r = {
                        vertices: [],
                        holes: [],
                        dimensions: e
                    }, n = 0, i = 0; i < t.length; i++) {
                    for (var o = 0; o < t[i].length; o++)
                        for (var s = 0; s < e; s++) r.vertices.push(t[i][o][s]);
                    i > 0 && (n += t[i - 1].length, r.holes.push(n))
                }
                return r
            }
        }, {}],
        3: [function(t, e, r) {
            "use strict";

            function n() {}

            function i(t, e, r) {
                this.fn = t, this.context = e, this.once = r || !1
            }

            function o() {
                this._events = new n, this._eventsCount = 0
            }
            var s = Object.prototype.hasOwnProperty,
                a = "~";
            Object.create && (n.prototype = Object.create(null), (new n).__proto__ || (a = !1)), o.prototype.eventNames = function() {
                var t, e, r = [];
                if (0 === this._eventsCount) return r;
                for (e in t = this._events) s.call(t, e) && r.push(a ? e.slice(1) : e);
                return Object.getOwnPropertySymbols ? r.concat(Object.getOwnPropertySymbols(t)) : r
            }, o.prototype.listeners = function(t, e) {
                var r = a ? a + t : t,
                    n = this._events[r];
                if (e) return !!n;
                if (!n) return [];
                if (n.fn) return [n.fn];
                for (var i = 0, o = n.length, s = new Array(o); i < o; i++) s[i] = n[i].fn;
                return s
            }, o.prototype.emit = function(t, e, r, n, i, o) {
                var s = a ? a + t : t;
                if (!this._events[s]) return !1;
                var u, h, l = this._events[s],
                    c = arguments.length;
                if (l.fn) {
                    switch (l.once && this.removeListener(t, l.fn, void 0, !0), c) {
                        case 1:
                            return l.fn.call(l.context), !0;
                        case 2:
                            return l.fn.call(l.context, e), !0;
                        case 3:
                            return l.fn.call(l.context, e, r), !0;
                        case 4:
                            return l.fn.call(l.context, e, r, n), !0;
                        case 5:
                            return l.fn.call(l.context, e, r, n, i), !0;
                        case 6:
                            return l.fn.call(l.context, e, r, n, i, o), !0
                    }
                    for (h = 1, u = new Array(c - 1); h < c; h++) u[h - 1] = arguments[h];
                    l.fn.apply(l.context, u)
                } else {
                    var d, f = l.length;
                    for (h = 0; h < f; h++) switch (l[h].once && this.removeListener(t, l[h].fn, void 0, !0), c) {
                        case 1:
                            l[h].fn.call(l[h].context);
                            break;
                        case 2:
                            l[h].fn.call(l[h].context, e);
                            break;
                        case 3:
                            l[h].fn.call(l[h].context, e, r);
                            break;
                        case 4:
                            l[h].fn.call(l[h].context, e, r, n);
                            break;
                        default:
                            if (!u)
                                for (d = 1, u = new Array(c - 1); d < c; d++) u[d - 1] = arguments[d];
                            l[h].fn.apply(l[h].context, u)
                    }
                }
                return !0
            }, o.prototype.on = function(t, e, r) {
                var n = new i(e, r || this),
                    o = a ? a + t : t;
                return this._events[o] ? this._events[o].fn ? this._events[o] = [this._events[o], n] : this._events[o].push(n) : (this._events[o] = n, this._eventsCount++), this
            }, o.prototype.once = function(t, e, r) {
                var n = new i(e, r || this, !0),
                    o = a ? a + t : t;
                return this._events[o] ? this._events[o].fn ? this._events[o] = [this._events[o], n] : this._events[o].push(n) : (this._events[o] = n, this._eventsCount++), this
            }, o.prototype.removeListener = function(t, e, r, i) {
                var o = a ? a + t : t;
                if (!this._events[o]) return this;
                if (!e) return 0 == --this._eventsCount ? this._events = new n : delete this._events[o], this;
                var s = this._events[o];
                if (s.fn) s.fn !== e || i && !s.once || r && s.context !== r || (0 == --this._eventsCount ? this._events = new n : delete this._events[o]);
                else {
                    for (var u = 0, h = [], l = s.length; u < l; u++)(s[u].fn !== e || i && !s[u].once || r && s[u].context !== r) && h.push(s[u]);
                    h.length ? this._events[o] = 1 === h.length ? h[0] : h : 0 == --this._eventsCount ? this._events = new n : delete this._events[o]
                }
                return this
            }, o.prototype.removeAllListeners = function(t) {
                var e;
                return t ? (e = a ? a + t : t, this._events[e] && (0 == --this._eventsCount ? this._events = new n : delete this._events[e])) : (this._events = new n, this._eventsCount = 0), this
            }, o.prototype.off = o.prototype.removeListener, o.prototype.addListener = o.prototype.on, o.prototype.setMaxListeners = function() {
                return this
            }, o.prefixed = a, o.EventEmitter = o, void 0 !== e && (e.exports = o)
        }, {}],
        4: [function(e, r, n) {
            ! function(e) {
                var n = /iPhone/i,
                    i = /iPod/i,
                    o = /iPad/i,
                    s = /(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,
                    a = /Android/i,
                    u = /(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,
                    h = /(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,
                    l = /Windows Phone/i,
                    c = /(?=.*\bWindows\b)(?=.*\bARM\b)/i,
                    d = /BlackBerry/i,
                    f = /BB10/i,
                    p = /Opera Mini/i,
                    v = /(CriOS|Chrome)(?=.*\bMobile\b)/i,
                    y = /(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,
                    g = new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)", "i"),
                    m = function(t, e) {
                        return t.test(e)
                    },
                    _ = function(t) {
                        var e = t || navigator.userAgent,
                            r = e.split("[FBAN");
                        if (void 0 !== r[1] && (e = r[0]), r = e.split("Twitter"), void 0 !== r[1] && (e = r[0]), this.apple = {
                                phone: m(n, e),
                                ipod: m(i, e),
                                tablet: !m(n, e) && m(o, e),
                                device: m(n, e) || m(i, e) || m(o, e)
                            }, this.amazon = {
                                phone: m(u, e),
                                tablet: !m(u, e) && m(h, e),
                                device: m(u, e) || m(h, e)
                            }, this.android = {
                                phone: m(u, e) || m(s, e),
                                tablet: !m(u, e) && !m(s, e) && (m(h, e) || m(a, e)),
                                device: m(u, e) || m(h, e) || m(s, e) || m(a, e)
                            }, this.windows = {
                                phone: m(l, e),
                                tablet: m(c, e),
                                device: m(l, e) || m(c, e)
                            }, this.other = {
                                blackberry: m(d, e),
                                blackberry10: m(f, e),
                                opera: m(p, e),
                                firefox: m(y, e),
                                chrome: m(v, e),
                                device: m(d, e) || m(f, e) || m(p, e) || m(y, e) || m(v, e)
                            }, this.seven_inch = m(g, e), this.any = this.apple.device || this.android.device || this.windows.device || this.other.device || this.seven_inch, this.phone = this.apple.phone || this.android.phone || this.windows.phone, this.tablet = this.apple.tablet || this.android.tablet || this.windows.tablet, "undefined" == typeof window) return this
                    },
                    b = function() {
                        var t = new _;
                        return t.Class = _, t
                    };
                void 0 !== r && r.exports && "undefined" == typeof window ? r.exports = _ : void 0 !== r && r.exports && "undefined" != typeof window ? r.exports = b() : "function" == typeof t && t.amd ? t("isMobile", [], e.isMobile = b()) : e.isMobile = b()
            }(this)
        }, {}],
        5: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                return t._head ? (t._tail._next = e, e._prev = t._tail, t._tail = e) : (t._head = e, t._tail = e), e._owner = t, e
            }
            Object.defineProperty(r, "__esModule", {
                value: !0
            });
            var o = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                s = function() {
                    function t(e, r, i) {
                        void 0 === r && (r = !1), n(this, t), this._fn = e, this._once = r, this._thisArg = i, this._next = this._prev = this._owner = null
                    }
                    return o(t, [{
                        key: "detach",
                        value: function() {
                            return null !== this._owner && (this._owner.detach(this), !0)
                        }
                    }]), t
                }(),
                a = function() {
                    function t() {
                        n(this, t), this._head = this._tail = void 0
                    }
                    return o(t, [{
                        key: "handlers",
                        value: function() {
                            var t = !(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0],
                                e = this._head;
                            if (t) return !!e;
                            for (var r = []; e;) r.push(e), e = e._next;
                            return r
                        }
                    }, {
                        key: "has",
                        value: function(t) {
                            if (!(t instanceof s)) throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");
                            return t._owner === this
                        }
                    }, {
                        key: "dispatch",
                        value: function() {
                            var t = this._head;
                            if (!t) return !1;
                            for (; t;) t._once && this.detach(t), t._fn.apply(t._thisArg, arguments), t = t._next;
                            return !0
                        }
                    }, {
                        key: "add",
                        value: function(t) {
                            var e = arguments.length <= 1 || void 0 === arguments[1] ? null : arguments[1];
                            if ("function" != typeof t) throw new Error("MiniSignal#add(): First arg must be a Function.");
                            return i(this, new s(t, !1, e))
                        }
                    }, {
                        key: "once",
                        value: function(t) {
                            var e = arguments.length <= 1 || void 0 === arguments[1] ? null : arguments[1];
                            if ("function" != typeof t) throw new Error("MiniSignal#once(): First arg must be a Function.");
                            return i(this, new s(t, !0, e))
                        }
                    }, {
                        key: "detach",
                        value: function(t) {
                            if (!(t instanceof s)) throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");
                            return t._owner !== this ? this : (t._prev && (t._prev._next = t._next), t._next && (t._next._prev = t._prev), t === this._head ? (this._head = t._next, null === t._next && (this._tail = null)) : t === this._tail && (this._tail = t._prev, this._tail._next = null), t._owner = null, this)
                        }
                    }, {
                        key: "detachAll",
                        value: function() {
                            var t = this._head;
                            if (!t) return this;
                            for (this._head = this._tail = null; t;) t._owner = null, t = t._next;
                            return this
                        }
                    }]), t
                }();
            a.MiniSignalBinding = s, r.default = a, e.exports = r.default
        }, {}],
        6: [function(t, e, r) {
            "use strict";

            function n(t) {
                if (null === t || void 0 === t) throw new TypeError("Object.assign cannot be called with null or undefined");
                return Object(t)
            }
            var i = Object.getOwnPropertySymbols,
                o = Object.prototype.hasOwnProperty,
                s = Object.prototype.propertyIsEnumerable;
            e.exports = function() {
                try {
                    if (!Object.assign) return !1;
                    var t = new String("abc");
                    if (t[5] = "de", "5" === Object.getOwnPropertyNames(t)[0]) return !1;
                    for (var e = {}, r = 0; r < 10; r++) e["_" + String.fromCharCode(r)] = r;
                    if ("0123456789" !== Object.getOwnPropertyNames(e).map(function(t) {
                            return e[t]
                        }).join("")) return !1;
                    var n = {};
                    return "abcdefghijklmnopqrst".split("").forEach(function(t) {
                        n[t] = t
                    }), "abcdefghijklmnopqrst" === Object.keys(Object.assign({}, n)).join("")
                } catch (t) {
                    return !1
                }
            }() ? Object.assign : function(t, e) {
                for (var r, a, u = n(t), h = 1; h < arguments.length; h++) {
                    r = Object(arguments[h]);
                    for (var l in r) o.call(r, l) && (u[l] = r[l]);
                    if (i) {
                        a = i(r);
                        for (var c = 0; c < a.length; c++) s.call(r, a[c]) && (u[a[c]] = r[a[c]])
                    }
                }
                return u
            }
        }, {}],
        7: [function(t, e, r) {
            "use strict";
            e.exports = function(t, e) {
                e = e || {};
                for (var r = {
                        key: ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"],
                        q: {
                            name: "queryKey",
                            parser: /(?:^|&)([^&=]*)=?([^&]*)/g
                        },
                        parser: {
                            strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
                            loose: /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/
                        }
                    }, n = r.parser[e.strictMode ? "strict" : "loose"].exec(t), i = {}, o = 14; o--;) i[r.key[o]] = n[o] || "";
                return i[r.q.name] = {}, i[r.key[12]].replace(r.q.parser, function(t, e, n) {
                    e && (i[r.q.name][e] = n)
                }), i
            }
        }, {}],
        8: [function(t, e, r) {
            (function(t) {
                function e(t, e) {
                    for (var r = 0, n = t.length - 1; n >= 0; n--) {
                        var i = t[n];
                        "." === i ? t.splice(n, 1) : ".." === i ? (t.splice(n, 1), r++) : r && (t.splice(n, 1), r--)
                    }
                    if (e)
                        for (; r--; r) t.unshift("..");
                    return t
                }

                function n(t, e) {
                    if (t.filter) return t.filter(e);
                    for (var r = [], n = 0; n < t.length; n++) e(t[n], n, t) && r.push(t[n]);
                    return r
                }
                var i = /^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,
                    o = function(t) {
                        return i.exec(t).slice(1)
                    };
                r.resolve = function() {
                    for (var r = "", i = !1, o = arguments.length - 1; o >= -1 && !i; o--) {
                        var s = o >= 0 ? arguments[o] : t.cwd();
                        if ("string" != typeof s) throw new TypeError("Arguments to path.resolve must be strings");
                        s && (r = s + "/" + r, i = "/" === s.charAt(0))
                    }
                    return r = e(n(r.split("/"), function(t) {
                        return !!t
                    }), !i).join("/"), (i ? "/" : "") + r || "."
                }, r.normalize = function(t) {
                    var i = r.isAbsolute(t),
                        o = "/" === s(t, -1);
                    return t = e(n(t.split("/"), function(t) {
                        return !!t
                    }), !i).join("/"), t || i || (t = "."), t && o && (t += "/"), (i ? "/" : "") + t
                }, r.isAbsolute = function(t) {
                    return "/" === t.charAt(0)
                }, r.join = function() {
                    var t = Array.prototype.slice.call(arguments, 0);
                    return r.normalize(n(t, function(t, e) {
                        if ("string" != typeof t) throw new TypeError("Arguments to path.join must be strings");
                        return t
                    }).join("/"))
                }, r.relative = function(t, e) {
                    function n(t) {
                        for (var e = 0; e < t.length && "" === t[e]; e++);
                        for (var r = t.length - 1; r >= 0 && "" === t[r]; r--);
                        return e > r ? [] : t.slice(e, r - e + 1)
                    }
                    t = r.resolve(t).substr(1), e = r.resolve(e).substr(1);
                    for (var i = n(t.split("/")), o = n(e.split("/")), s = Math.min(i.length, o.length), a = s, u = 0; u < s; u++)
                        if (i[u] !== o[u]) {
                            a = u;
                            break
                        } for (var h = [], u = a; u < i.length; u++) h.push("..");
                    return h = h.concat(o.slice(a)), h.join("/")
                }, r.sep = "/", r.delimiter = ":", r.dirname = function(t) {
                    var e = o(t),
                        r = e[0],
                        n = e[1];
                    return r || n ? (n && (n = n.substr(0, n.length - 1)), r + n) : "."
                }, r.basename = function(t, e) {
                    var r = o(t)[2];
                    return e && r.substr(-1 * e.length) === e && (r = r.substr(0, r.length - e.length)), r
                }, r.extname = function(t) {
                    return o(t)[3]
                };
                var s = "b" === "ab".substr(-1) ? function(t, e, r) {
                    return t.substr(e, r)
                } : function(t, e, r) {
                    return e < 0 && (e = t.length + e), t.substr(e, r)
                }
            }).call(this, t("_process"))
        }, {
            _process: 26
        }],
        9: [function(t, e, r) {
            var n = new ArrayBuffer(0),
                i = function(t, e, r, i) {
                    this.gl = t, this.buffer = t.createBuffer(), this.type = e || t.ARRAY_BUFFER, this.drawType = i || t.STATIC_DRAW, this.data = n, r && this.upload(r), this._updateID = 0
                };
            i.prototype.upload = function(t, e, r) {
                r || this.bind();
                var n = this.gl;
                t = t || this.data, e = e || 0, this.data.byteLength >= t.byteLength ? n.bufferSubData(this.type, e, t) : n.bufferData(this.type, t, this.drawType), this.data = t
            }, i.prototype.bind = function() {
                this.gl.bindBuffer(this.type, this.buffer)
            }, i.createVertexBuffer = function(t, e, r) {
                return new i(t, t.ARRAY_BUFFER, e, r)
            }, i.createIndexBuffer = function(t, e, r) {
                return new i(t, t.ELEMENT_ARRAY_BUFFER, e, r)
            }, i.create = function(t, e, r, n) {
                return new i(t, e, r, n)
            }, i.prototype.destroy = function() {
                this.gl.deleteBuffer(this.buffer)
            }, e.exports = i
        }, {}],
        10: [function(t, e, r) {
            var n = t("./GLTexture"),
                i = function(t, e, r) {
                    this.gl = t, this.framebuffer = t.createFramebuffer(), this.stencil = null, this.texture = null, this.width = e || 100, this.height = r || 100
                };
            i.prototype.enableTexture = function(t) {
                var e = this.gl;
                this.texture = t || new n(e), this.texture.bind(), this.bind(), e.framebufferTexture2D(e.FRAMEBUFFER, e.COLOR_ATTACHMENT0, e.TEXTURE_2D, this.texture.texture, 0)
            }, i.prototype.enableStencil = function() {
                if (!this.stencil) {
                    var t = this.gl;
                    this.stencil = t.createRenderbuffer(), t.bindRenderbuffer(t.RENDERBUFFER, this.stencil), t.framebufferRenderbuffer(t.FRAMEBUFFER, t.DEPTH_STENCIL_ATTACHMENT, t.RENDERBUFFER, this.stencil), t.renderbufferStorage(t.RENDERBUFFER, t.DEPTH_STENCIL, this.width, this.height)
                }
            }, i.prototype.clear = function(t, e, r, n) {
                this.bind();
                var i = this.gl;
                i.clearColor(t, e, r, n), i.clear(i.COLOR_BUFFER_BIT | i.DEPTH_BUFFER_BIT)
            }, i.prototype.bind = function() {
                var t = this.gl;
                t.bindFramebuffer(t.FRAMEBUFFER, this.framebuffer)
            }, i.prototype.unbind = function() {
                var t = this.gl;
                t.bindFramebuffer(t.FRAMEBUFFER, null)
            }, i.prototype.resize = function(t, e) {
                var r = this.gl;
                this.width = t, this.height = e, this.texture && this.texture.uploadData(null, t, e), this.stencil && (r.bindRenderbuffer(r.RENDERBUFFER, this.stencil), r.renderbufferStorage(r.RENDERBUFFER, r.DEPTH_STENCIL, t, e))
            }, i.prototype.destroy = function() {
                var t = this.gl;
                this.texture && this.texture.destroy(), t.deleteFramebuffer(this.framebuffer), this.gl = null, this.stencil = null, this.texture = null
            }, i.createRGBA = function(t, e, r, o) {
                var s = n.fromData(t, null, e, r);
                s.enableNearestScaling(), s.enableWrapClamp();
                var a = new i(t, e, r);
                return a.enableTexture(s), a.unbind(), a
            }, i.createFloat32 = function(t, e, r, o) {
                var s = new n.fromData(t, o, e, r);
                s.enableNearestScaling(), s.enableWrapClamp();
                var a = new i(t, e, r);
                return a.enableTexture(s), a.unbind(), a
            }, e.exports = i
        }, {
            "./GLTexture": 12
        }],
        11: [function(t, e, r) {
            var n = t("./shader/compileProgram"),
                i = t("./shader/extractAttributes"),
                o = t("./shader/extractUniforms"),
                s = t("./shader/setPrecision"),
                a = t("./shader/generateUniformAccessObject"),
                u = function(t, e, r, u, h) {
                    this.gl = t, u && (e = s(e, u), r = s(r, u)), this.program = n(t, e, r, h), this.attributes = i(t, this.program), this.uniformData = o(t, this.program), this.uniforms = a(t, this.uniformData)
                };
            u.prototype.bind = function() {
                return this.gl.useProgram(this.program), this
            }, u.prototype.destroy = function() {
                this.attributes = null, this.uniformData = null, this.uniforms = null, this.gl.deleteProgram(this.program)
            }, e.exports = u
        }, {
            "./shader/compileProgram": 17,
            "./shader/extractAttributes": 19,
            "./shader/extractUniforms": 20,
            "./shader/generateUniformAccessObject": 21,
            "./shader/setPrecision": 25
        }],
        12: [function(t, e, r) {
            var n = function(t, e, r, n, i) {
                this.gl = t, this.texture = t.createTexture(), this.mipmap = !1, this.premultiplyAlpha = !1, this.width = e || -1, this.height = r || -1, this.format = n || t.RGBA, this.type = i || t.UNSIGNED_BYTE
            };
            n.prototype.upload = function(t) {
                this.bind();
                var e = this.gl;
                e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha);
                var r = t.videoWidth || t.width,
                    n = t.videoHeight || t.height;
                n !== this.height || r !== this.width ? e.texImage2D(e.TEXTURE_2D, 0, this.format, this.format, this.type, t) : e.texSubImage2D(e.TEXTURE_2D, 0, 0, 0, this.format, this.type, t), this.width = r, this.height = n
            };
            var i = !1;
            n.prototype.uploadData = function(t, e, r) {
                this.bind();
                var n = this.gl;
                if (t instanceof Float32Array) {
                    if (!i) {
                        if (!n.getExtension("OES_texture_float")) throw new Error("floating point textures not available");
                        i = !0
                    }
                    this.type = n.FLOAT
                } else this.type = this.type || n.UNSIGNED_BYTE;
                n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha), e !== this.width || r !== this.height ? n.texImage2D(n.TEXTURE_2D, 0, this.format, e, r, 0, this.format, this.type, t || null) : n.texSubImage2D(n.TEXTURE_2D, 0, 0, 0, e, r, this.format, this.type, t || null), this.width = e, this.height = r
            }, n.prototype.bind = function(t) {
                var e = this.gl;
                void 0 !== t && e.activeTexture(e.TEXTURE0 + t), e.bindTexture(e.TEXTURE_2D, this.texture)
            }, n.prototype.unbind = function() {
                var t = this.gl;
                t.bindTexture(t.TEXTURE_2D, null)
            }, n.prototype.minFilter = function(t) {
                var e = this.gl;
                this.bind(), this.mipmap ? e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, t ? e.LINEAR_MIPMAP_LINEAR : e.NEAREST_MIPMAP_NEAREST) : e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, t ? e.LINEAR : e.NEAREST)
            }, n.prototype.magFilter = function(t) {
                var e = this.gl;
                this.bind(), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, t ? e.LINEAR : e.NEAREST)
            }, n.prototype.enableMipmap = function() {
                var t = this.gl;
                this.bind(), this.mipmap = !0, t.generateMipmap(t.TEXTURE_2D)
            }, n.prototype.enableLinearScaling = function() {
                this.minFilter(!0), this.magFilter(!0)
            }, n.prototype.enableNearestScaling = function() {
                this.minFilter(!1), this.magFilter(!1)
            }, n.prototype.enableWrapClamp = function() {
                var t = this.gl;
                this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE)
            }, n.prototype.enableWrapRepeat = function() {
                var t = this.gl;
                this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.REPEAT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.REPEAT)
            }, n.prototype.enableWrapMirrorRepeat = function() {
                var t = this.gl;
                this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.MIRRORED_REPEAT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.MIRRORED_REPEAT)
            }, n.prototype.destroy = function() {
                this.gl.deleteTexture(this.texture)
            }, n.fromSource = function(t, e, r) {
                var i = new n(t);
                return i.premultiplyAlpha = r || !1, i.upload(e), i
            }, n.fromData = function(t, e, r, i) {
                var o = new n(t);
                return o.uploadData(e, r, i), o
            }, e.exports = n
        }, {}],
        13: [function(t, e, r) {
            function n(t, e) {
                if (this.nativeVaoExtension = null, n.FORCE_NATIVE || (this.nativeVaoExtension = t.getExtension("OES_vertex_array_object") || t.getExtension("MOZ_OES_vertex_array_object") || t.getExtension("WEBKIT_OES_vertex_array_object")), this.nativeState = e, this.nativeVaoExtension) {
                    this.nativeVao = this.nativeVaoExtension.createVertexArrayOES();
                    var r = t.getParameter(t.MAX_VERTEX_ATTRIBS);
                    this.nativeState = {
                        tempAttribState: new Array(r),
                        attribState: new Array(r)
                    }
                }
                this.gl = t, this.attributes = [], this.indexBuffer = null, this.dirty = !1
            }
            var i = t("./setVertexAttribArrays");
            n.prototype.constructor = n, e.exports = n, n.FORCE_NATIVE = !1, n.prototype.bind = function() {
                if (this.nativeVao) {
                    if (this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao), this.dirty) return this.dirty = !1, this.activate(), this;
                    this.indexBuffer && this.indexBuffer.bind()
                } else this.activate();
                return this
            }, n.prototype.unbind = function() {
                return this.nativeVao && this.nativeVaoExtension.bindVertexArrayOES(null), this
            }, n.prototype.activate = function() {
                for (var t = this.gl, e = null, r = 0; r < this.attributes.length; r++) {
                    var n = this.attributes[r];
                    e !== n.buffer && (n.buffer.bind(), e = n.buffer), t.vertexAttribPointer(n.attribute.location, n.attribute.size, n.type || t.FLOAT, n.normalized || !1, n.stride || 0, n.start || 0)
                }
                return i(t, this.attributes, this.nativeState), this.indexBuffer && this.indexBuffer.bind(), this
            }, n.prototype.addAttribute = function(t, e, r, n, i, o) {
                return this.attributes.push({
                    buffer: t,
                    attribute: e,
                    location: e.location,
                    type: r || this.gl.FLOAT,
                    normalized: n || !1,
                    stride: i || 0,
                    start: o || 0
                }), this.dirty = !0, this
            }, n.prototype.addIndex = function(t) {
                return this.indexBuffer = t, this.dirty = !0, this
            }, n.prototype.clear = function() {
                return this.nativeVao && this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao), this.attributes.length = 0, this.indexBuffer = null, this
            }, n.prototype.draw = function(t, e, r) {
                var n = this.gl;
                return this.indexBuffer ? n.drawElements(t, e || this.indexBuffer.data.length, n.UNSIGNED_SHORT, 2 * (r || 0)) : n.drawArrays(t, r, e || this.getSize()), this
            }, n.prototype.destroy = function() {
                this.gl = null, this.indexBuffer = null, this.attributes = null, this.nativeState = null, this.nativeVao && this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao), this.nativeVaoExtension = null, this.nativeVao = null
            }, n.prototype.getSize = function() {
                var t = this.attributes[0];
                return t.buffer.data.length / (t.stride / 4 || t.attribute.size)
            }
        }, {
            "./setVertexAttribArrays": 16
        }],
        14: [function(t, e, r) {
            var n = function(t, e) {
                var r = t.getContext("webgl", e) || t.getContext("experimental-webgl", e);
                if (!r) throw new Error("This browser does not support webGL. Try using the canvas renderer");
                return r
            };
            e.exports = n
        }, {}],
        15: [function(t, e, r) {
            var n = {
                createContext: t("./createContext"),
                setVertexAttribArrays: t("./setVertexAttribArrays"),
                GLBuffer: t("./GLBuffer"),
                GLFramebuffer: t("./GLFramebuffer"),
                GLShader: t("./GLShader"),
                GLTexture: t("./GLTexture"),
                VertexArrayObject: t("./VertexArrayObject"),
                shader: t("./shader")
            };
            void 0 !== e && e.exports && (e.exports = n), "undefined" != typeof window && (window.PIXI = window.PIXI || {}, window.PIXI.glCore = n)
        }, {
            "./GLBuffer": 9,
            "./GLFramebuffer": 10,
            "./GLShader": 11,
            "./GLTexture": 12,
            "./VertexArrayObject": 13,
            "./createContext": 14,
            "./setVertexAttribArrays": 16,
            "./shader": 22
        }],
        16: [function(t, e, r) {
            var n = function(t, e, r) {
                var n;
                if (r) {
                    var i = r.tempAttribState,
                        o = r.attribState;
                    for (n = 0; n < i.length; n++) i[n] = !1;
                    for (n = 0; n < e.length; n++) i[e[n].attribute.location] = !0;
                    for (n = 0; n < o.length; n++) o[n] !== i[n] && (o[n] = i[n], r.attribState[n] ? t.enableVertexAttribArray(n) : t.disableVertexAttribArray(n))
                } else
                    for (n = 0; n < e.length; n++) {
                        var s = e[n];
                        t.enableVertexAttribArray(s.attribute.location)
                    }
            };
            e.exports = n
        }, {}],
        17: [function(t, e, r) {
            var n = function(t, e, r, n) {
                    var o = i(t, t.VERTEX_SHADER, e),
                        s = i(t, t.FRAGMENT_SHADER, r),
                        a = t.createProgram();
                    if (t.attachShader(a, o), t.attachShader(a, s), n)
                        for (var u in n) t.bindAttribLocation(a, n[u], u);
                    return t.linkProgram(a), t.getProgramParameter(a, t.LINK_STATUS) || (console.error("Pixi.js Error: Could not initialize shader."), console.error("gl.VALIDATE_STATUS", t.getProgramParameter(a, t.VALIDATE_STATUS)), console.error("gl.getError()", t.getError()), "" !== t.getProgramInfoLog(a) && console.warn("Pixi.js Warning: gl.getProgramInfoLog()", t.getProgramInfoLog(a)), t.deleteProgram(a), a = null), t.deleteShader(o), t.deleteShader(s), a
                },
                i = function(t, e, r) {
                    var n = t.createShader(e);
                    return t.shaderSource(n, r), t.compileShader(n), t.getShaderParameter(n, t.COMPILE_STATUS) ? n : (console.log(t.getShaderInfoLog(n)), null)
                };
            e.exports = n
        }, {}],
        18: [function(t, e, r) {
            var n = function(t, e) {
                    switch (t) {
                        case "float":
                            return 0;
                        case "vec2":
                            return new Float32Array(2 * e);
                        case "vec3":
                            return new Float32Array(3 * e);
                        case "vec4":
                            return new Float32Array(4 * e);
                        case "int":
                        case "sampler2D":
                            return 0;
                        case "ivec2":
                            return new Int32Array(2 * e);
                        case "ivec3":
                            return new Int32Array(3 * e);
                        case "ivec4":
                            return new Int32Array(4 * e);
                        case "bool":
                            return !1;
                        case "bvec2":
                            return i(2 * e);
                        case "bvec3":
                            return i(3 * e);
                        case "bvec4":
                            return i(4 * e);
                        case "mat2":
                            return new Float32Array([1, 0, 0, 1]);
                        case "mat3":
                            return new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);
                        case "mat4":
                            return new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1])
                    }
                },
                i = function(t) {
                    for (var e = new Array(t), r = 0; r < e.length; r++) e[r] = !1;
                    return e
                };
            e.exports = n
        }, {}],
        19: [function(t, e, r) {
            var n = t("./mapType"),
                i = t("./mapSize"),
                o = function(t, e) {
                    for (var r = {}, o = t.getProgramParameter(e, t.ACTIVE_ATTRIBUTES), a = 0; a < o; a++) {
                        var u = t.getActiveAttrib(e, a),
                            h = n(t, u.type);
                        r[u.name] = {
                            type: h,
                            size: i(h),
                            location: t.getAttribLocation(e, u.name),
                            pointer: s
                        }
                    }
                    return r
                },
                s = function(t, e, r, n) {
                    gl.vertexAttribPointer(this.location, this.size, t || gl.FLOAT, e || !1, r || 0, n || 0)
                };
            e.exports = o
        }, {
            "./mapSize": 23,
            "./mapType": 24
        }],
        20: [function(t, e, r) {
            var n = t("./mapType"),
                i = t("./defaultValue"),
                o = function(t, e) {
                    for (var r = {}, o = t.getProgramParameter(e, t.ACTIVE_UNIFORMS), s = 0; s < o; s++) {
                        var a = t.getActiveUniform(e, s),
                            u = a.name.replace(/\[.*?\]/, ""),
                            h = n(t, a.type);
                        r[u] = {
                            type: h,
                            size: a.size,
                            location: t.getUniformLocation(e, u),
                            value: i(h, a.size)
                        }
                    }
                    return r
                };
            e.exports = o
        }, {
            "./defaultValue": 18,
            "./mapType": 24
        }],
        21: [function(t, e, r) {
            function n(t, e) {
                return function(r) {
                    this.data[t].value = r;
                    var n = this.data[t].location;
                    1 === e.size ? a[e.type](this.gl, n, r) : u[e.type](this.gl, n, r)
                }
            }

            function i(t, e) {
                for (var r = e, n = 0; n < t.length - 1; n++) {
                    var i = r[t[n]] || {
                        data: {}
                    };
                    r[t[n]] = i, r = i
                }
                return r
            }
            var o = function(t, e) {
                    var r = {
                        data: {}
                    };
                    r.gl = t;
                    for (var o = Object.keys(e), a = 0; a < o.length; a++) {
                        var u = o[a],
                            h = u.split("."),
                            l = h[h.length - 1],
                            c = i(h, r),
                            d = e[u];
                        c.data[l] = d, c.gl = t, Object.defineProperty(c, l, {
                            get: s(l),
                            set: n(l, d)
                        })
                    }
                    return r
                },
                s = function(t) {
                    return function() {
                        return this.data[t].value
                    }
                },
                a = {
                    float: function(t, e, r) {
                        t.uniform1f(e, r)
                    },
                    vec2: function(t, e, r) {
                        t.uniform2f(e, r[0], r[1])
                    },
                    vec3: function(t, e, r) {
                        t.uniform3f(e, r[0], r[1], r[2])
                    },
                    vec4: function(t, e, r) {
                        t.uniform4f(e, r[0], r[1], r[2], r[3])
                    },
                    int: function(t, e, r) {
                        t.uniform1i(e, r)
                    },
                    ivec2: function(t, e, r) {
                        t.uniform2i(e, r[0], r[1])
                    },
                    ivec3: function(t, e, r) {
                        t.uniform3i(e, r[0], r[1], r[2])
                    },
                    ivec4: function(t, e, r) {
                        t.uniform4i(e, r[0], r[1], r[2], r[3])
                    },
                    bool: function(t, e, r) {
                        t.uniform1i(e, r)
                    },
                    bvec2: function(t, e, r) {
                        t.uniform2i(e, r[0], r[1])
                    },
                    bvec3: function(t, e, r) {
                        t.uniform3i(e, r[0], r[1], r[2])
                    },
                    bvec4: function(t, e, r) {
                        t.uniform4i(e, r[0], r[1], r[2], r[3])
                    },
                    mat2: function(t, e, r) {
                        t.uniformMatrix2fv(e, !1, r)
                    },
                    mat3: function(t, e, r) {
                        t.uniformMatrix3fv(e, !1, r)
                    },
                    mat4: function(t, e, r) {
                        t.uniformMatrix4fv(e, !1, r)
                    },
                    sampler2D: function(t, e, r) {
                        t.uniform1i(e, r)
                    }
                },
                u = {
                    float: function(t, e, r) {
                        t.uniform1fv(e, r)
                    },
                    vec2: function(t, e, r) {
                        t.uniform2fv(e, r)
                    },
                    vec3: function(t, e, r) {
                        t.uniform3fv(e, r)
                    },
                    vec4: function(t, e, r) {
                        t.uniform4fv(e, r)
                    },
                    int: function(t, e, r) {
                        t.uniform1iv(e, r)
                    },
                    ivec2: function(t, e, r) {
                        t.uniform2iv(e, r)
                    },
                    ivec3: function(t, e, r) {
                        t.uniform3iv(e, r)
                    },
                    ivec4: function(t, e, r) {
                        t.uniform4iv(e, r)
                    },
                    bool: function(t, e, r) {
                        t.uniform1iv(e, r)
                    },
                    bvec2: function(t, e, r) {
                        t.uniform2iv(e, r)
                    },
                    bvec3: function(t, e, r) {
                        t.uniform3iv(e, r)
                    },
                    bvec4: function(t, e, r) {
                        t.uniform4iv(e, r)
                    },
                    sampler2D: function(t, e, r) {
                        t.uniform1iv(e, r)
                    }
                };
            e.exports = o
        }, {}],
        22: [function(t, e, r) {
            e.exports = {
                compileProgram: t("./compileProgram"),
                defaultValue: t("./defaultValue"),
                extractAttributes: t("./extractAttributes"),
                extractUniforms: t("./extractUniforms"),
                generateUniformAccessObject: t("./generateUniformAccessObject"),
                setPrecision: t("./setPrecision"),
                mapSize: t("./mapSize"),
                mapType: t("./mapType")
            }
        }, {
            "./compileProgram": 17,
            "./defaultValue": 18,
            "./extractAttributes": 19,
            "./extractUniforms": 20,
            "./generateUniformAccessObject": 21,
            "./mapSize": 23,
            "./mapType": 24,
            "./setPrecision": 25
        }],
        23: [function(t, e, r) {
            var n = function(t) {
                    return i[t]
                },
                i = {
                    float: 1,
                    vec2: 2,
                    vec3: 3,
                    vec4: 4,
                    int: 1,
                    ivec2: 2,
                    ivec3: 3,
                    ivec4: 4,
                    bool: 1,
                    bvec2: 2,
                    bvec3: 3,
                    bvec4: 4,
                    mat2: 4,
                    mat3: 9,
                    mat4: 16,
                    sampler2D: 1
                };
            e.exports = n
        }, {}],
        24: [function(t, e, r) {
            var n = function(t, e) {
                    if (!i) {
                        var r = Object.keys(o);
                        i = {};
                        for (var n = 0; n < r.length; ++n) {
                            var s = r[n];
                            i[t[s]] = o[s]
                        }
                    }
                    return i[e]
                },
                i = null,
                o = {
                    FLOAT: "float",
                    FLOAT_VEC2: "vec2",
                    FLOAT_VEC3: "vec3",
                    FLOAT_VEC4: "vec4",
                    INT: "int",
                    INT_VEC2: "ivec2",
                    INT_VEC3: "ivec3",
                    INT_VEC4: "ivec4",
                    BOOL: "bool",
                    BOOL_VEC2: "bvec2",
                    BOOL_VEC3: "bvec3",
                    BOOL_VEC4: "bvec4",
                    FLOAT_MAT2: "mat2",
                    FLOAT_MAT3: "mat3",
                    FLOAT_MAT4: "mat4",
                    SAMPLER_2D: "sampler2D"
                };
            e.exports = n
        }, {}],
        25: [function(t, e, r) {
            var n = function(t, e) {
                return "precision" !== t.substring(0, 9) ? "precision " + e + " float;\n" + t : t
            };
            e.exports = n
        }, {}],
        26: [function(t, e, r) {
            function n() {
                throw new Error("setTimeout has not been defined")
            }

            function i() {
                throw new Error("clearTimeout has not been defined")
            }

            function o(t) {
                if (c === setTimeout) return setTimeout(t, 0);
                if ((c === n || !c) && setTimeout) return c = setTimeout, setTimeout(t, 0);
                try {
                    return c(t, 0)
                } catch (e) {
                    try {
                        return c.call(null, t, 0)
                    } catch (e) {
                        return c.call(this, t, 0)
                    }
                }
            }

            function s(t) {
                if (d === clearTimeout) return clearTimeout(t);
                if ((d === i || !d) && clearTimeout) return d = clearTimeout, clearTimeout(t);
                try {
                    return d(t)
                } catch (e) {
                    try {
                        return d.call(null, t)
                    } catch (e) {
                        return d.call(this, t)
                    }
                }
            }

            function a() {
                y && p && (y = !1, p.length ? v = p.concat(v) : g = -1, v.length && u())
            }

            function u() {
                if (!y) {
                    var t = o(a);
                    y = !0;
                    for (var e = v.length; e;) {
                        for (p = v, v = []; ++g < e;) p && p[g].run();
                        g = -1, e = v.length
                    }
                    p = null, y = !1, s(t)
                }
            }

            function h(t, e) {
                this.fun = t, this.array = e
            }

            function l() {}
            var c, d, f = e.exports = {};
            ! function() {
                try {
                    c = "function" == typeof setTimeout ? setTimeout : n
                } catch (t) {
                    c = n
                }
                try {
                    d = "function" == typeof clearTimeout ? clearTimeout : i
                } catch (t) {
                    d = i
                }
            }();
            var p, v = [],
                y = !1,
                g = -1;
            f.nextTick = function(t) {
                var e = new Array(arguments.length - 1);
                if (arguments.length > 1)
                    for (var r = 1; r < arguments.length; r++) e[r - 1] = arguments[r];
                v.push(new h(t, e)), 1 !== v.length || y || o(u)
            }, h.prototype.run = function() {
                this.fun.apply(null, this.array)
            }, f.title = "browser", f.browser = !0, f.env = {}, f.argv = [], f.version = "", f.versions = {}, f.on = l, f.addListener = l, f.once = l, f.off = l, f.removeListener = l, f.removeAllListeners = l, f.emit = l, f.prependListener = l, f.prependOnceListener = l, f.listeners = function(t) {
                return []
            }, f.binding = function(t) {
                throw new Error("process.binding is not supported")
            }, f.cwd = function() {
                return "/"
            }, f.chdir = function(t) {
                throw new Error("process.chdir is not supported")
            }, f.umask = function() {
                return 0
            }
        }, {}],
        27: [function(e, r, n) {
            (function(e) {
                ! function(i) {
                    function o(t) {
                        throw new RangeError(L[t])
                    }

                    function s(t, e) {
                        for (var r = t.length, n = []; r--;) n[r] = e(t[r]);
                        return n
                    }

                    function a(t, e) {
                        var r = t.split("@"),
                            n = "";
                        return r.length > 1 && (n = r[0] + "@", t = r[1]), t = t.replace(D, "."), n + s(t.split("."), e).join(".")
                    }

                    function u(t) {
                        for (var e, r, n = [], i = 0, o = t.length; i < o;) e = t.charCodeAt(i++), e >= 55296 && e <= 56319 && i < o ? (r = t.charCodeAt(i++), 56320 == (64512 & r) ? n.push(((1023 & e) << 10) + (1023 & r) + 65536) : (n.push(e), i--)) : n.push(e);
                        return n
                    }

                    function h(t) {
                        return s(t, function(t) {
                            var e = "";
                            return t > 65535 && (t -= 65536, e += B(t >>> 10 & 1023 | 55296), t = 56320 | 1023 & t), e += B(t)
                        }).join("")
                    }

                    function l(t) {
                        return t - 48 < 10 ? t - 22 : t - 65 < 26 ? t - 65 : t - 97 < 26 ? t - 97 : w
                    }

                    function c(t, e) {
                        return t + 22 + 75 * (t < 26) - ((0 != e) << 5)
                    }

                    function d(t, e, r) {
                        var n = 0;
                        for (t = r ? F(t / M) : t >> 1, t += F(t / e); t > N * S >> 1; n += w) t = F(t / N);
                        return F(n + (N + 1) * t / (t + O))
                    }

                    function f(t) {
                        var e, r, n, i, s, a, u, c, f, p, v = [],
                            y = t.length,
                            g = 0,
                            m = C,
                            _ = P;
                        for (r = t.lastIndexOf(R), r < 0 && (r = 0), n = 0; n < r; ++n) t.charCodeAt(n) >= 128 && o("not-basic"), v.push(t.charCodeAt(n));
                        for (i = r > 0 ? r + 1 : 0; i < y;) {
                            for (s = g, a = 1, u = w; i >= y && o("invalid-input"), c = l(t.charCodeAt(i++)), (c >= w || c > F((T - g) / a)) && o("overflow"), g += c * a, f = u <= _ ? E : u >= _ + S ? S : u - _, !(c < f); u += w) p = w - f, a > F(T / p) && o("overflow"), a *= p;
                            e = v.length + 1, _ = d(g - s, e, 0 == s), F(g / e) > T - m && o("overflow"), m += F(g / e), g %= e, v.splice(g++, 0, m)
                        }
                        return h(v)
                    }

                    function p(t) {
                        var e, r, n, i, s, a, h, l, f, p, v, y, g, m, _, b = [];
                        for (t = u(t), y = t.length, e = C, r = 0, s = P, a = 0; a < y; ++a)(v = t[a]) < 128 && b.push(B(v));
                        for (n = i = b.length, i && b.push(R); n < y;) {
                            for (h = T, a = 0; a < y; ++a)(v = t[a]) >= e && v < h && (h = v);
                            for (g = n + 1, h - e > F((T - r) / g) && o("overflow"), r += (h - e) * g, e = h, a = 0; a < y; ++a)
                                if (v = t[a], v < e && ++r > T && o("overflow"), v == e) {
                                    for (l = r, f = w; p = f <= s ? E : f >= s + S ? S : f - s, !(l < p); f += w) _ = l - p, m = w - p, b.push(B(c(p + _ % m, 0))), l = F(_ / m);
                                    b.push(B(c(l, 0))), s = d(r, g, n == i), r = 0, ++n
                                }++ r, ++e
                        }
                        return b.join("")
                    }

                    function v(t) {
                        return a(t, function(t) {
                            return A.test(t) ? f(t.slice(4).toLowerCase()) : t
                        })
                    }

                    function y(t) {
                        return a(t, function(t) {
                            return I.test(t) ? "xn--" + p(t) : t
                        })
                    }
                    var g = "object" == typeof n && n && !n.nodeType && n,
                        m = "object" == typeof r && r && !r.nodeType && r,
                        _ = "object" == typeof e && e;
                    _.global !== _ && _.window !== _ && _.self !== _ || (i = _);
                    var b, x, T = 2147483647,
                        w = 36,
                        E = 1,
                        S = 26,
                        O = 38,
                        M = 700,
                        P = 72,
                        C = 128,
                        R = "-",
                        A = /^xn--/,
                        I = /[^\x20-\x7E]/,
                        D = /[\x2E\u3002\uFF0E\uFF61]/g,
                        L = {
                            overflow: "Overflow: input needs wider integers to process",
                            "not-basic": "Illegal input >= 0x80 (not a basic code point)",
                            "invalid-input": "Invalid input"
                        },
                        N = w - E,
                        F = Math.floor,
                        B = String.fromCharCode;
                    if (b = {
                            version: "1.4.1",
                            ucs2: {
                                decode: u,
                                encode: h
                            },
                            decode: f,
                            encode: p,
                            toASCII: y,
                            toUnicode: v
                        }, "function" == typeof t && "object" == typeof t.amd && t.amd) t("punycode", function() {
                        return b
                    });
                    else if (g && m)
                        if (r.exports == g) m.exports = b;
                        else
                            for (x in b) b.hasOwnProperty(x) && (g[x] = b[x]);
                    else i.punycode = b
                }(this)
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}],
        28: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                return Object.prototype.hasOwnProperty.call(t, e)
            }
            e.exports = function(t, e, r, o) {
                e = e || "&", r = r || "=";
                var s = {};
                if ("string" != typeof t || 0 === t.length) return s;
                var a = /\+/g;
                t = t.split(e);
                var u = 1e3;
                o && "number" == typeof o.maxKeys && (u = o.maxKeys);
                var h = t.length;
                u > 0 && h > u && (h = u);
                for (var l = 0; l < h; ++l) {
                    var c, d, f, p, v = t[l].replace(a, "%20"),
                        y = v.indexOf(r);
                    y >= 0 ? (c = v.substr(0, y), d = v.substr(y + 1)) : (c = v, d = ""), f = decodeURIComponent(c), p = decodeURIComponent(d), n(s, f) ? i(s[f]) ? s[f].push(p) : s[f] = [s[f], p] : s[f] = p
                }
                return s
            };
            var i = Array.isArray || function(t) {
                return "[object Array]" === Object.prototype.toString.call(t)
            }
        }, {}],
        29: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (t.map) return t.map(e);
                for (var r = [], n = 0; n < t.length; n++) r.push(e(t[n], n));
                return r
            }
            var i = function(t) {
                switch (typeof t) {
                    case "string":
                        return t;
                    case "boolean":
                        return t ? "true" : "false";
                    case "number":
                        return isFinite(t) ? t : "";
                    default:
                        return ""
                }
            };
            e.exports = function(t, e, r, a) {
                return e = e || "&", r = r || "=", null === t && (t = void 0), "object" == typeof t ? n(s(t), function(s) {
                    var a = encodeURIComponent(i(s)) + r;
                    return o(t[s]) ? n(t[s], function(t) {
                        return a + encodeURIComponent(i(t))
                    }).join(e) : a + encodeURIComponent(i(t[s]))
                }).join(e) : a ? encodeURIComponent(i(a)) + r + encodeURIComponent(i(t)) : ""
            };
            var o = Array.isArray || function(t) {
                    return "[object Array]" === Object.prototype.toString.call(t)
                },
                s = Object.keys || function(t) {
                    var e = [];
                    for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && e.push(r);
                    return e
                }
        }, {}],
        30: [function(t, e, r) {
            "use strict";
            r.decode = r.parse = t("./decode"), r.encode = r.stringify = t("./encode")
        }, {
            "./decode": 28,
            "./encode": 29
        }],
        31: [function(t, e, r) {
            "use strict";
            e.exports = function(t, e, r) {
                var n, i = t.length;
                if (!(e >= i || 0 === r)) {
                    r = e + r > i ? i - e : r;
                    var o = i - r;
                    for (n = e; n < o; ++n) t[n] = t[n + r];
                    t.length = o
                }
            }
        }, {}],
        32: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
                    return typeof t
                } : function(t) {
                    return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
                },
                s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("mini-signals"),
                u = n(a),
                h = t("parse-uri"),
                l = n(h),
                c = t("./async"),
                d = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(c),
                f = t("./Resource"),
                p = n(f),
                v = /(#[\w-]+)?$/,
                y = function() {
                    function t() {
                        var e = this,
                            r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "",
                            n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 10;
                        i(this, t), this.baseUrl = r, this.progress = 0, this.loading = !1, this.defaultQueryString = "", this._beforeMiddleware = [], this._afterMiddleware = [], this._resourcesParsing = [], this._boundLoadResource = function(t, r) {
                            return e._loadResource(t, r)
                        }, this._queue = d.queue(this._boundLoadResource, n), this._queue.pause(), this.resources = {}, this.onProgress = new u.default, this.onError = new u.default, this.onLoad = new u.default, this.onStart = new u.default, this.onComplete = new u.default
                    }
                    return t.prototype.add = function(t, e, r, n) {
                        if (Array.isArray(t)) {
                            for (var i = 0; i < t.length; ++i) this.add(t[i]);
                            return this
                        }
                        if ("object" === (void 0 === t ? "undefined" : o(t)) && (n = e || t.callback || t.onComplete, r = t, e = t.url, t = t.name || t.key || t.url), "string" != typeof e && (n = r, r = e, e = t), "string" != typeof e) throw new Error("No url passed to add resource to loader.");
                        if ("function" == typeof r && (n = r, r = null), this.loading && (!r || !r.parentResource)) throw new Error("Cannot add resources while the loader is running.");
                        if (this.resources[t]) throw new Error('Resource named "' + t + '" already exists.');
                        if (e = this._prepareUrl(e), this.resources[t] = new p.default(t, e, r), "function" == typeof n && this.resources[t].onAfterMiddleware.once(n), this.loading) {
                            for (var s = r.parentResource, a = [], u = 0; u < s.children.length; ++u) s.children[u].isComplete || a.push(s.children[u]);
                            var h = s.progressChunk * (a.length + 1),
                                l = h / (a.length + 2);
                            s.children.push(this.resources[t]), s.progressChunk = l;
                            for (var c = 0; c < a.length; ++c) a[c].progressChunk = l;
                            this.resources[t].progressChunk = l
                        }
                        return this._queue.push(this.resources[t]), this
                    }, t.prototype.pre = function(t) {
                        return this._beforeMiddleware.push(t), this
                    }, t.prototype.use = function(t) {
                        return this._afterMiddleware.push(t), this
                    }, t.prototype.reset = function() {
                        this.progress = 0, this.loading = !1, this._queue.kill(), this._queue.pause();
                        for (var t in this.resources) {
                            var e = this.resources[t];
                            e._onLoadBinding && e._onLoadBinding.detach(), e.isLoading && e.abort()
                        }
                        return this.resources = {}, this
                    }, t.prototype.load = function(t) {
                        if ("function" == typeof t && this.onComplete.once(t), this.loading) return this;
                        if (this._queue.idle()) this._onStart(), this._onComplete();
                        else {
                            for (var e = this._queue._tasks.length, r = 100 / e, n = 0; n < this._queue._tasks.length; ++n) this._queue._tasks[n].data.progressChunk = r;
                            this._onStart(), this._queue.resume()
                        }
                        return this
                    }, t.prototype._prepareUrl = function(t) {
                        var e = (0, l.default)(t, {
                                strictMode: !0
                            }),
                            r = void 0;
                        if (r = e.protocol || !e.path || 0 === t.indexOf("//") ? t : this.baseUrl.length && this.baseUrl.lastIndexOf("/") !== this.baseUrl.length - 1 && "/" !== t.charAt(0) ? this.baseUrl + "/" + t : this.baseUrl + t, this.defaultQueryString) {
                            var n = v.exec(r)[0];
                            r = r.substr(0, r.length - n.length), -1 !== r.indexOf("?") ? r += "&" + this.defaultQueryString : r += "?" + this.defaultQueryString, r += n
                        }
                        return r
                    }, t.prototype._loadResource = function(t, e) {
                        var r = this;
                        t._dequeue = e, d.eachSeries(this._beforeMiddleware, function(e, n) {
                            e.call(r, t, function() {
                                n(t.isComplete ? {} : null)
                            })
                        }, function() {
                            t.isComplete ? r._onLoad(t) : (t._onLoadBinding = t.onComplete.once(r._onLoad, r), t.load())
                        }, !0)
                    }, t.prototype._onStart = function() {
                        this.progress = 0, this.loading = !0, this.onStart.dispatch(this)
                    }, t.prototype._onComplete = function() {
                        this.progress = 100, this.loading = !1, this.onComplete.dispatch(this, this.resources)
                    }, t.prototype._onLoad = function(t) {
                        var e = this;
                        t._onLoadBinding = null, this._resourcesParsing.push(t), t._dequeue(), d.eachSeries(this._afterMiddleware, function(r, n) {
                            r.call(e, t, n)
                        }, function() {
                            t.onAfterMiddleware.dispatch(t), e.progress += t.progressChunk, e.onProgress.dispatch(e, t), t.error ? e.onError.dispatch(t.error, e, t) : e.onLoad.dispatch(e, t), e._resourcesParsing.splice(e._resourcesParsing.indexOf(t), 1), e._queue.idle() && 0 === e._resourcesParsing.length && e._onComplete()
                        }, !0)
                    }, s(t, [{
                        key: "concurrency",
                        get: function() {
                            return this._queue.concurrency
                        },
                        set: function(t) {
                            this._queue.concurrency = t
                        }
                    }]), t
                }();
            r.default = y
        }, {
            "./Resource": 33,
            "./async": 34,
            "mini-signals": 5,
            "parse-uri": 7
        }],
        33: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o() {}

            function s(t, e, r) {
                e && 0 === e.indexOf(".") && (e = e.substring(1)), e && (t[e] = r)
            }

            function a(t) {
                return t.toString().replace("object ", "")
            }
            r.__esModule = !0;
            var u = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                h = t("parse-uri"),
                l = n(h),
                c = t("mini-signals"),
                d = n(c),
                f = !(!window.XDomainRequest || "withCredentials" in new XMLHttpRequest),
                p = null,
                v = function() {
                    function t(e, r, n) {
                        if (i(this, t), "string" != typeof e || "string" != typeof r) throw new Error("Both name and url are required for constructing a resource.");
                        n = n || {}, this._flags = 0, this._setFlag(t.STATUS_FLAGS.DATA_URL, 0 === r.indexOf("data:")), this.name = e, this.url = r, this.extension = this._getExtension(), this.data = null, this.crossOrigin = !0 === n.crossOrigin ? "anonymous" : n.crossOrigin, this.loadType = n.loadType || this._determineLoadType(), this.xhrType = n.xhrType, this.metadata = n.metadata || {}, this.error = null, this.xhr = null, this.children = [], this.type = t.TYPE.UNKNOWN, this.progressChunk = 0, this._dequeue = o, this._onLoadBinding = null, this._boundComplete = this.complete.bind(this), this._boundOnError = this._onError.bind(this), this._boundOnProgress = this._onProgress.bind(this), this._boundXhrOnError = this._xhrOnError.bind(this), this._boundXhrOnAbort = this._xhrOnAbort.bind(this), this._boundXhrOnLoad = this._xhrOnLoad.bind(this), this._boundXdrOnTimeout = this._xdrOnTimeout.bind(this), this.onStart = new d.default, this.onProgress = new d.default, this.onComplete = new d.default, this.onAfterMiddleware = new d.default
                    }
                    return t.setExtensionLoadType = function(e, r) {
                        s(t._loadTypeMap, e, r)
                    }, t.setExtensionXhrType = function(e, r) {
                        s(t._xhrTypeMap, e, r)
                    }, t.prototype.complete = function() {
                        if (this.data && this.data.removeEventListener && (this.data.removeEventListener("error", this._boundOnError, !1), this.data.removeEventListener("load", this._boundComplete, !1), this.data.removeEventListener("progress", this._boundOnProgress, !1), this.data.removeEventListener("canplaythrough", this._boundComplete, !1)), this.xhr && (this.xhr.removeEventListener ? (this.xhr.removeEventListener("error", this._boundXhrOnError, !1), this.xhr.removeEventListener("abort", this._boundXhrOnAbort, !1), this.xhr.removeEventListener("progress", this._boundOnProgress, !1), this.xhr.removeEventListener("load", this._boundXhrOnLoad, !1)) : (this.xhr.onerror = null, this.xhr.ontimeout = null, this.xhr.onprogress = null, this.xhr.onload = null)), this.isComplete) throw new Error("Complete called again for an already completed resource.");
                        this._setFlag(t.STATUS_FLAGS.COMPLETE, !0), this._setFlag(t.STATUS_FLAGS.LOADING, !1), this.onComplete.dispatch(this)
                    }, t.prototype.abort = function(e) {
                        if (!this.error) {
                            if (this.error = new Error(e), this.xhr) this.xhr.abort();
                            else if (this.xdr) this.xdr.abort();
                            else if (this.data)
                                if (this.data.src) this.data.src = t.EMPTY_GIF;
                                else
                                    for (; this.data.firstChild;) this.data.removeChild(this.data.firstChild);
                            this.complete()
                        }
                    }, t.prototype.load = function(e) {
                        var r = this;
                        if (!this.isLoading) {
                            if (this.isComplete) return void(e && setTimeout(function() {
                                return e(r)
                            }, 1));
                            switch (e && this.onComplete.once(e), this._setFlag(t.STATUS_FLAGS.LOADING, !0), this.onStart.dispatch(this), !1 !== this.crossOrigin && "string" == typeof this.crossOrigin || (this.crossOrigin = this._determineCrossOrigin(this.url)), this.loadType) {
                                case t.LOAD_TYPE.IMAGE:
                                    this.type = t.TYPE.IMAGE, this._loadElement("image");
                                    break;
                                case t.LOAD_TYPE.AUDIO:
                                    this.type = t.TYPE.AUDIO, this._loadSourceElement("audio");
                                    break;
                                case t.LOAD_TYPE.VIDEO:
                                    this.type = t.TYPE.VIDEO, this._loadSourceElement("video");
                                    break;
                                case t.LOAD_TYPE.XHR:
                                default:
                                    f && this.crossOrigin ? this._loadXdr() : this._loadXhr()
                            }
                        }
                    }, t.prototype._hasFlag = function(t) {
                        return !!(this._flags & t)
                    }, t.prototype._setFlag = function(t, e) {
                        this._flags = e ? this._flags | t : this._flags & ~t
                    }, t.prototype._loadElement = function(t) {
                        this.metadata.loadElement ? this.data = this.metadata.loadElement : "image" === t && void 0 !== window.Image ? this.data = new Image : this.data = document.createElement(t), this.crossOrigin && (this.data.crossOrigin = this.crossOrigin), this.metadata.skipSource || (this.data.src = this.url), this.data.addEventListener("error", this._boundOnError, !1), this.data.addEventListener("load", this._boundComplete, !1), this.data.addEventListener("progress", this._boundOnProgress, !1)
                    }, t.prototype._loadSourceElement = function(t) {
                        if (this.metadata.loadElement ? this.data = this.metadata.loadElement : "audio" === t && void 0 !== window.Audio ? this.data = new Audio : this.data = document.createElement(t), null === this.data) return void this.abort("Unsupported element: " + t);
                        if (!this.metadata.skipSource)
                            if (navigator.isCocoonJS) this.data.src = Array.isArray(this.url) ? this.url[0] : this.url;
                            else if (Array.isArray(this.url))
                            for (var e = this.metadata.mimeType, r = 0; r < this.url.length; ++r) this.data.appendChild(this._createSource(t, this.url[r], Array.isArray(e) ? e[r] : e));
                        else {
                            var n = this.metadata.mimeType;
                            this.data.appendChild(this._createSource(t, this.url, Array.isArray(n) ? n[0] : n))
                        }
                        this.data.addEventListener("error", this._boundOnError, !1), this.data.addEventListener("load", this._boundComplete, !1), this.data.addEventListener("progress", this._boundOnProgress, !1), this.data.addEventListener("canplaythrough", this._boundComplete, !1), this.data.load()
                    }, t.prototype._loadXhr = function() {
                        "string" != typeof this.xhrType && (this.xhrType = this._determineXhrType());
                        var e = this.xhr = new XMLHttpRequest;
                        e.open("GET", this.url, !0), this.xhrType === t.XHR_RESPONSE_TYPE.JSON || this.xhrType === t.XHR_RESPONSE_TYPE.DOCUMENT ? e.responseType = t.XHR_RESPONSE_TYPE.TEXT : e.responseType = this.xhrType, e.addEventListener("error", this._boundXhrOnError, !1), e.addEventListener("abort", this._boundXhrOnAbort, !1), e.addEventListener("progress", this._boundOnProgress, !1), e.addEventListener("load", this._boundXhrOnLoad, !1), e.send()
                    }, t.prototype._loadXdr = function() {
                        "string" != typeof this.xhrType && (this.xhrType = this._determineXhrType());
                        var t = this.xhr = new XDomainRequest;
                        t.timeout = 5e3, t.onerror = this._boundXhrOnError, t.ontimeout = this._boundXdrOnTimeout, t.onprogress = this._boundOnProgress, t.onload = this._boundXhrOnLoad, t.open("GET", this.url, !0), setTimeout(function() {
                            return t.send()
                        }, 1)
                    }, t.prototype._createSource = function(t, e, r) {
                        r || (r = t + "/" + this._getExtension(e));
                        var n = document.createElement("source");
                        return n.src = e, n.type = r, n
                    }, t.prototype._onError = function(t) {
                        this.abort("Failed to load element using: " + t.target.nodeName)
                    }, t.prototype._onProgress = function(t) {
                        t && t.lengthComputable && this.onProgress.dispatch(this, t.loaded / t.total)
                    }, t.prototype._xhrOnError = function() {
                        var t = this.xhr;
                        this.abort(a(t) + " Request failed. Status: " + t.status + ', text: "' + t.statusText + '"')
                    }, t.prototype._xhrOnAbort = function() {
                        this.abort(a(this.xhr) + " Request was aborted by the user.")
                    }, t.prototype._xdrOnTimeout = function() {
                        this.abort(a(this.xhr) + " Request timed out.")
                    }, t.prototype._xhrOnLoad = function() {
                        var e = this.xhr,
                            r = "",
                            n = void 0 === e.status ? 200 : e.status;
                        if ("" !== e.responseType && "text" !== e.responseType && void 0 !== e.responseType || (r = e.responseText), 0 === n && (r.length > 0 || e.responseType === t.XHR_RESPONSE_TYPE.BUFFER) ? n = 200 : 1223 === n && (n = 204), 2 != (n / 100 | 0)) return void this.abort("[" + e.status + "] " + e.statusText + ": " + e.responseURL);
                        if (this.xhrType === t.XHR_RESPONSE_TYPE.TEXT) this.data = r, this.type = t.TYPE.TEXT;
                        else if (this.xhrType === t.XHR_RESPONSE_TYPE.JSON) try {
                            this.data = JSON.parse(r), this.type = t.TYPE.JSON
                        } catch (t) {
                            return void this.abort("Error trying to parse loaded json: " + t)
                        } else if (this.xhrType === t.XHR_RESPONSE_TYPE.DOCUMENT) try {
                            if (window.DOMParser) {
                                var i = new DOMParser;
                                this.data = i.parseFromString(r, "text/xml")
                            } else {
                                var o = document.createElement("div");
                                o.innerHTML = r, this.data = o
                            }
                            this.type = t.TYPE.XML
                        } catch (t) {
                            return void this.abort("Error trying to parse loaded xml: " + t)
                        } else this.data = e.response || r;
                        this.complete()
                    }, t.prototype._determineCrossOrigin = function(t, e) {
                        if (0 === t.indexOf("data:")) return "";
                        e = e || window.location, p || (p = document.createElement("a")), p.href = t, t = (0, l.default)(p.href, {
                            strictMode: !0
                        });
                        var r = !t.port && "" === e.port || t.port === e.port,
                            n = t.protocol ? t.protocol + ":" : "";
                        return t.host === e.hostname && r && n === e.protocol ? "" : "anonymous"
                    }, t.prototype._determineXhrType = function() {
                        return t._xhrTypeMap[this.extension] || t.XHR_RESPONSE_TYPE.TEXT
                    }, t.prototype._determineLoadType = function() {
                        return t._loadTypeMap[this.extension] || t.LOAD_TYPE.XHR
                    }, t.prototype._getExtension = function() {
                        var t = this.url,
                            e = "";
                        if (this.isDataUrl) {
                            var r = t.indexOf("/");
                            e = t.substring(r + 1, t.indexOf(";", r))
                        } else {
                            var n = t.indexOf("?"),
                                i = t.indexOf("#"),
                                o = Math.min(n > -1 ? n : t.length, i > -1 ? i : t.length);
                            t = t.substring(0, o), e = t.substring(t.lastIndexOf(".") + 1)
                        }
                        return e.toLowerCase()
                    }, t.prototype._getMimeFromXhrType = function(e) {
                        switch (e) {
                            case t.XHR_RESPONSE_TYPE.BUFFER:
                                return "application/octet-binary";
                            case t.XHR_RESPONSE_TYPE.BLOB:
                                return "application/blob";
                            case t.XHR_RESPONSE_TYPE.DOCUMENT:
                                return "application/xml";
                            case t.XHR_RESPONSE_TYPE.JSON:
                                return "application/json";
                            case t.XHR_RESPONSE_TYPE.DEFAULT:
                            case t.XHR_RESPONSE_TYPE.TEXT:
                            default:
                                return "text/plain"
                        }
                    }, u(t, [{
                        key: "isDataUrl",
                        get: function() {
                            return this._hasFlag(t.STATUS_FLAGS.DATA_URL)
                        }
                    }, {
                        key: "isComplete",
                        get: function() {
                            return this._hasFlag(t.STATUS_FLAGS.COMPLETE)
                        }
                    }, {
                        key: "isLoading",
                        get: function() {
                            return this._hasFlag(t.STATUS_FLAGS.LOADING)
                        }
                    }]), t
                }();
            r.default = v, v.STATUS_FLAGS = {
                NONE: 0,
                DATA_URL: 1,
                COMPLETE: 2,
                LOADING: 4
            }, v.TYPE = {
                UNKNOWN: 0,
                JSON: 1,
                XML: 2,
                IMAGE: 3,
                AUDIO: 4,
                VIDEO: 5,
                TEXT: 6
            }, v.LOAD_TYPE = {
                XHR: 1,
                IMAGE: 2,
                AUDIO: 3,
                VIDEO: 4
            }, v.XHR_RESPONSE_TYPE = {
                DEFAULT: "text",
                BUFFER: "arraybuffer",
                BLOB: "blob",
                DOCUMENT: "document",
                JSON: "json",
                TEXT: "text"
            }, v._loadTypeMap = {
                gif: v.LOAD_TYPE.IMAGE,
                png: v.LOAD_TYPE.IMAGE,
                bmp: v.LOAD_TYPE.IMAGE,
                jpg: v.LOAD_TYPE.IMAGE,
                jpeg: v.LOAD_TYPE.IMAGE,
                tif: v.LOAD_TYPE.IMAGE,
                tiff: v.LOAD_TYPE.IMAGE,
                webp: v.LOAD_TYPE.IMAGE,
                tga: v.LOAD_TYPE.IMAGE,
                svg: v.LOAD_TYPE.IMAGE,
                "svg+xml": v.LOAD_TYPE.IMAGE,
                mp3: v.LOAD_TYPE.AUDIO,
                ogg: v.LOAD_TYPE.AUDIO,
                wav: v.LOAD_TYPE.AUDIO,
                mp4: v.LOAD_TYPE.VIDEO,
                webm: v.LOAD_TYPE.VIDEO
            }, v._xhrTypeMap = {
                xhtml: v.XHR_RESPONSE_TYPE.DOCUMENT,
                html: v.XHR_RESPONSE_TYPE.DOCUMENT,
                htm: v.XHR_RESPONSE_TYPE.DOCUMENT,
                xml: v.XHR_RESPONSE_TYPE.DOCUMENT,
                tmx: v.XHR_RESPONSE_TYPE.DOCUMENT,
                svg: v.XHR_RESPONSE_TYPE.DOCUMENT,
                tsx: v.XHR_RESPONSE_TYPE.DOCUMENT,
                gif: v.XHR_RESPONSE_TYPE.BLOB,
                png: v.XHR_RESPONSE_TYPE.BLOB,
                bmp: v.XHR_RESPONSE_TYPE.BLOB,
                jpg: v.XHR_RESPONSE_TYPE.BLOB,
                jpeg: v.XHR_RESPONSE_TYPE.BLOB,
                tif: v.XHR_RESPONSE_TYPE.BLOB,
                tiff: v.XHR_RESPONSE_TYPE.BLOB,
                webp: v.XHR_RESPONSE_TYPE.BLOB,
                tga: v.XHR_RESPONSE_TYPE.BLOB,
                json: v.XHR_RESPONSE_TYPE.JSON,
                text: v.XHR_RESPONSE_TYPE.TEXT,
                txt: v.XHR_RESPONSE_TYPE.TEXT,
                ttf: v.XHR_RESPONSE_TYPE.BUFFER,
                otf: v.XHR_RESPONSE_TYPE.BUFFER
            }, v.EMPTY_GIF = "data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="
        }, {
            "mini-signals": 5,
            "parse-uri": 7
        }],
        34: [function(t, e, r) {
            "use strict";

            function n() {}

            function i(t, e, r, n) {
                var i = 0,
                    o = t.length;
                ! function s(a) {
                    if (a || i === o) return void(r && r(a));
                    n ? setTimeout(function() {
                        e(t[i++], s)
                    }, 1) : e(t[i++], s)
                }()
            }

            function o(t) {
                return function() {
                    if (null === t) throw new Error("Callback was already called.");
                    var e = t;
                    t = null, e.apply(this, arguments)
                }
            }

            function s(t, e) {
                function r(t, e, r) {
                    if (null != r && "function" != typeof r) throw new Error("task callback must be a function");
                    if (a.started = !0, null == t && a.idle()) return void setTimeout(function() {
                        return a.drain()
                    }, 1);
                    var i = {
                        data: t,
                        callback: "function" == typeof r ? r : n
                    };
                    e ? a._tasks.unshift(i) : a._tasks.push(i), setTimeout(function() {
                        return a.process()
                    }, 1)
                }

                function i(t) {
                    return function() {
                        s -= 1, t.callback.apply(t, arguments), null != arguments[0] && a.error(arguments[0], t.data), s <= a.concurrency - a.buffer && a.unsaturated(), a.idle() && a.drain(), a.process()
                    }
                }
                if (null == e) e = 1;
                else if (0 === e) throw new Error("Concurrency must not be zero");
                var s = 0,
                    a = {
                        _tasks: [],
                        concurrency: e,
                        saturated: n,
                        unsaturated: n,
                        buffer: e / 4,
                        empty: n,
                        drain: n,
                        error: n,
                        started: !1,
                        paused: !1,
                        push: function(t, e) {
                            r(t, !1, e)
                        },
                        kill: function() {
                            s = 0, a.drain = n, a.started = !1, a._tasks = []
                        },
                        unshift: function(t, e) {
                            r(t, !0, e)
                        },
                        process: function() {
                            for (; !a.paused && s < a.concurrency && a._tasks.length;) {
                                var e = a._tasks.shift();
                                0 === a._tasks.length && a.empty(), s += 1, s === a.concurrency && a.saturated(), t(e.data, o(i(e)))
                            }
                        },
                        length: function() {
                            return a._tasks.length
                        },
                        running: function() {
                            return s
                        },
                        idle: function() {
                            return a._tasks.length + s === 0
                        },
                        pause: function() {
                            !0 !== a.paused && (a.paused = !0)
                        },
                        resume: function() {
                            if (!1 !== a.paused) {
                                a.paused = !1;
                                for (var t = 1; t <= a.concurrency; t++) a.process()
                            }
                        }
                    };
                return a
            }
            r.__esModule = !0, r.eachSeries = i, r.queue = s
        }, {}],
        35: [function(t, e, r) {
            "use strict";

            function n(t) {
                for (var e = "", r = 0; r < t.length;) {
                    for (var n = [0, 0, 0], o = [0, 0, 0, 0], s = 0; s < n.length; ++s) r < t.length ? n[s] = 255 & t.charCodeAt(r++) : n[s] = 0;
                    o[0] = n[0] >> 2, o[1] = (3 & n[0]) << 4 | n[1] >> 4, o[2] = (15 & n[1]) << 2 | n[2] >> 6, o[3] = 63 & n[2];
                    switch (r - (t.length - 1)) {
                        case 2:
                            o[3] = 64, o[2] = 64;
                            break;
                        case 1:
                            o[3] = 64
                    }
                    for (var a = 0; a < o.length; ++a) e += i.charAt(o[a])
                }
                return e
            }
            r.__esModule = !0, r.encodeBinary = n;
            var i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
        }, {}],
        36: [function(t, e, r) {
            "use strict";
            var n = t("./Loader").default,
                i = t("./Resource").default,
                o = t("./async"),
                s = t("./b64");
            n.Resource = i, n.async = o, n.base64 = s, e.exports = n, e.exports.default = n
        }, {
            "./Loader": 32,
            "./Resource": 33,
            "./async": 34,
            "./b64": 35
        }],
        37: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i() {
                return function(t, e) {
                    if (!t.data) return void e();
                    if (t.xhr && t.xhrType === a.default.XHR_RESPONSE_TYPE.BLOB)
                        if (window.Blob && "string" != typeof t.data) {
                            if (0 === t.data.type.indexOf("image")) {
                                var r = function() {
                                    var r = l.createObjectURL(t.data);
                                    return t.blob = t.data, t.data = new Image, t.data.src = r, t.type = a.default.TYPE.IMAGE, t.data.onload = function() {
                                        l.revokeObjectURL(r), t.data.onload = null, e()
                                    }, {
                                        v: void 0
                                    }
                                }();
                                if ("object" === (void 0 === r ? "undefined" : o(r))) return r.v
                            }
                        } else {
                            var n = t.xhr.getResponseHeader("content-type");
                            if (n && 0 === n.indexOf("image")) return t.data = new Image, t.data.src = "data:" + n + ";base64," + h.default.encodeBinary(t.xhr.responseText), t.type = a.default.TYPE.IMAGE, void(t.data.onload = function() {
                                t.data.onload = null, e()
                            })
                        } e()
                }
            }
            r.__esModule = !0;
            var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
                return typeof t
            } : function(t) {
                return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
            };
            r.blobMiddlewareFactory = i;
            var s = t("../../Resource"),
                a = n(s),
                u = t("../../b64"),
                h = n(u),
                l = window.URL || window.webkitURL
        }, {
            "../../Resource": 33,
            "../../b64": 35
        }],
        38: [function(t, e, r) {
            "use strict";

            function n() {
                this.protocol = null, this.slashes = null, this.auth = null, this.host = null, this.port = null, this.hostname = null, this.hash = null, this.search = null, this.query = null, this.pathname = null, this.path = null, this.href = null
            }

            function i(t, e, r) {
                if (t && h.isObject(t) && t instanceof n) return t;
                var i = new n;
                return i.parse(t, e, r), i
            }

            function o(t) {
                return h.isString(t) && (t = i(t)), t instanceof n ? t.format() : n.prototype.format.call(t)
            }

            function s(t, e) {
                return i(t, !1, !0).resolve(e)
            }

            function a(t, e) {
                return t ? i(t, !1, !0).resolveObject(e) : e
            }
            var u = t("punycode"),
                h = t("./util");
            r.parse = i, r.resolve = s, r.resolveObject = a, r.format = o, r.Url = n;
            var l = /^([a-z0-9.+-]+:)/i,
                c = /:[0-9]*$/,
                d = /^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,
                f = ["<", ">", '"', "`", " ", "\r", "\n", "\t"],
                p = ["{", "}", "|", "\\", "^", "`"].concat(f),
                v = ["'"].concat(p),
                y = ["%", "/", "?", ";", "#"].concat(v),
                g = ["/", "?", "#"],
                m = /^[+a-z0-9A-Z_-]{0,63}$/,
                _ = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,
                b = {
                    javascript: !0,
                    "javascript:": !0
                },
                x = {
                    javascript: !0,
                    "javascript:": !0
                },
                T = {
                    http: !0,
                    https: !0,
                    ftp: !0,
                    gopher: !0,
                    file: !0,
                    "http:": !0,
                    "https:": !0,
                    "ftp:": !0,
                    "gopher:": !0,
                    "file:": !0
                },
                w = t("querystring");
            n.prototype.parse = function(t, e, r) {
                if (!h.isString(t)) throw new TypeError("Parameter 'url' must be a string, not " + typeof t);
                var n = t.indexOf("?"),
                    i = -1 !== n && n < t.indexOf("#") ? "?" : "#",
                    o = t.split(i),
                    s = /\\/g;
                o[0] = o[0].replace(s, "/"), t = o.join(i);
                var a = t;
                if (a = a.trim(), !r && 1 === t.split("#").length) {
                    var c = d.exec(a);
                    if (c) return this.path = a, this.href = a, this.pathname = c[1], c[2] ? (this.search = c[2], this.query = e ? w.parse(this.search.substr(1)) : this.search.substr(1)) : e && (this.search = "", this.query = {}), this
                }
                var f = l.exec(a);
                if (f) {
                    f = f[0];
                    var p = f.toLowerCase();
                    this.protocol = p, a = a.substr(f.length)
                }
                if (r || f || a.match(/^\/\/[^@\/]+@[^@\/]+/)) {
                    var E = "//" === a.substr(0, 2);
                    !E || f && x[f] || (a = a.substr(2), this.slashes = !0)
                }
                if (!x[f] && (E || f && !T[f])) {
                    for (var S = -1, O = 0; O < g.length; O++) {
                        var M = a.indexOf(g[O]); - 1 !== M && (-1 === S || M < S) && (S = M)
                    }
                    var P, C;
                    C = -1 === S ? a.lastIndexOf("@") : a.lastIndexOf("@", S), -1 !== C && (P = a.slice(0, C), a = a.slice(C + 1), this.auth = decodeURIComponent(P)), S = -1;
                    for (var O = 0; O < y.length; O++) {
                        var M = a.indexOf(y[O]); - 1 !== M && (-1 === S || M < S) && (S = M)
                    } - 1 === S && (S = a.length), this.host = a.slice(0, S), a = a.slice(S), this.parseHost(), this.hostname = this.hostname || "";
                    var R = "[" === this.hostname[0] && "]" === this.hostname[this.hostname.length - 1];
                    if (!R)
                        for (var A = this.hostname.split(/\./), O = 0, I = A.length; O < I; O++) {
                            var D = A[O];
                            if (D && !D.match(m)) {
                                for (var L = "", N = 0, F = D.length; N < F; N++) D.charCodeAt(N) > 127 ? L += "x" : L += D[N];
                                if (!L.match(m)) {
                                    var B = A.slice(0, O),
                                        k = A.slice(O + 1),
                                        j = D.match(_);
                                    j && (B.push(j[1]), k.unshift(j[2])), k.length && (a = "/" + k.join(".") + a), this.hostname = B.join(".");
                                    break
                                }
                            }
                        }
                    this.hostname.length > 255 ? this.hostname = "" : this.hostname = this.hostname.toLowerCase(), R || (this.hostname = u.toASCII(this.hostname));
                    var U = this.port ? ":" + this.port : "",
                        X = this.hostname || "";
                    this.host = X + U, this.href += this.host, R && (this.hostname = this.hostname.substr(1, this.hostname.length - 2), "/" !== a[0] && (a = "/" + a))
                }
                if (!b[p])
                    for (var O = 0, I = v.length; O < I; O++) {
                        var G = v[O];
                        if (-1 !== a.indexOf(G)) {
                            var W = encodeURIComponent(G);
                            W === G && (W = escape(G)), a = a.split(G).join(W)
                        }
                    }
                var H = a.indexOf("#"); - 1 !== H && (this.hash = a.substr(H), a = a.slice(0, H));
                var Y = a.indexOf("?");
                if (-1 !== Y ? (this.search = a.substr(Y), this.query = a.substr(Y + 1), e && (this.query = w.parse(this.query)), a = a.slice(0, Y)) : e && (this.search = "", this.query = {}), a && (this.pathname = a), T[p] && this.hostname && !this.pathname && (this.pathname = "/"), this.pathname || this.search) {
                    var U = this.pathname || "",
                        V = this.search || "";
                    this.path = U + V
                }
                return this.href = this.format(), this
            }, n.prototype.format = function() {
                var t = this.auth || "";
                t && (t = encodeURIComponent(t), t = t.replace(/%3A/i, ":"), t += "@");
                var e = this.protocol || "",
                    r = this.pathname || "",
                    n = this.hash || "",
                    i = !1,
                    o = "";
                this.host ? i = t + this.host : this.hostname && (i = t + (-1 === this.hostname.indexOf(":") ? this.hostname : "[" + this.hostname + "]"), this.port && (i += ":" + this.port)), this.query && h.isObject(this.query) && Object.keys(this.query).length && (o = w.stringify(this.query));
                var s = this.search || o && "?" + o || "";
                return e && ":" !== e.substr(-1) && (e += ":"), this.slashes || (!e || T[e]) && !1 !== i ? (i = "//" + (i || ""), r && "/" !== r.charAt(0) && (r = "/" + r)) : i || (i = ""), n && "#" !== n.charAt(0) && (n = "#" + n), s && "?" !== s.charAt(0) && (s = "?" + s), r = r.replace(/[?#]/g, function(t) {
                    return encodeURIComponent(t)
                }), s = s.replace("#", "%23"), e + i + r + s + n
            }, n.prototype.resolve = function(t) {
                return this.resolveObject(i(t, !1, !0)).format()
            }, n.prototype.resolveObject = function(t) {
                if (h.isString(t)) {
                    var e = new n;
                    e.parse(t, !1, !0), t = e
                }
                for (var r = new n, i = Object.keys(this), o = 0; o < i.length; o++) {
                    var s = i[o];
                    r[s] = this[s]
                }
                if (r.hash = t.hash, "" === t.href) return r.href = r.format(), r;
                if (t.slashes && !t.protocol) {
                    for (var a = Object.keys(t), u = 0; u < a.length; u++) {
                        var l = a[u];
                        "protocol" !== l && (r[l] = t[l])
                    }
                    return T[r.protocol] && r.hostname && !r.pathname && (r.path = r.pathname = "/"), r.href = r.format(), r
                }
                if (t.protocol && t.protocol !== r.protocol) {
                    if (!T[t.protocol]) {
                        for (var c = Object.keys(t), d = 0; d < c.length; d++) {
                            var f = c[d];
                            r[f] = t[f]
                        }
                        return r.href = r.format(), r
                    }
                    if (r.protocol = t.protocol, t.host || x[t.protocol]) r.pathname = t.pathname;
                    else {
                        for (var p = (t.pathname || "").split("/"); p.length && !(t.host = p.shift()););
                        t.host || (t.host = ""), t.hostname || (t.hostname = ""), "" !== p[0] && p.unshift(""), p.length < 2 && p.unshift(""), r.pathname = p.join("/")
                    }
                    if (r.search = t.search, r.query = t.query, r.host = t.host || "", r.auth = t.auth, r.hostname = t.hostname || t.host, r.port = t.port, r.pathname || r.search) {
                        var v = r.pathname || "",
                            y = r.search || "";
                        r.path = v + y
                    }
                    return r.slashes = r.slashes || t.slashes, r.href = r.format(), r
                }
                var g = r.pathname && "/" === r.pathname.charAt(0),
                    m = t.host || t.pathname && "/" === t.pathname.charAt(0),
                    _ = m || g || r.host && t.pathname,
                    b = _,
                    w = r.pathname && r.pathname.split("/") || [],
                    p = t.pathname && t.pathname.split("/") || [],
                    E = r.protocol && !T[r.protocol];
                if (E && (r.hostname = "", r.port = null, r.host && ("" === w[0] ? w[0] = r.host : w.unshift(r.host)), r.host = "", t.protocol && (t.hostname = null, t.port = null, t.host && ("" === p[0] ? p[0] = t.host : p.unshift(t.host)), t.host = null), _ = _ && ("" === p[0] || "" === w[0])), m) r.host = t.host || "" === t.host ? t.host : r.host, r.hostname = t.hostname || "" === t.hostname ? t.hostname : r.hostname, r.search = t.search, r.query = t.query, w = p;
                else if (p.length) w || (w = []), w.pop(), w = w.concat(p), r.search = t.search, r.query = t.query;
                else if (!h.isNullOrUndefined(t.search)) {
                    if (E) {
                        r.hostname = r.host = w.shift();
                        var S = !!(r.host && r.host.indexOf("@") > 0) && r.host.split("@");
                        S && (r.auth = S.shift(), r.host = r.hostname = S.shift())
                    }
                    return r.search = t.search, r.query = t.query, h.isNull(r.pathname) && h.isNull(r.search) || (r.path = (r.pathname ? r.pathname : "") + (r.search ? r.search : "")), r.href = r.format(), r
                }
                if (!w.length) return r.pathname = null, r.search ? r.path = "/" + r.search : r.path = null, r.href = r.format(), r;
                for (var O = w.slice(-1)[0], M = (r.host || t.host || w.length > 1) && ("." === O || ".." === O) || "" === O, P = 0, C = w.length; C >= 0; C--) O = w[C], "." === O ? w.splice(C, 1) : ".." === O ? (w.splice(C, 1), P++) : P && (w.splice(C, 1), P--);
                if (!_ && !b)
                    for (; P--; P) w.unshift("..");
                !_ || "" === w[0] || w[0] && "/" === w[0].charAt(0) || w.unshift(""), M && "/" !== w.join("/").substr(-1) && w.push("");
                var R = "" === w[0] || w[0] && "/" === w[0].charAt(0);
                if (E) {
                    r.hostname = r.host = R ? "" : w.length ? w.shift() : "";
                    var S = !!(r.host && r.host.indexOf("@") > 0) && r.host.split("@");
                    S && (r.auth = S.shift(), r.host = r.hostname = S.shift())
                }
                return _ = _ || r.host && w.length, _ && !R && w.unshift(""), w.length ? r.pathname = w.join("/") : (r.pathname = null, r.path = null), h.isNull(r.pathname) && h.isNull(r.search) || (r.path = (r.pathname ? r.pathname : "") + (r.search ? r.search : "")), r.auth = t.auth || r.auth, r.slashes = r.slashes || t.slashes, r.href = r.format(), r
            }, n.prototype.parseHost = function() {
                var t = this.host,
                    e = c.exec(t);
                e && (e = e[0], ":" !== e && (this.port = e.substr(1)), t = t.substr(0, t.length - e.length)), t && (this.hostname = t)
            }
        }, {
            "./util": 39,
            punycode: 27,
            querystring: 30
        }],
        39: [function(t, e, r) {
            "use strict";
            e.exports = {
                isString: function(t) {
                    return "string" == typeof t
                },
                isObject: function(t) {
                    return "object" == typeof t && null !== t
                },
                isNull: function(t) {
                    return null === t
                },
                isNullOrUndefined: function(t) {
                    return null == t
                }
            }
        }, {}],
        40: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = t("../core"),
                s = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(o),
                a = t("ismobilejs"),
                u = n(a),
                h = t("./accessibleTarget"),
                l = n(h);
            s.utils.mixins.delayMixin(s.DisplayObject.prototype, l.default);
            var c = 100,
                d = 0,
                f = 0,
                p = 2,
                v = function() {
                    function t(e) {
                        i(this, t), !u.default.tablet && !u.default.phone || navigator.isCocoonJS || this.createTouchHook();
                        var r = document.createElement("div");
                        r.style.width = c + "px", r.style.height = c + "px", r.style.position = "absolute", r.style.top = d + "px", r.style.left = f + "px", r.style.zIndex = p, this.div = r, this.pool = [], this.renderId = 0, this.debug = !1, this.renderer = e, this.children = [], this._onKeyDown = this._onKeyDown.bind(this), this._onMouseMove = this._onMouseMove.bind(this), this.isActive = !1, this.isMobileAccessabillity = !1, window.addEventListener("keydown", this._onKeyDown, !1)
                    }
                    return t.prototype.createTouchHook = function() {
                        var t = this,
                            e = document.createElement("button");
                        e.style.width = "1px", e.style.height = "1px", e.style.position = "absolute", e.style.top = "-1000px", e.style.left = "-1000px", e.style.zIndex = 2, e.style.backgroundColor = "#FF0000", e.title = "HOOK DIV", e.addEventListener("focus", function() {
                            t.isMobileAccessabillity = !0, t.activate(), document.body.removeChild(e)
                        }), document.body.appendChild(e)
                    }, t.prototype.activate = function() {
                        this.isActive || (this.isActive = !0, window.document.addEventListener("mousemove", this._onMouseMove, !0), window.removeEventListener("keydown", this._onKeyDown, !1), this.renderer.on("postrender", this.update, this), this.renderer.view.parentNode && this.renderer.view.parentNode.appendChild(this.div))
                    }, t.prototype.deactivate = function() {
                        this.isActive && !this.isMobileAccessabillity && (this.isActive = !1, window.document.removeEventListener("mousemove", this._onMouseMove), window.addEventListener("keydown", this._onKeyDown, !1), this.renderer.off("postrender", this.update), this.div.parentNode && this.div.parentNode.removeChild(this.div))
                    }, t.prototype.updateAccessibleObjects = function(t) {
                        if (t.visible) {
                            t.accessible && t.interactive && (t._accessibleActive || this.addChild(t), t.renderId = this.renderId);
                            for (var e = t.children, r = e.length - 1; r >= 0; r--) this.updateAccessibleObjects(e[r])
                        }
                    }, t.prototype.update = function() {
                        if (this.renderer.renderingToScreen) {
                            this.updateAccessibleObjects(this.renderer._lastObjectRendered);
                            var t = this.renderer.view.getBoundingClientRect(),
                                e = t.width / this.renderer.width,
                                r = t.height / this.renderer.height,
                                n = this.div;
                            n.style.left = t.left + "px", n.style.top = t.top + "px", n.style.width = this.renderer.width + "px", n.style.height = this.renderer.height + "px";
                            for (var i = 0; i < this.children.length; i++) {
                                var o = this.children[i];
                                if (o.renderId !== this.renderId) o._accessibleActive = !1, s.utils.removeItems(this.children, i, 1), this.div.removeChild(o._accessibleDiv), this.pool.push(o._accessibleDiv), o._accessibleDiv = null, i--, 0 === this.children.length && this.deactivate();
                                else {
                                    n = o._accessibleDiv;
                                    var a = o.hitArea,
                                        u = o.worldTransform;
                                    o.hitArea ? (n.style.left = (u.tx + a.x * u.a) * e + "px", n.style.top = (u.ty + a.y * u.d) * r + "px", n.style.width = a.width * u.a * e + "px", n.style.height = a.height * u.d * r + "px") : (a = o.getBounds(), this.capHitArea(a), n.style.left = a.x * e + "px", n.style.top = a.y * r + "px", n.style.width = a.width * e + "px", n.style.height = a.height * r + "px")
                                }
                            }
                            this.renderId++
                        }
                    }, t.prototype.capHitArea = function(t) {
                        t.x < 0 && (t.width += t.x, t.x = 0), t.y < 0 && (t.height += t.y, t.y = 0), t.x + t.width > this.renderer.width && (t.width = this.renderer.width - t.x), t.y + t.height > this.renderer.height && (t.height = this.renderer.height - t.y)
                    }, t.prototype.addChild = function(t) {
                        var e = this.pool.pop();
                        e || (e = document.createElement("button"), e.style.width = c + "px", e.style.height = c + "px", e.style.backgroundColor = this.debug ? "rgba(255,0,0,0.5)" : "transparent", e.style.position = "absolute", e.style.zIndex = p, e.style.borderStyle = "none", e.addEventListener("click", this._onClick.bind(this)), e.addEventListener("focus", this._onFocus.bind(this)), e.addEventListener("focusout", this._onFocusOut.bind(this))), t.accessibleTitle ? e.title = t.accessibleTitle : t.accessibleTitle || t.accessibleHint || (e.title = "displayObject " + this.tabIndex), t.accessibleHint && e.setAttribute("aria-label", t.accessibleHint), t._accessibleActive = !0, t._accessibleDiv = e, e.displayObject = t, this.children.push(t), this.div.appendChild(t._accessibleDiv), t._accessibleDiv.tabIndex = t.tabIndex
                    }, t.prototype._onClick = function(t) {
                        var e = this.renderer.plugins.interaction;
                        e.dispatchEvent(t.target.displayObject, "click", e.eventData)
                    }, t.prototype._onFocus = function(t) {
                        var e = this.renderer.plugins.interaction;
                        e.dispatchEvent(t.target.displayObject, "mouseover", e.eventData)
                    }, t.prototype._onFocusOut = function(t) {
                        var e = this.renderer.plugins.interaction;
                        e.dispatchEvent(t.target.displayObject, "mouseout", e.eventData)
                    }, t.prototype._onKeyDown = function(t) {
                        9 === t.keyCode && this.activate()
                    }, t.prototype._onMouseMove = function() {
                        this.deactivate()
                    }, t.prototype.destroy = function() {
                        this.div = null;
                        for (var t = 0; t < this.children.length; t++) this.children[t].div = null;
                        window.document.removeEventListener("mousemove", this._onMouseMove), window.removeEventListener("keydown", this._onKeyDown), this.pool = null, this.children = null, this.renderer = null
                    }, t
                }();
            r.default = v, s.WebGLRenderer.registerPlugin("accessibility", v), s.CanvasRenderer.registerPlugin("accessibility", v)
        }, {
            "../core": 65,
            "./accessibleTarget": 41,
            ismobilejs: 4
        }],
        41: [function(t, e, r) {
            "use strict";
            r.__esModule = !0, r.default = {
                accessible: !1,
                accessibleTitle: null,
                accessibleHint: null,
                tabIndex: 0,
                _accessibleActive: !1,
                _accessibleDiv: !1
            }
        }, {}],
        42: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./accessibleTarget");
            Object.defineProperty(r, "accessibleTarget", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./AccessibilityManager");
            Object.defineProperty(r, "AccessibilityManager", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            })
        }, {
            "./AccessibilityManager": 40,
            "./accessibleTarget": 41
        }],
        43: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                s = t("./autoDetectRenderer"),
                a = t("./display/Container"),
                u = n(a),
                h = t("./ticker"),
                l = t("./settings"),
                c = n(l),
                d = t("./const"),
                f = function() {
                    function t(e, r, n, o, a) {
                        i(this, t), "number" == typeof e && (e = Object.assign({
                            width: e,
                            height: r || c.default.RENDER_OPTIONS.height,
                            forceCanvas: !!o,
                            sharedTicker: !!a
                        }, n)), this._options = e = Object.assign({
                            autoStart: !0,
                            sharedTicker: !1,
                            forceCanvas: !1,
                            sharedLoader: !1
                        }, e), this.renderer = (0, s.autoDetectRenderer)(e), this.stage = new u.default, this._ticker = null, this.ticker = e.sharedTicker ? h.shared : new h.Ticker, e.autoStart && this.start()
                    }
                    return t.prototype.render = function() {
                        this.renderer.render(this.stage)
                    }, t.prototype.stop = function() {
                        this._ticker.stop()
                    }, t.prototype.start = function() {
                        this._ticker.start()
                    }, t.prototype.destroy = function(t) {
                        if (this._ticker) {
                            var e = this._ticker;
                            this.ticker = null, e.destroy()
                        }
                        this.stage.destroy(), this.stage = null, this.renderer.destroy(t), this.renderer = null, this._options = null
                    }, o(t, [{
                        key: "ticker",
                        set: function(t) {
                            this._ticker && this._ticker.remove(this.render, this), this._ticker = t, t && t.add(this.render, this, d.UPDATE_PRIORITY.LOW)
                        },
                        get: function() {
                            return this._ticker
                        }
                    }, {
                        key: "view",
                        get: function() {
                            return this.renderer.view
                        }
                    }, {
                        key: "screen",
                        get: function() {
                            return this.renderer.screen
                        }
                    }]), t
                }();
            r.default = f
        }, {
            "./autoDetectRenderer": 45,
            "./const": 46,
            "./display/Container": 48,
            "./settings": 101,
            "./ticker": 121
        }],
        44: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }

            function s(t, e) {
                if (t instanceof Array) {
                    if ("precision" !== t[0].substring(0, 9)) {
                        var r = t.slice(0);
                        return r.unshift("precision " + e + " float;"), r
                    }
                } else if ("precision" !== t.trim().substring(0, 9)) return "precision " + e + " float;\n" + t;
                return t
            }
            r.__esModule = !0;
            var a = t("pixi-gl-core"),
                u = t("./settings"),
                h = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(u),
                l = function(t) {
                    function e(r, o, a, u, l) {
                        return n(this, e), i(this, t.call(this, r, s(o, l || h.default.PRECISION_VERTEX), s(a, l || h.default.PRECISION_FRAGMENT), void 0, u))
                    }
                    return o(e, t), e
                }(a.GLShader);
            r.default = l
        }, {
            "./settings": 101,
            "pixi-gl-core": 15
        }],
        45: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e, r, n) {
                var i = t && t.forceCanvas;
                return void 0 !== n && (i = n), !i && s.isWebGLSupported() ? new l.default(t, e, r) : new u.default(t, e, r)
            }
            r.__esModule = !0, r.autoDetectRenderer = i;
            var o = t("./utils"),
                s = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(o),
                a = t("./renderers/canvas/CanvasRenderer"),
                u = n(a),
                h = t("./renderers/webgl/WebGLRenderer"),
                l = n(h)
        }, {
            "./renderers/canvas/CanvasRenderer": 77,
            "./renderers/webgl/WebGLRenderer": 84,
            "./utils": 125
        }],
        46: [function(t, e, r) {
            "use strict";
            r.__esModule = !0;
            r.VERSION = "4.7.1", r.PI_2 = 2 * Math.PI, r.RAD_TO_DEG = 180 / Math.PI, r.DEG_TO_RAD = Math.PI / 180, r.RENDERER_TYPE = {
                UNKNOWN: 0,
                WEBGL: 1,
                CANVAS: 2
            }, r.BLEND_MODES = {
                NORMAL: 0,
                ADD: 1,
                MULTIPLY: 2,
                SCREEN: 3,
                OVERLAY: 4,
                DARKEN: 5,
                LIGHTEN: 6,
                COLOR_DODGE: 7,
                COLOR_BURN: 8,
                HARD_LIGHT: 9,
                SOFT_LIGHT: 10,
                DIFFERENCE: 11,
                EXCLUSION: 12,
                HUE: 13,
                SATURATION: 14,
                COLOR: 15,
                LUMINOSITY: 16,
                NORMAL_NPM: 17,
                ADD_NPM: 18,
                SCREEN_NPM: 19
            }, r.DRAW_MODES = {
                POINTS: 0,
                LINES: 1,
                LINE_LOOP: 2,
                LINE_STRIP: 3,
                TRIANGLES: 4,
                TRIANGLE_STRIP: 5,
                TRIANGLE_FAN: 6
            }, r.SCALE_MODES = {
                LINEAR: 0,
                NEAREST: 1
            }, r.WRAP_MODES = {
                CLAMP: 0,
                REPEAT: 1,
                MIRRORED_REPEAT: 2
            }, r.GC_MODES = {
                AUTO: 0,
                MANUAL: 1
            }, r.URL_FILE_EXTENSION = /\.(\w{3,4})(?:$|\?|#)/i, r.DATA_URI = /^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;(charset=[\w-]+|base64))?,(.*)/i, r.SVG_SIZE = /<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i, r.SHAPES = {
                POLY: 0,
                RECT: 1,
                CIRC: 2,
                ELIP: 3,
                RREC: 4
            }, r.PRECISION = {
                LOW: "lowp",
                MEDIUM: "mediump",
                HIGH: "highp"
            }, r.TRANSFORM_MODE = {
                STATIC: 0,
                DYNAMIC: 1
            }, r.TEXT_GRADIENT = {
                LINEAR_VERTICAL: 0,
                LINEAR_HORIZONTAL: 1
            }, r.UPDATE_PRIORITY = {
                INTERACTION: 50,
                HIGH: 25,
                NORMAL: 0,
                LOW: -25,
                UTILITY: -50
            }
        }, {}],
        47: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../math"),
                o = function() {
                    function t() {
                        n(this, t), this.minX = 1 / 0, this.minY = 1 / 0, this.maxX = -1 / 0, this.maxY = -1 / 0, this.rect = null
                    }
                    return t.prototype.isEmpty = function() {
                        return this.minX > this.maxX || this.minY > this.maxY
                    }, t.prototype.clear = function() {
                        this.updateID++, this.minX = 1 / 0, this.minY = 1 / 0, this.maxX = -1 / 0, this.maxY = -1 / 0
                    }, t.prototype.getRectangle = function(t) {
                        return this.minX > this.maxX || this.minY > this.maxY ? i.Rectangle.EMPTY : (t = t || new i.Rectangle(0, 0, 1, 1), t.x = this.minX, t.y = this.minY, t.width = this.maxX - this.minX, t.height = this.maxY - this.minY, t)
                    }, t.prototype.addPoint = function(t) {
                        this.minX = Math.min(this.minX, t.x), this.maxX = Math.max(this.maxX, t.x), this.minY = Math.min(this.minY, t.y), this.maxY = Math.max(this.maxY, t.y)
                    }, t.prototype.addQuad = function(t) {
                        var e = this.minX,
                            r = this.minY,
                            n = this.maxX,
                            i = this.maxY,
                            o = t[0],
                            s = t[1];
                        e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, o = t[2], s = t[3], e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, o = t[4], s = t[5], e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, o = t[6], s = t[7], e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, this.minX = e, this.minY = r, this.maxX = n, this.maxY = i
                    }, t.prototype.addFrame = function(t, e, r, n, i) {
                        var o = t.worldTransform,
                            s = o.a,
                            a = o.b,
                            u = o.c,
                            h = o.d,
                            l = o.tx,
                            c = o.ty,
                            d = this.minX,
                            f = this.minY,
                            p = this.maxX,
                            v = this.maxY,
                            y = s * e + u * r + l,
                            g = a * e + h * r + c;
                        d = y < d ? y : d, f = g < f ? g : f, p = y > p ? y : p, v = g > v ? g : v, y = s * n + u * r + l, g = a * n + h * r + c, d = y < d ? y : d, f = g < f ? g : f, p = y > p ? y : p, v = g > v ? g : v, y = s * e + u * i + l, g = a * e + h * i + c, d = y < d ? y : d, f = g < f ? g : f, p = y > p ? y : p, v = g > v ? g : v, y = s * n + u * i + l, g = a * n + h * i + c, d = y < d ? y : d, f = g < f ? g : f, p = y > p ? y : p, v = g > v ? g : v, this.minX = d, this.minY = f, this.maxX = p, this.maxY = v
                    }, t.prototype.addVertices = function(t, e, r, n) {
                        for (var i = t.worldTransform, o = i.a, s = i.b, a = i.c, u = i.d, h = i.tx, l = i.ty, c = this.minX, d = this.minY, f = this.maxX, p = this.maxY, v = r; v < n; v += 2) {
                            var y = e[v],
                                g = e[v + 1],
                                m = o * y + a * g + h,
                                _ = u * g + s * y + l;
                            c = m < c ? m : c, d = _ < d ? _ : d, f = m > f ? m : f, p = _ > p ? _ : p
                        }
                        this.minX = c, this.minY = d, this.maxX = f, this.maxY = p
                    }, t.prototype.addBounds = function(t) {
                        var e = this.minX,
                            r = this.minY,
                            n = this.maxX,
                            i = this.maxY;
                        this.minX = t.minX < e ? t.minX : e, this.minY = t.minY < r ? t.minY : r, this.maxX = t.maxX > n ? t.maxX : n, this.maxY = t.maxY > i ? t.maxY : i
                    }, t.prototype.addBoundsMask = function(t, e) {
                        var r = t.minX > e.minX ? t.minX : e.minX,
                            n = t.minY > e.minY ? t.minY : e.minY,
                            i = t.maxX < e.maxX ? t.maxX : e.maxX,
                            o = t.maxY < e.maxY ? t.maxY : e.maxY;
                        if (r <= i && n <= o) {
                            var s = this.minX,
                                a = this.minY,
                                u = this.maxX,
                                h = this.maxY;
                            this.minX = r < s ? r : s, this.minY = n < a ? n : a, this.maxX = i > u ? i : u, this.maxY = o > h ? o : h
                        }
                    }, t.prototype.addBoundsArea = function(t, e) {
                        var r = t.minX > e.x ? t.minX : e.x,
                            n = t.minY > e.y ? t.minY : e.y,
                            i = t.maxX < e.x + e.width ? t.maxX : e.x + e.width,
                            o = t.maxY < e.y + e.height ? t.maxY : e.y + e.height;
                        if (r <= i && n <= o) {
                            var s = this.minX,
                                a = this.minY,
                                u = this.maxX,
                                h = this.maxY;
                            this.minX = r < s ? r : s, this.minY = n < a ? n : a, this.maxX = i > u ? i : u, this.maxY = o > h ? o : h
                        }
                    }, t
                }();
            r.default = o
        }, {
            "../math": 70
        }],
        48: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../utils"),
                u = t("./DisplayObject"),
                h = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(u),
                l = function(t) {
                    function e() {
                        n(this, e);
                        var r = i(this, t.call(this));
                        return r.children = [], r
                    }
                    return o(e, t), e.prototype.onChildrenChange = function() {}, e.prototype.addChild = function(t) {
                        var e = arguments.length;
                        if (e > 1)
                            for (var r = 0; r < e; r++) this.addChild(arguments[r]);
                        else t.parent && t.parent.removeChild(t), t.parent = this, t.transform._parentID = -1, this.children.push(t), this._boundsID++, this.onChildrenChange(this.children.length - 1), t.emit("added", this);
                        return t
                    }, e.prototype.addChildAt = function(t, e) {
                        if (e < 0 || e > this.children.length) throw new Error(t + "addChildAt: The index " + e + " supplied is out of bounds " + this.children.length);
                        return t.parent && t.parent.removeChild(t), t.parent = this, t.transform._parentID = -1, this.children.splice(e, 0, t), this._boundsID++, this.onChildrenChange(e), t.emit("added", this), t
                    }, e.prototype.swapChildren = function(t, e) {
                        if (t !== e) {
                            var r = this.getChildIndex(t),
                                n = this.getChildIndex(e);
                            this.children[r] = e, this.children[n] = t, this.onChildrenChange(r < n ? r : n)
                        }
                    }, e.prototype.getChildIndex = function(t) {
                        var e = this.children.indexOf(t);
                        if (-1 === e) throw new Error("The supplied DisplayObject must be a child of the caller");
                        return e
                    }, e.prototype.setChildIndex = function(t, e) {
                        if (e < 0 || e >= this.children.length) throw new Error("The index " + e + " supplied is out of bounds " + this.children.length);
                        var r = this.getChildIndex(t);
                        (0, a.removeItems)(this.children, r, 1), this.children.splice(e, 0, t), this.onChildrenChange(e)
                    }, e.prototype.getChildAt = function(t) {
                        if (t < 0 || t >= this.children.length) throw new Error("getChildAt: Index (" + t + ") does not exist.");
                        return this.children[t]
                    }, e.prototype.removeChild = function(t) {
                        var e = arguments.length;
                        if (e > 1)
                            for (var r = 0; r < e; r++) this.removeChild(arguments[r]);
                        else {
                            var n = this.children.indexOf(t);
                            if (-1 === n) return null;
                            t.parent = null, t.transform._parentID = -1, (0, a.removeItems)(this.children, n, 1), this._boundsID++, this.onChildrenChange(n), t.emit("removed", this)
                        }
                        return t
                    }, e.prototype.removeChildAt = function(t) {
                        var e = this.getChildAt(t);
                        return e.parent = null, e.transform._parentID = -1, (0, a.removeItems)(this.children, t, 1), this._boundsID++, this.onChildrenChange(t), e.emit("removed", this), e
                    }, e.prototype.removeChildren = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            e = arguments[1],
                            r = t,
                            n = "number" == typeof e ? e : this.children.length,
                            i = n - r,
                            o = void 0;
                        if (i > 0 && i <= n) {
                            o = this.children.splice(r, i);
                            for (var s = 0; s < o.length; ++s) o[s].parent = null, o[s].transform && (o[s].transform._parentID = -1);
                            this._boundsID++, this.onChildrenChange(t);
                            for (var a = 0; a < o.length; ++a) o[a].emit("removed", this);
                            return o
                        }
                        if (0 === i && 0 === this.children.length) return [];
                        throw new RangeError("removeChildren: numeric values are outside the acceptable range.")
                    }, e.prototype.updateTransform = function() {
                        this._boundsID++, this.transform.updateTransform(this.parent.transform), this.worldAlpha = this.alpha * this.parent.worldAlpha;
                        for (var t = 0, e = this.children.length; t < e; ++t) {
                            var r = this.children[t];
                            r.visible && r.updateTransform()
                        }
                    }, e.prototype.calculateBounds = function() {
                        this._bounds.clear(), this._calculateBounds();
                        for (var t = 0; t < this.children.length; t++) {
                            var e = this.children[t];
                            e.visible && e.renderable && (e.calculateBounds(), e._mask ? (e._mask.calculateBounds(), this._bounds.addBoundsMask(e._bounds, e._mask._bounds)) : e.filterArea ? this._bounds.addBoundsArea(e._bounds, e.filterArea) : this._bounds.addBounds(e._bounds))
                        }
                        this._lastBoundsID = this._boundsID
                    }, e.prototype._calculateBounds = function() {}, e.prototype.renderWebGL = function(t) {
                        if (this.visible && !(this.worldAlpha <= 0) && this.renderable)
                            if (this._mask || this._filters) this.renderAdvancedWebGL(t);
                            else {
                                this._renderWebGL(t);
                                for (var e = 0, r = this.children.length; e < r; ++e) this.children[e].renderWebGL(t)
                            }
                    }, e.prototype.renderAdvancedWebGL = function(t) {
                        t.flush();
                        var e = this._filters,
                            r = this._mask;
                        if (e) {
                            this._enabledFilters || (this._enabledFilters = []), this._enabledFilters.length = 0;
                            for (var n = 0; n < e.length; n++) e[n].enabled && this._enabledFilters.push(e[n]);
                            this._enabledFilters.length && t.filterManager.pushFilter(this, this._enabledFilters)
                        }
                        r && t.maskManager.pushMask(this, this._mask), this._renderWebGL(t);
                        for (var i = 0, o = this.children.length; i < o; i++) this.children[i].renderWebGL(t);
                        t.flush(), r && t.maskManager.popMask(this, this._mask), e && this._enabledFilters && this._enabledFilters.length && t.filterManager.popFilter()
                    }, e.prototype._renderWebGL = function(t) {}, e.prototype._renderCanvas = function(t) {}, e.prototype.renderCanvas = function(t) {
                        if (this.visible && !(this.worldAlpha <= 0) && this.renderable) {
                            this._mask && t.maskManager.pushMask(this._mask), this._renderCanvas(t);
                            for (var e = 0, r = this.children.length; e < r; ++e) this.children[e].renderCanvas(t);
                            this._mask && t.maskManager.popMask(t)
                        }
                    }, e.prototype.destroy = function(e) {
                        t.prototype.destroy.call(this);
                        var r = "boolean" == typeof e ? e : e && e.children,
                            n = this.removeChildren(0, this.children.length);
                        if (r)
                            for (var i = 0; i < n.length; ++i) n[i].destroy(e)
                    }, s(e, [{
                        key: "width",
                        get: function() {
                            return this.scale.x * this.getLocalBounds().width
                        },
                        set: function(t) {
                            var e = this.getLocalBounds().width;
                            this.scale.x = 0 !== e ? t / e : 1, this._width = t
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return this.scale.y * this.getLocalBounds().height
                        },
                        set: function(t) {
                            var e = this.getLocalBounds().height;
                            this.scale.y = 0 !== e ? t / e : 1, this._height = t
                        }
                    }]), e
                }(h.default);
            r.default = l, l.prototype.containerUpdateTransform = l.prototype.updateTransform
        }, {
            "../utils": 125,
            "./DisplayObject": 49
        }],
        49: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("eventemitter3"),
                h = n(u),
                l = t("../const"),
                c = t("../settings"),
                d = n(c),
                f = t("./TransformStatic"),
                p = n(f),
                v = t("./Transform"),
                y = n(v),
                g = t("./Bounds"),
                m = n(g),
                _ = t("../math"),
                b = function(t) {
                    function e() {
                        i(this, e);
                        var r = o(this, t.call(this)),
                            n = d.default.TRANSFORM_MODE === l.TRANSFORM_MODE.STATIC ? p.default : y.default;
                        return r.tempDisplayObjectParent = null, r.transform = new n, r.alpha = 1, r.visible = !0, r.renderable = !0, r.parent = null, r.worldAlpha = 1, r.filterArea = null, r._filters = null, r._enabledFilters = null, r._bounds = new m.default, r._boundsID = 0, r._lastBoundsID = -1, r._boundsRect = null, r._localBoundsRect = null, r._mask = null, r._destroyed = !1, r
                    }
                    return s(e, t), e.prototype.updateTransform = function() {
                        this.transform.updateTransform(this.parent.transform), this.worldAlpha = this.alpha * this.parent.worldAlpha, this._bounds.updateID++
                    }, e.prototype._recursivePostUpdateTransform = function() {
                        this.parent ? (this.parent._recursivePostUpdateTransform(), this.transform.updateTransform(this.parent.transform)) : this.transform.updateTransform(this._tempDisplayObjectParent.transform)
                    }, e.prototype.getBounds = function(t, e) {
                        return t || (this.parent ? (this._recursivePostUpdateTransform(), this.updateTransform()) : (this.parent = this._tempDisplayObjectParent, this.updateTransform(), this.parent = null)), this._boundsID !== this._lastBoundsID && this.calculateBounds(), e || (this._boundsRect || (this._boundsRect = new _.Rectangle), e = this._boundsRect), this._bounds.getRectangle(e)
                    }, e.prototype.getLocalBounds = function(t) {
                        var e = this.transform,
                            r = this.parent;
                        this.parent = null, this.transform = this._tempDisplayObjectParent.transform, t || (this._localBoundsRect || (this._localBoundsRect = new _.Rectangle), t = this._localBoundsRect);
                        var n = this.getBounds(!1, t);
                        return this.parent = r, this.transform = e, n
                    }, e.prototype.toGlobal = function(t, e) {
                        return arguments.length > 2 && void 0 !== arguments[2] && arguments[2] || (this._recursivePostUpdateTransform(), this.parent ? this.displayObjectUpdateTransform() : (this.parent = this._tempDisplayObjectParent, this.displayObjectUpdateTransform(), this.parent = null)), this.worldTransform.apply(t, e)
                    }, e.prototype.toLocal = function(t, e, r, n) {
                        return e && (t = e.toGlobal(t, r, n)), n || (this._recursivePostUpdateTransform(), this.parent ? this.displayObjectUpdateTransform() : (this.parent = this._tempDisplayObjectParent, this.displayObjectUpdateTransform(), this.parent = null)), this.worldTransform.applyInverse(t, r)
                    }, e.prototype.renderWebGL = function(t) {}, e.prototype.renderCanvas = function(t) {}, e.prototype.setParent = function(t) {
                        if (!t || !t.addChild) throw new Error("setParent: Argument must be a Container");
                        return t.addChild(this), t
                    }, e.prototype.setTransform = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
                            r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 1,
                            n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 1,
                            i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 0,
                            o = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : 0,
                            s = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : 0,
                            a = arguments.length > 7 && void 0 !== arguments[7] ? arguments[7] : 0,
                            u = arguments.length > 8 && void 0 !== arguments[8] ? arguments[8] : 0;
                        return this.position.x = t, this.position.y = e, this.scale.x = r || 1, this.scale.y = n || 1, this.rotation = i, this.skew.x = o, this.skew.y = s, this.pivot.x = a, this.pivot.y = u, this
                    }, e.prototype.destroy = function() {
                        this.removeAllListeners(), this.parent && this.parent.removeChild(this), this.transform = null, this.parent = null, this._bounds = null, this._currentBounds = null, this._mask = null, this.filterArea = null, this.interactive = !1, this.interactiveChildren = !1, this._destroyed = !0
                    }, a(e, [{
                        key: "_tempDisplayObjectParent",
                        get: function() {
                            return null === this.tempDisplayObjectParent && (this.tempDisplayObjectParent = new e), this.tempDisplayObjectParent
                        }
                    }, {
                        key: "x",
                        get: function() {
                            return this.position.x
                        },
                        set: function(t) {
                            this.transform.position.x = t
                        }
                    }, {
                        key: "y",
                        get: function() {
                            return this.position.y
                        },
                        set: function(t) {
                            this.transform.position.y = t
                        }
                    }, {
                        key: "worldTransform",
                        get: function() {
                            return this.transform.worldTransform
                        }
                    }, {
                        key: "localTransform",
                        get: function() {
                            return this.transform.localTransform
                        }
                    }, {
                        key: "position",
                        get: function() {
                            return this.transform.position
                        },
                        set: function(t) {
                            this.transform.position.copy(t)
                        }
                    }, {
                        key: "scale",
                        get: function() {
                            return this.transform.scale
                        },
                        set: function(t) {
                            this.transform.scale.copy(t)
                        }
                    }, {
                        key: "pivot",
                        get: function() {
                            return this.transform.pivot
                        },
                        set: function(t) {
                            this.transform.pivot.copy(t)
                        }
                    }, {
                        key: "skew",
                        get: function() {
                            return this.transform.skew
                        },
                        set: function(t) {
                            this.transform.skew.copy(t)
                        }
                    }, {
                        key: "rotation",
                        get: function() {
                            return this.transform.rotation
                        },
                        set: function(t) {
                            this.transform.rotation = t
                        }
                    }, {
                        key: "worldVisible",
                        get: function() {
                            var t = this;
                            do {
                                if (!t.visible) return !1;
                                t = t.parent
                            } while (t);
                            return !0
                        }
                    }, {
                        key: "mask",
                        get: function() {
                            return this._mask
                        },
                        set: function(t) {
                            this._mask && (this._mask.renderable = !0, this._mask.isMask = !1), this._mask = t, this._mask && (this._mask.renderable = !1, this._mask.isMask = !0)
                        }
                    }, {
                        key: "filters",
                        get: function() {
                            return this._filters && this._filters.slice()
                        },
                        set: function(t) {
                            this._filters = t && t.slice()
                        }
                    }]), e
                }(h.default);
            r.default = b, b.prototype.displayObjectUpdateTransform = b.prototype.updateTransform
        }, {
            "../const": 46,
            "../math": 70,
            "../settings": 101,
            "./Bounds": 47,
            "./Transform": 50,
            "./TransformStatic": 52,
            eventemitter3: 3
        }],
        50: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../math"),
                u = t("./TransformBase"),
                h = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(u),
                l = function(t) {
                    function e() {
                        n(this, e);
                        var r = i(this, t.call(this));
                        return r.position = new a.Point(0, 0), r.scale = new a.Point(1, 1), r.skew = new a.ObservablePoint(r.updateSkew, r, 0, 0), r.pivot = new a.Point(0, 0), r._rotation = 0, r._cx = 1, r._sx = 0, r._cy = 0, r._sy = 1, r
                    }
                    return o(e, t), e.prototype.updateSkew = function() {
                        this._cx = Math.cos(this._rotation + this.skew._y), this._sx = Math.sin(this._rotation + this.skew._y), this._cy = -Math.sin(this._rotation - this.skew._x), this._sy = Math.cos(this._rotation - this.skew._x)
                    }, e.prototype.updateLocalTransform = function() {
                        var t = this.localTransform;
                        t.a = this._cx * this.scale.x, t.b = this._sx * this.scale.x, t.c = this._cy * this.scale.y, t.d = this._sy * this.scale.y, t.tx = this.position.x - (this.pivot.x * t.a + this.pivot.y * t.c), t.ty = this.position.y - (this.pivot.x * t.b + this.pivot.y * t.d)
                    }, e.prototype.updateTransform = function(t) {
                        var e = this.localTransform;
                        e.a = this._cx * this.scale.x, e.b = this._sx * this.scale.x, e.c = this._cy * this.scale.y, e.d = this._sy * this.scale.y, e.tx = this.position.x - (this.pivot.x * e.a + this.pivot.y * e.c), e.ty = this.position.y - (this.pivot.x * e.b + this.pivot.y * e.d);
                        var r = t.worldTransform,
                            n = this.worldTransform;
                        n.a = e.a * r.a + e.b * r.c, n.b = e.a * r.b + e.b * r.d, n.c = e.c * r.a + e.d * r.c, n.d = e.c * r.b + e.d * r.d, n.tx = e.tx * r.a + e.ty * r.c + r.tx, n.ty = e.tx * r.b + e.ty * r.d + r.ty, this._worldID++
                    }, e.prototype.setFromMatrix = function(t) {
                        t.decompose(this)
                    }, s(e, [{
                        key: "rotation",
                        get: function() {
                            return this._rotation
                        },
                        set: function(t) {
                            this._rotation = t, this.updateSkew()
                        }
                    }]), e
                }(h.default);
            r.default = l
        }, {
            "../math": 70,
            "./TransformBase": 51
        }],
        51: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../math"),
                o = function() {
                    function t() {
                        n(this, t), this.worldTransform = new i.Matrix, this.localTransform = new i.Matrix, this._worldID = 0, this._parentID = 0
                    }
                    return t.prototype.updateLocalTransform = function() {}, t.prototype.updateTransform = function(t) {
                        var e = t.worldTransform,
                            r = this.worldTransform,
                            n = this.localTransform;
                        r.a = n.a * e.a + n.b * e.c, r.b = n.a * e.b + n.b * e.d, r.c = n.c * e.a + n.d * e.c, r.d = n.c * e.b + n.d * e.d, r.tx = n.tx * e.a + n.ty * e.c + e.tx, r.ty = n.tx * e.b + n.ty * e.d + e.ty, this._worldID++
                    }, t
                }();
            r.default = o, o.prototype.updateWorldTransform = o.prototype.updateTransform, o.IDENTITY = new o
        }, {
            "../math": 70
        }],
        52: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../math"),
                u = t("./TransformBase"),
                h = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(u),
                l = function(t) {
                    function e() {
                        n(this, e);
                        var r = i(this, t.call(this));
                        return r.position = new a.ObservablePoint(r.onChange, r, 0, 0), r.scale = new a.ObservablePoint(r.onChange, r, 1, 1), r.pivot = new a.ObservablePoint(r.onChange, r, 0, 0), r.skew = new a.ObservablePoint(r.updateSkew, r, 0, 0), r._rotation = 0, r._cx = 1, r._sx = 0, r._cy = 0, r._sy = 1, r._localID = 0, r._currentLocalID = 0, r
                    }
                    return o(e, t), e.prototype.onChange = function() {
                        this._localID++
                    }, e.prototype.updateSkew = function() {
                        this._cx = Math.cos(this._rotation + this.skew._y), this._sx = Math.sin(this._rotation + this.skew._y), this._cy = -Math.sin(this._rotation - this.skew._x), this._sy = Math.cos(this._rotation - this.skew._x), this._localID++
                    }, e.prototype.updateLocalTransform = function() {
                        var t = this.localTransform;
                        this._localID !== this._currentLocalID && (t.a = this._cx * this.scale._x, t.b = this._sx * this.scale._x, t.c = this._cy * this.scale._y, t.d = this._sy * this.scale._y, t.tx = this.position._x - (this.pivot._x * t.a + this.pivot._y * t.c), t.ty = this.position._y - (this.pivot._x * t.b + this.pivot._y * t.d), this._currentLocalID = this._localID, this._parentID = -1)
                    }, e.prototype.updateTransform = function(t) {
                        var e = this.localTransform;
                        if (this._localID !== this._currentLocalID && (e.a = this._cx * this.scale._x, e.b = this._sx * this.scale._x, e.c = this._cy * this.scale._y, e.d = this._sy * this.scale._y, e.tx = this.position._x - (this.pivot._x * e.a + this.pivot._y * e.c), e.ty = this.position._y - (this.pivot._x * e.b + this.pivot._y * e.d), this._currentLocalID = this._localID, this._parentID = -1), this._parentID !== t._worldID) {
                            var r = t.worldTransform,
                                n = this.worldTransform;
                            n.a = e.a * r.a + e.b * r.c, n.b = e.a * r.b + e.b * r.d, n.c = e.c * r.a + e.d * r.c, n.d = e.c * r.b + e.d * r.d, n.tx = e.tx * r.a + e.ty * r.c + r.tx, n.ty = e.tx * r.b + e.ty * r.d + r.ty, this._parentID = t._worldID, this._worldID++
                        }
                    }, e.prototype.setFromMatrix = function(t) {
                        t.decompose(this), this._localID++
                    }, s(e, [{
                        key: "rotation",
                        get: function() {
                            return this._rotation
                        },
                        set: function(t) {
                            this._rotation = t, this.updateSkew()
                        }
                    }]), e
                }(h.default);
            r.default = l
        }, {
            "../math": 70,
            "./TransformBase": 51
        }],
        53: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../display/Container"),
                u = n(a),
                h = t("../textures/RenderTexture"),
                l = n(h),
                c = t("../textures/Texture"),
                d = n(c),
                f = t("./GraphicsData"),
                p = n(f),
                v = t("../sprites/Sprite"),
                y = n(v),
                g = t("../math"),
                m = t("../utils"),
                _ = t("../const"),
                b = t("../display/Bounds"),
                x = n(b),
                T = t("./utils/bezierCurveTo"),
                w = n(T),
                E = t("../renderers/canvas/CanvasRenderer"),
                S = n(E),
                O = void 0,
                M = new g.Matrix,
                P = new g.Point,
                C = new Float32Array(4),
                R = new Float32Array(4),
                A = function(t) {
                    function e() {
                        var r = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
                        i(this, e);
                        var n = o(this, t.call(this));
                        return n.fillAlpha = 1, n.lineWidth = 0, n.nativeLines = r, n.lineColor = 0, n.graphicsData = [], n.tint = 16777215, n._prevTint = 16777215, n.blendMode = _.BLEND_MODES.NORMAL, n.currentPath = null, n._webGL = {}, n.isMask = !1, n.boundsPadding = 0, n._localBounds = new x.default, n.dirty = 0, n.fastRectDirty = -1, n.clearDirty = 0, n.boundsDirty = -1, n.cachedSpriteDirty = !1, n._spriteRect = null, n._fastRect = !1, n
                    }
                    return s(e, t), e.prototype.clone = function() {
                        var t = new e;
                        t.renderable = this.renderable, t.fillAlpha = this.fillAlpha, t.lineWidth = this.lineWidth, t.lineColor = this.lineColor, t.tint = this.tint, t.blendMode = this.blendMode, t.isMask = this.isMask, t.boundsPadding = this.boundsPadding, t.dirty = 0, t.cachedSpriteDirty = this.cachedSpriteDirty;
                        for (var r = 0; r < this.graphicsData.length; ++r) t.graphicsData.push(this.graphicsData[r].clone());
                        return t.currentPath = t.graphicsData[t.graphicsData.length - 1], t.updateLocalBounds(), t
                    }, e.prototype.lineStyle = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
                            r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 1;
                        if (this.lineWidth = t, this.lineColor = e, this.lineAlpha = r, this.currentPath)
                            if (this.currentPath.shape.points.length) {
                                var n = new g.Polygon(this.currentPath.shape.points.slice(-2));
                                n.closed = !1, this.drawShape(n)
                            } else this.currentPath.lineWidth = this.lineWidth, this.currentPath.lineColor = this.lineColor, this.currentPath.lineAlpha = this.lineAlpha;
                        return this
                    }, e.prototype.moveTo = function(t, e) {
                        var r = new g.Polygon([t, e]);
                        return r.closed = !1, this.drawShape(r), this
                    }, e.prototype.lineTo = function(t, e) {
                        return this.currentPath.shape.points.push(t, e), this.dirty++, this
                    }, e.prototype.quadraticCurveTo = function(t, e, r, n) {
                        this.currentPath ? 0 === this.currentPath.shape.points.length && (this.currentPath.shape.points = [0, 0]) : this.moveTo(0, 0);
                        var i = this.currentPath.shape.points,
                            o = 0,
                            s = 0;
                        0 === i.length && this.moveTo(0, 0);
                        for (var a = i[i.length - 2], u = i[i.length - 1], h = 1; h <= 20; ++h) {
                            var l = h / 20;
                            o = a + (t - a) * l, s = u + (e - u) * l, i.push(o + (t + (r - t) * l - o) * l, s + (e + (n - e) * l - s) * l)
                        }
                        return this.dirty++, this
                    }, e.prototype.bezierCurveTo = function(t, e, r, n, i, o) {
                        this.currentPath ? 0 === this.currentPath.shape.points.length && (this.currentPath.shape.points = [0, 0]) : this.moveTo(0, 0);
                        var s = this.currentPath.shape.points,
                            a = s[s.length - 2],
                            u = s[s.length - 1];
                        return s.length -= 2, (0, w.default)(a, u, t, e, r, n, i, o, s), this.dirty++, this
                    }, e.prototype.arcTo = function(t, e, r, n, i) {
                        this.currentPath ? 0 === this.currentPath.shape.points.length && this.currentPath.shape.points.push(t, e) : this.moveTo(t, e);
                        var o = this.currentPath.shape.points,
                            s = o[o.length - 2],
                            a = o[o.length - 1],
                            u = a - e,
                            h = s - t,
                            l = n - e,
                            c = r - t,
                            d = Math.abs(u * c - h * l);
                        if (d < 1e-8 || 0 === i) o[o.length - 2] === t && o[o.length - 1] === e || o.push(t, e);
                        else {
                            var f = u * u + h * h,
                                p = l * l + c * c,
                                v = u * l + h * c,
                                y = i * Math.sqrt(f) / d,
                                g = i * Math.sqrt(p) / d,
                                m = y * v / f,
                                _ = g * v / p,
                                b = y * c + g * h,
                                x = y * l + g * u,
                                T = h * (g + m),
                                w = u * (g + m),
                                E = c * (y + _),
                                S = l * (y + _),
                                O = Math.atan2(w - x, T - b),
                                M = Math.atan2(S - x, E - b);
                            this.arc(b + t, x + e, i, O, M, h * l > c * u)
                        }
                        return this.dirty++, this
                    }, e.prototype.arc = function(t, e, r, n, i) {
                        var o = arguments.length > 5 && void 0 !== arguments[5] && arguments[5];
                        if (n === i) return this;
                        !o && i <= n ? i += _.PI_2 : o && n <= i && (n += _.PI_2);
                        var s = i - n,
                            a = 40 * Math.ceil(Math.abs(s) / _.PI_2);
                        if (0 === s) return this;
                        var u = t + Math.cos(n) * r,
                            h = e + Math.sin(n) * r,
                            l = this.currentPath ? this.currentPath.shape.points : null;
                        l ? l[l.length - 2] === u && l[l.length - 1] === h || l.push(u, h) : (this.moveTo(u, h), l = this.currentPath.shape.points);
                        for (var c = s / (2 * a), d = 2 * c, f = Math.cos(c), p = Math.sin(c), v = a - 1, y = v % 1 / v, g = 0; g <= v; ++g) {
                            var m = g + y * g,
                                b = c + n + d * m,
                                x = Math.cos(b),
                                T = -Math.sin(b);
                            l.push((f * x + p * T) * r + t, (f * -T + p * x) * r + e)
                        }
                        return this.dirty++, this
                    }, e.prototype.beginFill = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1;
                        return this.filling = !0, this.fillColor = t, this.fillAlpha = e, this.currentPath && this.currentPath.shape.points.length <= 2 && (this.currentPath.fill = this.filling, this.currentPath.fillColor = this.fillColor, this.currentPath.fillAlpha = this.fillAlpha), this
                    }, e.prototype.endFill = function() {
                        return this.filling = !1, this.fillColor = null, this.fillAlpha = 1, this
                    }, e.prototype.drawRect = function(t, e, r, n) {
                        return this.drawShape(new g.Rectangle(t, e, r, n)), this
                    }, e.prototype.drawRoundedRect = function(t, e, r, n, i) {
                        return this.drawShape(new g.RoundedRectangle(t, e, r, n, i)), this
                    }, e.prototype.drawCircle = function(t, e, r) {
                        return this.drawShape(new g.Circle(t, e, r)), this
                    }, e.prototype.drawEllipse = function(t, e, r, n) {
                        return this.drawShape(new g.Ellipse(t, e, r, n)), this
                    }, e.prototype.drawPolygon = function(t) {
                        var e = t,
                            r = !0;
                        if (e instanceof g.Polygon && (r = e.closed, e = e.points), !Array.isArray(e)) {
                            e = new Array(arguments.length);
                            for (var n = 0; n < e.length; ++n) e[n] = arguments[n]
                        }
                        var i = new g.Polygon(e);
                        return i.closed = r, this.drawShape(i), this
                    }, e.prototype.drawStar = function(t, e, r, n, i) {
                        var o = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : 0;
                        i = i || n / 2;
                        for (var s = -1 * Math.PI / 2 + o, a = 2 * r, u = _.PI_2 / a, h = [], l = 0; l < a; l++) {
                            var c = l % 2 ? i : n,
                                d = l * u + s;
                            h.push(t + c * Math.cos(d), e + c * Math.sin(d))
                        }
                        return this.drawPolygon(h)
                    }, e.prototype.clear = function() {
                        return (this.lineWidth || this.filling || this.graphicsData.length > 0) && (this.lineWidth = 0, this.filling = !1, this.boundsDirty = -1, this.dirty++, this.clearDirty++, this.graphicsData.length = 0), this.currentPath = null, this._spriteRect = null, this
                    }, e.prototype.isFastRect = function() {
                        return 1 === this.graphicsData.length && this.graphicsData[0].shape.type === _.SHAPES.RECT && !this.graphicsData[0].lineWidth
                    }, e.prototype._renderWebGL = function(t) {
                        this.dirty !== this.fastRectDirty && (this.fastRectDirty = this.dirty, this._fastRect = this.isFastRect()), this._fastRect ? this._renderSpriteRect(t) : (t.setObjectRenderer(t.plugins.graphics), t.plugins.graphics.render(this))
                    }, e.prototype._renderSpriteRect = function(t) {
                        var e = this.graphicsData[0].shape;
                        this._spriteRect || (this._spriteRect = new y.default(new d.default(d.default.WHITE)));
                        var r = this._spriteRect;
                        if (16777215 === this.tint) r.tint = this.graphicsData[0].fillColor;
                        else {
                            var n = C,
                                i = R;
                            (0, m.hex2rgb)(this.graphicsData[0].fillColor, n), (0, m.hex2rgb)(this.tint, i), n[0] *= i[0], n[1] *= i[1], n[2] *= i[2], r.tint = (0, m.rgb2hex)(n)
                        }
                        r.alpha = this.graphicsData[0].fillAlpha, r.worldAlpha = this.worldAlpha * r.alpha, r.blendMode = this.blendMode, r._texture._frame.width = e.width, r._texture._frame.height = e.height, r.transform.worldTransform = this.transform.worldTransform, r.anchor.set(-e.x / e.width, -e.y / e.height), r._onAnchorUpdate(), r._renderWebGL(t)
                    }, e.prototype._renderCanvas = function(t) {
                        !0 !== this.isMask && t.plugins.graphics.render(this)
                    }, e.prototype._calculateBounds = function() {
                        this.boundsDirty !== this.dirty && (this.boundsDirty = this.dirty, this.updateLocalBounds(), this.cachedSpriteDirty = !0);
                        var t = this._localBounds;
                        this._bounds.addFrame(this.transform, t.minX, t.minY, t.maxX, t.maxY)
                    }, e.prototype.containsPoint = function(t) {
                        this.worldTransform.applyInverse(t, P);
                        for (var e = this.graphicsData, r = 0; r < e.length; ++r) {
                            var n = e[r];
                            if (n.fill && (n.shape && n.shape.contains(P.x, P.y))) {
                                if (n.holes)
                                    for (var i = 0; i < n.holes.length; i++) {
                                        var o = n.holes[i];
                                        if (o.contains(P.x, P.y)) return !1
                                    }
                                return !0
                            }
                        }
                        return !1
                    }, e.prototype.updateLocalBounds = function() {
                        var t = 1 / 0,
                            e = -1 / 0,
                            r = 1 / 0,
                            n = -1 / 0;
                        if (this.graphicsData.length)
                            for (var i = 0, o = 0, s = 0, a = 0, u = 0, h = 0; h < this.graphicsData.length; h++) {
                                var l = this.graphicsData[h],
                                    c = l.type,
                                    d = l.lineWidth;
                                if (i = l.shape, c === _.SHAPES.RECT || c === _.SHAPES.RREC) o = i.x - d / 2, s = i.y - d / 2, a = i.width + d, u = i.height + d, t = o < t ? o : t, e = o + a > e ? o + a : e, r = s < r ? s : r, n = s + u > n ? s + u : n;
                                else if (c === _.SHAPES.CIRC) o = i.x, s = i.y, a = i.radius + d / 2, u = i.radius + d / 2, t = o - a < t ? o - a : t, e = o + a > e ? o + a : e, r = s - u < r ? s - u : r, n = s + u > n ? s + u : n;
                                else if (c === _.SHAPES.ELIP) o = i.x, s = i.y, a = i.width + d / 2, u = i.height + d / 2, t = o - a < t ? o - a : t, e = o + a > e ? o + a : e, r = s - u < r ? s - u : r, n = s + u > n ? s + u : n;
                                else
                                    for (var f = i.points, p = 0, v = 0, y = 0, g = 0, m = 0, b = 0, x = 0, T = 0, w = 0; w + 2 < f.length; w += 2) o = f[w], s = f[w + 1], p = f[w + 2], v = f[w + 3], y = Math.abs(p - o), g = Math.abs(v - s), u = d, (a = Math.sqrt(y * y + g * g)) < 1e-9 || (m = (u / a * g + y) / 2, b = (u / a * y + g) / 2, x = (p + o) / 2, T = (v + s) / 2, t = x - m < t ? x - m : t, e = x + m > e ? x + m : e, r = T - b < r ? T - b : r, n = T + b > n ? T + b : n)
                            } else t = 0, e = 0, r = 0, n = 0;
                        var E = this.boundsPadding;
                        this._localBounds.minX = t - E, this._localBounds.maxX = e + E, this._localBounds.minY = r - E, this._localBounds.maxY = n + E
                    }, e.prototype.drawShape = function(t) {
                        this.currentPath && this.currentPath.shape.points.length <= 2 && this.graphicsData.pop(), this.currentPath = null;
                        var e = new p.default(this.lineWidth, this.lineColor, this.lineAlpha, this.fillColor, this.fillAlpha, this.filling, this.nativeLines, t);
                        return this.graphicsData.push(e), e.type === _.SHAPES.POLY && (e.shape.closed = e.shape.closed || this.filling, this.currentPath = e), this.dirty++, e
                    }, e.prototype.generateCanvasTexture = function(t) {
                        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1,
                            r = this.getLocalBounds(),
                            n = l.default.create(r.width, r.height, t, e);
                        O || (O = new S.default), this.transform.updateLocalTransform(), this.transform.localTransform.copy(M), M.invert(), M.tx -= r.x, M.ty -= r.y, O.render(this, n, !0, M);
                        var i = d.default.fromCanvas(n.baseTexture._canvasRenderTarget.canvas, t, "graphics");
                        return i.baseTexture.resolution = e, i.baseTexture.update(), i
                    }, e.prototype.closePath = function() {
                        var t = this.currentPath;
                        return t && t.shape && t.shape.close(), this
                    }, e.prototype.addHole = function() {
                        var t = this.graphicsData.pop();
                        return this.currentPath = this.graphicsData[this.graphicsData.length - 1], this.currentPath.addHole(t.shape), this.currentPath = null, this
                    }, e.prototype.destroy = function(e) {
                        t.prototype.destroy.call(this, e);
                        for (var r = 0; r < this.graphicsData.length; ++r) this.graphicsData[r].destroy();
                        for (var n in this._webgl)
                            for (var i = 0; i < this._webgl[n].data.length; ++i) this._webgl[n].data[i].destroy();
                        this._spriteRect && this._spriteRect.destroy(), this.graphicsData = null, this.currentPath = null, this._webgl = null, this._localBounds = null
                    }, e
                }(u.default);
            r.default = A, A._SPRITE_TEXTURE = null
        }, {
            "../const": 46,
            "../display/Bounds": 47,
            "../display/Container": 48,
            "../math": 70,
            "../renderers/canvas/CanvasRenderer": 77,
            "../sprites/Sprite": 102,
            "../textures/RenderTexture": 113,
            "../textures/Texture": 115,
            "../utils": 125,
            "./GraphicsData": 54,
            "./utils/bezierCurveTo": 56
        }],
        54: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t(e, r, i, o, s, a, u, h) {
                    n(this, t), this.lineWidth = e, this.nativeLines = u, this.lineColor = r, this.lineAlpha = i, this._lineTint = r, this.fillColor = o, this.fillAlpha = s, this._fillTint = o, this.fill = a, this.holes = [], this.shape = h, this.type = h.type
                }
                return t.prototype.clone = function() {
                    return new t(this.lineWidth, this.lineColor, this.lineAlpha, this.fillColor, this.fillAlpha, this.fill, this.nativeLines, this.shape)
                }, t.prototype.addHole = function(t) {
                    this.holes.push(t)
                }, t.prototype.destroy = function() {
                    this.shape = null, this.holes = null
                }, t
            }();
            r.default = i
        }, {}],
        55: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../renderers/canvas/CanvasRenderer"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = t("../../const"),
                a = function() {
                    function t(e) {
                        n(this, t), this.renderer = e
                    }
                    return t.prototype.render = function(t) {
                        var e = this.renderer,
                            r = e.context,
                            n = t.worldAlpha,
                            i = t.transform.worldTransform,
                            o = e.resolution;
                        this._prevTint !== this.tint && (this.dirty = !0), r.setTransform(i.a * o, i.b * o, i.c * o, i.d * o, i.tx * o, i.ty * o), t.dirty && (this.updateGraphicsTint(t), t.dirty = !1), e.setBlendMode(t.blendMode);
                        for (var a = 0; a < t.graphicsData.length; a++) {
                            var u = t.graphicsData[a],
                                h = u.shape,
                                l = u._fillTint,
                                c = u._lineTint;
                            if (r.lineWidth = u.lineWidth, u.type === s.SHAPES.POLY) {
                                r.beginPath(), this.renderPolygon(h.points, h.closed, r);
                                for (var d = 0; d < u.holes.length; d++) this.renderPolygon(u.holes[d].points, !0, r);
                                u.fill && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke())
                            } else if (u.type === s.SHAPES.RECT)(u.fillColor || 0 === u.fillColor) && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fillRect(h.x, h.y, h.width, h.height)), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.strokeRect(h.x, h.y, h.width, h.height));
                            else if (u.type === s.SHAPES.CIRC) r.beginPath(), r.arc(h.x, h.y, h.radius, 0, 2 * Math.PI), r.closePath(), u.fill && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke());
                            else if (u.type === s.SHAPES.ELIP) {
                                var f = 2 * h.width,
                                    p = 2 * h.height,
                                    v = h.x - f / 2,
                                    y = h.y - p / 2;
                                r.beginPath();
                                var g = f / 2 * .5522848,
                                    m = p / 2 * .5522848,
                                    _ = v + f,
                                    b = y + p,
                                    x = v + f / 2,
                                    T = y + p / 2;
                                r.moveTo(v, T), r.bezierCurveTo(v, T - m, x - g, y, x, y), r.bezierCurveTo(x + g, y, _, T - m, _, T), r.bezierCurveTo(_, T + m, x + g, b, x, b), r.bezierCurveTo(x - g, b, v, T + m, v, T), r.closePath(), u.fill && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke())
                            } else if (u.type === s.SHAPES.RREC) {
                                var w = h.x,
                                    E = h.y,
                                    S = h.width,
                                    O = h.height,
                                    M = h.radius,
                                    P = Math.min(S, O) / 2 | 0;
                                M = M > P ? P : M, r.beginPath(), r.moveTo(w, E + M), r.lineTo(w, E + O - M), r.quadraticCurveTo(w, E + O, w + M, E + O), r.lineTo(w + S - M, E + O), r.quadraticCurveTo(w + S, E + O, w + S, E + O - M), r.lineTo(w + S, E + M), r.quadraticCurveTo(w + S, E, w + S - M, E), r.lineTo(w + M, E), r.quadraticCurveTo(w, E, w, E + M), r.closePath(), (u.fillColor || 0 === u.fillColor) && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke())
                            }
                        }
                    }, t.prototype.updateGraphicsTint = function(t) {
                        t._prevTint = t.tint;
                        for (var e = (t.tint >> 16 & 255) / 255, r = (t.tint >> 8 & 255) / 255, n = (255 & t.tint) / 255, i = 0; i < t.graphicsData.length; ++i) {
                            var o = t.graphicsData[i],
                                s = 0 | o.fillColor,
                                a = 0 | o.lineColor;
                            o._fillTint = ((s >> 16 & 255) / 255 * e * 255 << 16) + ((s >> 8 & 255) / 255 * r * 255 << 8) + (255 & s) / 255 * n * 255, o._lineTint = ((a >> 16 & 255) / 255 * e * 255 << 16) + ((a >> 8 & 255) / 255 * r * 255 << 8) + (255 & a) / 255 * n * 255
                        }
                    }, t.prototype.renderPolygon = function(t, e, r) {
                        r.moveTo(t[0], t[1]);
                        for (var n = 1; n < t.length / 2; ++n) r.lineTo(t[2 * n], t[2 * n + 1]);
                        e && r.closePath()
                    }, t.prototype.destroy = function() {
                        this.renderer = null
                    }, t
                }();
            r.default = a, o.default.registerPlugin("graphics", a)
        }, {
            "../../const": 46,
            "../../renderers/canvas/CanvasRenderer": 77
        }],
        56: [function(t, e, r) {
            "use strict";

            function n(t, e, r, n, i, o, s, a) {
                var u = arguments.length > 8 && void 0 !== arguments[8] ? arguments[8] : [],
                    h = 0,
                    l = 0,
                    c = 0,
                    d = 0,
                    f = 0;
                u.push(t, e);
                for (var p = 1, v = 0; p <= 20; ++p) v = p / 20, h = 1 - v, l = h * h, c = l * h, d = v * v, f = d * v, u.push(c * t + 3 * l * v * r + 3 * h * d * i + f * s, c * e + 3 * l * v * n + 3 * h * d * o + f * a);
                return u
            }
            r.__esModule = !0, r.default = n
        }, {}],
        57: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../../utils"),
                u = t("../../const"),
                h = t("../../renderers/webgl/utils/ObjectRenderer"),
                l = n(h),
                c = t("../../renderers/webgl/WebGLRenderer"),
                d = n(c),
                f = t("./WebGLGraphicsData"),
                p = n(f),
                v = t("./shaders/PrimitiveShader"),
                y = n(v),
                g = t("./utils/buildPoly"),
                m = n(g),
                _ = t("./utils/buildRectangle"),
                b = n(_),
                x = t("./utils/buildRoundedRectangle"),
                T = n(x),
                w = t("./utils/buildCircle"),
                E = n(w),
                S = function(t) {
                    function e(r) {
                        i(this, e);
                        var n = o(this, t.call(this, r));
                        return n.graphicsDataPool = [], n.primitiveShader = null, n.gl = r.gl, n.CONTEXT_UID = 0, n
                    }
                    return s(e, t), e.prototype.onContextChange = function() {
                        this.gl = this.renderer.gl, this.CONTEXT_UID = this.renderer.CONTEXT_UID, this.primitiveShader = new y.default(this.gl)
                    }, e.prototype.destroy = function() {
                        l.default.prototype.destroy.call(this);
                        for (var t = 0; t < this.graphicsDataPool.length; ++t) this.graphicsDataPool[t].destroy();
                        this.graphicsDataPool = null
                    }, e.prototype.render = function(t) {
                        var e = this.renderer,
                            r = e.gl,
                            n = void 0,
                            i = t._webGL[this.CONTEXT_UID];
                        i && t.dirty === i.dirty || (this.updateGraphics(t), i = t._webGL[this.CONTEXT_UID]);
                        var o = this.primitiveShader;
                        e.bindShader(o), e.state.setBlendMode(t.blendMode);
                        for (var s = 0, u = i.data.length; s < u; s++) {
                            n = i.data[s];
                            var h = n.shader;
                            e.bindShader(h), h.uniforms.translationMatrix = t.transform.worldTransform.toArray(!0), h.uniforms.tint = (0, a.hex2rgb)(t.tint), h.uniforms.alpha = t.worldAlpha, e.bindVao(n.vao), n.nativeLines ? r.drawArrays(r.LINES, 0, n.points.length / 6) : n.vao.draw(r.TRIANGLE_STRIP, n.indices.length)
                        }
                    }, e.prototype.updateGraphics = function(t) {
                        var e = this.renderer.gl,
                            r = t._webGL[this.CONTEXT_UID];
                        if (r || (r = t._webGL[this.CONTEXT_UID] = {
                                lastIndex: 0,
                                data: [],
                                gl: e,
                                clearDirty: -1,
                                dirty: -1
                            }), r.dirty = t.dirty, t.clearDirty !== r.clearDirty) {
                            r.clearDirty = t.clearDirty;
                            for (var n = 0; n < r.data.length; n++) this.graphicsDataPool.push(r.data[n]);
                            r.data.length = 0, r.lastIndex = 0
                        }
                        for (var i = void 0, o = void 0, s = r.lastIndex; s < t.graphicsData.length; s++) {
                            var a = t.graphicsData[s];
                            i = this.getWebGLData(r, 0), a.nativeLines && a.lineWidth && (o = this.getWebGLData(r, 0, !0), r.lastIndex++), a.type === u.SHAPES.POLY && (0, m.default)(a, i, o), a.type === u.SHAPES.RECT ? (0, b.default)(a, i, o) : a.type === u.SHAPES.CIRC || a.type === u.SHAPES.ELIP ? (0, E.default)(a, i, o) : a.type === u.SHAPES.RREC && (0, T.default)(a, i, o), r.lastIndex++
                        }
                        this.renderer.bindVao(null);
                        for (var h = 0; h < r.data.length; h++) i = r.data[h], i.dirty && i.upload()
                    }, e.prototype.getWebGLData = function(t, e, r) {
                        var n = t.data[t.data.length - 1];
                        return (!n || n.nativeLines !== r || n.points.length > 32e4) && (n = this.graphicsDataPool.pop() || new p.default(this.renderer.gl, this.primitiveShader, this.renderer.state.attribsState), n.nativeLines = r, n.reset(e), t.data.push(n)), n.dirty = !0, n
                    }, e
                }(l.default);
            r.default = S, d.default.registerPlugin("graphics", S)
        }, {
            "../../const": 46,
            "../../renderers/webgl/WebGLRenderer": 84,
            "../../renderers/webgl/utils/ObjectRenderer": 94,
            "../../utils": 125,
            "./WebGLGraphicsData": 58,
            "./shaders/PrimitiveShader": 59,
            "./utils/buildCircle": 60,
            "./utils/buildPoly": 62,
            "./utils/buildRectangle": 63,
            "./utils/buildRoundedRectangle": 64
        }],
        58: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("pixi-gl-core"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = function() {
                    function t(e, r, i) {
                        n(this, t), this.gl = e, this.color = [0, 0, 0], this.points = [], this.indices = [], this.buffer = o.default.GLBuffer.createVertexBuffer(e), this.indexBuffer = o.default.GLBuffer.createIndexBuffer(e), this.dirty = !0, this.nativeLines = !1, this.glPoints = null, this.glIndices = null, this.shader = r, this.vao = new o.default.VertexArrayObject(e, i).addIndex(this.indexBuffer).addAttribute(this.buffer, r.attributes.aVertexPosition, e.FLOAT, !1, 24, 0).addAttribute(this.buffer, r.attributes.aColor, e.FLOAT, !1, 24, 8)
                    }
                    return t.prototype.reset = function() {
                        this.points.length = 0, this.indices.length = 0
                    }, t.prototype.upload = function() {
                        this.glPoints = new Float32Array(this.points), this.buffer.upload(this.glPoints), this.glIndices = new Uint16Array(this.indices), this.indexBuffer.upload(this.glIndices), this.dirty = !1
                    }, t.prototype.destroy = function() {
                        this.color = null, this.points = null, this.indices = null, this.vao.destroy(), this.buffer.destroy(), this.indexBuffer.destroy(), this.gl = null, this.buffer = null, this.indexBuffer = null, this.glPoints = null, this.glIndices = null
                    }, t
                }();
            r.default = s
        }, {
            "pixi-gl-core": 15
        }],
        59: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("../../../Shader"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = function(t) {
                    function e(r) {
                        return n(this, e), i(this, t.call(this, r, ["attribute vec2 aVertexPosition;", "attribute vec4 aColor;", "uniform mat3 translationMatrix;", "uniform mat3 projectionMatrix;", "uniform float alpha;", "uniform vec3 tint;", "varying vec4 vColor;", "void main(void){", "   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);", "   vColor = aColor * vec4(tint * alpha, alpha);", "}"].join("\n"), ["varying vec4 vColor;", "void main(void){", "   gl_FragColor = vColor;", "}"].join("\n")))
                    }
                    return o(e, t), e
                }(a.default);
            r.default = u
        }, {
            "../../../Shader": 44
        }],
        60: [function(t, e, r) {
            "use strict";

            function n(t, e, r) {
                var n = t.shape,
                    i = n.x,
                    u = n.y,
                    h = void 0,
                    l = void 0;
                if (t.type === s.SHAPES.CIRC ? (h = n.radius, l = n.radius) : (h = n.width, l = n.height), 0 !== h && 0 !== l) {
                    var c = Math.floor(30 * Math.sqrt(n.radius)) || Math.floor(15 * Math.sqrt(n.width + n.height)),
                        d = 2 * Math.PI / c;
                    if (t.fill) {
                        var f = (0, a.hex2rgb)(t.fillColor),
                            p = t.fillAlpha,
                            v = f[0] * p,
                            y = f[1] * p,
                            g = f[2] * p,
                            m = e.points,
                            _ = e.indices,
                            b = m.length / 6;
                        _.push(b);
                        for (var x = 0; x < c + 1; x++) m.push(i, u, v, y, g, p), m.push(i + Math.sin(d * x) * h, u + Math.cos(d * x) * l, v, y, g, p), _.push(b++, b++);
                        _.push(b - 1)
                    }
                    if (t.lineWidth) {
                        var T = t.points;
                        t.points = [];
                        for (var w = 0; w < c + 1; w++) t.points.push(i + Math.sin(d * w) * h, u + Math.cos(d * w) * l);
                        (0, o.default)(t, e, r), t.points = T
                    }
                }
            }
            r.__esModule = !0, r.default = n;
            var i = t("./buildLine"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = t("../../../const"),
                a = t("../../../utils")
        }, {
            "../../../const": 46,
            "../../../utils": 125,
            "./buildLine": 61
        }],
        61: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                var r = t.points;
                if (0 !== r.length) {
                    var n = new o.Point(r[0], r[1]),
                        i = new o.Point(r[r.length - 2], r[r.length - 1]);
                    if (n.x === i.x && n.y === i.y) {
                        r = r.slice(), r.pop(), r.pop(), i = new o.Point(r[r.length - 2], r[r.length - 1]);
                        var a = i.x + .5 * (n.x - i.x),
                            u = i.y + .5 * (n.y - i.y);
                        r.unshift(a, u), r.push(a, u)
                    }
                    var h = e.points,
                        l = e.indices,
                        c = r.length / 2,
                        d = r.length,
                        f = h.length / 6,
                        p = t.lineWidth / 2,
                        v = (0, s.hex2rgb)(t.lineColor),
                        y = t.lineAlpha,
                        g = v[0] * y,
                        m = v[1] * y,
                        _ = v[2] * y,
                        b = r[0],
                        x = r[1],
                        T = r[2],
                        w = r[3],
                        E = 0,
                        S = 0,
                        O = -(x - w),
                        M = b - T,
                        P = 0,
                        C = 0,
                        R = 0,
                        A = 0,
                        I = Math.sqrt(O * O + M * M);
                    O /= I, M /= I, O *= p, M *= p, h.push(b - O, x - M, g, m, _, y), h.push(b + O, x + M, g, m, _, y);
                    for (var D = 1; D < c - 1; ++D) {
                        b = r[2 * (D - 1)], x = r[2 * (D - 1) + 1], T = r[2 * D], w = r[2 * D + 1], E = r[2 * (D + 1)], S = r[2 * (D + 1) + 1], O = -(x - w), M = b - T, I = Math.sqrt(O * O + M * M), O /= I, M /= I, O *= p, M *= p, P = -(w - S), C = T - E, I = Math.sqrt(P * P + C * C), P /= I, C /= I, P *= p, C *= p;
                        var L = -M + x - (-M + w),
                            N = -O + T - (-O + b),
                            F = (-O + b) * (-M + w) - (-O + T) * (-M + x),
                            B = -C + S - (-C + w),
                            k = -P + T - (-P + E),
                            j = (-P + E) * (-C + w) - (-P + T) * (-C + S),
                            U = L * k - B * N;
                        if (Math.abs(U) < .1) U += 10.1, h.push(T - O, w - M, g, m, _, y), h.push(T + O, w + M, g, m, _, y);
                        else {
                            var X = (N * j - k * F) / U,
                                G = (B * F - L * j) / U;
                            (X - T) * (X - T) + (G - w) * (G - w) > 196 * p * p ? (R = O - P, A = M - C, I = Math.sqrt(R * R + A * A), R /= I, A /= I, R *= p, A *= p, h.push(T - R, w - A), h.push(g, m, _, y), h.push(T + R, w + A), h.push(g, m, _, y), h.push(T - R, w - A), h.push(g, m, _, y), d++) : (h.push(X, G), h.push(g, m, _, y), h.push(T - (X - T), w - (G - w)), h.push(g, m, _, y))
                        }
                    }
                    b = r[2 * (c - 2)], x = r[2 * (c - 2) + 1], T = r[2 * (c - 1)], w = r[2 * (c - 1) + 1], O = -(x - w), M = b - T, I = Math.sqrt(O * O + M * M), O /= I, M /= I, O *= p, M *= p, h.push(T - O, w - M), h.push(g, m, _, y), h.push(T + O, w + M), h.push(g, m, _, y), l.push(f);
                    for (var W = 0; W < d; ++W) l.push(f++);
                    l.push(f - 1)
                }
            }

            function i(t, e) {
                var r = 0,
                    n = t.points;
                if (0 !== n.length) {
                    var i = e.points,
                        o = n.length / 2,
                        a = (0, s.hex2rgb)(t.lineColor),
                        u = t.lineAlpha,
                        h = a[0] * u,
                        l = a[1] * u,
                        c = a[2] * u;
                    for (r = 1; r < o; r++) {
                        var d = n[2 * (r - 1)],
                            f = n[2 * (r - 1) + 1],
                            p = n[2 * r],
                            v = n[2 * r + 1];
                        i.push(d, f), i.push(h, l, c, u), i.push(p, v), i.push(h, l, c, u)
                    }
                }
            }
            r.__esModule = !0, r.default = function(t, e, r) {
                t.nativeLines ? i(t, r) : n(t, e)
            };
            var o = t("../../../math"),
                s = t("../../../utils")
        }, {
            "../../../math": 70,
            "../../../utils": 125
        }],
        62: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e, r) {
                t.points = t.shape.points.slice();
                var n = t.points;
                if (t.fill && n.length >= 6) {
                    for (var i = [], o = t.holes, u = 0; u < o.length; u++) {
                        var l = o[u];
                        i.push(n.length / 2), n = n.concat(l.points)
                    }
                    var c = e.points,
                        d = e.indices,
                        f = n.length / 2,
                        p = (0, a.hex2rgb)(t.fillColor),
                        v = t.fillAlpha,
                        y = p[0] * v,
                        g = p[1] * v,
                        m = p[2] * v,
                        _ = (0, h.default)(n, i, 2);
                    if (!_) return;
                    for (var b = c.length / 6, x = 0; x < _.length; x += 3) d.push(_[x] + b), d.push(_[x] + b), d.push(_[x + 1] + b), d.push(_[x + 2] + b), d.push(_[x + 2] + b);
                    for (var T = 0; T < f; T++) c.push(n[2 * T], n[2 * T + 1], y, g, m, v)
                }
                t.lineWidth > 0 && (0, s.default)(t, e, r)
            }
            r.__esModule = !0, r.default = i;
            var o = t("./buildLine"),
                s = n(o),
                a = t("../../../utils"),
                u = t("earcut"),
                h = n(u)
        }, {
            "../../../utils": 125,
            "./buildLine": 61,
            earcut: 2
        }],
        63: [function(t, e, r) {
            "use strict";

            function n(t, e, r) {
                var n = t.shape,
                    i = n.x,
                    a = n.y,
                    u = n.width,
                    h = n.height;
                if (t.fill) {
                    var l = (0, s.hex2rgb)(t.fillColor),
                        c = t.fillAlpha,
                        d = l[0] * c,
                        f = l[1] * c,
                        p = l[2] * c,
                        v = e.points,
                        y = e.indices,
                        g = v.length / 6;
                    v.push(i, a), v.push(d, f, p, c), v.push(i + u, a), v.push(d, f, p, c), v.push(i, a + h), v.push(d, f, p, c), v.push(i + u, a + h), v.push(d, f, p, c), y.push(g, g, g + 1, g + 2, g + 3, g + 3)
                }
                if (t.lineWidth) {
                    var m = t.points;
                    t.points = [i, a, i + u, a, i + u, a + h, i, a + h, i, a], (0, o.default)(t, e, r), t.points = m
                }
            }
            r.__esModule = !0, r.default = n;
            var i = t("./buildLine"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = t("../../../utils")
        }, {
            "../../../utils": 125,
            "./buildLine": 61
        }],
        64: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e, r) {
                var n = t.shape,
                    i = n.x,
                    o = n.y,
                    a = n.width,
                    h = n.height,
                    d = n.radius,
                    f = [];
                if (f.push(i, o + d), s(i, o + h - d, i, o + h, i + d, o + h, f), s(i + a - d, o + h, i + a, o + h, i + a, o + h - d, f), s(i + a, o + d, i + a, o, i + a - d, o, f), s(i + d, o, i, o, i, o + d + 1e-10, f), t.fill) {
                    for (var p = (0, c.hex2rgb)(t.fillColor), v = t.fillAlpha, y = p[0] * v, g = p[1] * v, m = p[2] * v, _ = e.points, b = e.indices, x = _.length / 6, T = (0, u.default)(f, null, 2), w = 0, E = T.length; w < E; w += 3) b.push(T[w] + x), b.push(T[w] + x), b.push(T[w + 1] + x), b.push(T[w + 2] + x), b.push(T[w + 2] + x);
                    for (var S = 0, O = f.length; S < O; S++) _.push(f[S], f[++S], y, g, m, v)
                }
                if (t.lineWidth) {
                    var M = t.points;
                    t.points = f, (0, l.default)(t, e, r), t.points = M
                }
            }

            function o(t, e, r) {
                return t + (e - t) * r
            }

            function s(t, e, r, n, i, s) {
                for (var a = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : [], u = a, h = 0, l = 0, c = 0, d = 0, f = 0, p = 0, v = 0, y = 0; v <= 20; ++v) y = v / 20, h = o(t, r, y), l = o(e, n, y), c = o(r, i, y), d = o(n, s, y), f = o(h, c, y), p = o(l, d, y), u.push(f, p);
                return u
            }
            r.__esModule = !0, r.default = i;
            var a = t("earcut"),
                u = n(a),
                h = t("./buildLine"),
                l = n(h),
                c = t("../../../utils")
        }, {
            "../../../utils": 125,
            "./buildLine": 61,
            earcut: 2
        }],
        65: [function(t, e, r) {
            "use strict";

            function n(t) {
                if (t && t.__esModule) return t;
                var e = {};
                if (null != t)
                    for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                return e.default = t, e
            }

            function i(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0, r.autoDetectRenderer = r.Application = r.Filter = r.SpriteMaskFilter = r.Quad = r.RenderTarget = r.ObjectRenderer = r.WebGLManager = r.Shader = r.CanvasRenderTarget = r.TextureUvs = r.VideoBaseTexture = r.BaseRenderTexture = r.RenderTexture = r.BaseTexture = r.TextureMatrix = r.Texture = r.Spritesheet = r.CanvasGraphicsRenderer = r.GraphicsRenderer = r.GraphicsData = r.Graphics = r.TextMetrics = r.TextStyle = r.Text = r.SpriteRenderer = r.CanvasTinter = r.CanvasSpriteRenderer = r.Sprite = r.TransformBase = r.TransformStatic = r.Transform = r.Container = r.DisplayObject = r.Bounds = r.glCore = r.WebGLRenderer = r.CanvasRenderer = r.ticker = r.utils = r.settings = void 0;
            var o = t("./const");
            Object.keys(o).forEach(function(t) {
                "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
                    enumerable: !0,
                    get: function() {
                        return o[t]
                    }
                })
            });
            var s = t("./math");
            Object.keys(s).forEach(function(t) {
                "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
                    enumerable: !0,
                    get: function() {
                        return s[t]
                    }
                })
            });
            var a = t("pixi-gl-core");
            Object.defineProperty(r, "glCore", {
                enumerable: !0,
                get: function() {
                    return i(a).default
                }
            });
            var u = t("./display/Bounds");
            Object.defineProperty(r, "Bounds", {
                enumerable: !0,
                get: function() {
                    return i(u).default
                }
            });
            var h = t("./display/DisplayObject");
            Object.defineProperty(r, "DisplayObject", {
                enumerable: !0,
                get: function() {
                    return i(h).default
                }
            });
            var l = t("./display/Container");
            Object.defineProperty(r, "Container", {
                enumerable: !0,
                get: function() {
                    return i(l).default
                }
            });
            var c = t("./display/Transform");
            Object.defineProperty(r, "Transform", {
                enumerable: !0,
                get: function() {
                    return i(c).default
                }
            });
            var d = t("./display/TransformStatic");
            Object.defineProperty(r, "TransformStatic", {
                enumerable: !0,
                get: function() {
                    return i(d).default
                }
            });
            var f = t("./display/TransformBase");
            Object.defineProperty(r, "TransformBase", {
                enumerable: !0,
                get: function() {
                    return i(f).default
                }
            });
            var p = t("./sprites/Sprite");
            Object.defineProperty(r, "Sprite", {
                enumerable: !0,
                get: function() {
                    return i(p).default
                }
            });
            var v = t("./sprites/canvas/CanvasSpriteRenderer");
            Object.defineProperty(r, "CanvasSpriteRenderer", {
                enumerable: !0,
                get: function() {
                    return i(v).default
                }
            });
            var y = t("./sprites/canvas/CanvasTinter");
            Object.defineProperty(r, "CanvasTinter", {
                enumerable: !0,
                get: function() {
                    return i(y).default
                }
            });
            var g = t("./sprites/webgl/SpriteRenderer");
            Object.defineProperty(r, "SpriteRenderer", {
                enumerable: !0,
                get: function() {
                    return i(g).default
                }
            });
            var m = t("./text/Text");
            Object.defineProperty(r, "Text", {
                enumerable: !0,
                get: function() {
                    return i(m).default
                }
            });
            var _ = t("./text/TextStyle");
            Object.defineProperty(r, "TextStyle", {
                enumerable: !0,
                get: function() {
                    return i(_).default
                }
            });
            var b = t("./text/TextMetrics");
            Object.defineProperty(r, "TextMetrics", {
                enumerable: !0,
                get: function() {
                    return i(b).default
                }
            });
            var x = t("./graphics/Graphics");
            Object.defineProperty(r, "Graphics", {
                enumerable: !0,
                get: function() {
                    return i(x).default
                }
            });
            var T = t("./graphics/GraphicsData");
            Object.defineProperty(r, "GraphicsData", {
                enumerable: !0,
                get: function() {
                    return i(T).default
                }
            });
            var w = t("./graphics/webgl/GraphicsRenderer");
            Object.defineProperty(r, "GraphicsRenderer", {
                enumerable: !0,
                get: function() {
                    return i(w).default
                }
            });
            var E = t("./graphics/canvas/CanvasGraphicsRenderer");
            Object.defineProperty(r, "CanvasGraphicsRenderer", {
                enumerable: !0,
                get: function() {
                    return i(E).default
                }
            });
            var S = t("./textures/Spritesheet");
            Object.defineProperty(r, "Spritesheet", {
                enumerable: !0,
                get: function() {
                    return i(S).default
                }
            });
            var O = t("./textures/Texture");
            Object.defineProperty(r, "Texture", {
                enumerable: !0,
                get: function() {
                    return i(O).default
                }
            });
            var M = t("./textures/TextureMatrix");
            Object.defineProperty(r, "TextureMatrix", {
                enumerable: !0,
                get: function() {
                    return i(M).default
                }
            });
            var P = t("./textures/BaseTexture");
            Object.defineProperty(r, "BaseTexture", {
                enumerable: !0,
                get: function() {
                    return i(P).default
                }
            });
            var C = t("./textures/RenderTexture");
            Object.defineProperty(r, "RenderTexture", {
                enumerable: !0,
                get: function() {
                    return i(C).default
                }
            });
            var R = t("./textures/BaseRenderTexture");
            Object.defineProperty(r, "BaseRenderTexture", {
                enumerable: !0,
                get: function() {
                    return i(R).default
                }
            });
            var A = t("./textures/VideoBaseTexture");
            Object.defineProperty(r, "VideoBaseTexture", {
                enumerable: !0,
                get: function() {
                    return i(A).default
                }
            });
            var I = t("./textures/TextureUvs");
            Object.defineProperty(r, "TextureUvs", {
                enumerable: !0,
                get: function() {
                    return i(I).default
                }
            });
            var D = t("./renderers/canvas/utils/CanvasRenderTarget");
            Object.defineProperty(r, "CanvasRenderTarget", {
                enumerable: !0,
                get: function() {
                    return i(D).default
                }
            });
            var L = t("./Shader");
            Object.defineProperty(r, "Shader", {
                enumerable: !0,
                get: function() {
                    return i(L).default
                }
            });
            var N = t("./renderers/webgl/managers/WebGLManager");
            Object.defineProperty(r, "WebGLManager", {
                enumerable: !0,
                get: function() {
                    return i(N).default
                }
            });
            var F = t("./renderers/webgl/utils/ObjectRenderer");
            Object.defineProperty(r, "ObjectRenderer", {
                enumerable: !0,
                get: function() {
                    return i(F).default
                }
            });
            var B = t("./renderers/webgl/utils/RenderTarget");
            Object.defineProperty(r, "RenderTarget", {
                enumerable: !0,
                get: function() {
                    return i(B).default
                }
            });
            var k = t("./renderers/webgl/utils/Quad");
            Object.defineProperty(r, "Quad", {
                enumerable: !0,
                get: function() {
                    return i(k).default
                }
            });
            var j = t("./renderers/webgl/filters/spriteMask/SpriteMaskFilter");
            Object.defineProperty(r, "SpriteMaskFilter", {
                enumerable: !0,
                get: function() {
                    return i(j).default
                }
            });
            var U = t("./renderers/webgl/filters/Filter");
            Object.defineProperty(r, "Filter", {
                enumerable: !0,
                get: function() {
                    return i(U).default
                }
            });
            var X = t("./Application");
            Object.defineProperty(r, "Application", {
                enumerable: !0,
                get: function() {
                    return i(X).default
                }
            });
            var G = t("./autoDetectRenderer");
            Object.defineProperty(r, "autoDetectRenderer", {
                enumerable: !0,
                get: function() {
                    return G.autoDetectRenderer
                }
            });
            var W = t("./utils"),
                H = n(W),
                Y = t("./ticker"),
                V = n(Y),
                z = t("./settings"),
                q = i(z),
                K = t("./renderers/canvas/CanvasRenderer"),
                Z = i(K),
                J = t("./renderers/webgl/WebGLRenderer"),
                Q = i(J);
            r.settings = q.default, r.utils = H, r.ticker = V, r.CanvasRenderer = Z.default, r.WebGLRenderer = Q.default
        }, {
            "./Application": 43,
            "./Shader": 44,
            "./autoDetectRenderer": 45,
            "./const": 46,
            "./display/Bounds": 47,
            "./display/Container": 48,
            "./display/DisplayObject": 49,
            "./display/Transform": 50,
            "./display/TransformBase": 51,
            "./display/TransformStatic": 52,
            "./graphics/Graphics": 53,
            "./graphics/GraphicsData": 54,
            "./graphics/canvas/CanvasGraphicsRenderer": 55,
            "./graphics/webgl/GraphicsRenderer": 57,
            "./math": 70,
            "./renderers/canvas/CanvasRenderer": 77,
            "./renderers/canvas/utils/CanvasRenderTarget": 79,
            "./renderers/webgl/WebGLRenderer": 84,
            "./renderers/webgl/filters/Filter": 86,
            "./renderers/webgl/filters/spriteMask/SpriteMaskFilter": 89,
            "./renderers/webgl/managers/WebGLManager": 93,
            "./renderers/webgl/utils/ObjectRenderer": 94,
            "./renderers/webgl/utils/Quad": 95,
            "./renderers/webgl/utils/RenderTarget": 96,
            "./settings": 101,
            "./sprites/Sprite": 102,
            "./sprites/canvas/CanvasSpriteRenderer": 103,
            "./sprites/canvas/CanvasTinter": 104,
            "./sprites/webgl/SpriteRenderer": 106,
            "./text/Text": 108,
            "./text/TextMetrics": 109,
            "./text/TextStyle": 110,
            "./textures/BaseRenderTexture": 111,
            "./textures/BaseTexture": 112,
            "./textures/RenderTexture": 113,
            "./textures/Spritesheet": 114,
            "./textures/Texture": 115,
            "./textures/TextureMatrix": 116,
            "./textures/TextureUvs": 117,
            "./textures/VideoBaseTexture": 118,
            "./ticker": 121,
            "./utils": 125,
            "pixi-gl-core": 15
        }],
        66: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t < 0 ? -1 : t > 0 ? 1 : 0
            }
            r.__esModule = !0;
            var i = t("./Matrix"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = [1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1, 0, 1],
                a = [0, 1, 1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1],
                u = [0, -1, -1, -1, 0, 1, 1, 1, 0, 1, 1, 1, 0, -1, -1, -1],
                h = [1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, 1, 1, 1, 0, -1],
                l = [],
                c = [];
            ! function() {
                for (var t = 0; t < 16; t++) {
                    var e = [];
                    c.push(e);
                    for (var r = 0; r < 16; r++)
                        for (var i = n(s[t] * s[r] + u[t] * a[r]), d = n(a[t] * s[r] + h[t] * a[r]), f = n(s[t] * u[r] + u[t] * h[r]), p = n(a[t] * u[r] + h[t] * h[r]), v = 0; v < 16; v++)
                            if (s[v] === i && a[v] === d && u[v] === f && h[v] === p) {
                                e.push(v);
                                break
                            }
                }
                for (var y = 0; y < 16; y++) {
                    var g = new o.default;
                    g.set(s[y], a[y], u[y], h[y], 0, 0), l.push(g)
                }
            }();
            var d = {
                E: 0,
                SE: 1,
                S: 2,
                SW: 3,
                W: 4,
                NW: 5,
                N: 6,
                NE: 7,
                MIRROR_VERTICAL: 8,
                MIRROR_HORIZONTAL: 12,
                uX: function(t) {
                    return s[t]
                },
                uY: function(t) {
                    return a[t]
                },
                vX: function(t) {
                    return u[t]
                },
                vY: function(t) {
                    return h[t]
                },
                inv: function(t) {
                    return 8 & t ? 15 & t : 7 & -t
                },
                add: function(t, e) {
                    return c[t][e]
                },
                sub: function(t, e) {
                    return c[t][d.inv(e)]
                },
                rotate180: function(t) {
                    return 4 ^ t
                },
                isVertical: function(t) {
                    return 2 == (3 & t)
                },
                byDirection: function(t, e) {
                    return 2 * Math.abs(t) <= Math.abs(e) ? e >= 0 ? d.S : d.N : 2 * Math.abs(e) <= Math.abs(t) ? t > 0 ? d.E : d.W : e > 0 ? t > 0 ? d.SE : d.SW : t > 0 ? d.NE : d.NW
                },
                matrixAppendRotationInv: function(t, e) {
                    var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
                        n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0,
                        i = l[d.inv(e)];
                    i.tx = r, i.ty = n, t.append(i)
                }
            };
            r.default = d
        }, {
            "./Matrix": 67
        }],
        67: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = t("./Point"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = t("../const"),
                u = function() {
                    function t() {
                        var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1,
                            r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
                            i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
                            o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 1,
                            s = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 0,
                            a = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : 0;
                        n(this, t), this.a = e, this.b = r, this.c = i, this.d = o, this.tx = s, this.ty = a, this.array = null
                    }
                    return t.prototype.fromArray = function(t) {
                        this.a = t[0], this.b = t[1], this.c = t[3], this.d = t[4], this.tx = t[2], this.ty = t[5]
                    }, t.prototype.set = function(t, e, r, n, i, o) {
                        return this.a = t, this.b = e, this.c = r, this.d = n, this.tx = i, this.ty = o, this
                    }, t.prototype.toArray = function(t, e) {
                        this.array || (this.array = new Float32Array(9));
                        var r = e || this.array;
                        return t ? (r[0] = this.a, r[1] = this.b, r[2] = 0, r[3] = this.c, r[4] = this.d, r[5] = 0, r[6] = this.tx, r[7] = this.ty, r[8] = 1) : (r[0] = this.a, r[1] = this.c, r[2] = this.tx, r[3] = this.b, r[4] = this.d, r[5] = this.ty, r[6] = 0, r[7] = 0, r[8] = 1), r
                    }, t.prototype.apply = function(t, e) {
                        e = e || new s.default;
                        var r = t.x,
                            n = t.y;
                        return e.x = this.a * r + this.c * n + this.tx, e.y = this.b * r + this.d * n + this.ty, e
                    }, t.prototype.applyInverse = function(t, e) {
                        e = e || new s.default;
                        var r = 1 / (this.a * this.d + this.c * -this.b),
                            n = t.x,
                            i = t.y;
                        return e.x = this.d * r * n + -this.c * r * i + (this.ty * this.c - this.tx * this.d) * r, e.y = this.a * r * i + -this.b * r * n + (-this.ty * this.a + this.tx * this.b) * r, e
                    }, t.prototype.translate = function(t, e) {
                        return this.tx += t, this.ty += e, this
                    }, t.prototype.scale = function(t, e) {
                        return this.a *= t, this.d *= e, this.c *= t, this.b *= e, this.tx *= t, this.ty *= e, this
                    }, t.prototype.rotate = function(t) {
                        var e = Math.cos(t),
                            r = Math.sin(t),
                            n = this.a,
                            i = this.c,
                            o = this.tx;
                        return this.a = n * e - this.b * r, this.b = n * r + this.b * e, this.c = i * e - this.d * r, this.d = i * r + this.d * e, this.tx = o * e - this.ty * r, this.ty = o * r + this.ty * e, this
                    }, t.prototype.append = function(t) {
                        var e = this.a,
                            r = this.b,
                            n = this.c,
                            i = this.d;
                        return this.a = t.a * e + t.b * n, this.b = t.a * r + t.b * i, this.c = t.c * e + t.d * n, this.d = t.c * r + t.d * i, this.tx = t.tx * e + t.ty * n + this.tx, this.ty = t.tx * r + t.ty * i + this.ty, this
                    }, t.prototype.setTransform = function(t, e, r, n, i, o, s, a, u) {
                        return this.a = Math.cos(s + u) * i, this.b = Math.sin(s + u) * i, this.c = -Math.sin(s - a) * o, this.d = Math.cos(s - a) * o, this.tx = t - (r * this.a + n * this.c), this.ty = e - (r * this.b + n * this.d), this
                    }, t.prototype.prepend = function(t) {
                        var e = this.tx;
                        if (1 !== t.a || 0 !== t.b || 0 !== t.c || 1 !== t.d) {
                            var r = this.a,
                                n = this.c;
                            this.a = r * t.a + this.b * t.c, this.b = r * t.b + this.b * t.d, this.c = n * t.a + this.d * t.c, this.d = n * t.b + this.d * t.d
                        }
                        return this.tx = e * t.a + this.ty * t.c + t.tx, this.ty = e * t.b + this.ty * t.d + t.ty, this
                    }, t.prototype.decompose = function(t) {
                        var e = this.a,
                            r = this.b,
                            n = this.c,
                            i = this.d,
                            o = -Math.atan2(-n, i),
                            s = Math.atan2(r, e),
                            u = Math.abs(o + s);
                        return u < 1e-5 || Math.abs(a.PI_2 - u) < 1e-5 ? (t.rotation = s, e < 0 && i >= 0 && (t.rotation += t.rotation <= 0 ? Math.PI : -Math.PI), t.skew.x = t.skew.y = 0) : (t.rotation = 0, t.skew.x = o, t.skew.y = s), t.scale.x = Math.sqrt(e * e + r * r), t.scale.y = Math.sqrt(n * n + i * i), t.position.x = this.tx, t.position.y = this.ty, t
                    }, t.prototype.invert = function() {
                        var t = this.a,
                            e = this.b,
                            r = this.c,
                            n = this.d,
                            i = this.tx,
                            o = t * n - e * r;
                        return this.a = n / o, this.b = -e / o, this.c = -r / o, this.d = t / o, this.tx = (r * this.ty - n * i) / o, this.ty = -(t * this.ty - e * i) / o, this
                    }, t.prototype.identity = function() {
                        return this.a = 1, this.b = 0, this.c = 0, this.d = 1, this.tx = 0, this.ty = 0, this
                    }, t.prototype.clone = function() {
                        var e = new t;
                        return e.a = this.a, e.b = this.b, e.c = this.c, e.d = this.d, e.tx = this.tx, e.ty = this.ty, e
                    }, t.prototype.copy = function(t) {
                        return t.a = this.a, t.b = this.b, t.c = this.c, t.d = this.d, t.tx = this.tx, t.ty = this.ty, t
                    }, i(t, null, [{
                        key: "IDENTITY",
                        get: function() {
                            return new t
                        }
                    }, {
                        key: "TEMP_MATRIX",
                        get: function() {
                            return new t
                        }
                    }]), t
                }();
            r.default = u
        }, {
            "../const": 46,
            "./Point": 69
        }],
        68: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = function() {
                    function t(e, r) {
                        var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
                            o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
                        n(this, t), this._x = i, this._y = o, this.cb = e, this.scope = r
                    }
                    return t.prototype.set = function(t, e) {
                        var r = t || 0,
                            n = e || (0 !== e ? r : 0);
                        this._x === r && this._y === n || (this._x = r, this._y = n, this.cb.call(this.scope))
                    }, t.prototype.copy = function(t) {
                        this._x === t.x && this._y === t.y || (this._x = t.x, this._y = t.y, this.cb.call(this.scope))
                    }, i(t, [{
                        key: "x",
                        get: function() {
                            return this._x
                        },
                        set: function(t) {
                            this._x !== t && (this._x = t, this.cb.call(this.scope))
                        }
                    }, {
                        key: "y",
                        get: function() {
                            return this._y
                        },
                        set: function(t) {
                            this._y !== t && (this._y = t, this.cb.call(this.scope))
                        }
                    }]), t
                }();
            r.default = o
        }, {}],
        69: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                        r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0;
                    n(this, t), this.x = e, this.y = r
                }
                return t.prototype.clone = function() {
                    return new t(this.x, this.y)
                }, t.prototype.copy = function(t) {
                    this.set(t.x, t.y)
                }, t.prototype.equals = function(t) {
                    return t.x === this.x && t.y === this.y
                }, t.prototype.set = function(t, e) {
                    this.x = t || 0, this.y = e || (0 !== e ? this.x : 0)
                }, t
            }();
            r.default = i
        }, {}],
        70: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./Point");
            Object.defineProperty(r, "Point", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./ObservablePoint");
            Object.defineProperty(r, "ObservablePoint", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            });
            var s = t("./Matrix");
            Object.defineProperty(r, "Matrix", {
                enumerable: !0,
                get: function() {
                    return n(s).default
                }
            });
            var a = t("./GroupD8");
            Object.defineProperty(r, "GroupD8", {
                enumerable: !0,
                get: function() {
                    return n(a).default
                }
            });
            var u = t("./shapes/Circle");
            Object.defineProperty(r, "Circle", {
                enumerable: !0,
                get: function() {
                    return n(u).default
                }
            });
            var h = t("./shapes/Ellipse");
            Object.defineProperty(r, "Ellipse", {
                enumerable: !0,
                get: function() {
                    return n(h).default
                }
            });
            var l = t("./shapes/Polygon");
            Object.defineProperty(r, "Polygon", {
                enumerable: !0,
                get: function() {
                    return n(l).default
                }
            });
            var c = t("./shapes/Rectangle");
            Object.defineProperty(r, "Rectangle", {
                enumerable: !0,
                get: function() {
                    return n(c).default
                }
            });
            var d = t("./shapes/RoundedRectangle");
            Object.defineProperty(r, "RoundedRectangle", {
                enumerable: !0,
                get: function() {
                    return n(d).default
                }
            })
        }, {
            "./GroupD8": 66,
            "./Matrix": 67,
            "./ObservablePoint": 68,
            "./Point": 69,
            "./shapes/Circle": 71,
            "./shapes/Ellipse": 72,
            "./shapes/Polygon": 73,
            "./shapes/Rectangle": 74,
            "./shapes/RoundedRectangle": 75
        }],
        71: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("./Rectangle"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = t("../../const"),
                a = function() {
                    function t() {
                        var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
                            i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0;
                        n(this, t), this.x = e, this.y = r, this.radius = i, this.type = s.SHAPES.CIRC
                    }
                    return t.prototype.clone = function() {
                        return new t(this.x, this.y, this.radius)
                    }, t.prototype.contains = function(t, e) {
                        if (this.radius <= 0) return !1;
                        var r = this.radius * this.radius,
                            n = this.x - t,
                            i = this.y - e;
                        return n *= n, i *= i, n + i <= r
                    }, t.prototype.getBounds = function() {
                        return new o.default(this.x - this.radius, this.y - this.radius, 2 * this.radius, 2 * this.radius)
                    }, t
                }();
            r.default = a
        }, {
            "../../const": 46,
            "./Rectangle": 74
        }],
        72: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("./Rectangle"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = t("../../const"),
                a = function() {
                    function t() {
                        var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
                            i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
                            o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
                        n(this, t), this.x = e, this.y = r, this.width = i, this.height = o, this.type = s.SHAPES.ELIP
                    }
                    return t.prototype.clone = function() {
                        return new t(this.x, this.y, this.width, this.height)
                    }, t.prototype.contains = function(t, e) {
                        if (this.width <= 0 || this.height <= 0) return !1;
                        var r = (t - this.x) / this.width,
                            n = (e - this.y) / this.height;
                        return r *= r, n *= n, r + n <= 1
                    }, t.prototype.getBounds = function() {
                        return new o.default(this.x - this.width, this.y - this.height, this.width, this.height)
                    }, t
                }();
            r.default = a
        }, {
            "../../const": 46,
            "./Rectangle": 74
        }],
        73: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../Point"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = t("../../const"),
                a = function() {
                    function t() {
                        for (var e = arguments.length, r = Array(e), i = 0; i < e; i++) r[i] = arguments[i];
                        if (n(this, t), Array.isArray(r[0]) && (r = r[0]), r[0] instanceof o.default) {
                            for (var a = [], u = 0, h = r.length; u < h; u++) a.push(r[u].x, r[u].y);
                            r = a
                        }
                        this.closed = !0, this.points = r, this.type = s.SHAPES.POLY
                    }
                    return t.prototype.clone = function() {
                        return new t(this.points.slice())
                    }, t.prototype.close = function() {
                        var t = this.points;
                        t[0] === t[t.length - 2] && t[1] === t[t.length - 1] || t.push(t[0], t[1])
                    }, t.prototype.contains = function(t, e) {
                        for (var r = !1, n = this.points.length / 2, i = 0, o = n - 1; i < n; o = i++) {
                            var s = this.points[2 * i],
                                a = this.points[2 * i + 1],
                                u = this.points[2 * o],
                                h = this.points[2 * o + 1];
                            a > e != h > e && t < (e - a) / (h - a) * (u - s) + s && (r = !r)
                        }
                        return r
                    }, t
                }();
            r.default = a
        }, {
            "../../const": 46,
            "../Point": 69
        }],
        74: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = t("../../const"),
                s = function() {
                    function t() {
                        var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
                            i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
                            s = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
                        n(this, t), this.x = Number(e), this.y = Number(r), this.width = Number(i), this.height = Number(s), this.type = o.SHAPES.RECT
                    }
                    return t.prototype.clone = function() {
                        return new t(this.x, this.y, this.width, this.height)
                    }, t.prototype.copy = function(t) {
                        return this.x = t.x, this.y = t.y, this.width = t.width, this.height = t.height, this
                    }, t.prototype.contains = function(t, e) {
                        return !(this.width <= 0 || this.height <= 0) && (t >= this.x && t < this.x + this.width && e >= this.y && e < this.y + this.height)
                    }, t.prototype.pad = function(t, e) {
                        t = t || 0, e = e || (0 !== e ? t : 0), this.x -= t, this.y -= e, this.width += 2 * t, this.height += 2 * e
                    }, t.prototype.fit = function(t) {
                        this.x < t.x && (this.width += this.x, this.width < 0 && (this.width = 0), this.x = t.x), this.y < t.y && (this.height += this.y, this.height < 0 && (this.height = 0), this.y = t.y), this.x + this.width > t.x + t.width && (this.width = t.width - this.x, this.width < 0 && (this.width = 0)), this.y + this.height > t.y + t.height && (this.height = t.height - this.y, this.height < 0 && (this.height = 0))
                    }, t.prototype.enlarge = function(t) {
                        var e = Math.min(this.x, t.x),
                            r = Math.max(this.x + this.width, t.x + t.width),
                            n = Math.min(this.y, t.y),
                            i = Math.max(this.y + this.height, t.y + t.height);
                        this.x = e, this.width = r - e, this.y = n, this.height = i - n
                    }, i(t, [{
                        key: "left",
                        get: function() {
                            return this.x
                        }
                    }, {
                        key: "right",
                        get: function() {
                            return this.x + this.width
                        }
                    }, {
                        key: "top",
                        get: function() {
                            return this.y
                        }
                    }, {
                        key: "bottom",
                        get: function() {
                            return this.y + this.height
                        }
                    }], [{
                        key: "EMPTY",
                        get: function() {
                            return new t(0, 0, 0, 0)
                        }
                    }]), t
                }();
            r.default = s
        }, {
            "../../const": 46
        }],
        75: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../const"),
                o = function() {
                    function t() {
                        var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
                            o = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
                            s = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0,
                            a = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 20;
                        n(this, t), this.x = e, this.y = r, this.width = o, this.height = s, this.radius = a, this.type = i.SHAPES.RREC
                    }
                    return t.prototype.clone = function() {
                        return new t(this.x, this.y, this.width, this.height, this.radius)
                    }, t.prototype.contains = function(t, e) {
                        if (this.width <= 0 || this.height <= 0) return !1;
                        if (t >= this.x && t <= this.x + this.width && e >= this.y && e <= this.y + this.height) {
                            if (e >= this.y + this.radius && e <= this.y + this.height - this.radius || t >= this.x + this.radius && t <= this.x + this.width - this.radius) return !0;
                            var r = t - (this.x + this.radius),
                                n = e - (this.y + this.radius),
                                i = this.radius * this.radius;
                            if (r * r + n * n <= i) return !0;
                            if ((r = t - (this.x + this.width - this.radius)) * r + n * n <= i) return !0;
                            if (n = e - (this.y + this.height - this.radius), r * r + n * n <= i) return !0;
                            if ((r = t - (this.x + this.radius)) * r + n * n <= i) return !0
                        }
                        return !1
                    }, t
                }();
            r.default = o
        }, {
            "../../const": 46
        }],
        76: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("../utils"),
                h = t("../math"),
                l = t("../const"),
                c = t("../settings"),
                d = n(c),
                f = t("../display/Container"),
                p = n(f),
                v = t("../textures/RenderTexture"),
                y = n(v),
                g = t("eventemitter3"),
                m = n(g),
                _ = new h.Matrix,
                b = function(t) {
                    function e(r, n, s, a) {
                        i(this, e);
                        var c = o(this, t.call(this));
                        return (0, u.sayHello)(r), "number" == typeof n && (n = Object.assign({
                            width: n,
                            height: s || d.default.RENDER_OPTIONS.height
                        }, a)), n = Object.assign({}, d.default.RENDER_OPTIONS, n), c.options = n, c.type = l.RENDERER_TYPE.UNKNOWN, c.screen = new h.Rectangle(0, 0, n.width, n.height), c.view = n.view || document.createElement("canvas"), c.resolution = n.resolution || d.default.RESOLUTION, c.transparent = n.transparent, c.autoResize = n.autoResize || !1, c.blendModes = null, c.preserveDrawingBuffer = n.preserveDrawingBuffer, c.clearBeforeRender = n.clearBeforeRender, c.roundPixels = n.roundPixels, c._backgroundColor = 0, c._backgroundColorRgba = [0, 0, 0, 0], c._backgroundColorString = "#000000", c.backgroundColor = n.backgroundColor || c._backgroundColor, c._tempDisplayObjectParent = new p.default, c._lastObjectRendered = c._tempDisplayObjectParent, c
                    }
                    return s(e, t), e.prototype.resize = function(t, e) {
                        this.screen.width = t, this.screen.height = e, this.view.width = t * this.resolution, this.view.height = e * this.resolution, this.autoResize && (this.view.style.width = t + "px", this.view.style.height = e + "px")
                    }, e.prototype.generateTexture = function(t, e, r, n) {
                        n = n || t.getLocalBounds();
                        var i = y.default.create(0 | n.width, 0 | n.height, e, r);
                        return _.tx = -n.x, _.ty = -n.y, this.render(t, i, !1, _, !0), i
                    }, e.prototype.destroy = function(t) {
                        t && this.view.parentNode && this.view.parentNode.removeChild(this.view), this.type = l.RENDERER_TYPE.UNKNOWN, this.view = null, this.screen = null, this.resolution = 0, this.transparent = !1, this.autoResize = !1, this.blendModes = null, this.options = null, this.preserveDrawingBuffer = !1, this.clearBeforeRender = !1, this.roundPixels = !1, this._backgroundColor = 0, this._backgroundColorRgba = null, this._backgroundColorString = null, this._tempDisplayObjectParent = null, this._lastObjectRendered = null
                    }, a(e, [{
                        key: "width",
                        get: function() {
                            return this.view.width
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return this.view.height
                        }
                    }, {
                        key: "backgroundColor",
                        get: function() {
                            return this._backgroundColor
                        },
                        set: function(t) {
                            this._backgroundColor = t, this._backgroundColorString = (0, u.hex2string)(t), (0, u.hex2rgb)(t, this._backgroundColorRgba)
                        }
                    }]), e
                }(m.default);
            r.default = b
        }, {
            "../const": 46,
            "../display/Container": 48,
            "../math": 70,
            "../settings": 101,
            "../textures/RenderTexture": 113,
            "../utils": 125,
            eventemitter3: 3
        }],
        77: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../SystemRenderer"),
                u = n(a),
                h = t("./utils/CanvasMaskManager"),
                l = n(h),
                c = t("./utils/CanvasRenderTarget"),
                d = n(c),
                f = t("./utils/mapCanvasBlendModesToPixi"),
                p = n(f),
                v = t("../../utils"),
                y = t("../../const"),
                g = t("../../settings"),
                m = n(g),
                _ = function(t) {
                    function e(r, n, s) {
                        i(this, e);
                        var a = o(this, t.call(this, "Canvas", r, n, s));
                        return a.type = y.RENDERER_TYPE.CANVAS, a.rootContext = a.view.getContext("2d", {
                            alpha: a.transparent
                        }), a.context = a.rootContext, a.refresh = !0, a.maskManager = new l.default(a), a.smoothProperty = "imageSmoothingEnabled", a.rootContext.imageSmoothingEnabled || (a.rootContext.webkitImageSmoothingEnabled ? a.smoothProperty = "webkitImageSmoothingEnabled" : a.rootContext.mozImageSmoothingEnabled ? a.smoothProperty = "mozImageSmoothingEnabled" : a.rootContext.oImageSmoothingEnabled ? a.smoothProperty = "oImageSmoothingEnabled" : a.rootContext.msImageSmoothingEnabled && (a.smoothProperty = "msImageSmoothingEnabled")), a.initPlugins(), a.blendModes = (0, p.default)(), a._activeBlendMode = null, a.renderingToScreen = !1, a.resize(a.options.width, a.options.height), a
                    }
                    return s(e, t), e.prototype.render = function(t, e, r, n, i) {
                        if (this.view) {
                            this.renderingToScreen = !e, this.emit("prerender");
                            var o = this.resolution;
                            e ? (e = e.baseTexture || e, e._canvasRenderTarget || (e._canvasRenderTarget = new d.default(e.width, e.height, e.resolution), e.source = e._canvasRenderTarget.canvas, e.valid = !0), this.context = e._canvasRenderTarget.context, this.resolution = e._canvasRenderTarget.resolution) : this.context = this.rootContext;
                            var s = this.context;
                            if (e || (this._lastObjectRendered = t), !i) {
                                var a = t.parent,
                                    u = this._tempDisplayObjectParent.transform.worldTransform;
                                n ? (n.copy(u), this._tempDisplayObjectParent.transform._worldID = -1) : u.identity(), t.parent = this._tempDisplayObjectParent, t.updateTransform(), t.parent = a
                            }
                            s.save(), s.setTransform(1, 0, 0, 1, 0, 0), s.globalAlpha = 1, this._activeBlendMode = y.BLEND_MODES.NORMAL, s.globalCompositeOperation = this.blendModes[y.BLEND_MODES.NORMAL], navigator.isCocoonJS && this.view.screencanvas && (s.fillStyle = "black", s.clear()), (void 0 !== r ? r : this.clearBeforeRender) && this.renderingToScreen && (this.transparent ? s.clearRect(0, 0, this.width, this.height) : (s.fillStyle = this._backgroundColorString, s.fillRect(0, 0, this.width, this.height)));
                            var h = this.context;
                            this.context = s, t.renderCanvas(this), this.context = h, s.restore(), this.resolution = o, this.emit("postrender")
                        }
                    }, e.prototype.clear = function(t) {
                        var e = this.context;
                        t = t || this._backgroundColorString, !this.transparent && t ? (e.fillStyle = t, e.fillRect(0, 0, this.width, this.height)) : e.clearRect(0, 0, this.width, this.height)
                    }, e.prototype.setBlendMode = function(t) {
                        this._activeBlendMode !== t && (this._activeBlendMode = t, this.context.globalCompositeOperation = this.blendModes[t])
                    }, e.prototype.destroy = function(e) {
                        this.destroyPlugins(), t.prototype.destroy.call(this, e), this.context = null, this.refresh = !0, this.maskManager.destroy(), this.maskManager = null, this.smoothProperty = null
                    }, e.prototype.resize = function(e, r) {
                        t.prototype.resize.call(this, e, r), this.smoothProperty && (this.rootContext[this.smoothProperty] = m.default.SCALE_MODE === y.SCALE_MODES.LINEAR)
                    }, e.prototype.invalidateBlendMode = function() {
                        this._activeBlendMode = this.blendModes.indexOf(this.context.globalCompositeOperation)
                    }, e
                }(u.default);
            r.default = _, v.pluginTarget.mixin(_)
        }, {
            "../../const": 46,
            "../../settings": 101,
            "../../utils": 125,
            "../SystemRenderer": 76,
            "./utils/CanvasMaskManager": 78,
            "./utils/CanvasRenderTarget": 79,
            "./utils/mapCanvasBlendModesToPixi": 81
        }],
        78: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../../const"),
                o = function() {
                    function t(e) {
                        n(this, t), this.renderer = e
                    }
                    return t.prototype.pushMask = function(t) {
                        var e = this.renderer;
                        e.context.save();
                        var r = t.alpha,
                            n = t.transform.worldTransform,
                            i = e.resolution;
                        e.context.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i, n.ty * i), t._texture || (this.renderGraphicsShape(t), e.context.clip()), t.worldAlpha = r
                    }, t.prototype.renderGraphicsShape = function(t) {
                        var e = this.renderer.context,
                            r = t.graphicsData.length;
                        if (0 !== r) {
                            e.beginPath();
                            for (var n = 0; n < r; n++) {
                                var o = t.graphicsData[n],
                                    s = o.shape;
                                if (o.type === i.SHAPES.POLY) {
                                    var a = s.points;
                                    e.moveTo(a[0], a[1]);
                                    for (var u = 1; u < a.length / 2; u++) e.lineTo(a[2 * u], a[2 * u + 1]);
                                    a[0] === a[a.length - 2] && a[1] === a[a.length - 1] && e.closePath()
                                } else if (o.type === i.SHAPES.RECT) e.rect(s.x, s.y, s.width, s.height), e.closePath();
                                else if (o.type === i.SHAPES.CIRC) e.arc(s.x, s.y, s.radius, 0, 2 * Math.PI), e.closePath();
                                else if (o.type === i.SHAPES.ELIP) {
                                    var h = 2 * s.width,
                                        l = 2 * s.height,
                                        c = s.x - h / 2,
                                        d = s.y - l / 2,
                                        f = h / 2 * .5522848,
                                        p = l / 2 * .5522848,
                                        v = c + h,
                                        y = d + l,
                                        g = c + h / 2,
                                        m = d + l / 2;
                                    e.moveTo(c, m), e.bezierCurveTo(c, m - p, g - f, d, g, d), e.bezierCurveTo(g + f, d, v, m - p, v, m), e.bezierCurveTo(v, m + p, g + f, y, g, y), e.bezierCurveTo(g - f, y, c, m + p, c, m), e.closePath()
                                } else if (o.type === i.SHAPES.RREC) {
                                    var _ = s.x,
                                        b = s.y,
                                        x = s.width,
                                        T = s.height,
                                        w = s.radius,
                                        E = Math.min(x, T) / 2 | 0;
                                    w = w > E ? E : w, e.moveTo(_, b + w), e.lineTo(_, b + T - w), e.quadraticCurveTo(_, b + T, _ + w, b + T), e.lineTo(_ + x - w, b + T), e.quadraticCurveTo(_ + x, b + T, _ + x, b + T - w), e.lineTo(_ + x, b + w), e.quadraticCurveTo(_ + x, b, _ + x - w, b), e.lineTo(_ + w, b), e.quadraticCurveTo(_, b, _, b + w), e.closePath()
                                }
                            }
                        }
                    }, t.prototype.popMask = function(t) {
                        t.context.restore(), t.invalidateBlendMode()
                    }, t.prototype.destroy = function() {}, t
                }();
            r.default = o
        }, {
            "../../../const": 46
        }],
        79: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = t("../../../settings"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = function() {
                    function t(e, r, i) {
                        n(this, t), this.canvas = document.createElement("canvas"), this.context = this.canvas.getContext("2d"), this.resolution = i || s.default.RESOLUTION, this.resize(e, r)
                    }
                    return t.prototype.clear = function() {
                        this.context.setTransform(1, 0, 0, 1, 0, 0), this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)
                    }, t.prototype.resize = function(t, e) {
                        this.canvas.width = t * this.resolution, this.canvas.height = e * this.resolution
                    }, t.prototype.destroy = function() {
                        this.context = null, this.canvas = null
                    }, i(t, [{
                        key: "width",
                        get: function() {
                            return this.canvas.width
                        },
                        set: function(t) {
                            this.canvas.width = t
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return this.canvas.height
                        },
                        set: function(t) {
                            this.canvas.height = t
                        }
                    }]), t
                }();
            r.default = a
        }, {
            "../../../settings": 101
        }],
        80: [function(t, e, r) {
            "use strict";

            function n(t) {
                var e = document.createElement("canvas");
                e.width = 6, e.height = 1;
                var r = e.getContext("2d");
                return r.fillStyle = t, r.fillRect(0, 0, 6, 1), e
            }

            function i() {
                if ("undefined" == typeof document) return !1;
                var t = n("#ff00ff"),
                    e = n("#ffff00"),
                    r = document.createElement("canvas");
                r.width = 6, r.height = 1;
                var i = r.getContext("2d");
                i.globalCompositeOperation = "multiply", i.drawImage(t, 0, 0), i.drawImage(e, 2, 0);
                var o = i.getImageData(2, 0, 1, 1);
                if (!o) return !1;
                var s = o.data;
                return 255 === s[0] && 0 === s[1] && 0 === s[2]
            }
            r.__esModule = !0, r.default = i
        }, {}],
        81: [function(t, e, r) {
            "use strict";

            function n() {
                var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];
                return (0, s.default)() ? (t[i.BLEND_MODES.NORMAL] = "source-over", t[i.BLEND_MODES.ADD] = "lighter", t[i.BLEND_MODES.MULTIPLY] = "multiply", t[i.BLEND_MODES.SCREEN] = "screen", t[i.BLEND_MODES.OVERLAY] = "overlay", t[i.BLEND_MODES.DARKEN] = "darken", t[i.BLEND_MODES.LIGHTEN] = "lighten", t[i.BLEND_MODES.COLOR_DODGE] = "color-dodge", t[i.BLEND_MODES.COLOR_BURN] = "color-burn", t[i.BLEND_MODES.HARD_LIGHT] = "hard-light", t[i.BLEND_MODES.SOFT_LIGHT] = "soft-light", t[i.BLEND_MODES.DIFFERENCE] = "difference", t[i.BLEND_MODES.EXCLUSION] = "exclusion", t[i.BLEND_MODES.HUE] = "hue", t[i.BLEND_MODES.SATURATION] = "saturate", t[i.BLEND_MODES.COLOR] = "color", t[i.BLEND_MODES.LUMINOSITY] = "luminosity") : (t[i.BLEND_MODES.NORMAL] = "source-over", t[i.BLEND_MODES.ADD] = "lighter", t[i.BLEND_MODES.MULTIPLY] = "source-over", t[i.BLEND_MODES.SCREEN] = "source-over", t[i.BLEND_MODES.OVERLAY] = "source-over", t[i.BLEND_MODES.DARKEN] = "source-over", t[i.BLEND_MODES.LIGHTEN] = "source-over", t[i.BLEND_MODES.COLOR_DODGE] = "source-over", t[i.BLEND_MODES.COLOR_BURN] = "source-over", t[i.BLEND_MODES.HARD_LIGHT] = "source-over", t[i.BLEND_MODES.SOFT_LIGHT] = "source-over", t[i.BLEND_MODES.DIFFERENCE] = "source-over", t[i.BLEND_MODES.EXCLUSION] = "source-over", t[i.BLEND_MODES.HUE] = "source-over", t[i.BLEND_MODES.SATURATION] = "source-over", t[i.BLEND_MODES.COLOR] = "source-over", t[i.BLEND_MODES.LUMINOSITY] = "source-over"), t[i.BLEND_MODES.NORMAL_NPM] = t[i.BLEND_MODES.NORMAL], t[i.BLEND_MODES.ADD_NPM] = t[i.BLEND_MODES.ADD], t[i.BLEND_MODES.SCREEN_NPM] = t[i.BLEND_MODES.SCREEN], t
            }
            r.__esModule = !0, r.default = n;
            var i = t("../../../const"),
                o = t("./canUseNewCanvasBlendModes"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o)
        }, {
            "../../../const": 46,
            "./canUseNewCanvasBlendModes": 80
        }],
        82: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../const"),
                o = t("../../settings"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = function() {
                    function t(e) {
                        n(this, t), this.renderer = e, this.count = 0, this.checkCount = 0, this.maxIdle = s.default.GC_MAX_IDLE, this.checkCountMax = s.default.GC_MAX_CHECK_COUNT, this.mode = s.default.GC_MODE
                    }
                    return t.prototype.update = function() {
                        this.count++, this.mode !== i.GC_MODES.MANUAL && ++this.checkCount > this.checkCountMax && (this.checkCount = 0, this.run())
                    }, t.prototype.run = function() {
                        for (var t = this.renderer.textureManager, e = t._managedTextures, r = !1, n = 0; n < e.length; n++) {
                            var i = e[n];
                            !i._glRenderTargets && this.count - i.touched > this.maxIdle && (t.destroyTexture(i, !0), e[n] = null, r = !0)
                        }
                        if (r) {
                            for (var o = 0, s = 0; s < e.length; s++) null !== e[s] && (e[o++] = e[s]);
                            e.length = o
                        }
                    }, t.prototype.unload = function(t) {
                        var e = this.renderer.textureManager;
                        t._texture && t._texture._glRenderTargets && e.destroyTexture(t._texture, !0);
                        for (var r = t.children.length - 1; r >= 0; r--) this.unload(t.children[r])
                    }, t
                }();
            r.default = a
        }, {
            "../../const": 46,
            "../../settings": 101
        }],
        83: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("pixi-gl-core"),
                o = t("../../const"),
                s = t("./utils/RenderTarget"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = t("../../utils"),
                h = function() {
                    function t(e) {
                        n(this, t), this.renderer = e, this.gl = e.gl, this._managedTextures = []
                    }
                    return t.prototype.bindTexture = function() {}, t.prototype.getTexture = function() {}, t.prototype.updateTexture = function(t, e) {
                        var r = this.gl,
                            n = !!t._glRenderTargets;
                        if (!t.hasLoaded) return null;
                        var s = this.renderer.boundTextures;
                        if (void 0 === e) {
                            e = 0;
                            for (var u = 0; u < s.length; ++u)
                                if (s[u] === t) {
                                    e = u;
                                    break
                                }
                        }
                        s[e] = t, r.activeTexture(r.TEXTURE0 + e);
                        var h = t._glTextures[this.renderer.CONTEXT_UID];
                        if (h) n ? t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width, t.height) : h.upload(t.source);
                        else {
                            if (n) {
                                var l = new a.default(this.gl, t.width, t.height, t.scaleMode, t.resolution);
                                l.resize(t.width, t.height), t._glRenderTargets[this.renderer.CONTEXT_UID] = l, h = l.texture
                            } else h = new i.GLTexture(this.gl, null, null, null, null), h.bind(e), h.premultiplyAlpha = !0, h.upload(t.source);
                            t._glTextures[this.renderer.CONTEXT_UID] = h, t.on("update", this.updateTexture, this), t.on("dispose", this.destroyTexture, this), this._managedTextures.push(t), t.isPowerOfTwo ? (t.mipmap && h.enableMipmap(), t.wrapMode === o.WRAP_MODES.CLAMP ? h.enableWrapClamp() : t.wrapMode === o.WRAP_MODES.REPEAT ? h.enableWrapRepeat() : h.enableWrapMirrorRepeat()) : h.enableWrapClamp(), t.scaleMode === o.SCALE_MODES.NEAREST ? h.enableNearestScaling() : h.enableLinearScaling()
                        }
                        return h
                    }, t.prototype.destroyTexture = function(t, e) {
                        if (t = t.baseTexture || t, t.hasLoaded) {
                            var r = this.renderer.CONTEXT_UID,
                                n = t._glTextures,
                                i = t._glRenderTargets;
                            if (n[r] && (this.renderer.unbindTexture(t), n[r].destroy(), t.off("update", this.updateTexture, this), t.off("dispose", this.destroyTexture, this), delete n[r], !e)) {
                                var o = this._managedTextures.indexOf(t); - 1 !== o && (0, u.removeItems)(this._managedTextures, o, 1)
                            }
                            i && i[r] && (i[r].destroy(), delete i[r])
                        }
                    }, t.prototype.removeAll = function() {
                        for (var t = 0; t < this._managedTextures.length; ++t) {
                            var e = this._managedTextures[t];
                            e._glTextures[this.renderer.CONTEXT_UID] && delete e._glTextures[this.renderer.CONTEXT_UID]
                        }
                    }, t.prototype.destroy = function() {
                        for (var t = 0; t < this._managedTextures.length; ++t) {
                            var e = this._managedTextures[t];
                            this.destroyTexture(e, !0), e.off("update", this.updateTexture, this), e.off("dispose", this.destroyTexture, this)
                        }
                        this._managedTextures = null
                    }, t
                }();
            r.default = h
        }, {
            "../../const": 46,
            "../../utils": 125,
            "./utils/RenderTarget": 96,
            "pixi-gl-core": 15
        }],
        84: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../SystemRenderer"),
                u = n(a),
                h = t("./managers/MaskManager"),
                l = n(h),
                c = t("./managers/StencilManager"),
                d = n(c),
                f = t("./managers/FilterManager"),
                p = n(f),
                v = t("./utils/RenderTarget"),
                y = n(v),
                g = t("./utils/ObjectRenderer"),
                m = n(g),
                _ = t("./TextureManager"),
                b = n(_),
                x = t("../../textures/BaseTexture"),
                T = n(x),
                w = t("./TextureGarbageCollector"),
                E = n(w),
                S = t("./WebGLState"),
                O = n(S),
                M = t("./utils/mapWebGLDrawModesToPixi"),
                P = n(M),
                C = t("./utils/validateContext"),
                R = n(C),
                A = t("../../utils"),
                I = t("pixi-gl-core"),
                D = n(I),
                L = t("../../const"),
                N = 0,
                F = function(t) {
                    function e(r, n, s) {
                        i(this, e);
                        var a = o(this, t.call(this, "WebGL", r, n, s));
                        return a.legacy = a.options.legacy, a.legacy && (D.default.VertexArrayObject.FORCE_NATIVE = !0), a.type = L.RENDERER_TYPE.WEBGL, a.handleContextLost = a.handleContextLost.bind(a), a.handleContextRestored = a.handleContextRestored.bind(a), a.view.addEventListener("webglcontextlost", a.handleContextLost, !1), a.view.addEventListener("webglcontextrestored", a.handleContextRestored, !1), a._contextOptions = {
                            alpha: a.transparent,
                            antialias: a.options.antialias,
                            premultipliedAlpha: a.transparent && "notMultiplied" !== a.transparent,
                            stencil: !0,
                            preserveDrawingBuffer: a.options.preserveDrawingBuffer,
                            powerPreference: a.options.powerPreference
                        }, a._backgroundColorRgba[3] = a.transparent ? 0 : 1, a.maskManager = new l.default(a), a.stencilManager = new d.default(a), a.emptyRenderer = new m.default(a), a.currentRenderer = a.emptyRenderer, a.textureManager = null, a.filterManager = null, a.initPlugins(), a.options.context && (0, R.default)(a.options.context), a.gl = a.options.context || D.default.createContext(a.view, a._contextOptions), a.CONTEXT_UID = N++, a.state = new O.default(a.gl), a.renderingToScreen = !0, a.boundTextures = null, a._activeShader = null, a._activeVao = null, a._activeRenderTarget = null, a._initContext(), a.drawModes = (0, P.default)(a.gl), a._nextTextureLocation = 0, a.setBlendMode(0), a
                    }
                    return s(e, t), e.prototype._initContext = function() {
                        var t = this.gl;
                        t.isContextLost() && t.getExtension("WEBGL_lose_context") && t.getExtension("WEBGL_lose_context").restoreContext();
                        var e = t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);
                        this._activeShader = null, this._activeVao = null, this.boundTextures = new Array(e), this.emptyTextures = new Array(e), this.textureManager = new b.default(this), this.filterManager = new p.default(this), this.textureGC = new E.default(this), this.state.resetToDefault(), this.rootRenderTarget = new y.default(t, this.width, this.height, null, this.resolution, !0), this.rootRenderTarget.clearColor = this._backgroundColorRgba, this.bindRenderTarget(this.rootRenderTarget);
                        var r = new D.default.GLTexture.fromData(t, null, 1, 1),
                            n = {
                                _glTextures: {}
                            };
                        n._glTextures[this.CONTEXT_UID] = {};
                        for (var i = 0; i < e; i++) {
                            var o = new T.default;
                            o._glTextures[this.CONTEXT_UID] = r, this.boundTextures[i] = n, this.emptyTextures[i] = o, this.bindTexture(null, i)
                        }
                        this.emit("context", t), this.resize(this.screen.width, this.screen.height)
                    }, e.prototype.render = function(t, e, r, n, i) {
                        if (this.renderingToScreen = !e, this.emit("prerender"), this.gl && !this.gl.isContextLost()) {
                            if (this._nextTextureLocation = 0, e || (this._lastObjectRendered = t), !i) {
                                var o = t.parent;
                                t.parent = this._tempDisplayObjectParent, t.updateTransform(), t.parent = o
                            }
                            this.bindRenderTexture(e, n), this.currentRenderer.start(), (void 0 !== r ? r : this.clearBeforeRender) && this._activeRenderTarget.clear(), t.renderWebGL(this), this.currentRenderer.flush(), this.textureGC.update(), this.emit("postrender")
                        }
                    }, e.prototype.setObjectRenderer = function(t) {
                        this.currentRenderer !== t && (this.currentRenderer.stop(), this.currentRenderer = t, this.currentRenderer.start())
                    }, e.prototype.flush = function() {
                        this.setObjectRenderer(this.emptyRenderer)
                    }, e.prototype.resize = function(t, e) {
                        u.default.prototype.resize.call(this, t, e), this.rootRenderTarget.resize(t, e), this._activeRenderTarget === this.rootRenderTarget && (this.rootRenderTarget.activate(), this._activeShader && (this._activeShader.uniforms.projectionMatrix = this.rootRenderTarget.projectionMatrix.toArray(!0)))
                    }, e.prototype.setBlendMode = function(t) {
                        this.state.setBlendMode(t)
                    }, e.prototype.clear = function(t) {
                        this._activeRenderTarget.clear(t)
                    }, e.prototype.setTransform = function(t) {
                        this._activeRenderTarget.transform = t
                    }, e.prototype.clearRenderTexture = function(t, e) {
                        var r = t.baseTexture,
                            n = r._glRenderTargets[this.CONTEXT_UID];
                        return n && n.clear(e), this
                    }, e.prototype.bindRenderTexture = function(t, e) {
                        var r = void 0;
                        if (t) {
                            var n = t.baseTexture;
                            n._glRenderTargets[this.CONTEXT_UID] || this.textureManager.updateTexture(n, 0), this.unbindTexture(n), r = n._glRenderTargets[this.CONTEXT_UID], r.setFrame(t.frame)
                        } else r = this.rootRenderTarget;
                        return r.transform = e, this.bindRenderTarget(r), this
                    }, e.prototype.bindRenderTarget = function(t) {
                        return t !== this._activeRenderTarget && (this._activeRenderTarget = t, t.activate(), this._activeShader && (this._activeShader.uniforms.projectionMatrix = t.projectionMatrix.toArray(!0)), this.stencilManager.setMaskStack(t.stencilMaskStack)), this
                    }, e.prototype.bindShader = function(t, e) {
                        return this._activeShader !== t && (this._activeShader = t, t.bind(), !1 !== e && (t.uniforms.projectionMatrix = this._activeRenderTarget.projectionMatrix.toArray(!0))), this
                    }, e.prototype.bindTexture = function(t, e, r) {
                        if (t = t || this.emptyTextures[e], t = t.baseTexture || t, t.touched = this.textureGC.count, r) e = e || 0;
                        else {
                            for (var n = 0; n < this.boundTextures.length; n++)
                                if (this.boundTextures[n] === t) return n;
                            void 0 === e && (this._nextTextureLocation++, this._nextTextureLocation %= this.boundTextures.length, e = this.boundTextures.length - this._nextTextureLocation - 1)
                        }
                        var i = this.gl,
                            o = t._glTextures[this.CONTEXT_UID];
                        return o ? (this.boundTextures[e] = t, i.activeTexture(i.TEXTURE0 + e), i.bindTexture(i.TEXTURE_2D, o.texture)) : this.textureManager.updateTexture(t, e), e
                    }, e.prototype.unbindTexture = function(t) {
                        var e = this.gl;
                        t = t.baseTexture || t;
                        for (var r = 0; r < this.boundTextures.length; r++) this.boundTextures[r] === t && (this.boundTextures[r] = this.emptyTextures[r], e.activeTexture(e.TEXTURE0 + r), e.bindTexture(e.TEXTURE_2D, this.emptyTextures[r]._glTextures[this.CONTEXT_UID].texture));
                        return this
                    }, e.prototype.createVao = function() {
                        return new D.default.VertexArrayObject(this.gl, this.state.attribState)
                    }, e.prototype.bindVao = function(t) {
                        return this._activeVao === t ? this : (t ? t.bind() : this._activeVao && this._activeVao.unbind(), this._activeVao = t, this)
                    }, e.prototype.reset = function() {
                        this.setObjectRenderer(this.emptyRenderer), this.bindVao(null), this._activeShader = null, this._activeRenderTarget = this.rootRenderTarget;
                        for (var t = 0; t < this.boundTextures.length; t++) this.boundTextures[t] = this.emptyTextures[t];
                        return this.rootRenderTarget.activate(), this.state.resetToDefault(), this
                    }, e.prototype.handleContextLost = function(t) {
                        t.preventDefault()
                    }, e.prototype.handleContextRestored = function() {
                        this.textureManager.removeAll(), this.filterManager.destroy(!0), this._initContext()
                    }, e.prototype.destroy = function(e) {
                        this.destroyPlugins(), this.view.removeEventListener("webglcontextlost", this.handleContextLost), this.view.removeEventListener("webglcontextrestored", this.handleContextRestored), this.textureManager.destroy(), t.prototype.destroy.call(this, e), this.uid = 0, this.maskManager.destroy(), this.stencilManager.destroy(), this.filterManager.destroy(), this.maskManager = null, this.filterManager = null, this.textureManager = null, this.currentRenderer = null, this.handleContextLost = null, this.handleContextRestored = null, this._contextOptions = null, this.gl.useProgram(null), this.gl.getExtension("WEBGL_lose_context") && this.gl.getExtension("WEBGL_lose_context").loseContext(), this.gl = null
                    }, e
                }(u.default);
            r.default = F, A.pluginTarget.mixin(F)
        }, {
            "../../const": 46,
            "../../textures/BaseTexture": 112,
            "../../utils": 125,
            "../SystemRenderer": 76,
            "./TextureGarbageCollector": 82,
            "./TextureManager": 83,
            "./WebGLState": 85,
            "./managers/FilterManager": 90,
            "./managers/MaskManager": 91,
            "./managers/StencilManager": 92,
            "./utils/ObjectRenderer": 94,
            "./utils/RenderTarget": 96,
            "./utils/mapWebGLDrawModesToPixi": 99,
            "./utils/validateContext": 100,
            "pixi-gl-core": 15
        }],
        85: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("./utils/mapWebGLBlendModesToPixi"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = function() {
                    function t(e) {
                        n(this, t), this.activeState = new Uint8Array(16), this.defaultState = new Uint8Array(16), this.defaultState[0] = 1, this.stackIndex = 0, this.stack = [], this.gl = e, this.maxAttribs = e.getParameter(e.MAX_VERTEX_ATTRIBS), this.attribState = {
                            tempAttribState: new Array(this.maxAttribs),
                            attribState: new Array(this.maxAttribs)
                        }, this.blendModes = (0, o.default)(e), this.nativeVaoExtension = e.getExtension("OES_vertex_array_object") || e.getExtension("MOZ_OES_vertex_array_object") || e.getExtension("WEBKIT_OES_vertex_array_object")
                    }
                    return t.prototype.push = function() {
                        var t = this.stack[this.stackIndex];
                        t || (t = this.stack[this.stackIndex] = new Uint8Array(16)), ++this.stackIndex;
                        for (var e = 0; e < this.activeState.length; e++) t[e] = this.activeState[e]
                    }, t.prototype.pop = function() {
                        var t = this.stack[--this.stackIndex];
                        this.setState(t)
                    }, t.prototype.setState = function(t) {
                        this.setBlend(t[0]), this.setDepthTest(t[1]), this.setFrontFace(t[2]), this.setCullFace(t[3]), this.setBlendMode(t[4])
                    }, t.prototype.setBlend = function(t) {
                        t = t ? 1 : 0, this.activeState[0] !== t && (this.activeState[0] = t, this.gl[t ? "enable" : "disable"](this.gl.BLEND))
                    }, t.prototype.setBlendMode = function(t) {
                        if (t !== this.activeState[4]) {
                            this.activeState[4] = t;
                            var e = this.blendModes[t];
                            2 === e.length ? this.gl.blendFunc(e[0], e[1]) : this.gl.blendFuncSeparate(e[0], e[1], e[2], e[3])
                        }
                    }, t.prototype.setDepthTest = function(t) {
                        t = t ? 1 : 0, this.activeState[1] !== t && (this.activeState[1] = t, this.gl[t ? "enable" : "disable"](this.gl.DEPTH_TEST))
                    }, t.prototype.setCullFace = function(t) {
                        t = t ? 1 : 0, this.activeState[3] !== t && (this.activeState[3] = t, this.gl[t ? "enable" : "disable"](this.gl.CULL_FACE))
                    }, t.prototype.setFrontFace = function(t) {
                        t = t ? 1 : 0, this.activeState[2] !== t && (this.activeState[2] = t, this.gl.frontFace(this.gl[t ? "CW" : "CCW"]))
                    }, t.prototype.resetAttributes = function() {
                        for (var t = 0; t < this.attribState.tempAttribState.length; t++) this.attribState.tempAttribState[t] = 0;
                        for (var e = 0; e < this.attribState.attribState.length; e++) this.attribState.attribState[e] = 0;
                        for (var r = 1; r < this.maxAttribs; r++) this.gl.disableVertexAttribArray(r)
                    }, t.prototype.resetToDefault = function() {
                        this.nativeVaoExtension && this.nativeVaoExtension.bindVertexArrayOES(null), this.resetAttributes();
                        for (var t = 0; t < this.activeState.length; ++t) this.activeState[t] = 32;
                        this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, !1), this.setState(this.defaultState)
                    }, t
                }();
            r.default = s
        }, {
            "./utils/mapWebGLBlendModesToPixi": 98
        }],
        86: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                s = t("./extractUniformsFromSrc"),
                a = n(s),
                u = t("../../../utils"),
                h = t("../../../const"),
                l = t("../../../settings"),
                c = n(l),
                d = {},
                f = function() {
                    function t(e, r, n) {
                        i(this, t), this.vertexSrc = e || t.defaultVertexSrc, this.fragmentSrc = r || t.defaultFragmentSrc, this._blendMode = h.BLEND_MODES.NORMAL, this.uniformData = n || (0, a.default)(this.vertexSrc, this.fragmentSrc, "projectionMatrix|uSampler"), this.uniforms = {};
                        for (var o in this.uniformData) this.uniforms[o] = this.uniformData[o].value, this.uniformData[o].type && (this.uniformData[o].type = this.uniformData[o].type.toLowerCase());
                        this.glShaders = {}, d[this.vertexSrc + this.fragmentSrc] || (d[this.vertexSrc + this.fragmentSrc] = (0, u.uid)()), this.glShaderKey = d[this.vertexSrc + this.fragmentSrc], this.padding = 4, this.resolution = c.default.FILTER_RESOLUTION, this.enabled = !0, this.autoFit = !0
                    }
                    return t.prototype.apply = function(t, e, r, n, i) {
                        t.applyFilter(this, e, r, n)
                    }, o(t, [{
                        key: "blendMode",
                        get: function() {
                            return this._blendMode
                        },
                        set: function(t) {
                            this._blendMode = t
                        }
                    }], [{
                        key: "defaultVertexSrc",
                        get: function() {
                            return ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "uniform mat3 projectionMatrix;", "uniform mat3 filterMatrix;", "varying vec2 vTextureCoord;", "varying vec2 vFilterCoord;", "void main(void){", "   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);", "   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;", "   vTextureCoord = aTextureCoord ;", "}"].join("\n")
                        }
                    }, {
                        key: "defaultFragmentSrc",
                        get: function() {
                            return ["varying vec2 vTextureCoord;", "varying vec2 vFilterCoord;", "uniform sampler2D uSampler;", "uniform sampler2D filterSampler;", "void main(void){", "   vec4 masky = texture2D(filterSampler, vFilterCoord);", "   vec4 sample = texture2D(uSampler, vTextureCoord);", "   vec4 color;", "   if(mod(vFilterCoord.x, 1.0) > 0.5)", "   {", "     color = vec4(1.0, 0.0, 0.0, 1.0);", "   }", "   else", "   {", "     color = vec4(0.0, 1.0, 0.0, 1.0);", "   }", "   gl_FragColor = mix(sample, masky, 0.5);", "   gl_FragColor *= sample.a;", "}"].join("\n")
                        }
                    }]), t
                }();
            r.default = f
        }, {
            "../../../const": 46,
            "../../../settings": 101,
            "../../../utils": 125,
            "./extractUniformsFromSrc": 87
        }],
        87: [function(t, e, r) {
            "use strict";

            function n(t, e, r) {
                var n = i(t),
                    o = i(e);
                return Object.assign(n, o)
            }

            function i(t) {
                for (var e = new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"), r = {}, n = void 0, i = t.replace(/\s+/g, " ").split(/\s*;\s*/), o = 0; o < i.length; o++) {
                    var s = i[o].trim();
                    if (s.indexOf("uniform") > -1) {
                        var u = s.split(" "),
                            h = u[1],
                            l = u[2],
                            c = 1;
                        l.indexOf("[") > -1 && (n = l.split(/\[|]/), l = n[0], c *= Number(n[1])), l.match(e) || (r[l] = {
                            value: a(h, c),
                            name: l,
                            type: h
                        })
                    }
                }
                return r
            }
            r.__esModule = !0, r.default = n;
            var o = t("pixi-gl-core"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = s.default.shader.defaultValue
        }, {
            "pixi-gl-core": 15
        }],
        88: [function(t, e, r) {
            "use strict";

            function n(t, e, r) {
                var n = t.identity();
                return n.translate(e.x / r.width, e.y / r.height), n.scale(r.width, r.height), n
            }

            function i(t, e, r) {
                var n = t.identity();
                n.translate(e.x / r.width, e.y / r.height);
                var i = r.width / e.width,
                    o = r.height / e.height;
                return n.scale(i, o), n
            }

            function o(t, e, r, n) {
                var i = n._texture.orig,
                    o = t.set(r.width, 0, 0, r.height, e.x, e.y),
                    a = n.worldTransform.copy(s.Matrix.TEMP_MATRIX);
                return a.invert(), o.prepend(a), o.scale(1 / i.width, 1 / i.height), o.translate(n.anchor.x, n.anchor.y), o
            }
            r.__esModule = !0, r.calculateScreenSpaceMatrix = n, r.calculateNormalizedScreenSpaceMatrix = i, r.calculateSpriteMatrix = o;
            var s = t("../../../math")
        }, {
            "../../../math": 70
        }],
        89: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../Filter"),
                u = n(a),
                h = t("../../../../math"),
                l = (t("path"), t("../../../../textures/TextureMatrix")),
                c = n(l),
                d = function(t) {
                    function e(r) {
                        i(this, e);
                        var n = new h.Matrix,
                            s = o(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n", "varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));
                        return r.renderable = !1, s.maskSprite = r, s.maskMatrix = n, s
                    }
                    return s(e, t), e.prototype.apply = function(t, e, r) {
                        var n = this.maskSprite,
                            i = this.maskSprite.texture;
                        i.valid && (i.transform || (i.transform = new c.default(i, 0)), i.transform.update(), this.uniforms.mask = i, this.uniforms.otherMatrix = t.calculateSpriteMatrix(this.maskMatrix, n).prepend(i.transform.mapCoord), this.uniforms.alpha = n.worldAlpha, this.uniforms.maskClamp = i.transform.uClampFrame, t.applyFilter(this, e, r))
                    }, e
                }(u.default);
            r.default = d
        }, {
            "../../../../math": 70,
            "../../../../textures/TextureMatrix": 116,
            "../Filter": 86,
            path: 8
        }],
        90: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }

            function s(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var a = t("./WebGLManager"),
                u = n(a),
                h = t("../utils/RenderTarget"),
                l = n(h),
                c = t("../utils/Quad"),
                d = n(c),
                f = t("../../../math"),
                p = t("../../../Shader"),
                v = n(p),
                y = t("../filters/filterTransforms"),
                g = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(y),
                m = t("bit-twiddle"),
                _ = n(m),
                b = function t() {
                    s(this, t), this.renderTarget = null, this.sourceFrame = new f.Rectangle, this.destinationFrame = new f.Rectangle, this.filters = [], this.target = null, this.resolution = 1
                },
                x = function(t) {
                    function e(r) {
                        s(this, e);
                        var n = i(this, t.call(this, r));
                        return n.gl = n.renderer.gl, n.quad = new d.default(n.gl, r.state.attribState), n.shaderCache = {}, n.pool = {}, n.filterData = null, n.managedFilters = [], n.renderer.on("prerender", n.onPrerender, n), n._screenWidth = r.view.width, n._screenHeight = r.view.height, n
                    }
                    return o(e, t), e.prototype.pushFilter = function(t, e) {
                        var r = this.renderer,
                            n = this.filterData;
                        if (!n) {
                            n = this.renderer._activeRenderTarget.filterStack;
                            var i = new b;
                            i.sourceFrame = i.destinationFrame = this.renderer._activeRenderTarget.size, i.renderTarget = r._activeRenderTarget, this.renderer._activeRenderTarget.filterData = n = {
                                index: 0,
                                stack: [i]
                            }, this.filterData = n
                        }
                        var o = n.stack[++n.index],
                            s = n.stack[0].destinationFrame;
                        o || (o = n.stack[n.index] = new b);
                        var a = t.filterArea && 0 === t.filterArea.x && 0 === t.filterArea.y && t.filterArea.width === r.screen.width && t.filterArea.height === r.screen.height,
                            u = e[0].resolution,
                            h = 0 | e[0].padding,
                            l = a ? r.screen : t.filterArea || t.getBounds(!0),
                            c = o.sourceFrame,
                            d = o.destinationFrame;
                        c.x = (l.x * u | 0) / u, c.y = (l.y * u | 0) / u, c.width = (l.width * u | 0) / u, c.height = (l.height * u | 0) / u, a || (n.stack[0].renderTarget.transform || e[0].autoFit && c.fit(s), c.pad(h)), d.width = c.width, d.height = c.height;
                        var f = this.getPotRenderTarget(r.gl, c.width, c.height, u);
                        o.target = t, o.filters = e, o.resolution = u, o.renderTarget = f, f.setFrame(d, c), r.bindRenderTarget(f), f.clear()
                    }, e.prototype.popFilter = function() {
                        var t = this.filterData,
                            e = t.stack[t.index - 1],
                            r = t.stack[t.index];
                        this.quad.map(r.renderTarget.size, r.sourceFrame).upload();
                        var n = r.filters;
                        if (1 === n.length) n[0].apply(this, r.renderTarget, e.renderTarget, !1, r), this.freePotRenderTarget(r.renderTarget);
                        else {
                            var i = r.renderTarget,
                                o = this.getPotRenderTarget(this.renderer.gl, r.sourceFrame.width, r.sourceFrame.height, r.resolution);
                            o.setFrame(r.destinationFrame, r.sourceFrame), o.clear();
                            var s = 0;
                            for (s = 0; s < n.length - 1; ++s) {
                                n[s].apply(this, i, o, !0, r);
                                var a = i;
                                i = o, o = a
                            }
                            n[s].apply(this, i, e.renderTarget, !1, r), this.freePotRenderTarget(i), this.freePotRenderTarget(o)
                        }
                        0 === --t.index && (this.filterData = null)
                    }, e.prototype.applyFilter = function(t, e, r, n) {
                        var i = this.renderer,
                            o = i.gl,
                            s = t.glShaders[i.CONTEXT_UID];
                        s || (t.glShaderKey ? (s = this.shaderCache[t.glShaderKey]) || (s = new v.default(this.gl, t.vertexSrc, t.fragmentSrc), t.glShaders[i.CONTEXT_UID] = this.shaderCache[t.glShaderKey] = s, this.managedFilters.push(t)) : (s = t.glShaders[i.CONTEXT_UID] = new v.default(this.gl, t.vertexSrc, t.fragmentSrc), this.managedFilters.push(t)), i.bindVao(null), this.quad.initVao(s)), i.bindVao(this.quad.vao), i.bindRenderTarget(r), n && (o.disable(o.SCISSOR_TEST), i.clear(), o.enable(o.SCISSOR_TEST)), r === i.maskManager.scissorRenderTarget && i.maskManager.pushScissorMask(null, i.maskManager.scissorData), i.bindShader(s);
                        var a = this.renderer.emptyTextures[0];
                        this.renderer.boundTextures[0] = a, this.syncUniforms(s, t), i.state.setBlendMode(t.blendMode), o.activeTexture(o.TEXTURE0), o.bindTexture(o.TEXTURE_2D, e.texture.texture), this.quad.vao.draw(this.renderer.gl.TRIANGLES, 6, 0), o.bindTexture(o.TEXTURE_2D, a._glTextures[this.renderer.CONTEXT_UID].texture)
                    }, e.prototype.syncUniforms = function(t, e) {
                        var r = e.uniformData,
                            n = e.uniforms,
                            i = 1,
                            o = void 0;
                        if (t.uniforms.filterArea) {
                            o = this.filterData.stack[this.filterData.index];
                            var s = t.uniforms.filterArea;
                            s[0] = o.renderTarget.size.width, s[1] = o.renderTarget.size.height, s[2] = o.sourceFrame.x, s[3] = o.sourceFrame.y, t.uniforms.filterArea = s
                        }
                        if (t.uniforms.filterClamp) {
                            o = o || this.filterData.stack[this.filterData.index];
                            var a = t.uniforms.filterClamp;
                            a[0] = 0, a[1] = 0, a[2] = (o.sourceFrame.width - 1) / o.renderTarget.size.width, a[3] = (o.sourceFrame.height - 1) / o.renderTarget.size.height, t.uniforms.filterClamp = a
                        }
                        for (var u in r) {
                            var h = r[u].type;
                            if ("sampler2d" === h && 0 !== n[u]) {
                                if (n[u].baseTexture) t.uniforms[u] = this.renderer.bindTexture(n[u].baseTexture, i);
                                else {
                                    t.uniforms[u] = i;
                                    var l = this.renderer.gl;
                                    this.renderer.boundTextures[i] = this.renderer.emptyTextures[i], l.activeTexture(l.TEXTURE0 + i), n[u].texture.bind()
                                }
                                i++
                            } else if ("mat3" === h) void 0 !== n[u].a ? t.uniforms[u] = n[u].toArray(!0) : t.uniforms[u] = n[u];
                            else if ("vec2" === h)
                                if (void 0 !== n[u].x) {
                                    var c = t.uniforms[u] || new Float32Array(2);
                                    c[0] = n[u].x, c[1] = n[u].y, t.uniforms[u] = c
                                } else t.uniforms[u] = n[u];
                            else "float" === h ? t.uniforms.data[u].value !== r[u] && (t.uniforms[u] = n[u]) : t.uniforms[u] = n[u]
                        }
                    }, e.prototype.getRenderTarget = function(t, e) {
                        var r = this.filterData.stack[this.filterData.index],
                            n = this.getPotRenderTarget(this.renderer.gl, r.sourceFrame.width, r.sourceFrame.height, e || r.resolution);
                        return n.setFrame(r.destinationFrame, r.sourceFrame), n
                    }, e.prototype.returnRenderTarget = function(t) {
                        this.freePotRenderTarget(t)
                    }, e.prototype.calculateScreenSpaceMatrix = function(t) {
                        var e = this.filterData.stack[this.filterData.index];
                        return g.calculateScreenSpaceMatrix(t, e.sourceFrame, e.renderTarget.size)
                    }, e.prototype.calculateNormalizedScreenSpaceMatrix = function(t) {
                        var e = this.filterData.stack[this.filterData.index];
                        return g.calculateNormalizedScreenSpaceMatrix(t, e.sourceFrame, e.renderTarget.size, e.destinationFrame)
                    }, e.prototype.calculateSpriteMatrix = function(t, e) {
                        var r = this.filterData.stack[this.filterData.index];
                        return g.calculateSpriteMatrix(t, r.sourceFrame, r.renderTarget.size, e)
                    }, e.prototype.destroy = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0],
                            e = this.renderer,
                            r = this.managedFilters;
                        e.off("prerender", this.onPrerender, this);
                        for (var n = 0; n < r.length; n++) t || r[n].glShaders[e.CONTEXT_UID].destroy(), delete r[n].glShaders[e.CONTEXT_UID];
                        this.shaderCache = {}, t ? this.pool = {} : this.emptyPool()
                    }, e.prototype.getPotRenderTarget = function(t, e, r, n) {
                        var i = "screen";
                        e *= n, r *= n, e === this._screenWidth && r === this._screenHeight || (e = _.default.nextPow2(e), r = _.default.nextPow2(r), i = (65535 & e) << 16 | 65535 & r), this.pool[i] || (this.pool[i] = []);
                        var o = this.pool[i].pop();
                        if (!o) {
                            var s = this.renderer.boundTextures[0];
                            t.activeTexture(t.TEXTURE0), o = new l.default(t, e, r, null, 1), t.bindTexture(t.TEXTURE_2D, s._glTextures[this.renderer.CONTEXT_UID].texture)
                        }
                        return o.resolution = n, o.defaultFrame.width = o.size.width = e / n, o.defaultFrame.height = o.size.height = r / n, o
                    }, e.prototype.emptyPool = function() {
                        for (var t in this.pool) {
                            var e = this.pool[t];
                            if (e)
                                for (var r = 0; r < e.length; r++) e[r].destroy(!0)
                        }
                        this.pool = {}
                    }, e.prototype.freePotRenderTarget = function(t) {
                        var e = t.size.width * t.resolution,
                            r = t.size.height * t.resolution,
                            n = "screen";
                        e === this._screenWidth && r === this._screenHeight || (n = (65535 & e) << 16 | 65535 & r), this.pool[n].push(t)
                    }, e.prototype.onPrerender = function() {
                        if (this._screenWidth !== this.renderer.view.width || this._screenHeight !== this.renderer.view.height) {
                            this._screenWidth = this.renderer.view.width, this._screenHeight = this.renderer.view.height;
                            var t = this.pool.screen;
                            if (t)
                                for (var e = 0; e < t.length; e++) t[e].destroy(!0);
                            this.pool.screen = []
                        }
                    }, e
                }(u.default);
            r.default = x
        }, {
            "../../../Shader": 44,
            "../../../math": 70,
            "../filters/filterTransforms": 88,
            "../utils/Quad": 95,
            "../utils/RenderTarget": 96,
            "./WebGLManager": 93,
            "bit-twiddle": 1
        }],
        91: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("./WebGLManager"),
                u = n(a),
                h = t("../filters/spriteMask/SpriteMaskFilter"),
                l = n(h),
                c = function(t) {
                    function e(r) {
                        i(this, e);
                        var n = o(this, t.call(this, r));
                        return n.scissor = !1, n.scissorData = null, n.scissorRenderTarget = null, n.enableScissor = !0, n.alphaMaskPool = [], n.alphaMaskIndex = 0, n
                    }
                    return s(e, t), e.prototype.pushMask = function(t, e) {
                        if (e.texture) this.pushSpriteMask(t, e);
                        else if (this.enableScissor && !this.scissor && this.renderer._activeRenderTarget.root && !this.renderer.stencilManager.stencilMaskStack.length && e.isFastRect()) {
                            var r = e.worldTransform,
                                n = Math.atan2(r.b, r.a);
                            n = Math.round(n * (180 / Math.PI)), n % 90 ? this.pushStencilMask(e) : this.pushScissorMask(t, e)
                        } else this.pushStencilMask(e)
                    }, e.prototype.popMask = function(t, e) {
                        e.texture ? this.popSpriteMask(t, e) : this.enableScissor && !this.renderer.stencilManager.stencilMaskStack.length ? this.popScissorMask(t, e) : this.popStencilMask(t, e)
                    }, e.prototype.pushSpriteMask = function(t, e) {
                        var r = this.alphaMaskPool[this.alphaMaskIndex];
                        r || (r = this.alphaMaskPool[this.alphaMaskIndex] = [new l.default(e)]), r[0].resolution = this.renderer.resolution, r[0].maskSprite = e, t.filterArea = e.getBounds(!0), this.renderer.filterManager.pushFilter(t, r), this.alphaMaskIndex++
                    }, e.prototype.popSpriteMask = function() {
                        this.renderer.filterManager.popFilter(), this.alphaMaskIndex--
                    }, e.prototype.pushStencilMask = function(t) {
                        this.renderer.currentRenderer.stop(), this.renderer.stencilManager.pushStencil(t)
                    }, e.prototype.popStencilMask = function() {
                        this.renderer.currentRenderer.stop(), this.renderer.stencilManager.popStencil()
                    }, e.prototype.pushScissorMask = function(t, e) {
                        e.renderable = !0;
                        var r = this.renderer._activeRenderTarget,
                            n = e.getBounds();
                        n.fit(r.size), e.renderable = !1, this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);
                        var i = this.renderer.resolution;
                        this.renderer.gl.scissor(n.x * i, (r.root ? r.size.height - n.y - n.height : n.y) * i, n.width * i, n.height * i), this.scissorRenderTarget = r, this.scissorData = e, this.scissor = !0
                    }, e.prototype.popScissorMask = function() {
                        this.scissorRenderTarget = null, this.scissorData = null, this.scissor = !1;
                        var t = this.renderer.gl;
                        t.disable(t.SCISSOR_TEST)
                    }, e
                }(u.default);
            r.default = c
        }, {
            "../filters/spriteMask/SpriteMaskFilter": 89,
            "./WebGLManager": 93
        }],
        92: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("./WebGLManager"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = function(t) {
                    function e(r) {
                        n(this, e);
                        var o = i(this, t.call(this, r));
                        return o.stencilMaskStack = null, o
                    }
                    return o(e, t), e.prototype.setMaskStack = function(t) {
                        this.stencilMaskStack = t;
                        var e = this.renderer.gl;
                        0 === t.length ? e.disable(e.STENCIL_TEST) : e.enable(e.STENCIL_TEST)
                    }, e.prototype.pushStencil = function(t) {
                        this.renderer.setObjectRenderer(this.renderer.plugins.graphics), this.renderer._activeRenderTarget.attachStencilBuffer();
                        var e = this.renderer.gl,
                            r = this.stencilMaskStack.length;
                        0 === r && e.enable(e.STENCIL_TEST), this.stencilMaskStack.push(t), e.colorMask(!1, !1, !1, !1), e.stencilFunc(e.EQUAL, r, this._getBitwiseMask()), e.stencilOp(e.KEEP, e.KEEP, e.INCR), this.renderer.plugins.graphics.render(t), this._useCurrent()
                    }, e.prototype.popStencil = function() {
                        this.renderer.setObjectRenderer(this.renderer.plugins.graphics);
                        var t = this.renderer.gl,
                            e = this.stencilMaskStack.pop();
                        0 === this.stencilMaskStack.length ? (t.disable(t.STENCIL_TEST), t.clear(t.STENCIL_BUFFER_BIT), t.clearStencil(0)) : (t.colorMask(!1, !1, !1, !1), t.stencilOp(t.KEEP, t.KEEP, t.DECR), this.renderer.plugins.graphics.render(e), this._useCurrent())
                    }, e.prototype._useCurrent = function() {
                        var t = this.renderer.gl;
                        t.colorMask(!0, !0, !0, !0), t.stencilFunc(t.EQUAL, this.stencilMaskStack.length, this._getBitwiseMask()), t.stencilOp(t.KEEP, t.KEEP, t.KEEP)
                    }, e.prototype._getBitwiseMask = function() {
                        return (1 << this.stencilMaskStack.length) - 1
                    }, e.prototype.destroy = function() {
                        a.default.prototype.destroy.call(this), this.stencilMaskStack.stencilStack = null
                    }, e
                }(a.default);
            r.default = u
        }, {
            "./WebGLManager": 93
        }],
        93: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t(e) {
                    n(this, t), this.renderer = e, this.renderer.on("context", this.onContextChange, this)
                }
                return t.prototype.onContextChange = function() {}, t.prototype.destroy = function() {
                    this.renderer.off("context", this.onContextChange, this), this.renderer = null
                }, t
            }();
            r.default = i
        }, {}],
        94: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("../managers/WebGLManager"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = function(t) {
                    function e() {
                        return n(this, e), i(this, t.apply(this, arguments))
                    }
                    return o(e, t), e.prototype.start = function() {}, e.prototype.stop = function() {
                        this.flush()
                    }, e.prototype.flush = function() {}, e.prototype.render = function(t) {}, e
                }(a.default);
            r.default = u
        }, {
            "../managers/WebGLManager": 93
        }],
        95: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = t("pixi-gl-core"),
                s = n(o),
                a = t("../../../utils/createIndicesForQuads"),
                u = n(a),
                h = function() {
                    function t(e, r) {
                        i(this, t), this.gl = e, this.vertices = new Float32Array([-1, -1, 1, -1, 1, 1, -1, 1]), this.uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]), this.interleaved = new Float32Array(16);
                        for (var n = 0; n < 4; n++) this.interleaved[4 * n] = this.vertices[2 * n], this.interleaved[4 * n + 1] = this.vertices[2 * n + 1], this.interleaved[4 * n + 2] = this.uvs[2 * n], this.interleaved[4 * n + 3] = this.uvs[2 * n + 1];
                        this.indices = (0, u.default)(1), this.vertexBuffer = s.default.GLBuffer.createVertexBuffer(e, this.interleaved, e.STATIC_DRAW), this.indexBuffer = s.default.GLBuffer.createIndexBuffer(e, this.indices, e.STATIC_DRAW), this.vao = new s.default.VertexArrayObject(e, r)
                    }
                    return t.prototype.initVao = function(t) {
                        this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer, t.attributes.aVertexPosition, this.gl.FLOAT, !1, 16, 0).addAttribute(this.vertexBuffer, t.attributes.aTextureCoord, this.gl.FLOAT, !1, 16, 8)
                    }, t.prototype.map = function(t, e) {
                        var r = 0,
                            n = 0;
                        return this.uvs[0] = r, this.uvs[1] = n, this.uvs[2] = r + e.width / t.width, this.uvs[3] = n, this.uvs[4] = r + e.width / t.width, this.uvs[5] = n + e.height / t.height, this.uvs[6] = r, this.uvs[7] = n + e.height / t.height, r = e.x, n = e.y, this.vertices[0] = r, this.vertices[1] = n, this.vertices[2] = r + e.width, this.vertices[3] = n, this.vertices[4] = r + e.width, this.vertices[5] = n + e.height, this.vertices[6] = r, this.vertices[7] = n + e.height, this
                    }, t.prototype.upload = function() {
                        for (var t = 0; t < 4; t++) this.interleaved[4 * t] = this.vertices[2 * t], this.interleaved[4 * t + 1] = this.vertices[2 * t + 1], this.interleaved[4 * t + 2] = this.uvs[2 * t], this.interleaved[4 * t + 3] = this.uvs[2 * t + 1];
                        return this.vertexBuffer.upload(this.interleaved), this
                    }, t.prototype.destroy = function() {
                        var t = this.gl;
                        t.deleteBuffer(this.vertexBuffer), t.deleteBuffer(this.indexBuffer)
                    }, t
                }();
            r.default = h
        }, {
            "../../../utils/createIndicesForQuads": 123,
            "pixi-gl-core": 15
        }],
        96: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../../math"),
                o = t("../../../const"),
                s = t("../../../settings"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = t("pixi-gl-core"),
                h = function() {
                    function t(e, r, s, h, l, c) {
                        n(this, t), this.gl = e, this.frameBuffer = null, this.texture = null, this.clearColor = [0, 0, 0, 0], this.size = new i.Rectangle(0, 0, 1, 1), this.resolution = l || a.default.RESOLUTION, this.projectionMatrix = new i.Matrix, this.transform = null, this.frame = null, this.defaultFrame = new i.Rectangle, this.destinationFrame = null, this.sourceFrame = null, this.stencilBuffer = null, this.stencilMaskStack = [], this.filterData = null, this.scaleMode = void 0 !== h ? h : a.default.SCALE_MODE, this.root = c, this.root ? (this.frameBuffer = new u.GLFramebuffer(e, 100, 100), this.frameBuffer.framebuffer = null) : (this.frameBuffer = u.GLFramebuffer.createRGBA(e, 100, 100), this.scaleMode === o.SCALE_MODES.NEAREST ? this.frameBuffer.texture.enableNearestScaling() : this.frameBuffer.texture.enableLinearScaling(), this.texture = this.frameBuffer.texture), this.setFrame(), this.resize(r, s)
                    }
                    return t.prototype.clear = function(t) {
                        var e = t || this.clearColor;
                        this.frameBuffer.clear(e[0], e[1], e[2], e[3])
                    }, t.prototype.attachStencilBuffer = function() {
                        this.root || this.frameBuffer.enableStencil()
                    }, t.prototype.setFrame = function(t, e) {
                        this.destinationFrame = t || this.destinationFrame || this.defaultFrame, this.sourceFrame = e || this.sourceFrame || this.destinationFrame
                    }, t.prototype.activate = function() {
                        var t = this.gl;
                        this.frameBuffer.bind(), this.calculateProjection(this.destinationFrame, this.sourceFrame), this.transform && this.projectionMatrix.append(this.transform), this.destinationFrame !== this.sourceFrame ? (t.enable(t.SCISSOR_TEST), t.scissor(0 | this.destinationFrame.x, 0 | this.destinationFrame.y, this.destinationFrame.width * this.resolution | 0, this.destinationFrame.height * this.resolution | 0)) : t.disable(t.SCISSOR_TEST), t.viewport(0 | this.destinationFrame.x, 0 | this.destinationFrame.y, this.destinationFrame.width * this.resolution | 0, this.destinationFrame.height * this.resolution | 0)
                    }, t.prototype.calculateProjection = function(t, e) {
                        var r = this.projectionMatrix;
                        e = e || t, r.identity(), this.root ? (r.a = 1 / t.width * 2, r.d = -1 / t.height * 2, r.tx = -1 - e.x * r.a, r.ty = 1 - e.y * r.d) : (r.a = 1 / t.width * 2, r.d = 1 / t.height * 2, r.tx = -1 - e.x * r.a, r.ty = -1 - e.y * r.d)
                    }, t.prototype.resize = function(t, e) {
                        if (t |= 0, e |= 0, this.size.width !== t || this.size.height !== e) {
                            this.size.width = t, this.size.height = e, this.defaultFrame.width = t, this.defaultFrame.height = e, this.frameBuffer.resize(t * this.resolution, e * this.resolution);
                            var r = this.frame || this.size;
                            this.calculateProjection(r)
                        }
                    }, t.prototype.destroy = function() {
                        this.frameBuffer.destroy(), this.frameBuffer = null, this.texture = null
                    }, t
                }();
            r.default = h
        }, {
            "../../../const": 46,
            "../../../math": 70,
            "../../../settings": 101,
            "pixi-gl-core": 15
        }],
        97: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                var r = !e;
                if (r) {
                    var n = document.createElement("canvas");
                    n.width = 1, n.height = 1, e = s.default.createContext(n)
                }
                for (var o = e.createShader(e.FRAGMENT_SHADER);;) {
                    var u = a.replace(/%forloop%/gi, i(t));
                    if (e.shaderSource(o, u), e.compileShader(o), e.getShaderParameter(o, e.COMPILE_STATUS)) break;
                    t = t / 2 | 0
                }
                return r && e.getExtension("WEBGL_lose_context") && e.getExtension("WEBGL_lose_context").loseContext(), t
            }

            function i(t) {
                for (var e = "", r = 0; r < t; ++r) r > 0 && (e += "\nelse "), r < t - 1 && (e += "if(test == " + r + ".0){}");
                return e
            }
            r.__esModule = !0, r.default = n;
            var o = t("pixi-gl-core"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = ["precision mediump float;", "void main(void){", "float test = 0.1;", "%forloop%", "gl_FragColor = vec4(0.0);", "}"].join("\n")
        }, {
            "pixi-gl-core": 15
        }],
        98: [function(t, e, r) {
            "use strict";

            function n(t) {
                var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : [];
                return e[i.BLEND_MODES.NORMAL] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.ADD] = [t.ONE, t.DST_ALPHA], e[i.BLEND_MODES.MULTIPLY] = [t.DST_COLOR, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.SCREEN] = [t.ONE, t.ONE_MINUS_SRC_COLOR], e[i.BLEND_MODES.OVERLAY] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.DARKEN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.LIGHTEN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.COLOR_DODGE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.COLOR_BURN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.HARD_LIGHT] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.SOFT_LIGHT] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.DIFFERENCE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.EXCLUSION] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.HUE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.SATURATION] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.COLOR] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.LUMINOSITY] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.NORMAL_NPM] = [t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA, t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.ADD_NPM] = [t.SRC_ALPHA, t.DST_ALPHA, t.ONE, t.DST_ALPHA], e[i.BLEND_MODES.SCREEN_NPM] = [t.SRC_ALPHA, t.ONE_MINUS_SRC_COLOR, t.ONE, t.ONE_MINUS_SRC_COLOR], e
            }
            r.__esModule = !0, r.default = n;
            var i = t("../../../const")
        }, {
            "../../../const": 46
        }],
        99: [function(t, e, r) {
            "use strict";

            function n(t) {
                var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
                return e[i.DRAW_MODES.POINTS] = t.POINTS, e[i.DRAW_MODES.LINES] = t.LINES, e[i.DRAW_MODES.LINE_LOOP] = t.LINE_LOOP, e[i.DRAW_MODES.LINE_STRIP] = t.LINE_STRIP, e[i.DRAW_MODES.TRIANGLES] = t.TRIANGLES, e[i.DRAW_MODES.TRIANGLE_STRIP] = t.TRIANGLE_STRIP, e[i.DRAW_MODES.TRIANGLE_FAN] = t.TRIANGLE_FAN, e
            }
            r.__esModule = !0, r.default = n;
            var i = t("../../../const")
        }, {
            "../../../const": 46
        }],
        100: [function(t, e, r) {
            "use strict";

            function n(t) {
                t.getContextAttributes().stencil || console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")
            }
            r.__esModule = !0, r.default = n
        }, {}],
        101: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./utils/maxRecommendedTextures"),
                o = n(i),
                s = t("./utils/canUploadSameBuffer"),
                a = n(s);
            r.default = {
                TARGET_FPMS: .06,
                MIPMAP_TEXTURES: !0,
                RESOLUTION: 1,
                FILTER_RESOLUTION: 1,
                SPRITE_MAX_TEXTURES: (0, o.default)(32),
                SPRITE_BATCH_SIZE: 4096,
                RETINA_PREFIX: /@([0-9\.]+)x/,
                RENDER_OPTIONS: {
                    view: null,
                    antialias: !1,
                    forceFXAA: !1,
                    autoResize: !1,
                    transparent: !1,
                    backgroundColor: 0,
                    clearBeforeRender: !0,
                    preserveDrawingBuffer: !1,
                    roundPixels: !1,
                    width: 800,
                    height: 600,
                    legacy: !1
                },
                TRANSFORM_MODE: 0,
                GC_MODE: 0,
                GC_MAX_IDLE: 3600,
                GC_MAX_CHECK_COUNT: 600,
                WRAP_MODE: 0,
                SCALE_MODE: 0,
                PRECISION_VERTEX: "highp",
                PRECISION_FRAGMENT: "mediump",
                CAN_UPLOAD_SAME_BUFFER: (0, a.default)(),
                MESH_CANVAS_PADDING: 0
            }
        }, {
            "./utils/canUploadSameBuffer": 122,
            "./utils/maxRecommendedTextures": 127
        }],
        102: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("../math"),
                h = t("../utils"),
                l = t("../const"),
                c = t("../textures/Texture"),
                d = n(c),
                f = t("../display/Container"),
                p = n(f),
                v = new u.Point,
                y = function(t) {
                    function e(r) {
                        i(this, e);
                        var n = o(this, t.call(this));
                        return n._anchor = new u.ObservablePoint(n._onAnchorUpdate, n), n._texture = null, n._width = 0, n._height = 0, n._tint = null, n._tintRGB = null, n.tint = 16777215, n.blendMode = l.BLEND_MODES.NORMAL, n.shader = null, n.cachedTint = 16777215, n.texture = r || d.default.EMPTY, n.vertexData = new Float32Array(8), n.vertexTrimmedData = null, n._transformID = -1, n._textureID = -1, n._transformTrimmedID = -1, n._textureTrimmedID = -1, n.pluginName = "sprite", n
                    }
                    return s(e, t), e.prototype._onTextureUpdate = function() {
                        this._textureID = -1, this._textureTrimmedID = -1, this.cachedTint = 16777215, this._width && (this.scale.x = (0, h.sign)(this.scale.x) * this._width / this._texture.orig.width), this._height && (this.scale.y = (0, h.sign)(this.scale.y) * this._height / this._texture.orig.height)
                    }, e.prototype._onAnchorUpdate = function() {
                        this._transformID = -1, this._transformTrimmedID = -1
                    }, e.prototype.calculateVertices = function() {
                        if (this._transformID !== this.transform._worldID || this._textureID !== this._texture._updateID) {
                            this._transformID = this.transform._worldID, this._textureID = this._texture._updateID;
                            var t = this._texture,
                                e = this.transform.worldTransform,
                                r = e.a,
                                n = e.b,
                                i = e.c,
                                o = e.d,
                                s = e.tx,
                                a = e.ty,
                                u = this.vertexData,
                                h = t.trim,
                                l = t.orig,
                                c = this._anchor,
                                d = 0,
                                f = 0,
                                p = 0,
                                v = 0;
                            h ? (f = h.x - c._x * l.width, d = f + h.width, v = h.y - c._y * l.height, p = v + h.height) : (f = -c._x * l.width, d = f + l.width, v = -c._y * l.height, p = v + l.height), u[0] = r * f + i * v + s, u[1] = o * v + n * f + a, u[2] = r * d + i * v + s, u[3] = o * v + n * d + a, u[4] = r * d + i * p + s, u[5] = o * p + n * d + a, u[6] = r * f + i * p + s, u[7] = o * p + n * f + a
                        }
                    }, e.prototype.calculateTrimmedVertices = function() {
                        if (this.vertexTrimmedData) {
                            if (this._transformTrimmedID === this.transform._worldID && this._textureTrimmedID === this._texture._updateID) return
                        } else this.vertexTrimmedData = new Float32Array(8);
                        this._transformTrimmedID = this.transform._worldID, this._textureTrimmedID = this._texture._updateID;
                        var t = this._texture,
                            e = this.vertexTrimmedData,
                            r = t.orig,
                            n = this._anchor,
                            i = this.transform.worldTransform,
                            o = i.a,
                            s = i.b,
                            a = i.c,
                            u = i.d,
                            h = i.tx,
                            l = i.ty,
                            c = -n._x * r.width,
                            d = c + r.width,
                            f = -n._y * r.height,
                            p = f + r.height;
                        e[0] = o * c + a * f + h, e[1] = u * f + s * c + l, e[2] = o * d + a * f + h, e[3] = u * f + s * d + l, e[4] = o * d + a * p + h, e[5] = u * p + s * d + l, e[6] = o * c + a * p + h, e[7] = u * p + s * c + l
                    }, e.prototype._renderWebGL = function(t) {
                        this.calculateVertices(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this)
                    }, e.prototype._renderCanvas = function(t) {
                        t.plugins[this.pluginName].render(this)
                    }, e.prototype._calculateBounds = function() {
                        var t = this._texture.trim,
                            e = this._texture.orig;
                        !t || t.width === e.width && t.height === e.height ? (this.calculateVertices(), this._bounds.addQuad(this.vertexData)) : (this.calculateTrimmedVertices(), this._bounds.addQuad(this.vertexTrimmedData))
                    }, e.prototype.getLocalBounds = function(e) {
                        return 0 === this.children.length ? (this._bounds.minX = this._texture.orig.width * -this._anchor._x, this._bounds.minY = this._texture.orig.height * -this._anchor._y, this._bounds.maxX = this._texture.orig.width * (1 - this._anchor._x), this._bounds.maxY = this._texture.orig.height * (1 - this._anchor._y), e || (this._localBoundsRect || (this._localBoundsRect = new u.Rectangle), e = this._localBoundsRect), this._bounds.getRectangle(e)) : t.prototype.getLocalBounds.call(this, e)
                    }, e.prototype.containsPoint = function(t) {
                        this.worldTransform.applyInverse(t, v);
                        var e = this._texture.orig.width,
                            r = this._texture.orig.height,
                            n = -e * this.anchor.x,
                            i = 0;
                        return v.x >= n && v.x < n + e && (i = -r * this.anchor.y, v.y >= i && v.y < i + r)
                    }, e.prototype.destroy = function(e) {
                        if (t.prototype.destroy.call(this, e), this._anchor = null, "boolean" == typeof e ? e : e && e.texture) {
                            var r = "boolean" == typeof e ? e : e && e.baseTexture;
                            this._texture.destroy(!!r)
                        }
                        this._texture = null, this.shader = null
                    }, e.from = function(t) {
                        return new e(d.default.from(t))
                    }, e.fromFrame = function(t) {
                        var r = h.TextureCache[t];
                        if (!r) throw new Error('The frameId "' + t + '" does not exist in the texture cache');
                        return new e(r)
                    }, e.fromImage = function(t, r, n) {
                        return new e(d.default.fromImage(t, r, n))
                    }, a(e, [{
                        key: "width",
                        get: function() {
                            return Math.abs(this.scale.x) * this._texture.orig.width
                        },
                        set: function(t) {
                            var e = (0, h.sign)(this.scale.x) || 1;
                            this.scale.x = e * t / this._texture.orig.width, this._width = t
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return Math.abs(this.scale.y) * this._texture.orig.height
                        },
                        set: function(t) {
                            var e = (0, h.sign)(this.scale.y) || 1;
                            this.scale.y = e * t / this._texture.orig.height, this._height = t
                        }
                    }, {
                        key: "anchor",
                        get: function() {
                            return this._anchor
                        },
                        set: function(t) {
                            this._anchor.copy(t)
                        }
                    }, {
                        key: "tint",
                        get: function() {
                            return this._tint
                        },
                        set: function(t) {
                            this._tint = t, this._tintRGB = (t >> 16) + (65280 & t) + ((255 & t) << 16)
                        }
                    }, {
                        key: "texture",
                        get: function() {
                            return this._texture
                        },
                        set: function(t) {
                            this._texture !== t && (this._texture = t, this.cachedTint = 16777215, this._textureID = -1, this._textureTrimmedID = -1, t && (t.baseTexture.hasLoaded ? this._onTextureUpdate() : t.once("update", this._onTextureUpdate, this)))
                        }
                    }]), e
                }(p.default);
            r.default = y
        }, {
            "../const": 46,
            "../display/Container": 48,
            "../math": 70,
            "../textures/Texture": 115,
            "../utils": 125
        }],
        103: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = t("../../renderers/canvas/CanvasRenderer"),
                s = n(o),
                a = t("../../const"),
                u = t("../../math"),
                h = t("./CanvasTinter"),
                l = n(h),
                c = new u.Matrix,
                d = function() {
                    function t(e) {
                        i(this, t), this.renderer = e
                    }
                    return t.prototype.render = function(t) {
                        var e = t._texture,
                            r = this.renderer,
                            n = e._frame.width,
                            i = e._frame.height,
                            o = t.transform.worldTransform,
                            s = 0,
                            h = 0;
                        if (!(e.orig.width <= 0 || e.orig.height <= 0) && e.baseTexture.source && (r.setBlendMode(t.blendMode), e.valid)) {
                            r.context.globalAlpha = t.worldAlpha;
                            var d = e.baseTexture.scaleMode === a.SCALE_MODES.LINEAR;
                            r.smoothProperty && r.context[r.smoothProperty] !== d && (r.context[r.smoothProperty] = d), e.trim ? (s = e.trim.width / 2 + e.trim.x - t.anchor.x * e.orig.width, h = e.trim.height / 2 + e.trim.y - t.anchor.y * e.orig.height) : (s = (.5 - t.anchor.x) * e.orig.width, h = (.5 - t.anchor.y) * e.orig.height), e.rotate && (o.copy(c), o = c, u.GroupD8.matrixAppendRotationInv(o, e.rotate, s, h), s = 0, h = 0), s -= n / 2, h -= i / 2, r.roundPixels ? (r.context.setTransform(o.a, o.b, o.c, o.d, o.tx * r.resolution | 0, o.ty * r.resolution | 0), s |= 0, h |= 0) : r.context.setTransform(o.a, o.b, o.c, o.d, o.tx * r.resolution, o.ty * r.resolution);
                            var f = e.baseTexture.resolution;
                            16777215 !== t.tint ? (t.cachedTint === t.tint && t.tintedTexture.tintId === t._texture._updateID || (t.cachedTint = t.tint, t.tintedTexture = l.default.getTintedTexture(t, t.tint)), r.context.drawImage(t.tintedTexture, 0, 0, n * f, i * f, s * r.resolution, h * r.resolution, n * r.resolution, i * r.resolution)) : r.context.drawImage(e.baseTexture.source, e._frame.x * f, e._frame.y * f, n * f, i * f, s * r.resolution, h * r.resolution, n * r.resolution, i * r.resolution)
                        }
                    }, t.prototype.destroy = function() {
                        this.renderer = null
                    }, t
                }();
            r.default = d, s.default.registerPlugin("sprite", d)
        }, {
            "../../const": 46,
            "../../math": 70,
            "../../renderers/canvas/CanvasRenderer": 77,
            "./CanvasTinter": 104
        }],
        104: [function(t, e, r) {
            "use strict";
            r.__esModule = !0;
            var n = t("../../utils"),
                i = t("../../renderers/canvas/utils/canUseNewCanvasBlendModes"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = {
                    getTintedTexture: function(t, e) {
                        var r = t._texture;
                        e = s.roundColor(e);
                        var n = "#" + ("00000" + (0 | e).toString(16)).substr(-6);
                        r.tintCache = r.tintCache || {};
                        var i = r.tintCache[n],
                            o = void 0;
                        if (i) {
                            if (i.tintId === r._updateID) return r.tintCache[n];
                            o = r.tintCache[n]
                        } else o = s.canvas || document.createElement("canvas");
                        if (s.tintMethod(r, e, o), o.tintId = r._updateID, s.convertTintToImage) {
                            var a = new Image;
                            a.src = o.toDataURL(), r.tintCache[n] = a
                        } else r.tintCache[n] = o, s.canvas = null;
                        return o
                    },
                    tintWithMultiply: function(t, e, r) {
                        var n = r.getContext("2d"),
                            i = t._frame.clone(),
                            o = t.baseTexture.resolution;
                        i.x *= o, i.y *= o, i.width *= o, i.height *= o, r.width = Math.ceil(i.width), r.height = Math.ceil(i.height), n.save(), n.fillStyle = "#" + ("00000" + (0 | e).toString(16)).substr(-6), n.fillRect(0, 0, i.width, i.height), n.globalCompositeOperation = "multiply", n.drawImage(t.baseTexture.source, i.x, i.y, i.width, i.height, 0, 0, i.width, i.height), n.globalCompositeOperation = "destination-atop", n.drawImage(t.baseTexture.source, i.x, i.y, i.width, i.height, 0, 0, i.width, i.height), n.restore()
                    },
                    tintWithOverlay: function(t, e, r) {
                        var n = r.getContext("2d"),
                            i = t._frame.clone(),
                            o = t.baseTexture.resolution;
                        i.x *= o, i.y *= o, i.width *= o, i.height *= o, r.width = Math.ceil(i.width), r.height = Math.ceil(i.height), n.save(), n.globalCompositeOperation = "copy", n.fillStyle = "#" + ("00000" + (0 | e).toString(16)).substr(-6), n.fillRect(0, 0, i.width, i.height), n.globalCompositeOperation = "destination-atop", n.drawImage(t.baseTexture.source, i.x, i.y, i.width, i.height, 0, 0, i.width, i.height), n.restore()
                    },
                    tintWithPerPixel: function(t, e, r) {
                        var i = r.getContext("2d"),
                            o = t._frame.clone(),
                            s = t.baseTexture.resolution;
                        o.x *= s, o.y *= s, o.width *= s, o.height *= s, r.width = Math.ceil(o.width), r.height = Math.ceil(o.height), i.save(), i.globalCompositeOperation = "copy", i.drawImage(t.baseTexture.source, o.x, o.y, o.width, o.height, 0, 0, o.width, o.height), i.restore();
                        for (var a = (0, n.hex2rgb)(e), u = a[0], h = a[1], l = a[2], c = i.getImageData(0, 0, o.width, o.height), d = c.data, f = 0; f < d.length; f += 4) d[f + 0] *= u, d[f + 1] *= h, d[f + 2] *= l;
                        i.putImageData(c, 0, 0)
                    },
                    roundColor: function(t) {
                        var e = s.cacheStepsPerColorChannel,
                            r = (0, n.hex2rgb)(t);
                        return r[0] = Math.min(255, r[0] / e * e), r[1] = Math.min(255, r[1] / e * e), r[2] = Math.min(255, r[2] / e * e), (0, n.rgb2hex)(r)
                    },
                    cacheStepsPerColorChannel: 8,
                    convertTintToImage: !1,
                    canUseMultiply: (0, o.default)(),
                    tintMethod: 0
                };
            s.tintMethod = s.canUseMultiply ? s.tintWithMultiply : s.tintWithPerPixel, r.default = s
        }, {
            "../../renderers/canvas/utils/canUseNewCanvasBlendModes": 80,
            "../../utils": 125
        }],
        105: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t(e) {
                    n(this, t), this.vertices = new ArrayBuffer(e), this.float32View = new Float32Array(this.vertices), this.uint32View = new Uint32Array(this.vertices)
                }
                return t.prototype.destroy = function() {
                    this.vertices = null, this.positions = null, this.uvs = null, this.colors = null
                }, t
            }();
            r.default = i
        }, {}],
        106: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../../renderers/webgl/utils/ObjectRenderer"),
                u = n(a),
                h = t("../../renderers/webgl/WebGLRenderer"),
                l = n(h),
                c = t("../../utils/createIndicesForQuads"),
                d = n(c),
                f = t("./generateMultiTextureShader"),
                p = n(f),
                v = t("../../renderers/webgl/utils/checkMaxIfStatmentsInShader"),
                y = n(v),
                g = t("./BatchBuffer"),
                m = n(g),
                _ = t("../../settings"),
                b = n(_),
                x = t("../../utils"),
                T = t("pixi-gl-core"),
                w = n(T),
                E = t("bit-twiddle"),
                S = n(E),
                O = 0,
                M = 0,
                P = function(t) {
                    function e(r) {
                        i(this, e);
                        var n = o(this, t.call(this, r));
                        n.vertSize = 5, n.vertByteSize = 4 * n.vertSize, n.size = b.default.SPRITE_BATCH_SIZE, n.buffers = [];
                        for (var s = 1; s <= S.default.nextPow2(n.size); s *= 2) n.buffers.push(new m.default(4 * s * n.vertByteSize));
                        n.indices = (0, d.default)(n.size), n.shader = null, n.currentIndex = 0, n.groups = [];
                        for (var a = 0; a < n.size; a++) n.groups[a] = {
                            textures: [],
                            textureCount: 0,
                            ids: [],
                            size: 0,
                            start: 0,
                            blend: 0
                        };
                        return n.sprites = [], n.vertexBuffers = [], n.vaos = [], n.vaoMax = 2, n.vertexCount = 0, n.renderer.on("prerender", n.onPrerender, n), n
                    }
                    return s(e, t), e.prototype.onContextChange = function() {
                        var t = this.renderer.gl;
                        this.renderer.legacy ? this.MAX_TEXTURES = 1 : (this.MAX_TEXTURES = Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS), b.default.SPRITE_MAX_TEXTURES), this.MAX_TEXTURES = (0, y.default)(this.MAX_TEXTURES, t)), this.shader = (0, p.default)(t, this.MAX_TEXTURES), this.indexBuffer = w.default.GLBuffer.createIndexBuffer(t, this.indices, t.STATIC_DRAW), this.renderer.bindVao(null);
                        for (var e = this.shader.attributes, r = 0; r < this.vaoMax; r++) {
                            var n = this.vertexBuffers[r] = w.default.GLBuffer.createVertexBuffer(t, null, t.STREAM_DRAW),
                                i = this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(n, e.aVertexPosition, t.FLOAT, !1, this.vertByteSize, 0).addAttribute(n, e.aTextureCoord, t.UNSIGNED_SHORT, !0, this.vertByteSize, 8).addAttribute(n, e.aColor, t.UNSIGNED_BYTE, !0, this.vertByteSize, 12);
                            e.aTextureId && i.addAttribute(n, e.aTextureId, t.FLOAT, !1, this.vertByteSize, 16), this.vaos[r] = i
                        }
                        this.vao = this.vaos[0], this.currentBlendMode = 99999, this.boundTextures = new Array(this.MAX_TEXTURES)
                    }, e.prototype.onPrerender = function() {
                        this.vertexCount = 0
                    }, e.prototype.render = function(t) {
                        this.currentIndex >= this.size && this.flush(), t._texture._uvs && (this.sprites[this.currentIndex++] = t)
                    }, e.prototype.flush = function() {
                        if (0 !== this.currentIndex) {
                            var t = this.renderer.gl,
                                e = this.MAX_TEXTURES,
                                r = S.default.nextPow2(this.currentIndex),
                                n = S.default.log2(r),
                                i = this.buffers[n],
                                o = this.sprites,
                                s = this.groups,
                                a = i.float32View,
                                u = i.uint32View,
                                h = this.boundTextures,
                                l = this.renderer.boundTextures,
                                c = this.renderer.textureGC.count,
                                d = 0,
                                f = void 0,
                                p = void 0,
                                v = 1,
                                y = 0,
                                g = s[0],
                                m = void 0,
                                _ = void 0,
                                T = x.premultiplyBlendMode[o[0]._texture.baseTexture.premultipliedAlpha ? 1 : 0][o[0].blendMode];
                            g.textureCount = 0, g.start = 0, g.blend = T, O++;
                            var E = void 0;
                            for (E = 0; E < e; ++E) {
                                var P = l[E];
                                P._enabled !== O ? (h[E] = P, P._virtalBoundId = E, P._enabled = O) : h[E] = this.renderer.emptyTextures[E]
                            }
                            for (O++, E = 0; E < this.currentIndex; ++E) {
                                var C = o[E];
                                f = C._texture.baseTexture;
                                var R = x.premultiplyBlendMode[Number(f.premultipliedAlpha)][C.blendMode];
                                if (T !== R && (T = R, p = null, y = e, O++), p !== f && (p = f, f._enabled !== O)) {
                                    if (y === e && (O++, g.size = E - g.start, y = 0, g = s[v++], g.blend = T, g.textureCount = 0, g.start = E), f.touched = c, -1 === f._virtalBoundId)
                                        for (var A = 0; A < e; ++A) {
                                            var I = (A + M) % e,
                                                D = h[I];
                                            if (D._enabled !== O) {
                                                M++, D._virtalBoundId = -1, f._virtalBoundId = I, h[I] = f;
                                                break
                                            }
                                        }
                                    f._enabled = O, g.textureCount++, g.ids[y] = f._virtalBoundId, g.textures[y++] = f
                                }
                                if (m = C.vertexData, _ = C._texture._uvs.uvsUint32, this.renderer.roundPixels) {
                                    var L = this.renderer.resolution;
                                    a[d] = (m[0] * L | 0) / L, a[d + 1] = (m[1] * L | 0) / L, a[d + 5] = (m[2] * L | 0) / L, a[d + 6] = (m[3] * L | 0) / L, a[d + 10] = (m[4] * L | 0) / L, a[d + 11] = (m[5] * L | 0) / L, a[d + 15] = (m[6] * L | 0) / L, a[d + 16] = (m[7] * L | 0) / L
                                } else a[d] = m[0], a[d + 1] = m[1], a[d + 5] = m[2], a[d + 6] = m[3], a[d + 10] = m[4], a[d + 11] = m[5], a[d + 15] = m[6], a[d + 16] = m[7];
                                u[d + 2] = _[0], u[d + 7] = _[1], u[d + 12] = _[2], u[d + 17] = _[3];
                                var N = Math.min(C.worldAlpha, 1),
                                    F = N < 1 && f.premultipliedAlpha ? (0, x.premultiplyTint)(C._tintRGB, N) : C._tintRGB + (255 * N << 24);
                                u[d + 3] = u[d + 8] = u[d + 13] = u[d + 18] = F, a[d + 4] = a[d + 9] = a[d + 14] = a[d + 19] = f._virtalBoundId, d += 20
                            }
                            if (g.size = E - g.start, b.default.CAN_UPLOAD_SAME_BUFFER) this.vertexBuffers[this.vertexCount].upload(i.vertices, 0, !0);
                            else {
                                if (this.vaoMax <= this.vertexCount) {
                                    this.vaoMax++;
                                    var B = this.shader.attributes,
                                        k = this.vertexBuffers[this.vertexCount] = w.default.GLBuffer.createVertexBuffer(t, null, t.STREAM_DRAW),
                                        j = this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(k, B.aVertexPosition, t.FLOAT, !1, this.vertByteSize, 0).addAttribute(k, B.aTextureCoord, t.UNSIGNED_SHORT, !0, this.vertByteSize, 8).addAttribute(k, B.aColor, t.UNSIGNED_BYTE, !0, this.vertByteSize, 12);
                                    B.aTextureId && j.addAttribute(k, B.aTextureId, t.FLOAT, !1, this.vertByteSize, 16), this.vaos[this.vertexCount] = j
                                }
                                this.renderer.bindVao(this.vaos[this.vertexCount]), this.vertexBuffers[this.vertexCount].upload(i.vertices, 0, !1), this.vertexCount++
                            }
                            for (E = 0; E < e; ++E) l[E]._virtalBoundId = -1;
                            for (E = 0; E < v; ++E) {
                                for (var U = s[E], X = U.textureCount, G = 0; G < X; G++) p = U.textures[G], l[U.ids[G]] !== p && this.renderer.bindTexture(p, U.ids[G], !0), p._virtalBoundId = -1;
                                this.renderer.state.setBlendMode(U.blend), t.drawElements(t.TRIANGLES, 6 * U.size, t.UNSIGNED_SHORT, 6 * U.start * 2)
                            }
                            this.currentIndex = 0
                        }
                    }, e.prototype.start = function() {
                        this.renderer.bindShader(this.shader), b.default.CAN_UPLOAD_SAME_BUFFER && (this.renderer.bindVao(this.vaos[this.vertexCount]), this.vertexBuffers[this.vertexCount].bind())
                    }, e.prototype.stop = function() {
                        this.flush()
                    }, e.prototype.destroy = function() {
                        for (var e = 0; e < this.vaoMax; e++) this.vertexBuffers[e] && this.vertexBuffers[e].destroy(), this.vaos[e] && this.vaos[e].destroy();
                        this.indexBuffer && this.indexBuffer.destroy(), this.renderer.off("prerender", this.onPrerender, this), t.prototype.destroy.call(this), this.shader && (this.shader.destroy(), this.shader = null), this.vertexBuffers = null, this.vaos = null, this.indexBuffer = null, this.indices = null, this.sprites = null;
                        for (var r = 0; r < this.buffers.length; ++r) this.buffers[r].destroy()
                    }, e
                }(u.default);
            r.default = P, l.default.registerPlugin("sprite", P)
        }, {
            "../../renderers/webgl/WebGLRenderer": 84,
            "../../renderers/webgl/utils/ObjectRenderer": 94,
            "../../renderers/webgl/utils/checkMaxIfStatmentsInShader": 97,
            "../../settings": 101,
            "../../utils": 125,
            "../../utils/createIndicesForQuads": 123,
            "./BatchBuffer": 105,
            "./generateMultiTextureShader": 107,
            "bit-twiddle": 1,
            "pixi-gl-core": 15
        }],
        107: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                var r = a;
                r = r.replace(/%count%/gi, e), r = r.replace(/%forloop%/gi, i(e));
                for (var n = new s.default(t, "precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n", r), o = [], u = 0; u < e; u++) o[u] = u;
                return n.bind(), n.uniforms.uSamplers = o, n
            }

            function i(t) {
                var e = "";
                e += "\n", e += "\n";
                for (var r = 0; r < t; r++) r > 0 && (e += "\nelse "), r < t - 1 && (e += "if(textureId == " + r + ".0)"), e += "\n{", e += "\n\tcolor = texture2D(uSamplers[" + r + "], vTextureCoord);", e += "\n}";
                return e += "\n", e += "\n"
            }
            r.__esModule = !0, r.default = n;
            var o = t("../../Shader"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = (t("path"), ["varying vec2 vTextureCoord;", "varying vec4 vColor;", "varying float vTextureId;", "uniform sampler2D uSamplers[%count%];", "void main(void){", "vec4 color;", "float textureId = floor(vTextureId+0.5);", "%forloop%", "gl_FragColor = color * vColor;", "}"].join("\n"))
        }, {
            "../../Shader": 44,
            path: 8
        }],
        108: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("../sprites/Sprite"),
                h = n(u),
                l = t("../textures/Texture"),
                c = n(l),
                d = t("../math"),
                f = t("../utils"),
                p = t("../const"),
                v = t("../settings"),
                y = n(v),
                g = t("./TextStyle"),
                m = n(g),
                _ = t("./TextMetrics"),
                b = n(_),
                x = t("../utils/trimCanvas"),
                T = n(x),
                w = {
                    texture: !0,
                    children: !1,
                    baseTexture: !0
                },
                E = function(t) {
                    function e(r, n, s) {
                        i(this, e), s = s || document.createElement("canvas"), s.width = 3, s.height = 3;
                        var a = c.default.fromCanvas(s, y.default.SCALE_MODE, "text");
                        a.orig = new d.Rectangle, a.trim = new d.Rectangle;
                        var u = o(this, t.call(this, a));
                        return c.default.addToCache(u._texture, u._texture.baseTexture.textureCacheIds[0]), u.canvas = s, u.context = u.canvas.getContext("2d"), u.resolution = y.default.RESOLUTION, u._text = null, u._style = null, u._styleListener = null, u._font = "", u.text = r, u.style = n, u.localStyleID = -1, u
                    }
                    return s(e, t), e.prototype.updateText = function(t) {
                        var e = this._style;
                        if (this.localStyleID !== e.styleID && (this.dirty = !0, this.localStyleID = e.styleID), this.dirty || !t) {
                            this._font = this._style.toFontString();
                            var r = this.context,
                                n = b.default.measureText(this._text, this._style, this._style.wordWrap, this.canvas),
                                i = n.width,
                                o = n.height,
                                s = n.lines,
                                a = n.lineHeight,
                                u = n.lineWidths,
                                h = n.maxLineWidth,
                                l = n.fontProperties;
                            this.canvas.width = Math.ceil((Math.max(1, i) + 2 * e.padding) * this.resolution), this.canvas.height = Math.ceil((Math.max(1, o) + 2 * e.padding) * this.resolution), r.scale(this.resolution, this.resolution), r.clearRect(0, 0, this.canvas.width, this.canvas.height), r.font = this._font, r.strokeStyle = e.stroke, r.lineWidth = e.strokeThickness, r.textBaseline = e.textBaseline, r.lineJoin = e.lineJoin, r.miterLimit = e.miterLimit;
                            var c = void 0,
                                d = void 0;
                            if (e.dropShadow) {
                                r.fillStyle = e.dropShadowColor, r.globalAlpha = e.dropShadowAlpha, r.shadowBlur = e.dropShadowBlur, e.dropShadowBlur > 0 && (r.shadowColor = e.dropShadowColor);
                                for (var f = Math.cos(e.dropShadowAngle) * e.dropShadowDistance, p = Math.sin(e.dropShadowAngle) * e.dropShadowDistance, v = 0; v < s.length; v++) c = e.strokeThickness / 2, d = e.strokeThickness / 2 + v * a + l.ascent, "right" === e.align ? c += h - u[v] : "center" === e.align && (c += (h - u[v]) / 2), e.fill && (this.drawLetterSpacing(s[v], c + f + e.padding, d + p + e.padding), e.stroke && e.strokeThickness && (r.strokeStyle = e.dropShadowColor, this.drawLetterSpacing(s[v], c + f + e.padding, d + p + e.padding, !0), r.strokeStyle = e.stroke))
                            }
                            r.shadowBlur = 0, r.globalAlpha = 1, r.fillStyle = this._generateFillStyle(e, s);
                            for (var y = 0; y < s.length; y++) c = e.strokeThickness / 2, d = e.strokeThickness / 2 + y * a + l.ascent, "right" === e.align ? c += h - u[y] : "center" === e.align && (c += (h - u[y]) / 2), e.stroke && e.strokeThickness && this.drawLetterSpacing(s[y], c + e.padding, d + e.padding, !0), e.fill && this.drawLetterSpacing(s[y], c + e.padding, d + e.padding);
                            this.updateTexture()
                        }
                    }, e.prototype.drawLetterSpacing = function(t, e, r) {
                        var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3],
                            i = this._style,
                            o = i.letterSpacing;
                        if (0 === o) return void(n ? this.context.strokeText(t, e, r) : this.context.fillText(t, e, r));
                        for (var s = String.prototype.split.call(t, ""), a = e, u = 0, h = ""; u < t.length;) h = s[u++], n ? this.context.strokeText(h, a, r) : this.context.fillText(h, a, r), a += this.context.measureText(h).width + o
                    }, e.prototype.updateTexture = function() {
                        var t = this.canvas;
                        if (this._style.trim) {
                            var e = (0, T.default)(t);
                            t.width = e.width, t.height = e.height, this.context.putImageData(e.data, 0, 0)
                        }
                        var r = this._texture,
                            n = this._style,
                            i = n.trim ? 0 : n.padding,
                            o = r.baseTexture;
                        o.hasLoaded = !0, o.resolution = this.resolution, o.realWidth = t.width, o.realHeight = t.height, o.width = t.width / this.resolution, o.height = t.height / this.resolution, r.trim.width = r._frame.width = t.width / this.resolution, r.trim.height = r._frame.height = t.height / this.resolution, r.trim.x = -i, r.trim.y = -i, r.orig.width = r._frame.width - 2 * i, r.orig.height = r._frame.height - 2 * i, this._onTextureUpdate(), o.emit("update", o), this.dirty = !1
                    }, e.prototype.renderWebGL = function(e) {
                        this.resolution !== e.resolution && (this.resolution = e.resolution, this.dirty = !0), this.updateText(!0), t.prototype.renderWebGL.call(this, e)
                    }, e.prototype._renderCanvas = function(e) {
                        this.resolution !== e.resolution && (this.resolution = e.resolution, this.dirty = !0), this.updateText(!0), t.prototype._renderCanvas.call(this, e)
                    }, e.prototype.getLocalBounds = function(e) {
                        return this.updateText(!0), t.prototype.getLocalBounds.call(this, e)
                    }, e.prototype._calculateBounds = function() {
                        this.updateText(!0), this.calculateVertices(), this._bounds.addQuad(this.vertexData)
                    }, e.prototype._onStyleChange = function() {
                        this.dirty = !0
                    }, e.prototype._generateFillStyle = function(t, e) {
                        if (!Array.isArray(t.fill)) return t.fill;
                        if (navigator.isCocoonJS) return t.fill[0];
                        var r = void 0,
                            n = void 0,
                            i = void 0,
                            o = void 0,
                            s = this.canvas.width / this.resolution,
                            a = this.canvas.height / this.resolution,
                            u = t.fill.slice(),
                            h = t.fillGradientStops.slice();
                        if (!h.length)
                            for (var l = u.length + 1, c = 1; c < l; ++c) h.push(c / l);
                        if (u.unshift(t.fill[0]), h.unshift(0), u.push(t.fill[t.fill.length - 1]), h.push(1), t.fillGradientType === p.TEXT_GRADIENT.LINEAR_VERTICAL) {
                            r = this.context.createLinearGradient(s / 2, 0, s / 2, a), n = (u.length + 1) * e.length, i = 0;
                            for (var d = 0; d < e.length; d++) {
                                i += 1;
                                for (var f = 0; f < u.length; f++) o = "number" == typeof h[f] ? h[f] / e.length + d / e.length : i / n, r.addColorStop(o, u[f]), i++
                            }
                        } else {
                            r = this.context.createLinearGradient(0, a / 2, s, a / 2), n = u.length + 1, i = 1;
                            for (var v = 0; v < u.length; v++) o = "number" == typeof h[v] ? h[v] : i / n, r.addColorStop(o, u[v]), i++
                        }
                        return r
                    }, e.prototype.destroy = function(e) {
                        "boolean" == typeof e && (e = {
                            children: e
                        }), e = Object.assign({}, w, e), t.prototype.destroy.call(this, e), this.context = null, this.canvas = null, this._style = null
                    }, a(e, [{
                        key: "width",
                        get: function() {
                            return this.updateText(!0), Math.abs(this.scale.x) * this._texture.orig.width
                        },
                        set: function(t) {
                            this.updateText(!0);
                            var e = (0, f.sign)(this.scale.x) || 1;
                            this.scale.x = e * t / this._texture.orig.width, this._width = t
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return this.updateText(!0), Math.abs(this.scale.y) * this._texture.orig.height
                        },
                        set: function(t) {
                            this.updateText(!0);
                            var e = (0, f.sign)(this.scale.y) || 1;
                            this.scale.y = e * t / this._texture.orig.height, this._height = t
                        }
                    }, {
                        key: "style",
                        get: function() {
                            return this._style
                        },
                        set: function(t) {
                            t = t || {}, t instanceof m.default ? this._style = t : this._style = new m.default(t), this.localStyleID = -1, this.dirty = !0
                        }
                    }, {
                        key: "text",
                        get: function() {
                            return this._text
                        },
                        set: function(t) {
                            t = String("" === t || null === t || void 0 === t ? " " : t), this._text !== t && (this._text = t, this.dirty = !0)
                        }
                    }]), e
                }(h.default);
            r.default = E
        }, {
            "../const": 46,
            "../math": 70,
            "../settings": 101,
            "../sprites/Sprite": 102,
            "../textures/Texture": 115,
            "../utils": 125,
            "../utils/trimCanvas": 130,
            "./TextMetrics": 109,
            "./TextStyle": 110
        }],
        109: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t(e, r, i, o, s, a, u, h, l) {
                    n(this, t), this.text = e, this.style = r, this.width = i, this.height = o, this.lines = s, this.lineWidths = a, this.lineHeight = u, this.maxLineWidth = h, this.fontProperties = l
                }
                return t.measureText = function(e, r, n) {
                    var i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : t._canvas;
                    n = n || r.wordWrap;
                    var o = r.toFontString(),
                        s = t.measureFont(o),
                        a = i.getContext("2d");
                    a.font = o;
                    for (var u = n ? t.wordWrap(e, r, i) : e, h = u.split(/(?:\r\n|\r|\n)/), l = new Array(h.length), c = 0, d = 0; d < h.length; d++) {
                        var f = a.measureText(h[d]).width + (h[d].length - 1) * r.letterSpacing;
                        l[d] = f, c = Math.max(c, f)
                    }
                    var p = c + r.strokeThickness;
                    r.dropShadow && (p += r.dropShadowDistance);
                    var v = r.lineHeight || s.fontSize + r.strokeThickness,
                        y = Math.max(v, s.fontSize + r.strokeThickness) + (h.length - 1) * (v + r.leading);
                    return r.dropShadow && (y += r.dropShadowDistance), new t(e, r, p, y, h, l, v + r.leading, c, s)
                }, t.wordWrap = function(e, r) {
                    for (var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : t._canvas, i = n.getContext("2d"), o = "", s = 0, a = "", u = {}, h = r.letterSpacing, l = r.wordWrapWidth + r.letterSpacing, c = t.getFromCache(" ", h, u, i), d = e.split(" "), f = 0; f < d.length; f++) {
                        var p = d[f],
                            v = t.getFromCache(p, h, u, i);
                        if (v > l)
                            if (r.breakWords)
                                for (var y = o.length > 0 ? " " + p : p, g = y.split(""), m = 0; m < g.length; m++) {
                                    var _ = g[m],
                                        b = t.getFromCache(_, h, u, i);
                                    b + s > l && (a += t.addLine(o), o = "", s = 0), o += _, s += b
                                } else o.length > 0 && (a += t.addLine(o), o = "", s = 0), a += t.addLine(p), o = "", s = 0;
                            else v + s > l && (a += t.addLine(o), o = "", s = 0), o.length > 0 ? o += " " + p : o += p, s += v + c
                    }
                    return a += t.addLine(o, !1)
                }, t.addLine = function(t) {
                    return t = arguments.length > 1 && void 0 !== arguments[1] && !arguments[1] ? t : t + "\n"
                }, t.getFromCache = function(t, e, r, n) {
                    var i = r[t];
                    if (void 0 === i) {
                        var o = t.length * e;
                        i = n.measureText(t).width + o, r[t] = i
                    }
                    return i
                }, t.measureFont = function(e) {
                    if (t._fonts[e]) return t._fonts[e];
                    var r = {},
                        n = t._canvas,
                        i = t._context;
                    i.font = e;
                    var o = Math.ceil(i.measureText("|MГ‰q").width),
                        s = Math.ceil(i.measureText("M").width),
                        a = 2 * s;
                    s = 1.4 * s | 0, n.width = o, n.height = a, i.fillStyle = "#f00", i.fillRect(0, 0, o, a), i.font = e, i.textBaseline = "alphabetic", i.fillStyle = "#000", i.fillText("|MГ‰q", 0, s);
                    var u = i.getImageData(0, 0, o, a).data,
                        h = u.length,
                        l = 4 * o,
                        c = 0,
                        d = 0,
                        f = !1;
                    for (c = 0; c < s; ++c) {
                        for (var p = 0; p < l; p += 4)
                            if (255 !== u[d + p]) {
                                f = !0;
                                break
                            } if (f) break;
                        d += l
                    }
                    for (r.ascent = s - c, d = h - l, f = !1, c = a; c > s; --c) {
                        for (var v = 0; v < l; v += 4)
                            if (255 !== u[d + v]) {
                                f = !0;
                                break
                            } if (f) break;
                        d -= l
                    }
                    return r.descent = c - s, r.fontSize = r.ascent + r.descent, t._fonts[e] = r, r
                }, t
            }();
            r.default = i;
            var o = document.createElement("canvas");
            o.width = o.height = 10, i._canvas = o, i._context = o.getContext("2d"), i._fonts = {}
        }, {}],
        110: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t) {
                return "number" == typeof t ? (0, l.hex2string)(t) : ("string" == typeof t && 0 === t.indexOf("0x") && (t = t.replace("0x", "#")), t)
            }

            function o(t) {
                if (Array.isArray(t)) {
                    for (var e = 0; e < t.length; ++e) t[e] = i(t[e]);
                    return t
                }
                return i(t)
            }

            function s(t, e) {
                if (!Array.isArray(t) || !Array.isArray(e)) return !1;
                if (t.length !== e.length) return !1;
                for (var r = 0; r < t.length; ++r)
                    if (t[r] !== e[r]) return !1;
                return !0
            }

            function a(t, e, r) {
                for (var n in r) Array.isArray(e[n]) ? t[n] = e[n].slice() : t[n] = e[n]
            }
            r.__esModule = !0;
            var u = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                h = t("../const"),
                l = t("../utils"),
                c = {
                    align: "left",
                    breakWords: !1,
                    dropShadow: !1,
                    dropShadowAlpha: 1,
                    dropShadowAngle: Math.PI / 6,
                    dropShadowBlur: 0,
                    dropShadowColor: "black",
                    dropShadowDistance: 5,
                    fill: "black",
                    fillGradientType: h.TEXT_GRADIENT.LINEAR_VERTICAL,
                    fillGradientStops: [],
                    fontFamily: "Arial",
                    fontSize: 26,
                    fontStyle: "normal",
                    fontVariant: "normal",
                    fontWeight: "normal",
                    letterSpacing: 0,
                    lineHeight: 0,
                    lineJoin: "miter",
                    miterLimit: 10,
                    padding: 0,
                    stroke: "black",
                    strokeThickness: 0,
                    textBaseline: "alphabetic",
                    trim: !1,
                    wordWrap: !1,
                    wordWrapWidth: 100,
                    leading: 0
                },
                d = function() {
                    function t(e) {
                        n(this, t), this.styleID = 0, this.reset(), a(this, e, e)
                    }
                    return t.prototype.clone = function() {
                        var e = {};
                        return a(e, this, c), new t(e)
                    }, t.prototype.reset = function() {
                        a(this, c, c)
                    }, t.prototype.toFontString = function() {
                        var t = "number" == typeof this.fontSize ? this.fontSize + "px" : this.fontSize,
                            e = this.fontFamily;
                        Array.isArray(this.fontFamily) || (e = this.fontFamily.split(","));
                        for (var r = e.length - 1; r >= 0; r--) {
                            var n = e[r].trim();
                            /([\"\'])[^\'\"]+\1/.test(n) || (n = '"' + n + '"'), e[r] = n
                        }
                        return this.fontStyle + " " + this.fontVariant + " " + this.fontWeight + " " + t + " " + e.join(",")
                    }, u(t, [{
                        key: "align",
                        get: function() {
                            return this._align
                        },
                        set: function(t) {
                            this._align !== t && (this._align = t, this.styleID++)
                        }
                    }, {
                        key: "breakWords",
                        get: function() {
                            return this._breakWords
                        },
                        set: function(t) {
                            this._breakWords !== t && (this._breakWords = t, this.styleID++)
                        }
                    }, {
                        key: "dropShadow",
                        get: function() {
                            return this._dropShadow
                        },
                        set: function(t) {
                            this._dropShadow !== t && (this._dropShadow = t, this.styleID++)
                        }
                    }, {
                        key: "dropShadowAlpha",
                        get: function() {
                            return this._dropShadowAlpha
                        },
                        set: function(t) {
                            this._dropShadowAlpha !== t && (this._dropShadowAlpha = t, this.styleID++)
                        }
                    }, {
                        key: "dropShadowAngle",
                        get: function() {
                            return this._dropShadowAngle
                        },
                        set: function(t) {
                            this._dropShadowAngle !== t && (this._dropShadowAngle = t, this.styleID++)
                        }
                    }, {
                        key: "dropShadowBlur",
                        get: function() {
                            return this._dropShadowBlur
                        },
                        set: function(t) {
                            this._dropShadowBlur !== t && (this._dropShadowBlur = t, this.styleID++)
                        }
                    }, {
                        key: "dropShadowColor",
                        get: function() {
                            return this._dropShadowColor
                        },
                        set: function(t) {
                            var e = o(t);
                            this._dropShadowColor !== e && (this._dropShadowColor = e, this.styleID++)
                        }
                    }, {
                        key: "dropShadowDistance",
                        get: function() {
                            return this._dropShadowDistance
                        },
                        set: function(t) {
                            this._dropShadowDistance !== t && (this._dropShadowDistance = t, this.styleID++)
                        }
                    }, {
                        key: "fill",
                        get: function() {
                            return this._fill
                        },
                        set: function(t) {
                            var e = o(t);
                            this._fill !== e && (this._fill = e, this.styleID++)
                        }
                    }, {
                        key: "fillGradientType",
                        get: function() {
                            return this._fillGradientType
                        },
                        set: function(t) {
                            this._fillGradientType !== t && (this._fillGradientType = t, this.styleID++)
                        }
                    }, {
                        key: "fillGradientStops",
                        get: function() {
                            return this._fillGradientStops
                        },
                        set: function(t) {
                            s(this._fillGradientStops, t) || (this._fillGradientStops = t, this.styleID++)
                        }
                    }, {
                        key: "fontFamily",
                        get: function() {
                            return this._fontFamily
                        },
                        set: function(t) {
                            this.fontFamily !== t && (this._fontFamily = t, this.styleID++)
                        }
                    }, {
                        key: "fontSize",
                        get: function() {
                            return this._fontSize
                        },
                        set: function(t) {
                            this._fontSize !== t && (this._fontSize = t, this.styleID++)
                        }
                    }, {
                        key: "fontStyle",
                        get: function() {
                            return this._fontStyle
                        },
                        set: function(t) {
                            this._fontStyle !== t && (this._fontStyle = t, this.styleID++)
                        }
                    }, {
                        key: "fontVariant",
                        get: function() {
                            return this._fontVariant
                        },
                        set: function(t) {
                            this._fontVariant !== t && (this._fontVariant = t, this.styleID++)
                        }
                    }, {
                        key: "fontWeight",
                        get: function() {
                            return this._fontWeight
                        },
                        set: function(t) {
                            this._fontWeight !== t && (this._fontWeight = t, this.styleID++)
                        }
                    }, {
                        key: "letterSpacing",
                        get: function() {
                            return this._letterSpacing
                        },
                        set: function(t) {
                            this._letterSpacing !== t && (this._letterSpacing = t, this.styleID++)
                        }
                    }, {
                        key: "lineHeight",
                        get: function() {
                            return this._lineHeight
                        },
                        set: function(t) {
                            this._lineHeight !== t && (this._lineHeight = t, this.styleID++)
                        }
                    }, {
                        key: "leading",
                        get: function() {
                            return this._leading
                        },
                        set: function(t) {
                            this._leading !== t && (this._leading = t, this.styleID++)
                        }
                    }, {
                        key: "lineJoin",
                        get: function() {
                            return this._lineJoin
                        },
                        set: function(t) {
                            this._lineJoin !== t && (this._lineJoin = t, this.styleID++)
                        }
                    }, {
                        key: "miterLimit",
                        get: function() {
                            return this._miterLimit
                        },
                        set: function(t) {
                            this._miterLimit !== t && (this._miterLimit = t, this.styleID++)
                        }
                    }, {
                        key: "padding",
                        get: function() {
                            return this._padding
                        },
                        set: function(t) {
                            this._padding !== t && (this._padding = t, this.styleID++)
                        }
                    }, {
                        key: "stroke",
                        get: function() {
                            return this._stroke
                        },
                        set: function(t) {
                            var e = o(t);
                            this._stroke !== e && (this._stroke = e, this.styleID++)
                        }
                    }, {
                        key: "strokeThickness",
                        get: function() {
                            return this._strokeThickness
                        },
                        set: function(t) {
                            this._strokeThickness !== t && (this._strokeThickness = t, this.styleID++)
                        }
                    }, {
                        key: "textBaseline",
                        get: function() {
                            return this._textBaseline
                        },
                        set: function(t) {
                            this._textBaseline !== t && (this._textBaseline = t, this.styleID++)
                        }
                    }, {
                        key: "trim",
                        get: function() {
                            return this._trim
                        },
                        set: function(t) {
                            this._trim !== t && (this._trim = t, this.styleID++)
                        }
                    }, {
                        key: "wordWrap",
                        get: function() {
                            return this._wordWrap
                        },
                        set: function(t) {
                            this._wordWrap !== t && (this._wordWrap = t, this.styleID++)
                        }
                    }, {
                        key: "wordWrapWidth",
                        get: function() {
                            return this._wordWrapWidth
                        },
                        set: function(t) {
                            this._wordWrapWidth !== t && (this._wordWrapWidth = t, this.styleID++)
                        }
                    }]), t
                }();
            r.default = d
        }, {
            "../const": 46,
            "../utils": 125
        }],
        111: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("./BaseTexture"),
                u = n(a),
                h = t("../settings"),
                l = n(h),
                c = function(t) {
                    function e() {
                        var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 100,
                            n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 100,
                            s = arguments[2],
                            a = arguments[3];
                        i(this, e);
                        var u = o(this, t.call(this, null, s));
                        return u.resolution = a || l.default.RESOLUTION, u.width = Math.ceil(r), u.height = Math.ceil(n), u.realWidth = u.width * u.resolution, u.realHeight = u.height * u.resolution, u.scaleMode = void 0 !== s ? s : l.default.SCALE_MODE, u.hasLoaded = !0, u._glRenderTargets = {}, u._canvasRenderTarget = null, u.valid = !1, u
                    }
                    return s(e, t), e.prototype.resize = function(t, e) {
                        t = Math.ceil(t), e = Math.ceil(e), t === this.width && e === this.height || (this.valid = t > 0 && e > 0, this.width = t, this.height = e, this.realWidth = this.width * this.resolution, this.realHeight = this.height * this.resolution, this.valid && this.emit("update", this))
                    }, e.prototype.destroy = function() {
                        t.prototype.destroy.call(this, !0), this.renderer = null
                    }, e
                }(u.default);
            r.default = c
        }, {
            "../settings": 101,
            "./BaseTexture": 112
        }],
        112: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../utils"),
                u = t("../settings"),
                h = n(u),
                l = t("eventemitter3"),
                c = n(l),
                d = t("../utils/determineCrossOrigin"),
                f = n(d),
                p = t("bit-twiddle"),
                v = n(p),
                y = function(t) {
                    function e(r, n, s) {
                        i(this, e);
                        var u = o(this, t.call(this));
                        return u.uid = (0, a.uid)(), u.touched = 0, u.resolution = s || h.default.RESOLUTION, u.width = 100, u.height = 100, u.realWidth = 100, u.realHeight = 100, u.scaleMode = void 0 !== n ? n : h.default.SCALE_MODE, u.hasLoaded = !1, u.isLoading = !1, u.source = null, u.origSource = null, u.imageType = null, u.sourceScale = 1, u.premultipliedAlpha = !0, u.imageUrl = null, u.isPowerOfTwo = !1, u.mipmap = h.default.MIPMAP_TEXTURES, u.wrapMode = h.default.WRAP_MODE, u._glTextures = {}, u._enabled = 0, u._virtalBoundId = -1, u._destroyed = !1, u.textureCacheIds = [], r && u.loadSource(r), u
                    }
                    return s(e, t), e.prototype.update = function() {
                        "svg" !== this.imageType && (this.realWidth = this.source.naturalWidth || this.source.videoWidth || this.source.width, this.realHeight = this.source.naturalHeight || this.source.videoHeight || this.source.height, this._updateDimensions()), this.emit("update", this)
                    }, e.prototype._updateDimensions = function() {
                        this.width = this.realWidth / this.resolution, this.height = this.realHeight / this.resolution, this.isPowerOfTwo = v.default.isPow2(this.realWidth) && v.default.isPow2(this.realHeight)
                    }, e.prototype.loadSource = function(t) {
                        var e = this.isLoading;
                        this.hasLoaded = !1, this.isLoading = !1, e && this.source && (this.source.onload = null, this.source.onerror = null);
                        var r = !this.source;
                        if (this.source = t, (t.src && t.complete || t.getContext) && t.width && t.height) this._updateImageType(), "svg" === this.imageType ? this._loadSvgSource() : this._sourceLoaded(), r && this.emit("loaded", this);
                        else if (!t.getContext) {
                            this.isLoading = !0;
                            var n = this;
                            if (t.onload = function() {
                                    if (n._updateImageType(), t.onload = null, t.onerror = null, n.isLoading) {
                                        if (n.isLoading = !1, n._sourceLoaded(), "svg" === n.imageType) return void n._loadSvgSource();
                                        n.emit("loaded", n)
                                    }
                                }, t.onerror = function() {
                                    t.onload = null, t.onerror = null, n.isLoading && (n.isLoading = !1, n.emit("error", n))
                                }, t.complete && t.src) {
                                if (t.onload = null, t.onerror = null, "svg" === n.imageType) return void n._loadSvgSource();
                                this.isLoading = !1, t.width && t.height ? (this._sourceLoaded(), e && this.emit("loaded", this)) : e && this.emit("error", this)
                            }
                        }
                    }, e.prototype._updateImageType = function() {
                        if (this.imageUrl) {
                            var t = (0, a.decomposeDataUri)(this.imageUrl),
                                e = void 0;
                            if (t && "image" === t.mediaType) {
                                var r = t.subType.split("+")[0];
                                if (!(e = (0, a.getUrlFileExtension)("." + r))) throw new Error("Invalid image type in data URI.")
                            } else(e = (0, a.getUrlFileExtension)(this.imageUrl)) || (e = "png");
                            this.imageType = e
                        }
                    }, e.prototype._loadSvgSource = function() {
                        if ("svg" === this.imageType) {
                            var t = (0, a.decomposeDataUri)(this.imageUrl);
                            t ? this._loadSvgSourceUsingDataUri(t) : this._loadSvgSourceUsingXhr()
                        }
                    }, e.prototype._loadSvgSourceUsingDataUri = function(t) {
                        var e = void 0;
                        if ("base64" === t.encoding) {
                            if (!atob) throw new Error("Your browser doesn't support base64 conversions.");
                            e = atob(t.data)
                        } else e = t.data;
                        this._loadSvgSourceUsingString(e)
                    }, e.prototype._loadSvgSourceUsingXhr = function() {
                        var t = this,
                            e = new XMLHttpRequest;
                        e.onload = function() {
                            if (e.readyState !== e.DONE || 200 !== e.status) throw new Error("Failed to load SVG using XHR.");
                            t._loadSvgSourceUsingString(e.response)
                        }, e.onerror = function() {
                            return t.emit("error", t)
                        }, e.open("GET", this.imageUrl, !0), e.send()
                    }, e.prototype._loadSvgSourceUsingString = function(t) {
                        var r = (0, a.getSvgSize)(t),
                            n = r.width,
                            i = r.height;
                        if (!n || !i) throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");
                        this.realWidth = Math.round(n * this.sourceScale), this.realHeight = Math.round(i * this.sourceScale), this._updateDimensions();
                        var o = document.createElement("canvas");
                        o.width = this.realWidth, o.height = this.realHeight, o._pixiId = "canvas_" + (0, a.uid)(), o.getContext("2d").drawImage(this.source, 0, 0, n, i, 0, 0, this.realWidth, this.realHeight), this.origSource = this.source, this.source = o, e.addToCache(this, o._pixiId), this.isLoading = !1, this._sourceLoaded(), this.emit("loaded", this)
                    }, e.prototype._sourceLoaded = function() {
                        this.hasLoaded = !0, this.update()
                    }, e.prototype.destroy = function() {
                        this.imageUrl && (delete a.TextureCache[this.imageUrl], this.imageUrl = null, navigator.isCocoonJS || (this.source.src = "")), this.source = null, this.dispose(), e.removeFromCache(this), this.textureCacheIds = null, this._destroyed = !0
                    }, e.prototype.dispose = function() {
                        this.emit("dispose", this)
                    }, e.prototype.updateSourceImage = function(t) {
                        this.source.src = t, this.loadSource(this.source)
                    }, e.fromImage = function(t, r, n, i) {
                        var o = a.BaseTextureCache[t];
                        if (!o) {
                            var s = new Image;
                            void 0 === r && 0 !== t.indexOf("data:") ? s.crossOrigin = (0, f.default)(t) : r && (s.crossOrigin = "string" == typeof r ? r : "anonymous"), o = new e(s, n), o.imageUrl = t, i && (o.sourceScale = i), o.resolution = (0, a.getResolutionOfUrl)(t), s.src = t, e.addToCache(o, t)
                        }
                        return o
                    }, e.fromCanvas = function(t, r) {
                        var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "canvas";
                        t._pixiId || (t._pixiId = n + "_" + (0, a.uid)());
                        var i = a.BaseTextureCache[t._pixiId];
                        return i || (i = new e(t, r), e.addToCache(i, t._pixiId)), i
                    }, e.from = function(t, r, n) {
                        if ("string" == typeof t) return e.fromImage(t, void 0, r, n);
                        if (t instanceof HTMLImageElement) {
                            var i = t.src,
                                o = a.BaseTextureCache[i];
                            return o || (o = new e(t, r), o.imageUrl = i, n && (o.sourceScale = n), o.resolution = (0, a.getResolutionOfUrl)(i), e.addToCache(o, i)), o
                        }
                        return t instanceof HTMLCanvasElement ? e.fromCanvas(t, r) : t
                    }, e.addToCache = function(t, e) {
                        e && (-1 === t.textureCacheIds.indexOf(e) && t.textureCacheIds.push(e), a.BaseTextureCache[e] = t)
                    }, e.removeFromCache = function(t) {
                        if ("string" == typeof t) {
                            var e = a.BaseTextureCache[t];
                            if (e) {
                                var r = e.textureCacheIds.indexOf(t);
                                return r > -1 && e.textureCacheIds.splice(r, 1), delete a.BaseTextureCache[t], e
                            }
                        } else if (t && t.textureCacheIds) {
                            for (var n = 0; n < t.textureCacheIds.length; ++n) delete a.BaseTextureCache[t.textureCacheIds[n]];
                            return t.textureCacheIds.length = 0, t
                        }
                        return null
                    }, e
                }(c.default);
            r.default = y
        }, {
            "../settings": 101,
            "../utils": 125,
            "../utils/determineCrossOrigin": 124,
            "bit-twiddle": 1,
            eventemitter3: 3
        }],
        113: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("./BaseRenderTexture"),
                u = n(a),
                h = t("./Texture"),
                l = n(h),
                c = function(t) {
                    function e(r, n) {
                        i(this, e);
                        var s = null;
                        if (!(r instanceof u.default)) {
                            var a = arguments[1],
                                h = arguments[2],
                                l = arguments[3],
                                c = arguments[4];
                            console.warn("Please use RenderTexture.create(" + a + ", " + h + ") instead of the ctor directly."), s = arguments[0], n = null, r = new u.default(a, h, l, c)
                        }
                        var d = o(this, t.call(this, r, n));
                        return d.legacyRenderer = s, d.valid = !0, d._updateUvs(), d
                    }
                    return s(e, t), e.prototype.resize = function(t, e, r) {
                        t = Math.ceil(t), e = Math.ceil(e), this.valid = t > 0 && e > 0, this._frame.width = this.orig.width = t, this._frame.height = this.orig.height = e, r || this.baseTexture.resize(t, e), this._updateUvs()
                    }, e.create = function(t, r, n, i) {
                        return new e(new u.default(t, r, n, i))
                    }, e
                }(l.default);
            r.default = c
        }, {
            "./BaseRenderTexture": 111,
            "./Texture": 115
        }],
        114: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = t("../"),
                s = t("../utils"),
                a = function() {
                    function t(e, r) {
                        var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                        n(this, t), this.baseTexture = e, this.textures = {}, this.data = r, this.resolution = this._updateResolution(i || this.baseTexture.imageUrl), this._frames = this.data.frames, this._frameKeys = Object.keys(this._frames), this._batchIndex = 0, this._callback = null
                    }
                    return i(t, null, [{
                        key: "BATCH_SIZE",
                        get: function() {
                            return 1e3
                        }
                    }]), t.prototype._updateResolution = function(t) {
                        var e = this.data.meta.scale,
                            r = (0, s.getResolutionOfUrl)(t, null);
                        return null === r && (r = void 0 !== e ? parseFloat(e) : 1), 1 !== r && (this.baseTexture.resolution = r, this.baseTexture.update()), r
                    }, t.prototype.parse = function(e) {
                        this._batchIndex = 0, this._callback = e, this._frameKeys.length <= t.BATCH_SIZE ? (this._processFrames(0), this._parseComplete()) : this._nextBatch()
                    }, t.prototype._processFrames = function(e) {
                        for (var r = e, n = t.BATCH_SIZE, i = this.baseTexture.sourceScale; r - e < n && r < this._frameKeys.length;) {
                            var s = this._frameKeys[r],
                                a = this._frames[s],
                                u = a.frame;
                            if (u) {
                                var h = null,
                                    l = null,
                                    c = !1 !== a.trimmed && a.sourceSize ? a.sourceSize : a.frame,
                                    d = new o.Rectangle(0, 0, Math.floor(c.w * i) / this.resolution, Math.floor(c.h * i) / this.resolution);
                                h = a.rotated ? new o.Rectangle(Math.floor(u.x * i) / this.resolution, Math.floor(u.y * i) / this.resolution, Math.floor(u.h * i) / this.resolution, Math.floor(u.w * i) / this.resolution) : new o.Rectangle(Math.floor(u.x * i) / this.resolution, Math.floor(u.y * i) / this.resolution, Math.floor(u.w * i) / this.resolution, Math.floor(u.h * i) / this.resolution), !1 !== a.trimmed && a.spriteSourceSize && (l = new o.Rectangle(Math.floor(a.spriteSourceSize.x * i) / this.resolution, Math.floor(a.spriteSourceSize.y * i) / this.resolution, Math.floor(u.w * i) / this.resolution, Math.floor(u.h * i) / this.resolution)), this.textures[s] = new o.Texture(this.baseTexture, h, d, l, a.rotated ? 2 : 0), o.Texture.addToCache(this.textures[s], s)
                            }
                            r++
                        }
                    }, t.prototype._parseComplete = function() {
                        var t = this._callback;
                        this._callback = null, this._batchIndex = 0, t.call(this, this.textures)
                    }, t.prototype._nextBatch = function() {
                        var e = this;
                        this._processFrames(this._batchIndex * t.BATCH_SIZE), this._batchIndex++, setTimeout(function() {
                            e._batchIndex * t.BATCH_SIZE < e._frameKeys.length ? e._nextBatch() : e._parseComplete()
                        }, 0)
                    }, t.prototype.destroy = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
                        for (var e in this.textures) this.textures[e].destroy();
                        this._frames = null, this._frameKeys = null, this.data = null, this.textures = null, t && this.baseTexture.destroy(), this.baseTexture = null
                    }, t
                }();
            r.default = a
        }, {
            "../": 65,
            "../utils": 125
        }],
        115: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }

            function a(t) {
                t.destroy = function() {}, t.on = function() {}, t.once = function() {}, t.emit = function() {}
            }
            r.__esModule = !0;
            var u = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                h = t("./BaseTexture"),
                l = n(h),
                c = t("./VideoBaseTexture"),
                d = n(c),
                f = t("./TextureUvs"),
                p = n(f),
                v = t("eventemitter3"),
                y = n(v),
                g = t("../math"),
                m = t("../utils"),
                _ = t("../settings"),
                b = n(_),
                x = function(t) {
                    function e(r, n, s, a, u) {
                        i(this, e);
                        var h = o(this, t.call(this));
                        if (h.noFrame = !1, n || (h.noFrame = !0, n = new g.Rectangle(0, 0, 1, 1)), r instanceof e && (r = r.baseTexture), h.baseTexture = r, h._frame = n, h.trim = a, h.valid = !1, h.requiresUpdate = !1, h._uvs = null, h.orig = s || n, h._rotate = Number(u || 0), !0 === u) h._rotate = 2;
                        else if (h._rotate % 2 != 0) throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");
                        return r.hasLoaded ? (h.noFrame && (n = new g.Rectangle(0, 0, r.width, r.height), r.on("update", h.onBaseTextureUpdated, h)), h.frame = n) : r.once("loaded", h.onBaseTextureLoaded, h), h._updateID = 0, h.transform = null, h.textureCacheIds = [], h
                    }
                    return s(e, t), e.prototype.update = function() {
                        this.baseTexture.update()
                    }, e.prototype.onBaseTextureLoaded = function(t) {
                        this._updateID++, this.noFrame ? this.frame = new g.Rectangle(0, 0, t.width, t.height) : this.frame = this._frame, this.baseTexture.on("update", this.onBaseTextureUpdated, this), this.emit("update", this)
                    }, e.prototype.onBaseTextureUpdated = function(t) {
                        this._updateID++, this._frame.width = t.width, this._frame.height = t.height, this.emit("update", this)
                    }, e.prototype.destroy = function(t) {
                        this.baseTexture && (t && (m.TextureCache[this.baseTexture.imageUrl] && e.removeFromCache(this.baseTexture.imageUrl), this.baseTexture.destroy()), this.baseTexture.off("update", this.onBaseTextureUpdated, this), this.baseTexture.off("loaded", this.onBaseTextureLoaded, this), this.baseTexture = null), this._frame = null, this._uvs = null, this.trim = null, this.orig = null, this.valid = !1, e.removeFromCache(this), this.textureCacheIds = null
                    }, e.prototype.clone = function() {
                        return new e(this.baseTexture, this.frame, this.orig, this.trim, this.rotate)
                    }, e.prototype._updateUvs = function() {
                        this._uvs || (this._uvs = new p.default), this._uvs.set(this._frame, this.baseTexture, this.rotate), this._updateID++
                    }, e.fromImage = function(t, r, n, i) {
                        var o = m.TextureCache[t];
                        return o || (o = new e(l.default.fromImage(t, r, n, i)), e.addToCache(o, t)), o
                    }, e.fromFrame = function(t) {
                        var e = m.TextureCache[t];
                        if (!e) throw new Error('The frameId "' + t + '" does not exist in the texture cache');
                        return e
                    }, e.fromCanvas = function(t, r) {
                        var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "canvas";
                        return new e(l.default.fromCanvas(t, r, n))
                    }, e.fromVideo = function(t, r) {
                        return "string" == typeof t ? e.fromVideoUrl(t, r) : new e(d.default.fromVideo(t, r))
                    }, e.fromVideoUrl = function(t, r) {
                        return new e(d.default.fromUrl(t, r))
                    }, e.from = function(t) {
                        if ("string" == typeof t) {
                            var r = m.TextureCache[t];
                            if (!r) {
                                return null !== t.match(/\.(mp4|webm|ogg|h264|avi|mov)$/) ? e.fromVideoUrl(t) : e.fromImage(t)
                            }
                            return r
                        }
                        return t instanceof HTMLImageElement ? new e(l.default.from(t)) : t instanceof HTMLCanvasElement ? e.fromCanvas(t, b.default.SCALE_MODE, "HTMLCanvasElement") : t instanceof HTMLVideoElement ? e.fromVideo(t) : t instanceof l.default ? new e(t) : t
                    }, e.fromLoader = function(t, r, n) {
                        var i = new l.default(t, void 0, (0, m.getResolutionOfUrl)(r)),
                            o = new e(i);
                        return i.imageUrl = r, n || (n = r), l.default.addToCache(o.baseTexture, n), e.addToCache(o, n), n !== r && (l.default.addToCache(o.baseTexture, r), e.addToCache(o, r)), o
                    }, e.addToCache = function(t, e) {
                        e && (-1 === t.textureCacheIds.indexOf(e) && t.textureCacheIds.push(e), m.TextureCache[e] = t)
                    }, e.removeFromCache = function(t) {
                        if ("string" == typeof t) {
                            var e = m.TextureCache[t];
                            if (e) {
                                var r = e.textureCacheIds.indexOf(t);
                                return r > -1 && e.textureCacheIds.splice(r, 1), delete m.TextureCache[t], e
                            }
                        } else if (t && t.textureCacheIds) {
                            for (var n = 0; n < t.textureCacheIds.length; ++n) m.TextureCache[t.textureCacheIds[n]] === t && delete m.TextureCache[t.textureCacheIds[n]];
                            return t.textureCacheIds.length = 0, t
                        }
                        return null
                    }, u(e, [{
                        key: "frame",
                        get: function() {
                            return this._frame
                        },
                        set: function(t) {
                            this._frame = t, this.noFrame = !1;
                            var e = t.x,
                                r = t.y,
                                n = t.width,
                                i = t.height,
                                o = e + n > this.baseTexture.width,
                                s = r + i > this.baseTexture.height;
                            if (o || s) {
                                var a = o && s ? "and" : "or",
                                    u = "X: " + e + " + " + n + " = " + (e + n) + " > " + this.baseTexture.width,
                                    h = "Y: " + r + " + " + i + " = " + (r + i) + " > " + this.baseTexture.height;
                                throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: " + u + " " + a + " " + h)
                            }
                            this.valid = n && i && this.baseTexture.hasLoaded, this.trim || this.rotate || (this.orig = t), this.valid && this._updateUvs()
                        }
                    }, {
                        key: "rotate",
                        get: function() {
                            return this._rotate
                        },
                        set: function(t) {
                            this._rotate = t, this.valid && this._updateUvs()
                        }
                    }, {
                        key: "width",
                        get: function() {
                            return this.orig.width
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return this.orig.height
                        }
                    }]), e
                }(y.default);
            r.default = x, x.EMPTY = new x(new l.default), a(x.EMPTY), a(x.EMPTY.baseTexture), x.WHITE = function() {
                var t = document.createElement("canvas");
                t.width = 10, t.height = 10;
                var e = t.getContext("2d");
                return e.fillStyle = "white", e.fillRect(0, 0, 10, 10), new x(new l.default(t))
            }(), a(x.WHITE), a(x.WHITE.baseTexture)
        }, {
            "../math": 70,
            "../settings": 101,
            "../utils": 125,
            "./BaseTexture": 112,
            "./TextureUvs": 117,
            "./VideoBaseTexture": 118,
            eventemitter3: 3
        }],
        116: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = t("../math/Matrix"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = new s.default,
                u = function() {
                    function t(e, r) {
                        n(this, t), this._texture = e, this.mapCoord = new s.default, this.uClampFrame = new Float32Array(4), this.uClampOffset = new Float32Array(2), this._lastTextureID = -1, this.clampOffset = 0, this.clampMargin = void 0 === r ? .5 : r
                    }
                    return t.prototype.multiplyUvs = function(t, e) {
                        void 0 === e && (e = t);
                        for (var r = this.mapCoord, n = 0; n < t.length; n += 2) {
                            var i = t[n],
                                o = t[n + 1];
                            e[n] = i * r.a + o * r.c + r.tx, e[n + 1] = i * r.b + o * r.d + r.ty
                        }
                        return e
                    }, t.prototype.update = function(t) {
                        var e = this._texture;
                        if (!e || !e.valid) return !1;
                        if (!t && this._lastTextureID === e._updateID) return !1;
                        this._lastTextureID = e._updateID;
                        var r = e._uvs;
                        this.mapCoord.set(r.x1 - r.x0, r.y1 - r.y0, r.x3 - r.x0, r.y3 - r.y0, r.x0, r.y0);
                        var n = e.orig,
                            i = e.trim;
                        i && (a.set(n.width / i.width, 0, 0, n.height / i.height, -i.x / i.width, -i.y / i.height), this.mapCoord.append(a));
                        var o = e.baseTexture,
                            s = this.uClampFrame,
                            u = this.clampMargin / o.resolution,
                            h = this.clampOffset;
                        return s[0] = (e._frame.x + u + h) / o.width, s[1] = (e._frame.y + u + h) / o.height, s[2] = (e._frame.x + e._frame.width - u + h) / o.width, s[3] = (e._frame.y + e._frame.height - u + h) / o.height, this.uClampOffset[0] = h / o.realWidth, this.uClampOffset[1] = h / o.realHeight, !0
                    }, i(t, [{
                        key: "texture",
                        get: function() {
                            return this._texture
                        },
                        set: function(t) {
                            this._texture = t, this._lastTextureID = -1
                        }
                    }]), t
                }();
            r.default = u
        }, {
            "../math/Matrix": 67
        }],
        117: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../math/GroupD8"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = function() {
                    function t() {
                        n(this, t), this.x0 = 0, this.y0 = 0, this.x1 = 1, this.y1 = 0, this.x2 = 1, this.y2 = 1, this.x3 = 0, this.y3 = 1, this.uvsUint32 = new Uint32Array(4)
                    }
                    return t.prototype.set = function(t, e, r) {
                        var n = e.width,
                            i = e.height;
                        if (r) {
                            var s = t.width / 2 / n,
                                a = t.height / 2 / i,
                                u = t.x / n + s,
                                h = t.y / i + a;
                            r = o.default.add(r, o.default.NW), this.x0 = u + s * o.default.uX(r), this.y0 = h + a * o.default.uY(r), r = o.default.add(r, 2), this.x1 = u + s * o.default.uX(r), this.y1 = h + a * o.default.uY(r), r = o.default.add(r, 2), this.x2 = u + s * o.default.uX(r), this.y2 = h + a * o.default.uY(r), r = o.default.add(r, 2), this.x3 = u + s * o.default.uX(r), this.y3 = h + a * o.default.uY(r)
                        } else this.x0 = t.x / n, this.y0 = t.y / i, this.x1 = (t.x + t.width) / n, this.y1 = t.y / i, this.x2 = (t.x + t.width) / n, this.y2 = (t.y + t.height) / i, this.x3 = t.x / n, this.y3 = (t.y + t.height) / i;
                        this.uvsUint32[0] = (65535 * this.y0 & 65535) << 16 | 65535 * this.x0 & 65535, this.uvsUint32[1] = (65535 * this.y1 & 65535) << 16 | 65535 * this.x1 & 65535, this.uvsUint32[2] = (65535 * this.y2 & 65535) << 16 | 65535 * this.x2 & 65535, this.uvsUint32[3] = (65535 * this.y3 & 65535) << 16 | 65535 * this.x3 & 65535
                    }, t
                }();
            r.default = s
        }, {
            "../math/GroupD8": 66
        }],
        118: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }

            function a(t, e) {
                e || (e = "video/" + t.substr(t.lastIndexOf(".") + 1));
                var r = document.createElement("source");
                return r.src = t, r.type = e, r
            }
            r.__esModule = !0;
            var u = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                h = t("./BaseTexture"),
                l = n(h),
                c = t("../utils"),
                d = t("../ticker"),
                f = t("../const"),
                p = t("../utils/determineCrossOrigin"),
                v = n(p),
                y = function(t) {
                    function e(r, n) {
                        if (i(this, e), !r) throw new Error("No video source element specified.");
                        (r.readyState === r.HAVE_ENOUGH_DATA || r.readyState === r.HAVE_FUTURE_DATA) && r.width && r.height && (r.complete = !0);
                        var s = o(this, t.call(this, r, n));
                        return s.width = r.videoWidth, s.height = r.videoHeight, s._autoUpdate = !0, s._isAutoUpdating = !1, s.autoPlay = !0, s.update = s.update.bind(s), s._onCanPlay = s._onCanPlay.bind(s), r.addEventListener("play", s._onPlayStart.bind(s)), r.addEventListener("pause", s._onPlayStop.bind(s)), s.hasLoaded = !1, s.__loaded = !1, s._isSourceReady() ? s._onCanPlay() : (r.addEventListener("canplay", s._onCanPlay), r.addEventListener("canplaythrough", s._onCanPlay)), s
                    }
                    return s(e, t), e.prototype._isSourcePlaying = function() {
                        var t = this.source;
                        return t.currentTime > 0 && !1 === t.paused && !1 === t.ended && t.readyState > 2
                    }, e.prototype._isSourceReady = function() {
                        return 3 === this.source.readyState || 4 === this.source.readyState
                    }, e.prototype._onPlayStart = function() {
                        this.hasLoaded || this._onCanPlay(), !this._isAutoUpdating && this.autoUpdate && (d.shared.add(this.update, this, f.UPDATE_PRIORITY.HIGH), this._isAutoUpdating = !0)
                    }, e.prototype._onPlayStop = function() {
                        this._isAutoUpdating && (d.shared.remove(this.update, this), this._isAutoUpdating = !1)
                    }, e.prototype._onCanPlay = function() {
                        this.hasLoaded = !0, this.source && (this.source.removeEventListener("canplay", this._onCanPlay), this.source.removeEventListener("canplaythrough", this._onCanPlay), this.width = this.source.videoWidth, this.height = this.source.videoHeight, this.__loaded || (this.__loaded = !0, this.emit("loaded", this)), this._isSourcePlaying() ? this._onPlayStart() : this.autoPlay && this.source.play())
                    }, e.prototype.destroy = function() {
                        this._isAutoUpdating && d.shared.remove(this.update, this), this.source && this.source._pixiId && (l.default.removeFromCache(this.source._pixiId), delete this.source._pixiId, this.source.pause(), this.source.src = "", this.source.load()), t.prototype.destroy.call(this)
                    }, e.fromVideo = function(t, r) {
                        t._pixiId || (t._pixiId = "video_" + (0, c.uid)());
                        var n = c.BaseTextureCache[t._pixiId];
                        return n || (n = new e(t, r), l.default.addToCache(n, t._pixiId)), n
                    }, e.fromUrl = function(t, r, n) {
                        var i = document.createElement("video");
                        i.setAttribute("webkit-playsinline", ""), i.setAttribute("playsinline", "");
                        var o = Array.isArray(t) ? t[0].src || t[0] : t.src || t;
                        if (void 0 === n && 0 !== o.indexOf("data:") ? i.crossOrigin = (0, v.default)(o) : n && (i.crossOrigin = "string" == typeof n ? n : "anonymous"), Array.isArray(t))
                            for (var s = 0; s < t.length; ++s) i.appendChild(a(t[s].src || t[s], t[s].mime));
                        else i.appendChild(a(o, t.mime));
                        return i.load(), e.fromVideo(i, r)
                    }, u(e, [{
                        key: "autoUpdate",
                        get: function() {
                            return this._autoUpdate
                        },
                        set: function(t) {
                            t !== this._autoUpdate && (this._autoUpdate = t, !this._autoUpdate && this._isAutoUpdating ? (d.shared.remove(this.update, this), this._isAutoUpdating = !1) : this._autoUpdate && !this._isAutoUpdating && (d.shared.add(this.update, this, f.UPDATE_PRIORITY.HIGH), this._isAutoUpdating = !0))
                        }
                    }]), e
                }(l.default);
            r.default = y, y.fromUrls = y.fromUrl
        }, {
            "../const": 46,
            "../ticker": 121,
            "../utils": 125,
            "../utils/determineCrossOrigin": 124,
            "./BaseTexture": 112
        }],
        119: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                s = t("../settings"),
                a = n(s),
                u = t("../const"),
                h = t("./TickerListener"),
                l = n(h),
                c = function() {
                    function t() {
                        var e = this;
                        i(this, t), this._head = new l.default(null, null, 1 / 0), this._requestId = null, this._maxElapsedMS = 100, this.autoStart = !1, this.deltaTime = 1, this.elapsedMS = 1 / a.default.TARGET_FPMS, this.lastTime = -1, this.speed = 1, this.started = !1, this._tick = function(t) {
                            e._requestId = null, e.started && (e.update(t), e.started && null === e._requestId && e._head.next && (e._requestId = requestAnimationFrame(e._tick)))
                        }
                    }
                    return t.prototype._requestIfNeeded = function() {
                        null === this._requestId && this._head.next && (this.lastTime = performance.now(), this._requestId = requestAnimationFrame(this._tick))
                    }, t.prototype._cancelIfNeeded = function() {
                        null !== this._requestId && (cancelAnimationFrame(this._requestId), this._requestId = null)
                    }, t.prototype._startIfPossible = function() {
                        this.started ? this._requestIfNeeded() : this.autoStart && this.start()
                    }, t.prototype.add = function(t, e) {
                        var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : u.UPDATE_PRIORITY.NORMAL;
                        return this._addListener(new l.default(t, e, r))
                    }, t.prototype.addOnce = function(t, e) {
                        var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : u.UPDATE_PRIORITY.NORMAL;
                        return this._addListener(new l.default(t, e, r, !0))
                    }, t.prototype._addListener = function(t) {
                        var e = this._head.next,
                            r = this._head;
                        if (e) {
                            for (; e;) {
                                if (t.priority > e.priority) {
                                    t.connect(r);
                                    break
                                }
                                r = e, e = e.next
                            }
                            t.previous || t.connect(r)
                        } else t.connect(r);
                        return this._startIfPossible(), this
                    }, t.prototype.remove = function(t, e) {
                        for (var r = this._head.next; r;) r = r.match(t, e) ? r.destroy() : r.next;
                        return this._head.next || this._cancelIfNeeded(), this
                    }, t.prototype.start = function() {
                        this.started || (this.started = !0, this._requestIfNeeded())
                    }, t.prototype.stop = function() {
                        this.started && (this.started = !1, this._cancelIfNeeded())
                    }, t.prototype.destroy = function() {
                        this.stop();
                        for (var t = this._head.next; t;) t = t.destroy(!0);
                        this._head.destroy(), this._head = null
                    }, t.prototype.update = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : performance.now(),
                            e = void 0;
                        if (t > this.lastTime) {
                            e = this.elapsedMS = t - this.lastTime, e > this._maxElapsedMS && (e = this._maxElapsedMS), this.deltaTime = e * a.default.TARGET_FPMS * this.speed;
                            for (var r = this._head, n = r.next; n;) n = n.emit(this.deltaTime);
                            r.next || this._cancelIfNeeded()
                        } else this.deltaTime = this.elapsedMS = 0;
                        this.lastTime = t
                    }, o(t, [{
                        key: "FPS",
                        get: function() {
                            return 1e3 / this.elapsedMS
                        }
                    }, {
                        key: "minFPS",
                        get: function() {
                            return 1e3 / this._maxElapsedMS
                        },
                        set: function(t) {
                            var e = Math.min(Math.max(0, t) / 1e3, a.default.TARGET_FPMS);
                            this._maxElapsedMS = 1 / e
                        }
                    }]), t
                }();
            r.default = c
        }, {
            "../const": 46,
            "../settings": 101,
            "./TickerListener": 120
        }],
        120: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t(e) {
                    var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null,
                        i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
                        o = arguments.length > 3 && void 0 !== arguments[3] && arguments[3];
                    n(this, t), this.fn = e, this.context = r, this.priority = i, this.once = o, this.next = null, this.previous = null, this._destroyed = !1
                }
                return t.prototype.match = function(t, e) {
                    return e = e || null, this.fn === t && this.context === e
                }, t.prototype.emit = function(t) {
                    this.fn && (this.context ? this.fn.call(this.context, t) : this.fn(t));
                    var e = this.next;
                    return this.once && this.destroy(!0), this._destroyed && (this.next = null), e
                }, t.prototype.connect = function(t) {
                    this.previous = t, t.next && (t.next.previous = this), this.next = t.next, t.next = this
                }, t.prototype.destroy = function() {
                    var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
                    this._destroyed = !0, this.fn = null, this.context = null, this.previous && (this.previous.next = this.next), this.next && (this.next.previous = this.previous);
                    var e = this.previous;
                    return this.next = t ? null : e, this.previous = null, e
                }, t
            }();
            r.default = i
        }, {}],
        121: [function(t, e, r) {
            "use strict";
            r.__esModule = !0, r.Ticker = r.shared = void 0;
            var n = t("./Ticker"),
                i = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(n),
                o = new i.default;
            o.autoStart = !0, o.destroy = function() {}, r.shared = o, r.Ticker = i.default
        }, {
            "./Ticker": 119
        }],
        122: [function(t, e, r) {
            "use strict";

            function n() {
                return !(!!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform))
            }
            r.__esModule = !0, r.default = n
        }, {}],
        123: [function(t, e, r) {
            "use strict";

            function n(t) {
                for (var e = 6 * t, r = new Uint16Array(e), n = 0, i = 0; n < e; n += 6, i += 4) r[n + 0] = i + 0, r[n + 1] = i + 1, r[n + 2] = i + 2, r[n + 3] = i + 0, r[n + 4] = i + 2, r[n + 5] = i + 3;
                return r
            }
            r.__esModule = !0, r.default = n
        }, {}],
        124: [function(t, e, r) {
            "use strict";

            function n(t) {
                var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : window.location;
                if (0 === t.indexOf("data:")) return "";
                e = e || window.location, s || (s = document.createElement("a")), s.href = t, t = o.default.parse(s.href);
                var r = !t.port && "" === e.port || t.port === e.port;
                return t.hostname === e.hostname && r && t.protocol === e.protocol ? "" : "anonymous"
            }
            r.__esModule = !0, r.default = n;
            var i = t("url"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i),
                s = void 0
        }, {
            url: 38
        }],
        125: [function(t, e, r) {
            "use strict";

            function n(t) {
                if (t && t.__esModule) return t;
                var e = {};
                if (null != t)
                    for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                return e.default = t, e
            }

            function i(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function o() {
                return ++U
            }

            function s(t, e) {
                return e = e || [], e[0] = (t >> 16 & 255) / 255, e[1] = (t >> 8 & 255) / 255, e[2] = (255 & t) / 255, e
            }

            function a(t) {
                return t = t.toString(16), "#" + (t = "000000".substr(0, 6 - t.length) + t)
            }

            function u(t) {
                return (255 * t[0] << 16) + (255 * t[1] << 8) + (255 * t[2] | 0)
            }

            function h(t, e) {
                var r = S.default.RETINA_PREFIX.exec(t);
                return r ? parseFloat(r[1]) : void 0 !== e ? e : 1
            }

            function l(t) {
                var e = w.DATA_URI.exec(t);
                if (e) return {
                    mediaType: e[1] ? e[1].toLowerCase() : void 0,
                    subType: e[2] ? e[2].toLowerCase() : void 0,
                    encoding: e[3] ? e[3].toLowerCase() : void 0,
                    data: e[4]
                }
            }

            function c(t) {
                var e = w.URL_FILE_EXTENSION.exec(t);
                if (e) return e[1].toLowerCase()
            }

            function d(t) {
                var e = w.SVG_SIZE.exec(t),
                    r = {};
                return e && (r[e[1]] = Math.round(parseFloat(e[3])), r[e[5]] = Math.round(parseFloat(e[7]))), r
            }

            function f() {
                X = !0
            }

            function p(t) {
                if (!X) {
                    if (navigator.userAgent.toLowerCase().indexOf("chrome") > -1) {
                        var e = ["\n %c %c %c PixiJS " + w.VERSION + " - вњ° " + t + " вњ°  %c  %c  http://www.pixijs.com/  %c %c в™Ґ%cв™Ґ%cв™Ґ \n\n", "background: #ff66a5; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "color: #ff66a5; background: #030307; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "background: #ffc3dc; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;"];
                        window.console.log.apply(console, e)
                    } else window.console && window.console.log("PixiJS " + w.VERSION + " - " + t + " - http://www.pixijs.com/");
                    X = !0
                }
            }

            function v() {
                var t = {
                    stencil: !0,
                    failIfMajorPerformanceCaveat: !0
                };
                try {
                    if (!window.WebGLRenderingContext) return !1;
                    var e = document.createElement("canvas"),
                        r = e.getContext("webgl", t) || e.getContext("experimental-webgl", t),
                        n = !(!r || !r.getContextAttributes().stencil);
                    if (r) {
                        var i = r.getExtension("WEBGL_lose_context");
                        i && i.loseContext()
                    }
                    return r = null, n
                } catch (t) {
                    return !1
                }
            }

            function y(t) {
                return 0 === t ? 0 : t < 0 ? -1 : 1
            }

            function g() {
                var t = void 0;
                for (t in G) G[t].destroy();
                for (t in W) W[t].destroy()
            }

            function m() {
                var t = void 0;
                for (t in G) delete G[t];
                for (t in W) delete W[t]
            }

            function _(t, e) {
                return H[e ? 1 : 0][t]
            }

            function b(t, e) {
                if (1 === e) return (255 * e << 24) + t;
                if (0 === e) return 0;
                var r = t >> 16 & 255,
                    n = t >> 8 & 255,
                    i = 255 & t;
                return r = r * e + .5 | 0, n = n * e + .5 | 0, i = i * e + .5 | 0, (255 * e << 24) + (r << 16) + (n << 8) + i
            }

            function x(t, e, r, n) {
                return r = r || new Float32Array(4), n || void 0 === n ? (r[0] = t[0] * e, r[1] = t[1] * e, r[2] = t[2] * e) : (r[0] = t[0], r[1] = t[1], r[2] = t[2]), r[3] = e, r
            }

            function T(t, e, r, n) {
                return r = r || new Float32Array(4), r[0] = (t >> 16 & 255) / 255, r[1] = (t >> 8 & 255) / 255, r[2] = (255 & t) / 255, (n || void 0 === n) && (r[0] *= e, r[1] *= e, r[2] *= e), r[3] = e, r
            }
            r.__esModule = !0, r.premultiplyBlendMode = r.BaseTextureCache = r.TextureCache = r.earcut = r.mixins = r.pluginTarget = r.EventEmitter = r.removeItems = r.isMobile = void 0, r.uid = o, r.hex2rgb = s, r.hex2string = a, r.rgb2hex = u, r.getResolutionOfUrl = h, r.decomposeDataUri = l, r.getUrlFileExtension = c, r.getSvgSize = d, r.skipHello = f, r.sayHello = p, r.isWebGLSupported = v, r.sign = y, r.destroyTextureCache = g, r.clearTextureCache = m, r.correctBlendMode = _, r.premultiplyTint = b, r.premultiplyRgba = x, r.premultiplyTintToRgba = T;
            var w = t("../const"),
                E = t("../settings"),
                S = i(E),
                O = t("eventemitter3"),
                M = i(O),
                P = t("./pluginTarget"),
                C = i(P),
                R = t("./mixin"),
                A = n(R),
                I = t("ismobilejs"),
                D = n(I),
                L = t("remove-array-items"),
                N = i(L),
                F = t("./mapPremultipliedBlendModes"),
                B = i(F),
                k = t("earcut"),
                j = i(k),
                U = 0,
                X = !1;
            r.isMobile = D, r.removeItems = N.default, r.EventEmitter = M.default, r.pluginTarget = C.default, r.mixins = A, r.earcut = j.default;
            var G = r.TextureCache = Object.create(null),
                W = r.BaseTextureCache = Object.create(null),
                H = r.premultiplyBlendMode = (0, B.default)()
        }, {
            "../const": 46,
            "../settings": 101,
            "./mapPremultipliedBlendModes": 126,
            "./mixin": 128,
            "./pluginTarget": 129,
            earcut: 2,
            eventemitter3: 3,
            ismobilejs: 4,
            "remove-array-items": 31
        }],
        126: [function(t, e, r) {
            "use strict";

            function n() {
                for (var t = [], e = [], r = 0; r < 32; r++) t[r] = r, e[r] = r;
                t[i.BLEND_MODES.NORMAL_NPM] = i.BLEND_MODES.NORMAL, t[i.BLEND_MODES.ADD_NPM] = i.BLEND_MODES.ADD, t[i.BLEND_MODES.SCREEN_NPM] = i.BLEND_MODES.SCREEN, e[i.BLEND_MODES.NORMAL] = i.BLEND_MODES.NORMAL_NPM, e[i.BLEND_MODES.ADD] = i.BLEND_MODES.ADD_NPM, e[i.BLEND_MODES.SCREEN] = i.BLEND_MODES.SCREEN_NPM;
                var n = [];
                return n.push(e), n.push(t), n
            }
            r.__esModule = !0, r.default = n;
            var i = t("../const")
        }, {
            "../const": 46
        }],
        127: [function(t, e, r) {
            "use strict";

            function n(t) {
                return o.default.tablet || o.default.phone ? 4 : t
            }
            r.__esModule = !0, r.default = n;
            var i = t("ismobilejs"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i)
        }, {
            ismobilejs: 4
        }],
        128: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (t && e)
                    for (var r = Object.keys(e), n = 0; n < r.length; ++n) {
                        var i = r[n];
                        Object.defineProperty(t, i, Object.getOwnPropertyDescriptor(e, i))
                    }
            }

            function i(t, e) {
                s.push(t, e)
            }

            function o() {
                for (var t = 0; t < s.length; t += 2) n(s[t], s[t + 1]);
                s.length = 0
            }
            r.__esModule = !0, r.mixin = n, r.delayMixin = i, r.performMixins = o;
            var s = []
        }, {}],
        129: [function(t, e, r) {
            "use strict";

            function n(t) {
                t.__plugins = {}, t.registerPlugin = function(e, r) {
                    t.__plugins[e] = r
                }, t.prototype.initPlugins = function() {
                    this.plugins = this.plugins || {};
                    for (var e in t.__plugins) this.plugins[e] = new t.__plugins[e](this)
                }, t.prototype.destroyPlugins = function() {
                    for (var t in this.plugins) this.plugins[t].destroy(), this.plugins[t] = null;
                    this.plugins = null
                }
            }
            r.__esModule = !0, r.default = {
                mixin: function(t) {
                    n(t)
                }
            }
        }, {}],
        130: [function(t, e, r) {
            "use strict";

            function n(t) {
                var e = t.width,
                    r = t.height,
                    n = t.getContext("2d"),
                    i = n.getImageData(0, 0, e, r),
                    o = i.data,
                    s = o.length,
                    a = {
                        top: null,
                        left: null,
                        right: null,
                        bottom: null
                    },
                    u = void 0,
                    h = void 0,
                    l = void 0;
                for (u = 0; u < s; u += 4) 0 !== o[u + 3] && (h = u / 4 % e, l = ~~(u / 4 / e), null === a.top && (a.top = l), null === a.left ? a.left = h : h < a.left && (a.left = h), null === a.right ? a.right = h + 1 : a.right < h && (a.right = h + 1), null === a.bottom ? a.bottom = l : a.bottom < l && (a.bottom = l));
                return e = a.right - a.left, r = a.bottom - a.top + 1, {
                    height: r,
                    width: e,
                    data: n.getImageData(a.left, a.top, e, r)
                }
            }
            r.__esModule = !0, r.default = n
        }, {}],
        131: [function(t, e, r) {
            "use strict";

            function n(t) {}

            function i(t) {
                var e = t.mesh,
                    r = t.particles,
                    i = t.extras,
                    o = t.filters,
                    s = t.prepare,
                    a = t.loaders,
                    u = t.interaction;
                Object.defineProperties(t, {
                    SpriteBatch: {
                        get: function() {
                            throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")
                        }
                    },
                    AssetLoader: {
                        get: function() {
                            throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.")
                        }
                    },
                    Stage: {
                        get: function() {
                            return n("You do not need to use a PIXI Stage any more, you can simply render any container."), t.Container
                        }
                    },
                    DisplayObjectContainer: {
                        get: function() {
                            return n("DisplayObjectContainer has been shortened to Container, please use Container from now on."), t.Container
                        }
                    },
                    Strip: {
                        get: function() {
                            return n("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."), e.Mesh
                        }
                    },
                    Rope: {
                        get: function() {
                            return n("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."), e.Rope
                        }
                    },
                    ParticleContainer: {
                        get: function() {
                            return n("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."), r.ParticleContainer
                        }
                    },
                    MovieClip: {
                        get: function() {
                            return n("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."), i.AnimatedSprite
                        }
                    },
                    TilingSprite: {
                        get: function() {
                            return n("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."), i.TilingSprite
                        }
                    },
                    BitmapText: {
                        get: function() {
                            return n("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."), i.BitmapText
                        }
                    },
                    blendModes: {
                        get: function() {
                            return n("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."), t.BLEND_MODES
                        }
                    },
                    scaleModes: {
                        get: function() {
                            return n("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."), t.SCALE_MODES
                        }
                    },
                    BaseTextureCache: {
                        get: function() {
                            return n("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."), t.utils.BaseTextureCache
                        }
                    },
                    TextureCache: {
                        get: function() {
                            return n("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."), t.utils.TextureCache
                        }
                    },
                    math: {
                        get: function() {
                            return n("The math namespace is deprecated, please access members already accessible on PIXI."), t
                        }
                    },
                    AbstractFilter: {
                        get: function() {
                            return n("AstractFilter has been renamed to Filter, please use PIXI.Filter"), t.Filter
                        }
                    },
                    TransformManual: {
                        get: function() {
                            return n("TransformManual has been renamed to TransformBase, please update your pixi-spine"), t.TransformBase
                        }
                    },
                    TARGET_FPMS: {
                        get: function() {
                            return n("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"), t.settings.TARGET_FPMS
                        },
                        set: function(e) {
                            n("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"), t.settings.TARGET_FPMS = e
                        }
                    },
                    FILTER_RESOLUTION: {
                        get: function() {
                            return n("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"), t.settings.FILTER_RESOLUTION
                        },
                        set: function(e) {
                            n("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"), t.settings.FILTER_RESOLUTION = e
                        }
                    },
                    RESOLUTION: {
                        get: function() {
                            return n("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"), t.settings.RESOLUTION
                        },
                        set: function(e) {
                            n("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"), t.settings.RESOLUTION = e
                        }
                    },
                    MIPMAP_TEXTURES: {
                        get: function() {
                            return n("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"), t.settings.MIPMAP_TEXTURES
                        },
                        set: function(e) {
                            n("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"), t.settings.MIPMAP_TEXTURES = e
                        }
                    },
                    SPRITE_BATCH_SIZE: {
                        get: function() {
                            return n("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"), t.settings.SPRITE_BATCH_SIZE
                        },
                        set: function(e) {
                            n("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"), t.settings.SPRITE_BATCH_SIZE = e
                        }
                    },
                    SPRITE_MAX_TEXTURES: {
                        get: function() {
                            return n("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"), t.settings.SPRITE_MAX_TEXTURES
                        },
                        set: function(e) {
                            n("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"), t.settings.SPRITE_MAX_TEXTURES = e
                        }
                    },
                    RETINA_PREFIX: {
                        get: function() {
                            return n("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"), t.settings.RETINA_PREFIX
                        },
                        set: function(e) {
                            n("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"), t.settings.RETINA_PREFIX = e
                        }
                    },
                    DEFAULT_RENDER_OPTIONS: {
                        get: function() {
                            return n("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"), t.settings.RENDER_OPTIONS
                        }
                    }
                });
                for (var h = [{
                        parent: "TRANSFORM_MODE",
                        target: "TRANSFORM_MODE"
                    }, {
                        parent: "GC_MODES",
                        target: "GC_MODE"
                    }, {
                        parent: "WRAP_MODES",
                        target: "WRAP_MODE"
                    }, {
                        parent: "SCALE_MODES",
                        target: "SCALE_MODE"
                    }, {
                        parent: "PRECISION",
                        target: "PRECISION_FRAGMENT"
                    }], l = 0; l < h.length; l++) ! function(e) {
                    var r = h[e];
                    Object.defineProperty(t[r.parent], "DEFAULT", {
                        get: function() {
                            return n("PIXI." + r.parent + ".DEFAULT has been deprecated, please use PIXI.settings." + r.target), t.settings[r.target]
                        },
                        set: function(e) {
                            n("PIXI." + r.parent + ".DEFAULT has been deprecated, please use PIXI.settings." + r.target), t.settings[r.target] = e
                        }
                    })
                }(l);
                Object.defineProperties(t.settings, {
                    PRECISION: {
                        get: function() {
                            return n("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"), t.settings.PRECISION_FRAGMENT
                        },
                        set: function(e) {
                            n("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"), t.settings.PRECISION_FRAGMENT = e
                        }
                    }
                }), i.AnimatedSprite && Object.defineProperties(i, {
                    MovieClip: {
                        get: function() {
                            return n("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."), i.AnimatedSprite
                        }
                    }
                }), i && Object.defineProperties(i, {
                    TextureTransform: {
                        get: function() {
                            return n("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."), t.TextureMatrix
                        }
                    }
                }), t.DisplayObject.prototype.generateTexture = function(t, e, r) {
                    return n("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"), t.generateTexture(this, e, r)
                }, t.Graphics.prototype.generateTexture = function(t, e) {
                    return n("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"), this.generateCanvasTexture(t, e)
                }, t.GroupD8.isSwapWidthHeight = function(e) {
                    return n("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"), t.GroupD8.isVertical(e)
                }, t.RenderTexture.prototype.render = function(t, e, r, i) {
                    this.legacyRenderer.render(t, this, r, e, !i), n("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")
                }, t.RenderTexture.prototype.getImage = function(t) {
                    return n("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"), this.legacyRenderer.extract.image(t)
                }, t.RenderTexture.prototype.getBase64 = function(t) {
                    return n("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"), this.legacyRenderer.extract.base64(t)
                }, t.RenderTexture.prototype.getCanvas = function(t) {
                    return n("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"), this.legacyRenderer.extract.canvas(t)
                }, t.RenderTexture.prototype.getPixels = function(t) {
                    return n("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"), this.legacyRenderer.pixels(t)
                }, t.Sprite.prototype.setTexture = function(t) {
                    this.texture = t, n("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")
                }, i.BitmapText && (i.BitmapText.prototype.setText = function(t) {
                    this.text = t, n("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")
                }), t.Text.prototype.setText = function(t) {
                    this.text = t, n("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")
                }, t.Text.calculateFontProperties = function(e) {
                    return n("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"), t.TextMetrics.measureFont(e)
                }, Object.defineProperties(t.Text, {
                    fontPropertiesCache: {
                        get: function() {
                            return n("Text.fontPropertiesCache is deprecated"), t.TextMetrics._fonts
                        }
                    },
                    fontPropertiesCanvas: {
                        get: function() {
                            return n("Text.fontPropertiesCanvas is deprecated"), t.TextMetrics._canvas
                        }
                    },
                    fontPropertiesContext: {
                        get: function() {
                            return n("Text.fontPropertiesContext is deprecated"), t.TextMetrics._context
                        }
                    }
                }), t.Text.prototype.setStyle = function(t) {
                    this.style = t, n("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")
                }, t.Text.prototype.determineFontProperties = function(e) {
                    return n("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"), t.TextMetrics.measureFont(e)
                }, t.Text.getFontStyle = function(e) {
                    return n("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"), e = e || {}, e instanceof t.TextStyle || (e = new t.TextStyle(e)), e.toFontString()
                }, Object.defineProperties(t.TextStyle.prototype, {
                    font: {
                        get: function() {
                            n("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on");
                            var t = "number" == typeof this._fontSize ? this._fontSize + "px" : this._fontSize;
                            return this._fontStyle + " " + this._fontVariant + " " + this._fontWeight + " " + t + " " + this._fontFamily
                        },
                        set: function(t) {
                            n("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"), t.indexOf("italic") > 1 ? this._fontStyle = "italic" : t.indexOf("oblique") > -1 ? this._fontStyle = "oblique" : this._fontStyle = "normal", t.indexOf("small-caps") > -1 ? this._fontVariant = "small-caps" : this._fontVariant = "normal";
                            var e = t.split(" "),
                                r = -1;
                            this._fontSize = 26;
                            for (var i = 0; i < e.length; ++i)
                                if (e[i].match(/(px|pt|em|%)/)) {
                                    r = i, this._fontSize = e[i];
                                    break
                                } this._fontWeight = "normal";
                            for (var o = 0; o < r; ++o)
                                if (e[o].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)) {
                                    this._fontWeight = e[o];
                                    break
                                } if (r > -1 && r < e.length - 1) {
                                this._fontFamily = "";
                                for (var s = r + 1; s < e.length; ++s) this._fontFamily += e[s] + " ";
                                this._fontFamily = this._fontFamily.slice(0, -1)
                            } else this._fontFamily = "Arial";
                            this.styleID++
                        }
                    }
                }), t.Texture.prototype.setFrame = function(t) {
                    this.frame = t, n("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")
                }, t.Texture.addTextureToCache = function(e, r) {
                    t.Texture.addToCache(e, r), n("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")
                }, t.Texture.removeTextureFromCache = function(e) {
                    return n("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"), t.BaseTexture.removeFromCache(e), t.Texture.removeFromCache(e)
                }, Object.defineProperties(o, {
                    AbstractFilter: {
                        get: function() {
                            return n("AstractFilter has been renamed to Filter, please use PIXI.Filter"), t.AbstractFilter
                        }
                    },
                    SpriteMaskFilter: {
                        get: function() {
                            return n("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."), t.SpriteMaskFilter
                        }
                    },
                    VoidFilter: {
                        get: function() {
                            return n("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"), o.AlphaFilter
                        }
                    }
                }), t.utils.uuid = function() {
                    return n("utils.uuid() is deprecated, please use utils.uid() from now on."), t.utils.uid()
                }, t.utils.canUseNewCanvasBlendModes = function() {
                    return n("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"), t.CanvasTinter.canUseMultiply
                };
                var c = !0;
                if (Object.defineProperty(t.utils, "_saidHello", {
                        set: function(t) {
                            t && (n("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"), this.skipHello()), c = t
                        },
                        get: function() {
                            return c
                        }
                    }), s.BasePrepare && (s.BasePrepare.prototype.register = function(t, e) {
                        return n("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"), t && this.registerFindHook(t), e && this.registerUploadHook(e), this
                    }), s.canvas && Object.defineProperty(s.canvas, "UPLOADS_PER_FRAME", {
                        set: function() {
                            n("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")
                        },
                        get: function() {
                            return n("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"), NaN
                        }
                    }), s.webgl && Object.defineProperty(s.webgl, "UPLOADS_PER_FRAME", {
                        set: function() {
                            n("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")
                        },
                        get: function() {
                            return n("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"), NaN
                        }
                    }), a.Loader) {
                    var d = a.Resource,
                        f = a.Loader;
                    Object.defineProperties(d.prototype, {
                        isJson: {
                            get: function() {
                                return n("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."), this.type === d.TYPE.JSON
                            }
                        },
                        isXml: {
                            get: function() {
                                return n("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."), this.type === d.TYPE.XML
                            }
                        },
                        isImage: {
                            get: function() {
                                return n("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."), this.type === d.TYPE.IMAGE
                            }
                        },
                        isAudio: {
                            get: function() {
                                return n("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."), this.type === d.TYPE.AUDIO
                            }
                        },
                        isVideo: {
                            get: function() {
                                return n("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."), this.type === d.TYPE.VIDEO
                            }
                        }
                    }), Object.defineProperties(f.prototype, {
                        before: {
                            get: function() {
                                return n("The before() method is deprecated, please use pre()."), this.pre
                            }
                        },
                        after: {
                            get: function() {
                                return n("The after() method is deprecated, please use use()."), this.use
                            }
                        }
                    })
                }
                u.interactiveTarget && Object.defineProperty(u.interactiveTarget, "defaultCursor", {
                    set: function(t) {
                        n("Property defaultCursor has been replaced with 'cursor'. "), this.cursor = t
                    },
                    get: function() {
                        return n("Property defaultCursor has been replaced with 'cursor'. "), this.cursor
                    }
                }), u.InteractionManager && (Object.defineProperty(u.InteractionManager, "defaultCursorStyle", {
                    set: function(t) {
                        n("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "), this.cursorStyles.default = t
                    },
                    get: function() {
                        return n("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "), this.cursorStyles.default
                    }
                }), Object.defineProperty(u.InteractionManager, "currentCursorStyle", {
                    set: function(t) {
                        n("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."), this.currentCursorMode = t
                    },
                    get: function() {
                        return n("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."), this.currentCursorMode
                    }
                }))
            }
            r.__esModule = !0, r.default = i
        }, {}],
        132: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../core"),
                o = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(i),
                s = new o.Rectangle,
                a = function() {
                    function t(e) {
                        n(this, t), this.renderer = e, e.extract = this
                    }
                    return t.prototype.image = function(t) {
                        var e = new Image;
                        return e.src = this.base64(t), e
                    }, t.prototype.base64 = function(t) {
                        return this.canvas(t).toDataURL()
                    }, t.prototype.canvas = function(t) {
                        var e = this.renderer,
                            r = void 0,
                            n = void 0,
                            i = void 0,
                            a = void 0;
                        t && (a = t instanceof o.RenderTexture ? t : e.generateTexture(t)), a ? (r = a.baseTexture._canvasRenderTarget.context, n = a.baseTexture._canvasRenderTarget.resolution, i = a.frame) : (r = e.rootContext, i = s, i.width = this.renderer.width, i.height = this.renderer.height);
                        var u = i.width * n,
                            h = i.height * n,
                            l = new o.CanvasRenderTarget(u, h),
                            c = r.getImageData(i.x * n, i.y * n, u, h);
                        return l.context.putImageData(c, 0, 0), l.canvas
                    }, t.prototype.pixels = function(t) {
                        var e = this.renderer,
                            r = void 0,
                            n = void 0,
                            i = void 0,
                            a = void 0;
                        return t && (a = t instanceof o.RenderTexture ? t : e.generateTexture(t)), a ? (r = a.baseTexture._canvasRenderTarget.context, n = a.baseTexture._canvasRenderTarget.resolution, i = a.frame) : (r = e.rootContext, i = s, i.width = e.width, i.height = e.height), r.getImageData(0, 0, i.width * n, i.height * n).data
                    }, t.prototype.destroy = function() {
                        this.renderer.extract = null, this.renderer = null
                    }, t
                }();
            r.default = a, o.CanvasRenderer.registerPlugin("extract", a)
        }, {
            "../../core": 65
        }],
        133: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./webgl/WebGLExtract");
            Object.defineProperty(r, "webgl", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./canvas/CanvasExtract");
            Object.defineProperty(r, "canvas", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            })
        }, {
            "./canvas/CanvasExtract": 132,
            "./webgl/WebGLExtract": 134
        }],
        134: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../core"),
                o = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(i),
                s = new o.Rectangle,
                a = function() {
                    function t(e) {
                        n(this, t), this.renderer = e, e.extract = this
                    }
                    return t.prototype.image = function(t) {
                        var e = new Image;
                        return e.src = this.base64(t), e
                    }, t.prototype.base64 = function(t) {
                        return this.canvas(t).toDataURL()
                    }, t.prototype.canvas = function(t) {
                        var e = this.renderer,
                            r = void 0,
                            n = void 0,
                            i = void 0,
                            a = !1,
                            u = void 0,
                            h = !1;
                        t && (t instanceof o.RenderTexture ? u = t : (u = this.renderer.generateTexture(t), h = !0)), u ? (r = u.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID], n = r.resolution, i = u.frame, a = !1) : (r = this.renderer.rootRenderTarget, n = r.resolution, a = !0, i = s, i.width = r.size.width, i.height = r.size.height);
                        var l = i.width * n,
                            c = i.height * n,
                            d = new o.CanvasRenderTarget(l, c);
                        if (r) {
                            e.bindRenderTarget(r);
                            var f = new Uint8Array(4 * l * c),
                                p = e.gl;
                            p.readPixels(i.x * n, i.y * n, l, c, p.RGBA, p.UNSIGNED_BYTE, f);
                            var v = d.context.getImageData(0, 0, l, c);
                            v.data.set(f), d.context.putImageData(v, 0, 0), a && (d.context.scale(1, -1), d.context.drawImage(d.canvas, 0, -c))
                        }
                        return h && u.destroy(!0), d.canvas
                    }, t.prototype.pixels = function(t) {
                        var e = this.renderer,
                            r = void 0,
                            n = void 0,
                            i = void 0,
                            a = void 0,
                            u = !1;
                        t && (t instanceof o.RenderTexture ? a = t : (a = this.renderer.generateTexture(t), u = !0)), a ? (r = a.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID], n = r.resolution, i = a.frame) : (r = this.renderer.rootRenderTarget, n = r.resolution, i = s, i.width = r.size.width, i.height = r.size.height);
                        var h = i.width * n,
                            l = i.height * n,
                            c = new Uint8Array(4 * h * l);
                        if (r) {
                            e.bindRenderTarget(r);
                            var d = e.gl;
                            d.readPixels(i.x * n, i.y * n, h, l, d.RGBA, d.UNSIGNED_BYTE, c)
                        }
                        return u && a.destroy(!0), c
                    }, t.prototype.destroy = function() {
                        this.renderer.extract = null, this.renderer = null
                    }, t
                }();
            r.default = a, o.WebGLRenderer.registerPlugin("extract", a)
        }, {
            "../../core": 65
        }],
        135: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = function(t) {
                    function e(r, o) {
                        n(this, e);
                        var s = i(this, t.call(this, r[0] instanceof u.Texture ? r[0] : r[0].texture));
                        return s._textures = null, s._durations = null, s.textures = r, s._autoUpdate = !1 !== o, s.animationSpeed = 1, s.loop = !0, s.onComplete = null, s.onFrameChange = null, s.onLoop = null, s._currentTime = 0, s.playing = !1, s
                    }
                    return o(e, t), e.prototype.stop = function() {
                        this.playing && (this.playing = !1, this._autoUpdate && u.ticker.shared.remove(this.update, this))
                    }, e.prototype.play = function() {
                        this.playing || (this.playing = !0, this._autoUpdate && u.ticker.shared.add(this.update, this, u.UPDATE_PRIORITY.HIGH))
                    }, e.prototype.gotoAndStop = function(t) {
                        this.stop();
                        var e = this.currentFrame;
                        this._currentTime = t, e !== this.currentFrame && this.updateTexture()
                    }, e.prototype.gotoAndPlay = function(t) {
                        var e = this.currentFrame;
                        this._currentTime = t, e !== this.currentFrame && this.updateTexture(), this.play()
                    }, e.prototype.update = function(t) {
                        var e = this.animationSpeed * t,
                            r = this.currentFrame;
                        if (null !== this._durations) {
                            var n = this._currentTime % 1 * this._durations[this.currentFrame];
                            for (n += e / 60 * 1e3; n < 0;) this._currentTime--, n += this._durations[this.currentFrame];
                            var i = Math.sign(this.animationSpeed * t);
                            for (this._currentTime = Math.floor(this._currentTime); n >= this._durations[this.currentFrame];) n -= this._durations[this.currentFrame] * i, this._currentTime += i;
                            this._currentTime += n / this._durations[this.currentFrame]
                        } else this._currentTime += e;
                        this._currentTime < 0 && !this.loop ? (this.gotoAndStop(0), this.onComplete && this.onComplete()) : this._currentTime >= this._textures.length && !this.loop ? (this.gotoAndStop(this._textures.length - 1), this.onComplete && this.onComplete()) : r !== this.currentFrame && (this.loop && this.onLoop && (this.animationSpeed > 0 && this.currentFrame < r ? this.onLoop() : this.animationSpeed < 0 && this.currentFrame > r && this.onLoop()), this.updateTexture())
                    }, e.prototype.updateTexture = function() {
                        this._texture = this._textures[this.currentFrame], this._textureID = -1, this.cachedTint = 16777215, this.onFrameChange && this.onFrameChange(this.currentFrame)
                    }, e.prototype.destroy = function(e) {
                        this.stop(), t.prototype.destroy.call(this, e)
                    }, e.fromFrames = function(t) {
                        for (var r = [], n = 0; n < t.length; ++n) r.push(u.Texture.fromFrame(t[n]));
                        return new e(r)
                    }, e.fromImages = function(t) {
                        for (var r = [], n = 0; n < t.length; ++n) r.push(u.Texture.fromImage(t[n]));
                        return new e(r)
                    }, s(e, [{
                        key: "totalFrames",
                        get: function() {
                            return this._textures.length
                        }
                    }, {
                        key: "textures",
                        get: function() {
                            return this._textures
                        },
                        set: function(t) {
                            if (t[0] instanceof u.Texture) this._textures = t, this._durations = null;
                            else {
                                this._textures = [], this._durations = [];
                                for (var e = 0; e < t.length; e++) this._textures.push(t[e].texture), this._durations.push(t[e].time)
                            }
                            this.gotoAndStop(0), this.updateTexture()
                        }
                    }, {
                        key: "currentFrame",
                        get: function() {
                            var t = Math.floor(this._currentTime) % this._textures.length;
                            return t < 0 && (t += this._textures.length), t
                        }
                    }]), e
                }(u.Sprite);
            r.default = h
        }, {
            "../core": 65
        }],
        136: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("../core"),
                h = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(u),
                l = t("../core/math/ObservablePoint"),
                c = n(l),
                d = t("../core/utils"),
                f = t("../core/settings"),
                p = n(f),
                v = function(t) {
                    function e(r) {
                        var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
                        i(this, e);
                        var s = o(this, t.call(this));
                        return s._textWidth = 0, s._textHeight = 0, s._glyphs = [], s._font = {
                            tint: void 0 !== n.tint ? n.tint : 16777215,
                            align: n.align || "left",
                            name: null,
                            size: 0
                        }, s.font = n.font, s._text = r, s._maxWidth = 0, s._maxLineHeight = 0, s._anchor = new c.default(function() {
                            s.dirty = !0
                        }, s, 0, 0), s.dirty = !1, s.updateText(), s
                    }
                    return s(e, t), e.prototype.updateText = function() {
                        for (var t = e.fonts[this._font.name], r = this._font.size / t.size, n = new h.Point, i = [], o = [], s = null, a = 0, u = 0, l = 0, c = -1, d = 0, f = 0, p = 0, v = 0; v < this.text.length; v++) {
                            var y = this.text.charCodeAt(v);
                            if (/(\s)/.test(this.text.charAt(v)) && (c = v, d = a), /(?:\r\n|\r|\n)/.test(this.text.charAt(v))) o.push(a), u = Math.max(u, a), l++, n.x = 0, n.y += t.lineHeight, s = null;
                            else if (-1 !== c && this._maxWidth > 0 && n.x * r > this._maxWidth) h.utils.removeItems(i, c - f, v - c), v = c, c = -1, ++f, o.push(d), u = Math.max(u, d), l++, n.x = 0, n.y += t.lineHeight, s = null;
                            else {
                                var g = t.chars[y];
                                g && (s && g.kerning[s] && (n.x += g.kerning[s]), i.push({
                                    texture: g.texture,
                                    line: l,
                                    charCode: y,
                                    position: new h.Point(n.x + g.xOffset, n.y + g.yOffset)
                                }), a = n.x + (g.texture.width + g.xOffset), n.x += g.xAdvance, p = Math.max(p, g.yOffset + g.texture.height), s = y)
                            }
                        }
                        o.push(a), u = Math.max(u, a);
                        for (var m = [], _ = 0; _ <= l; _++) {
                            var b = 0;
                            "right" === this._font.align ? b = u - o[_] : "center" === this._font.align && (b = (u - o[_]) / 2), m.push(b)
                        }
                        for (var x = i.length, T = this.tint, w = 0; w < x; w++) {
                            var E = this._glyphs[w];
                            E ? E.texture = i[w].texture : (E = new h.Sprite(i[w].texture), this._glyphs.push(E)), E.position.x = (i[w].position.x + m[i[w].line]) * r, E.position.y = i[w].position.y * r, E.scale.x = E.scale.y = r, E.tint = T, E.parent || this.addChild(E)
                        }
                        for (var S = x; S < this._glyphs.length; ++S) this.removeChild(this._glyphs[S]);
                        if (this._textWidth = u * r, this._textHeight = (n.y + t.lineHeight) * r, 0 !== this.anchor.x || 0 !== this.anchor.y)
                            for (var O = 0; O < x; O++) this._glyphs[O].x -= this._textWidth * this.anchor.x, this._glyphs[O].y -= this._textHeight * this.anchor.y;
                        this._maxLineHeight = p * r
                    }, e.prototype.updateTransform = function() {
                        this.validate(), this.containerUpdateTransform()
                    }, e.prototype.getLocalBounds = function() {
                        return this.validate(), t.prototype.getLocalBounds.call(this)
                    }, e.prototype.validate = function() {
                        this.dirty && (this.updateText(), this.dirty = !1)
                    }, e.registerFont = function(t, r) {
                        var n = {},
                            i = t.getElementsByTagName("info")[0],
                            o = t.getElementsByTagName("common")[0],
                            s = t.getElementsByTagName("page")[0].getAttribute("file"),
                            a = (0, d.getResolutionOfUrl)(s, p.default.RESOLUTION);
                        n.font = i.getAttribute("face"), n.size = parseInt(i.getAttribute("size"), 10), n.lineHeight = parseInt(o.getAttribute("lineHeight"), 10) / a, n.chars = {};
                        for (var u = t.getElementsByTagName("char"), l = 0; l < u.length; l++) {
                            var c = u[l],
                                f = parseInt(c.getAttribute("id"), 10),
                                v = new h.Rectangle(parseInt(c.getAttribute("x"), 10) / a + r.frame.x / a, parseInt(c.getAttribute("y"), 10) / a + r.frame.y / a, parseInt(c.getAttribute("width"), 10) / a, parseInt(c.getAttribute("height"), 10) / a);
                            n.chars[f] = {
                                xOffset: parseInt(c.getAttribute("xoffset"), 10) / a,
                                yOffset: parseInt(c.getAttribute("yoffset"), 10) / a,
                                xAdvance: parseInt(c.getAttribute("xadvance"), 10) / a,
                                kerning: {},
                                texture: new h.Texture(r.baseTexture, v)
                            }
                        }
                        for (var y = t.getElementsByTagName("kerning"), g = 0; g < y.length; g++) {
                            var m = y[g],
                                _ = parseInt(m.getAttribute("first"), 10) / a,
                                b = parseInt(m.getAttribute("second"), 10) / a,
                                x = parseInt(m.getAttribute("amount"), 10) / a;
                            n.chars[b] && (n.chars[b].kerning[_] = x)
                        }
                        return e.fonts[n.font] = n, n
                    }, a(e, [{
                        key: "tint",
                        get: function() {
                            return this._font.tint
                        },
                        set: function(t) {
                            this._font.tint = "number" == typeof t && t >= 0 ? t : 16777215, this.dirty = !0
                        }
                    }, {
                        key: "align",
                        get: function() {
                            return this._font.align
                        },
                        set: function(t) {
                            this._font.align = t || "left", this.dirty = !0
                        }
                    }, {
                        key: "anchor",
                        get: function() {
                            return this._anchor
                        },
                        set: function(t) {
                            "number" == typeof t ? this._anchor.set(t) : this._anchor.copy(t)
                        }
                    }, {
                        key: "font",
                        get: function() {
                            return this._font
                        },
                        set: function(t) {
                            t && ("string" == typeof t ? (t = t.split(" "), this._font.name = 1 === t.length ? t[0] : t.slice(1).join(" "), this._font.size = t.length >= 2 ? parseInt(t[0], 10) : e.fonts[this._font.name].size) : (this._font.name = t.name, this._font.size = "number" == typeof t.size ? t.size : parseInt(t.size, 10)), this.dirty = !0)
                        }
                    }, {
                        key: "text",
                        get: function() {
                            return this._text
                        },
                        set: function(t) {
                            t = t.toString() || " ", this._text !== t && (this._text = t, this.dirty = !0)
                        }
                    }, {
                        key: "maxWidth",
                        get: function() {
                            return this._maxWidth
                        },
                        set: function(t) {
                            this._maxWidth !== t && (this._maxWidth = t, this.dirty = !0)
                        }
                    }, {
                        key: "maxLineHeight",
                        get: function() {
                            return this.validate(), this._maxLineHeight
                        }
                    }, {
                        key: "textWidth",
                        get: function() {
                            return this.validate(), this._textWidth
                        }
                    }, {
                        key: "textHeight",
                        get: function() {
                            return this.validate(), this._textHeight
                        }
                    }]), e
                }(h.Container);
            r.default = v, v.fonts = {}
        }, {
            "../core": 65,
            "../core/math/ObservablePoint": 68,
            "../core/settings": 101,
            "../core/utils": 125
        }],
        137: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = t("../core/sprites/canvas/CanvasTinter"),
                l = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(h),
                c = new u.Point,
                d = function(t) {
                    function e(r) {
                        var o = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 100,
                            s = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 100;
                        n(this, e);
                        var a = i(this, t.call(this, r));
                        return a.tileTransform = new u.TransformStatic, a._width = o, a._height = s, a._canvasPattern = null, a.uvTransform = r.transform || new u.TextureMatrix(r), a.pluginName = "tilingSprite", a.uvRespectAnchor = !1, a
                    }
                    return o(e, t), e.prototype._onTextureUpdate = function() {
                        this.uvTransform && (this.uvTransform.texture = this._texture), this.cachedTint = 16777215
                    }, e.prototype._renderWebGL = function(t) {
                        var e = this._texture;
                        e && e.valid && (this.tileTransform.updateLocalTransform(), this.uvTransform.update(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this))
                    }, e.prototype._renderCanvas = function(t) {
                        var e = this._texture;
                        if (e.baseTexture.hasLoaded) {
                            var r = t.context,
                                n = this.worldTransform,
                                i = t.resolution,
                                o = e.baseTexture,
                                s = o.resolution,
                                a = this.tilePosition.x / this.tileScale.x % e._frame.width * s,
                                h = this.tilePosition.y / this.tileScale.y % e._frame.height * s;
                            if (this._textureID !== this._texture._updateID || this.cachedTint !== this.tint) {
                                this._textureID = this._texture._updateID;
                                var c = new u.CanvasRenderTarget(e._frame.width, e._frame.height, s);
                                16777215 !== this.tint ? (this.tintedTexture = l.default.getTintedTexture(this, this.tint), c.context.drawImage(this.tintedTexture, 0, 0)) : c.context.drawImage(o.source, -e._frame.x * s, -e._frame.y * s), this.cachedTint = this.tint, this._canvasPattern = c.context.createPattern(c.canvas, "repeat")
                            }
                            r.globalAlpha = this.worldAlpha, r.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i, n.ty * i), t.setBlendMode(this.blendMode), r.fillStyle = this._canvasPattern, r.scale(this.tileScale.x / s, this.tileScale.y / s);
                            var d = this.anchor.x * -this._width,
                                f = this.anchor.y * -this._height;
                            this.uvRespectAnchor ? (r.translate(a, h), r.fillRect(-a + d, -h + f, this._width / this.tileScale.x * s, this._height / this.tileScale.y * s)) : (r.translate(a + d, h + f), r.fillRect(-a, -h, this._width / this.tileScale.x * s, this._height / this.tileScale.y * s))
                        }
                    }, e.prototype._calculateBounds = function() {
                        var t = this._width * -this._anchor._x,
                            e = this._height * -this._anchor._y,
                            r = this._width * (1 - this._anchor._x),
                            n = this._height * (1 - this._anchor._y);
                        this._bounds.addFrame(this.transform, t, e, r, n)
                    }, e.prototype.getLocalBounds = function(e) {
                        return 0 === this.children.length ? (this._bounds.minX = this._width * -this._anchor._x, this._bounds.minY = this._height * -this._anchor._y, this._bounds.maxX = this._width * (1 - this._anchor._x), this._bounds.maxY = this._height * (1 - this._anchor._x), e || (this._localBoundsRect || (this._localBoundsRect = new u.Rectangle), e = this._localBoundsRect), this._bounds.getRectangle(e)) : t.prototype.getLocalBounds.call(this, e)
                    }, e.prototype.containsPoint = function(t) {
                        this.worldTransform.applyInverse(t, c);
                        var e = this._width,
                            r = this._height,
                            n = -e * this.anchor._x;
                        if (c.x >= n && c.x < n + e) {
                            var i = -r * this.anchor._y;
                            if (c.y >= i && c.y < i + r) return !0
                        }
                        return !1
                    }, e.prototype.destroy = function(e) {
                        t.prototype.destroy.call(this, e), this.tileTransform = null, this.uvTransform = null
                    }, e.from = function(t, r, n) {
                        return new e(u.Texture.from(t), r, n)
                    }, e.fromFrame = function(t, r, n) {
                        var i = u.utils.TextureCache[t];
                        if (!i) throw new Error('The frameId "' + t + '" does not exist in the texture cache ' + this);
                        return new e(i, r, n)
                    }, e.fromImage = function(t, r, n, i, o) {
                        return new e(u.Texture.fromImage(t, i, o), r, n)
                    }, s(e, [{
                        key: "clampMargin",
                        get: function() {
                            return this.uvTransform.clampMargin
                        },
                        set: function(t) {
                            this.uvTransform.clampMargin = t, this.uvTransform.update(!0)
                        }
                    }, {
                        key: "tileScale",
                        get: function() {
                            return this.tileTransform.scale
                        },
                        set: function(t) {
                            this.tileTransform.scale.copy(t)
                        }
                    }, {
                        key: "tilePosition",
                        get: function() {
                            return this.tileTransform.position
                        },
                        set: function(t) {
                            this.tileTransform.position.copy(t)
                        }
                    }, {
                        key: "width",
                        get: function() {
                            return this._width
                        },
                        set: function(t) {
                            this._width = t
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return this._height
                        },
                        set: function(t) {
                            this._height = t
                        }
                    }]), e
                }(u.Sprite);
            r.default = d
        }, {
            "../core": 65,
            "../core/sprites/canvas/CanvasTinter": 104
        }],
        138: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            var o = t("../core"),
                s = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(o),
                a = t("../core/textures/Texture"),
                u = n(a),
                h = t("../core/textures/BaseTexture"),
                l = n(h),
                c = t("../core/utils"),
                d = s.DisplayObject,
                f = new s.Matrix;
            d.prototype._cacheAsBitmap = !1, d.prototype._cacheData = !1;
            var p = function t() {
                i(this, t), this.textureCacheId = null, this.originalRenderWebGL = null, this.originalRenderCanvas = null, this.originalCalculateBounds = null, this.originalGetLocalBounds = null, this.originalUpdateTransform = null, this.originalHitTest = null, this.originalDestroy = null, this.originalMask = null, this.originalFilterArea = null, this.sprite = null
            };
            Object.defineProperties(d.prototype, {
                cacheAsBitmap: {
                    get: function() {
                        return this._cacheAsBitmap
                    },
                    set: function(t) {
                        if (this._cacheAsBitmap !== t) {
                            this._cacheAsBitmap = t;
                            var e = void 0;
                            t ? (this._cacheData || (this._cacheData = new p), e = this._cacheData, e.originalRenderWebGL = this.renderWebGL, e.originalRenderCanvas = this.renderCanvas, e.originalUpdateTransform = this.updateTransform, e.originalCalculateBounds = this._calculateBounds, e.originalGetLocalBounds = this.getLocalBounds, e.originalDestroy = this.destroy, e.originalContainsPoint = this.containsPoint, e.originalMask = this._mask, e.originalFilterArea = this.filterArea, this.renderWebGL = this._renderCachedWebGL, this.renderCanvas = this._renderCachedCanvas, this.destroy = this._cacheAsBitmapDestroy) : (e = this._cacheData, e.sprite && this._destroyCachedDisplayObject(), this.renderWebGL = e.originalRenderWebGL, this.renderCanvas = e.originalRenderCanvas, this._calculateBounds = e.originalCalculateBounds, this.getLocalBounds = e.originalGetLocalBounds, this.destroy = e.originalDestroy, this.updateTransform = e.originalUpdateTransform, this.containsPoint = e.originalContainsPoint, this._mask = e.originalMask, this.filterArea = e.originalFilterArea)
                        }
                    }
                }
            }), d.prototype._renderCachedWebGL = function(t) {
                !this.visible || this.worldAlpha <= 0 || !this.renderable || (this._initCachedDisplayObject(t), this._cacheData.sprite._transformID = -1, this._cacheData.sprite.worldAlpha = this.worldAlpha, this._cacheData.sprite._renderWebGL(t))
            }, d.prototype._initCachedDisplayObject = function(t) {
                if (!this._cacheData || !this._cacheData.sprite) {
                    var e = this.alpha;
                    this.alpha = 1, t.currentRenderer.flush();
                    var r = this.getLocalBounds().clone();
                    if (this._filters) {
                        var n = this._filters[0].padding;
                        r.pad(n)
                    }
                    var i = t._activeRenderTarget,
                        o = t.filterManager.filterStack,
                        a = s.RenderTexture.create(0 | r.width, 0 | r.height),
                        h = "cacheAsBitmap_" + (0, c.uid)();
                    this._cacheData.textureCacheId = h, l.default.addToCache(a.baseTexture, h), u.default.addToCache(a, h);
                    var d = f;
                    d.tx = -r.x, d.ty = -r.y, this.transform.worldTransform.identity(), this.renderWebGL = this._cacheData.originalRenderWebGL, t.render(this, a, !0, d, !0), t.bindRenderTarget(i), t.filterManager.filterStack = o, this.renderWebGL = this._renderCachedWebGL, this.updateTransform = this.displayObjectUpdateTransform, this._mask = null, this.filterArea = null;
                    var p = new s.Sprite(a);
                    p.transform.worldTransform = this.transform.worldTransform, p.anchor.x = -r.x / r.width, p.anchor.y = -r.y / r.height, p.alpha = e, p._bounds = this._bounds, this._calculateBounds = this._calculateCachedBounds, this.getLocalBounds = this._getCachedLocalBounds, this._cacheData.sprite = p, this.transform._parentID = -1, this.parent ? this.updateTransform() : (this.parent = t._tempDisplayObjectParent, this.updateTransform(), this.parent = null), this.containsPoint = p.containsPoint.bind(p)
                }
            }, d.prototype._renderCachedCanvas = function(t) {
                !this.visible || this.worldAlpha <= 0 || !this.renderable || (this._initCachedDisplayObjectCanvas(t), this._cacheData.sprite.worldAlpha = this.worldAlpha, this._cacheData.sprite.renderCanvas(t))
            }, d.prototype._initCachedDisplayObjectCanvas = function(t) {
                if (!this._cacheData || !this._cacheData.sprite) {
                    var e = this.getLocalBounds(),
                        r = this.alpha;
                    this.alpha = 1;
                    var n = t.context,
                        i = s.RenderTexture.create(0 | e.width, 0 | e.height),
                        o = "cacheAsBitmap_" + (0, c.uid)();
                    this._cacheData.textureCacheId = o, l.default.addToCache(i.baseTexture, o), u.default.addToCache(i, o);
                    var a = f;
                    this.transform.localTransform.copy(a), a.invert(), a.tx -= e.x, a.ty -= e.y, this.renderCanvas = this._cacheData.originalRenderCanvas, t.render(this, i, !0, a, !1), t.context = n, this.renderCanvas = this._renderCachedCanvas, this._calculateBounds = this._calculateCachedBounds, this._mask = null, this.filterArea = null;
                    var h = new s.Sprite(i);
                    h.transform.worldTransform = this.transform.worldTransform, h.anchor.x = -e.x / e.width, h.anchor.y = -e.y / e.height, h._bounds = this._bounds, h.alpha = r, this.parent ? this.updateTransform() : (this.parent = t._tempDisplayObjectParent, this.updateTransform(), this.parent = null), this.updateTransform = this.displayObjectUpdateTransform, this._cacheData.sprite = h, this.containsPoint = h.containsPoint.bind(h)
                }
            }, d.prototype._calculateCachedBounds = function() {
                this._cacheData.sprite._calculateBounds()
            }, d.prototype._getCachedLocalBounds = function() {
                return this._cacheData.sprite.getLocalBounds()
            }, d.prototype._destroyCachedDisplayObject = function() {
                this._cacheData.sprite._texture.destroy(!0), this._cacheData.sprite = null, l.default.removeFromCache(this._cacheData.textureCacheId), u.default.removeFromCache(this._cacheData.textureCacheId), this._cacheData.textureCacheId = null
            }, d.prototype._cacheAsBitmapDestroy = function(t) {
                this.cacheAsBitmap = !1, this.destroy(t)
            }
        }, {
            "../core": 65,
            "../core/textures/BaseTexture": 112,
            "../core/textures/Texture": 115,
            "../core/utils": 125
        }],
        139: [function(t, e, r) {
            "use strict";
            var n = t("../core"),
                i = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(n);
            i.DisplayObject.prototype.name = null, i.Container.prototype.getChildByName = function(t) {
                for (var e = 0; e < this.children.length; e++)
                    if (this.children[e].name === t) return this.children[e];
                return null
            }
        }, {
            "../core": 65
        }],
        140: [function(t, e, r) {
            "use strict";
            var n = t("../core"),
                i = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(n);
            i.DisplayObject.prototype.getGlobalPosition = function() {
                var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : new i.Point,
                    e = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                return this.parent ? this.parent.toGlobal(this.position, t, e) : (t.x = this.position.x, t.y = this.position.y), t
            }
        }, {
            "../core": 65
        }],
        141: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0, r.BitmapText = r.TilingSpriteRenderer = r.TilingSprite = r.AnimatedSprite = void 0;
            var i = t("./AnimatedSprite");
            Object.defineProperty(r, "AnimatedSprite", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./TilingSprite");
            Object.defineProperty(r, "TilingSprite", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            });
            var s = t("./webgl/TilingSpriteRenderer");
            Object.defineProperty(r, "TilingSpriteRenderer", {
                enumerable: !0,
                get: function() {
                    return n(s).default
                }
            });
            var a = t("./BitmapText");
            Object.defineProperty(r, "BitmapText", {
                enumerable: !0,
                get: function() {
                    return n(a).default
                }
            }), t("./cacheAsBitmap"), t("./getChildByName"), t("./getGlobalPosition")
        }, {
            "./AnimatedSprite": 135,
            "./BitmapText": 136,
            "./TilingSprite": 137,
            "./cacheAsBitmap": 138,
            "./getChildByName": 139,
            "./getGlobalPosition": 140,
            "./webgl/TilingSpriteRenderer": 142
        }],
        142: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("../../core"),
                a = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(s),
                u = t("../../core/const"),
                h = (t("path"), new a.Matrix),
                l = function(t) {
                    function e(r) {
                        n(this, e);
                        var o = i(this, t.call(this, r));
                        return o.shader = null, o.simpleShader = null, o.quad = null, o
                    }
                    return o(e, t), e.prototype.onContextChange = function() {
                        var t = this.renderer.gl;
                        this.shader = new a.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"), this.simpleShader = new a.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"), this.renderer.bindVao(null), this.quad = new a.Quad(t, this.renderer.state.attribState), this.quad.initVao(this.shader)
                    }, e.prototype.render = function(t) {
                        var e = this.renderer,
                            r = this.quad;
                        e.bindVao(r.vao);
                        var n = r.vertices;
                        n[0] = n[6] = t._width * -t.anchor.x, n[1] = n[3] = t._height * -t.anchor.y, n[2] = n[4] = t._width * (1 - t.anchor.x), n[5] = n[7] = t._height * (1 - t.anchor.y), t.uvRespectAnchor && (n = r.uvs, n[0] = n[6] = -t.anchor.x, n[1] = n[3] = -t.anchor.y, n[2] = n[4] = 1 - t.anchor.x, n[5] = n[7] = 1 - t.anchor.y), r.upload();
                        var i = t._texture,
                            o = i.baseTexture,
                            s = t.tileTransform.localTransform,
                            l = t.uvTransform,
                            c = o.isPowerOfTwo && i.frame.width === o.width && i.frame.height === o.height;
                        c && (o._glTextures[e.CONTEXT_UID] ? c = o.wrapMode !== u.WRAP_MODES.CLAMP : o.wrapMode === u.WRAP_MODES.CLAMP && (o.wrapMode = u.WRAP_MODES.REPEAT));
                        var d = c ? this.simpleShader : this.shader;
                        e.bindShader(d);
                        var f = i.width,
                            p = i.height,
                            v = t._width,
                            y = t._height;
                        h.set(s.a * f / v, s.b * f / y, s.c * p / v, s.d * p / y, s.tx / v, s.ty / y), h.invert(), c ? h.prepend(l.mapCoord) : (d.uniforms.uMapCoord = l.mapCoord.toArray(!0), d.uniforms.uClampFrame = l.uClampFrame, d.uniforms.uClampOffset = l.uClampOffset), d.uniforms.uTransform = h.toArray(!0), d.uniforms.uColor = a.utils.premultiplyTintToRgba(t.tint, t.worldAlpha, d.uniforms.uColor, o.premultipliedAlpha), d.uniforms.translationMatrix = t.transform.worldTransform.toArray(!0), d.uniforms.uSampler = e.bindTexture(i), e.setBlendMode(a.utils.correctBlendMode(t.blendMode, o.premultipliedAlpha)), r.vao.draw(this.renderer.gl.TRIANGLES, 6, 0)
                    }, e
                }(a.ObjectRenderer);
            r.default = l, a.WebGLRenderer.registerPlugin("tilingSprite", l)
        }, {
            "../../core": 65,
            "../../core/const": 46,
            path: 8
        }],
        143: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = (t("path"), function(t) {
                    function e() {
                        var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1;
                        n(this, e);
                        var o = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));
                        return o.alpha = r, o.glShaderKey = "alpha", o
                    }
                    return o(e, t), s(e, [{
                        key: "alpha",
                        get: function() {
                            return this.uniforms.uAlpha
                        },
                        set: function(t) {
                            this.uniforms.uAlpha = t
                        }
                    }]), e
                }(u.Filter));
            r.default = h
        }, {
            "../../core": 65,
            path: 8
        }],
        144: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("../../core"),
                h = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(u),
                l = t("./BlurXFilter"),
                c = n(l),
                d = t("./BlurYFilter"),
                f = n(d),
                p = function(t) {
                    function e(r, n, s, a) {
                        i(this, e);
                        var u = o(this, t.call(this));
                        return u.blurXFilter = new c.default(r, n, s, a), u.blurYFilter = new f.default(r, n, s, a), u.padding = 0, u.resolution = s || h.settings.RESOLUTION, u.quality = n || 4, u.blur = r || 8, u
                    }
                    return s(e, t), e.prototype.apply = function(t, e, r) {
                        var n = t.getRenderTarget(!0);
                        this.blurXFilter.apply(t, e, n, !0), this.blurYFilter.apply(t, n, r, !1), t.returnRenderTarget(n)
                    }, a(e, [{
                        key: "blur",
                        get: function() {
                            return this.blurXFilter.blur
                        },
                        set: function(t) {
                            this.blurXFilter.blur = this.blurYFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength))
                        }
                    }, {
                        key: "quality",
                        get: function() {
                            return this.blurXFilter.quality
                        },
                        set: function(t) {
                            this.blurXFilter.quality = this.blurYFilter.quality = t
                        }
                    }, {
                        key: "blurX",
                        get: function() {
                            return this.blurXFilter.blur
                        },
                        set: function(t) {
                            this.blurXFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength))
                        }
                    }, {
                        key: "blurY",
                        get: function() {
                            return this.blurYFilter.blur
                        },
                        set: function(t) {
                            this.blurYFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength))
                        }
                    }, {
                        key: "blendMode",
                        get: function() {
                            return this.blurYFilter._blendMode
                        },
                        set: function(t) {
                            this.blurYFilter._blendMode = t
                        }
                    }]), e
                }(h.Filter);
            r.default = p
        }, {
            "../../core": 65,
            "./BlurXFilter": 145,
            "./BlurYFilter": 146
        }],
        145: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("../../core"),
                h = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(u),
                l = t("./generateBlurVertSource"),
                c = n(l),
                d = t("./generateBlurFragSource"),
                f = n(d),
                p = t("./getMaxBlurKernelSize"),
                v = n(p),
                y = function(t) {
                    function e(r, n, s, a) {
                        i(this, e), a = a || 5;
                        var u = (0, c.default)(a, !0),
                            l = (0, f.default)(a),
                            d = o(this, t.call(this, u, l));
                        return d.resolution = s || h.settings.RESOLUTION, d._quality = 0, d.quality = n || 4, d.strength = r || 8, d.firstRun = !0, d
                    }
                    return s(e, t), e.prototype.apply = function(t, e, r, n) {
                        if (this.firstRun) {
                            var i = t.renderer.gl,
                                o = (0, v.default)(i);
                            this.vertexSrc = (0, c.default)(o, !0), this.fragmentSrc = (0, f.default)(o), this.firstRun = !1
                        }
                        if (this.uniforms.strength = 1 / r.size.width * (r.size.width / e.size.width), this.uniforms.strength *= this.strength, this.uniforms.strength /= this.passes, 1 === this.passes) t.applyFilter(this, e, r, n);
                        else {
                            for (var s = t.getRenderTarget(!0), a = e, u = s, h = 0; h < this.passes - 1; h++) {
                                t.applyFilter(this, a, u, !0);
                                var l = u;
                                u = a, a = l
                            }
                            t.applyFilter(this, a, r, n), t.returnRenderTarget(s)
                        }
                    }, a(e, [{
                        key: "blur",
                        get: function() {
                            return this.strength
                        },
                        set: function(t) {
                            this.padding = 2 * Math.abs(t), this.strength = t
                        }
                    }, {
                        key: "quality",
                        get: function() {
                            return this._quality
                        },
                        set: function(t) {
                            this._quality = t, this.passes = t
                        }
                    }]), e
                }(h.Filter);
            r.default = y
        }, {
            "../../core": 65,
            "./generateBlurFragSource": 147,
            "./generateBlurVertSource": 148,
            "./getMaxBlurKernelSize": 149
        }],
        146: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                u = t("../../core"),
                h = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(u),
                l = t("./generateBlurVertSource"),
                c = n(l),
                d = t("./generateBlurFragSource"),
                f = n(d),
                p = t("./getMaxBlurKernelSize"),
                v = n(p),
                y = function(t) {
                    function e(r, n, s, a) {
                        i(this, e), a = a || 5;
                        var u = (0, c.default)(a, !1),
                            l = (0, f.default)(a),
                            d = o(this, t.call(this, u, l));
                        return d.resolution = s || h.settings.RESOLUTION, d._quality = 0, d.quality = n || 4, d.strength = r || 8, d.firstRun = !0, d
                    }
                    return s(e, t), e.prototype.apply = function(t, e, r, n) {
                        if (this.firstRun) {
                            var i = t.renderer.gl,
                                o = (0, v.default)(i);
                            this.vertexSrc = (0, c.default)(o, !1), this.fragmentSrc = (0, f.default)(o), this.firstRun = !1
                        }
                        if (this.uniforms.strength = 1 / r.size.height * (r.size.height / e.size.height), this.uniforms.strength *= this.strength, this.uniforms.strength /= this.passes, 1 === this.passes) t.applyFilter(this, e, r, n);
                        else {
                            for (var s = t.getRenderTarget(!0), a = e, u = s, h = 0; h < this.passes - 1; h++) {
                                t.applyFilter(this, a, u, !0);
                                var l = u;
                                u = a, a = l
                            }
                            t.applyFilter(this, a, r, n), t.returnRenderTarget(s)
                        }
                    }, a(e, [{
                        key: "blur",
                        get: function() {
                            return this.strength
                        },
                        set: function(t) {
                            this.padding = 2 * Math.abs(t), this.strength = t
                        }
                    }, {
                        key: "quality",
                        get: function() {
                            return this._quality
                        },
                        set: function(t) {
                            this._quality = t, this.passes = t
                        }
                    }]), e
                }(h.Filter);
            r.default = y
        }, {
            "../../core": 65,
            "./generateBlurFragSource": 147,
            "./generateBlurVertSource": 148,
            "./getMaxBlurKernelSize": 149
        }],
        147: [function(t, e, r) {
            "use strict";

            function n(t) {
                for (var e = i[t], r = e.length, n = o, s = "", a = "gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;", u = void 0, h = 0; h < t; h++) {
                    var l = a.replace("%index%", h);
                    u = h, h >= r && (u = t - h - 1), l = l.replace("%value%", e[u]), s += l, s += "\n"
                }
                return n = n.replace("%blur%", s), n = n.replace("%size%", t)
            }
            r.__esModule = !0, r.default = n;
            var i = {
                    5: [.153388, .221461, .250301],
                    7: [.071303, .131514, .189879, .214607],
                    9: [.028532, .067234, .124009, .179044, .20236],
                    11: [.0093, .028002, .065984, .121703, .175713, .198596],
                    13: [.002406, .009255, .027867, .065666, .121117, .174868, .197641],
                    15: [489e-6, .002403, .009246, .02784, .065602, .120999, .174697, .197448]
                },
                o = ["varying vec2 vBlurTexCoords[%size%];", "uniform sampler2D uSampler;", "void main(void)", "{", "    gl_FragColor = vec4(0.0);", "    %blur%", "}"].join("\n")
        }, {}],
        148: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                var r = Math.ceil(t / 2),
                    n = i,
                    o = "",
                    s = void 0;
                s = e ? "vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);" : "vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";
                for (var a = 0; a < t; a++) {
                    var u = s.replace("%index%", a);
                    u = u.replace("%sampleIndex%", a - (r - 1) + ".0"), o += u, o += "\n"
                }
                return n = n.replace("%blur%", o), n = n.replace("%size%", t)
            }
            r.__esModule = !0, r.default = n;
            var i = ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "uniform float strength;", "uniform mat3 projectionMatrix;", "varying vec2 vBlurTexCoords[%size%];", "void main(void)", "{", "gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);", "%blur%", "}"].join("\n")
        }, {}],
        149: [function(t, e, r) {
            "use strict";

            function n(t) {
                for (var e = t.getParameter(t.MAX_VARYING_VECTORS), r = 15; r > e;) r -= 2;
                return r
            }
            r.__esModule = !0, r.default = n
        }, {}],
        150: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = (t("path"), function(t) {
                    function e() {
                        n(this, e);
                        var r = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));
                        return r.uniforms.m = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0], r.alpha = 1, r
                    }
                    return o(e, t), e.prototype._loadMatrix = function(t) {
                        var e = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
                            r = t;
                        e && (this._multiply(r, this.uniforms.m, t), r = this._colorMatrix(r)), this.uniforms.m = r
                    }, e.prototype._multiply = function(t, e, r) {
                        return t[0] = e[0] * r[0] + e[1] * r[5] + e[2] * r[10] + e[3] * r[15], t[1] = e[0] * r[1] + e[1] * r[6] + e[2] * r[11] + e[3] * r[16], t[2] = e[0] * r[2] + e[1] * r[7] + e[2] * r[12] + e[3] * r[17], t[3] = e[0] * r[3] + e[1] * r[8] + e[2] * r[13] + e[3] * r[18], t[4] = e[0] * r[4] + e[1] * r[9] + e[2] * r[14] + e[3] * r[19] + e[4], t[5] = e[5] * r[0] + e[6] * r[5] + e[7] * r[10] + e[8] * r[15], t[6] = e[5] * r[1] + e[6] * r[6] + e[7] * r[11] + e[8] * r[16], t[7] = e[5] * r[2] + e[6] * r[7] + e[7] * r[12] + e[8] * r[17], t[8] = e[5] * r[3] + e[6] * r[8] + e[7] * r[13] + e[8] * r[18], t[9] = e[5] * r[4] + e[6] * r[9] + e[7] * r[14] + e[8] * r[19] + e[9], t[10] = e[10] * r[0] + e[11] * r[5] + e[12] * r[10] + e[13] * r[15], t[11] = e[10] * r[1] + e[11] * r[6] + e[12] * r[11] + e[13] * r[16], t[12] = e[10] * r[2] + e[11] * r[7] + e[12] * r[12] + e[13] * r[17], t[13] = e[10] * r[3] + e[11] * r[8] + e[12] * r[13] + e[13] * r[18], t[14] = e[10] * r[4] + e[11] * r[9] + e[12] * r[14] + e[13] * r[19] + e[14], t[15] = e[15] * r[0] + e[16] * r[5] + e[17] * r[10] + e[18] * r[15], t[16] = e[15] * r[1] + e[16] * r[6] + e[17] * r[11] + e[18] * r[16], t[17] = e[15] * r[2] + e[16] * r[7] + e[17] * r[12] + e[18] * r[17], t[18] = e[15] * r[3] + e[16] * r[8] + e[17] * r[13] + e[18] * r[18], t[19] = e[15] * r[4] + e[16] * r[9] + e[17] * r[14] + e[18] * r[19] + e[19], t
                    }, e.prototype._colorMatrix = function(t) {
                        var e = new Float32Array(t);
                        return e[4] /= 255, e[9] /= 255, e[14] /= 255, e[19] /= 255, e
                    }, e.prototype.brightness = function(t, e) {
                        var r = [t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(r, e)
                    }, e.prototype.greyscale = function(t, e) {
                        var r = [t, t, t, 0, 0, t, t, t, 0, 0, t, t, t, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(r, e)
                    }, e.prototype.blackAndWhite = function(t) {
                        var e = [.3, .6, .1, 0, 0, .3, .6, .1, 0, 0, .3, .6, .1, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.hue = function(t, e) {
                        t = (t || 0) / 180 * Math.PI;
                        var r = Math.cos(t),
                            n = Math.sin(t),
                            i = Math.sqrt,
                            o = 1 / 3,
                            s = i(o),
                            a = r + (1 - r) * o,
                            u = o * (1 - r) - s * n,
                            h = o * (1 - r) + s * n,
                            l = o * (1 - r) + s * n,
                            c = r + o * (1 - r),
                            d = o * (1 - r) - s * n,
                            f = o * (1 - r) - s * n,
                            p = o * (1 - r) + s * n,
                            v = r + o * (1 - r),
                            y = [a, u, h, 0, 0, l, c, d, 0, 0, f, p, v, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(y, e)
                    }, e.prototype.contrast = function(t, e) {
                        var r = (t || 0) + 1,
                            n = -.5 * (r - 1),
                            i = [r, 0, 0, 0, n, 0, r, 0, 0, n, 0, 0, r, 0, n, 0, 0, 0, 1, 0];
                        this._loadMatrix(i, e)
                    }, e.prototype.saturate = function() {
                        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
                            e = arguments[1],
                            r = 2 * t / 3 + 1,
                            n = -.5 * (r - 1),
                            i = [r, n, n, 0, 0, n, r, n, 0, 0, n, n, r, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(i, e)
                    }, e.prototype.desaturate = function() {
                        this.saturate(-1)
                    }, e.prototype.negative = function(t) {
                        var e = [-1, 0, 0, 1, 0, 0, -1, 0, 1, 0, 0, 0, -1, 1, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.sepia = function(t) {
                        var e = [.393, .7689999, .18899999, 0, 0, .349, .6859999, .16799999, 0, 0, .272, .5339999, .13099999, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.technicolor = function(t) {
                        var e = [1.9125277891456083, -.8545344976951645, -.09155508482755585, 0, 11.793603434377337, -.3087833385928097, 1.7658908555458428, -.10601743074722245, 0, -70.35205161461398, -.231103377548616, -.7501899197440212, 1.847597816108189, 0, 30.950940869491138, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.polaroid = function(t) {
                        var e = [1.438, -.062, -.062, 0, 0, -.122, 1.378, -.122, 0, 0, -.016, -.016, 1.483, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.toBGR = function(t) {
                        var e = [0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.kodachrome = function(t) {
                        var e = [1.1285582396593525, -.3967382283601348, -.03992559172921793, 0, 63.72958762196502, -.16404339962244616, 1.0835251566291304, -.05498805115633132, 0, 24.732407896706203, -.16786010706155763, -.5603416277695248, 1.6014850761964943, 0, 35.62982807460946, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.browni = function(t) {
                        var e = [.5997023498159715, .34553243048391263, -.2708298674538042, 0, 47.43192855600873, -.037703249837783157, .8609577587992641, .15059552388459913, 0, -36.96841498319127, .24113635128153335, -.07441037908422492, .44972182064877153, 0, -7.562075277591283, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.vintage = function(t) {
                        var e = [.6279345635605994, .3202183420819367, -.03965408211312453, 0, 9.651285835294123, .02578397704808868, .6441188644374771, .03259127616149294, 0, 7.462829176470591, .0466055556782719, -.0851232987247891, .5241648018700465, 0, 5.159190588235296, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.colorTone = function(t, e, r, n, i) {
                        t = t || .2, e = e || .15, r = r || 16770432, n = n || 3375104;
                        var o = (r >> 16 & 255) / 255,
                            s = (r >> 8 & 255) / 255,
                            a = (255 & r) / 255,
                            u = (n >> 16 & 255) / 255,
                            h = (n >> 8 & 255) / 255,
                            l = (255 & n) / 255,
                            c = [.3, .59, .11, 0, 0, o, s, a, t, 0, u, h, l, e, 0, o - u, s - h, a - l, 0, 0];
                        this._loadMatrix(c, i)
                    }, e.prototype.night = function(t, e) {
                        t = t || .1;
                        var r = [-2 * t, -t, 0, 0, 0, -t, 0, t, 0, 0, 0, t, 2 * t, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(r, e)
                    }, e.prototype.predator = function(t, e) {
                        var r = [11.224130630493164 * t, -4.794486999511719 * t, -2.8746118545532227 * t, 0 * t, .40342438220977783 * t, -3.6330697536468506 * t, 9.193157196044922 * t, -2.951810836791992 * t, 0 * t, -1.316135048866272 * t, -3.2184197902679443 * t, -4.2375030517578125 * t, 7.476448059082031 * t, 0 * t, .8044459223747253 * t, 0, 0, 0, 1, 0];
                        this._loadMatrix(r, e)
                    }, e.prototype.lsd = function(t) {
                        var e = [2, -.4, .5, 0, 0, -.5, 2, -.4, 0, 0, -.4, -.5, 3, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(e, t)
                    }, e.prototype.reset = function() {
                        var t = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0];
                        this._loadMatrix(t, !1)
                    }, s(e, [{
                        key: "matrix",
                        get: function() {
                            return this.uniforms.m
                        },
                        set: function(t) {
                            this.uniforms.m = t
                        }
                    }, {
                        key: "alpha",
                        get: function() {
                            return this.uniforms.uAlpha
                        },
                        set: function(t) {
                            this.uniforms.uAlpha = t
                        }
                    }]), e
                }(u.Filter));
            r.default = h, h.prototype.grayscale = h.prototype.greyscale
        }, {
            "../../core": 65,
            path: 8
        }],
        151: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = (t("path"), function(t) {
                    function e(r, o) {
                        n(this, e);
                        var s = new u.Matrix;
                        r.renderable = !1;
                        var a = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}", "varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));
                        return a.maskSprite = r, a.maskMatrix = s, a.uniforms.mapSampler = r._texture, a.uniforms.filterMatrix = s, a.uniforms.scale = {
                            x: 1,
                            y: 1
                        }, null !== o && void 0 !== o || (o = 20), a.scale = new u.Point(o, o), a
                    }
                    return o(e, t), e.prototype.apply = function(t, e, r) {
                        this.uniforms.filterMatrix = t.calculateSpriteMatrix(this.maskMatrix, this.maskSprite), this.uniforms.scale.x = this.scale.x, this.uniforms.scale.y = this.scale.y, t.applyFilter(this, e, r)
                    }, s(e, [{
                        key: "map",
                        get: function() {
                            return this.uniforms.mapSampler
                        },
                        set: function(t) {
                            this.uniforms.mapSampler = t
                        }
                    }]), e
                }(u.Filter));
            r.default = h
        }, {
            "../../core": 65,
            path: 8
        }],
        152: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("../../core"),
                a = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(s),
                u = (t("path"), function(t) {
                    function e() {
                        return n(this, e), i(this, t.call(this, "\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}", 'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))
                    }
                    return o(e, t), e
                }(a.Filter));
            r.default = u
        }, {
            "../../core": 65,
            path: 8
        }],
        153: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./fxaa/FXAAFilter");
            Object.defineProperty(r, "FXAAFilter", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./noise/NoiseFilter");
            Object.defineProperty(r, "NoiseFilter", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            });
            var s = t("./displacement/DisplacementFilter");
            Object.defineProperty(r, "DisplacementFilter", {
                enumerable: !0,
                get: function() {
                    return n(s).default
                }
            });
            var a = t("./blur/BlurFilter");
            Object.defineProperty(r, "BlurFilter", {
                enumerable: !0,
                get: function() {
                    return n(a).default
                }
            });
            var u = t("./blur/BlurXFilter");
            Object.defineProperty(r, "BlurXFilter", {
                enumerable: !0,
                get: function() {
                    return n(u).default
                }
            });
            var h = t("./blur/BlurYFilter");
            Object.defineProperty(r, "BlurYFilter", {
                enumerable: !0,
                get: function() {
                    return n(h).default
                }
            });
            var l = t("./colormatrix/ColorMatrixFilter");
            Object.defineProperty(r, "ColorMatrixFilter", {
                enumerable: !0,
                get: function() {
                    return n(l).default
                }
            });
            var c = t("./alpha/AlphaFilter");
            Object.defineProperty(r, "AlphaFilter", {
                enumerable: !0,
                get: function() {
                    return n(c).default
                }
            })
        }, {
            "./alpha/AlphaFilter": 143,
            "./blur/BlurFilter": 144,
            "./blur/BlurXFilter": 145,
            "./blur/BlurYFilter": 146,
            "./colormatrix/ColorMatrixFilter": 150,
            "./displacement/DisplacementFilter": 151,
            "./fxaa/FXAAFilter": 152,
            "./noise/NoiseFilter": 154
        }],
        154: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = (t("path"), function(t) {
                    function e() {
                        var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : .5,
                            o = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : Math.random();
                        n(this, e);
                        var s = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));
                        return s.noise = r, s.seed = o, s
                    }
                    return o(e, t), s(e, [{
                        key: "noise",
                        get: function() {
                            return this.uniforms.uNoise
                        },
                        set: function(t) {
                            this.uniforms.uNoise = t
                        }
                    }, {
                        key: "seed",
                        get: function() {
                            return this.uniforms.uSeed
                        },
                        set: function(t) {
                            this.uniforms.uSeed = t
                        }
                    }]), e
                }(u.Filter));
            r.default = h
        }, {
            "../../core": 65,
            path: 8
        }],
        155: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = t("../core"),
                s = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(o),
                a = function() {
                    function t() {
                        n(this, t), this.global = new s.Point, this.target = null, this.originalEvent = null, this.identifier = null, this.isPrimary = !1, this.button = 0, this.buttons = 0, this.width = 0, this.height = 0, this.tiltX = 0, this.tiltY = 0, this.pointerType = null, this.pressure = 0, this.rotationAngle = 0, this.twist = 0, this.tangentialPressure = 0
                    }
                    return t.prototype.getLocalPosition = function(t, e, r) {
                        return t.worldTransform.applyInverse(r || this.global, e)
                    }, t.prototype.copyEvent = function(t) {
                        t.isPrimary && (this.isPrimary = !0), this.button = t.button, this.buttons = Number.isInteger(t.buttons) ? t.buttons : t.which, this.width = t.width, this.height = t.height, this.tiltX = t.tiltX, this.tiltY = t.tiltY, this.pointerType = t.pointerType, this.pressure = t.pressure, this.rotationAngle = t.rotationAngle, this.twist = t.twist || 0, this.tangentialPressure = t.tangentialPressure || 0
                    }, t.prototype.reset = function() {
                        this.isPrimary = !1
                    }, i(t, [{
                        key: "pointerId",
                        get: function() {
                            return this.identifier
                        }
                    }]), t
                }();
            r.default = a
        }, {
            "../core": 65
        }],
        156: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t() {
                    n(this, t), this.stopped = !1, this.target = null, this.currentTarget = null, this.type = null, this.data = null
                }
                return t.prototype.stopPropagation = function() {
                    this.stopped = !0
                }, t.prototype.reset = function() {
                    this.stopped = !1, this.currentTarget = null, this.target = null
                }, t
            }();
            r.default = i
        }, {}],
        157: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
                    return typeof t
                } : function(t) {
                    return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
                },
                u = t("../core"),
                h = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(u),
                l = t("./InteractionData"),
                c = n(l),
                d = t("./InteractionEvent"),
                f = n(d),
                p = t("./InteractionTrackingData"),
                v = n(p),
                y = t("eventemitter3"),
                g = n(y),
                m = t("./interactiveTarget"),
                _ = n(m);
            h.utils.mixins.delayMixin(h.DisplayObject.prototype, _.default);
            var b = 1,
                x = {
                    target: null,
                    data: {
                        global: null
                    }
                },
                T = function(t) {
                    function e(r, n) {
                        i(this, e);
                        var s = o(this, t.call(this));
                        return n = n || {}, s.renderer = r, s.autoPreventDefault = void 0 === n.autoPreventDefault || n.autoPreventDefault, s.interactionFrequency = n.interactionFrequency || 10, s.mouse = new c.default, s.mouse.identifier = b, s.mouse.global.set(-999999), s.activeInteractionData = {}, s.activeInteractionData[b] = s.mouse, s.interactionDataPool = [], s.eventData = new f.default, s.interactionDOMElement = null, s.moveWhenInside = !1, s.eventsAdded = !1, s.mouseOverRenderer = !1, s.supportsTouchEvents = "ontouchstart" in window, s.supportsPointerEvents = !!window.PointerEvent, s.onPointerUp = s.onPointerUp.bind(s), s.processPointerUp = s.processPointerUp.bind(s), s.onPointerCancel = s.onPointerCancel.bind(s), s.processPointerCancel = s.processPointerCancel.bind(s), s.onPointerDown = s.onPointerDown.bind(s), s.processPointerDown = s.processPointerDown.bind(s), s.onPointerMove = s.onPointerMove.bind(s), s.processPointerMove = s.processPointerMove.bind(s), s.onPointerOut = s.onPointerOut.bind(s), s.processPointerOverOut = s.processPointerOverOut.bind(s), s.onPointerOver = s.onPointerOver.bind(s), s.cursorStyles = {
                            default: "inherit",
                            pointer: "pointer"
                        }, s.currentCursorMode = null, s.cursor = null, s._tempPoint = new h.Point, s.resolution = 1, s.setTargetElement(s.renderer.view, s.renderer.resolution), s
                    }
                    return s(e, t), e.prototype.hitTest = function(t, e) {
                        return x.target = null, x.data.global = t, e || (e = this.renderer._lastObjectRendered), this.processInteractive(x, e, null, !0), x.target
                    }, e.prototype.setTargetElement = function(t) {
                        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1;
                        this.removeEvents(), this.interactionDOMElement = t, this.resolution = e, this.addEvents()
                    }, e.prototype.addEvents = function() {
                        this.interactionDOMElement && (h.ticker.shared.add(this.update, this, h.UPDATE_PRIORITY.INTERACTION), window.navigator.msPointerEnabled ? (this.interactionDOMElement.style["-ms-content-zooming"] = "none", this.interactionDOMElement.style["-ms-touch-action"] = "none") : this.supportsPointerEvents && (this.interactionDOMElement.style["touch-action"] = "none"), this.supportsPointerEvents ? (window.document.addEventListener("pointermove", this.onPointerMove, !0), this.interactionDOMElement.addEventListener("pointerdown", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("pointerleave", this.onPointerOut, !0), this.interactionDOMElement.addEventListener("pointerover", this.onPointerOver, !0), window.addEventListener("pointercancel", this.onPointerCancel, !0), window.addEventListener("pointerup", this.onPointerUp, !0)) : (window.document.addEventListener("mousemove", this.onPointerMove, !0), this.interactionDOMElement.addEventListener("mousedown", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("mouseout", this.onPointerOut, !0), this.interactionDOMElement.addEventListener("mouseover", this.onPointerOver, !0), window.addEventListener("mouseup", this.onPointerUp, !0)), this.supportsTouchEvents && (this.interactionDOMElement.addEventListener("touchstart", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("touchcancel", this.onPointerCancel, !0), this.interactionDOMElement.addEventListener("touchend", this.onPointerUp, !0), this.interactionDOMElement.addEventListener("touchmove", this.onPointerMove, !0)), this.eventsAdded = !0)
                    }, e.prototype.removeEvents = function() {
                        this.interactionDOMElement && (h.ticker.shared.remove(this.update, this), window.navigator.msPointerEnabled ? (this.interactionDOMElement.style["-ms-content-zooming"] = "", this.interactionDOMElement.style["-ms-touch-action"] = "") : this.supportsPointerEvents && (this.interactionDOMElement.style["touch-action"] = ""), this.supportsPointerEvents ? (window.document.removeEventListener("pointermove", this.onPointerMove, !0), this.interactionDOMElement.removeEventListener("pointerdown", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("pointerleave", this.onPointerOut, !0), this.interactionDOMElement.removeEventListener("pointerover", this.onPointerOver, !0), window.removeEventListener("pointercancel", this.onPointerCancel, !0), window.removeEventListener("pointerup", this.onPointerUp, !0)) : (window.document.removeEventListener("mousemove", this.onPointerMove, !0), this.interactionDOMElement.removeEventListener("mousedown", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("mouseout", this.onPointerOut, !0), this.interactionDOMElement.removeEventListener("mouseover", this.onPointerOver, !0), window.removeEventListener("mouseup", this.onPointerUp, !0)), this.supportsTouchEvents && (this.interactionDOMElement.removeEventListener("touchstart", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("touchcancel", this.onPointerCancel, !0), this.interactionDOMElement.removeEventListener("touchend", this.onPointerUp, !0), this.interactionDOMElement.removeEventListener("touchmove", this.onPointerMove, !0)), this.interactionDOMElement = null, this.eventsAdded = !1)
                    }, e.prototype.update = function(t) {
                        if (this._deltaTime += t, !(this._deltaTime < this.interactionFrequency) && (this._deltaTime = 0, this.interactionDOMElement)) {
                            if (this.didMove) return void(this.didMove = !1);
                            this.cursor = null;
                            for (var e in this.activeInteractionData)
                                if (this.activeInteractionData.hasOwnProperty(e)) {
                                    var r = this.activeInteractionData[e];
                                    if (r.originalEvent && "touch" !== r.pointerType) {
                                        var n = this.configureInteractionEventForDOMEvent(this.eventData, r.originalEvent, r);
                                        this.processInteractive(n, this.renderer._lastObjectRendered, this.processPointerOverOut, !0)
                                    }
                                } this.setCursorMode(this.cursor)
                        }
                    }, e.prototype.setCursorMode = function(t) {
                        if (t = t || "default", this.currentCursorMode !== t) {
                            this.currentCursorMode = t;
                            var e = this.cursorStyles[t];
                            if (e) switch (void 0 === e ? "undefined" : a(e)) {
                                case "string":
                                    this.interactionDOMElement.style.cursor = e;
                                    break;
                                case "function":
                                    e(t);
                                    break;
                                case "object":
                                    Object.assign(this.interactionDOMElement.style, e)
                            } else "string" != typeof t || Object.prototype.hasOwnProperty.call(this.cursorStyles, t) || (this.interactionDOMElement.style.cursor = t)
                        }
                    }, e.prototype.dispatchEvent = function(t, e, r) {
                        r.stopped || (r.currentTarget = t, r.type = e, t.emit(e, r), t[e] && t[e](r))
                    }, e.prototype.mapPositionToPoint = function(t, e, r) {
                        var n = void 0;
                        n = this.interactionDOMElement.parentElement ? this.interactionDOMElement.getBoundingClientRect() : {
                            x: 0,
                            y: 0,
                            width: 0,
                            height: 0
                        };
                        var i = navigator.isCocoonJS ? this.resolution : 1 / this.resolution;
                        t.x = (e - n.left) * (this.interactionDOMElement.width / n.width) * i, t.y = (r - n.top) * (this.interactionDOMElement.height / n.height) * i
                    }, e.prototype.processInteractive = function(t, e, r, n, i) {
                        if (!e || !e.visible) return !1;
                        var o = t.data.global;
                        i = e.interactive || i;
                        var s = !1,
                            a = i,
                            u = !0;
                        if (e.hitArea ? (n && (e.worldTransform.applyInverse(o, this._tempPoint), e.hitArea.contains(this._tempPoint.x, this._tempPoint.y) ? s = !0 : (n = !1, u = !1)), a = !1) : e._mask && n && (e._mask.containsPoint(o) || (n = !1, u = !1)), u && e.interactiveChildren && e.children)
                            for (var h = e.children, l = h.length - 1; l >= 0; l--) {
                                var c = h[l],
                                    d = this.processInteractive(t, c, r, n, a);
                                if (d) {
                                    if (!c.parent) continue;
                                    a = !1, d && (t.target && (n = !1), s = !0)
                                }
                            }
                        return i && (n && !t.target && !e.hitArea && e.containsPoint && e.containsPoint(o) && (s = !0), e.interactive && (s && !t.target && (t.target = e), r && r(t, e, !!s))), s
                    }, e.prototype.onPointerDown = function(t) {
                        if (!this.supportsTouchEvents || "touch" !== t.pointerType) {
                            var e = this.normalizeToPointerData(t);
                            this.autoPreventDefault && e[0].isNormalized && t.preventDefault();
                            for (var r = e.length, n = 0; n < r; n++) {
                                var i = e[n],
                                    o = this.getInteractionDataForPointerId(i),
                                    s = this.configureInteractionEventForDOMEvent(this.eventData, i, o);
                                if (s.data.originalEvent = t, this.processInteractive(s, this.renderer._lastObjectRendered, this.processPointerDown, !0), this.emit("pointerdown", s), "touch" === i.pointerType) this.emit("touchstart", s);
                                else if ("mouse" === i.pointerType || "pen" === i.pointerType) {
                                    var a = 2 === i.button;
                                    this.emit(a ? "rightdown" : "mousedown", this.eventData)
                                }
                            }
                        }
                    }, e.prototype.processPointerDown = function(t, e, r) {
                        var n = t.data,
                            i = t.data.identifier;
                        if (r)
                            if (e.trackedPointers[i] || (e.trackedPointers[i] = new v.default(i)), this.dispatchEvent(e, "pointerdown", t), "touch" === n.pointerType) this.dispatchEvent(e, "touchstart", t);
                            else if ("mouse" === n.pointerType || "pen" === n.pointerType) {
                            var o = 2 === n.button;
                            o ? e.trackedPointers[i].rightDown = !0 : e.trackedPointers[i].leftDown = !0, this.dispatchEvent(e, o ? "rightdown" : "mousedown", t)
                        }
                    }, e.prototype.onPointerComplete = function(t, e, r) {
                        for (var n = this.normalizeToPointerData(t), i = n.length, o = t.target !== this.interactionDOMElement ? "outside" : "", s = 0; s < i; s++) {
                            var a = n[s],
                                u = this.getInteractionDataForPointerId(a),
                                h = this.configureInteractionEventForDOMEvent(this.eventData, a, u);
                            if (h.data.originalEvent = t, this.processInteractive(h, this.renderer._lastObjectRendered, r, e || !o), this.emit(e ? "pointercancel" : "pointerup" + o, h), "mouse" === a.pointerType || "pen" === a.pointerType) {
                                var l = 2 === a.button;
                                this.emit(l ? "rightup" + o : "mouseup" + o, h)
                            } else "touch" === a.pointerType && (this.emit(e ? "touchcancel" : "touchend" + o, h), this.releaseInteractionDataForPointerId(a.pointerId, u))
                        }
                    }, e.prototype.onPointerCancel = function(t) {
                        this.supportsTouchEvents && "touch" === t.pointerType || this.onPointerComplete(t, !0, this.processPointerCancel)
                    }, e.prototype.processPointerCancel = function(t, e) {
                        var r = t.data,
                            n = t.data.identifier;
                        void 0 !== e.trackedPointers[n] && (delete e.trackedPointers[n], this.dispatchEvent(e, "pointercancel", t), "touch" === r.pointerType && this.dispatchEvent(e, "touchcancel", t))
                    }, e.prototype.onPointerUp = function(t) {
                        this.supportsTouchEvents && "touch" === t.pointerType || this.onPointerComplete(t, !1, this.processPointerUp)
                    }, e.prototype.processPointerUp = function(t, e, r) {
                        var n = t.data,
                            i = t.data.identifier,
                            o = e.trackedPointers[i],
                            s = "touch" === n.pointerType;
                        if ("mouse" === n.pointerType || "pen" === n.pointerType) {
                            var a = 2 === n.button,
                                u = v.default.FLAGS,
                                h = a ? u.RIGHT_DOWN : u.LEFT_DOWN,
                                l = void 0 !== o && o.flags & h;
                            r ? (this.dispatchEvent(e, a ? "rightup" : "mouseup", t), l && this.dispatchEvent(e, a ? "rightclick" : "click", t)) : l && this.dispatchEvent(e, a ? "rightupoutside" : "mouseupoutside", t), o && (a ? o.rightDown = !1 : o.leftDown = !1)
                        }
                        r ? (this.dispatchEvent(e, "pointerup", t), s && this.dispatchEvent(e, "touchend", t), o && (this.dispatchEvent(e, "pointertap", t), s && (this.dispatchEvent(e, "tap", t), o.over = !1))) : o && (this.dispatchEvent(e, "pointerupoutside", t), s && this.dispatchEvent(e, "touchendoutside", t)), o && o.none && delete e.trackedPointers[i]
                    }, e.prototype.onPointerMove = function(t) {
                        if (!this.supportsTouchEvents || "touch" !== t.pointerType) {
                            var e = this.normalizeToPointerData(t);
                            "mouse" !== e[0].pointerType && "pen" !== e[0].pointerType || (this.didMove = !0, this.cursor = null);
                            for (var r = e.length, n = 0; n < r; n++) {
                                var i = e[n],
                                    o = this.getInteractionDataForPointerId(i),
                                    s = this.configureInteractionEventForDOMEvent(this.eventData, i, o);
                                s.data.originalEvent = t;
                                var a = "touch" !== i.pointerType || this.moveWhenInside;
                                this.processInteractive(s, this.renderer._lastObjectRendered, this.processPointerMove, a), this.emit("pointermove", s), "touch" === i.pointerType && this.emit("touchmove", s), "mouse" !== i.pointerType && "pen" !== i.pointerType || this.emit("mousemove", s)
                            }
                            "mouse" === e[0].pointerType && this.setCursorMode(this.cursor)
                        }
                    }, e.prototype.processPointerMove = function(t, e, r) {
                        var n = t.data,
                            i = "touch" === n.pointerType,
                            o = "mouse" === n.pointerType || "pen" === n.pointerType;
                        o && this.processPointerOverOut(t, e, r), this.moveWhenInside && !r || (this.dispatchEvent(e, "pointermove", t), i && this.dispatchEvent(e, "touchmove", t), o && this.dispatchEvent(e, "mousemove", t))
                    }, e.prototype.onPointerOut = function(t) {
                        if (!this.supportsTouchEvents || "touch" !== t.pointerType) {
                            var e = this.normalizeToPointerData(t),
                                r = e[0];
                            "mouse" === r.pointerType && (this.mouseOverRenderer = !1, this.setCursorMode(null));
                            var n = this.getInteractionDataForPointerId(r),
                                i = this.configureInteractionEventForDOMEvent(this.eventData, r, n);
                            i.data.originalEvent = r, this.processInteractive(i, this.renderer._lastObjectRendered, this.processPointerOverOut, !1), this.emit("pointerout", i), "mouse" === r.pointerType || "pen" === r.pointerType ? this.emit("mouseout", i) : this.releaseInteractionDataForPointerId(n.identifier)
                        }
                    }, e.prototype.processPointerOverOut = function(t, e, r) {
                        var n = t.data,
                            i = t.data.identifier,
                            o = "mouse" === n.pointerType || "pen" === n.pointerType,
                            s = e.trackedPointers[i];
                        r && !s && (s = e.trackedPointers[i] = new v.default(i)), void 0 !== s && (r && this.mouseOverRenderer ? (s.over || (s.over = !0, this.dispatchEvent(e, "pointerover", t), o && this.dispatchEvent(e, "mouseover", t)), o && null === this.cursor && (this.cursor = e.cursor)) : s.over && (s.over = !1, this.dispatchEvent(e, "pointerout", this.eventData), o && this.dispatchEvent(e, "mouseout", t), s.none && delete e.trackedPointers[i]))
                    }, e.prototype.onPointerOver = function(t) {
                        var e = this.normalizeToPointerData(t),
                            r = e[0],
                            n = this.getInteractionDataForPointerId(r),
                            i = this.configureInteractionEventForDOMEvent(this.eventData, r, n);
                        i.data.originalEvent = r, "mouse" === r.pointerType && (this.mouseOverRenderer = !0), this.emit("pointerover", i), "mouse" !== r.pointerType && "pen" !== r.pointerType || this.emit("mouseover", i)
                    }, e.prototype.getInteractionDataForPointerId = function(t) {
                        var e = t.pointerId,
                            r = void 0;
                        return e === b || "mouse" === t.pointerType ? r = this.mouse : this.activeInteractionData[e] ? r = this.activeInteractionData[e] : (r = this.interactionDataPool.pop() || new c.default, r.identifier = e, this.activeInteractionData[e] = r), r.copyEvent(t), r
                    }, e.prototype.releaseInteractionDataForPointerId = function(t) {
                        var e = this.activeInteractionData[t];
                        e && (delete this.activeInteractionData[t], e.reset(), this.interactionDataPool.push(e))
                    }, e.prototype.configureInteractionEventForDOMEvent = function(t, e, r) {
                        return t.data = r, this.mapPositionToPoint(r.global, e.clientX, e.clientY), navigator.isCocoonJS && "touch" === e.pointerType && (r.global.x = r.global.x / this.resolution, r.global.y = r.global.y / this.resolution), "touch" === e.pointerType && (e.globalX = r.global.x, e.globalY = r.global.y), r.originalEvent = e, t.reset(), t
                    }, e.prototype.normalizeToPointerData = function(t) {
                        var e = [];
                        if (this.supportsTouchEvents && t instanceof TouchEvent)
                            for (var r = 0, n = t.changedTouches.length; r < n; r++) {
                                var i = t.changedTouches[r];
                                void 0 === i.button && (i.button = t.touches.length ? 1 : 0), void 0 === i.buttons && (i.buttons = t.touches.length ? 1 : 0), void 0 === i.isPrimary && (i.isPrimary = 1 === t.touches.length && "touchstart" === t.type), void 0 === i.width && (i.width = i.radiusX || 1), void 0 === i.height && (i.height = i.radiusY || 1), void 0 === i.tiltX && (i.tiltX = 0), void 0 === i.tiltY && (i.tiltY = 0), void 0 === i.pointerType && (i.pointerType = "touch"), void 0 === i.pointerId && (i.pointerId = i.identifier || 0), void 0 === i.pressure && (i.pressure = i.force || .5), i.twist = 0, i.tangentialPressure = 0, void 0 === i.layerX && (i.layerX = i.offsetX = i.clientX), void 0 === i.layerY && (i.layerY = i.offsetY = i.clientY), i.isNormalized = !0, e.push(i)
                            } else !(t instanceof MouseEvent) || this.supportsPointerEvents && t instanceof window.PointerEvent ? e.push(t) : (void 0 === t.isPrimary && (t.isPrimary = !0), void 0 === t.width && (t.width = 1), void 0 === t.height && (t.height = 1), void 0 === t.tiltX && (t.tiltX = 0), void 0 === t.tiltY && (t.tiltY = 0), void 0 === t.pointerType && (t.pointerType = "mouse"), void 0 === t.pointerId && (t.pointerId = b), void 0 === t.pressure && (t.pressure = .5), t.twist = 0, t.tangentialPressure = 0, t.isNormalized = !0, e.push(t));
                        return e
                    }, e.prototype.destroy = function() {
                        this.removeEvents(), this.removeAllListeners(), this.renderer = null, this.mouse = null, this.eventData = null, this.interactionDOMElement = null, this.onPointerDown = null, this.processPointerDown = null, this.onPointerUp = null, this.processPointerUp = null, this.onPointerCancel = null, this.processPointerCancel = null, this.onPointerMove = null, this.processPointerMove = null, this.onPointerOut = null, this.processPointerOverOut = null, this.onPointerOver = null, this._tempPoint = null
                    }, e
                }(g.default);
            r.default = T, h.WebGLRenderer.registerPlugin("interaction", T), h.CanvasRenderer.registerPlugin("interaction", T)
        }, {
            "../core": 65,
            "./InteractionData": 155,
            "./InteractionEvent": 156,
            "./InteractionTrackingData": 158,
            "./interactiveTarget": 160,
            eventemitter3: 3
        }],
        158: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                o = function() {
                    function t(e) {
                        n(this, t), this._pointerId = e, this._flags = t.FLAGS.NONE
                    }
                    return t.prototype._doSet = function(t, e) {
                        this._flags = e ? this._flags | t : this._flags & ~t
                    }, i(t, [{
                        key: "pointerId",
                        get: function() {
                            return this._pointerId
                        }
                    }, {
                        key: "flags",
                        get: function() {
                            return this._flags
                        },
                        set: function(t) {
                            this._flags = t
                        }
                    }, {
                        key: "none",
                        get: function() {
                            return this._flags === this.constructor.FLAGS.NONE
                        }
                    }, {
                        key: "over",
                        get: function() {
                            return 0 != (this._flags & this.constructor.FLAGS.OVER)
                        },
                        set: function(t) {
                            this._doSet(this.constructor.FLAGS.OVER, t)
                        }
                    }, {
                        key: "rightDown",
                        get: function() {
                            return 0 != (this._flags & this.constructor.FLAGS.RIGHT_DOWN)
                        },
                        set: function(t) {
                            this._doSet(this.constructor.FLAGS.RIGHT_DOWN, t)
                        }
                    }, {
                        key: "leftDown",
                        get: function() {
                            return 0 != (this._flags & this.constructor.FLAGS.LEFT_DOWN)
                        },
                        set: function(t) {
                            this._doSet(this.constructor.FLAGS.LEFT_DOWN, t)
                        }
                    }]), t
                }();
            r.default = o, o.FLAGS = Object.freeze({
                NONE: 0,
                OVER: 1,
                LEFT_DOWN: 2,
                RIGHT_DOWN: 4
            })
        }, {}],
        159: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./InteractionData");
            Object.defineProperty(r, "InteractionData", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./InteractionManager");
            Object.defineProperty(r, "InteractionManager", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            });
            var s = t("./interactiveTarget");
            Object.defineProperty(r, "interactiveTarget", {
                enumerable: !0,
                get: function() {
                    return n(s).default
                }
            });
            var a = t("./InteractionTrackingData");
            Object.defineProperty(r, "InteractionTrackingData", {
                enumerable: !0,
                get: function() {
                    return n(a).default
                }
            });
            var u = t("./InteractionEvent");
            Object.defineProperty(r, "InteractionEvent", {
                enumerable: !0,
                get: function() {
                    return n(u).default
                }
            })
        }, {
            "./InteractionData": 155,
            "./InteractionEvent": 156,
            "./InteractionManager": 157,
            "./InteractionTrackingData": 158,
            "./interactiveTarget": 160
        }],
        160: [function(t, e, r) {
            "use strict";
            r.__esModule = !0, r.default = {
                interactive: !1,
                interactiveChildren: !0,
                hitArea: null,
                get buttonMode() {
                    return "pointer" === this.cursor
                },
                set buttonMode(t) {
                    t ? this.cursor = "pointer" : "pointer" === this.cursor && (this.cursor = null)
                },
                cursor: null,
                get trackedPointers() {
                    return void 0 === this._trackedPointers && (this._trackedPointers = {}), this._trackedPointers
                },
                _trackedPointers: void 0
            }
        }, {}],
        161: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                t.bitmapFont = u.BitmapText.registerFont(t.data, e)
            }
            r.__esModule = !0, r.parse = n, r.default = function() {
                return function(t, e) {
                    if (!t.data || t.type !== a.Resource.TYPE.XML) return void e();
                    if (0 === t.data.getElementsByTagName("page").length || 0 === t.data.getElementsByTagName("info").length || null === t.data.getElementsByTagName("info")[0].getAttribute("face")) return void e();
                    var r = t.isDataUrl ? "" : o.dirname(t.url);
                    t.isDataUrl && ("." === r && (r = ""), this.baseUrl && r && "/" === this.baseUrl.charAt(this.baseUrl.length - 1) && (r += "/")), (r = r.replace(this.baseUrl, "")) && "/" !== r.charAt(r.length - 1) && (r += "/");
                    var i = r + t.data.getElementsByTagName("page")[0].getAttribute("file");
                    if (s.utils.TextureCache[i]) n(t, s.utils.TextureCache[i]), e();
                    else {
                        var u = {
                            crossOrigin: t.crossOrigin,
                            loadType: a.Resource.LOAD_TYPE.IMAGE,
                            metadata: t.metadata.imageMetadata,
                            parentResource: t
                        };
                        this.add(t.name + "_image", i, u, function(r) {
                            n(t, r.texture), e()
                        })
                    }
                }
            };
            var i = t("path"),
                o = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(i),
                s = t("../core"),
                a = t("resource-loader"),
                u = t("../extras")
        }, {
            "../core": 65,
            "../extras": 141,
            path: 8,
            "resource-loader": 36
        }],
        162: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0, r.shared = r.Resource = r.textureParser = r.getResourcePath = r.spritesheetParser = r.parseBitmapFontData = r.bitmapFontParser = r.Loader = void 0;
            var i = t("./bitmapFontParser");
            Object.defineProperty(r, "bitmapFontParser", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            }), Object.defineProperty(r, "parseBitmapFontData", {
                enumerable: !0,
                get: function() {
                    return i.parse
                }
            });
            var o = t("./spritesheetParser");
            Object.defineProperty(r, "spritesheetParser", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            }), Object.defineProperty(r, "getResourcePath", {
                enumerable: !0,
                get: function() {
                    return o.getResourcePath
                }
            });
            var s = t("./textureParser");
            Object.defineProperty(r, "textureParser", {
                enumerable: !0,
                get: function() {
                    return n(s).default
                }
            });
            var a = t("resource-loader");
            Object.defineProperty(r, "Resource", {
                enumerable: !0,
                get: function() {
                    return a.Resource
                }
            });
            var u = t("../core/Application"),
                h = n(u),
                l = t("./loader"),
                c = n(l);
            r.Loader = c.default;
            var d = new c.default;
            d.destroy = function() {}, r.shared = d;
            var f = h.default.prototype;
            f._loader = null, Object.defineProperty(f, "loader", {
                get: function() {
                    if (!this._loader) {
                        var t = this._options.sharedLoader;
                        this._loader = t ? d : new c.default
                    }
                    return this._loader
                }
            }), f._parentDestroy = f.destroy, f.destroy = function(t) {
                this._loader && (this._loader.destroy(), this._loader = null), this._parentDestroy(t)
            }
        }, {
            "../core/Application": 43,
            "./bitmapFontParser": 161,
            "./loader": 163,
            "./spritesheetParser": 164,
            "./textureParser": 165,
            "resource-loader": 36
        }],
        163: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("resource-loader"),
                u = n(a),
                h = t("resource-loader/lib/middlewares/parsing/blob"),
                l = t("eventemitter3"),
                c = n(l),
                d = t("./textureParser"),
                f = n(d),
                p = t("./spritesheetParser"),
                v = n(p),
                y = t("./bitmapFontParser"),
                g = n(y),
                m = function(t) {
                    function e(r, n) {
                        i(this, e);
                        var s = o(this, t.call(this, r, n));
                        c.default.call(s);
                        for (var a = 0; a < e._pixiMiddleware.length; ++a) s.use(e._pixiMiddleware[a]());
                        return s.onStart.add(function(t) {
                            return s.emit("start", t)
                        }), s.onProgress.add(function(t, e) {
                            return s.emit("progress", t, e)
                        }), s.onError.add(function(t, e, r) {
                            return s.emit("error", t, e, r)
                        }), s.onLoad.add(function(t, e) {
                            return s.emit("load", t, e)
                        }), s.onComplete.add(function(t, e) {
                            return s.emit("complete", t, e)
                        }), s
                    }
                    return s(e, t), e.addPixiMiddleware = function(t) {
                        e._pixiMiddleware.push(t)
                    }, e.prototype.destroy = function() {
                        this.removeAllListeners(), this.reset()
                    }, e
                }(u.default);
            r.default = m;
            for (var _ in c.default.prototype) m.prototype[_] = c.default.prototype[_];
            m._pixiMiddleware = [h.blobMiddlewareFactory, f.default, v.default, g.default];
            var b = u.default.Resource;
            b.setExtensionXhrType("fnt", b.XHR_RESPONSE_TYPE.DOCUMENT)
        }, {
            "./bitmapFontParser": 161,
            "./spritesheetParser": 164,
            "./textureParser": 165,
            eventemitter3: 3,
            "resource-loader": 36,
            "resource-loader/lib/middlewares/parsing/blob": 37
        }],
        164: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                return t.isDataUrl ? t.data.meta.image : s.default.resolve(t.url.replace(e, ""), t.data.meta.image)
            }
            r.__esModule = !0, r.default = function() {
                return function(t, e) {
                    var r = t.name + "_image";
                    if (!t.data || t.type !== i.Resource.TYPE.JSON || !t.data.frames || this.resources[r]) return void e();
                    var o = {
                            crossOrigin: t.crossOrigin,
                            metadata: t.metadata.imageMetadata,
                            parentResource: t
                        },
                        s = n(t, this.baseUrl);
                    this.add(r, s, o, function(r) {
                        if (r.error) return void e(r.error);
                        var n = new a.Spritesheet(r.texture.baseTexture, t.data, t.url);
                        n.parse(function() {
                            t.spritesheet = n, t.textures = n.textures, e()
                        })
                    })
                }
            }, r.getResourcePath = n;
            var i = t("resource-loader"),
                o = t("url"),
                s = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(o),
                a = t("../core")
        }, {
            "../core": 65,
            "resource-loader": 36,
            url: 38
        }],
        165: [function(t, e, r) {
            "use strict";
            r.__esModule = !0, r.default = function() {
                return function(t, e) {
                    t.data && t.type === n.Resource.TYPE.IMAGE && (t.texture = o.default.fromLoader(t.data, t.url, t.name)), e()
                }
            };
            var n = t("resource-loader"),
                i = t("../core/textures/Texture"),
                o = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(i)
        }, {
            "../core/textures/Texture": 115,
            "resource-loader": 36
        }],
        166: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = t("../core/textures/Texture"),
                l = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(h),
                c = new u.Point,
                d = new u.Polygon,
                f = function(t) {
                    function e(r, o, s, a, h) {
                        n(this, e);
                        var c = i(this, t.call(this));
                        return c._texture = r || l.default.EMPTY, c.uvs = s || new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]), c.vertices = o || new Float32Array([0, 0, 100, 0, 100, 100, 0, 100]), c.indices = a || new Uint16Array([0, 1, 3, 2]), c.dirty = 0, c.indexDirty = 0, c.blendMode = u.BLEND_MODES.NORMAL, c.canvasPadding = u.settings.MESH_CANVAS_PADDING, c.drawMode = h || e.DRAW_MODES.TRIANGLE_MESH, c.shader = null, c.tintRgb = new Float32Array([1, 1, 1]), c._glDatas = {}, c._uvTransform = new u.TextureMatrix(c._texture), c.uploadUvTransform = !1, c.pluginName = "mesh", c
                    }
                    return o(e, t), e.prototype._renderWebGL = function(t) {
                        this.refresh(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this)
                    }, e.prototype._renderCanvas = function(t) {
                        this.refresh(), t.plugins[this.pluginName].render(this)
                    }, e.prototype._onTextureUpdate = function() {
                        this._uvTransform.texture = this._texture, this.refresh()
                    }, e.prototype.multiplyUvs = function() {
                        this.uploadUvTransform || this._uvTransform.multiplyUvs(this.uvs)
                    }, e.prototype.refresh = function(t) {
                        this._uvTransform.update(t) && this._refresh()
                    }, e.prototype._refresh = function() {}, e.prototype._calculateBounds = function() {
                        this._bounds.addVertices(this.transform, this.vertices, 0, this.vertices.length)
                    }, e.prototype.containsPoint = function(t) {
                        if (!this.getBounds().contains(t.x, t.y)) return !1;
                        this.worldTransform.applyInverse(t, c);
                        for (var r = this.vertices, n = d.points, i = this.indices, o = this.indices.length, s = this.drawMode === e.DRAW_MODES.TRIANGLES ? 3 : 1, a = 0; a + 2 < o; a += s) {
                            var u = 2 * i[a],
                                h = 2 * i[a + 1],
                                l = 2 * i[a + 2];
                            if (n[0] = r[u], n[1] = r[u + 1], n[2] = r[h], n[3] = r[h + 1], n[4] = r[l], n[5] = r[l + 1], d.contains(c.x, c.y)) return !0
                        }
                        return !1
                    }, s(e, [{
                        key: "texture",
                        get: function() {
                            return this._texture
                        },
                        set: function(t) {
                            this._texture !== t && (this._texture = t, t && (t.baseTexture.hasLoaded ? this._onTextureUpdate() : t.once("update", this._onTextureUpdate, this)))
                        }
                    }, {
                        key: "tint",
                        get: function() {
                            return u.utils.rgb2hex(this.tintRgb)
                        },
                        set: function(t) {
                            this.tintRgb = u.utils.hex2rgb(t, this.tintRgb)
                        }
                    }]), e
                }(u.Container);
            r.default = f, f.DRAW_MODES = {
                TRIANGLE_MESH: 0,
                TRIANGLES: 1
            }
        }, {
            "../core": 65,
            "../core/textures/Texture": 115
        }],
        167: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("./Plane"),
                u = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(a),
                h = 10,
                l = function(t) {
                    function e(r, o, s, a, u) {
                        n(this, e);
                        var l = i(this, t.call(this, r, 4, 4));
                        return l._origWidth = r.orig.width, l._origHeight = r.orig.height, l._width = l._origWidth, l._height = l._origHeight, l.leftWidth = void 0 !== o ? o : h, l.rightWidth = void 0 !== a ? a : h, l.topHeight = void 0 !== s ? s : h, l.bottomHeight = void 0 !== u ? u : h, l.refresh(!0), l
                    }
                    return o(e, t), e.prototype.updateHorizontalVertices = function() {
                        var t = this.vertices;
                        t[9] = t[11] = t[13] = t[15] = this._topHeight, t[17] = t[19] = t[21] = t[23] = this._height - this._bottomHeight, t[25] = t[27] = t[29] = t[31] = this._height
                    }, e.prototype.updateVerticalVertices = function() {
                        var t = this.vertices;
                        t[2] = t[10] = t[18] = t[26] = this._leftWidth, t[4] = t[12] = t[20] = t[28] = this._width - this._rightWidth, t[6] = t[14] = t[22] = t[30] = this._width
                    }, e.prototype._renderCanvas = function(t) {
                        var e = t.context;
                        e.globalAlpha = this.worldAlpha, t.setBlendMode(this.blendMode);
                        var r = this.worldTransform,
                            n = t.resolution;
                        t.roundPixels ? e.setTransform(r.a * n, r.b * n, r.c * n, r.d * n, r.tx * n | 0, r.ty * n | 0) : e.setTransform(r.a * n, r.b * n, r.c * n, r.d * n, r.tx * n, r.ty * n);
                        var i = this._texture.baseTexture,
                            o = i.source,
                            s = i.width * i.resolution,
                            a = i.height * i.resolution;
                        this.drawSegment(e, o, s, a, 0, 1, 10, 11), this.drawSegment(e, o, s, a, 2, 3, 12, 13), this.drawSegment(e, o, s, a, 4, 5, 14, 15), this.drawSegment(e, o, s, a, 8, 9, 18, 19), this.drawSegment(e, o, s, a, 10, 11, 20, 21), this.drawSegment(e, o, s, a, 12, 13, 22, 23), this.drawSegment(e, o, s, a, 16, 17, 26, 27), this.drawSegment(e, o, s, a, 18, 19, 28, 29), this.drawSegment(e, o, s, a, 20, 21, 30, 31)
                    }, e.prototype.drawSegment = function(t, e, r, n, i, o, s, a) {
                        var u = this.uvs,
                            h = this.vertices,
                            l = (u[s] - u[i]) * r,
                            c = (u[a] - u[o]) * n,
                            d = h[s] - h[i],
                            f = h[a] - h[o];
                        l < 1 && (l = 1), c < 1 && (c = 1), d < 1 && (d = 1), f < 1 && (f = 1), t.drawImage(e, u[i] * r, u[o] * n, l, c, h[i], h[o], d, f)
                    }, e.prototype._refresh = function() {
                        t.prototype._refresh.call(this);
                        var e = this.uvs,
                            r = this._texture;
                        this._origWidth = r.orig.width, this._origHeight = r.orig.height;
                        var n = 1 / this._origWidth,
                            i = 1 / this._origHeight;
                        e[0] = e[8] = e[16] = e[24] = 0, e[1] = e[3] = e[5] = e[7] = 0, e[6] = e[14] = e[22] = e[30] = 1, e[25] = e[27] = e[29] = e[31] = 1, e[2] = e[10] = e[18] = e[26] = n * this._leftWidth, e[4] = e[12] = e[20] = e[28] = 1 - n * this._rightWidth, e[9] = e[11] = e[13] = e[15] = i * this._topHeight, e[17] = e[19] = e[21] = e[23] = 1 - i * this._bottomHeight, this.updateHorizontalVertices(), this.updateVerticalVertices(), this.dirty++, this.multiplyUvs()
                    }, s(e, [{
                        key: "width",
                        get: function() {
                            return this._width
                        },
                        set: function(t) {
                            this._width = t, this._refresh()
                        }
                    }, {
                        key: "height",
                        get: function() {
                            return this._height
                        },
                        set: function(t) {
                            this._height = t, this._refresh()
                        }
                    }, {
                        key: "leftWidth",
                        get: function() {
                            return this._leftWidth
                        },
                        set: function(t) {
                            this._leftWidth = t, this._refresh()
                        }
                    }, {
                        key: "rightWidth",
                        get: function() {
                            return this._rightWidth
                        },
                        set: function(t) {
                            this._rightWidth = t, this._refresh()
                        }
                    }, {
                        key: "topHeight",
                        get: function() {
                            return this._topHeight
                        },
                        set: function(t) {
                            this._topHeight = t, this._refresh()
                        }
                    }, {
                        key: "bottomHeight",
                        get: function() {
                            return this._bottomHeight
                        },
                        set: function(t) {
                            this._bottomHeight = t, this._refresh()
                        }
                    }]), e
                }(u.default);
            r.default = l
        }, {
            "./Plane": 168
        }],
        168: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("./Mesh"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = function(t) {
                    function e(r, o, s) {
                        n(this, e);
                        var u = i(this, t.call(this, r));
                        return u._ready = !0, u.verticesX = o || 10, u.verticesY = s || 10, u.drawMode = a.default.DRAW_MODES.TRIANGLES, u.refresh(), u
                    }
                    return o(e, t), e.prototype._refresh = function() {
                        for (var t = this._texture, e = this.verticesX * this.verticesY, r = [], n = [], i = [], o = [], s = this.verticesX - 1, a = this.verticesY - 1, u = t.width / s, h = t.height / a, l = 0; l < e; l++) {
                            var c = l % this.verticesX,
                                d = l / this.verticesX | 0;
                            r.push(c * u, d * h), i.push(c / s, d / a)
                        }
                        for (var f = s * a, p = 0; p < f; p++) {
                            var v = p % s,
                                y = p / s | 0,
                                g = y * this.verticesX + v,
                                m = y * this.verticesX + v + 1,
                                _ = (y + 1) * this.verticesX + v,
                                b = (y + 1) * this.verticesX + v + 1;
                            o.push(g, m, _), o.push(m, b, _)
                        }
                        this.vertices = new Float32Array(r), this.uvs = new Float32Array(i), this.colors = new Float32Array(n), this.indices = new Uint16Array(o), this.dirty++, this.indexDirty++, this.multiplyUvs()
                    }, e.prototype._onTextureUpdate = function() {
                        a.default.prototype._onTextureUpdate.call(this), this._ready && this.refresh()
                    }, e
                }(a.default);
            r.default = u
        }, {
            "./Mesh": 166
        }],
        169: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("./Mesh"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = function(t) {
                    function e(r, o) {
                        n(this, e);
                        var s = i(this, t.call(this, r));
                        return s.points = o, s.vertices = new Float32Array(4 * o.length), s.uvs = new Float32Array(4 * o.length), s.colors = new Float32Array(2 * o.length), s.indices = new Uint16Array(2 * o.length), s.autoUpdate = !0, s.refresh(), s
                    }
                    return o(e, t), e.prototype._refresh = function() {
                        var t = this.points;
                        if (!(t.length < 1) && this._texture._uvs) {
                            this.vertices.length / 4 !== t.length && (this.vertices = new Float32Array(4 * t.length), this.uvs = new Float32Array(4 * t.length), this.colors = new Float32Array(2 * t.length), this.indices = new Uint16Array(2 * t.length));
                            var e = this.uvs,
                                r = this.indices,
                                n = this.colors;
                            e[0] = 0, e[1] = 0, e[2] = 0, e[3] = 1, n[0] = 1, n[1] = 1, r[0] = 0, r[1] = 1;
                            for (var i = t.length, o = 1; o < i; o++) {
                                var s = 4 * o,
                                    a = o / (i - 1);
                                e[s] = a, e[s + 1] = 0, e[s + 2] = a, e[s + 3] = 1, s = 2 * o, n[s] = 1, n[s + 1] = 1, s = 2 * o, r[s] = s, r[s + 1] = s + 1
                            }
                            this.dirty++, this.indexDirty++, this.multiplyUvs(), this.refreshVertices()
                        }
                    }, e.prototype.refreshVertices = function() {
                        var t = this.points;
                        if (!(t.length < 1))
                            for (var e = t[0], r = void 0, n = 0, i = 0, o = this.vertices, s = t.length, a = 0; a < s; a++) {
                                var u = t[a],
                                    h = 4 * a;
                                r = a < t.length - 1 ? t[a + 1] : u, i = -(r.x - e.x), n = r.y - e.y;
                                var l = 10 * (1 - a / (s - 1));
                                l > 1 && (l = 1);
                                var c = Math.sqrt(n * n + i * i),
                                    d = this._texture.height / 2;
                                n /= c, i /= c, n *= d, i *= d, o[h] = u.x + n, o[h + 1] = u.y + i, o[h + 2] = u.x - n, o[h + 3] = u.y - i, e = u
                            }
                    }, e.prototype.updateTransform = function() {
                        this.autoUpdate && this.refreshVertices(), this.containerUpdateTransform()
                    }, e
                }(a.default);
            r.default = u
        }, {
            "./Mesh": 166
        }],
        170: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = t("../../core"),
                o = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(i),
                s = t("../Mesh"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = function() {
                    function t(e) {
                        n(this, t), this.renderer = e
                    }
                    return t.prototype.render = function(t) {
                        var e = this.renderer,
                            r = e.context,
                            n = t.worldTransform,
                            i = e.resolution;
                        e.roundPixels ? r.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i | 0, n.ty * i | 0) : r.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i, n.ty * i), e.context.globalAlpha = t.worldAlpha, e.setBlendMode(t.blendMode), t.drawMode === a.default.DRAW_MODES.TRIANGLE_MESH ? this._renderTriangleMesh(t) : this._renderTriangles(t)
                    }, t.prototype._renderTriangleMesh = function(t) {
                        for (var e = t.vertices.length / 2, r = 0; r < e - 2; r++) {
                            var n = 2 * r;
                            this._renderDrawTriangle(t, n, n + 2, n + 4)
                        }
                    }, t.prototype._renderTriangles = function(t) {
                        for (var e = t.indices, r = e.length, n = 0; n < r; n += 3) {
                            var i = 2 * e[n],
                                o = 2 * e[n + 1],
                                s = 2 * e[n + 2];
                            this._renderDrawTriangle(t, i, o, s)
                        }
                    }, t.prototype._renderDrawTriangle = function(t, e, r, n) {
                        var i = this.renderer.context,
                            o = t.uvs,
                            s = t.vertices,
                            a = t._texture;
                        if (a.valid) {
                            var u = a.baseTexture,
                                h = u.source,
                                l = u.width,
                                c = u.height,
                                d = void 0,
                                f = void 0,
                                p = void 0,
                                v = void 0,
                                y = void 0,
                                g = void 0;
                            if (t.uploadUvTransform) {
                                var m = t._uvTransform.mapCoord;
                                d = (o[e] * m.a + o[e + 1] * m.c + m.tx) * u.width, f = (o[r] * m.a + o[r + 1] * m.c + m.tx) * u.width, p = (o[n] * m.a + o[n + 1] * m.c + m.tx) * u.width, v = (o[e] * m.b + o[e + 1] * m.d + m.ty) * u.height, y = (o[r] * m.b + o[r + 1] * m.d + m.ty) * u.height, g = (o[n] * m.b + o[n + 1] * m.d + m.ty) * u.height
                            } else d = o[e] * u.width, f = o[r] * u.width, p = o[n] * u.width, v = o[e + 1] * u.height, y = o[r + 1] * u.height, g = o[n + 1] * u.height;
                            var _ = s[e],
                                b = s[r],
                                x = s[n],
                                T = s[e + 1],
                                w = s[r + 1],
                                E = s[n + 1],
                                S = t.canvasPadding / this.renderer.resolution;
                            if (S > 0) {
                                var O = S / Math.abs(t.worldTransform.a),
                                    M = S / Math.abs(t.worldTransform.d),
                                    P = (_ + b + x) / 3,
                                    C = (T + w + E) / 3,
                                    R = _ - P,
                                    A = T - C,
                                    I = Math.sqrt(R * R + A * A);
                                _ = P + R / I * (I + O), T = C + A / I * (I + M), R = b - P, A = w - C, I = Math.sqrt(R * R + A * A), b = P + R / I * (I + O), w = C + A / I * (I + M), R = x - P, A = E - C, I = Math.sqrt(R * R + A * A), x = P + R / I * (I + O), E = C + A / I * (I + M)
                            }
                            i.save(), i.beginPath(), i.moveTo(_, T), i.lineTo(b, w), i.lineTo(x, E), i.closePath(), i.clip();
                            var D = d * y + v * p + f * g - y * p - v * f - d * g,
                                L = _ * y + v * x + b * g - y * x - v * b - _ * g,
                                N = d * b + _ * p + f * x - b * p - _ * f - d * x,
                                F = d * y * x + v * b * p + _ * f * g - _ * y * p - v * f * x - d * b * g,
                                B = T * y + v * E + w * g - y * E - v * w - T * g,
                                k = d * w + T * p + f * E - w * p - T * f - d * E,
                                j = d * y * E + v * w * p + T * f * g - T * y * p - v * f * E - d * w * g;
                            i.transform(L / D, B / D, N / D, k / D, F / D, j / D), i.drawImage(h, 0, 0, l * u.resolution, c * u.resolution, 0, 0, l, c), i.restore(), this.renderer.invalidateBlendMode()
                        }
                    }, t.prototype.renderMeshFlat = function(t) {
                        var e = this.renderer.context,
                            r = t.vertices,
                            n = r.length / 2;
                        e.beginPath();
                        for (var i = 1; i < n - 2; ++i) {
                            var o = 2 * i,
                                s = r[o],
                                a = r[o + 1],
                                u = r[o + 2],
                                h = r[o + 3],
                                l = r[o + 4],
                                c = r[o + 5];
                            e.moveTo(s, a), e.lineTo(u, h), e.lineTo(l, c)
                        }
                        e.fillStyle = "#FF0000", e.fill(), e.closePath()
                    }, t.prototype.destroy = function() {
                        this.renderer = null
                    }, t
                }();
            r.default = u, o.CanvasRenderer.registerPlugin("mesh", u)
        }, {
            "../../core": 65,
            "../Mesh": 166
        }],
        171: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./Mesh");
            Object.defineProperty(r, "Mesh", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./webgl/MeshRenderer");
            Object.defineProperty(r, "MeshRenderer", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            });
            var s = t("./canvas/CanvasMeshRenderer");
            Object.defineProperty(r, "CanvasMeshRenderer", {
                enumerable: !0,
                get: function() {
                    return n(s).default
                }
            });
            var a = t("./Plane");
            Object.defineProperty(r, "Plane", {
                enumerable: !0,
                get: function() {
                    return n(a).default
                }
            });
            var u = t("./NineSlicePlane");
            Object.defineProperty(r, "NineSlicePlane", {
                enumerable: !0,
                get: function() {
                    return n(u).default
                }
            });
            var h = t("./Rope");
            Object.defineProperty(r, "Rope", {
                enumerable: !0,
                get: function() {
                    return n(h).default
                }
            })
        }, {
            "./Mesh": 166,
            "./NineSlicePlane": 167,
            "./Plane": 168,
            "./Rope": 169,
            "./canvas/CanvasMeshRenderer": 170,
            "./webgl/MeshRenderer": 172
        }],
        172: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = t("pixi-gl-core"),
                l = n(h),
                c = t("../Mesh"),
                d = n(c),
                f = (t("path"), u.Matrix.IDENTITY),
                p = function(t) {
                    function e(r) {
                        i(this, e);
                        var n = o(this, t.call(this, r));
                        return n.shader = null, n
                    }
                    return s(e, t), e.prototype.onContextChange = function() {
                        var t = this.renderer.gl;
                        this.shader = new u.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")
                    }, e.prototype.render = function(t) {
                        var e = this.renderer,
                            r = e.gl,
                            n = t._texture;
                        if (n.valid) {
                            var i = t._glDatas[e.CONTEXT_UID];
                            i || (e.bindVao(null), i = {
                                shader: this.shader,
                                vertexBuffer: l.default.GLBuffer.createVertexBuffer(r, t.vertices, r.STREAM_DRAW),
                                uvBuffer: l.default.GLBuffer.createVertexBuffer(r, t.uvs, r.STREAM_DRAW),
                                indexBuffer: l.default.GLBuffer.createIndexBuffer(r, t.indices, r.STATIC_DRAW),
                                vao: null,
                                dirty: t.dirty,
                                indexDirty: t.indexDirty
                            }, i.vao = new l.default.VertexArrayObject(r).addIndex(i.indexBuffer).addAttribute(i.vertexBuffer, i.shader.attributes.aVertexPosition, r.FLOAT, !1, 8, 0).addAttribute(i.uvBuffer, i.shader.attributes.aTextureCoord, r.FLOAT, !1, 8, 0), t._glDatas[e.CONTEXT_UID] = i), e.bindVao(i.vao), t.dirty !== i.dirty && (i.dirty = t.dirty, i.uvBuffer.upload(t.uvs)), t.indexDirty !== i.indexDirty && (i.indexDirty = t.indexDirty, i.indexBuffer.upload(t.indices)), i.vertexBuffer.upload(t.vertices), e.bindShader(i.shader), i.shader.uniforms.uSampler = e.bindTexture(n), e.state.setBlendMode(u.utils.correctBlendMode(t.blendMode, n.baseTexture.premultipliedAlpha)), i.shader.uniforms.uTransform && (t.uploadUvTransform ? i.shader.uniforms.uTransform = t._uvTransform.mapCoord.toArray(!0) : i.shader.uniforms.uTransform = f.toArray(!0)), i.shader.uniforms.translationMatrix = t.worldTransform.toArray(!0), i.shader.uniforms.uColor = u.utils.premultiplyRgba(t.tintRgb, t.worldAlpha, i.shader.uniforms.uColor, n.baseTexture.premultipliedAlpha);
                            var o = t.drawMode === d.default.DRAW_MODES.TRIANGLE_MESH ? r.TRIANGLE_STRIP : r.TRIANGLES;
                            i.vao.draw(o, t.indices.length, 0)
                        }
                    }, e
                }(u.ObjectRenderer);
            r.default = p, u.WebGLRenderer.registerPlugin("mesh", p)
        }, {
            "../../core": 65,
            "../Mesh": 166,
            path: 8,
            "pixi-gl-core": 15
        }],
        173: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = function() {
                    function t(t, e) {
                        for (var r = 0; r < e.length; r++) {
                            var n = e[r];
                            n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n)
                        }
                    }
                    return function(e, r, n) {
                        return r && t(e.prototype, r), n && t(e, n), e
                    }
                }(),
                a = t("../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = t("../core/utils"),
                l = function(t) {
                    function e() {
                        var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1500,
                            o = arguments[1],
                            s = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 16384,
                            a = arguments.length > 3 && void 0 !== arguments[3] && arguments[3];
                        n(this, e);
                        var h = i(this, t.call(this));
                        return s > 16384 && (s = 16384), s > r && (s = r), h._properties = [!1, !0, !1, !1, !1], h._maxSize = r, h._batchSize = s, h._glBuffers = {}, h._bufferUpdateIDs = [], h._updateID = 0, h.interactiveChildren = !1, h.blendMode = u.BLEND_MODES.NORMAL, h.autoResize = a, h.roundPixels = !0, h.baseTexture = null, h.setProperties(o), h._tint = 0, h.tintRgb = new Float32Array(4), h.tint = 16777215, h
                    }
                    return o(e, t), e.prototype.setProperties = function(t) {
                        t && (this._properties[0] = "vertices" in t || "scale" in t ? !!t.vertices || !!t.scale : this._properties[0], this._properties[1] = "position" in t ? !!t.position : this._properties[1], this._properties[2] = "rotation" in t ? !!t.rotation : this._properties[2], this._properties[3] = "uvs" in t ? !!t.uvs : this._properties[3], this._properties[4] = "tint" in t || "alpha" in t ? !!t.tint || !!t.alpha : this._properties[4])
                    }, e.prototype.updateTransform = function() {
                        this.displayObjectUpdateTransform()
                    }, e.prototype.renderWebGL = function(t) {
                        var e = this;
                        this.visible && !(this.worldAlpha <= 0) && this.children.length && this.renderable && (this.baseTexture || (this.baseTexture = this.children[0]._texture.baseTexture, this.baseTexture.hasLoaded || this.baseTexture.once("update", function() {
                            return e.onChildrenChange(0)
                        })), t.setObjectRenderer(t.plugins.particle), t.plugins.particle.render(this))
                    }, e.prototype.onChildrenChange = function(t) {
                        for (var e = Math.floor(t / this._batchSize); this._bufferUpdateIDs.length < e;) this._bufferUpdateIDs.push(0);
                        this._bufferUpdateIDs[e] = ++this._updateID
                    }, e.prototype.renderCanvas = function(t) {
                        if (this.visible && !(this.worldAlpha <= 0) && this.children.length && this.renderable) {
                            var e = t.context,
                                r = this.worldTransform,
                                n = !0,
                                i = 0,
                                o = 0,
                                s = 0,
                                a = 0;
                            t.setBlendMode(this.blendMode), e.globalAlpha = this.worldAlpha, this.displayObjectUpdateTransform();
                            for (var u = 0; u < this.children.length; ++u) {
                                var h = this.children[u];
                                if (h.visible) {
                                    var l = h._texture.frame;
                                    if (e.globalAlpha = this.worldAlpha * h.alpha, h.rotation % (2 * Math.PI) == 0) n && (e.setTransform(r.a, r.b, r.c, r.d, r.tx * t.resolution, r.ty * t.resolution), n = !1), i = h.anchor.x * (-l.width * h.scale.x) + h.position.x + .5, o = h.anchor.y * (-l.height * h.scale.y) + h.position.y + .5, s = l.width * h.scale.x, a = l.height * h.scale.y;
                                    else {
                                        n || (n = !0), h.displayObjectUpdateTransform();
                                        var c = h.worldTransform;
                                        t.roundPixels ? e.setTransform(c.a, c.b, c.c, c.d, c.tx * t.resolution | 0, c.ty * t.resolution | 0) : e.setTransform(c.a, c.b, c.c, c.d, c.tx * t.resolution, c.ty * t.resolution), i = h.anchor.x * -l.width + .5, o = h.anchor.y * -l.height + .5, s = l.width, a = l.height
                                    }
                                    var d = h._texture.baseTexture.resolution;
                                    e.drawImage(h._texture.baseTexture.source, l.x * d, l.y * d, l.width * d, l.height * d, i * t.resolution, o * t.resolution, s * t.resolution, a * t.resolution)
                                }
                            }
                        }
                    }, e.prototype.destroy = function(e) {
                        if (t.prototype.destroy.call(this, e), this._buffers)
                            for (var r = 0; r < this._buffers.length; ++r) this._buffers[r].destroy();
                        this._properties = null, this._buffers = null, this._bufferUpdateIDs = null
                    }, s(e, [{
                        key: "tint",
                        get: function() {
                            return this._tint
                        },
                        set: function(t) {
                            this._tint = t, (0, h.hex2rgb)(t, this.tintRgb)
                        }
                    }]), e
                }(u.Container);
            r.default = l
        }, {
            "../core": 65,
            "../core/utils": 125
        }],
        174: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./ParticleContainer");
            Object.defineProperty(r, "ParticleContainer", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./webgl/ParticleRenderer");
            Object.defineProperty(r, "ParticleRenderer", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            })
        }, {
            "./ParticleContainer": 173,
            "./webgl/ParticleRenderer": 176
        }],
        175: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var o = t("pixi-gl-core"),
                s = n(o),
                a = t("../../core/utils/createIndicesForQuads"),
                u = n(a),
                h = function() {
                    function t(e, r, n, o) {
                        i(this, t), this.gl = e, this.size = o, this.dynamicProperties = [], this.staticProperties = [];
                        for (var s = 0; s < r.length; ++s) {
                            var a = r[s];
                            a = {
                                attribute: a.attribute,
                                size: a.size,
                                uploadFunction: a.uploadFunction,
                                unsignedByte: a.unsignedByte,
                                offset: a.offset
                            }, n[s] ? this.dynamicProperties.push(a) : this.staticProperties.push(a)
                        }
                        this.staticStride = 0, this.staticBuffer = null, this.staticData = null, this.staticDataUint32 = null, this.dynamicStride = 0, this.dynamicBuffer = null, this.dynamicData = null, this.dynamicDataUint32 = null, this._updateID = 0, this.initBuffers()
                    }
                    return t.prototype.initBuffers = function() {
                        var t = this.gl,
                            e = 0;
                        this.indices = (0, u.default)(this.size), this.indexBuffer = s.default.GLBuffer.createIndexBuffer(t, this.indices, t.STATIC_DRAW), this.dynamicStride = 0;
                        for (var r = 0; r < this.dynamicProperties.length; ++r) {
                            var n = this.dynamicProperties[r];
                            n.offset = e, e += n.size, this.dynamicStride += n.size
                        }
                        var i = new ArrayBuffer(this.size * this.dynamicStride * 4 * 4);
                        this.dynamicData = new Float32Array(i), this.dynamicDataUint32 = new Uint32Array(i), this.dynamicBuffer = s.default.GLBuffer.createVertexBuffer(t, i, t.STREAM_DRAW);
                        var o = 0;
                        this.staticStride = 0;
                        for (var a = 0; a < this.staticProperties.length; ++a) {
                            var h = this.staticProperties[a];
                            h.offset = o, o += h.size, this.staticStride += h.size
                        }
                        var l = new ArrayBuffer(this.size * this.staticStride * 4 * 4);
                        this.staticData = new Float32Array(l), this.staticDataUint32 = new Uint32Array(l), this.staticBuffer = s.default.GLBuffer.createVertexBuffer(t, l, t.STATIC_DRAW), this.vao = new s.default.VertexArrayObject(t).addIndex(this.indexBuffer);
                        for (var c = 0; c < this.dynamicProperties.length; ++c) {
                            var d = this.dynamicProperties[c];
                            d.unsignedByte ? this.vao.addAttribute(this.dynamicBuffer, d.attribute, t.UNSIGNED_BYTE, !0, 4 * this.dynamicStride, 4 * d.offset) : this.vao.addAttribute(this.dynamicBuffer, d.attribute, t.FLOAT, !1, 4 * this.dynamicStride, 4 * d.offset)
                        }
                        for (var f = 0; f < this.staticProperties.length; ++f) {
                            var p = this.staticProperties[f];
                            p.unsignedByte ? this.vao.addAttribute(this.staticBuffer, p.attribute, t.UNSIGNED_BYTE, !0, 4 * this.staticStride, 4 * p.offset) : this.vao.addAttribute(this.staticBuffer, p.attribute, t.FLOAT, !1, 4 * this.staticStride, 4 * p.offset)
                        }
                    }, t.prototype.uploadDynamic = function(t, e, r) {
                        for (var n = 0; n < this.dynamicProperties.length; n++) {
                            var i = this.dynamicProperties[n];
                            i.uploadFunction(t, e, r, i.unsignedByte ? this.dynamicDataUint32 : this.dynamicData, this.dynamicStride, i.offset)
                        }
                        this.dynamicBuffer.upload()
                    }, t.prototype.uploadStatic = function(t, e, r) {
                        for (var n = 0; n < this.staticProperties.length; n++) {
                            var i = this.staticProperties[n];
                            i.uploadFunction(t, e, r, i.unsignedByte ? this.staticDataUint32 : this.staticData, this.staticStride, i.offset)
                        }
                        this.staticBuffer.upload()
                    }, t.prototype.destroy = function() {
                        this.dynamicProperties = null, this.dynamicBuffer.destroy(), this.dynamicBuffer = null, this.dynamicData = null, this.dynamicDataUint32 = null, this.staticProperties = null, this.staticBuffer.destroy(), this.staticBuffer = null, this.staticData = null, this.staticDataUint32 = null
                    }, t
                }();
            r.default = h
        }, {
            "../../core/utils/createIndicesForQuads": 123,
            "pixi-gl-core": 15
        }],
        176: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }

            function i(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function o(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function s(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var a = t("../../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = t("./ParticleShader"),
                l = n(h),
                c = t("./ParticleBuffer"),
                d = n(c),
                f = t("../../core/utils"),
                p = function(t) {
                    function e(r) {
                        i(this, e);
                        var n = o(this, t.call(this, r));
                        return n.shader = null, n.indexBuffer = null, n.properties = null, n.tempMatrix = new u.Matrix, n.CONTEXT_UID = 0, n
                    }
                    return s(e, t), e.prototype.onContextChange = function() {
                        var t = this.renderer.gl;
                        this.CONTEXT_UID = this.renderer.CONTEXT_UID, this.shader = new l.default(t), this.properties = [{
                            attribute: this.shader.attributes.aVertexPosition,
                            size: 2,
                            uploadFunction: this.uploadVertices,
                            offset: 0
                        }, {
                            attribute: this.shader.attributes.aPositionCoord,
                            size: 2,
                            uploadFunction: this.uploadPosition,
                            offset: 0
                        }, {
                            attribute: this.shader.attributes.aRotation,
                            size: 1,
                            uploadFunction: this.uploadRotation,
                            offset: 0
                        }, {
                            attribute: this.shader.attributes.aTextureCoord,
                            size: 2,
                            uploadFunction: this.uploadUvs,
                            offset: 0
                        }, {
                            attribute: this.shader.attributes.aColor,
                            size: 1,
                            unsignedByte: !0,
                            uploadFunction: this.uploadTint,
                            offset: 0
                        }]
                    }, e.prototype.start = function() {
                        this.renderer.bindShader(this.shader)
                    }, e.prototype.render = function(t) {
                        var e = t.children,
                            r = t._maxSize,
                            n = t._batchSize,
                            i = this.renderer,
                            o = e.length;
                        if (0 !== o) {
                            o > r && (o = r);
                            var s = t._glBuffers[i.CONTEXT_UID];
                            s || (s = t._glBuffers[i.CONTEXT_UID] = this.generateBuffers(t));
                            var a = e[0]._texture.baseTexture;
                            this.renderer.setBlendMode(u.utils.correctBlendMode(t.blendMode, a.premultipliedAlpha));
                            var h = i.gl,
                                l = t.worldTransform.copy(this.tempMatrix);
                            l.prepend(i._activeRenderTarget.projectionMatrix), this.shader.uniforms.projectionMatrix = l.toArray(!0), this.shader.uniforms.uColor = u.utils.premultiplyRgba(t.tintRgb, t.worldAlpha, this.shader.uniforms.uColor, a.premultipliedAlpha), this.shader.uniforms.uSampler = i.bindTexture(a);
                            for (var c = !1, d = 0, f = 0; d < o; d += n, f += 1) {
                                var p = o - d;
                                if (p > n && (p = n), f >= s.length) {
                                    if (!t.autoResize) break;
                                    s.push(this._generateOneMoreBuffer(t))
                                }
                                var v = s[f];
                                v.uploadDynamic(e, d, p);
                                var y = t._bufferUpdateIDs[d] || 0;
                                c = c || v._updateID < y, c && (v._updateID = t._updateID, v.uploadStatic(e, d, p)), i.bindVao(v.vao), v.vao.draw(h.TRIANGLES, 6 * p)
                            }
                        }
                    }, e.prototype.generateBuffers = function(t) {
                        for (var e = this.renderer.gl, r = [], n = t._maxSize, i = t._batchSize, o = t._properties, s = 0; s < n; s += i) r.push(new d.default(e, this.properties, o, i));
                        return r
                    }, e.prototype._generateOneMoreBuffer = function(t) {
                        var e = this.renderer.gl,
                            r = t._batchSize,
                            n = t._properties;
                        return new d.default(e, this.properties, n, r)
                    }, e.prototype.uploadVertices = function(t, e, r, n, i, o) {
                        for (var s = 0, a = 0, u = 0, h = 0, l = 0; l < r; ++l) {
                            var c = t[e + l],
                                d = c._texture,
                                f = c.scale.x,
                                p = c.scale.y,
                                v = d.trim,
                                y = d.orig;
                            v ? (a = v.x - c.anchor.x * y.width, s = a + v.width, h = v.y - c.anchor.y * y.height, u = h + v.height) : (s = y.width * (1 - c.anchor.x), a = y.width * -c.anchor.x, u = y.height * (1 - c.anchor.y), h = y.height * -c.anchor.y), n[o] = a * f, n[o + 1] = h * p, n[o + i] = s * f, n[o + i + 1] = h * p, n[o + 2 * i] = s * f, n[o + 2 * i + 1] = u * p, n[o + 3 * i] = a * f, n[o + 3 * i + 1] = u * p, o += 4 * i
                        }
                    }, e.prototype.uploadPosition = function(t, e, r, n, i, o) {
                        for (var s = 0; s < r; s++) {
                            var a = t[e + s].position;
                            n[o] = a.x, n[o + 1] = a.y, n[o + i] = a.x, n[o + i + 1] = a.y, n[o + 2 * i] = a.x, n[o + 2 * i + 1] = a.y, n[o + 3 * i] = a.x, n[o + 3 * i + 1] = a.y, o += 4 * i
                        }
                    }, e.prototype.uploadRotation = function(t, e, r, n, i, o) {
                        for (var s = 0; s < r; s++) {
                            var a = t[e + s].rotation;
                            n[o] = a, n[o + i] = a, n[o + 2 * i] = a, n[o + 3 * i] = a, o += 4 * i
                        }
                    }, e.prototype.uploadUvs = function(t, e, r, n, i, o) {
                        for (var s = 0; s < r; ++s) {
                            var a = t[e + s]._texture._uvs;
                            a ? (n[o] = a.x0, n[o + 1] = a.y0, n[o + i] = a.x1, n[o + i + 1] = a.y1, n[o + 2 * i] = a.x2, n[o + 2 * i + 1] = a.y2, n[o + 3 * i] = a.x3, n[o + 3 * i + 1] = a.y3, o += 4 * i) : (n[o] = 0, n[o + 1] = 0, n[o + i] = 0, n[o + i + 1] = 0, n[o + 2 * i] = 0, n[o + 2 * i + 1] = 0, n[o + 3 * i] = 0, n[o + 3 * i + 1] = 0, o += 4 * i)
                        }
                    }, e.prototype.uploadTint = function(t, e, r, n, i, o) {
                        for (var s = 0; s < r; ++s) {
                            var a = t[e + s],
                                u = a._texture.baseTexture.premultipliedAlpha,
                                h = a.alpha,
                                l = h < 1 && u ? (0, f.premultiplyTint)(a._tintRGB, h) : a._tintRGB + (255 * h << 24);
                            n[o] = l, n[o + i] = l, n[o + 2 * i] = l, n[o + 3 * i] = l, o += 4 * i
                        }
                    }, e.prototype.destroy = function() {
                        this.renderer.gl && this.renderer.gl.deleteBuffer(this.indexBuffer), t.prototype.destroy.call(this), this.shader.destroy(), this.indices = null, this.tempMatrix = null
                    }, e
                }(u.ObjectRenderer);
            r.default = p, u.WebGLRenderer.registerPlugin("particle", p)
        }, {
            "../../core": 65,
            "../../core/utils": 125,
            "./ParticleBuffer": 175,
            "./ParticleShader": 177
        }],
        177: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }
            r.__esModule = !0;
            var s = t("../../core/Shader"),
                a = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(s),
                u = function(t) {
                    function e(r) {
                        return n(this, e), i(this, t.call(this, r, ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "attribute vec4 aColor;", "attribute vec2 aPositionCoord;", "attribute float aRotation;", "uniform mat3 projectionMatrix;", "uniform vec4 uColor;", "varying vec2 vTextureCoord;", "varying vec4 vColor;", "void main(void){", "   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);", "   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);", "   vec2 v = vec2(x, y);", "   v = v + aPositionCoord;", "   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);", "   vTextureCoord = aTextureCoord;", "   vColor = aColor * uColor;", "}"].join("\n"), ["varying vec2 vTextureCoord;", "varying vec4 vColor;", "uniform sampler2D uSampler;", "void main(void){", "  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;", "  gl_FragColor = color;", "}"].join("\n")))
                    }
                    return o(e, t), e
                }(a.default);
            r.default = u
        }, {
            "../../core/Shader": 44
        }],
        178: [function(t, e, r) {
            "use strict";
            Math.sign || (Math.sign = function(t) {
                return t = Number(t), 0 === t || isNaN(t) ? t : t > 0 ? 1 : -1
            })
        }, {}],
        179: [function(t, e, r) {
            "use strict";
            var n = t("object-assign"),
                i = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(n);
            Object.assign || (Object.assign = i.default)
        }, {
            "object-assign": 6
        }],
        180: [function(t, e, r) {
            "use strict";
            t("./Object.assign"), t("./requestAnimationFrame"), t("./Math.sign"), window.ArrayBuffer || (window.ArrayBuffer = Array), window.Float32Array || (window.Float32Array = Array), window.Uint32Array || (window.Uint32Array = Array), window.Uint16Array || (window.Uint16Array = Array)
        }, {
            "./Math.sign": 178,
            "./Object.assign": 179,
            "./requestAnimationFrame": 181
        }],
        181: [function(t, e, r) {
            (function(t) {
                "use strict";
                if (Date.now && Date.prototype.getTime || (Date.now = function() {
                        return (new Date).getTime()
                    }), !t.performance || !t.performance.now) {
                    var e = Date.now();
                    t.performance || (t.performance = {}), t.performance.now = function() {
                        return Date.now() - e
                    }
                }
                for (var r = Date.now(), n = ["ms", "moz", "webkit", "o"], i = 0; i < n.length && !t.requestAnimationFrame; ++i) {
                    var o = n[i];
                    t.requestAnimationFrame = t[o + "RequestAnimationFrame"], t.cancelAnimationFrame = t[o + "CancelAnimationFrame"] || t[o + "CancelRequestAnimationFrame"]
                }
                t.requestAnimationFrame || (t.requestAnimationFrame = function(t) {
                    if ("function" != typeof t) throw new TypeError(t + "is not a function");
                    var e = Date.now(),
                        n = 16 + r - e;
                    return n < 0 && (n = 0), r = e, setTimeout(function() {
                        r = Date.now(), t(performance.now())
                    }, n)
                }), t.cancelAnimationFrame || (t.cancelAnimationFrame = function(t) {
                    return clearTimeout(t)
                })
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}],
        182: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                var r = !1;
                if (t && t._textures && t._textures.length)
                    for (var n = 0; n < t._textures.length; n++)
                        if (t._textures[n] instanceof d.Texture) {
                            var i = t._textures[n].baseTexture; - 1 === e.indexOf(i) && (e.push(i), r = !0)
                        } return r
            }

            function o(t, e) {
                return t instanceof d.BaseTexture && (-1 === e.indexOf(t) && e.push(t), !0)
            }

            function s(t, e) {
                if (t._texture && t._texture instanceof d.Texture) {
                    var r = t._texture.baseTexture;
                    return -1 === e.indexOf(r) && e.push(r), !0
                }
                return !1
            }

            function a(t, e) {
                return e instanceof d.Text && (e.updateText(!0), !0)
            }

            function u(t, e) {
                if (e instanceof d.TextStyle) {
                    var r = e.toFontString();
                    return d.TextMetrics.measureFont(r), !0
                }
                return !1
            }

            function h(t, e) {
                if (t instanceof d.Text) {
                    -1 === e.indexOf(t.style) && e.push(t.style), -1 === e.indexOf(t) && e.push(t);
                    var r = t._texture.baseTexture;
                    return -1 === e.indexOf(r) && e.push(r), !0
                }
                return !1
            }

            function l(t, e) {
                return t instanceof d.TextStyle && (-1 === e.indexOf(t) && e.push(t), !0)
            }
            r.__esModule = !0;
            var c = t("../core"),
                d = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(c),
                f = t("./limiters/CountLimiter"),
                p = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(f),
                v = d.ticker.shared;
            d.settings.UPLOADS_PER_FRAME = 4;
            var y = function() {
                function t(e) {
                    var r = this;
                    n(this, t), this.limiter = new p.default(d.settings.UPLOADS_PER_FRAME), this.renderer = e, this.uploadHookHelper = null, this.queue = [], this.addHooks = [], this.uploadHooks = [], this.completes = [], this.ticking = !1, this.delayedTick = function() {
                        r.queue && r.prepareItems()
                    }, this.registerFindHook(h), this.registerFindHook(l), this.registerFindHook(i), this.registerFindHook(o), this.registerFindHook(s), this.registerUploadHook(a), this.registerUploadHook(u)
                }
                return t.prototype.upload = function(t, e) {
                    "function" == typeof t && (e = t, t = null), t && this.add(t), this.queue.length ? (e && this.completes.push(e), this.ticking || (this.ticking = !0, v.addOnce(this.tick, this, d.UPDATE_PRIORITY.UTILITY))) : e && e()
                }, t.prototype.tick = function() {
                    setTimeout(this.delayedTick, 0)
                }, t.prototype.prepareItems = function() {
                    for (this.limiter.beginFrame(); this.queue.length && this.limiter.allowedToUpload();) {
                        var t = this.queue[0],
                            e = !1;
                        if (t && !t._destroyed)
                            for (var r = 0, n = this.uploadHooks.length; r < n; r++)
                                if (this.uploadHooks[r](this.uploadHookHelper, t)) {
                                    this.queue.shift(), e = !0;
                                    break
                                } e || this.queue.shift()
                    }
                    if (this.queue.length) v.addOnce(this.tick, this, d.UPDATE_PRIORITY.UTILITY);
                    else {
                        this.ticking = !1;
                        var i = this.completes.slice(0);
                        this.completes.length = 0;
                        for (var o = 0, s = i.length; o < s; o++) i[o]()
                    }
                }, t.prototype.registerFindHook = function(t) {
                    return t && this.addHooks.push(t), this
                }, t.prototype.registerUploadHook = function(t) {
                    return t && this.uploadHooks.push(t), this
                }, t.prototype.add = function(t) {
                    for (var e = 0, r = this.addHooks.length; e < r && !this.addHooks[e](t, this.queue); e++);
                    if (t instanceof d.Container)
                        for (var n = t.children.length - 1; n >= 0; n--) this.add(t.children[n]);
                    return this
                }, t.prototype.destroy = function() {
                    this.ticking && v.remove(this.tick, this), this.ticking = !1, this.addHooks = null, this.uploadHooks = null, this.renderer = null, this.completes = null, this.queue = null, this.limiter = null, this.uploadHookHelper = null
                }, t
            }();
            r.default = y
        }, {
            "../core": 65,
            "./limiters/CountLimiter": 185
        }],
        183: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }

            function s(t, e) {
                if (e instanceof u.BaseTexture) {
                    var r = e.source,
                        n = 0 === r.width ? t.canvas.width : Math.min(t.canvas.width, r.width),
                        i = 0 === r.height ? t.canvas.height : Math.min(t.canvas.height, r.height);
                    return t.ctx.drawImage(r, 0, 0, n, i, 0, 0, t.canvas.width, t.canvas.height), !0
                }
                return !1
            }
            r.__esModule = !0;
            var a = t("../../core"),
                u = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(a),
                h = t("../BasePrepare"),
                l = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(h),
                c = 16,
                d = function(t) {
                    function e(r) {
                        n(this, e);
                        var o = i(this, t.call(this, r));
                        return o.uploadHookHelper = o, o.canvas = document.createElement("canvas"), o.canvas.width = c, o.canvas.height = c, o.ctx = o.canvas.getContext("2d"), o.registerUploadHook(s), o
                    }
                    return o(e, t), e.prototype.destroy = function() {
                        t.prototype.destroy.call(this), this.ctx = null, this.canvas = null
                    }, e
                }(l.default);
            r.default = d, u.CanvasRenderer.registerPlugin("prepare", d)
        }, {
            "../../core": 65,
            "../BasePrepare": 182
        }],
        184: [function(t, e, r) {
            "use strict";

            function n(t) {
                return t && t.__esModule ? t : {
                    default: t
                }
            }
            r.__esModule = !0;
            var i = t("./webgl/WebGLPrepare");
            Object.defineProperty(r, "webgl", {
                enumerable: !0,
                get: function() {
                    return n(i).default
                }
            });
            var o = t("./canvas/CanvasPrepare");
            Object.defineProperty(r, "canvas", {
                enumerable: !0,
                get: function() {
                    return n(o).default
                }
            });
            var s = t("./BasePrepare");
            Object.defineProperty(r, "BasePrepare", {
                enumerable: !0,
                get: function() {
                    return n(s).default
                }
            });
            var a = t("./limiters/CountLimiter");
            Object.defineProperty(r, "CountLimiter", {
                enumerable: !0,
                get: function() {
                    return n(a).default
                }
            });
            var u = t("./limiters/TimeLimiter");
            Object.defineProperty(r, "TimeLimiter", {
                enumerable: !0,
                get: function() {
                    return n(u).default
                }
            })
        }, {
            "./BasePrepare": 182,
            "./canvas/CanvasPrepare": 183,
            "./limiters/CountLimiter": 185,
            "./limiters/TimeLimiter": 186,
            "./webgl/WebGLPrepare": 187
        }],
        185: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t(e) {
                    n(this, t), this.maxItemsPerFrame = e, this.itemsLeft = 0
                }
                return t.prototype.beginFrame = function() {
                    this.itemsLeft = this.maxItemsPerFrame
                }, t.prototype.allowedToUpload = function() {
                    return this.itemsLeft-- > 0
                }, t
            }();
            r.default = i
        }, {}],
        186: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }
            r.__esModule = !0;
            var i = function() {
                function t(e) {
                    n(this, t), this.maxMilliseconds = e, this.frameStart = 0
                }
                return t.prototype.beginFrame = function() {
                    this.frameStart = Date.now()
                }, t.prototype.allowedToUpload = function() {
                    return Date.now() - this.frameStart < this.maxMilliseconds
                }, t
            }();
            r.default = i
        }, {}],
        187: [function(t, e, r) {
            "use strict";

            function n(t, e) {
                if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function")
            }

            function i(t, e) {
                if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return !e || "object" != typeof e && "function" != typeof e ? t : e
            }

            function o(t, e) {
                if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + typeof e);
                t.prototype = Object.create(e && e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e)
            }

            function s(t, e) {
                return e instanceof l.BaseTexture && (e._glTextures[t.CONTEXT_UID] || t.textureManager.updateTexture(e), !0)
            }

            function a(t, e) {
                return e instanceof l.Graphics && ((e.dirty || e.clearDirty || !e._webGL[t.plugins.graphics.CONTEXT_UID]) && t.plugins.graphics.updateGraphics(e), !0)
            }

            function u(t, e) {
                return t instanceof l.Graphics && (e.push(t), !0)
            }
            r.__esModule = !0;
            var h = t("../../core"),
                l = function(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }(h),
                c = t("../BasePrepare"),
                d = function(t) {
                    return t && t.__esModule ? t : {
                        default: t
                    }
                }(c),
                f = function(t) {
                    function e(r) {
                        n(this, e);
                        var o = i(this, t.call(this, r));
                        return o.uploadHookHelper = o.renderer, o.registerFindHook(u), o.registerUploadHook(s), o.registerUploadHook(a), o
                    }
                    return o(e, t), e
                }(d.default);
            r.default = f, l.WebGLRenderer.registerPlugin("prepare", f)
        }, {
            "../../core": 65,
            "../BasePrepare": 182
        }],
        188: [function(t, e, r) {
            (function(e) {
                "use strict";

                function n(t) {
                    if (t && t.__esModule) return t;
                    var e = {};
                    if (null != t)
                        for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
                    return e.default = t, e
                }
                r.__esModule = !0, r.loader = r.prepare = r.particles = r.mesh = r.loaders = r.interaction = r.filters = r.extras = r.extract = r.accessibility = void 0;
                var i = t("./polyfill");
                Object.keys(i).forEach(function(t) {
                    "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
                        enumerable: !0,
                        get: function() {
                            return i[t]
                        }
                    })
                });
                var o = t("./core");
                Object.keys(o).forEach(function(t) {
                    "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
                        enumerable: !0,
                        get: function() {
                            return o[t]
                        }
                    })
                });
                var s = t("./deprecation"),
                    a = function(t) {
                        return t && t.__esModule ? t : {
                            default: t
                        }
                    }(s),
                    u = t("./accessibility"),
                    h = n(u),
                    l = t("./extract"),
                    c = n(l),
                    d = t("./extras"),
                    f = n(d),
                    p = t("./filters"),
                    v = n(p),
                    y = t("./interaction"),
                    g = n(y),
                    m = t("./loaders"),
                    _ = n(m),
                    b = t("./mesh"),
                    x = n(b),
                    T = t("./particles"),
                    w = n(T),
                    E = t("./prepare"),
                    S = n(E);
                o.utils.mixins.performMixins();
                var O = _.shared || null;
                r.accessibility = h, r.extract = c, r.extras = f, r.filters = v, r.interaction = g, r.loaders = _, r.mesh = x, r.particles = w, r.prepare = S, r.loader = O, "function" == typeof a.default && (0, a.default)(r), e.PIXI = r
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "./accessibility": 42,
            "./core": 65,
            "./deprecation": 131,
            "./extract": 133,
            "./extras": 141,
            "./filters": 153,
            "./interaction": 159,
            "./loaders": 162,
            "./mesh": 171,
            "./particles": 174,
            "./polyfill": 180,
            "./prepare": 184
        }]
    }, {}, [188])(188)
});
var __extends = this && this.__extends || function() {
    var extendStatics = Object.setPrototypeOf || {
        __proto__: []
    }
    instanceof Array && function(d, b) {
        d.__proto__ = b
    } || function(d, b) {
        for (var p in b)
            if (b.hasOwnProperty(p)) d[p] = b[p]
    };
    return function(d, b) {
        extendStatics(d, b);

        function __() {
            this.constructor = d
        }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __)
    }
}();
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Animation = function() {
            function Animation(name, timelines, duration) {
                if (name == null) throw new Error("name cannot be null.");
                if (timelines == null) throw new Error("timelines cannot be null.");
                this.name = name;
                this.timelines = timelines;
                this.duration = duration
            }
            Animation.prototype.apply = function(skeleton, lastTime, time, loop, events, alpha, pose, direction) {
                if (skeleton == null) throw new Error("skeleton cannot be null.");
                if (loop && this.duration != 0) {
                    time %= this.duration;
                    if (lastTime > 0) lastTime %= this.duration
                }
                var timelines = this.timelines;
                for (var i = 0, n = timelines.length; i < n; i++) timelines[i].apply(skeleton, lastTime, time, events, alpha, pose, direction)
            };
            Animation.binarySearch = function(values, target, step) {
                if (step === void 0) {
                    step = 1
                }
                var low = 0;
                var high = values.length / step - 2;
                if (high == 0) return step;
                var current = high >>> 1;
                while (true) {
                    if (values[(current + 1) * step] <= target) low = current + 1;
                    else high = current;
                    if (low == high) return (low + 1) * step;
                    current = low + high >>> 1
                }
            };
            Animation.linearSearch = function(values, target, step) {
                for (var i = 0, last = values.length - step; i <= last; i += step)
                    if (values[i] > target) return i;
                return -1
            };
            return Animation
        }();
        core.Animation = Animation;
        var MixPose;
        (function(MixPose) {
            MixPose[MixPose["setup"] = 0] = "setup";
            MixPose[MixPose["current"] = 1] = "current";
            MixPose[MixPose["currentLayered"] = 2] = "currentLayered"
        })(MixPose = core.MixPose || (core.MixPose = {}));
        var MixDirection;
        (function(MixDirection) {
            MixDirection[MixDirection["in"] = 0] = "in";
            MixDirection[MixDirection["out"] = 1] = "out"
        })(MixDirection = core.MixDirection || (core.MixDirection = {}));
        var TimelineType;
        (function(TimelineType) {
            TimelineType[TimelineType["rotate"] = 0] = "rotate";
            TimelineType[TimelineType["translate"] = 1] = "translate";
            TimelineType[TimelineType["scale"] = 2] = "scale";
            TimelineType[TimelineType["shear"] = 3] = "shear";
            TimelineType[TimelineType["attachment"] = 4] = "attachment";
            TimelineType[TimelineType["color"] = 5] = "color";
            TimelineType[TimelineType["deform"] = 6] = "deform";
            TimelineType[TimelineType["event"] = 7] = "event";
            TimelineType[TimelineType["drawOrder"] = 8] = "drawOrder";
            TimelineType[TimelineType["ikConstraint"] = 9] = "ikConstraint";
            TimelineType[TimelineType["transformConstraint"] = 10] = "transformConstraint";
            TimelineType[TimelineType["pathConstraintPosition"] = 11] = "pathConstraintPosition";
            TimelineType[TimelineType["pathConstraintSpacing"] = 12] = "pathConstraintSpacing";
            TimelineType[TimelineType["pathConstraintMix"] = 13] = "pathConstraintMix";
            TimelineType[TimelineType["twoColor"] = 14] = "twoColor"
        })(TimelineType = core.TimelineType || (core.TimelineType = {}));
        var CurveTimeline = function() {
            function CurveTimeline(frameCount) {
                if (frameCount <= 0) throw new Error("frameCount must be > 0: " + frameCount);
                this.curves = core.Utils.newFloatArray((frameCount - 1) * CurveTimeline.BEZIER_SIZE)
            }
            CurveTimeline.prototype.getFrameCount = function() {
                return this.curves.length / CurveTimeline.BEZIER_SIZE + 1
            };
            CurveTimeline.prototype.setLinear = function(frameIndex) {
                this.curves[frameIndex * CurveTimeline.BEZIER_SIZE] = CurveTimeline.LINEAR
            };
            CurveTimeline.prototype.setStepped = function(frameIndex) {
                this.curves[frameIndex * CurveTimeline.BEZIER_SIZE] = CurveTimeline.STEPPED
            };
            CurveTimeline.prototype.getCurveType = function(frameIndex) {
                var index = frameIndex * CurveTimeline.BEZIER_SIZE;
                if (index == this.curves.length) return CurveTimeline.LINEAR;
                var type = this.curves[index];
                if (type == CurveTimeline.LINEAR) return CurveTimeline.LINEAR;
                if (type == CurveTimeline.STEPPED) return CurveTimeline.STEPPED;
                return CurveTimeline.BEZIER
            };
            CurveTimeline.prototype.setCurve = function(frameIndex, cx1, cy1, cx2, cy2) {
                var tmpx = (-cx1 * 2 + cx2) * .03,
                    tmpy = (-cy1 * 2 + cy2) * .03;
                var dddfx = ((cx1 - cx2) * 3 + 1) * .006,
                    dddfy = ((cy1 - cy2) * 3 + 1) * .006;
                var ddfx = tmpx * 2 + dddfx,
                    ddfy = tmpy * 2 + dddfy;
                var dfx = cx1 * .3 + tmpx + dddfx * .16666667,
                    dfy = cy1 * .3 + tmpy + dddfy * .16666667;
                var i = frameIndex * CurveTimeline.BEZIER_SIZE;
                var curves = this.curves;
                curves[i++] = CurveTimeline.BEZIER;
                var x = dfx,
                    y = dfy;
                for (var n = i + CurveTimeline.BEZIER_SIZE - 1; i < n; i += 2) {
                    curves[i] = x;
                    curves[i + 1] = y;
                    dfx += ddfx;
                    dfy += ddfy;
                    ddfx += dddfx;
                    ddfy += dddfy;
                    x += dfx;
                    y += dfy
                }
            };
            CurveTimeline.prototype.getCurvePercent = function(frameIndex, percent) {
                percent = core.MathUtils.clamp(percent, 0, 1);
                var curves = this.curves;
                var i = frameIndex * CurveTimeline.BEZIER_SIZE;
                var type = curves[i];
                if (type == CurveTimeline.LINEAR) return percent;
                if (type == CurveTimeline.STEPPED) return 0;
                i++;
                var x = 0;
                for (var start = i, n = i + CurveTimeline.BEZIER_SIZE - 1; i < n; i += 2) {
                    x = curves[i];
                    if (x >= percent) {
                        var prevX = void 0,
                            prevY = void 0;
                        if (i == start) {
                            prevX = 0;
                            prevY = 0
                        } else {
                            prevX = curves[i - 2];
                            prevY = curves[i - 1]
                        }
                        return prevY + (curves[i + 1] - prevY) * (percent - prevX) / (x - prevX)
                    }
                }
                var y = curves[i - 1];
                return y + (1 - y) * (percent - x) / (1 - x)
            };
            CurveTimeline.LINEAR = 0;
            CurveTimeline.STEPPED = 1;
            CurveTimeline.BEZIER = 2;
            CurveTimeline.BEZIER_SIZE = 10 * 2 - 1;
            return CurveTimeline
        }();
        core.CurveTimeline = CurveTimeline;
        var RotateTimeline = function(_super) {
            __extends(RotateTimeline, _super);

            function RotateTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount << 1);
                return _this
            }
            RotateTimeline.prototype.getPropertyId = function() {
                return (TimelineType.rotate << 24) + this.boneIndex
            };
            RotateTimeline.prototype.setFrame = function(frameIndex, time, degrees) {
                frameIndex <<= 1;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + RotateTimeline.ROTATION] = degrees
            };
            RotateTimeline.prototype.apply = function(skeleton, lastTime, time, events, alpha, pose, direction) {
                var frames = this.frames;
                var bone = skeleton.bones[this.boneIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            bone.rotation = bone.data.rotation;
                            return;
                        case MixPose.current:
                            var r_1 = bone.data.rotation - bone.rotation;
                            r_1 -= (16384 - (16384.499999999996 - r_1 / 360 | 0)) * 360;
                            bone.rotation += r_1 * alpha
                    }
                    return
                }
                if (time >= frames[frames.length - RotateTimeline.ENTRIES]) {
                    if (pose == MixPose.setup) bone.rotation = bone.data.rotation + frames[frames.length + RotateTimeline.PREV_ROTATION] * alpha;
                    else {
                        var r_2 = bone.data.rotation + frames[frames.length + RotateTimeline.PREV_ROTATION] - bone.rotation;
                        r_2 -= (16384 - (16384.499999999996 - r_2 / 360 | 0)) * 360;
                        bone.rotation += r_2 * alpha
                    }
                    return
                }
                var frame = Animation.binarySearch(frames, time, RotateTimeline.ENTRIES);
                var prevRotation = frames[frame + RotateTimeline.PREV_ROTATION];
                var frameTime = frames[frame];
                var percent = this.getCurvePercent((frame >> 1) - 1, 1 - (time - frameTime) / (frames[frame + RotateTimeline.PREV_TIME] - frameTime));
                var r = frames[frame + RotateTimeline.ROTATION] - prevRotation;
                r -= (16384 - (16384.499999999996 - r / 360 | 0)) * 360;
                r = prevRotation + r * percent;
                if (pose == MixPose.setup) {
                    r -= (16384 - (16384.499999999996 - r / 360 | 0)) * 360;
                    bone.rotation = bone.data.rotation + r * alpha
                } else {
                    r = bone.data.rotation + r - bone.rotation;
                    r -= (16384 - (16384.499999999996 - r / 360 | 0)) * 360;
                    bone.rotation += r * alpha
                }
            };
            RotateTimeline.ENTRIES = 2;
            RotateTimeline.PREV_TIME = -2;
            RotateTimeline.PREV_ROTATION = -1;
            RotateTimeline.ROTATION = 1;
            return RotateTimeline
        }(CurveTimeline);
        core.RotateTimeline = RotateTimeline;
        var TranslateTimeline = function(_super) {
            __extends(TranslateTimeline, _super);

            function TranslateTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount * TranslateTimeline.ENTRIES);
                return _this
            }
            TranslateTimeline.prototype.getPropertyId = function() {
                return (TimelineType.translate << 24) + this.boneIndex
            };
            TranslateTimeline.prototype.setFrame = function(frameIndex, time, x, y) {
                frameIndex *= TranslateTimeline.ENTRIES;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + TranslateTimeline.X] = x;
                this.frames[frameIndex + TranslateTimeline.Y] = y
            };
            TranslateTimeline.prototype.apply = function(skeleton, lastTime, time, events, alpha, pose, direction) {
                var frames = this.frames;
                var bone = skeleton.bones[this.boneIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            bone.x = bone.data.x;
                            bone.y = bone.data.y;
                            return;
                        case MixPose.current:
                            bone.x += (bone.data.x - bone.x) * alpha;
                            bone.y += (bone.data.y - bone.y) * alpha
                    }
                    return
                }
                var x = 0,
                    y = 0;
                if (time >= frames[frames.length - TranslateTimeline.ENTRIES]) {
                    x = frames[frames.length + TranslateTimeline.PREV_X];
                    y = frames[frames.length + TranslateTimeline.PREV_Y]
                } else {
                    var frame = Animation.binarySearch(frames, time, TranslateTimeline.ENTRIES);
                    x = frames[frame + TranslateTimeline.PREV_X];
                    y = frames[frame + TranslateTimeline.PREV_Y];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / TranslateTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + TranslateTimeline.PREV_TIME] - frameTime));
                    x += (frames[frame + TranslateTimeline.X] - x) * percent;
                    y += (frames[frame + TranslateTimeline.Y] - y) * percent
                }
                if (pose == MixPose.setup) {
                    bone.x = bone.data.x + x * alpha;
                    bone.y = bone.data.y + y * alpha
                } else {
                    bone.x += (bone.data.x + x - bone.x) * alpha;
                    bone.y += (bone.data.y + y - bone.y) * alpha
                }
            };
            TranslateTimeline.ENTRIES = 3;
            TranslateTimeline.PREV_TIME = -3;
            TranslateTimeline.PREV_X = -2;
            TranslateTimeline.PREV_Y = -1;
            TranslateTimeline.X = 1;
            TranslateTimeline.Y = 2;
            return TranslateTimeline
        }(CurveTimeline);
        core.TranslateTimeline = TranslateTimeline;
        var ScaleTimeline = function(_super) {
            __extends(ScaleTimeline, _super);

            function ScaleTimeline(frameCount) {
                return _super.call(this, frameCount) || this
            }
            ScaleTimeline.prototype.getPropertyId = function() {
                return (TimelineType.scale << 24) + this.boneIndex
            };
            ScaleTimeline.prototype.apply = function(skeleton, lastTime, time, events, alpha, pose, direction) {
                var frames = this.frames;
                var bone = skeleton.bones[this.boneIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            bone.scaleX = bone.data.scaleX;
                            bone.scaleY = bone.data.scaleY;
                            return;
                        case MixPose.current:
                            bone.scaleX += (bone.data.scaleX - bone.scaleX) * alpha;
                            bone.scaleY += (bone.data.scaleY - bone.scaleY) * alpha
                    }
                    return
                }
                var x = 0,
                    y = 0;
                if (time >= frames[frames.length - ScaleTimeline.ENTRIES]) {
                    x = frames[frames.length + ScaleTimeline.PREV_X] * bone.data.scaleX;
                    y = frames[frames.length + ScaleTimeline.PREV_Y] * bone.data.scaleY
                } else {
                    var frame = Animation.binarySearch(frames, time, ScaleTimeline.ENTRIES);
                    x = frames[frame + ScaleTimeline.PREV_X];
                    y = frames[frame + ScaleTimeline.PREV_Y];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / ScaleTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + ScaleTimeline.PREV_TIME] - frameTime));
                    x = (x + (frames[frame + ScaleTimeline.X] - x) * percent) * bone.data.scaleX;
                    y = (y + (frames[frame + ScaleTimeline.Y] - y) * percent) * bone.data.scaleY
                }
                if (alpha == 1) {
                    bone.scaleX = x;
                    bone.scaleY = y
                } else {
                    var bx = 0,
                        by = 0;
                    if (pose == MixPose.setup) {
                        bx = bone.data.scaleX;
                        by = bone.data.scaleY
                    } else {
                        bx = bone.scaleX;
                        by = bone.scaleY
                    }
                    if (direction == MixDirection.out) {
                        x = Math.abs(x) * core.MathUtils.signum(bx);
                        y = Math.abs(y) * core.MathUtils.signum(by)
                    } else {
                        bx = Math.abs(bx) * core.MathUtils.signum(x);
                        by = Math.abs(by) * core.MathUtils.signum(y)
                    }
                    bone.scaleX = bx + (x - bx) * alpha;
                    bone.scaleY = by + (y - by) * alpha
                }
            };
            return ScaleTimeline
        }(TranslateTimeline);
        core.ScaleTimeline = ScaleTimeline;
        var ShearTimeline = function(_super) {
            __extends(ShearTimeline, _super);

            function ShearTimeline(frameCount) {
                return _super.call(this, frameCount) || this
            }
            ShearTimeline.prototype.getPropertyId = function() {
                return (TimelineType.shear << 24) + this.boneIndex
            };
            ShearTimeline.prototype.apply = function(skeleton, lastTime, time, events, alpha, pose, direction) {
                var frames = this.frames;
                var bone = skeleton.bones[this.boneIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            bone.shearX = bone.data.shearX;
                            bone.shearY = bone.data.shearY;
                            return;
                        case MixPose.current:
                            bone.shearX += (bone.data.shearX - bone.shearX) * alpha;
                            bone.shearY += (bone.data.shearY - bone.shearY) * alpha
                    }
                    return
                }
                var x = 0,
                    y = 0;
                if (time >= frames[frames.length - ShearTimeline.ENTRIES]) {
                    x = frames[frames.length + ShearTimeline.PREV_X];
                    y = frames[frames.length + ShearTimeline.PREV_Y]
                } else {
                    var frame = Animation.binarySearch(frames, time, ShearTimeline.ENTRIES);
                    x = frames[frame + ShearTimeline.PREV_X];
                    y = frames[frame + ShearTimeline.PREV_Y];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / ShearTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + ShearTimeline.PREV_TIME] - frameTime));
                    x = x + (frames[frame + ShearTimeline.X] - x) * percent;
                    y = y + (frames[frame + ShearTimeline.Y] - y) * percent
                }
                if (pose == MixPose.setup) {
                    bone.shearX = bone.data.shearX + x * alpha;
                    bone.shearY = bone.data.shearY + y * alpha
                } else {
                    bone.shearX += (bone.data.shearX + x - bone.shearX) * alpha;
                    bone.shearY += (bone.data.shearY + y - bone.shearY) * alpha
                }
            };
            return ShearTimeline
        }(TranslateTimeline);
        core.ShearTimeline = ShearTimeline;
        var ColorTimeline = function(_super) {
            __extends(ColorTimeline, _super);

            function ColorTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount * ColorTimeline.ENTRIES);
                return _this
            }
            ColorTimeline.prototype.getPropertyId = function() {
                return (TimelineType.color << 24) + this.slotIndex
            };
            ColorTimeline.prototype.setFrame = function(frameIndex, time, r, g, b, a) {
                frameIndex *= ColorTimeline.ENTRIES;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + ColorTimeline.R] = r;
                this.frames[frameIndex + ColorTimeline.G] = g;
                this.frames[frameIndex + ColorTimeline.B] = b;
                this.frames[frameIndex + ColorTimeline.A] = a
            };
            ColorTimeline.prototype.apply = function(skeleton, lastTime, time, events, alpha, pose, direction) {
                var slot = skeleton.slots[this.slotIndex];
                var frames = this.frames;
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            slot.color.setFromColor(slot.data.color);
                            return;
                        case MixPose.current:
                            var color = slot.color,
                                setup = slot.data.color;
                            color.add((setup.r - color.r) * alpha, (setup.g - color.g) * alpha, (setup.b - color.b) * alpha, (setup.a - color.a) * alpha)
                    }
                    return
                }
                var r = 0,
                    g = 0,
                    b = 0,
                    a = 0;
                if (time >= frames[frames.length - ColorTimeline.ENTRIES]) {
                    var i = frames.length;
                    r = frames[i + ColorTimeline.PREV_R];
                    g = frames[i + ColorTimeline.PREV_G];
                    b = frames[i + ColorTimeline.PREV_B];
                    a = frames[i + ColorTimeline.PREV_A]
                } else {
                    var frame = Animation.binarySearch(frames, time, ColorTimeline.ENTRIES);
                    r = frames[frame + ColorTimeline.PREV_R];
                    g = frames[frame + ColorTimeline.PREV_G];
                    b = frames[frame + ColorTimeline.PREV_B];
                    a = frames[frame + ColorTimeline.PREV_A];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / ColorTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + ColorTimeline.PREV_TIME] - frameTime));
                    r += (frames[frame + ColorTimeline.R] - r) * percent;
                    g += (frames[frame + ColorTimeline.G] - g) * percent;
                    b += (frames[frame + ColorTimeline.B] - b) * percent;
                    a += (frames[frame + ColorTimeline.A] - a) * percent
                }
                if (alpha == 1) slot.color.set(r, g, b, a);
                else {
                    var color = slot.color;
                    if (pose == MixPose.setup) color.setFromColor(slot.data.color);
                    color.add((r - color.r) * alpha, (g - color.g) * alpha, (b - color.b) * alpha, (a - color.a) * alpha)
                }
            };
            ColorTimeline.ENTRIES = 5;
            ColorTimeline.PREV_TIME = -5;
            ColorTimeline.PREV_R = -4;
            ColorTimeline.PREV_G = -3;
            ColorTimeline.PREV_B = -2;
            ColorTimeline.PREV_A = -1;
            ColorTimeline.R = 1;
            ColorTimeline.G = 2;
            ColorTimeline.B = 3;
            ColorTimeline.A = 4;
            return ColorTimeline
        }(CurveTimeline);
        core.ColorTimeline = ColorTimeline;
        var TwoColorTimeline = function(_super) {
            __extends(TwoColorTimeline, _super);

            function TwoColorTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount * TwoColorTimeline.ENTRIES);
                return _this
            }
            TwoColorTimeline.prototype.getPropertyId = function() {
                return (TimelineType.twoColor << 24) + this.slotIndex
            };
            TwoColorTimeline.prototype.setFrame = function(frameIndex, time, r, g, b, a, r2, g2, b2) {
                frameIndex *= TwoColorTimeline.ENTRIES;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + TwoColorTimeline.R] = r;
                this.frames[frameIndex + TwoColorTimeline.G] = g;
                this.frames[frameIndex + TwoColorTimeline.B] = b;
                this.frames[frameIndex + TwoColorTimeline.A] = a;
                this.frames[frameIndex + TwoColorTimeline.R2] = r2;
                this.frames[frameIndex + TwoColorTimeline.G2] = g2;
                this.frames[frameIndex + TwoColorTimeline.B2] = b2
            };
            TwoColorTimeline.prototype.apply = function(skeleton, lastTime, time, events, alpha, pose, direction) {
                var slot = skeleton.slots[this.slotIndex];
                var frames = this.frames;
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            slot.color.setFromColor(slot.data.color);
                            slot.darkColor.setFromColor(slot.data.darkColor);
                            return;
                        case MixPose.current:
                            var light = slot.color,
                                dark = slot.darkColor,
                                setupLight = slot.data.color,
                                setupDark = slot.data.darkColor;
                            light.add((setupLight.r - light.r) * alpha, (setupLight.g - light.g) * alpha, (setupLight.b - light.b) * alpha, (setupLight.a - light.a) * alpha);
                            dark.add((setupDark.r - dark.r) * alpha, (setupDark.g - dark.g) * alpha, (setupDark.b - dark.b) * alpha, 0)
                    }
                    return
                }
                var r = 0,
                    g = 0,
                    b = 0,
                    a = 0,
                    r2 = 0,
                    g2 = 0,
                    b2 = 0;
                if (time >= frames[frames.length - TwoColorTimeline.ENTRIES]) {
                    var i = frames.length;
                    r = frames[i + TwoColorTimeline.PREV_R];
                    g = frames[i + TwoColorTimeline.PREV_G];
                    b = frames[i + TwoColorTimeline.PREV_B];
                    a = frames[i + TwoColorTimeline.PREV_A];
                    r2 = frames[i + TwoColorTimeline.PREV_R2];
                    g2 = frames[i + TwoColorTimeline.PREV_G2];
                    b2 = frames[i + TwoColorTimeline.PREV_B2]
                } else {
                    var frame = Animation.binarySearch(frames, time, TwoColorTimeline.ENTRIES);
                    r = frames[frame + TwoColorTimeline.PREV_R];
                    g = frames[frame + TwoColorTimeline.PREV_G];
                    b = frames[frame + TwoColorTimeline.PREV_B];
                    a = frames[frame + TwoColorTimeline.PREV_A];
                    r2 = frames[frame + TwoColorTimeline.PREV_R2];
                    g2 = frames[frame + TwoColorTimeline.PREV_G2];
                    b2 = frames[frame + TwoColorTimeline.PREV_B2];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / TwoColorTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + TwoColorTimeline.PREV_TIME] - frameTime));
                    r += (frames[frame + TwoColorTimeline.R] - r) * percent;
                    g += (frames[frame + TwoColorTimeline.G] - g) * percent;
                    b += (frames[frame + TwoColorTimeline.B] - b) * percent;
                    a += (frames[frame + TwoColorTimeline.A] - a) * percent;
                    r2 += (frames[frame + TwoColorTimeline.R2] - r2) * percent;
                    g2 += (frames[frame + TwoColorTimeline.G2] - g2) * percent;
                    b2 += (frames[frame + TwoColorTimeline.B2] - b2) * percent
                }
                if (alpha == 1) {
                    slot.color.set(r, g, b, a);
                    slot.darkColor.set(r2, g2, b2, 1)
                } else {
                    var light = slot.color,
                        dark = slot.darkColor;
                    if (pose == MixPose.setup) {
                        light.setFromColor(slot.data.color);
                        dark.setFromColor(slot.data.darkColor)
                    }
                    light.add((r - light.r) * alpha, (g - light.g) * alpha, (b - light.b) * alpha, (a - light.a) * alpha);
                    dark.add((r2 - dark.r) * alpha, (g2 - dark.g) * alpha, (b2 - dark.b) * alpha, 0)
                }
            };
            TwoColorTimeline.ENTRIES = 8;
            TwoColorTimeline.PREV_TIME = -8;
            TwoColorTimeline.PREV_R = -7;
            TwoColorTimeline.PREV_G = -6;
            TwoColorTimeline.PREV_B = -5;
            TwoColorTimeline.PREV_A = -4;
            TwoColorTimeline.PREV_R2 = -3;
            TwoColorTimeline.PREV_G2 = -2;
            TwoColorTimeline.PREV_B2 = -1;
            TwoColorTimeline.R = 1;
            TwoColorTimeline.G = 2;
            TwoColorTimeline.B = 3;
            TwoColorTimeline.A = 4;
            TwoColorTimeline.R2 = 5;
            TwoColorTimeline.G2 = 6;
            TwoColorTimeline.B2 = 7;
            return TwoColorTimeline
        }(CurveTimeline);
        core.TwoColorTimeline = TwoColorTimeline;
        var AttachmentTimeline = function() {
            function AttachmentTimeline(frameCount) {
                this.frames = core.Utils.newFloatArray(frameCount);
                this.attachmentNames = new Array(frameCount)
            }
            AttachmentTimeline.prototype.getPropertyId = function() {
                return (TimelineType.attachment << 24) + this.slotIndex
            };
            AttachmentTimeline.prototype.getFrameCount = function() {
                return this.frames.length
            };
            AttachmentTimeline.prototype.setFrame = function(frameIndex, time, attachmentName) {
                this.frames[frameIndex] = time;
                this.attachmentNames[frameIndex] = attachmentName
            };
            AttachmentTimeline.prototype.apply = function(skeleton, lastTime, time, events, alpha, pose, direction) {
                var slot = skeleton.slots[this.slotIndex];
                if (direction == MixDirection.out && pose == MixPose.setup) {
                    var attachmentName_1 = slot.data.attachmentName;
                    slot.setAttachment(attachmentName_1 == null ? null : skeleton.getAttachment(this.slotIndex, attachmentName_1));
                    return
                }
                var frames = this.frames;
                if (time < frames[0]) {
                    if (pose == MixPose.setup) {
                        var attachmentName_2 = slot.data.attachmentName;
                        slot.setAttachment(attachmentName_2 == null ? null : skeleton.getAttachment(this.slotIndex, attachmentName_2))
                    }
                    return
                }
                var frameIndex = 0;
                if (time >= frames[frames.length - 1]) frameIndex = frames.length - 1;
                else frameIndex = Animation.binarySearch(frames, time, 1) - 1;
                var attachmentName = this.attachmentNames[frameIndex];
                skeleton.slots[this.slotIndex].setAttachment(attachmentName == null ? null : skeleton.getAttachment(this.slotIndex, attachmentName))
            };
            return AttachmentTimeline
        }();
        core.AttachmentTimeline = AttachmentTimeline;
        var zeros = null;
        var DeformTimeline = function(_super) {
            __extends(DeformTimeline, _super);

            function DeformTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount);
                _this.frameVertices = new Array(frameCount);
                if (zeros == null) zeros = core.Utils.newFloatArray(64);
                return _this
            }
            DeformTimeline.prototype.getPropertyId = function() {
                return (TimelineType.deform << 27) + +this.attachment.id + this.slotIndex
            };
            DeformTimeline.prototype.setFrame = function(frameIndex, time, vertices) {
                this.frames[frameIndex] = time;
                this.frameVertices[frameIndex] = vertices
            };
            DeformTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                var slot = skeleton.slots[this.slotIndex];
                var slotAttachment = slot.getAttachment();
                if (!(slotAttachment instanceof core.VertexAttachment) || !slotAttachment.applyDeform(this.attachment)) return;
                var verticesArray = slot.attachmentVertices;
                var frameVertices = this.frameVertices;
                var vertexCount = frameVertices[0].length;
                var vertices = core.Utils.setArraySize(verticesArray, vertexCount);
                var frames = this.frames;
                if (time < frames[0]) {
                    var vertexAttachment = slotAttachment;
                    switch (pose) {
                        case MixPose.setup:
                            var zeroVertices = void 0;
                            if (vertexAttachment.bones == null) {
                                zeroVertices = vertexAttachment.vertices
                            } else {
                                zeroVertices = zeros;
                                if (zeroVertices.length < vertexCount) zeros = zeroVertices = core.Utils.newFloatArray(vertexCount)
                            }
                            core.Utils.arrayCopy(zeroVertices, 0, vertices, 0, vertexCount);
                            return;
                        case MixPose.current:
                            if (alpha == 1) break;
                            if (vertexAttachment.bones == null) {
                                var setupVertices = vertexAttachment.vertices;
                                for (var i_1 = 0; i_1 < vertexCount; i_1++) vertices[i_1] += (setupVertices[i_1] - vertices[i_1]) * alpha
                            } else {
                                alpha = 1 - alpha;
                                for (var i = 0; i < vertexCount; i++) vertices[i] *= alpha
                            }
                    }
                    return
                }
                if (time >= frames[frames.length - 1]) {
                    var lastVertices = frameVertices[frames.length - 1];
                    if (alpha == 1) {
                        core.Utils.arrayCopy(lastVertices, 0, vertices, 0, vertexCount)
                    } else if (pose == MixPose.setup) {
                        var vertexAttachment = slotAttachment;
                        if (vertexAttachment.bones == null) {
                            var setupVertices = vertexAttachment.vertices;
                            for (var i_2 = 0; i_2 < vertexCount; i_2++) {
                                var setup = setupVertices[i_2];
                                vertices[i_2] = setup + (lastVertices[i_2] - setup) * alpha
                            }
                        } else {
                            for (var i_3 = 0; i_3 < vertexCount; i_3++) vertices[i_3] = lastVertices[i_3] * alpha
                        }
                    } else {
                        for (var i_4 = 0; i_4 < vertexCount; i_4++) vertices[i_4] += (lastVertices[i_4] - vertices[i_4]) * alpha
                    }
                    return
                }
                var frame = Animation.binarySearch(frames, time);
                var prevVertices = frameVertices[frame - 1];
                var nextVertices = frameVertices[frame];
                var frameTime = frames[frame];
                var percent = this.getCurvePercent(frame - 1, 1 - (time - frameTime) / (frames[frame - 1] - frameTime));
                if (alpha == 1) {
                    for (var i_5 = 0; i_5 < vertexCount; i_5++) {
                        var prev = prevVertices[i_5];
                        vertices[i_5] = prev + (nextVertices[i_5] - prev) * percent
                    }
                } else if (pose == MixPose.setup) {
                    var vertexAttachment = slotAttachment;
                    if (vertexAttachment.bones == null) {
                        var setupVertices = vertexAttachment.vertices;
                        for (var i_6 = 0; i_6 < vertexCount; i_6++) {
                            var prev = prevVertices[i_6],
                                setup = setupVertices[i_6];
                            vertices[i_6] = setup + (prev + (nextVertices[i_6] - prev) * percent - setup) * alpha
                        }
                    } else {
                        for (var i_7 = 0; i_7 < vertexCount; i_7++) {
                            var prev = prevVertices[i_7];
                            vertices[i_7] = (prev + (nextVertices[i_7] - prev) * percent) * alpha
                        }
                    }
                } else {
                    for (var i_8 = 0; i_8 < vertexCount; i_8++) {
                        var prev = prevVertices[i_8];
                        vertices[i_8] += (prev + (nextVertices[i_8] - prev) * percent - vertices[i_8]) * alpha
                    }
                }
            };
            return DeformTimeline
        }(CurveTimeline);
        core.DeformTimeline = DeformTimeline;
        var EventTimeline = function() {
            function EventTimeline(frameCount) {
                this.frames = core.Utils.newFloatArray(frameCount);
                this.events = new Array(frameCount)
            }
            EventTimeline.prototype.getPropertyId = function() {
                return TimelineType.event << 24
            };
            EventTimeline.prototype.getFrameCount = function() {
                return this.frames.length
            };
            EventTimeline.prototype.setFrame = function(frameIndex, event) {
                this.frames[frameIndex] = event.time;
                this.events[frameIndex] = event
            };
            EventTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                if (firedEvents == null) return;
                var frames = this.frames;
                var frameCount = this.frames.length;
                if (lastTime > time) {
                    this.apply(skeleton, lastTime, Number.MAX_VALUE, firedEvents, alpha, pose, direction);
                    lastTime = -1
                } else if (lastTime >= frames[frameCount - 1]) return;
                if (time < frames[0]) return;
                var frame = 0;
                if (lastTime < frames[0]) frame = 0;
                else {
                    frame = Animation.binarySearch(frames, lastTime);
                    var frameTime = frames[frame];
                    while (frame > 0) {
                        if (frames[frame - 1] != frameTime) break;
                        frame--
                    }
                }
                for (; frame < frameCount && time >= frames[frame]; frame++) firedEvents.push(this.events[frame])
            };
            return EventTimeline
        }();
        core.EventTimeline = EventTimeline;
        var DrawOrderTimeline = function() {
            function DrawOrderTimeline(frameCount) {
                this.frames = core.Utils.newFloatArray(frameCount);
                this.drawOrders = new Array(frameCount)
            }
            DrawOrderTimeline.prototype.getPropertyId = function() {
                return TimelineType.drawOrder << 24
            };
            DrawOrderTimeline.prototype.getFrameCount = function() {
                return this.frames.length
            };
            DrawOrderTimeline.prototype.setFrame = function(frameIndex, time, drawOrder) {
                this.frames[frameIndex] = time;
                this.drawOrders[frameIndex] = drawOrder
            };
            DrawOrderTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                var drawOrder = skeleton.drawOrder;
                var slots = skeleton.slots;
                if (direction == MixDirection.out && pose == MixPose.setup) {
                    core.Utils.arrayCopy(skeleton.slots, 0, skeleton.drawOrder, 0, skeleton.slots.length);
                    return
                }
                var frames = this.frames;
                if (time < frames[0]) {
                    if (pose == MixPose.setup) core.Utils.arrayCopy(skeleton.slots, 0, skeleton.drawOrder, 0, skeleton.slots.length);
                    return
                }
                var frame = 0;
                if (time >= frames[frames.length - 1]) frame = frames.length - 1;
                else frame = Animation.binarySearch(frames, time) - 1;
                var drawOrderToSetupIndex = this.drawOrders[frame];
                if (drawOrderToSetupIndex == null) core.Utils.arrayCopy(slots, 0, drawOrder, 0, slots.length);
                else {
                    for (var i = 0, n = drawOrderToSetupIndex.length; i < n; i++) drawOrder[i] = slots[drawOrderToSetupIndex[i]]
                }
            };
            return DrawOrderTimeline
        }();
        core.DrawOrderTimeline = DrawOrderTimeline;
        var IkConstraintTimeline = function(_super) {
            __extends(IkConstraintTimeline, _super);

            function IkConstraintTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount * IkConstraintTimeline.ENTRIES);
                return _this
            }
            IkConstraintTimeline.prototype.getPropertyId = function() {
                return (TimelineType.ikConstraint << 24) + this.ikConstraintIndex
            };
            IkConstraintTimeline.prototype.setFrame = function(frameIndex, time, mix, bendDirection) {
                frameIndex *= IkConstraintTimeline.ENTRIES;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + IkConstraintTimeline.MIX] = mix;
                this.frames[frameIndex + IkConstraintTimeline.BEND_DIRECTION] = bendDirection
            };
            IkConstraintTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                var frames = this.frames;
                var constraint = skeleton.ikConstraints[this.ikConstraintIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            constraint.mix = constraint.data.mix;
                            constraint.bendDirection = constraint.data.bendDirection;
                            return;
                        case MixPose.current:
                            constraint.mix += (constraint.data.mix - constraint.mix) * alpha;
                            constraint.bendDirection = constraint.data.bendDirection
                    }
                    return
                }
                if (time >= frames[frames.length - IkConstraintTimeline.ENTRIES]) {
                    if (pose == MixPose.setup) {
                        constraint.mix = constraint.data.mix + (frames[frames.length + IkConstraintTimeline.PREV_MIX] - constraint.data.mix) * alpha;
                        constraint.bendDirection = direction == MixDirection.out ? constraint.data.bendDirection : frames[frames.length + IkConstraintTimeline.PREV_BEND_DIRECTION]
                    } else {
                        constraint.mix += (frames[frames.length + IkConstraintTimeline.PREV_MIX] - constraint.mix) * alpha;
                        if (direction == MixDirection.in) constraint.bendDirection = frames[frames.length + IkConstraintTimeline.PREV_BEND_DIRECTION]
                    }
                    return
                }
                var frame = Animation.binarySearch(frames, time, IkConstraintTimeline.ENTRIES);
                var mix = frames[frame + IkConstraintTimeline.PREV_MIX];
                var frameTime = frames[frame];
                var percent = this.getCurvePercent(frame / IkConstraintTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + IkConstraintTimeline.PREV_TIME] - frameTime));
                if (pose == MixPose.setup) {
                    constraint.mix = constraint.data.mix + (mix + (frames[frame + IkConstraintTimeline.MIX] - mix) * percent - constraint.data.mix) * alpha;
                    constraint.bendDirection = direction == MixDirection.out ? constraint.data.bendDirection : frames[frame + IkConstraintTimeline.PREV_BEND_DIRECTION]
                } else {
                    constraint.mix += (mix + (frames[frame + IkConstraintTimeline.MIX] - mix) * percent - constraint.mix) * alpha;
                    if (direction == MixDirection.in) constraint.bendDirection = frames[frame + IkConstraintTimeline.PREV_BEND_DIRECTION]
                }
            };
            IkConstraintTimeline.ENTRIES = 3;
            IkConstraintTimeline.PREV_TIME = -3;
            IkConstraintTimeline.PREV_MIX = -2;
            IkConstraintTimeline.PREV_BEND_DIRECTION = -1;
            IkConstraintTimeline.MIX = 1;
            IkConstraintTimeline.BEND_DIRECTION = 2;
            return IkConstraintTimeline
        }(CurveTimeline);
        core.IkConstraintTimeline = IkConstraintTimeline;
        var TransformConstraintTimeline = function(_super) {
            __extends(TransformConstraintTimeline, _super);

            function TransformConstraintTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount * TransformConstraintTimeline.ENTRIES);
                return _this
            }
            TransformConstraintTimeline.prototype.getPropertyId = function() {
                return (TimelineType.transformConstraint << 24) + this.transformConstraintIndex
            };
            TransformConstraintTimeline.prototype.setFrame = function(frameIndex, time, rotateMix, translateMix, scaleMix, shearMix) {
                frameIndex *= TransformConstraintTimeline.ENTRIES;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + TransformConstraintTimeline.ROTATE] = rotateMix;
                this.frames[frameIndex + TransformConstraintTimeline.TRANSLATE] = translateMix;
                this.frames[frameIndex + TransformConstraintTimeline.SCALE] = scaleMix;
                this.frames[frameIndex + TransformConstraintTimeline.SHEAR] = shearMix
            };
            TransformConstraintTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                var frames = this.frames;
                var constraint = skeleton.transformConstraints[this.transformConstraintIndex];
                if (time < frames[0]) {
                    var data = constraint.data;
                    switch (pose) {
                        case MixPose.setup:
                            constraint.rotateMix = data.rotateMix;
                            constraint.translateMix = data.translateMix;
                            constraint.scaleMix = data.scaleMix;
                            constraint.shearMix = data.shearMix;
                            return;
                        case MixPose.current:
                            constraint.rotateMix += (data.rotateMix - constraint.rotateMix) * alpha;
                            constraint.translateMix += (data.translateMix - constraint.translateMix) * alpha;
                            constraint.scaleMix += (data.scaleMix - constraint.scaleMix) * alpha;
                            constraint.shearMix += (data.shearMix - constraint.shearMix) * alpha
                    }
                    return
                }
                var rotate = 0,
                    translate = 0,
                    scale = 0,
                    shear = 0;
                if (time >= frames[frames.length - TransformConstraintTimeline.ENTRIES]) {
                    var i = frames.length;
                    rotate = frames[i + TransformConstraintTimeline.PREV_ROTATE];
                    translate = frames[i + TransformConstraintTimeline.PREV_TRANSLATE];
                    scale = frames[i + TransformConstraintTimeline.PREV_SCALE];
                    shear = frames[i + TransformConstraintTimeline.PREV_SHEAR]
                } else {
                    var frame = Animation.binarySearch(frames, time, TransformConstraintTimeline.ENTRIES);
                    rotate = frames[frame + TransformConstraintTimeline.PREV_ROTATE];
                    translate = frames[frame + TransformConstraintTimeline.PREV_TRANSLATE];
                    scale = frames[frame + TransformConstraintTimeline.PREV_SCALE];
                    shear = frames[frame + TransformConstraintTimeline.PREV_SHEAR];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / TransformConstraintTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + TransformConstraintTimeline.PREV_TIME] - frameTime));
                    rotate += (frames[frame + TransformConstraintTimeline.ROTATE] - rotate) * percent;
                    translate += (frames[frame + TransformConstraintTimeline.TRANSLATE] - translate) * percent;
                    scale += (frames[frame + TransformConstraintTimeline.SCALE] - scale) * percent;
                    shear += (frames[frame + TransformConstraintTimeline.SHEAR] - shear) * percent
                }
                if (pose == MixPose.setup) {
                    var data = constraint.data;
                    constraint.rotateMix = data.rotateMix + (rotate - data.rotateMix) * alpha;
                    constraint.translateMix = data.translateMix + (translate - data.translateMix) * alpha;
                    constraint.scaleMix = data.scaleMix + (scale - data.scaleMix) * alpha;
                    constraint.shearMix = data.shearMix + (shear - data.shearMix) * alpha
                } else {
                    constraint.rotateMix += (rotate - constraint.rotateMix) * alpha;
                    constraint.translateMix += (translate - constraint.translateMix) * alpha;
                    constraint.scaleMix += (scale - constraint.scaleMix) * alpha;
                    constraint.shearMix += (shear - constraint.shearMix) * alpha
                }
            };
            TransformConstraintTimeline.ENTRIES = 5;
            TransformConstraintTimeline.PREV_TIME = -5;
            TransformConstraintTimeline.PREV_ROTATE = -4;
            TransformConstraintTimeline.PREV_TRANSLATE = -3;
            TransformConstraintTimeline.PREV_SCALE = -2;
            TransformConstraintTimeline.PREV_SHEAR = -1;
            TransformConstraintTimeline.ROTATE = 1;
            TransformConstraintTimeline.TRANSLATE = 2;
            TransformConstraintTimeline.SCALE = 3;
            TransformConstraintTimeline.SHEAR = 4;
            return TransformConstraintTimeline
        }(CurveTimeline);
        core.TransformConstraintTimeline = TransformConstraintTimeline;
        var PathConstraintPositionTimeline = function(_super) {
            __extends(PathConstraintPositionTimeline, _super);

            function PathConstraintPositionTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount * PathConstraintPositionTimeline.ENTRIES);
                return _this
            }
            PathConstraintPositionTimeline.prototype.getPropertyId = function() {
                return (TimelineType.pathConstraintPosition << 24) + this.pathConstraintIndex
            };
            PathConstraintPositionTimeline.prototype.setFrame = function(frameIndex, time, value) {
                frameIndex *= PathConstraintPositionTimeline.ENTRIES;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + PathConstraintPositionTimeline.VALUE] = value
            };
            PathConstraintPositionTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                var frames = this.frames;
                var constraint = skeleton.pathConstraints[this.pathConstraintIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            constraint.position = constraint.data.position;
                            return;
                        case MixPose.current:
                            constraint.position += (constraint.data.position - constraint.position) * alpha
                    }
                    return
                }
                var position = 0;
                if (time >= frames[frames.length - PathConstraintPositionTimeline.ENTRIES]) position = frames[frames.length + PathConstraintPositionTimeline.PREV_VALUE];
                else {
                    var frame = Animation.binarySearch(frames, time, PathConstraintPositionTimeline.ENTRIES);
                    position = frames[frame + PathConstraintPositionTimeline.PREV_VALUE];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / PathConstraintPositionTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + PathConstraintPositionTimeline.PREV_TIME] - frameTime));
                    position += (frames[frame + PathConstraintPositionTimeline.VALUE] - position) * percent
                }
                if (pose == MixPose.setup) constraint.position = constraint.data.position + (position - constraint.data.position) * alpha;
                else constraint.position += (position - constraint.position) * alpha
            };
            PathConstraintPositionTimeline.ENTRIES = 2;
            PathConstraintPositionTimeline.PREV_TIME = -2;
            PathConstraintPositionTimeline.PREV_VALUE = -1;
            PathConstraintPositionTimeline.VALUE = 1;
            return PathConstraintPositionTimeline
        }(CurveTimeline);
        core.PathConstraintPositionTimeline = PathConstraintPositionTimeline;
        var PathConstraintSpacingTimeline = function(_super) {
            __extends(PathConstraintSpacingTimeline, _super);

            function PathConstraintSpacingTimeline(frameCount) {
                return _super.call(this, frameCount) || this
            }
            PathConstraintSpacingTimeline.prototype.getPropertyId = function() {
                return (TimelineType.pathConstraintSpacing << 24) + this.pathConstraintIndex
            };
            PathConstraintSpacingTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                var frames = this.frames;
                var constraint = skeleton.pathConstraints[this.pathConstraintIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            constraint.spacing = constraint.data.spacing;
                            return;
                        case MixPose.current:
                            constraint.spacing += (constraint.data.spacing - constraint.spacing) * alpha
                    }
                    return
                }
                var spacing = 0;
                if (time >= frames[frames.length - PathConstraintSpacingTimeline.ENTRIES]) spacing = frames[frames.length + PathConstraintSpacingTimeline.PREV_VALUE];
                else {
                    var frame = Animation.binarySearch(frames, time, PathConstraintSpacingTimeline.ENTRIES);
                    spacing = frames[frame + PathConstraintSpacingTimeline.PREV_VALUE];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / PathConstraintSpacingTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + PathConstraintSpacingTimeline.PREV_TIME] - frameTime));
                    spacing += (frames[frame + PathConstraintSpacingTimeline.VALUE] - spacing) * percent
                }
                if (pose == MixPose.setup) constraint.spacing = constraint.data.spacing + (spacing - constraint.data.spacing) * alpha;
                else constraint.spacing += (spacing - constraint.spacing) * alpha
            };
            return PathConstraintSpacingTimeline
        }(PathConstraintPositionTimeline);
        core.PathConstraintSpacingTimeline = PathConstraintSpacingTimeline;
        var PathConstraintMixTimeline = function(_super) {
            __extends(PathConstraintMixTimeline, _super);

            function PathConstraintMixTimeline(frameCount) {
                var _this = _super.call(this, frameCount) || this;
                _this.frames = core.Utils.newFloatArray(frameCount * PathConstraintMixTimeline.ENTRIES);
                return _this
            }
            PathConstraintMixTimeline.prototype.getPropertyId = function() {
                return (TimelineType.pathConstraintMix << 24) + this.pathConstraintIndex
            };
            PathConstraintMixTimeline.prototype.setFrame = function(frameIndex, time, rotateMix, translateMix) {
                frameIndex *= PathConstraintMixTimeline.ENTRIES;
                this.frames[frameIndex] = time;
                this.frames[frameIndex + PathConstraintMixTimeline.ROTATE] = rotateMix;
                this.frames[frameIndex + PathConstraintMixTimeline.TRANSLATE] = translateMix
            };
            PathConstraintMixTimeline.prototype.apply = function(skeleton, lastTime, time, firedEvents, alpha, pose, direction) {
                var frames = this.frames;
                var constraint = skeleton.pathConstraints[this.pathConstraintIndex];
                if (time < frames[0]) {
                    switch (pose) {
                        case MixPose.setup:
                            constraint.rotateMix = constraint.data.rotateMix;
                            constraint.translateMix = constraint.data.translateMix;
                            return;
                        case MixPose.current:
                            constraint.rotateMix += (constraint.data.rotateMix - constraint.rotateMix) * alpha;
                            constraint.translateMix += (constraint.data.translateMix - constraint.translateMix) * alpha
                    }
                    return
                }
                var rotate = 0,
                    translate = 0;
                if (time >= frames[frames.length - PathConstraintMixTimeline.ENTRIES]) {
                    rotate = frames[frames.length + PathConstraintMixTimeline.PREV_ROTATE];
                    translate = frames[frames.length + PathConstraintMixTimeline.PREV_TRANSLATE]
                } else {
                    var frame = Animation.binarySearch(frames, time, PathConstraintMixTimeline.ENTRIES);
                    rotate = frames[frame + PathConstraintMixTimeline.PREV_ROTATE];
                    translate = frames[frame + PathConstraintMixTimeline.PREV_TRANSLATE];
                    var frameTime = frames[frame];
                    var percent = this.getCurvePercent(frame / PathConstraintMixTimeline.ENTRIES - 1, 1 - (time - frameTime) / (frames[frame + PathConstraintMixTimeline.PREV_TIME] - frameTime));
                    rotate += (frames[frame + PathConstraintMixTimeline.ROTATE] - rotate) * percent;
                    translate += (frames[frame + PathConstraintMixTimeline.TRANSLATE] - translate) * percent
                }
                if (pose == MixPose.setup) {
                    constraint.rotateMix = constraint.data.rotateMix + (rotate - constraint.data.rotateMix) * alpha;
                    constraint.translateMix = constraint.data.translateMix + (translate - constraint.data.translateMix) * alpha
                } else {
                    constraint.rotateMix += (rotate - constraint.rotateMix) * alpha;
                    constraint.translateMix += (translate - constraint.translateMix) * alpha
                }
            };
            PathConstraintMixTimeline.ENTRIES = 3;
            PathConstraintMixTimeline.PREV_TIME = -3;
            PathConstraintMixTimeline.PREV_ROTATE = -2;
            PathConstraintMixTimeline.PREV_TRANSLATE = -1;
            PathConstraintMixTimeline.ROTATE = 1;
            PathConstraintMixTimeline.TRANSLATE = 2;
            return PathConstraintMixTimeline
        }(CurveTimeline);
        core.PathConstraintMixTimeline = PathConstraintMixTimeline
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var AnimationState = function() {
            function AnimationState(data) {
                this.tracks = new Array;
                this.events = new Array;
                this.listeners = new Array;
                this.queue = new EventQueue(this);
                this.propertyIDs = new core.IntSet;
                this.mixingTo = new Array;
                this.animationsChanged = false;
                this.timeScale = 1;
                this.trackEntryPool = new core.Pool(function() {
                    return new TrackEntry
                });
                this.data = data
            }
            AnimationState.prototype.update = function(delta) {
                delta *= this.timeScale;
                var tracks = this.tracks;
                for (var i = 0, n = tracks.length; i < n; i++) {
                    var current = tracks[i];
                    if (current == null) continue;
                    current.animationLast = current.nextAnimationLast;
                    current.trackLast = current.nextTrackLast;
                    var currentDelta = delta * current.timeScale;
                    if (current.delay > 0) {
                        current.delay -= currentDelta;
                        if (current.delay > 0) continue;
                        currentDelta = -current.delay;
                        current.delay = 0
                    }
                    var next = current.next;
                    if (next != null) {
                        var nextTime = current.trackLast - next.delay;
                        if (nextTime >= 0) {
                            next.delay = 0;
                            next.trackTime = nextTime + delta * next.timeScale;
                            current.trackTime += currentDelta;
                            this.setCurrent(i, next, true);
                            while (next.mixingFrom != null) {
                                next.mixTime += currentDelta;
                                next = next.mixingFrom
                            }
                            continue
                        }
                    } else if (current.trackLast >= current.trackEnd && current.mixingFrom == null) {
                        tracks[i] = null;
                        this.queue.end(current);
                        this.disposeNext(current);
                        continue
                    }
                    if (current.mixingFrom != null && this.updateMixingFrom(current, delta)) {
                        var from = current.mixingFrom;
                        current.mixingFrom = null;
                        while (from != null) {
                            this.queue.end(from);
                            from = from.mixingFrom
                        }
                    }
                    current.trackTime += currentDelta
                }
                this.queue.drain()
            };
            AnimationState.prototype.updateMixingFrom = function(to, delta) {
                var from = to.mixingFrom;
                if (from == null) return true;
                var finished = this.updateMixingFrom(from, delta);
                if (to.mixTime > 0 && (to.mixTime >= to.mixDuration || to.timeScale == 0)) {
                    if (from.totalAlpha == 0) {
                        to.mixingFrom = from.mixingFrom;
                        to.interruptAlpha = from.interruptAlpha;
                        this.queue.end(from)
                    }
                    return finished
                }
                from.animationLast = from.nextAnimationLast;
                from.trackLast = from.nextTrackLast;
                from.trackTime += delta * from.timeScale;
                to.mixTime += delta * to.timeScale;
                return false
            };
            AnimationState.prototype.apply = function(skeleton) {
                if (skeleton == null) throw new Error("skeleton cannot be null.");
                if (this.animationsChanged) this._animationsChanged();
                var events = this.events;
                var tracks = this.tracks;
                var applied = false;
                for (var i = 0, n = tracks.length; i < n; i++) {
                    var current = tracks[i];
                    if (current == null || current.delay > 0) continue;
                    applied = true;
                    var currentPose = i == 0 ? core.MixPose.current : core.MixPose.currentLayered;
                    var mix = current.alpha;
                    if (current.mixingFrom != null) mix *= this.applyMixingFrom(current, skeleton, currentPose);
                    else if (current.trackTime >= current.trackEnd && current.next == null) mix = 0;
                    var animationLast = current.animationLast,
                        animationTime = current.getAnimationTime();
                    var timelineCount = current.animation.timelines.length;
                    var timelines = current.animation.timelines;
                    if (mix == 1) {
                        for (var ii = 0; ii < timelineCount; ii++) timelines[ii].apply(skeleton, animationLast, animationTime, events, 1, core.MixPose.setup, core.MixDirection.in)
                    } else {
                        var timelineData = current.timelineData;
                        var firstFrame = current.timelinesRotation.length == 0;
                        if (firstFrame) core.Utils.setArraySize(current.timelinesRotation, timelineCount << 1, null);
                        var timelinesRotation = current.timelinesRotation;
                        for (var ii = 0; ii < timelineCount; ii++) {
                            var timeline = timelines[ii];
                            var pose = timelineData[ii] >= AnimationState.FIRST ? core.MixPose.setup : currentPose;
                            if (timeline instanceof core.RotateTimeline) {
                                this.applyRotateTimeline(timeline, skeleton, animationTime, mix, pose, timelinesRotation, ii << 1, firstFrame)
                            } else timeline.apply(skeleton, animationLast, animationTime, events, mix, pose, core.MixDirection.in)
                        }
                    }
                    this.queueEvents(current, animationTime);
                    events.length = 0;
                    current.nextAnimationLast = animationTime;
                    current.nextTrackLast = current.trackTime
                }
                this.queue.drain();
                return applied
            };
            AnimationState.prototype.applyMixingFrom = function(to, skeleton, currentPose) {
                var from = to.mixingFrom;
                if (from.mixingFrom != null) this.applyMixingFrom(from, skeleton, currentPose);
                var mix = 0;
                if (to.mixDuration == 0) mix = 1;
                else {
                    mix = to.mixTime / to.mixDuration;
                    if (mix > 1) mix = 1
                }
                var events = mix < from.eventThreshold ? this.events : null;
                var attachments = mix < from.attachmentThreshold,
                    drawOrder = mix < from.drawOrderThreshold;
                var animationLast = from.animationLast,
                    animationTime = from.getAnimationTime();
                var timelineCount = from.animation.timelines.length;
                var timelines = from.animation.timelines;
                var timelineData = from.timelineData;
                var timelineDipMix = from.timelineDipMix;
                var firstFrame = from.timelinesRotation.length == 0;
                if (firstFrame) core.Utils.setArraySize(from.timelinesRotation, timelineCount << 1, null);
                var timelinesRotation = from.timelinesRotation;
                var pose;
                var alphaDip = from.alpha * to.interruptAlpha,
                    alphaMix = alphaDip * (1 - mix),
                    alpha = 0;
                from.totalAlpha = 0;
                for (var i = 0; i < timelineCount; i++) {
                    var timeline = timelines[i];
                    switch (timelineData[i]) {
                        case AnimationState.SUBSEQUENT:
                            if (!attachments && timeline instanceof core.AttachmentTimeline) continue;
                            if (!drawOrder && timeline instanceof core.DrawOrderTimeline) continue;
                            pose = currentPose;
                            alpha = alphaMix;
                            break;
                        case AnimationState.FIRST:
                            pose = core.MixPose.setup;
                            alpha = alphaMix;
                            break;
                        case AnimationState.DIP:
                            pose = core.MixPose.setup;
                            alpha = alphaDip;
                            break;
                        default:
                            pose = core.MixPose.setup;
                            alpha = alphaDip;
                            var dipMix = timelineDipMix[i];
                            alpha *= Math.max(0, 1 - dipMix.mixTime / dipMix.mixDuration);
                            break
                    }
                    from.totalAlpha += alpha;
                    if (timeline instanceof core.RotateTimeline) this.applyRotateTimeline(timeline, skeleton, animationTime, alpha, pose, timelinesRotation, i << 1, firstFrame);
                    else {
                        timeline.apply(skeleton, animationLast, animationTime, events, alpha, pose, core.MixDirection.out)
                    }
                }
                if (to.mixDuration > 0) this.queueEvents(from, animationTime);
                this.events.length = 0;
                from.nextAnimationLast = animationTime;
                from.nextTrackLast = from.trackTime;
                return mix
            };
            AnimationState.prototype.applyRotateTimeline = function(timeline, skeleton, time, alpha, pose, timelinesRotation, i, firstFrame) {
                if (firstFrame) timelinesRotation[i] = 0;
                if (alpha == 1) {
                    timeline.apply(skeleton, 0, time, null, 1, pose, core.MixDirection.in);
                    return
                }
                var rotateTimeline = timeline;
                var frames = rotateTimeline.frames;
                var bone = skeleton.bones[rotateTimeline.boneIndex];
                if (time < frames[0]) {
                    if (pose == core.MixPose.setup) bone.rotation = bone.data.rotation;
                    return
                }
                var r2 = 0;
                if (time >= frames[frames.length - core.RotateTimeline.ENTRIES]) r2 = bone.data.rotation + frames[frames.length + core.RotateTimeline.PREV_ROTATION];
                else {
                    var frame = core.Animation.binarySearch(frames, time, core.RotateTimeline.ENTRIES);
                    var prevRotation = frames[frame + core.RotateTimeline.PREV_ROTATION];
                    var frameTime = frames[frame];
                    var percent = rotateTimeline.getCurvePercent((frame >> 1) - 1, 1 - (time - frameTime) / (frames[frame + core.RotateTimeline.PREV_TIME] - frameTime));
                    r2 = frames[frame + core.RotateTimeline.ROTATION] - prevRotation;
                    r2 -= (16384 - (16384.499999999996 - r2 / 360 | 0)) * 360;
                    r2 = prevRotation + r2 * percent + bone.data.rotation;
                    r2 -= (16384 - (16384.499999999996 - r2 / 360 | 0)) * 360
                }
                var r1 = pose == core.MixPose.setup ? bone.data.rotation : bone.rotation;
                var total = 0,
                    diff = r2 - r1;
                if (diff == 0) {
                    total = timelinesRotation[i]
                } else {
                    diff -= (16384 - (16384.499999999996 - diff / 360 | 0)) * 360;
                    var lastTotal = 0,
                        lastDiff = 0;
                    if (firstFrame) {
                        lastTotal = 0;
                        lastDiff = diff
                    } else {
                        lastTotal = timelinesRotation[i];
                        lastDiff = timelinesRotation[i + 1]
                    }
                    var current = diff > 0,
                        dir = lastTotal >= 0;
                    if (core.MathUtils.signum(lastDiff) != core.MathUtils.signum(diff) && Math.abs(lastDiff) <= 90) {
                        if (Math.abs(lastTotal) > 180) lastTotal += 360 * core.MathUtils.signum(lastTotal);
                        dir = current
                    }
                    total = diff + lastTotal - lastTotal % 360;
                    if (dir != current) total += 360 * core.MathUtils.signum(lastTotal);
                    timelinesRotation[i] = total
                }
                timelinesRotation[i + 1] = diff;
                r1 += total * alpha;
                bone.rotation = r1 - (16384 - (16384.499999999996 - r1 / 360 | 0)) * 360
            };
            AnimationState.prototype.queueEvents = function(entry, animationTime) {
                var animationStart = entry.animationStart,
                    animationEnd = entry.animationEnd;
                var duration = animationEnd - animationStart;
                var trackLastWrapped = entry.trackLast % duration;
                var events = this.events;
                var i = 0,
                    n = events.length;
                for (; i < n; i++) {
                    var event_1 = events[i];
                    if (event_1.time < trackLastWrapped) break;
                    if (event_1.time > animationEnd) continue;
                    this.queue.event(entry, event_1)
                }
                if (entry.loop ? trackLastWrapped > entry.trackTime % duration : animationTime >= animationEnd && entry.animationLast < animationEnd) {
                    this.queue.complete(entry)
                }
                for (; i < n; i++) {
                    var event_2 = events[i];
                    if (event_2.time < animationStart) continue;
                    this.queue.event(entry, events[i])
                }
            };
            AnimationState.prototype.clearTracks = function() {
                var oldDrainDisabled = this.queue.drainDisabled;
                this.queue.drainDisabled = true;
                for (var i = 0, n = this.tracks.length; i < n; i++) this.clearTrack(i);
                this.tracks.length = 0;
                this.queue.drainDisabled = oldDrainDisabled;
                this.queue.drain()
            };
            AnimationState.prototype.clearTrack = function(trackIndex) {
                if (trackIndex >= this.tracks.length) return;
                var current = this.tracks[trackIndex];
                if (current == null) return;
                this.queue.end(current);
                this.disposeNext(current);
                var entry = current;
                while (true) {
                    var from = entry.mixingFrom;
                    if (from == null) break;
                    this.queue.end(from);
                    entry.mixingFrom = null;
                    entry = from
                }
                this.tracks[current.trackIndex] = null;
                this.queue.drain()
            };
            AnimationState.prototype.setCurrent = function(index, current, interrupt) {
                var from = this.expandToIndex(index);
                this.tracks[index] = current;
                if (from != null) {
                    if (interrupt) this.queue.interrupt(from);
                    current.mixingFrom = from;
                    current.mixTime = 0;
                    if (from.mixingFrom != null && from.mixDuration > 0) current.interruptAlpha *= Math.min(1, from.mixTime / from.mixDuration);
                    from.timelinesRotation.length = 0
                }
                this.queue.start(current)
            };
            AnimationState.prototype.setAnimation = function(trackIndex, animationName, loop) {
                var animation = this.data.skeletonData.findAnimation(animationName);
                if (animation == null) throw new Error("Animation not found: " + animationName);
                return this.setAnimationWith(trackIndex, animation, loop)
            };
            AnimationState.prototype.setAnimationWith = function(trackIndex, animation, loop) {
                if (animation == null) throw new Error("animation cannot be null.");
                var interrupt = true;
                var current = this.expandToIndex(trackIndex);
                if (current != null) {
                    if (current.nextTrackLast == -1) {
                        this.tracks[trackIndex] = current.mixingFrom;
                        this.queue.interrupt(current);
                        this.queue.end(current);
                        this.disposeNext(current);
                        current = current.mixingFrom;
                        interrupt = false
                    } else this.disposeNext(current)
                }
                var entry = this.trackEntry(trackIndex, animation, loop, current);
                this.setCurrent(trackIndex, entry, interrupt);
                this.queue.drain();
                return entry
            };
            AnimationState.prototype.addAnimation = function(trackIndex, animationName, loop, delay) {
                var animation = this.data.skeletonData.findAnimation(animationName);
                if (animation == null) throw new Error("Animation not found: " + animationName);
                return this.addAnimationWith(trackIndex, animation, loop, delay)
            };
            AnimationState.prototype.addAnimationWith = function(trackIndex, animation, loop, delay) {
                if (animation == null) throw new Error("animation cannot be null.");
                var last = this.expandToIndex(trackIndex);
                if (last != null) {
                    while (last.next != null) last = last.next
                }
                var entry = this.trackEntry(trackIndex, animation, loop, last);
                if (last == null) {
                    this.setCurrent(trackIndex, entry, true);
                    this.queue.drain()
                } else {
                    last.next = entry;
                    if (delay <= 0) {
                        var duration = last.animationEnd - last.animationStart;
                        if (duration != 0) delay += duration * (1 + (last.trackTime / duration | 0)) - this.data.getMix(last.animation, animation);
                        else delay = 0
                    }
                }
                entry.delay = delay;
                return entry
            };
            AnimationState.prototype.setEmptyAnimation = function(trackIndex, mixDuration) {
                var entry = this.setAnimationWith(trackIndex, AnimationState.emptyAnimation, false);
                entry.mixDuration = mixDuration;
                entry.trackEnd = mixDuration;
                return entry
            };
            AnimationState.prototype.addEmptyAnimation = function(trackIndex, mixDuration, delay) {
                if (delay <= 0) delay -= mixDuration;
                var entry = this.addAnimationWith(trackIndex, AnimationState.emptyAnimation, false, delay);
                entry.mixDuration = mixDuration;
                entry.trackEnd = mixDuration;
                return entry
            };
            AnimationState.prototype.setEmptyAnimations = function(mixDuration) {
                var oldDrainDisabled = this.queue.drainDisabled;
                this.queue.drainDisabled = true;
                for (var i = 0, n = this.tracks.length; i < n; i++) {
                    var current = this.tracks[i];
                    if (current != null) this.setEmptyAnimation(current.trackIndex, mixDuration)
                }
                this.queue.drainDisabled = oldDrainDisabled;
                this.queue.drain()
            };
            AnimationState.prototype.expandToIndex = function(index) {
                if (index < this.tracks.length) return this.tracks[index];
                core.Utils.ensureArrayCapacity(this.tracks, index - this.tracks.length + 1, null);
                this.tracks.length = index + 1;
                return null
            };
            AnimationState.prototype.trackEntry = function(trackIndex, animation, loop, last) {
                var entry = this.trackEntryPool.obtain();
                entry.trackIndex = trackIndex;
                entry.animation = animation;
                entry.loop = loop;
                entry.eventThreshold = 0;
                entry.attachmentThreshold = 0;
                entry.drawOrderThreshold = 0;
                entry.animationStart = 0;
                entry.animationEnd = animation.duration;
                entry.animationLast = -1;
                entry.nextAnimationLast = -1;
                entry.delay = 0;
                entry.trackTime = 0;
                entry.trackLast = -1;
                entry.nextTrackLast = -1;
                entry.trackEnd = Number.MAX_VALUE;
                entry.timeScale = 1;
                entry.alpha = 1;
                entry.interruptAlpha = 1;
                entry.mixTime = 0;
                entry.mixDuration = last == null ? 0 : this.data.getMix(last.animation, animation);
                return entry
            };
            AnimationState.prototype.disposeNext = function(entry) {
                var next = entry.next;
                while (next != null) {
                    this.queue.dispose(next);
                    next = next.next
                }
                entry.next = null
            };
            AnimationState.prototype._animationsChanged = function() {
                this.animationsChanged = false;
                var propertyIDs = this.propertyIDs;
                propertyIDs.clear();
                var mixingTo = this.mixingTo;
                var lastEntry = null;
                for (var i = 0, n = this.tracks.length; i < n; i++) {
                    var entry = this.tracks[i];
                    if (entry != null) entry.setTimelineData(null, mixingTo, propertyIDs)
                }
            };
            AnimationState.prototype.getCurrent = function(trackIndex) {
                if (trackIndex >= this.tracks.length) return null;
                return this.tracks[trackIndex]
            };
            AnimationState.prototype.addListener = function(listener) {
                if (listener == null) throw new Error("listener cannot be null.");
                this.listeners.push(listener)
            };
            AnimationState.prototype.removeListener = function(listener) {
                var index = this.listeners.indexOf(listener);
                if (index >= 0) this.listeners.splice(index, 1)
            };
            AnimationState.prototype.clearListeners = function() {
                this.listeners.length = 0
            };
            AnimationState.prototype.clearListenerNotifications = function() {
                this.queue.clear()
            };
            AnimationState.prototype.setAnimationByName = function(trackIndex, animationName, loop) {
                if (!AnimationState.deprecatedWarning1) {
                    AnimationState.deprecatedWarning1 = true;
                    console.warn("Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")
                }
                this.setAnimation(trackIndex, animationName, loop)
            };
            AnimationState.prototype.addAnimationByName = function(trackIndex, animationName, loop, delay) {
                if (!AnimationState.deprecatedWarning2) {
                    AnimationState.deprecatedWarning2 = true;
                    console.warn("Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")
                }
                this.addAnimation(trackIndex, animationName, loop, delay)
            };
            AnimationState.prototype.hasAnimation = function(animationName) {
                var animation = this.data.skeletonData.findAnimation(animationName);
                return animation !== null
            };
            AnimationState.prototype.hasAnimationByName = function(animationName) {
                if (!AnimationState.deprecatedWarning3) {
                    AnimationState.deprecatedWarning3 = true;
                    console.warn("Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")
                }
                return this.hasAnimation(animationName)
            };
            AnimationState.emptyAnimation = new core.Animation("<empty>", [], 0);
            AnimationState.SUBSEQUENT = 0;
            AnimationState.FIRST = 1;
            AnimationState.DIP = 2;
            AnimationState.DIP_MIX = 3;
            AnimationState.deprecatedWarning1 = false;
            AnimationState.deprecatedWarning2 = false;
            AnimationState.deprecatedWarning3 = false;
            return AnimationState
        }();
        core.AnimationState = AnimationState;
        var TrackEntry = function() {
            function TrackEntry() {
                this.timelineData = new Array;
                this.timelineDipMix = new Array;
                this.timelinesRotation = new Array
            }
            TrackEntry.prototype.reset = function() {
                this.next = null;
                this.mixingFrom = null;
                this.animation = null;
                this.listener = null;
                this.timelineData.length = 0;
                this.timelineDipMix.length = 0;
                this.timelinesRotation.length = 0
            };
            TrackEntry.prototype.setTimelineData = function(to, mixingToArray, propertyIDs) {
                if (to != null) mixingToArray.push(to);
                var lastEntry = this.mixingFrom != null ? this.mixingFrom.setTimelineData(this, mixingToArray, propertyIDs) : this;
                if (to != null) mixingToArray.pop();
                var mixingTo = mixingToArray;
                var mixingToLast = mixingToArray.length - 1;
                var timelines = this.animation.timelines;
                var timelinesCount = this.animation.timelines.length;
                var timelineData = core.Utils.setArraySize(this.timelineData, timelinesCount);
                this.timelineDipMix.length = 0;
                var timelineDipMix = core.Utils.setArraySize(this.timelineDipMix, timelinesCount);
                outer: for (var i = 0; i < timelinesCount; i++) {
                    var id = timelines[i].getPropertyId();
                    if (!propertyIDs.add(id)) timelineData[i] = AnimationState.SUBSEQUENT;
                    else if (to == null || !to.hasTimeline(id)) timelineData[i] = AnimationState.FIRST;
                    else {
                        for (var ii = mixingToLast; ii >= 0; ii--) {
                            var entry = mixingTo[ii];
                            if (!entry.hasTimeline(id)) {
                                if (entry.mixDuration > 0) {
                                    timelineData[i] = AnimationState.DIP_MIX;
                                    timelineDipMix[i] = entry;
                                    continue outer
                                }
                            }
                        }
                        timelineData[i] = AnimationState.DIP
                    }
                }
                return lastEntry
            };
            TrackEntry.prototype.hasTimeline = function(id) {
                var timelines = this.animation.timelines;
                for (var i = 0, n = timelines.length; i < n; i++)
                    if (timelines[i].getPropertyId() == id) return true;
                return false
            };
            TrackEntry.prototype.getAnimationTime = function() {
                if (this.loop) {
                    var duration = this.animationEnd - this.animationStart;
                    if (duration == 0) return this.animationStart;
                    return this.trackTime % duration + this.animationStart
                }
                return Math.min(this.trackTime + this.animationStart, this.animationEnd)
            };
            TrackEntry.prototype.setAnimationLast = function(animationLast) {
                this.animationLast = animationLast;
                this.nextAnimationLast = animationLast
            };
            TrackEntry.prototype.isComplete = function() {
                return this.trackTime >= this.animationEnd - this.animationStart
            };
            TrackEntry.prototype.resetRotationDirections = function() {
                this.timelinesRotation.length = 0
            };
            Object.defineProperty(TrackEntry.prototype, "time", {
                get: function() {
                    if (!TrackEntry.deprecatedWarning1) {
                        TrackEntry.deprecatedWarning1 = true;
                        console.warn("Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")
                    }
                    return this.trackTime
                },
                set: function(value) {
                    if (!TrackEntry.deprecatedWarning1) {
                        TrackEntry.deprecatedWarning1 = true;
                        console.warn("Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")
                    }
                    this.trackTime = value
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TrackEntry.prototype, "endTime", {
                get: function() {
                    if (!TrackEntry.deprecatedWarning2) {
                        TrackEntry.deprecatedWarning2 = true;
                        console.warn("Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")
                    }
                    return this.trackTime
                },
                set: function(value) {
                    if (!TrackEntry.deprecatedWarning2) {
                        TrackEntry.deprecatedWarning2 = true;
                        console.warn("Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")
                    }
                    this.trackTime = value
                },
                enumerable: true,
                configurable: true
            });
            TrackEntry.prototype.loopsCount = function() {
                return Math.floor(this.trackTime / this.trackEnd)
            };
            TrackEntry.deprecatedWarning1 = false;
            TrackEntry.deprecatedWarning2 = false;
            return TrackEntry
        }();
        core.TrackEntry = TrackEntry;
        var EventQueue = function() {
            function EventQueue(animState) {
                this.objects = [];
                this.drainDisabled = false;
                this.animState = animState
            }
            EventQueue.prototype.start = function(entry) {
                this.objects.push(EventType.start);
                this.objects.push(entry);
                this.animState.animationsChanged = true
            };
            EventQueue.prototype.interrupt = function(entry) {
                this.objects.push(EventType.interrupt);
                this.objects.push(entry)
            };
            EventQueue.prototype.end = function(entry) {
                this.objects.push(EventType.end);
                this.objects.push(entry);
                this.animState.animationsChanged = true
            };
            EventQueue.prototype.dispose = function(entry) {
                this.objects.push(EventType.dispose);
                this.objects.push(entry)
            };
            EventQueue.prototype.complete = function(entry) {
                this.objects.push(EventType.complete);
                this.objects.push(entry)
            };
            EventQueue.prototype.event = function(entry, event) {
                this.objects.push(EventType.event);
                this.objects.push(entry);
                this.objects.push(event)
            };
            EventQueue.prototype.deprecateStuff = function() {
                if (!EventQueue.deprecatedWarning1) {
                    EventQueue.deprecatedWarning1 = true;
                    console.warn("Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")
                }
                return true
            };
            EventQueue.prototype.drain = function() {
                if (this.drainDisabled) return;
                this.drainDisabled = true;
                var objects = this.objects;
                var listeners = this.animState.listeners;
                for (var i = 0; i < objects.length; i += 2) {
                    var type = objects[i];
                    var entry = objects[i + 1];
                    switch (type) {
                        case EventType.start:
                            if (entry.listener != null && entry.listener.start) entry.listener.start(entry);
                            for (var ii = 0; ii < listeners.length; ii++)
                                if (listeners[ii].start) listeners[ii].start(entry);
                            entry.onStart && this.deprecateStuff() && entry.onStart(entry.trackIndex);
                            this.animState.onStart && this.deprecateStuff() && this.deprecateStuff && this.animState.onStart(entry.trackIndex);
                            break;
                        case EventType.interrupt:
                            if (entry.listener != null && entry.listener.interrupt) entry.listener.interrupt(entry);
                            for (var ii = 0; ii < listeners.length; ii++)
                                if (listeners[ii].interrupt) listeners[ii].interrupt(entry);
                            break;
                        case EventType.end:
                            if (entry.listener != null && entry.listener.end) entry.listener.end(entry);
                            for (var ii = 0; ii < listeners.length; ii++)
                                if (listeners[ii].end) listeners[ii].end(entry);
                            entry.onEnd && this.deprecateStuff() && entry.onEnd(entry.trackIndex);
                            this.animState.onEnd && this.deprecateStuff() && this.animState.onEnd(entry.trackIndex);
                        case EventType.dispose:
                            if (entry.listener != null && entry.listener.dispose) entry.listener.dispose(entry);
                            for (var ii = 0; ii < listeners.length; ii++)
                                if (listeners[ii].dispose) listeners[ii].dispose(entry);
                            this.animState.trackEntryPool.free(entry);
                            break;
                        case EventType.complete:
                            if (entry.listener != null && entry.listener.complete) entry.listener.complete(entry);
                            for (var ii = 0; ii < listeners.length; ii++)
                                if (listeners[ii].complete) listeners[ii].complete(entry);
                            var count = core.MathUtils.toInt(entry.loopsCount());
                            entry.onComplete && this.deprecateStuff() && entry.onComplete(entry.trackIndex, count);
                            this.animState.onComplete && this.deprecateStuff() && this.animState.onComplete(entry.trackIndex, count);
                            break;
                        case EventType.event:
                            var event_3 = objects[i++ + 2];
                            if (entry.listener != null && entry.listener.event) entry.listener.event(entry, event_3);
                            for (var ii = 0; ii < listeners.length; ii++)
                                if (listeners[ii].event) listeners[ii].event(entry, event_3);
                            entry.onEvent && this.deprecateStuff() && entry.onEvent(entry.trackIndex, event_3);
                            this.animState.onEvent && this.deprecateStuff() && this.animState.onEvent(entry.trackIndex, event_3);
                            break
                    }
                }
                this.clear();
                this.drainDisabled = false
            };
            EventQueue.prototype.clear = function() {
                this.objects.length = 0
            };
            EventQueue.deprecatedWarning1 = false;
            return EventQueue
        }();
        core.EventQueue = EventQueue;
        var EventType;
        (function(EventType) {
            EventType[EventType["start"] = 0] = "start";
            EventType[EventType["interrupt"] = 1] = "interrupt";
            EventType[EventType["end"] = 2] = "end";
            EventType[EventType["dispose"] = 3] = "dispose";
            EventType[EventType["complete"] = 4] = "complete";
            EventType[EventType["event"] = 5] = "event"
        })(EventType = core.EventType || (core.EventType = {}));
        var AnimationStateAdapter2 = function() {
            function AnimationStateAdapter2() {}
            AnimationStateAdapter2.prototype.start = function(entry) {};
            AnimationStateAdapter2.prototype.interrupt = function(entry) {};
            AnimationStateAdapter2.prototype.end = function(entry) {};
            AnimationStateAdapter2.prototype.dispose = function(entry) {};
            AnimationStateAdapter2.prototype.complete = function(entry) {};
            AnimationStateAdapter2.prototype.event = function(entry, event) {};
            return AnimationStateAdapter2
        }();
        core.AnimationStateAdapter2 = AnimationStateAdapter2
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var AnimationStateData = function() {
            function AnimationStateData(skeletonData) {
                this.animationToMixTime = {};
                this.defaultMix = 0;
                if (skeletonData == null) throw new Error("skeletonData cannot be null.");
                this.skeletonData = skeletonData
            }
            AnimationStateData.prototype.setMix = function(fromName, toName, duration) {
                var from = this.skeletonData.findAnimation(fromName);
                if (from == null) throw new Error("Animation not found: " + fromName);
                var to = this.skeletonData.findAnimation(toName);
                if (to == null) throw new Error("Animation not found: " + toName);
                this.setMixWith(from, to, duration)
            };
            AnimationStateData.prototype.setMixByName = function(fromName, toName, duration) {
                if (!AnimationStateData.deprecatedWarning1) {
                    AnimationStateData.deprecatedWarning1 = true;
                    console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")
                }
                this.setMix(fromName, toName, duration)
            };
            AnimationStateData.prototype.setMixWith = function(from, to, duration) {
                if (from == null) throw new Error("from cannot be null.");
                if (to == null) throw new Error("to cannot be null.");
                var key = from.name + to.name;
                this.animationToMixTime[key] = duration
            };
            AnimationStateData.prototype.getMix = function(from, to) {
                var key = from.name + to.name;
                var value = this.animationToMixTime[key];
                return value === undefined ? this.defaultMix : value
            };
            AnimationStateData.deprecatedWarning1 = false;
            return AnimationStateData
        }();
        core.AnimationStateData = AnimationStateData
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var AtlasAttachmentLoader = function() {
            function AtlasAttachmentLoader(atlas) {
                this.atlas = atlas
            }
            AtlasAttachmentLoader.prototype.newRegionAttachment = function(skin, name, path) {
                var region = this.atlas.findRegion(path);
                if (region == null) throw new Error("Region not found in atlas: " + path + " (region attachment: " + name + ")");
                var attachment = new core.RegionAttachment(name);
                attachment.region = region;
                return attachment
            };
            AtlasAttachmentLoader.prototype.newMeshAttachment = function(skin, name, path) {
                var region = this.atlas.findRegion(path);
                if (region == null) throw new Error("Region not found in atlas: " + path + " (mesh attachment: " + name + ")");
                var attachment = new core.MeshAttachment(name);
                attachment.region = region;
                return attachment
            };
            AtlasAttachmentLoader.prototype.newBoundingBoxAttachment = function(skin, name) {
                return new core.BoundingBoxAttachment(name)
            };
            AtlasAttachmentLoader.prototype.newPathAttachment = function(skin, name) {
                return new core.PathAttachment(name)
            };
            AtlasAttachmentLoader.prototype.newPointAttachment = function(skin, name) {
                return new core.PointAttachment(name)
            };
            AtlasAttachmentLoader.prototype.newClippingAttachment = function(skin, name) {
                return new core.ClippingAttachment(name)
            };
            return AtlasAttachmentLoader
        }();
        core.AtlasAttachmentLoader = AtlasAttachmentLoader
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var BlendMode;
        (function(BlendMode) {
            BlendMode[BlendMode["Normal"] = 0] = "Normal";
            BlendMode[BlendMode["Additive"] = 1] = "Additive";
            BlendMode[BlendMode["Multiply"] = 2] = "Multiply";
            BlendMode[BlendMode["Screen"] = 3] = "Screen"
        })(BlendMode = core.BlendMode || (core.BlendMode = {}))
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Bone = function() {
            function Bone(data, skeleton, parent) {
                this.matrix = new PIXI.Matrix;
                this.children = new Array;
                this.x = 0;
                this.y = 0;
                this.rotation = 0;
                this.scaleX = 0;
                this.scaleY = 0;
                this.shearX = 0;
                this.shearY = 0;
                this.ax = 0;
                this.ay = 0;
                this.arotation = 0;
                this.ascaleX = 0;
                this.ascaleY = 0;
                this.ashearX = 0;
                this.ashearY = 0;
                this.appliedValid = false;
                this.sorted = false;
                if (data == null) throw new Error("data cannot be null.");
                if (skeleton == null) throw new Error("skeleton cannot be null.");
                this.data = data;
                this.skeleton = skeleton;
                this.parent = parent;
                this.setToSetupPose()
            }
            Object.defineProperty(Bone.prototype, "worldX", {
                get: function() {
                    return this.matrix.tx
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Bone.prototype, "worldY", {
                get: function() {
                    return this.matrix.ty
                },
                enumerable: true,
                configurable: true
            });
            Bone.prototype.update = function() {
                this.updateWorldTransformWith(this.x, this.y, this.rotation, this.scaleX, this.scaleY, this.shearX, this.shearY)
            };
            Bone.prototype.updateWorldTransform = function() {
                this.updateWorldTransformWith(this.x, this.y, this.rotation, this.scaleX, this.scaleY, this.shearX, this.shearY)
            };
            Bone.prototype.updateWorldTransformWith = function(x, y, rotation, scaleX, scaleY, shearX, shearY) {
                this.ax = x;
                this.ay = y;
                this.arotation = rotation;
                this.ascaleX = scaleX;
                this.ascaleY = scaleY;
                this.ashearX = shearX;
                this.ashearY = shearY;
                this.appliedValid = true;
                var parent = this.parent;
                var m = this.matrix;
                if (parent == null) {
                    var rotationY = rotation + 90 + shearY;
                    var la = core.MathUtils.cosDeg(rotation + shearX) * scaleX;
                    var lb = core.MathUtils.cosDeg(rotationY) * scaleY;
                    var lc = core.MathUtils.sinDeg(rotation + shearX) * scaleX;
                    var ld = core.MathUtils.sinDeg(rotationY) * scaleY;
                    var skeleton = this.skeleton;
                    if (skeleton.flipX) {
                        x = -x;
                        la = -la;
                        lb = -lb
                    }
                    if (skeleton.flipY !== Bone.yDown) {
                        y = -y;
                        lc = -lc;
                        ld = -ld
                    }
                    m.a = la;
                    m.c = lb;
                    m.b = lc;
                    m.d = ld;
                    m.tx = x + skeleton.x;
                    m.ty = y + skeleton.y;
                    return
                }
                var pa = parent.matrix.a,
                    pb = parent.matrix.c,
                    pc = parent.matrix.b,
                    pd = parent.matrix.d;
                m.tx = pa * x + pb * y + parent.matrix.tx;
                m.ty = pc * x + pd * y + parent.matrix.ty;
                switch (this.data.transformMode) {
                    case core.TransformMode.Normal: {
                        var rotationY = rotation + 90 + shearY;
                        var la = core.MathUtils.cosDeg(rotation + shearX) * scaleX;
                        var lb = core.MathUtils.cosDeg(rotationY) * scaleY;
                        var lc = core.MathUtils.sinDeg(rotation + shearX) * scaleX;
                        var ld = core.MathUtils.sinDeg(rotationY) * scaleY;
                        m.a = pa * la + pb * lc;
                        m.c = pa * lb + pb * ld;
                        m.b = pc * la + pd * lc;
                        m.d = pc * lb + pd * ld;
                        return
                    }
                    case core.TransformMode.OnlyTranslation: {
                        var rotationY = rotation + 90 + shearY;
                        m.a = core.MathUtils.cosDeg(rotation + shearX) * scaleX;
                        m.c = core.MathUtils.cosDeg(rotationY) * scaleY;
                        m.b = core.MathUtils.sinDeg(rotation + shearX) * scaleX;
                        m.d = core.MathUtils.sinDeg(rotationY) * scaleY;
                        break
                    }
                    case core.TransformMode.NoRotationOrReflection: {
                        var s = pa * pa + pc * pc;
                        var prx = 0;
                        if (s > 1e-4) {
                            s = Math.abs(pa * pd - pb * pc) / s;
                            pb = pc * s;
                            pd = pa * s;
                            prx = Math.atan2(pc, pa) * core.MathUtils.radDeg
                        } else {
                            pa = 0;
                            pc = 0;
                            prx = 90 - Math.atan2(pd, pb) * core.MathUtils.radDeg
                        }
                        var rx = rotation + shearX - prx;
                        var ry = rotation + shearY - prx + 90;
                        var la = core.MathUtils.cosDeg(rx) * scaleX;
                        var lb = core.MathUtils.cosDeg(ry) * scaleY;
                        var lc = core.MathUtils.sinDeg(rx) * scaleX;
                        var ld = core.MathUtils.sinDeg(ry) * scaleY;
                        m.a = pa * la - pb * lc;
                        m.c = pa * lb - pb * ld;
                        m.b = pc * la + pd * lc;
                        m.d = pc * lb + pd * ld;
                        break
                    }
                    case core.TransformMode.NoScale:
                    case core.TransformMode.NoScaleOrReflection: {
                        var cos = core.MathUtils.cosDeg(rotation);
                        var sin = core.MathUtils.sinDeg(rotation);
                        var za = pa * cos + pb * sin;
                        var zc = pc * cos + pd * sin;
                        var s = Math.sqrt(za * za + zc * zc);
                        if (s > 1e-5) s = 1 / s;
                        za *= s;
                        zc *= s;
                        s = Math.sqrt(za * za + zc * zc);
                        var r = Math.PI / 2 + Math.atan2(zc, za);
                        var zb = Math.cos(r) * s;
                        var zd = Math.sin(r) * s;
                        var la = core.MathUtils.cosDeg(shearX) * scaleX;
                        var lb = core.MathUtils.cosDeg(90 + shearY) * scaleY;
                        var lc = core.MathUtils.sinDeg(shearX) * scaleX;
                        var ld = core.MathUtils.sinDeg(90 + shearY) * scaleY;
                        m.a = za * la + zb * lc;
                        m.c = za * lb + zb * ld;
                        m.b = zc * la + zd * lc;
                        m.d = zc * lb + zd * ld;
                        if (this.data.transformMode != core.TransformMode.NoScaleOrReflection ? pa * pd - pb * pc < 0 : this.skeleton.flipX != this.skeleton.flipY != Bone.yDown) {
                            m.c = -m.c;
                            m.d = -m.d
                        }
                        return
                    }
                }
                if (this.skeleton.flipX) {
                    m.a = -m.a;
                    m.c = -m.c
                }
                if (this.skeleton.flipY != Bone.yDown) {
                    m.b = -m.b;
                    m.d = -m.d
                }
            };
            Bone.prototype.setToSetupPose = function() {
                var data = this.data;
                this.x = data.x;
                this.y = data.y;
                this.rotation = data.rotation;
                this.scaleX = data.scaleX;
                this.scaleY = data.scaleY;
                this.shearX = data.shearX;
                this.shearY = data.shearY
            };
            Bone.prototype.getWorldRotationX = function() {
                return Math.atan2(this.matrix.b, this.matrix.a) * core.MathUtils.radDeg
            };
            Bone.prototype.getWorldRotationY = function() {
                return Math.atan2(this.matrix.d, this.matrix.c) * core.MathUtils.radDeg
            };
            Bone.prototype.getWorldScaleX = function() {
                var m = this.matrix;
                return Math.sqrt(m.a * m.a + m.c * m.c)
            };
            Bone.prototype.getWorldScaleY = function() {
                var m = this.matrix;
                return Math.sqrt(m.b * m.b + m.d * m.d)
            };
            Bone.prototype.updateAppliedTransform = function() {
                this.appliedValid = true;
                var parent = this.parent;
                var m = this.matrix;
                if (parent == null) {
                    this.ax = m.tx;
                    this.ay = m.ty;
                    this.arotation = Math.atan2(m.b, m.a) * core.MathUtils.radDeg;
                    this.ascaleX = Math.sqrt(m.a * m.a + m.b * m.b);
                    this.ascaleY = Math.sqrt(m.c * m.c + m.d * m.d);
                    this.ashearX = 0;
                    this.ashearY = Math.atan2(m.a * m.c + m.b * m.d, m.a * m.d - m.b * m.c) * core.MathUtils.radDeg;
                    return
                }
                var pm = parent.matrix;
                var pid = 1 / (pm.a * pm.d - pm.b * pm.c);
                var dx = m.tx - pm.tx,
                    dy = m.ty - pm.ty;
                this.ax = dx * pm.d * pid - dy * pm.c * pid;
                this.ay = dy * pm.a * pid - dx * pm.b * pid;
                var ia = pid * pm.d;
                var id = pid * pm.a;
                var ib = pid * pm.c;
                var ic = pid * pm.b;
                var ra = ia * m.a - ib * m.b;
                var rb = ia * m.c - ib * m.d;
                var rc = id * m.b - ic * m.a;
                var rd = id * m.d - ic * m.c;
                this.ashearX = 0;
                this.ascaleX = Math.sqrt(ra * ra + rc * rc);
                if (this.ascaleX > 1e-4) {
                    var det = ra * rd - rb * rc;
                    this.ascaleY = det / this.ascaleX;
                    this.ashearY = Math.atan2(ra * rb + rc * rd, det) * core.MathUtils.radDeg;
                    this.arotation = Math.atan2(rc, ra) * core.MathUtils.radDeg
                } else {
                    this.ascaleX = 0;
                    this.ascaleY = Math.sqrt(rb * rb + rd * rd);
                    this.ashearY = 0;
                    this.arotation = 90 - Math.atan2(rd, rb) * core.MathUtils.radDeg
                }
            };
            Bone.prototype.worldToLocal = function(world) {
                var m = this.matrix;
                var a = m.a,
                    b = m.c,
                    c = m.b,
                    d = m.d;
                var invDet = 1 / (a * d - b * c);
                var x = world.x - m.tx,
                    y = world.y - m.ty;
                world.x = x * d * invDet - y * b * invDet;
                world.y = y * a * invDet - x * c * invDet;
                return world
            };
            Bone.prototype.localToWorld = function(local) {
                var m = this.matrix;
                var x = local.x,
                    y = local.y;
                local.x = x * m.a + y * m.c + m.tx;
                local.y = x * m.b + y * m.d + m.ty;
                return local
            };
            Bone.prototype.worldToLocalRotation = function(worldRotation) {
                var sin = core.MathUtils.sinDeg(worldRotation),
                    cos = core.MathUtils.cosDeg(worldRotation);
                var mat = this.matrix;
                return Math.atan2(mat.a * sin - mat.b * cos, mat.d * cos - mat.c * sin) * core.MathUtils.radDeg
            };
            Bone.prototype.localToWorldRotation = function(localRotation) {
                var sin = core.MathUtils.sinDeg(localRotation),
                    cos = core.MathUtils.cosDeg(localRotation);
                var mat = this.matrix;
                return Math.atan2(cos * mat.b + sin * mat.d, cos * mat.a + sin * mat.c) * core.MathUtils.radDeg
            };
            Bone.prototype.rotateWorld = function(degrees) {
                var mat = this.matrix;
                var a = mat.a,
                    b = mat.c,
                    c = mat.b,
                    d = mat.d;
                var cos = core.MathUtils.cosDeg(degrees),
                    sin = core.MathUtils.sinDeg(degrees);
                mat.a = cos * a - sin * c;
                mat.c = cos * b - sin * d;
                mat.b = sin * a + cos * c;
                mat.d = sin * b + cos * d;
                this.appliedValid = false
            };
            Bone.yDown = false;
            return Bone
        }();
        core.Bone = Bone
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var BoneData = function() {
            function BoneData(index, name, parent) {
                this.x = 0;
                this.y = 0;
                this.rotation = 0;
                this.scaleX = 1;
                this.scaleY = 1;
                this.shearX = 0;
                this.shearY = 0;
                this.transformMode = TransformMode.Normal;
                if (index < 0) throw new Error("index must be >= 0.");
                if (name == null) throw new Error("name cannot be null.");
                this.index = index;
                this.name = name;
                this.parent = parent
            }
            return BoneData
        }();
        core.BoneData = BoneData;
        var TransformMode;
        (function(TransformMode) {
            TransformMode[TransformMode["Normal"] = 0] = "Normal";
            TransformMode[TransformMode["OnlyTranslation"] = 1] = "OnlyTranslation";
            TransformMode[TransformMode["NoRotationOrReflection"] = 2] = "NoRotationOrReflection";
            TransformMode[TransformMode["NoScale"] = 3] = "NoScale";
            TransformMode[TransformMode["NoScaleOrReflection"] = 4] = "NoScaleOrReflection"
        })(TransformMode = core.TransformMode || (core.TransformMode = {}))
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Event = function() {
            function Event(time, data) {
                if (data == null) throw new Error("data cannot be null.");
                this.time = time;
                this.data = data
            }
            return Event
        }();
        core.Event = Event
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var EventData = function() {
            function EventData(name) {
                this.name = name
            }
            return EventData
        }();
        core.EventData = EventData
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var IkConstraint = function() {
            function IkConstraint(data, skeleton) {
                this.mix = 1;
                this.bendDirection = 0;
                if (data == null) throw new Error("data cannot be null.");
                if (skeleton == null) throw new Error("skeleton cannot be null.");
                this.data = data;
                this.mix = data.mix;
                this.bendDirection = data.bendDirection;
                this.bones = new Array;
                for (var i = 0; i < data.bones.length; i++) this.bones.push(skeleton.findBone(data.bones[i].name));
                this.target = skeleton.findBone(data.target.name)
            }
            IkConstraint.prototype.getOrder = function() {
                return this.data.order
            };
            IkConstraint.prototype.apply = function() {
                this.update()
            };
            IkConstraint.prototype.update = function() {
                var target = this.target;
                var bones = this.bones;
                switch (bones.length) {
                    case 1:
                        this.apply1(bones[0], target.worldX, target.worldY, this.mix);
                        break;
                    case 2:
                        this.apply2(bones[0], bones[1], target.worldX, target.worldY, this.bendDirection, this.mix);
                        break
                }
            };
            IkConstraint.prototype.apply1 = function(bone, targetX, targetY, alpha) {
                if (!bone.appliedValid) bone.updateAppliedTransform();
                var p = bone.parent.matrix;
                var id = 1 / (p.a * p.d - p.b * p.c);
                var x = targetX - p.tx,
                    y = targetY - p.ty;
                var tx = (x * p.d - y * p.c) * id - bone.ax,
                    ty = (y * p.a - x * p.b) * id - bone.ay;
                var rotationIK = Math.atan2(ty, tx) * core.MathUtils.radDeg - bone.ashearX - bone.arotation;
                if (bone.ascaleX < 0) rotationIK += 180;
                if (rotationIK > 180) rotationIK -= 360;
                else if (rotationIK < -180) rotationIK += 360;
                bone.updateWorldTransformWith(bone.ax, bone.ay, bone.arotation + rotationIK * alpha, bone.ascaleX, bone.ascaleY, bone.ashearX, bone.ashearY)
            };
            IkConstraint.prototype.apply2 = function(parent, child, targetX, targetY, bendDir, alpha) {
                if (alpha == 0) {
                    child.updateWorldTransform();
                    return
                }
                if (!parent.appliedValid) parent.updateAppliedTransform();
                if (!child.appliedValid) child.updateAppliedTransform();
                var px = parent.ax,
                    py = parent.ay,
                    psx = parent.ascaleX,
                    psy = parent.ascaleY,
                    csx = child.ascaleX;
                var pmat = parent.matrix;
                var os1 = 0,
                    os2 = 0,
                    s2 = 0;
                if (psx < 0) {
                    psx = -psx;
                    os1 = 180;
                    s2 = -1
                } else {
                    os1 = 0;
                    s2 = 1
                }
                if (psy < 0) {
                    psy = -psy;
                    s2 = -s2
                }
                if (csx < 0) {
                    csx = -csx;
                    os2 = 180
                } else os2 = 0;
                var cx = child.ax,
                    cy = 0,
                    cwx = 0,
                    cwy = 0,
                    a = pmat.a,
                    b = pmat.c,
                    c = pmat.b,
                    d = pmat.d;
                var u = Math.abs(psx - psy) <= 1e-4;
                if (!u) {
                    cy = 0;
                    cwx = a * cx + pmat.tx;
                    cwy = c * cx + pmat.ty
                } else {
                    cy = child.ay;
                    cwx = a * cx + b * cy + pmat.tx;
                    cwy = c * cx + d * cy + pmat.ty
                }
                var pp = parent.parent.matrix;
                a = pp.a;
                b = pp.c;
                c = pp.b;
                d = pp.d;
                var id = 1 / (a * d - b * c),
                    x = targetX - pp.tx,
                    y = targetY - pp.ty;
                var tx = (x * d - y * b) * id - px,
                    ty = (y * a - x * c) * id - py;
                x = cwx - pp.tx;
                y = cwy - pp.ty;
                var dx = (x * d - y * b) * id - px,
                    dy = (y * a - x * c) * id - py;
                var l1 = Math.sqrt(dx * dx + dy * dy),
                    l2 = child.data.length * csx,
                    a1 = 0,
                    a2 = 0;
                outer: if (u) {
                    l2 *= psx;
                    var cos = (tx * tx + ty * ty - l1 * l1 - l2 * l2) / (2 * l1 * l2);
                    if (cos < -1) cos = -1;
                    else if (cos > 1) cos = 1;
                    a2 = Math.acos(cos) * bendDir;
                    a = l1 + l2 * cos;
                    b = l2 * Math.sin(a2);
                    a1 = Math.atan2(ty * a - tx * b, tx * a + ty * b)
                } else {
                    a = psx * l2;
                    b = psy * l2;
                    var aa = a * a,
                        bb = b * b,
                        dd = tx * tx + ty * ty,
                        ta = Math.atan2(ty, tx);
                    c = bb * l1 * l1 + aa * dd - aa * bb;
                    var c1 = -2 * bb * l1,
                        c2 = bb - aa;
                    d = c1 * c1 - 4 * c2 * c;
                    if (d >= 0) {
                        var q = Math.sqrt(d);
                        if (c1 < 0) q = -q;
                        q = -(c1 + q) / 2;
                        var r0 = q / c2,
                            r1 = c / q;
                        var r = Math.abs(r0) < Math.abs(r1) ? r0 : r1;
                        if (r * r <= dd) {
                            y = Math.sqrt(dd - r * r) * bendDir;
                            a1 = ta - Math.atan2(y, r);
                            a2 = Math.atan2(y / psy, (r - l1) / psx);
                            break outer
                        }
                    }
                    var minAngle = core.MathUtils.PI,
                        minX = l1 - a,
                        minDist = minX * minX,
                        minY = 0;
                    var maxAngle = 0,
                        maxX = l1 + a,
                        maxDist = maxX * maxX,
                        maxY = 0;
                    c = -a * l1 / (aa - bb);
                    if (c >= -1 && c <= 1) {
                        c = Math.acos(c);
                        x = a * Math.cos(c) + l1;
                        y = b * Math.sin(c);
                        d = x * x + y * y;
                        if (d < minDist) {
                            minAngle = c;
                            minDist = d;
                            minX = x;
                            minY = y
                        }
                        if (d > maxDist) {
                            maxAngle = c;
                            maxDist = d;
                            maxX = x;
                            maxY = y
                        }
                    }
                    if (dd <= (minDist + maxDist) / 2) {
                        a1 = ta - Math.atan2(minY * bendDir, minX);
                        a2 = minAngle * bendDir
                    } else {
                        a1 = ta - Math.atan2(maxY * bendDir, maxX);
                        a2 = maxAngle * bendDir
                    }
                }
                var os = Math.atan2(cy, cx) * s2;
                var rotation = parent.arotation;
                a1 = (a1 - os) * core.MathUtils.radDeg + os1 - rotation;
                if (a1 > 180) a1 -= 360;
                else if (a1 < -180) a1 += 360;
                parent.updateWorldTransformWith(px, py, rotation + a1 * alpha, parent.ascaleX, parent.ascaleY, 0, 0);
                rotation = child.arotation;
                a2 = ((a2 + os) * core.MathUtils.radDeg - child.ashearX) * s2 + os2 - rotation;
                if (a2 > 180) a2 -= 360;
                else if (a2 < -180) a2 += 360;
                child.updateWorldTransformWith(cx, cy, rotation + a2 * alpha, child.ascaleX, child.ascaleY, child.ashearX, child.ashearY)
            };
            return IkConstraint
        }();
        core.IkConstraint = IkConstraint
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var IkConstraintData = function() {
            function IkConstraintData(name) {
                this.order = 0;
                this.bones = new Array;
                this.bendDirection = 1;
                this.mix = 1;
                this.name = name
            }
            return IkConstraintData
        }();
        core.IkConstraintData = IkConstraintData
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var PathConstraint = function() {
            function PathConstraint(data, skeleton) {
                this.position = 0;
                this.spacing = 0;
                this.rotateMix = 0;
                this.translateMix = 0;
                this.spaces = new Array;
                this.positions = new Array;
                this.world = new Array;
                this.curves = new Array;
                this.lengths = new Array;
                this.segments = new Array;
                if (data == null) throw new Error("data cannot be null.");
                if (skeleton == null) throw new Error("skeleton cannot be null.");
                this.data = data;
                this.bones = new Array;
                for (var i = 0, n = data.bones.length; i < n; i++) this.bones.push(skeleton.findBone(data.bones[i].name));
                this.target = skeleton.findSlot(data.target.name);
                this.position = data.position;
                this.spacing = data.spacing;
                this.rotateMix = data.rotateMix;
                this.translateMix = data.translateMix
            }
            PathConstraint.prototype.apply = function() {
                this.update()
            };
            PathConstraint.prototype.update = function() {
                var attachment = this.target.getAttachment();
                if (!(attachment instanceof core.PathAttachment)) return;
                var rotateMix = this.rotateMix,
                    translateMix = this.translateMix;
                var translate = translateMix > 0,
                    rotate = rotateMix > 0;
                if (!translate && !rotate) return;
                var data = this.data;
                var spacingMode = data.spacingMode;
                var lengthSpacing = spacingMode == core.SpacingMode.Length;
                var rotateMode = data.rotateMode;
                var tangents = rotateMode == core.RotateMode.Tangent,
                    scale = rotateMode == core.RotateMode.ChainScale;
                var boneCount = this.bones.length,
                    spacesCount = tangents ? boneCount : boneCount + 1;
                var bones = this.bones;
                var spaces = core.Utils.setArraySize(this.spaces, spacesCount),
                    lengths = null;
                var spacing = this.spacing;
                if (scale || lengthSpacing) {
                    if (scale) lengths = core.Utils.setArraySize(this.lengths, boneCount);
                    for (var i = 0, n = spacesCount - 1; i < n;) {
                        var bone = bones[i];
                        var setupLength = bone.data.length,
                            x = setupLength * bone.matrix.a,
                            y = setupLength * bone.matrix.b;
                        var length_1 = Math.sqrt(x * x + y * y);
                        if (scale) lengths[i] = length_1;
                        spaces[++i] = (lengthSpacing ? setupLength + spacing : spacing) * length_1 / setupLength
                    }
                } else {
                    for (var i = 1; i < spacesCount; i++) spaces[i] = spacing
                }
                var positions = this.computeWorldPositions(attachment, spacesCount, tangents, data.positionMode == core.PositionMode.Percent, spacingMode == core.SpacingMode.Percent);
                var boneX = positions[0],
                    boneY = positions[1],
                    offsetRotation = data.offsetRotation;
                var tip = false;
                if (offsetRotation == 0) tip = rotateMode == core.RotateMode.Chain;
                else {
                    tip = false;
                    var p = this.target.bone.matrix;
                    offsetRotation *= p.a * p.d - p.b * p.c > 0 ? core.MathUtils.degRad : -core.MathUtils.degRad
                }
                for (var i = 0, p = 3; i < boneCount; i++, p += 3) {
                    var bone = bones[i];
                    var mat = bone.matrix;
                    mat.tx += (boneX - mat.tx) * translateMix;
                    mat.ty += (boneY - mat.ty) * translateMix;
                    var x = positions[p],
                        y = positions[p + 1],
                        dx = x - boneX,
                        dy = y - boneY;
                    if (scale) {
                        var length_2 = lengths[i];
                        if (length_2 != 0) {
                            var s = (Math.sqrt(dx * dx + dy * dy) / length_2 - 1) * rotateMix + 1;
                            mat.a *= s;
                            mat.b *= s
                        }
                    }
                    boneX = x;
                    boneY = y;
                    if (rotate) {
                        var a = mat.a,
                            b = mat.c,
                            c = mat.b,
                            d = mat.d,
                            r = 0,
                            cos = 0,
                            sin = 0;
                        if (tangents) r = positions[p - 1];
                        else if (spaces[i + 1] == 0) r = positions[p + 2];
                        else r = Math.atan2(dy, dx);
                        r -= Math.atan2(c, a);
                        if (tip) {
                            cos = Math.cos(r);
                            sin = Math.sin(r);
                            var length_3 = bone.data.length;
                            boneX += (length_3 * (cos * a - sin * c) - dx) * rotateMix;
                            boneY += (length_3 * (sin * a + cos * c) - dy) * rotateMix
                        } else {
                            r += offsetRotation
                        }
                        if (r > core.MathUtils.PI) r -= core.MathUtils.PI2;
                        else if (r < -core.MathUtils.PI) r += core.MathUtils.PI2;
                        r *= rotateMix;
                        cos = Math.cos(r);
                        sin = Math.sin(r);
                        mat.a = cos * a - sin * c;
                        mat.c = cos * b - sin * d;
                        mat.b = sin * a + cos * c;
                        mat.d = sin * b + cos * d
                    }
                    bone.appliedValid = false
                }
            };
            PathConstraint.prototype.computeWorldPositions = function(path, spacesCount, tangents, percentPosition, percentSpacing) {
                var target = this.target;
                var position = this.position;
                var spaces = this.spaces,
                    out = core.Utils.setArraySize(this.positions, spacesCount * 3 + 2),
                    world = null;
                var closed = path.closed;
                var verticesLength = path.worldVerticesLength,
                    curveCount = verticesLength / 6,
                    prevCurve = PathConstraint.NONE;
                if (!path.constantSpeed) {
                    var lengths = path.lengths;
                    curveCount -= closed ? 1 : 2;
                    var pathLength_1 = lengths[curveCount];
                    if (percentPosition) position *= pathLength_1;
                    if (percentSpacing) {
                        for (var i = 0; i < spacesCount; i++) spaces[i] *= pathLength_1
                    }
                    world = core.Utils.setArraySize(this.world, 8);
                    for (var i = 0, o = 0, curve = 0; i < spacesCount; i++, o += 3) {
                        var space = spaces[i];
                        position += space;
                        var p = position;
                        if (closed) {
                            p %= pathLength_1;
                            if (p < 0) p += pathLength_1;
                            curve = 0
                        } else if (p < 0) {
                            if (prevCurve != PathConstraint.BEFORE) {
                                prevCurve = PathConstraint.BEFORE;
                                path.computeWorldVertices(target, 2, 4, world, 0, 2)
                            }
                            this.addBeforePosition(p, world, 0, out, o);
                            continue
                        } else if (p > pathLength_1) {
                            if (prevCurve != PathConstraint.AFTER) {
                                prevCurve = PathConstraint.AFTER;
                                path.computeWorldVertices(target, verticesLength - 6, 4, world, 0, 2)
                            }
                            this.addAfterPosition(p - pathLength_1, world, 0, out, o);
                            continue
                        }
                        for (;; curve++) {
                            var length_4 = lengths[curve];
                            if (p > length_4) continue;
                            if (curve == 0) p /= length_4;
                            else {
                                var prev = lengths[curve - 1];
                                p = (p - prev) / (length_4 - prev)
                            }
                            break
                        }
                        if (curve != prevCurve) {
                            prevCurve = curve;
                            if (closed && curve == curveCount) {
                                path.computeWorldVertices(target, verticesLength - 4, 4, world, 0, 2);
                                path.computeWorldVertices(target, 0, 4, world, 4, 2)
                            } else path.computeWorldVertices(target, curve * 6 + 2, 8, world, 0, 2)
                        }
                        this.addCurvePosition(p, world[0], world[1], world[2], world[3], world[4], world[5], world[6], world[7], out, o, tangents || i > 0 && space == 0)
                    }
                    return out
                }
                if (closed) {
                    verticesLength += 2;
                    world = core.Utils.setArraySize(this.world, verticesLength);
                    path.computeWorldVertices(target, 2, verticesLength - 4, world, 0, 2);
                    path.computeWorldVertices(target, 0, 2, world, verticesLength - 4, 2);
                    world[verticesLength - 2] = world[0];
                    world[verticesLength - 1] = world[1]
                } else {
                    curveCount--;
                    verticesLength -= 4;
                    world = core.Utils.setArraySize(this.world, verticesLength);
                    path.computeWorldVertices(target, 2, verticesLength, world, 0, 2)
                }
                var curves = core.Utils.setArraySize(this.curves, curveCount);
                var pathLength = 0;
                var x1 = world[0],
                    y1 = world[1],
                    cx1 = 0,
                    cy1 = 0,
                    cx2 = 0,
                    cy2 = 0,
                    x2 = 0,
                    y2 = 0;
                var tmpx = 0,
                    tmpy = 0,
                    dddfx = 0,
                    dddfy = 0,
                    ddfx = 0,
                    ddfy = 0,
                    dfx = 0,
                    dfy = 0;
                for (var i = 0, w = 2; i < curveCount; i++, w += 6) {
                    cx1 = world[w];
                    cy1 = world[w + 1];
                    cx2 = world[w + 2];
                    cy2 = world[w + 3];
                    x2 = world[w + 4];
                    y2 = world[w + 5];
                    tmpx = (x1 - cx1 * 2 + cx2) * .1875;
                    tmpy = (y1 - cy1 * 2 + cy2) * .1875;
                    dddfx = ((cx1 - cx2) * 3 - x1 + x2) * .09375;
                    dddfy = ((cy1 - cy2) * 3 - y1 + y2) * .09375;
                    ddfx = tmpx * 2 + dddfx;
                    ddfy = tmpy * 2 + dddfy;
                    dfx = (cx1 - x1) * .75 + tmpx + dddfx * .16666667;
                    dfy = (cy1 - y1) * .75 + tmpy + dddfy * .16666667;
                    pathLength += Math.sqrt(dfx * dfx + dfy * dfy);
                    dfx += ddfx;
                    dfy += ddfy;
                    ddfx += dddfx;
                    ddfy += dddfy;
                    pathLength += Math.sqrt(dfx * dfx + dfy * dfy);
                    dfx += ddfx;
                    dfy += ddfy;
                    pathLength += Math.sqrt(dfx * dfx + dfy * dfy);
                    dfx += ddfx + dddfx;
                    dfy += ddfy + dddfy;
                    pathLength += Math.sqrt(dfx * dfx + dfy * dfy);
                    curves[i] = pathLength;
                    x1 = x2;
                    y1 = y2
                }
                if (percentPosition) position *= pathLength;
                if (percentSpacing) {
                    for (var i = 0; i < spacesCount; i++) spaces[i] *= pathLength
                }
                var segments = this.segments;
                var curveLength = 0;
                for (var i = 0, o = 0, curve = 0, segment = 0; i < spacesCount; i++, o += 3) {
                    var space = spaces[i];
                    position += space;
                    var p = position;
                    if (closed) {
                        p %= pathLength;
                        if (p < 0) p += pathLength;
                        curve = 0
                    } else if (p < 0) {
                        this.addBeforePosition(p, world, 0, out, o);
                        continue
                    } else if (p > pathLength) {
                        this.addAfterPosition(p - pathLength, world, verticesLength - 4, out, o);
                        continue
                    }
                    for (;; curve++) {
                        var length_5 = curves[curve];
                        if (p > length_5) continue;
                        if (curve == 0) p /= length_5;
                        else {
                            var prev = curves[curve - 1];
                            p = (p - prev) / (length_5 - prev)
                        }
                        break
                    }
                    if (curve != prevCurve) {
                        prevCurve = curve;
                        var ii = curve * 6;
                        x1 = world[ii];
                        y1 = world[ii + 1];
                        cx1 = world[ii + 2];
                        cy1 = world[ii + 3];
                        cx2 = world[ii + 4];
                        cy2 = world[ii + 5];
                        x2 = world[ii + 6];
                        y2 = world[ii + 7];
                        tmpx = (x1 - cx1 * 2 + cx2) * .03;
                        tmpy = (y1 - cy1 * 2 + cy2) * .03;
                        dddfx = ((cx1 - cx2) * 3 - x1 + x2) * .006;
                        dddfy = ((cy1 - cy2) * 3 - y1 + y2) * .006;
                        ddfx = tmpx * 2 + dddfx;
                        ddfy = tmpy * 2 + dddfy;
                        dfx = (cx1 - x1) * .3 + tmpx + dddfx * .16666667;
                        dfy = (cy1 - y1) * .3 + tmpy + dddfy * .16666667;
                        curveLength = Math.sqrt(dfx * dfx + dfy * dfy);
                        segments[0] = curveLength;
                        for (ii = 1; ii < 8; ii++) {
                            dfx += ddfx;
                            dfy += ddfy;
                            ddfx += dddfx;
                            ddfy += dddfy;
                            curveLength += Math.sqrt(dfx * dfx + dfy * dfy);
                            segments[ii] = curveLength
                        }
                        dfx += ddfx;
                        dfy += ddfy;
                        curveLength += Math.sqrt(dfx * dfx + dfy * dfy);
                        segments[8] = curveLength;
                        dfx += ddfx + dddfx;
                        dfy += ddfy + dddfy;
                        curveLength += Math.sqrt(dfx * dfx + dfy * dfy);
                        segments[9] = curveLength;
                        segment = 0
                    }
                    p *= curveLength;
                    for (;; segment++) {
                        var length_6 = segments[segment];
                        if (p > length_6) continue;
                        if (segment == 0) p /= length_6;
                        else {
                            var prev = segments[segment - 1];
                            p = segment + (p - prev) / (length_6 - prev)
                        }
                        break
                    }
                    this.addCurvePosition(p * .1, x1, y1, cx1, cy1, cx2, cy2, x2, y2, out, o, tangents || i > 0 && space == 0)
                }
                return out
            };
            PathConstraint.prototype.addBeforePosition = function(p, temp, i, out, o) {
                var x1 = temp[i],
                    y1 = temp[i + 1],
                    dx = temp[i + 2] - x1,
                    dy = temp[i + 3] - y1,
                    r = Math.atan2(dy, dx);
                out[o] = x1 + p * Math.cos(r);
                out[o + 1] = y1 + p * Math.sin(r);
                out[o + 2] = r
            };
            PathConstraint.prototype.addAfterPosition = function(p, temp, i, out, o) {
                var x1 = temp[i + 2],
                    y1 = temp[i + 3],
                    dx = x1 - temp[i],
                    dy = y1 - temp[i + 1],
                    r = Math.atan2(dy, dx);
                out[o] = x1 + p * Math.cos(r);
                out[o + 1] = y1 + p * Math.sin(r);
                out[o + 2] = r
            };
            PathConstraint.prototype.addCurvePosition = function(p, x1, y1, cx1, cy1, cx2, cy2, x2, y2, out, o, tangents) {
                if (p == 0 || isNaN(p)) p = 1e-4;
                var tt = p * p,
                    ttt = tt * p,
                    u = 1 - p,
                    uu = u * u,
                    uuu = uu * u;
                var ut = u * p,
                    ut3 = ut * 3,
                    uut3 = u * ut3,
                    utt3 = ut3 * p;
                var x = x1 * uuu + cx1 * uut3 + cx2 * utt3 + x2 * ttt,
                    y = y1 * uuu + cy1 * uut3 + cy2 * utt3 + y2 * ttt;
                out[o] = x;
                out[o + 1] = y;
                if (tangents) out[o + 2] = Math.atan2(y - (y1 * uu + cy1 * ut * 2 + cy2 * tt), x - (x1 * uu + cx1 * ut * 2 + cx2 * tt))
            };
            PathConstraint.prototype.getOrder = function() {
                return this.data.order
            };
            PathConstraint.NONE = -1;
            PathConstraint.BEFORE = -2;
            PathConstraint.AFTER = -3;
            return PathConstraint
        }();
        core.PathConstraint = PathConstraint
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var PathConstraintData = function() {
            function PathConstraintData(name) {
                this.order = 0;
                this.bones = new Array;
                this.name = name
            }
            return PathConstraintData
        }();
        core.PathConstraintData = PathConstraintData;
        var PositionMode;
        (function(PositionMode) {
            PositionMode[PositionMode["Fixed"] = 0] = "Fixed";
            PositionMode[PositionMode["Percent"] = 1] = "Percent"
        })(PositionMode = core.PositionMode || (core.PositionMode = {}));
        var SpacingMode;
        (function(SpacingMode) {
            SpacingMode[SpacingMode["Length"] = 0] = "Length";
            SpacingMode[SpacingMode["Fixed"] = 1] = "Fixed";
            SpacingMode[SpacingMode["Percent"] = 2] = "Percent"
        })(SpacingMode = core.SpacingMode || (core.SpacingMode = {}));
        var RotateMode;
        (function(RotateMode) {
            RotateMode[RotateMode["Tangent"] = 0] = "Tangent";
            RotateMode[RotateMode["Chain"] = 1] = "Chain";
            RotateMode[RotateMode["ChainScale"] = 2] = "ChainScale"
        })(RotateMode = core.RotateMode || (core.RotateMode = {}))
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Skeleton = function() {
            function Skeleton(data) {
                this._updateCache = new Array;
                this.updateCacheReset = new Array;
                this.time = 0;
                this.flipX = false;
                this.flipY = false;
                this.x = 0;
                this.y = 0;
                if (data == null) throw new Error("data cannot be null.");
                this.data = data;
                this.bones = new Array;
                for (var i = 0; i < data.bones.length; i++) {
                    var boneData = data.bones[i];
                    var bone = void 0;
                    if (boneData.parent == null) bone = new core.Bone(boneData, this, null);
                    else {
                        var parent_1 = this.bones[boneData.parent.index];
                        bone = new core.Bone(boneData, this, parent_1);
                        parent_1.children.push(bone)
                    }
                    this.bones.push(bone)
                }
                this.slots = new Array;
                this.drawOrder = new Array;
                for (var i = 0; i < data.slots.length; i++) {
                    var slotData = data.slots[i];
                    var bone = this.bones[slotData.boneData.index];
                    var slot = new core.Slot(slotData, bone);
                    this.slots.push(slot);
                    this.drawOrder.push(slot)
                }
                this.ikConstraints = new Array;
                for (var i = 0; i < data.ikConstraints.length; i++) {
                    var ikConstraintData = data.ikConstraints[i];
                    this.ikConstraints.push(new core.IkConstraint(ikConstraintData, this))
                }
                this.transformConstraints = new Array;
                for (var i = 0; i < data.transformConstraints.length; i++) {
                    var transformConstraintData = data.transformConstraints[i];
                    this.transformConstraints.push(new core.TransformConstraint(transformConstraintData, this))
                }
                this.pathConstraints = new Array;
                for (var i = 0; i < data.pathConstraints.length; i++) {
                    var pathConstraintData = data.pathConstraints[i];
                    this.pathConstraints.push(new core.PathConstraint(pathConstraintData, this))
                }
                this.color = new core.Color(1, 1, 1, 1);
                this.updateCache()
            }
            Skeleton.prototype.updateCache = function() {
                var updateCache = this._updateCache;
                updateCache.length = 0;
                this.updateCacheReset.length = 0;
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) bones[i].sorted = false;
                var ikConstraints = this.ikConstraints;
                var transformConstraints = this.transformConstraints;
                var pathConstraints = this.pathConstraints;
                var ikCount = ikConstraints.length,
                    transformCount = transformConstraints.length,
                    pathCount = pathConstraints.length;
                var constraintCount = ikCount + transformCount + pathCount;
                outer: for (var i = 0; i < constraintCount; i++) {
                    for (var ii = 0; ii < ikCount; ii++) {
                        var constraint = ikConstraints[ii];
                        if (constraint.data.order == i) {
                            this.sortIkConstraint(constraint);
                            continue outer
                        }
                    }
                    for (var ii = 0; ii < transformCount; ii++) {
                        var constraint = transformConstraints[ii];
                        if (constraint.data.order == i) {
                            this.sortTransformConstraint(constraint);
                            continue outer
                        }
                    }
                    for (var ii = 0; ii < pathCount; ii++) {
                        var constraint = pathConstraints[ii];
                        if (constraint.data.order == i) {
                            this.sortPathConstraint(constraint);
                            continue outer
                        }
                    }
                }
                for (var i = 0, n = bones.length; i < n; i++) this.sortBone(bones[i])
            };
            Skeleton.prototype.sortIkConstraint = function(constraint) {
                var target = constraint.target;
                this.sortBone(target);
                var constrained = constraint.bones;
                var parent = constrained[0];
                this.sortBone(parent);
                if (constrained.length > 1) {
                    var child = constrained[constrained.length - 1];
                    if (!(this._updateCache.indexOf(child) > -1)) this.updateCacheReset.push(child)
                }
                this._updateCache.push(constraint);
                this.sortReset(parent.children);
                constrained[constrained.length - 1].sorted = true
            };
            Skeleton.prototype.sortPathConstraint = function(constraint) {
                var slot = constraint.target;
                var slotIndex = slot.data.index;
                var slotBone = slot.bone;
                if (this.skin != null) this.sortPathConstraintAttachment(this.skin, slotIndex, slotBone);
                if (this.data.defaultSkin != null && this.data.defaultSkin != this.skin) this.sortPathConstraintAttachment(this.data.defaultSkin, slotIndex, slotBone);
                for (var i = 0, n = this.data.skins.length; i < n; i++) this.sortPathConstraintAttachment(this.data.skins[i], slotIndex, slotBone);
                var attachment = slot.getAttachment();
                if (attachment instanceof core.PathAttachment) this.sortPathConstraintAttachmentWith(attachment, slotBone);
                var constrained = constraint.bones;
                var boneCount = constrained.length;
                for (var i = 0; i < boneCount; i++) this.sortBone(constrained[i]);
                this._updateCache.push(constraint);
                for (var i = 0; i < boneCount; i++) this.sortReset(constrained[i].children);
                for (var i = 0; i < boneCount; i++) constrained[i].sorted = true
            };
            Skeleton.prototype.sortTransformConstraint = function(constraint) {
                this.sortBone(constraint.target);
                var constrained = constraint.bones;
                var boneCount = constrained.length;
                if (constraint.data.local) {
                    for (var i = 0; i < boneCount; i++) {
                        var child = constrained[i];
                        this.sortBone(child.parent);
                        if (!(this._updateCache.indexOf(child) > -1)) this.updateCacheReset.push(child)
                    }
                } else {
                    for (var i = 0; i < boneCount; i++) {
                        this.sortBone(constrained[i])
                    }
                }
                this._updateCache.push(constraint);
                for (var ii = 0; ii < boneCount; ii++) this.sortReset(constrained[ii].children);
                for (var ii = 0; ii < boneCount; ii++) constrained[ii].sorted = true
            };
            Skeleton.prototype.sortPathConstraintAttachment = function(skin, slotIndex, slotBone) {
                var attachments = skin.attachments[slotIndex];
                if (!attachments) return;
                for (var key in attachments) {
                    this.sortPathConstraintAttachmentWith(attachments[key], slotBone)
                }
            };
            Skeleton.prototype.sortPathConstraintAttachmentWith = function(attachment, slotBone) {
                if (!(attachment instanceof core.PathAttachment)) return;
                var pathBones = attachment.bones;
                if (pathBones == null) this.sortBone(slotBone);
                else {
                    var bones = this.bones;
                    var i = 0;
                    while (i < pathBones.length) {
                        var boneCount = pathBones[i++];
                        for (var n = i + boneCount; i < n; i++) {
                            var boneIndex = pathBones[i];
                            this.sortBone(bones[boneIndex])
                        }
                    }
                }
            };
            Skeleton.prototype.sortBone = function(bone) {
                if (bone.sorted) return;
                var parent = bone.parent;
                if (parent != null) this.sortBone(parent);
                bone.sorted = true;
                this._updateCache.push(bone)
            };
            Skeleton.prototype.sortReset = function(bones) {
                for (var i = 0, n = bones.length; i < n; i++) {
                    var bone = bones[i];
                    if (bone.sorted) this.sortReset(bone.children);
                    bone.sorted = false
                }
            };
            Skeleton.prototype.updateWorldTransform = function() {
                var updateCacheReset = this.updateCacheReset;
                for (var i = 0, n = updateCacheReset.length; i < n; i++) {
                    var bone = updateCacheReset[i];
                    bone.ax = bone.x;
                    bone.ay = bone.y;
                    bone.arotation = bone.rotation;
                    bone.ascaleX = bone.scaleX;
                    bone.ascaleY = bone.scaleY;
                    bone.ashearX = bone.shearX;
                    bone.ashearY = bone.shearY;
                    bone.appliedValid = true
                }
                var updateCache = this._updateCache;
                for (var i = 0, n = updateCache.length; i < n; i++) updateCache[i].update()
            };
            Skeleton.prototype.setToSetupPose = function() {
                this.setBonesToSetupPose();
                this.setSlotsToSetupPose()
            };
            Skeleton.prototype.setBonesToSetupPose = function() {
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) bones[i].setToSetupPose();
                var ikConstraints = this.ikConstraints;
                for (var i = 0, n = ikConstraints.length; i < n; i++) {
                    var constraint = ikConstraints[i];
                    constraint.bendDirection = constraint.data.bendDirection;
                    constraint.mix = constraint.data.mix
                }
                var transformConstraints = this.transformConstraints;
                for (var i = 0, n = transformConstraints.length; i < n; i++) {
                    var constraint = transformConstraints[i];
                    var data = constraint.data;
                    constraint.rotateMix = data.rotateMix;
                    constraint.translateMix = data.translateMix;
                    constraint.scaleMix = data.scaleMix;
                    constraint.shearMix = data.shearMix
                }
                var pathConstraints = this.pathConstraints;
                for (var i = 0, n = pathConstraints.length; i < n; i++) {
                    var constraint = pathConstraints[i];
                    var data = constraint.data;
                    constraint.position = data.position;
                    constraint.spacing = data.spacing;
                    constraint.rotateMix = data.rotateMix;
                    constraint.translateMix = data.translateMix
                }
            };
            Skeleton.prototype.setSlotsToSetupPose = function() {
                var slots = this.slots;
                core.Utils.arrayCopy(slots, 0, this.drawOrder, 0, slots.length);
                for (var i = 0, n = slots.length; i < n; i++) slots[i].setToSetupPose()
            };
            Skeleton.prototype.getRootBone = function() {
                if (this.bones.length == 0) return null;
                return this.bones[0]
            };
            Skeleton.prototype.findBone = function(boneName) {
                if (boneName == null) throw new Error("boneName cannot be null.");
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) {
                    var bone = bones[i];
                    if (bone.data.name == boneName) return bone
                }
                return null
            };
            Skeleton.prototype.findBoneIndex = function(boneName) {
                if (boneName == null) throw new Error("boneName cannot be null.");
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++)
                    if (bones[i].data.name == boneName) return i;
                return -1
            };
            Skeleton.prototype.findSlot = function(slotName) {
                if (slotName == null) throw new Error("slotName cannot be null.");
                var slots = this.slots;
                for (var i = 0, n = slots.length; i < n; i++) {
                    var slot = slots[i];
                    if (slot.data.name == slotName) return slot
                }
                return null
            };
            Skeleton.prototype.findSlotIndex = function(slotName) {
                if (slotName == null) throw new Error("slotName cannot be null.");
                var slots = this.slots;
                for (var i = 0, n = slots.length; i < n; i++)
                    if (slots[i].data.name == slotName) return i;
                return -1
            };
            Skeleton.prototype.setSkinByName = function(skinName) {
                var skin = this.data.findSkin(skinName);
                if (skin == null) throw new Error("Skin not found: " + skinName);
                this.setSkin(skin)
            };
            Skeleton.prototype.setSkin = function(newSkin) {
                if (newSkin != null) {
                    if (this.skin != null) newSkin.attachAll(this, this.skin);
                    else {
                        var slots = this.slots;
                        for (var i = 0, n = slots.length; i < n; i++) {
                            var slot = slots[i];
                            var name_1 = slot.data.attachmentName;
                            if (name_1 != null) {
                                var attachment = newSkin.getAttachment(i, name_1);
                                if (attachment != null) slot.setAttachment(attachment)
                            }
                        }
                    }
                }
                this.skin = newSkin
            };
            Skeleton.prototype.getAttachmentByName = function(slotName, attachmentName) {
                return this.getAttachment(this.data.findSlotIndex(slotName), attachmentName)
            };
            Skeleton.prototype.getAttachment = function(slotIndex, attachmentName) {
                if (attachmentName == null) throw new Error("attachmentName cannot be null.");
                if (this.skin != null) {
                    var attachment = this.skin.getAttachment(slotIndex, attachmentName);
                    if (attachment != null) return attachment
                }
                if (this.data.defaultSkin != null) return this.data.defaultSkin.getAttachment(slotIndex, attachmentName);
                return null
            };
            Skeleton.prototype.setAttachment = function(slotName, attachmentName) {
                if (slotName == null) throw new Error("slotName cannot be null.");
                var slots = this.slots;
                for (var i = 0, n = slots.length; i < n; i++) {
                    var slot = slots[i];
                    if (slot.data.name == slotName) {
                        var attachment = null;
                        if (attachmentName != null) {
                            attachment = this.getAttachment(i, attachmentName);
                            if (attachment == null) throw new Error("Attachment not found: " + attachmentName + ", for slot: " + slotName)
                        }
                        slot.setAttachment(attachment);
                        return
                    }
                }
                throw new Error("Slot not found: " + slotName)
            };
            Skeleton.prototype.findIkConstraint = function(constraintName) {
                if (constraintName == null) throw new Error("constraintName cannot be null.");
                var ikConstraints = this.ikConstraints;
                for (var i = 0, n = ikConstraints.length; i < n; i++) {
                    var ikConstraint = ikConstraints[i];
                    if (ikConstraint.data.name == constraintName) return ikConstraint
                }
                return null
            };
            Skeleton.prototype.findTransformConstraint = function(constraintName) {
                if (constraintName == null) throw new Error("constraintName cannot be null.");
                var transformConstraints = this.transformConstraints;
                for (var i = 0, n = transformConstraints.length; i < n; i++) {
                    var constraint = transformConstraints[i];
                    if (constraint.data.name == constraintName) return constraint
                }
                return null
            };
            Skeleton.prototype.findPathConstraint = function(constraintName) {
                if (constraintName == null) throw new Error("constraintName cannot be null.");
                var pathConstraints = this.pathConstraints;
                for (var i = 0, n = pathConstraints.length; i < n; i++) {
                    var constraint = pathConstraints[i];
                    if (constraint.data.name == constraintName) return constraint
                }
                return null
            };
            Skeleton.prototype.getBounds = function(offset, size, temp) {
                if (offset == null) throw new Error("offset cannot be null.");
                if (size == null) throw new Error("size cannot be null.");
                var drawOrder = this.drawOrder;
                var minX = Number.POSITIVE_INFINITY,
                    minY = Number.POSITIVE_INFINITY,
                    maxX = Number.NEGATIVE_INFINITY,
                    maxY = Number.NEGATIVE_INFINITY;
                for (var i = 0, n = drawOrder.length; i < n; i++) {
                    var slot = drawOrder[i];
                    var verticesLength = 0;
                    var vertices = null;
                    var attachment = slot.getAttachment();
                    if (attachment instanceof core.RegionAttachment) {
                        verticesLength = 8;
                        vertices = core.Utils.setArraySize(temp, verticesLength, 0);
                        attachment.computeWorldVertices(slot.bone, vertices, 0, 2)
                    } else if (attachment instanceof core.MeshAttachment) {
                        var mesh = attachment;
                        verticesLength = mesh.worldVerticesLength;
                        vertices = core.Utils.setArraySize(temp, verticesLength, 0);
                        mesh.computeWorldVertices(slot, 0, verticesLength, vertices, 0, 2)
                    }
                    if (vertices != null) {
                        for (var ii = 0, nn = vertices.length; ii < nn; ii += 2) {
                            var x = vertices[ii],
                                y = vertices[ii + 1];
                            minX = Math.min(minX, x);
                            minY = Math.min(minY, y);
                            maxX = Math.max(maxX, x);
                            maxY = Math.max(maxY, y)
                        }
                    }
                }
                offset.set(minX, minY);
                size.set(maxX - minX, maxY - minY)
            };
            Skeleton.prototype.update = function(delta) {
                this.time += delta
            };
            return Skeleton
        }();
        core.Skeleton = Skeleton
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var SkeletonBounds = function() {
            function SkeletonBounds() {
                this.minX = 0;
                this.minY = 0;
                this.maxX = 0;
                this.maxY = 0;
                this.boundingBoxes = new Array;
                this.polygons = new Array;
                this.polygonPool = new core.Pool(function() {
                    return core.Utils.newFloatArray(16)
                })
            }
            SkeletonBounds.prototype.update = function(skeleton, updateAabb) {
                if (skeleton == null) throw new Error("skeleton cannot be null.");
                var boundingBoxes = this.boundingBoxes;
                var polygons = this.polygons;
                var polygonPool = this.polygonPool;
                var slots = skeleton.slots;
                var slotCount = slots.length;
                boundingBoxes.length = 0;
                polygonPool.freeAll(polygons);
                polygons.length = 0;
                for (var i = 0; i < slotCount; i++) {
                    var slot = slots[i];
                    var attachment = slot.getAttachment();
                    if (attachment instanceof core.BoundingBoxAttachment) {
                        var boundingBox = attachment;
                        boundingBoxes.push(boundingBox);
                        var polygon = polygonPool.obtain();
                        if (polygon.length != boundingBox.worldVerticesLength) {
                            polygon = core.Utils.newFloatArray(boundingBox.worldVerticesLength)
                        }
                        polygons.push(polygon);
                        boundingBox.computeWorldVertices(slot, 0, boundingBox.worldVerticesLength, polygon, 0, 2)
                    }
                }
                if (updateAabb) {
                    this.aabbCompute()
                } else {
                    this.minX = Number.POSITIVE_INFINITY;
                    this.minY = Number.POSITIVE_INFINITY;
                    this.maxX = Number.NEGATIVE_INFINITY;
                    this.maxY = Number.NEGATIVE_INFINITY
                }
            };
            SkeletonBounds.prototype.aabbCompute = function() {
                var minX = Number.POSITIVE_INFINITY,
                    minY = Number.POSITIVE_INFINITY,
                    maxX = Number.NEGATIVE_INFINITY,
                    maxY = Number.NEGATIVE_INFINITY;
                var polygons = this.polygons;
                for (var i = 0, n = polygons.length; i < n; i++) {
                    var polygon = polygons[i];
                    var vertices = polygon;
                    for (var ii = 0, nn = polygon.length; ii < nn; ii += 2) {
                        var x = vertices[ii];
                        var y = vertices[ii + 1];
                        minX = Math.min(minX, x);
                        minY = Math.min(minY, y);
                        maxX = Math.max(maxX, x);
                        maxY = Math.max(maxY, y)
                    }
                }
                this.minX = minX;
                this.minY = minY;
                this.maxX = maxX;
                this.maxY = maxY
            };
            SkeletonBounds.prototype.aabbContainsPoint = function(x, y) {
                return x >= this.minX && x <= this.maxX && y >= this.minY && y <= this.maxY
            };
            SkeletonBounds.prototype.aabbIntersectsSegment = function(x1, y1, x2, y2) {
                var minX = this.minX;
                var minY = this.minY;
                var maxX = this.maxX;
                var maxY = this.maxY;
                if (x1 <= minX && x2 <= minX || y1 <= minY && y2 <= minY || x1 >= maxX && x2 >= maxX || y1 >= maxY && y2 >= maxY) return false;
                var m = (y2 - y1) / (x2 - x1);
                var y = m * (minX - x1) + y1;
                if (y > minY && y < maxY) return true;
                y = m * (maxX - x1) + y1;
                if (y > minY && y < maxY) return true;
                var x = (minY - y1) / m + x1;
                if (x > minX && x < maxX) return true;
                x = (maxY - y1) / m + x1;
                if (x > minX && x < maxX) return true;
                return false
            };
            SkeletonBounds.prototype.aabbIntersectsSkeleton = function(bounds) {
                return this.minX < bounds.maxX && this.maxX > bounds.minX && this.minY < bounds.maxY && this.maxY > bounds.minY
            };
            SkeletonBounds.prototype.containsPoint = function(x, y) {
                var polygons = this.polygons;
                for (var i = 0, n = polygons.length; i < n; i++)
                    if (this.containsPointPolygon(polygons[i], x, y)) return this.boundingBoxes[i];
                return null
            };
            SkeletonBounds.prototype.containsPointPolygon = function(polygon, x, y) {
                var vertices = polygon;
                var nn = polygon.length;
                var prevIndex = nn - 2;
                var inside = false;
                for (var ii = 0; ii < nn; ii += 2) {
                    var vertexY = vertices[ii + 1];
                    var prevY = vertices[prevIndex + 1];
                    if (vertexY < y && prevY >= y || prevY < y && vertexY >= y) {
                        var vertexX = vertices[ii];
                        if (vertexX + (y - vertexY) / (prevY - vertexY) * (vertices[prevIndex] - vertexX) < x) inside = !inside
                    }
                    prevIndex = ii
                }
                return inside
            };
            SkeletonBounds.prototype.intersectsSegment = function(x1, y1, x2, y2) {
                var polygons = this.polygons;
                for (var i = 0, n = polygons.length; i < n; i++)
                    if (this.intersectsSegmentPolygon(polygons[i], x1, y1, x2, y2)) return this.boundingBoxes[i];
                return null
            };
            SkeletonBounds.prototype.intersectsSegmentPolygon = function(polygon, x1, y1, x2, y2) {
                var vertices = polygon;
                var nn = polygon.length;
                var width12 = x1 - x2,
                    height12 = y1 - y2;
                var det1 = x1 * y2 - y1 * x2;
                var x3 = vertices[nn - 2],
                    y3 = vertices[nn - 1];
                for (var ii = 0; ii < nn; ii += 2) {
                    var x4 = vertices[ii],
                        y4 = vertices[ii + 1];
                    var det2 = x3 * y4 - y3 * x4;
                    var width34 = x3 - x4,
                        height34 = y3 - y4;
                    var det3 = width12 * height34 - height12 * width34;
                    var x = (det1 * width34 - width12 * det2) / det3;
                    if ((x >= x3 && x <= x4 || x >= x4 && x <= x3) && (x >= x1 && x <= x2 || x >= x2 && x <= x1)) {
                        var y = (det1 * height34 - height12 * det2) / det3;
                        if ((y >= y3 && y <= y4 || y >= y4 && y <= y3) && (y >= y1 && y <= y2 || y >= y2 && y <= y1)) return true
                    }
                    x3 = x4;
                    y3 = y4
                }
                return false
            };
            SkeletonBounds.prototype.getPolygon = function(boundingBox) {
                if (boundingBox == null) throw new Error("boundingBox cannot be null.");
                var index = this.boundingBoxes.indexOf(boundingBox);
                return index == -1 ? null : this.polygons[index]
            };
            SkeletonBounds.prototype.getWidth = function() {
                return this.maxX - this.minX
            };
            SkeletonBounds.prototype.getHeight = function() {
                return this.maxY - this.minY
            };
            return SkeletonBounds
        }();
        core.SkeletonBounds = SkeletonBounds
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var SkeletonClipping = function() {
            function SkeletonClipping() {
                this.triangulator = new core.Triangulator;
                this.clippingPolygon = new Array;
                this.clipOutput = new Array;
                this.clippedVertices = new Array;
                this.clippedTriangles = new Array;
                this.scratch = new Array
            }
            SkeletonClipping.prototype.clipStart = function(slot, clip) {
                if (this.clipAttachment != null) return 0;
                this.clipAttachment = clip;
                var n = clip.worldVerticesLength;
                var vertices = core.Utils.setArraySize(this.clippingPolygon, n);
                clip.computeWorldVertices(slot, 0, n, vertices, 0, 2);
                var clippingPolygon = this.clippingPolygon;
                SkeletonClipping.makeClockwise(clippingPolygon);
                var clippingPolygons = this.clippingPolygons = this.triangulator.decompose(clippingPolygon, this.triangulator.triangulate(clippingPolygon));
                for (var i = 0, n_1 = clippingPolygons.length; i < n_1; i++) {
                    var polygon = clippingPolygons[i];
                    SkeletonClipping.makeClockwise(polygon);
                    polygon.push(polygon[0]);
                    polygon.push(polygon[1])
                }
                return clippingPolygons.length
            };
            SkeletonClipping.prototype.clipEndWithSlot = function(slot) {
                if (this.clipAttachment != null && this.clipAttachment.endSlot == slot.data) this.clipEnd()
            };
            SkeletonClipping.prototype.clipEnd = function() {
                if (this.clipAttachment == null) return;
                this.clipAttachment = null;
                this.clippingPolygons = null;
                this.clippedVertices.length = 0;
                this.clippedTriangles.length = 0;
                this.clippingPolygon.length = 0
            };
            SkeletonClipping.prototype.isClipping = function() {
                return this.clipAttachment != null
            };
            SkeletonClipping.prototype.clipTriangles = function(vertices, verticesLength, triangles, trianglesLength, uvs, light, dark, twoColor) {
                var clipOutput = this.clipOutput,
                    clippedVertices = this.clippedVertices;
                var clippedTriangles = this.clippedTriangles;
                var polygons = this.clippingPolygons;
                var polygonsCount = this.clippingPolygons.length;
                var vertexSize = twoColor ? 12 : 8;
                var index = 0;
                clippedVertices.length = 0;
                clippedTriangles.length = 0;
                outer: for (var i = 0; i < trianglesLength; i += 3) {
                    var vertexOffset = triangles[i] << 1;
                    var x1 = vertices[vertexOffset],
                        y1 = vertices[vertexOffset + 1];
                    var u1 = uvs[vertexOffset],
                        v1 = uvs[vertexOffset + 1];
                    vertexOffset = triangles[i + 1] << 1;
                    var x2 = vertices[vertexOffset],
                        y2 = vertices[vertexOffset + 1];
                    var u2 = uvs[vertexOffset],
                        v2 = uvs[vertexOffset + 1];
                    vertexOffset = triangles[i + 2] << 1;
                    var x3 = vertices[vertexOffset],
                        y3 = vertices[vertexOffset + 1];
                    var u3 = uvs[vertexOffset],
                        v3 = uvs[vertexOffset + 1];
                    for (var p = 0; p < polygonsCount; p++) {
                        var s = clippedVertices.length;
                        if (this.clip(x1, y1, x2, y2, x3, y3, polygons[p], clipOutput)) {
                            var clipOutputLength = clipOutput.length;
                            if (clipOutputLength == 0) continue;
                            var d0 = y2 - y3,
                                d1 = x3 - x2,
                                d2 = x1 - x3,
                                d4 = y3 - y1;
                            var d = 1 / (d0 * d2 + d1 * (y1 - y3));
                            var clipOutputCount = clipOutputLength >> 1;
                            var clipOutputItems = this.clipOutput;
                            var clippedVerticesItems = core.Utils.setArraySize(clippedVertices, s + clipOutputCount * vertexSize);
                            for (var ii = 0; ii < clipOutputLength; ii += 2) {
                                var x = clipOutputItems[ii],
                                    y = clipOutputItems[ii + 1];
                                clippedVerticesItems[s] = x;
                                clippedVerticesItems[s + 1] = y;
                                clippedVerticesItems[s + 2] = light.r;
                                clippedVerticesItems[s + 3] = light.g;
                                clippedVerticesItems[s + 4] = light.b;
                                clippedVerticesItems[s + 5] = light.a;
                                var c0 = x - x3,
                                    c1 = y - y3;
                                var a = (d0 * c0 + d1 * c1) * d;
                                var b = (d4 * c0 + d2 * c1) * d;
                                var c = 1 - a - b;
                                clippedVerticesItems[s + 6] = u1 * a + u2 * b + u3 * c;
                                clippedVerticesItems[s + 7] = v1 * a + v2 * b + v3 * c;
                                if (twoColor) {
                                    clippedVerticesItems[s + 8] = dark.r;
                                    clippedVerticesItems[s + 9] = dark.g;
                                    clippedVerticesItems[s + 10] = dark.b;
                                    clippedVerticesItems[s + 11] = dark.a
                                }
                                s += vertexSize
                            }
                            s = clippedTriangles.length;
                            var clippedTrianglesItems = core.Utils.setArraySize(clippedTriangles, s + 3 * (clipOutputCount - 2));
                            clipOutputCount--;
                            for (var ii = 1; ii < clipOutputCount; ii++) {
                                clippedTrianglesItems[s] = index;
                                clippedTrianglesItems[s + 1] = index + ii;
                                clippedTrianglesItems[s + 2] = index + ii + 1;
                                s += 3
                            }
                            index += clipOutputCount + 1
                        } else {
                            var clippedVerticesItems = core.Utils.setArraySize(clippedVertices, s + 3 * vertexSize);
                            clippedVerticesItems[s] = x1;
                            clippedVerticesItems[s + 1] = y1;
                            clippedVerticesItems[s + 2] = light.r;
                            clippedVerticesItems[s + 3] = light.g;
                            clippedVerticesItems[s + 4] = light.b;
                            clippedVerticesItems[s + 5] = light.a;
                            if (!twoColor) {
                                clippedVerticesItems[s + 6] = u1;
                                clippedVerticesItems[s + 7] = v1;
                                clippedVerticesItems[s + 8] = x2;
                                clippedVerticesItems[s + 9] = y2;
                                clippedVerticesItems[s + 10] = light.r;
                                clippedVerticesItems[s + 11] = light.g;
                                clippedVerticesItems[s + 12] = light.b;
                                clippedVerticesItems[s + 13] = light.a;
                                clippedVerticesItems[s + 14] = u2;
                                clippedVerticesItems[s + 15] = v2;
                                clippedVerticesItems[s + 16] = x3;
                                clippedVerticesItems[s + 17] = y3;
                                clippedVerticesItems[s + 18] = light.r;
                                clippedVerticesItems[s + 19] = light.g;
                                clippedVerticesItems[s + 20] = light.b;
                                clippedVerticesItems[s + 21] = light.a;
                                clippedVerticesItems[s + 22] = u3;
                                clippedVerticesItems[s + 23] = v3
                            } else {
                                clippedVerticesItems[s + 6] = u1;
                                clippedVerticesItems[s + 7] = v1;
                                clippedVerticesItems[s + 8] = dark.r;
                                clippedVerticesItems[s + 9] = dark.g;
                                clippedVerticesItems[s + 10] = dark.b;
                                clippedVerticesItems[s + 11] = dark.a;
                                clippedVerticesItems[s + 12] = x2;
                                clippedVerticesItems[s + 13] = y2;
                                clippedVerticesItems[s + 14] = light.r;
                                clippedVerticesItems[s + 15] = light.g;
                                clippedVerticesItems[s + 16] = light.b;
                                clippedVerticesItems[s + 17] = light.a;
                                clippedVerticesItems[s + 18] = u2;
                                clippedVerticesItems[s + 19] = v2;
                                clippedVerticesItems[s + 20] = dark.r;
                                clippedVerticesItems[s + 21] = dark.g;
                                clippedVerticesItems[s + 22] = dark.b;
                                clippedVerticesItems[s + 23] = dark.a;
                                clippedVerticesItems[s + 24] = x3;
                                clippedVerticesItems[s + 25] = y3;
                                clippedVerticesItems[s + 26] = light.r;
                                clippedVerticesItems[s + 27] = light.g;
                                clippedVerticesItems[s + 28] = light.b;
                                clippedVerticesItems[s + 29] = light.a;
                                clippedVerticesItems[s + 30] = u3;
                                clippedVerticesItems[s + 31] = v3;
                                clippedVerticesItems[s + 32] = dark.r;
                                clippedVerticesItems[s + 33] = dark.g;
                                clippedVerticesItems[s + 34] = dark.b;
                                clippedVerticesItems[s + 35] = dark.a
                            }
                            s = clippedTriangles.length;
                            var clippedTrianglesItems = core.Utils.setArraySize(clippedTriangles, s + 3);
                            clippedTrianglesItems[s] = index;
                            clippedTrianglesItems[s + 1] = index + 1;
                            clippedTrianglesItems[s + 2] = index + 2;
                            index += 3;
                            continue outer
                        }
                    }
                }
            };
            SkeletonClipping.prototype.clip = function(x1, y1, x2, y2, x3, y3, clippingArea, output) {
                var originalOutput = output;
                var clipped = false;
                var input = null;
                if (clippingArea.length % 4 >= 2) {
                    input = output;
                    output = this.scratch
                } else input = this.scratch;
                input.length = 0;
                input.push(x1);
                input.push(y1);
                input.push(x2);
                input.push(y2);
                input.push(x3);
                input.push(y3);
                input.push(x1);
                input.push(y1);
                output.length = 0;
                var clippingVertices = clippingArea;
                var clippingVerticesLast = clippingArea.length - 4;
                for (var i = 0;; i += 2) {
                    var edgeX = clippingVertices[i],
                        edgeY = clippingVertices[i + 1];
                    var edgeX2 = clippingVertices[i + 2],
                        edgeY2 = clippingVertices[i + 3];
                    var deltaX = edgeX - edgeX2,
                        deltaY = edgeY - edgeY2;
                    var inputVertices = input;
                    var inputVerticesLength = input.length - 2,
                        outputStart = output.length;
                    for (var ii = 0; ii < inputVerticesLength; ii += 2) {
                        var inputX = inputVertices[ii],
                            inputY = inputVertices[ii + 1];
                        var inputX2 = inputVertices[ii + 2],
                            inputY2 = inputVertices[ii + 3];
                        var side2 = deltaX * (inputY2 - edgeY2) - deltaY * (inputX2 - edgeX2) > 0;
                        if (deltaX * (inputY - edgeY2) - deltaY * (inputX - edgeX2) > 0) {
                            if (side2) {
                                output.push(inputX2);
                                output.push(inputY2);
                                continue
                            }
                            var c0 = inputY2 - inputY,
                                c2 = inputX2 - inputX;
                            var ua = (c2 * (edgeY - inputY) - c0 * (edgeX - inputX)) / (c0 * (edgeX2 - edgeX) - c2 * (edgeY2 - edgeY));
                            output.push(edgeX + (edgeX2 - edgeX) * ua);
                            output.push(edgeY + (edgeY2 - edgeY) * ua)
                        } else if (side2) {
                            var c0 = inputY2 - inputY,
                                c2 = inputX2 - inputX;
                            var ua = (c2 * (edgeY - inputY) - c0 * (edgeX - inputX)) / (c0 * (edgeX2 - edgeX) - c2 * (edgeY2 - edgeY));
                            output.push(edgeX + (edgeX2 - edgeX) * ua);
                            output.push(edgeY + (edgeY2 - edgeY) * ua);
                            output.push(inputX2);
                            output.push(inputY2)
                        }
                        clipped = true
                    }
                    if (outputStart == output.length) {
                        originalOutput.length = 0;
                        return true
                    }
                    output.push(output[0]);
                    output.push(output[1]);
                    if (i == clippingVerticesLast) break;
                    var temp = output;
                    output = input;
                    output.length = 0;
                    input = temp
                }
                if (originalOutput != output) {
                    originalOutput.length = 0;
                    for (var i = 0, n = output.length - 2; i < n; i++) originalOutput[i] = output[i]
                } else originalOutput.length = originalOutput.length - 2;
                return clipped
            };
            SkeletonClipping.makeClockwise = function(polygon) {
                var vertices = polygon;
                var verticeslength = polygon.length;
                var area = vertices[verticeslength - 2] * vertices[1] - vertices[0] * vertices[verticeslength - 1],
                    p1x = 0,
                    p1y = 0,
                    p2x = 0,
                    p2y = 0;
                for (var i = 0, n = verticeslength - 3; i < n; i += 2) {
                    p1x = vertices[i];
                    p1y = vertices[i + 1];
                    p2x = vertices[i + 2];
                    p2y = vertices[i + 3];
                    area += p1x * p2y - p2x * p1y
                }
                if (area < 0) return;
                for (var i = 0, lastX = verticeslength - 2, n = verticeslength >> 1; i < n; i += 2) {
                    var x = vertices[i],
                        y = vertices[i + 1];
                    var other = lastX - i;
                    vertices[i] = vertices[other];
                    vertices[i + 1] = vertices[other + 1];
                    vertices[other] = x;
                    vertices[other + 1] = y
                }
            };
            return SkeletonClipping
        }();
        core.SkeletonClipping = SkeletonClipping
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var SkeletonData = function() {
            function SkeletonData() {
                this.bones = new Array;
                this.slots = new Array;
                this.skins = new Array;
                this.events = new Array;
                this.animations = new Array;
                this.ikConstraints = new Array;
                this.transformConstraints = new Array;
                this.pathConstraints = new Array;
                this.fps = 0
            }
            SkeletonData.prototype.findBone = function(boneName) {
                if (boneName == null) throw new Error("boneName cannot be null.");
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) {
                    var bone = bones[i];
                    if (bone.name == boneName) return bone
                }
                return null
            };
            SkeletonData.prototype.findBoneIndex = function(boneName) {
                if (boneName == null) throw new Error("boneName cannot be null.");
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++)
                    if (bones[i].name == boneName) return i;
                return -1
            };
            SkeletonData.prototype.findSlot = function(slotName) {
                if (slotName == null) throw new Error("slotName cannot be null.");
                var slots = this.slots;
                for (var i = 0, n = slots.length; i < n; i++) {
                    var slot = slots[i];
                    if (slot.name == slotName) return slot
                }
                return null
            };
            SkeletonData.prototype.findSlotIndex = function(slotName) {
                if (slotName == null) throw new Error("slotName cannot be null.");
                var slots = this.slots;
                for (var i = 0, n = slots.length; i < n; i++)
                    if (slots[i].name == slotName) return i;
                return -1
            };
            SkeletonData.prototype.findSkin = function(skinName) {
                if (skinName == null) throw new Error("skinName cannot be null.");
                var skins = this.skins;
                for (var i = 0, n = skins.length; i < n; i++) {
                    var skin = skins[i];
                    if (skin.name == skinName) return skin
                }
                return null
            };
            SkeletonData.prototype.findEvent = function(eventDataName) {
                if (eventDataName == null) throw new Error("eventDataName cannot be null.");
                var events = this.events;
                for (var i = 0, n = events.length; i < n; i++) {
                    var event_4 = events[i];
                    if (event_4.name == eventDataName) return event_4
                }
                return null
            };
            SkeletonData.prototype.findAnimation = function(animationName) {
                if (animationName == null) throw new Error("animationName cannot be null.");
                var animations = this.animations;
                for (var i = 0, n = animations.length; i < n; i++) {
                    var animation = animations[i];
                    if (animation.name == animationName) return animation
                }
                return null
            };
            SkeletonData.prototype.findIkConstraint = function(constraintName) {
                if (constraintName == null) throw new Error("constraintName cannot be null.");
                var ikConstraints = this.ikConstraints;
                for (var i = 0, n = ikConstraints.length; i < n; i++) {
                    var constraint = ikConstraints[i];
                    if (constraint.name == constraintName) return constraint
                }
                return null
            };
            SkeletonData.prototype.findTransformConstraint = function(constraintName) {
                if (constraintName == null) throw new Error("constraintName cannot be null.");
                var transformConstraints = this.transformConstraints;
                for (var i = 0, n = transformConstraints.length; i < n; i++) {
                    var constraint = transformConstraints[i];
                    if (constraint.name == constraintName) return constraint
                }
                return null
            };
            SkeletonData.prototype.findPathConstraint = function(constraintName) {
                if (constraintName == null) throw new Error("constraintName cannot be null.");
                var pathConstraints = this.pathConstraints;
                for (var i = 0, n = pathConstraints.length; i < n; i++) {
                    var constraint = pathConstraints[i];
                    if (constraint.name == constraintName) return constraint
                }
                return null
            };
            SkeletonData.prototype.findPathConstraintIndex = function(pathConstraintName) {
                if (pathConstraintName == null) throw new Error("pathConstraintName cannot be null.");
                var pathConstraints = this.pathConstraints;
                for (var i = 0, n = pathConstraints.length; i < n; i++)
                    if (pathConstraints[i].name == pathConstraintName) return i;
                return -1
            };
            return SkeletonData
        }();
        core.SkeletonData = SkeletonData
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var SkeletonJson = function() {
            function SkeletonJson(attachmentLoader) {
                this.scale = 1;
                this.linkedMeshes = new Array;
                this.attachmentLoader = attachmentLoader
            }
            SkeletonJson.prototype.readSkeletonData = function(json) {
                var scale = this.scale;
                var skeletonData = new core.SkeletonData;
                var root = typeof json === "string" ? JSON.parse(json) : json;
                var skeletonMap = root.skeleton;
                if (skeletonMap != null) {
                    skeletonData.hash = skeletonMap.hash;
                    skeletonData.version = skeletonMap.spine;
                    skeletonData.width = skeletonMap.width;
                    skeletonData.height = skeletonMap.height;
                    skeletonData.fps = skeletonMap.fps;
                    skeletonData.imagesPath = skeletonMap.images
                }
                if (root.bones) {
                    for (var i = 0; i < root.bones.length; i++) {
                        var boneMap = root.bones[i];
                        var parent_2 = null;
                        var parentName = this.getValue(boneMap, "parent", null);
                        if (parentName != null) {
                            parent_2 = skeletonData.findBone(parentName);
                            if (parent_2 == null) throw new Error("Parent bone not found: " + parentName)
                        }
                        var data = new core.BoneData(skeletonData.bones.length, boneMap.name, parent_2);
                        data.length = this.getValue(boneMap, "length", 0) * scale;
                        data.x = this.getValue(boneMap, "x", 0) * scale;
                        data.y = this.getValue(boneMap, "y", 0) * scale;
                        data.rotation = this.getValue(boneMap, "rotation", 0);
                        data.scaleX = this.getValue(boneMap, "scaleX", 1);
                        data.scaleY = this.getValue(boneMap, "scaleY", 1);
                        data.shearX = this.getValue(boneMap, "shearX", 0);
                        data.shearY = this.getValue(boneMap, "shearY", 0);
                        data.transformMode = SkeletonJson.transformModeFromString(this.getValue(boneMap, "transform", "normal"));
                        skeletonData.bones.push(data)
                    }
                }
                if (root.slots) {
                    for (var i = 0; i < root.slots.length; i++) {
                        var slotMap = root.slots[i];
                        var slotName = slotMap.name;
                        var boneName = slotMap.bone;
                        var boneData = skeletonData.findBone(boneName);
                        if (boneData == null) throw new Error("Slot bone not found: " + boneName);
                        var data = new core.SlotData(skeletonData.slots.length, slotName, boneData);
                        var color = this.getValue(slotMap, "color", null);
                        if (color != null) data.color.setFromString(color);
                        var dark = this.getValue(slotMap, "dark", null);
                        if (dark != null) {
                            data.darkColor = new core.Color(1, 1, 1, 1);
                            data.darkColor.setFromString(dark)
                        }
                        data.attachmentName = this.getValue(slotMap, "attachment", null);
                        data.blendMode = SkeletonJson.blendModeFromString(this.getValue(slotMap, "blend", "normal"));
                        skeletonData.slots.push(data)
                    }
                }
                if (root.ik) {
                    for (var i = 0; i < root.ik.length; i++) {
                        var constraintMap = root.ik[i];
                        var data = new core.IkConstraintData(constraintMap.name);
                        data.order = this.getValue(constraintMap, "order", 0);
                        for (var j = 0; j < constraintMap.bones.length; j++) {
                            var boneName = constraintMap.bones[j];
                            var bone = skeletonData.findBone(boneName);
                            if (bone == null) throw new Error("IK bone not found: " + boneName);
                            data.bones.push(bone)
                        }
                        var targetName = constraintMap.target;
                        data.target = skeletonData.findBone(targetName);
                        if (data.target == null) throw new Error("IK target bone not found: " + targetName);
                        data.bendDirection = this.getValue(constraintMap, "bendPositive", true) ? 1 : -1;
                        data.mix = this.getValue(constraintMap, "mix", 1);
                        skeletonData.ikConstraints.push(data)
                    }
                }
                if (root.transform) {
                    for (var i = 0; i < root.transform.length; i++) {
                        var constraintMap = root.transform[i];
                        var data = new core.TransformConstraintData(constraintMap.name);
                        data.order = this.getValue(constraintMap, "order", 0);
                        for (var j = 0; j < constraintMap.bones.length; j++) {
                            var boneName = constraintMap.bones[j];
                            var bone = skeletonData.findBone(boneName);
                            if (bone == null) throw new Error("Transform constraint bone not found: " + boneName);
                            data.bones.push(bone)
                        }
                        var targetName = constraintMap.target;
                        data.target = skeletonData.findBone(targetName);
                        if (data.target == null) throw new Error("Transform constraint target bone not found: " + targetName);
                        data.local = this.getValue(constraintMap, "local", false);
                        data.relative = this.getValue(constraintMap, "relative", false);
                        data.offsetRotation = this.getValue(constraintMap, "rotation", 0);
                        data.offsetX = this.getValue(constraintMap, "x", 0) * scale;
                        data.offsetY = this.getValue(constraintMap, "y", 0) * scale;
                        data.offsetScaleX = this.getValue(constraintMap, "scaleX", 0);
                        data.offsetScaleY = this.getValue(constraintMap, "scaleY", 0);
                        data.offsetShearY = this.getValue(constraintMap, "shearY", 0);
                        data.rotateMix = this.getValue(constraintMap, "rotateMix", 1);
                        data.translateMix = this.getValue(constraintMap, "translateMix", 1);
                        data.scaleMix = this.getValue(constraintMap, "scaleMix", 1);
                        data.shearMix = this.getValue(constraintMap, "shearMix", 1);
                        skeletonData.transformConstraints.push(data)
                    }
                }
                if (root.path) {
                    for (var i = 0; i < root.path.length; i++) {
                        var constraintMap = root.path[i];
                        var data = new core.PathConstraintData(constraintMap.name);
                        data.order = this.getValue(constraintMap, "order", 0);
                        for (var j = 0; j < constraintMap.bones.length; j++) {
                            var boneName = constraintMap.bones[j];
                            var bone = skeletonData.findBone(boneName);
                            if (bone == null) throw new Error("Transform constraint bone not found: " + boneName);
                            data.bones.push(bone)
                        }
                        var targetName = constraintMap.target;
                        data.target = skeletonData.findSlot(targetName);
                        if (data.target == null) throw new Error("Path target slot not found: " + targetName);
                        data.positionMode = SkeletonJson.positionModeFromString(this.getValue(constraintMap, "positionMode", "percent"));
                        data.spacingMode = SkeletonJson.spacingModeFromString(this.getValue(constraintMap, "spacingMode", "length"));
                        data.rotateMode = SkeletonJson.rotateModeFromString(this.getValue(constraintMap, "rotateMode", "tangent"));
                        data.offsetRotation = this.getValue(constraintMap, "rotation", 0);
                        data.position = this.getValue(constraintMap, "position", 0);
                        if (data.positionMode == core.PositionMode.Fixed) data.position *= scale;
                        data.spacing = this.getValue(constraintMap, "spacing", 0);
                        if (data.spacingMode == core.SpacingMode.Length || data.spacingMode == core.SpacingMode.Fixed) data.spacing *= scale;
                        data.rotateMix = this.getValue(constraintMap, "rotateMix", 1);
                        data.translateMix = this.getValue(constraintMap, "translateMix", 1);
                        skeletonData.pathConstraints.push(data)
                    }
                }
                if (root.skins) {
                    for (var skinName in root.skins) {
                        var skinMap = root.skins[skinName];
                        var skin = new core.Skin(skinName);
                        for (var slotName in skinMap) {
                            var slotIndex = skeletonData.findSlotIndex(slotName);
                            if (slotIndex == -1) throw new Error("Slot not found: " + slotName);
                            var slotMap = skinMap[slotName];
                            for (var entryName in slotMap) {
                                var attachment = this.readAttachment(slotMap[entryName], skin, slotIndex, entryName, skeletonData);
                                if (attachment != null) skin.addAttachment(slotIndex, entryName, attachment)
                            }
                        }
                        skeletonData.skins.push(skin);
                        if (skin.name == "default") skeletonData.defaultSkin = skin
                    }
                }
                for (var i = 0, n = this.linkedMeshes.length; i < n; i++) {
                    var linkedMesh = this.linkedMeshes[i];
                    var skin = linkedMesh.skin == null ? skeletonData.defaultSkin : skeletonData.findSkin(linkedMesh.skin);
                    if (skin == null) throw new Error("Skin not found: " + linkedMesh.skin);
                    var parent_3 = skin.getAttachment(linkedMesh.slotIndex, linkedMesh.parent);
                    if (parent_3 == null) throw new Error("Parent mesh not found: " + linkedMesh.parent);
                    linkedMesh.mesh.setParentMesh(parent_3)
                }
                this.linkedMeshes.length = 0;
                if (root.events) {
                    for (var eventName in root.events) {
                        var eventMap = root.events[eventName];
                        var data = new core.EventData(eventName);
                        data.intValue = this.getValue(eventMap, "int", 0);
                        data.floatValue = this.getValue(eventMap, "float", 0);
                        data.stringValue = this.getValue(eventMap, "string", "");
                        skeletonData.events.push(data)
                    }
                }
                if (root.animations) {
                    for (var animationName in root.animations) {
                        var animationMap = root.animations[animationName];
                        this.readAnimation(animationMap, animationName, skeletonData)
                    }
                }
                return skeletonData
            };
            SkeletonJson.prototype.readAttachment = function(map, skin, slotIndex, name, skeletonData) {
                var scale = this.scale;
                name = this.getValue(map, "name", name);
                var type = this.getValue(map, "type", "region");
                switch (type) {
                    case "region": {
                        var path = this.getValue(map, "path", name);
                        var region = this.attachmentLoader.newRegionAttachment(skin, name, path);
                        if (region == null) return null;
                        region.path = path;
                        region.x = this.getValue(map, "x", 0) * scale;
                        region.y = this.getValue(map, "y", 0) * scale;
                        region.scaleX = this.getValue(map, "scaleX", 1);
                        region.scaleY = this.getValue(map, "scaleY", 1);
                        region.rotation = this.getValue(map, "rotation", 0);
                        region.width = map.width * scale;
                        region.height = map.height * scale;
                        var color = this.getValue(map, "color", null);
                        if (color != null) region.color.setFromString(color);
                        return region
                    }
                    case "boundingbox": {
                        var box = this.attachmentLoader.newBoundingBoxAttachment(skin, name);
                        if (box == null) return null;
                        this.readVertices(map, box, map.vertexCount << 1);
                        var color = this.getValue(map, "color", null);
                        if (color != null) box.color.setFromString(color);
                        return box
                    }
                    case "mesh":
                    case "linkedmesh": {
                        var path = this.getValue(map, "path", name);
                        var mesh = this.attachmentLoader.newMeshAttachment(skin, name, path);
                        if (mesh == null) return null;
                        mesh.path = path;
                        var color = this.getValue(map, "color", null);
                        if (color != null) mesh.color.setFromString(color);
                        var parent_4 = this.getValue(map, "parent", null);
                        if (parent_4 != null) {
                            mesh.inheritDeform = this.getValue(map, "deform", true);
                            this.linkedMeshes.push(new LinkedMesh(mesh, this.getValue(map, "skin", null), slotIndex, parent_4));
                            return mesh
                        }
                        var uvs = map.uvs;
                        this.readVertices(map, mesh, uvs.length);
                        mesh.triangles = map.triangles;
                        mesh.regionUVs = uvs;
                        mesh.hullLength = this.getValue(map, "hull", 0) * 2;
                        return mesh
                    }
                    case "path": {
                        var path = this.attachmentLoader.newPathAttachment(skin, name);
                        if (path == null) return null;
                        path.closed = this.getValue(map, "closed", false);
                        path.constantSpeed = this.getValue(map, "constantSpeed", true);
                        var vertexCount = map.vertexCount;
                        this.readVertices(map, path, vertexCount << 1);
                        var lengths = core.Utils.newArray(vertexCount / 3, 0);
                        for (var i = 0; i < map.lengths.length; i++) lengths[i] = map.lengths[i] * scale;
                        path.lengths = lengths;
                        var color = this.getValue(map, "color", null);
                        if (color != null) path.color.setFromString(color);
                        return path
                    }
                    case "point": {
                        var point = this.attachmentLoader.newPointAttachment(skin, name);
                        if (point == null) return null;
                        point.x = this.getValue(map, "x", 0) * scale;
                        point.y = this.getValue(map, "y", 0) * scale;
                        point.rotation = this.getValue(map, "rotation", 0);
                        var color = this.getValue(map, "color", null);
                        if (color != null) point.color.setFromString(color);
                        return point
                    }
                    case "clipping": {
                        var clip = this.attachmentLoader.newClippingAttachment(skin, name);
                        if (clip == null) return null;
                        var end = this.getValue(map, "end", null);
                        if (end != null) {
                            var slot = skeletonData.findSlot(end);
                            if (slot == null) throw new Error("Clipping end slot not found: " + end);
                            clip.endSlot = slot
                        }
                        var vertexCount = map.vertexCount;
                        this.readVertices(map, clip, vertexCount << 1);
                        var color = this.getValue(map, "color", null);
                        if (color != null) clip.color.setFromString(color);
                        return clip
                    }
                }
                return null
            };
            SkeletonJson.prototype.readVertices = function(map, attachment, verticesLength) {
                var scale = this.scale;
                attachment.worldVerticesLength = verticesLength;
                var vertices = map.vertices;
                if (verticesLength == vertices.length) {
                    var scaledVertices = core.Utils.toFloatArray(vertices);
                    if (scale != 1) {
                        for (var i = 0, n = vertices.length; i < n; i++) scaledVertices[i] *= scale
                    }
                    attachment.vertices = scaledVertices;
                    return
                }
                var weights = new Array;
                var bones = new Array;
                for (var i = 0, n = vertices.length; i < n;) {
                    var boneCount = vertices[i++];
                    bones.push(boneCount);
                    for (var nn = i + boneCount * 4; i < nn; i += 4) {
                        bones.push(vertices[i]);
                        weights.push(vertices[i + 1] * scale);
                        weights.push(vertices[i + 2] * scale);
                        weights.push(vertices[i + 3])
                    }
                }
                attachment.bones = bones;
                attachment.vertices = core.Utils.toFloatArray(weights)
            };
            SkeletonJson.prototype.readAnimation = function(map, name, skeletonData) {
                var scale = this.scale;
                var timelines = new Array;
                var duration = 0;
                if (map.slots) {
                    for (var slotName in map.slots) {
                        var slotMap = map.slots[slotName];
                        var slotIndex = skeletonData.findSlotIndex(slotName);
                        if (slotIndex == -1) throw new Error("Slot not found: " + slotName);
                        for (var timelineName in slotMap) {
                            var timelineMap = slotMap[timelineName];
                            if (timelineName == "attachment") {
                                var timeline = new core.AttachmentTimeline(timelineMap.length);
                                timeline.slotIndex = slotIndex;
                                var frameIndex = 0;
                                for (var i = 0; i < timelineMap.length; i++) {
                                    var valueMap = timelineMap[i];
                                    timeline.setFrame(frameIndex++, valueMap.time, valueMap.name)
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1])
                            } else if (timelineName == "color") {
                                var timeline = new core.ColorTimeline(timelineMap.length);
                                timeline.slotIndex = slotIndex;
                                var frameIndex = 0;
                                for (var i = 0; i < timelineMap.length; i++) {
                                    var valueMap = timelineMap[i];
                                    var color = new core.Color;
                                    color.setFromString(valueMap.color || "ffffffff");
                                    timeline.setFrame(frameIndex, valueMap.time, color.r, color.g, color.b, color.a);
                                    this.readCurve(valueMap, timeline, frameIndex);
                                    frameIndex++
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.ColorTimeline.ENTRIES])
                            } else if (timelineName == "twoColor") {
                                var timeline = new core.TwoColorTimeline(timelineMap.length);
                                timeline.slotIndex = slotIndex;
                                var frameIndex = 0;
                                for (var i = 0; i < timelineMap.length; i++) {
                                    var valueMap = timelineMap[i];
                                    var light = new core.Color;
                                    var dark = new core.Color;
                                    light.setFromString(valueMap.light);
                                    dark.setFromString(valueMap.dark);
                                    timeline.setFrame(frameIndex, valueMap.time, light.r, light.g, light.b, light.a, dark.r, dark.g, dark.b);
                                    this.readCurve(valueMap, timeline, frameIndex);
                                    frameIndex++
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.TwoColorTimeline.ENTRIES])
                            } else throw new Error("Invalid timeline type for a slot: " + timelineName + " (" + slotName + ")")
                        }
                    }
                }
                if (map.bones) {
                    for (var boneName in map.bones) {
                        var boneMap = map.bones[boneName];
                        var boneIndex = skeletonData.findBoneIndex(boneName);
                        if (boneIndex == -1) throw new Error("Bone not found: " + boneName);
                        for (var timelineName in boneMap) {
                            var timelineMap = boneMap[timelineName];
                            if (timelineName === "rotate") {
                                var timeline = new core.RotateTimeline(timelineMap.length);
                                timeline.boneIndex = boneIndex;
                                var frameIndex = 0;
                                for (var i = 0; i < timelineMap.length; i++) {
                                    var valueMap = timelineMap[i];
                                    timeline.setFrame(frameIndex, valueMap.time, valueMap.angle);
                                    this.readCurve(valueMap, timeline, frameIndex);
                                    frameIndex++
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.RotateTimeline.ENTRIES])
                            } else if (timelineName === "translate" || timelineName === "scale" || timelineName === "shear") {
                                var timeline = null;
                                var timelineScale = 1;
                                if (timelineName === "scale") timeline = new core.ScaleTimeline(timelineMap.length);
                                else if (timelineName === "shear") timeline = new core.ShearTimeline(timelineMap.length);
                                else {
                                    timeline = new core.TranslateTimeline(timelineMap.length);
                                    timelineScale = scale
                                }
                                timeline.boneIndex = boneIndex;
                                var frameIndex = 0;
                                for (var i = 0; i < timelineMap.length; i++) {
                                    var valueMap = timelineMap[i];
                                    var x = this.getValue(valueMap, "x", 0),
                                        y = this.getValue(valueMap, "y", 0);
                                    timeline.setFrame(frameIndex, valueMap.time, x * timelineScale, y * timelineScale);
                                    this.readCurve(valueMap, timeline, frameIndex);
                                    frameIndex++
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.TranslateTimeline.ENTRIES])
                            } else throw new Error("Invalid timeline type for a bone: " + timelineName + " (" + boneName + ")")
                        }
                    }
                }
                if (map.ik) {
                    for (var constraintName in map.ik) {
                        var constraintMap = map.ik[constraintName];
                        var constraint = skeletonData.findIkConstraint(constraintName);
                        var timeline = new core.IkConstraintTimeline(constraintMap.length);
                        timeline.ikConstraintIndex = skeletonData.ikConstraints.indexOf(constraint);
                        var frameIndex = 0;
                        for (var i = 0; i < constraintMap.length; i++) {
                            var valueMap = constraintMap[i];
                            timeline.setFrame(frameIndex, valueMap.time, this.getValue(valueMap, "mix", 1), this.getValue(valueMap, "bendPositive", true) ? 1 : -1);
                            this.readCurve(valueMap, timeline, frameIndex);
                            frameIndex++
                        }
                        timelines.push(timeline);
                        duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.IkConstraintTimeline.ENTRIES])
                    }
                }
                if (map.transform) {
                    for (var constraintName in map.transform) {
                        var constraintMap = map.transform[constraintName];
                        var constraint = skeletonData.findTransformConstraint(constraintName);
                        var timeline = new core.TransformConstraintTimeline(constraintMap.length);
                        timeline.transformConstraintIndex = skeletonData.transformConstraints.indexOf(constraint);
                        var frameIndex = 0;
                        for (var i = 0; i < constraintMap.length; i++) {
                            var valueMap = constraintMap[i];
                            timeline.setFrame(frameIndex, valueMap.time, this.getValue(valueMap, "rotateMix", 1), this.getValue(valueMap, "translateMix", 1), this.getValue(valueMap, "scaleMix", 1), this.getValue(valueMap, "shearMix", 1));
                            this.readCurve(valueMap, timeline, frameIndex);
                            frameIndex++
                        }
                        timelines.push(timeline);
                        duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.TransformConstraintTimeline.ENTRIES])
                    }
                }
                if (map.paths) {
                    for (var constraintName in map.paths) {
                        var constraintMap = map.paths[constraintName];
                        var index = skeletonData.findPathConstraintIndex(constraintName);
                        if (index == -1) throw new Error("Path constraint not found: " + constraintName);
                        var data = skeletonData.pathConstraints[index];
                        for (var timelineName in constraintMap) {
                            var timelineMap = constraintMap[timelineName];
                            if (timelineName === "position" || timelineName === "spacing") {
                                var timeline = null;
                                var timelineScale = 1;
                                if (timelineName === "spacing") {
                                    timeline = new core.PathConstraintSpacingTimeline(timelineMap.length);
                                    if (data.spacingMode == core.SpacingMode.Length || data.spacingMode == core.SpacingMode.Fixed) timelineScale = scale
                                } else {
                                    timeline = new core.PathConstraintPositionTimeline(timelineMap.length);
                                    if (data.positionMode == core.PositionMode.Fixed) timelineScale = scale
                                }
                                timeline.pathConstraintIndex = index;
                                var frameIndex = 0;
                                for (var i = 0; i < timelineMap.length; i++) {
                                    var valueMap = timelineMap[i];
                                    timeline.setFrame(frameIndex, valueMap.time, this.getValue(valueMap, timelineName, 0) * timelineScale);
                                    this.readCurve(valueMap, timeline, frameIndex);
                                    frameIndex++
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.PathConstraintPositionTimeline.ENTRIES])
                            } else if (timelineName === "mix") {
                                var timeline = new core.PathConstraintMixTimeline(timelineMap.length);
                                timeline.pathConstraintIndex = index;
                                var frameIndex = 0;
                                for (var i = 0; i < timelineMap.length; i++) {
                                    var valueMap = timelineMap[i];
                                    timeline.setFrame(frameIndex, valueMap.time, this.getValue(valueMap, "rotateMix", 1), this.getValue(valueMap, "translateMix", 1));
                                    this.readCurve(valueMap, timeline, frameIndex);
                                    frameIndex++
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * core.PathConstraintMixTimeline.ENTRIES])
                            }
                        }
                    }
                }
                if (map.deform) {
                    for (var deformName in map.deform) {
                        var deformMap = map.deform[deformName];
                        var skin = skeletonData.findSkin(deformName);
                        if (skin == null) throw new Error("Skin not found: " + deformName);
                        for (var slotName in deformMap) {
                            var slotMap = deformMap[slotName];
                            var slotIndex = skeletonData.findSlotIndex(slotName);
                            if (slotIndex == -1) throw new Error("Slot not found: " + slotMap.name);
                            for (var timelineName in slotMap) {
                                var timelineMap = slotMap[timelineName];
                                var attachment = skin.getAttachment(slotIndex, timelineName);
                                if (attachment == null) throw new Error("Deform attachment not found: " + timelineMap.name);
                                var weighted = attachment.bones != null;
                                var vertices = attachment.vertices;
                                var deformLength = weighted ? vertices.length / 3 * 2 : vertices.length;
                                var timeline = new core.DeformTimeline(timelineMap.length);
                                timeline.slotIndex = slotIndex;
                                timeline.attachment = attachment;
                                var frameIndex = 0;
                                for (var j = 0; j < timelineMap.length; j++) {
                                    var valueMap = timelineMap[j];
                                    var deform = void 0;
                                    var verticesValue = this.getValue(valueMap, "vertices", null);
                                    if (verticesValue == null) deform = weighted ? core.Utils.newFloatArray(deformLength) : vertices;
                                    else {
                                        deform = core.Utils.newFloatArray(deformLength);
                                        var start = this.getValue(valueMap, "offset", 0);
                                        core.Utils.arrayCopy(verticesValue, 0, deform, start, verticesValue.length);
                                        if (scale != 1) {
                                            for (var i = start, n = i + verticesValue.length; i < n; i++) deform[i] *= scale
                                        }
                                        if (!weighted) {
                                            for (var i = 0; i < deformLength; i++) deform[i] += vertices[i]
                                        }
                                    }
                                    timeline.setFrame(frameIndex, valueMap.time, deform);
                                    this.readCurve(valueMap, timeline, frameIndex);
                                    frameIndex++
                                }
                                timelines.push(timeline);
                                duration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1])
                            }
                        }
                    }
                }
                var drawOrderNode = map.drawOrder;
                if (drawOrderNode == null) drawOrderNode = map.draworder;
                if (drawOrderNode != null) {
                    var timeline = new core.DrawOrderTimeline(drawOrderNode.length);
                    var slotCount = skeletonData.slots.length;
                    var frameIndex = 0;
                    for (var j = 0; j < drawOrderNode.length; j++) {
                        var drawOrderMap = drawOrderNode[j];
                        var drawOrder = null;
                        var offsets = this.getValue(drawOrderMap, "offsets", null);
                        if (offsets != null) {
                            drawOrder = core.Utils.newArray(slotCount, -1);
                            var unchanged = core.Utils.newArray(slotCount - offsets.length, 0);
                            var originalIndex = 0,
                                unchangedIndex = 0;
                            for (var i = 0; i < offsets.length; i++) {
                                var offsetMap = offsets[i];
                                var slotIndex = skeletonData.findSlotIndex(offsetMap.slot);
                                if (slotIndex == -1) throw new Error("Slot not found: " + offsetMap.slot);
                                while (originalIndex != slotIndex) unchanged[unchangedIndex++] = originalIndex++;
                                drawOrder[originalIndex + offsetMap.offset] = originalIndex++
                            }
                            while (originalIndex < slotCount) unchanged[unchangedIndex++] = originalIndex++;
                            for (var i = slotCount - 1; i >= 0; i--)
                                if (drawOrder[i] == -1) drawOrder[i] = unchanged[--unchangedIndex]
                        }
                        timeline.setFrame(frameIndex++, drawOrderMap.time, drawOrder)
                    }
                    timelines.push(timeline);
                    duration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1])
                }
                if (map.events) {
                    var timeline = new core.EventTimeline(map.events.length);
                    var frameIndex = 0;
                    for (var i = 0; i < map.events.length; i++) {
                        var eventMap = map.events[i];
                        var eventData = skeletonData.findEvent(eventMap.name);
                        if (eventData == null) throw new Error("Event not found: " + eventMap.name);
                        var event_5 = new core.Event(core.Utils.toSinglePrecision(eventMap.time), eventData);
                        event_5.intValue = this.getValue(eventMap, "int", eventData.intValue);
                        event_5.floatValue = this.getValue(eventMap, "float", eventData.floatValue);
                        event_5.stringValue = this.getValue(eventMap, "string", eventData.stringValue);
                        timeline.setFrame(frameIndex++, event_5)
                    }
                    timelines.push(timeline);
                    duration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1])
                }
                if (isNaN(duration)) {
                    throw new Error("Error while parsing animation, duration is NaN")
                }
                skeletonData.animations.push(new core.Animation(name, timelines, duration))
            };
            SkeletonJson.prototype.readCurve = function(map, timeline, frameIndex) {
                if (!map.curve) return;
                if (map.curve === "stepped") timeline.setStepped(frameIndex);
                else if (Object.prototype.toString.call(map.curve) === "[object Array]") {
                    var curve = map.curve;
                    timeline.setCurve(frameIndex, curve[0], curve[1], curve[2], curve[3])
                }
            };
            SkeletonJson.prototype.getValue = function(map, prop, defaultValue) {
                return map[prop] !== undefined ? map[prop] : defaultValue
            };
            SkeletonJson.blendModeFromString = function(str) {
                str = str.toLowerCase();
                if (str == "normal") return core.BlendMode.Normal;
                if (str == "additive") return core.BlendMode.Additive;
                if (str == "multiply") return core.BlendMode.Multiply;
                if (str == "screen") return core.BlendMode.Screen;
                throw new Error("Unknown blend mode: " + str)
            };
            SkeletonJson.positionModeFromString = function(str) {
                str = str.toLowerCase();
                if (str == "fixed") return core.PositionMode.Fixed;
                if (str == "percent") return core.PositionMode.Percent;
                throw new Error("Unknown position mode: " + str)
            };
            SkeletonJson.spacingModeFromString = function(str) {
                str = str.toLowerCase();
                if (str == "length") return core.SpacingMode.Length;
                if (str == "fixed") return core.SpacingMode.Fixed;
                if (str == "percent") return core.SpacingMode.Percent;
                throw new Error("Unknown position mode: " + str)
            };
            SkeletonJson.rotateModeFromString = function(str) {
                str = str.toLowerCase();
                if (str == "tangent") return core.RotateMode.Tangent;
                if (str == "chain") return core.RotateMode.Chain;
                if (str == "chainscale") return core.RotateMode.ChainScale;
                throw new Error("Unknown rotate mode: " + str)
            };
            SkeletonJson.transformModeFromString = function(str) {
                str = str.toLowerCase();
                if (str == "normal") return core.TransformMode.Normal;
                if (str == "onlytranslation") return core.TransformMode.OnlyTranslation;
                if (str == "norotationorreflection") return core.TransformMode.NoRotationOrReflection;
                if (str == "noscale") return core.TransformMode.NoScale;
                if (str == "noscaleorreflection") return core.TransformMode.NoScaleOrReflection;
                throw new Error("Unknown transform mode: " + str)
            };
            return SkeletonJson
        }();
        core.SkeletonJson = SkeletonJson;
        var LinkedMesh = function() {
            function LinkedMesh(mesh, skin, slotIndex, parent) {
                this.mesh = mesh;
                this.skin = skin;
                this.slotIndex = slotIndex;
                this.parent = parent
            }
            return LinkedMesh
        }()
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Skin = function() {
            function Skin(name) {
                this.attachments = new Array;
                if (name == null) throw new Error("name cannot be null.");
                this.name = name
            }
            Skin.prototype.addAttachment = function(slotIndex, name, attachment) {
                if (attachment == null) throw new Error("attachment cannot be null.");
                var attachments = this.attachments;
                if (slotIndex >= attachments.length) attachments.length = slotIndex + 1;
                if (!attachments[slotIndex]) attachments[slotIndex] = {};
                attachments[slotIndex][name] = attachment
            };
            Skin.prototype.getAttachment = function(slotIndex, name) {
                var dictionary = this.attachments[slotIndex];
                return dictionary ? dictionary[name] : null
            };
            Skin.prototype.attachAll = function(skeleton, oldSkin) {
                var slotIndex = 0;
                for (var i = 0; i < skeleton.slots.length; i++) {
                    var slot = skeleton.slots[i];
                    var slotAttachment = slot.getAttachment();
                    if (slotAttachment && slotIndex < oldSkin.attachments.length) {
                        var dictionary = oldSkin.attachments[slotIndex];
                        for (var key in dictionary) {
                            var skinAttachment = dictionary[key];
                            if (slotAttachment == skinAttachment) {
                                var attachment = this.getAttachment(slotIndex, name);
                                if (attachment != null) slot.setAttachment(attachment);
                                break
                            }
                        }
                    }
                    slotIndex++
                }
            };
            return Skin
        }();
        core.Skin = Skin
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Slot = function() {
            function Slot(data, bone) {
                this.attachmentVertices = new Array;
                if (data == null) throw new Error("data cannot be null.");
                if (bone == null) throw new Error("bone cannot be null.");
                this.data = data;
                this.bone = bone;
                this.color = new core.Color;
                this.darkColor = data.darkColor == null ? null : new core.Color;
                this.setToSetupPose();
                this.blendMode = this.data.blendMode
            }
            Slot.prototype.getAttachment = function() {
                return this.attachment
            };
            Slot.prototype.setAttachment = function(attachment) {
                if (this.attachment == attachment) return;
                this.attachment = attachment;
                this.attachmentTime = this.bone.skeleton.time;
                this.attachmentVertices.length = 0
            };
            Slot.prototype.setAttachmentTime = function(time) {
                this.attachmentTime = this.bone.skeleton.time - time
            };
            Slot.prototype.getAttachmentTime = function() {
                return this.bone.skeleton.time - this.attachmentTime
            };
            Slot.prototype.setToSetupPose = function() {
                this.color.setFromColor(this.data.color);
                if (this.darkColor != null) this.darkColor.setFromColor(this.data.darkColor);
                if (this.data.attachmentName == null) this.attachment = null;
                else {
                    this.attachment = null;
                    this.setAttachment(this.bone.skeleton.getAttachment(this.data.index, this.data.attachmentName))
                }
            };
            return Slot
        }();
        core.Slot = Slot
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var SlotData = function() {
            function SlotData(index, name, boneData) {
                this.color = new core.Color(1, 1, 1, 1);
                if (index < 0) throw new Error("index must be >= 0.");
                if (name == null) throw new Error("name cannot be null.");
                if (boneData == null) throw new Error("boneData cannot be null.");
                this.index = index;
                this.name = name;
                this.boneData = boneData
            }
            return SlotData
        }();
        core.SlotData = SlotData
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Texture = function() {
            function Texture(image) {
                this._image = image
            }
            Texture.prototype.getImage = function() {
                return this._image
            };
            Texture.filterFromString = function(text) {
                switch (text.toLowerCase()) {
                    case "nearest":
                        return TextureFilter.Nearest;
                    case "linear":
                        return TextureFilter.Linear;
                    case "mipmap":
                        return TextureFilter.MipMap;
                    case "mipmapnearestnearest":
                        return TextureFilter.MipMapNearestNearest;
                    case "mipmaplinearnearest":
                        return TextureFilter.MipMapLinearNearest;
                    case "mipmapnearestlinear":
                        return TextureFilter.MipMapNearestLinear;
                    case "mipmaplinearlinear":
                        return TextureFilter.MipMapLinearLinear;
                    default:
                        throw new Error("Unknown texture filter " + text)
                }
            };
            Texture.wrapFromString = function(text) {
                switch (text.toLowerCase()) {
                    case "mirroredtepeat":
                        return TextureWrap.MirroredRepeat;
                    case "clamptoedge":
                        return TextureWrap.ClampToEdge;
                    case "repeat":
                        return TextureWrap.Repeat;
                    default:
                        throw new Error("Unknown texture wrap " + text)
                }
            };
            return Texture
        }();
        core.Texture = Texture;
        var TextureFilter;
        (function(TextureFilter) {
            TextureFilter[TextureFilter["Nearest"] = 9728] = "Nearest";
            TextureFilter[TextureFilter["Linear"] = 9729] = "Linear";
            TextureFilter[TextureFilter["MipMap"] = 9987] = "MipMap";
            TextureFilter[TextureFilter["MipMapNearestNearest"] = 9984] = "MipMapNearestNearest";
            TextureFilter[TextureFilter["MipMapLinearNearest"] = 9985] = "MipMapLinearNearest";
            TextureFilter[TextureFilter["MipMapNearestLinear"] = 9986] = "MipMapNearestLinear";
            TextureFilter[TextureFilter["MipMapLinearLinear"] = 9987] = "MipMapLinearLinear"
        })(TextureFilter = core.TextureFilter || (core.TextureFilter = {}));
        var TextureWrap;
        (function(TextureWrap) {
            TextureWrap[TextureWrap["MirroredRepeat"] = 33648] = "MirroredRepeat";
            TextureWrap[TextureWrap["ClampToEdge"] = 33071] = "ClampToEdge";
            TextureWrap[TextureWrap["Repeat"] = 10497] = "Repeat"
        })(TextureWrap = core.TextureWrap || (core.TextureWrap = {}));
        var TextureRegion = function() {
            function TextureRegion() {
                this.size = null
            }
            Object.defineProperty(TextureRegion.prototype, "width", {
                get: function() {
                    var tex = this.texture;
                    if (PIXI.VERSION[0] == "3") {
                        return tex.crop.width
                    }
                    if (tex.trim) {
                        return tex.trim.width
                    }
                    return tex.orig.width
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "height", {
                get: function() {
                    var tex = this.texture;
                    if (PIXI.VERSION[0] == "3") {
                        return tex.crop.height
                    }
                    if (tex.trim) {
                        return tex.trim.height
                    }
                    return tex.orig.height
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "u", {
                get: function() {
                    return this.texture._uvs.x0
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "v", {
                get: function() {
                    return this.texture._uvs.y0
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "u2", {
                get: function() {
                    return this.texture._uvs.x2
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "v2", {
                get: function() {
                    return this.texture._uvs.y2
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "offsetX", {
                get: function() {
                    var tex = this.texture;
                    return tex.trim ? tex.trim.x : 0
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "offsetY", {
                get: function() {
                    console.warn("Deprecation Warning: @Hackerham: I guess, if you are using PIXI-SPINE ATLAS region.offsetY, you want a texture, right? Use region.texture from now on.");
                    return this.spineOffsetY
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "pixiOffsetY", {
                get: function() {
                    var tex = this.texture;
                    return tex.trim ? tex.trim.y : 0
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "spineOffsetY", {
                get: function() {
                    var tex = this.texture;
                    return this.originalHeight - this.height - (tex.trim ? tex.trim.y : 0)
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "originalWidth", {
                get: function() {
                    var tex = this.texture;
                    if (PIXI.VERSION[0] == "3") {
                        if (tex.trim) {
                            return tex.trim.width
                        }
                        return tex.crop.width
                    }
                    return tex.orig.width
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "originalHeight", {
                get: function() {
                    var tex = this.texture;
                    if (PIXI.VERSION[0] == "3") {
                        if (tex.trim) {
                            return tex.trim.height
                        }
                        return tex.crop.height
                    }
                    return tex.orig.height
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "x", {
                get: function() {
                    return this.texture.frame.x
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "y", {
                get: function() {
                    return this.texture.frame.y
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(TextureRegion.prototype, "rotate", {
                get: function() {
                    return this.texture.rotate !== 0
                },
                enumerable: true,
                configurable: true
            });
            return TextureRegion
        }();
        core.TextureRegion = TextureRegion
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var TextureAtlas = function() {
            function TextureAtlas(atlasText, textureLoader, callback) {
                this.pages = new Array;
                this.regions = new Array;
                if (atlasText) {
                    this.addSpineAtlas(atlasText, textureLoader, callback)
                }
            }
            TextureAtlas.prototype.addTexture = function(name, texture) {
                var pages = this.pages;
                var page = null;
                for (var i = 0; i < pages.length; i++) {
                    if (pages[i].baseTexture === texture.baseTexture) {
                        page = pages[i];
                        break
                    }
                }
                if (page === null) {
                    page = new TextureAtlasPage;
                    page.name = "texturePage";
                    var baseTexture = texture.baseTexture;
                    page.width = baseTexture.realWidth;
                    page.height = baseTexture.realHeight;
                    page.baseTexture = baseTexture;
                    page.minFilter = page.magFilter = core.TextureFilter.Nearest;
                    page.uWrap = core.TextureWrap.ClampToEdge;
                    page.vWrap = core.TextureWrap.ClampToEdge;
                    pages.push(page)
                }
                var region = new TextureAtlasRegion;
                region.name = name;
                region.page = page;
                region.texture = texture;
                region.index = -1;
                this.regions.push(region);
                return region
            };
            TextureAtlas.prototype.addTextureHash = function(textures, stripExtension) {
                for (var key in textures) {
                    if (textures.hasOwnProperty(key)) {
                        this.addTexture(stripExtension && key.indexOf(".") !== -1 ? key.substr(0, key.lastIndexOf(".")) : key, textures[key])
                    }
                }
            };
            TextureAtlas.prototype.addSpineAtlas = function(atlasText, textureLoader, callback) {
                return this.load(atlasText, textureLoader, callback)
            };
            TextureAtlas.prototype.load = function(atlasText, textureLoader, callback) {
                var _this = this;
                if (textureLoader == null) throw new Error("textureLoader cannot be null.");
                var reader = new TextureAtlasReader(atlasText);
                var tuple = new Array(4);
                var page = null;
                var iterateParser = function() {
                    while (true) {
                        var line = reader.readLine();
                        if (line == null) {
                            return callback && callback(_this)
                        }
                        line = line.trim();
                        if (line.length == 0) page = null;
                        else if (!page) {
                            page = new TextureAtlasPage;
                            page.name = line;
                            if (reader.readTuple(tuple) == 2) {
                                page.width = parseInt(tuple[0]);
                                page.height = parseInt(tuple[1]);
                                reader.readTuple(tuple)
                            }
                            reader.readTuple(tuple);
                            page.minFilter = core.Texture.filterFromString(tuple[0]);
                            page.magFilter = core.Texture.filterFromString(tuple[1]);
                            var direction = reader.readValue();
                            page.uWrap = core.TextureWrap.ClampToEdge;
                            page.vWrap = core.TextureWrap.ClampToEdge;
                            if (direction == "x") page.uWrap = core.TextureWrap.Repeat;
                            else if (direction == "y") page.vWrap = core.TextureWrap.Repeat;
                            else if (direction == "xy") page.uWrap = page.vWrap = core.TextureWrap.Repeat;
                            textureLoader(line, function(texture) {
                                page.baseTexture = texture;
                                if (!texture.hasLoaded) {
                                    texture.width = page.width;
                                    texture.height = page.height
                                }
                                _this.pages.push(page);
                                page.setFilters();
                                if (!page.width || !page.height) {
                                    page.width = texture.realWidth;
                                    page.height = texture.realHeight;
                                    if (!page.width || !page.height) {
                                        console.log("ERROR spine atlas page " + page.name + ": meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)")
                                    }
                                }
                                iterateParser()
                            });
                            _this.pages.push(page);
                            break
                        } else {
                            var region = new TextureAtlasRegion;
                            region.name = line;
                            region.page = page;
                            var rotate = reader.readValue() == "true" ? 6 : 0;
                            reader.readTuple(tuple);
                            var x = parseInt(tuple[0]);
                            var y = parseInt(tuple[1]);
                            reader.readTuple(tuple);
                            var width = parseInt(tuple[0]);
                            var height = parseInt(tuple[1]);
                            var resolution = page.baseTexture.resolution;
                            x /= resolution;
                            y /= resolution;
                            width /= resolution;
                            height /= resolution;
                            var frame = new PIXI.Rectangle(x, y, rotate ? height : width, rotate ? width : height);
                            if (reader.readTuple(tuple) == 4) {
                                if (reader.readTuple(tuple) == 4) {
                                    reader.readTuple(tuple)
                                }
                            }
                            var originalWidth = parseInt(tuple[0]) / resolution;
                            var originalHeight = parseInt(tuple[1]) / resolution;
                            reader.readTuple(tuple);
                            var offsetX = parseInt(tuple[0]) / resolution;
                            var offsetY = parseInt(tuple[1]) / resolution;
                            var orig = new PIXI.Rectangle(0, 0, originalWidth, originalHeight);
                            var trim = new PIXI.Rectangle(offsetX, originalHeight - height - offsetY, width, height);
                            if (PIXI.VERSION[0] != "3") {
                                region.texture = new PIXI.Texture(region.page.baseTexture, frame, orig, trim, rotate)
                            } else {
                                var frame2 = new PIXI.Rectangle(x, y, width, height);
                                var crop = frame2.clone();
                                trim.width = originalWidth;
                                trim.height = originalHeight;
                                region.texture = new PIXI.Texture(region.page.baseTexture, frame2, crop, trim, rotate)
                            }
                            region.index = parseInt(reader.readValue());
                            region.texture._updateUvs();
                            _this.regions.push(region)
                        }
                    }
                };
                iterateParser()
            };
            TextureAtlas.prototype.findRegion = function(name) {
                for (var i = 0; i < this.regions.length; i++) {
                    if (this.regions[i].name == name) {
                        return this.regions[i]
                    }
                }
                return null
            };
            TextureAtlas.prototype.dispose = function() {
                for (var i = 0; i < this.pages.length; i++) {
                    this.pages[i].baseTexture.dispose()
                }
            };
            return TextureAtlas
        }();
        core.TextureAtlas = TextureAtlas;
        var TextureAtlasReader = function() {
            function TextureAtlasReader(text) {
                this.index = 0;
                this.lines = text.split(/\r\n|\r|\n/)
            }
            TextureAtlasReader.prototype.readLine = function() {
                if (this.index >= this.lines.length) return null;
                return this.lines[this.index++]
            };
            TextureAtlasReader.prototype.readValue = function() {
                var line = this.readLine();
                var colon = line.indexOf(":");
                if (colon == -1) throw new Error("Invalid line: " + line);
                return line.substring(colon + 1).trim()
            };
            TextureAtlasReader.prototype.readTuple = function(tuple) {
                var line = this.readLine();
                var colon = line.indexOf(":");
                if (colon == -1) throw new Error("Invalid line: " + line);
                var i = 0,
                    lastMatch = colon + 1;
                for (; i < 3; i++) {
                    var comma = line.indexOf(",", lastMatch);
                    if (comma == -1) break;
                    tuple[i] = line.substr(lastMatch, comma - lastMatch).trim();
                    lastMatch = comma + 1
                }
                tuple[i] = line.substring(lastMatch).trim();
                return i + 1
            };
            return TextureAtlasReader
        }();
        var TextureAtlasPage = function() {
            function TextureAtlasPage() {}
            TextureAtlasPage.prototype.setFilters = function() {
                var tex = this.baseTexture;
                var filter = this.minFilter;
                if (filter == core.TextureFilter.Linear) {
                    tex.scaleMode = PIXI.SCALE_MODES.LINEAR
                } else if (this.minFilter == core.TextureFilter.Nearest) {
                    tex.scaleMode = PIXI.SCALE_MODES.NEAREST
                } else {
                    tex.mipmap = true;
                    if (filter == core.TextureFilter.MipMapNearestNearest) {
                        tex.scaleMode = PIXI.SCALE_MODES.NEAREST
                    } else {
                        tex.scaleMode = PIXI.SCALE_MODES.LINEAR
                    }
                }
            };
            return TextureAtlasPage
        }();
        core.TextureAtlasPage = TextureAtlasPage;
        var TextureAtlasRegion = function(_super) {
            __extends(TextureAtlasRegion, _super);

            function TextureAtlasRegion() {
                return _super !== null && _super.apply(this, arguments) || this
            }
            return TextureAtlasRegion
        }(core.TextureRegion);
        core.TextureAtlasRegion = TextureAtlasRegion
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var TransformConstraint = function() {
            function TransformConstraint(data, skeleton) {
                this.rotateMix = 0;
                this.translateMix = 0;
                this.scaleMix = 0;
                this.shearMix = 0;
                this.temp = new core.Vector2;
                if (data == null) throw new Error("data cannot be null.");
                if (skeleton == null) throw new Error("skeleton cannot be null.");
                this.data = data;
                this.rotateMix = data.rotateMix;
                this.translateMix = data.translateMix;
                this.scaleMix = data.scaleMix;
                this.shearMix = data.shearMix;
                this.bones = new Array;
                for (var i = 0; i < data.bones.length; i++) this.bones.push(skeleton.findBone(data.bones[i].name));
                this.target = skeleton.findBone(data.target.name)
            }
            TransformConstraint.prototype.apply = function() {
                this.update()
            };
            TransformConstraint.prototype.update = function() {
                if (this.data.local) {
                    if (this.data.relative) this.applyRelativeLocal();
                    else this.applyAbsoluteLocal()
                } else {
                    if (this.data.relative) this.applyRelativeWorld();
                    else this.applyAbsoluteWorld()
                }
            };
            TransformConstraint.prototype.applyAbsoluteWorld = function() {
                var rotateMix = this.rotateMix,
                    translateMix = this.translateMix,
                    scaleMix = this.scaleMix,
                    shearMix = this.shearMix;
                var target = this.target;
                var targetMat = target.matrix;
                var ta = targetMat.a,
                    tb = targetMat.c,
                    tc = targetMat.b,
                    td = targetMat.d;
                var degRadReflect = ta * td - tb * tc > 0 ? core.MathUtils.degRad : -core.MathUtils.degRad;
                var offsetRotation = this.data.offsetRotation * degRadReflect;
                var offsetShearY = this.data.offsetShearY * degRadReflect;
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) {
                    var bone = bones[i];
                    var modified = false;
                    var mat = bone.matrix;
                    if (rotateMix != 0) {
                        var a = mat.a,
                            b = mat.c,
                            c = mat.b,
                            d = mat.d;
                        var r = Math.atan2(tc, ta) - Math.atan2(c, a) + offsetRotation;
                        if (r > core.MathUtils.PI) r -= core.MathUtils.PI2;
                        else if (r < -core.MathUtils.PI) r += core.MathUtils.PI2;
                        r *= rotateMix;
                        var cos = Math.cos(r),
                            sin = Math.sin(r);
                        mat.a = cos * a - sin * c;
                        mat.c = cos * b - sin * d;
                        mat.b = sin * a + cos * c;
                        mat.d = sin * b + cos * d;
                        modified = true
                    }
                    if (translateMix != 0) {
                        var temp = this.temp;
                        target.localToWorld(temp.set(this.data.offsetX, this.data.offsetY));
                        mat.tx += (temp.x - mat.tx) * translateMix;
                        mat.ty += (temp.y - mat.ty) * translateMix;
                        modified = true
                    }
                    if (scaleMix > 0) {
                        var s = Math.sqrt(mat.a * mat.a + mat.b * mat.b);
                        var ts = Math.sqrt(ta * ta + tc * tc);
                        if (s > 1e-5) s = (s + (ts - s + this.data.offsetScaleX) * scaleMix) / s;
                        mat.a *= s;
                        mat.b *= s;
                        s = Math.sqrt(mat.c * mat.c + mat.d * mat.d);
                        ts = Math.sqrt(tb * tb + td * td);
                        if (s > 1e-5) s = (s + (ts - s + this.data.offsetScaleY) * scaleMix) / s;
                        mat.c *= s;
                        mat.d *= s;
                        modified = true
                    }
                    if (shearMix > 0) {
                        var b = mat.c,
                            d = mat.d;
                        var by = Math.atan2(d, b);
                        var r = Math.atan2(td, tb) - Math.atan2(tc, ta) - (by - Math.atan2(mat.b, mat.a));
                        if (r > core.MathUtils.PI) r -= core.MathUtils.PI2;
                        else if (r < -core.MathUtils.PI) r += core.MathUtils.PI2;
                        r = by + (r + offsetShearY) * shearMix;
                        var s = Math.sqrt(b * b + d * d);
                        mat.c = Math.cos(r) * s;
                        mat.d = Math.sin(r) * s;
                        modified = true
                    }
                    if (modified) bone.appliedValid = false
                }
            };
            TransformConstraint.prototype.applyRelativeWorld = function() {
                var rotateMix = this.rotateMix,
                    translateMix = this.translateMix,
                    scaleMix = this.scaleMix,
                    shearMix = this.shearMix;
                var target = this.target;
                var targetMat = target.matrix;
                var ta = targetMat.a,
                    tb = targetMat.c,
                    tc = targetMat.b,
                    td = targetMat.d;
                var degRadReflect = ta * td - tb * tc > 0 ? core.MathUtils.degRad : -core.MathUtils.degRad;
                var offsetRotation = this.data.offsetRotation * degRadReflect,
                    offsetShearY = this.data.offsetShearY * degRadReflect;
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) {
                    var bone = bones[i];
                    var modified = false;
                    var mat = bone.matrix;
                    if (rotateMix != 0) {
                        var a = mat.a,
                            b = mat.c,
                            c = mat.b,
                            d = mat.d;
                        var r = Math.atan2(tc, ta) + offsetRotation;
                        if (r > core.MathUtils.PI) r -= core.MathUtils.PI2;
                        else if (r < -core.MathUtils.PI) r += core.MathUtils.PI2;
                        r *= rotateMix;
                        var cos = Math.cos(r),
                            sin = Math.sin(r);
                        mat.a = cos * a - sin * c;
                        mat.c = cos * b - sin * d;
                        mat.b = sin * a + cos * c;
                        mat.d = sin * b + cos * d;
                        modified = true
                    }
                    if (translateMix != 0) {
                        var temp = this.temp;
                        target.localToWorld(temp.set(this.data.offsetX, this.data.offsetY));
                        mat.tx += temp.x * translateMix;
                        mat.ty += temp.y * translateMix;
                        modified = true
                    }
                    if (scaleMix > 0) {
                        var s = (Math.sqrt(ta * ta + tc * tc) - 1 + this.data.offsetScaleX) * scaleMix + 1;
                        mat.a *= s;
                        mat.b *= s;
                        s = (Math.sqrt(tb * tb + td * td) - 1 + this.data.offsetScaleY) * scaleMix + 1;
                        mat.c *= s;
                        mat.d *= s;
                        modified = true
                    }
                    if (shearMix > 0) {
                        var r = Math.atan2(td, tb) - Math.atan2(tc, ta);
                        if (r > core.MathUtils.PI) r -= core.MathUtils.PI2;
                        else if (r < -core.MathUtils.PI) r += core.MathUtils.PI2;
                        var b = mat.c,
                            d = mat.d;
                        r = Math.atan2(d, b) + (r - core.MathUtils.PI / 2 + offsetShearY) * shearMix;
                        var s = Math.sqrt(b * b + d * d);
                        mat.c = Math.cos(r) * s;
                        mat.d = Math.sin(r) * s;
                        modified = true
                    }
                    if (modified) bone.appliedValid = false
                }
            };
            TransformConstraint.prototype.applyAbsoluteLocal = function() {
                var rotateMix = this.rotateMix,
                    translateMix = this.translateMix,
                    scaleMix = this.scaleMix,
                    shearMix = this.shearMix;
                var target = this.target;
                if (!target.appliedValid) target.updateAppliedTransform();
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) {
                    var bone = bones[i];
                    if (!bone.appliedValid) bone.updateAppliedTransform();
                    var rotation = bone.arotation;
                    if (rotateMix != 0) {
                        var r = target.arotation - rotation + this.data.offsetRotation;
                        r -= (16384 - (16384.499999999996 - r / 360 | 0)) * 360;
                        rotation += r * rotateMix
                    }
                    var x = bone.ax,
                        y = bone.ay;
                    if (translateMix != 0) {
                        x += (target.ax - x + this.data.offsetX) * translateMix;
                        y += (target.ay - y + this.data.offsetY) * translateMix
                    }
                    var scaleX = bone.ascaleX,
                        scaleY = bone.ascaleY;
                    if (scaleMix > 0) {
                        if (scaleX > 1e-5) scaleX = (scaleX + (target.ascaleX - scaleX + this.data.offsetScaleX) * scaleMix) / scaleX;
                        if (scaleY > 1e-5) scaleY = (scaleY + (target.ascaleY - scaleY + this.data.offsetScaleY) * scaleMix) / scaleY
                    }
                    var shearY = bone.ashearY;
                    if (shearMix > 0) {
                        var r = target.ashearY - shearY + this.data.offsetShearY;
                        r -= (16384 - (16384.499999999996 - r / 360 | 0)) * 360;
                        bone.shearY += r * shearMix
                    }
                    bone.updateWorldTransformWith(x, y, rotation, scaleX, scaleY, bone.ashearX, shearY)
                }
            };
            TransformConstraint.prototype.applyRelativeLocal = function() {
                var rotateMix = this.rotateMix,
                    translateMix = this.translateMix,
                    scaleMix = this.scaleMix,
                    shearMix = this.shearMix;
                var target = this.target;
                if (!target.appliedValid) target.updateAppliedTransform();
                var bones = this.bones;
                for (var i = 0, n = bones.length; i < n; i++) {
                    var bone = bones[i];
                    if (!bone.appliedValid) bone.updateAppliedTransform();
                    var rotation = bone.arotation;
                    if (rotateMix != 0) rotation += (target.arotation + this.data.offsetRotation) * rotateMix;
                    var x = bone.ax,
                        y = bone.ay;
                    if (translateMix != 0) {
                        x += (target.ax + this.data.offsetX) * translateMix;
                        y += (target.ay + this.data.offsetY) * translateMix
                    }
                    var scaleX = bone.ascaleX,
                        scaleY = bone.ascaleY;
                    if (scaleMix > 0) {
                        if (scaleX > 1e-5) scaleX *= (target.ascaleX - 1 + this.data.offsetScaleX) * scaleMix + 1;
                        if (scaleY > 1e-5) scaleY *= (target.ascaleY - 1 + this.data.offsetScaleY) * scaleMix + 1
                    }
                    var shearY = bone.ashearY;
                    if (shearMix > 0) shearY += (target.ashearY + this.data.offsetShearY) * shearMix;
                    bone.updateWorldTransformWith(x, y, rotation, scaleX, scaleY, bone.ashearX, shearY)
                }
            };
            TransformConstraint.prototype.getOrder = function() {
                return this.data.order
            };
            return TransformConstraint
        }();
        core.TransformConstraint = TransformConstraint
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var TransformConstraintData = function() {
            function TransformConstraintData(name) {
                this.order = 0;
                this.bones = new Array;
                this.rotateMix = 0;
                this.translateMix = 0;
                this.scaleMix = 0;
                this.shearMix = 0;
                this.offsetRotation = 0;
                this.offsetX = 0;
                this.offsetY = 0;
                this.offsetScaleX = 0;
                this.offsetScaleY = 0;
                this.offsetShearY = 0;
                this.relative = false;
                this.local = false;
                if (name == null) throw new Error("name cannot be null.");
                this.name = name
            }
            return TransformConstraintData
        }();
        core.TransformConstraintData = TransformConstraintData
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Triangulator = function() {
            function Triangulator() {
                this.convexPolygons = new Array;
                this.convexPolygonsIndices = new Array;
                this.indicesArray = new Array;
                this.isConcaveArray = new Array;
                this.triangles = new Array;
                this.polygonPool = new core.Pool(function() {
                    return new Array
                });
                this.polygonIndicesPool = new core.Pool(function() {
                    return new Array
                })
            }
            Triangulator.prototype.triangulate = function(verticesArray) {
                var vertices = verticesArray;
                var vertexCount = verticesArray.length >> 1;
                var indices = this.indicesArray;
                indices.length = 0;
                for (var i = 0; i < vertexCount; i++) indices[i] = i;
                var isConcave = this.isConcaveArray;
                isConcave.length = 0;
                for (var i = 0, n = vertexCount; i < n; ++i) isConcave[i] = Triangulator.isConcave(i, vertexCount, vertices, indices);
                var triangles = this.triangles;
                triangles.length = 0;
                while (vertexCount > 3) {
                    var previous = vertexCount - 1,
                        i = 0,
                        next = 1;
                    while (true) {
                        outer: if (!isConcave[i]) {
                            var p1 = indices[previous] << 1,
                                p2 = indices[i] << 1,
                                p3 = indices[next] << 1;
                            var p1x = vertices[p1],
                                p1y = vertices[p1 + 1];
                            var p2x = vertices[p2],
                                p2y = vertices[p2 + 1];
                            var p3x = vertices[p3],
                                p3y = vertices[p3 + 1];
                            for (var ii = (next + 1) % vertexCount; ii != previous; ii = (ii + 1) % vertexCount) {
                                if (!isConcave[ii]) continue;
                                var v = indices[ii] << 1;
                                var vx = vertices[v],
                                    vy = vertices[v + 1];
                                if (Triangulator.positiveArea(p3x, p3y, p1x, p1y, vx, vy)) {
                                    if (Triangulator.positiveArea(p1x, p1y, p2x, p2y, vx, vy)) {
                                        if (Triangulator.positiveArea(p2x, p2y, p3x, p3y, vx, vy)) break outer
                                    }
                                }
                            }
                            break
                        }if (next == 0) {
                            do {
                                if (!isConcave[i]) break;
                                i--
                            } while (i > 0);
                            break
                        }
                        previous = i;i = next;next = (next + 1) % vertexCount
                    }
                    triangles.push(indices[(vertexCount + i - 1) % vertexCount]);
                    triangles.push(indices[i]);
                    triangles.push(indices[(i + 1) % vertexCount]);
                    indices.splice(i, 1);
                    isConcave.splice(i, 1);
                    vertexCount--;
                    var previousIndex = (vertexCount + i - 1) % vertexCount;
                    var nextIndex = i == vertexCount ? 0 : i;
                    isConcave[previousIndex] = Triangulator.isConcave(previousIndex, vertexCount, vertices, indices);
                    isConcave[nextIndex] = Triangulator.isConcave(nextIndex, vertexCount, vertices, indices)
                }
                if (vertexCount == 3) {
                    triangles.push(indices[2]);
                    triangles.push(indices[0]);
                    triangles.push(indices[1])
                }
                return triangles
            };
            Triangulator.prototype.decompose = function(verticesArray, triangles) {
                var vertices = verticesArray;
                var convexPolygons = this.convexPolygons;
                this.polygonPool.freeAll(convexPolygons);
                convexPolygons.length = 0;
                var convexPolygonsIndices = this.convexPolygonsIndices;
                this.polygonIndicesPool.freeAll(convexPolygonsIndices);
                convexPolygonsIndices.length = 0;
                var polygonIndices = this.polygonIndicesPool.obtain();
                polygonIndices.length = 0;
                var polygon = this.polygonPool.obtain();
                polygon.length = 0;
                var fanBaseIndex = -1,
                    lastWinding = 0;
                for (var i = 0, n = triangles.length; i < n; i += 3) {
                    var t1 = triangles[i] << 1,
                        t2 = triangles[i + 1] << 1,
                        t3 = triangles[i + 2] << 1;
                    var x1 = vertices[t1],
                        y1 = vertices[t1 + 1];
                    var x2 = vertices[t2],
                        y2 = vertices[t2 + 1];
                    var x3 = vertices[t3],
                        y3 = vertices[t3 + 1];
                    var merged = false;
                    if (fanBaseIndex == t1) {
                        var o = polygon.length - 4;
                        var winding1 = Triangulator.winding(polygon[o], polygon[o + 1], polygon[o + 2], polygon[o + 3], x3, y3);
                        var winding2 = Triangulator.winding(x3, y3, polygon[0], polygon[1], polygon[2], polygon[3]);
                        if (winding1 == lastWinding && winding2 == lastWinding) {
                            polygon.push(x3);
                            polygon.push(y3);
                            polygonIndices.push(t3);
                            merged = true
                        }
                    }
                    if (!merged) {
                        if (polygon.length > 0) {
                            convexPolygons.push(polygon);
                            convexPolygonsIndices.push(polygonIndices)
                        } else {
                            this.polygonPool.free(polygon);
                            this.polygonIndicesPool.free(polygonIndices)
                        }
                        polygon = this.polygonPool.obtain();
                        polygon.length = 0;
                        polygon.push(x1);
                        polygon.push(y1);
                        polygon.push(x2);
                        polygon.push(y2);
                        polygon.push(x3);
                        polygon.push(y3);
                        polygonIndices = this.polygonIndicesPool.obtain();
                        polygonIndices.length = 0;
                        polygonIndices.push(t1);
                        polygonIndices.push(t2);
                        polygonIndices.push(t3);
                        lastWinding = Triangulator.winding(x1, y1, x2, y2, x3, y3);
                        fanBaseIndex = t1
                    }
                }
                if (polygon.length > 0) {
                    convexPolygons.push(polygon);
                    convexPolygonsIndices.push(polygonIndices)
                }
                for (var i = 0, n = convexPolygons.length; i < n; i++) {
                    polygonIndices = convexPolygonsIndices[i];
                    if (polygonIndices.length == 0) continue;
                    var firstIndex = polygonIndices[0];
                    var lastIndex = polygonIndices[polygonIndices.length - 1];
                    polygon = convexPolygons[i];
                    var o = polygon.length - 4;
                    var prevPrevX = polygon[o],
                        prevPrevY = polygon[o + 1];
                    var prevX = polygon[o + 2],
                        prevY = polygon[o + 3];
                    var firstX = polygon[0],
                        firstY = polygon[1];
                    var secondX = polygon[2],
                        secondY = polygon[3];
                    var winding = Triangulator.winding(prevPrevX, prevPrevY, prevX, prevY, firstX, firstY);
                    for (var ii = 0; ii < n; ii++) {
                        if (ii == i) continue;
                        var otherIndices = convexPolygonsIndices[ii];
                        if (otherIndices.length != 3) continue;
                        var otherFirstIndex = otherIndices[0];
                        var otherSecondIndex = otherIndices[1];
                        var otherLastIndex = otherIndices[2];
                        var otherPoly = convexPolygons[ii];
                        var x3 = otherPoly[otherPoly.length - 2],
                            y3 = otherPoly[otherPoly.length - 1];
                        if (otherFirstIndex != firstIndex || otherSecondIndex != lastIndex) continue;
                        var winding1 = Triangulator.winding(prevPrevX, prevPrevY, prevX, prevY, x3, y3);
                        var winding2 = Triangulator.winding(x3, y3, firstX, firstY, secondX, secondY);
                        if (winding1 == winding && winding2 == winding) {
                            otherPoly.length = 0;
                            otherIndices.length = 0;
                            polygon.push(x3);
                            polygon.push(y3);
                            polygonIndices.push(otherLastIndex);
                            prevPrevX = prevX;
                            prevPrevY = prevY;
                            prevX = x3;
                            prevY = y3;
                            ii = 0
                        }
                    }
                }
                for (var i = convexPolygons.length - 1; i >= 0; i--) {
                    polygon = convexPolygons[i];
                    if (polygon.length == 0) {
                        convexPolygons.splice(i, 1);
                        this.polygonPool.free(polygon);
                        polygonIndices = convexPolygonsIndices[i];
                        convexPolygonsIndices.splice(i, 1);
                        this.polygonIndicesPool.free(polygonIndices)
                    }
                }
                return convexPolygons
            };
            Triangulator.isConcave = function(index, vertexCount, vertices, indices) {
                var previous = indices[(vertexCount + index - 1) % vertexCount] << 1;
                var current = indices[index] << 1;
                var next = indices[(index + 1) % vertexCount] << 1;
                return !this.positiveArea(vertices[previous], vertices[previous + 1], vertices[current], vertices[current + 1], vertices[next], vertices[next + 1])
            };
            Triangulator.positiveArea = function(p1x, p1y, p2x, p2y, p3x, p3y) {
                return p1x * (p3y - p2y) + p2x * (p1y - p3y) + p3x * (p2y - p1y) >= 0
            };
            Triangulator.winding = function(p1x, p1y, p2x, p2y, p3x, p3y) {
                var px = p2x - p1x,
                    py = p2y - p1y;
                return p3x * py - p3y * px + px * p1y - p1x * py >= 0 ? 1 : -1
            };
            return Triangulator
        }();
        core.Triangulator = Triangulator
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var IntSet = function() {
            function IntSet() {
                this.array = new Array
            }
            IntSet.prototype.add = function(value) {
                var contains = this.contains(value);
                this.array[value | 0] = value | 0;
                return !contains
            };
            IntSet.prototype.contains = function(value) {
                return this.array[value | 0] != undefined
            };
            IntSet.prototype.remove = function(value) {
                this.array[value | 0] = undefined
            };
            IntSet.prototype.clear = function() {
                this.array.length = 0
            };
            return IntSet
        }();
        core.IntSet = IntSet;
        var Color = function() {
            function Color(r, g, b, a) {
                if (r === void 0) {
                    r = 0
                }
                if (g === void 0) {
                    g = 0
                }
                if (b === void 0) {
                    b = 0
                }
                if (a === void 0) {
                    a = 0
                }
                this.r = r;
                this.g = g;
                this.b = b;
                this.a = a
            }
            Color.prototype.set = function(r, g, b, a) {
                this.r = r;
                this.g = g;
                this.b = b;
                this.a = a;
                this.clamp();
                return this
            };
            Color.prototype.setFromColor = function(c) {
                this.r = c.r;
                this.g = c.g;
                this.b = c.b;
                this.a = c.a;
                return this
            };
            Color.prototype.setFromString = function(hex) {
                hex = hex.charAt(0) == "#" ? hex.substr(1) : hex;
                this.r = parseInt(hex.substr(0, 2), 16) / 255;
                this.g = parseInt(hex.substr(2, 2), 16) / 255;
                this.b = parseInt(hex.substr(4, 2), 16) / 255;
                this.a = (hex.length != 8 ? 255 : parseInt(hex.substr(6, 2), 16)) / 255;
                return this
            };
            Color.prototype.add = function(r, g, b, a) {
                this.r += r;
                this.g += g;
                this.b += b;
                this.a += a;
                this.clamp();
                return this
            };
            Color.prototype.clamp = function() {
                if (this.r < 0) this.r = 0;
                else if (this.r > 1) this.r = 1;
                if (this.g < 0) this.g = 0;
                else if (this.g > 1) this.g = 1;
                if (this.b < 0) this.b = 0;
                else if (this.b > 1) this.b = 1;
                if (this.a < 0) this.a = 0;
                else if (this.a > 1) this.a = 1;
                return this
            };
            Color.WHITE = new Color(1, 1, 1, 1);
            Color.RED = new Color(1, 0, 0, 1);
            Color.GREEN = new Color(0, 1, 0, 1);
            Color.BLUE = new Color(0, 0, 1, 1);
            Color.MAGENTA = new Color(1, 0, 1, 1);
            return Color
        }();
        core.Color = Color;
        var MathUtils = function() {
            function MathUtils() {}
            MathUtils.clamp = function(value, min, max) {
                if (value < min) return min;
                if (value > max) return max;
                return value
            };
            MathUtils.cosDeg = function(degrees) {
                return Math.cos(degrees * MathUtils.degRad)
            };
            MathUtils.sinDeg = function(degrees) {
                return Math.sin(degrees * MathUtils.degRad)
            };
            MathUtils.signum = function(value) {
                return value > 0 ? 1 : value < 0 ? -1 : 0
            };
            MathUtils.toInt = function(x) {
                return x > 0 ? Math.floor(x) : Math.ceil(x)
            };
            MathUtils.cbrt = function(x) {
                var y = Math.pow(Math.abs(x), 1 / 3);
                return x < 0 ? -y : y
            };
            MathUtils.randomTriangular = function(min, max) {
                return MathUtils.randomTriangularWith(min, max, (min + max) * .5)
            };
            MathUtils.randomTriangularWith = function(min, max, mode) {
                var u = Math.random();
                var d = max - min;
                if (u <= (mode - min) / d) return min + Math.sqrt(u * d * (mode - min));
                return max - Math.sqrt((1 - u) * d * (max - mode))
            };
            MathUtils.PI = 3.1415927;
            MathUtils.PI2 = MathUtils.PI * 2;
            MathUtils.radiansToDegrees = 180 / MathUtils.PI;
            MathUtils.radDeg = MathUtils.radiansToDegrees;
            MathUtils.degreesToRadians = MathUtils.PI / 180;
            MathUtils.degRad = MathUtils.degreesToRadians;
            return MathUtils
        }();
        core.MathUtils = MathUtils;
        var Interpolation = function() {
            function Interpolation() {}
            Interpolation.prototype.apply = function(start, end, a) {
                return start + (end - start) * this.applyInternal(a)
            };
            return Interpolation
        }();
        core.Interpolation = Interpolation;
        var Pow = function(_super) {
            __extends(Pow, _super);

            function Pow(power) {
                var _this = _super.call(this) || this;
                _this.power = 2;
                _this.power = power;
                return _this
            }
            Pow.prototype.applyInternal = function(a) {
                if (a <= .5) return Math.pow(a * 2, this.power) / 2;
                return Math.pow((a - 1) * 2, this.power) / (this.power % 2 == 0 ? -2 : 2) + 1
            };
            return Pow
        }(Interpolation);
        core.Pow = Pow;
        var PowOut = function(_super) {
            __extends(PowOut, _super);

            function PowOut(power) {
                return _super.call(this, power) || this
            }
            PowOut.prototype.applyInternal = function(a) {
                return Math.pow(a - 1, this.power) * (this.power % 2 == 0 ? -1 : 1) + 1
            };
            return PowOut
        }(Pow);
        core.PowOut = PowOut;
        var Utils = function() {
            function Utils() {}
            Utils.arrayCopy = function(source, sourceStart, dest, destStart, numElements) {
                for (var i = sourceStart, j = destStart; i < sourceStart + numElements; i++, j++) {
                    dest[j] = source[i]
                }
            };
            Utils.setArraySize = function(array, size, value) {
                if (value === void 0) {
                    value = 0
                }
                var oldSize = array.length;
                if (oldSize == size) return array;
                array.length = size;
                if (oldSize < size) {
                    for (var i = oldSize; i < size; i++) array[i] = value
                }
                return array
            };
            Utils.ensureArrayCapacity = function(array, size, value) {
                if (value === void 0) {
                    value = 0
                }
                if (array.length >= size) return array;
                return Utils.setArraySize(array, size, value)
            };
            Utils.newArray = function(size, defaultValue) {
                var array = new Array(size);
                for (var i = 0; i < size; i++) array[i] = defaultValue;
                return array
            };
            Utils.newFloatArray = function(size) {
                if (Utils.SUPPORTS_TYPED_ARRAYS) {
                    return new Float32Array(size)
                } else {
                    var array = new Array(size);
                    for (var i = 0; i < array.length; i++) array[i] = 0;
                    return array
                }
            };
            Utils.newShortArray = function(size) {
                if (Utils.SUPPORTS_TYPED_ARRAYS) {
                    return new Int16Array(size)
                } else {
                    var array = new Array(size);
                    for (var i = 0; i < array.length; i++) array[i] = 0;
                    return array
                }
            };
            Utils.toFloatArray = function(array) {
                return Utils.SUPPORTS_TYPED_ARRAYS ? new Float32Array(array) : array
            };
            Utils.toSinglePrecision = function(value) {
                return Utils.SUPPORTS_TYPED_ARRAYS ? Math.fround(value) : value
            };
            Utils.SUPPORTS_TYPED_ARRAYS = typeof Float32Array !== "undefined";
            return Utils
        }();
        core.Utils = Utils;
        var DebugUtils = function() {
            function DebugUtils() {}
            DebugUtils.logBones = function(skeleton) {
                for (var i = 0; i < skeleton.bones.length; i++) {
                    var bone = skeleton.bones[i];
                    var mat = bone.matrix;
                    console.log(bone.data.name + ", " + mat.a + ", " + mat.b + ", " + mat.c + ", " + mat.d + ", " + mat.tx + ", " + mat.ty)
                }
            };
            return DebugUtils
        }();
        core.DebugUtils = DebugUtils;
        var Pool = function() {
            function Pool(instantiator) {
                this.items = new Array;
                this.instantiator = instantiator
            }
            Pool.prototype.obtain = function() {
                return this.items.length > 0 ? this.items.pop() : this.instantiator()
            };
            Pool.prototype.free = function(item) {
                if (item.reset) item.reset();
                this.items.push(item)
            };
            Pool.prototype.freeAll = function(items) {
                for (var i = 0; i < items.length; i++) {
                    if (items[i].reset) items[i].reset();
                    this.items[i] = items[i]
                }
            };
            Pool.prototype.clear = function() {
                this.items.length = 0
            };
            return Pool
        }();
        core.Pool = Pool;
        var Vector2 = function() {
            function Vector2(x, y) {
                if (x === void 0) {
                    x = 0
                }
                if (y === void 0) {
                    y = 0
                }
                this.x = x;
                this.y = y
            }
            Vector2.prototype.set = function(x, y) {
                this.x = x;
                this.y = y;
                return this
            };
            Vector2.prototype.length = function() {
                var x = this.x;
                var y = this.y;
                return Math.sqrt(x * x + y * y)
            };
            Vector2.prototype.normalize = function() {
                var len = this.length();
                if (len != 0) {
                    this.x /= len;
                    this.y /= len
                }
                return this
            };
            return Vector2
        }();
        core.Vector2 = Vector2;
        var TimeKeeper = function() {
            function TimeKeeper() {
                this.maxDelta = .064;
                this.framesPerSecond = 0;
                this.delta = 0;
                this.totalTime = 0;
                this.lastTime = Date.now() / 1e3;
                this.frameCount = 0;
                this.frameTime = 0
            }
            TimeKeeper.prototype.update = function() {
                var now = Date.now() / 1e3;
                this.delta = now - this.lastTime;
                this.frameTime += this.delta;
                this.totalTime += this.delta;
                if (this.delta > this.maxDelta) this.delta = this.maxDelta;
                this.lastTime = now;
                this.frameCount++;
                if (this.frameTime > 1) {
                    this.framesPerSecond = this.frameCount / this.frameTime;
                    this.frameTime = 0;
                    this.frameCount = 0
                }
            };
            return TimeKeeper
        }();
        core.TimeKeeper = TimeKeeper;
        var WindowedMean = function() {
            function WindowedMean(windowSize) {
                if (windowSize === void 0) {
                    windowSize = 32
                }
                this.addedValues = 0;
                this.lastValue = 0;
                this.mean = 0;
                this.dirty = true;
                this.values = new Array(windowSize)
            }
            WindowedMean.prototype.hasEnoughData = function() {
                return this.addedValues >= this.values.length
            };
            WindowedMean.prototype.addValue = function(value) {
                if (this.addedValues < this.values.length) this.addedValues++;
                this.values[this.lastValue++] = value;
                if (this.lastValue > this.values.length - 1) this.lastValue = 0;
                this.dirty = true
            };
            WindowedMean.prototype.getMean = function() {
                if (this.hasEnoughData()) {
                    if (this.dirty) {
                        var mean = 0;
                        for (var i = 0; i < this.values.length; i++) {
                            mean += this.values[i]
                        }
                        this.mean = mean / this.values.length;
                        this.dirty = false
                    }
                    return this.mean
                } else {
                    return 0
                }
            };
            return WindowedMean
        }();
        core.WindowedMean = WindowedMean
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var Attachment = function() {
            function Attachment(name) {
                if (name == null) throw new Error("name cannot be null.");
                this.name = name
            }
            return Attachment
        }();
        core.Attachment = Attachment;
        var VertexAttachment = function(_super) {
            __extends(VertexAttachment, _super);

            function VertexAttachment(name) {
                var _this = _super.call(this, name) || this;
                _this.id = (VertexAttachment.nextID++ & 65535) << 11;
                _this.worldVerticesLength = 0;
                return _this
            }
            VertexAttachment.prototype.computeWorldVerticesOld = function(slot, worldVertices) {
                this.computeWorldVertices(slot, 0, this.worldVerticesLength, worldVertices, 0, 2)
            };
            VertexAttachment.prototype.computeWorldVertices = function(slot, start, count, worldVertices, offset, stride) {
                count = offset + (count >> 1) * stride;
                var skeleton = slot.bone.skeleton;
                var deformArray = slot.attachmentVertices;
                var vertices = this.vertices;
                var bones = this.bones;
                if (bones == null) {
                    if (deformArray.length > 0) vertices = deformArray;
                    var mat = slot.bone.matrix;
                    var x = mat.tx;
                    var y = mat.ty;
                    var a = mat.a,
                        b = mat.c,
                        c = mat.b,
                        d = mat.d;
                    for (var v_1 = start, w = offset; w < count; v_1 += 2, w += stride) {
                        var vx = vertices[v_1],
                            vy = vertices[v_1 + 1];
                        worldVertices[w] = vx * a + vy * b + x;
                        worldVertices[w + 1] = vx * c + vy * d + y
                    }
                    return
                }
                var v = 0,
                    skip = 0;
                for (var i = 0; i < start; i += 2) {
                    var n = bones[v];
                    v += n + 1;
                    skip += n
                }
                var skeletonBones = skeleton.bones;
                if (deformArray.length == 0) {
                    for (var w = offset, b = skip * 3; w < count; w += stride) {
                        var wx = 0,
                            wy = 0;
                        var n = bones[v++];
                        n += v;
                        for (; v < n; v++, b += 3) {
                            var mat = skeletonBones[bones[v]].matrix;
                            var vx = vertices[b],
                                vy = vertices[b + 1],
                                weight = vertices[b + 2];
                            wx += (vx * mat.a + vy * mat.c + mat.tx) * weight;
                            wy += (vx * mat.b + vy * mat.d + mat.ty) * weight
                        }
                        worldVertices[w] = wx;
                        worldVertices[w + 1] = wy
                    }
                } else {
                    var deform = deformArray;
                    for (var w = offset, b = skip * 3, f = skip << 1; w < count; w += stride) {
                        var wx = 0,
                            wy = 0;
                        var n = bones[v++];
                        n += v;
                        for (; v < n; v++, b += 3, f += 2) {
                            var mat = skeletonBones[bones[v]].matrix;
                            var vx = vertices[b] + deform[f],
                                vy = vertices[b + 1] + deform[f + 1],
                                weight = vertices[b + 2];
                            wx += (vx * mat.a + vy * mat.c + mat.tx) * weight;
                            wy += (vx * mat.b + vy * mat.d + mat.ty) * weight
                        }
                        worldVertices[w] = wx;
                        worldVertices[w + 1] = wy
                    }
                }
            };
            VertexAttachment.prototype.applyDeform = function(sourceAttachment) {
                return this == sourceAttachment
            };
            VertexAttachment.nextID = 0;
            return VertexAttachment
        }(Attachment);
        core.VertexAttachment = VertexAttachment
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var AttachmentType;
        (function(AttachmentType) {
            AttachmentType[AttachmentType["Region"] = 0] = "Region";
            AttachmentType[AttachmentType["BoundingBox"] = 1] = "BoundingBox";
            AttachmentType[AttachmentType["Mesh"] = 2] = "Mesh";
            AttachmentType[AttachmentType["LinkedMesh"] = 3] = "LinkedMesh";
            AttachmentType[AttachmentType["Path"] = 4] = "Path";
            AttachmentType[AttachmentType["Point"] = 5] = "Point"
        })(AttachmentType = core.AttachmentType || (core.AttachmentType = {}))
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var BoundingBoxAttachment = function(_super) {
            __extends(BoundingBoxAttachment, _super);

            function BoundingBoxAttachment(name) {
                var _this = _super.call(this, name) || this;
                _this.color = new core.Color(1, 1, 1, 1);
                return _this
            }
            return BoundingBoxAttachment
        }(core.VertexAttachment);
        core.BoundingBoxAttachment = BoundingBoxAttachment
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var ClippingAttachment = function(_super) {
            __extends(ClippingAttachment, _super);

            function ClippingAttachment(name) {
                var _this = _super.call(this, name) || this;
                _this.color = new core.Color(.2275, .2275, .8078, 1);
                return _this
            }
            return ClippingAttachment
        }(core.VertexAttachment);
        core.ClippingAttachment = ClippingAttachment
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var MeshAttachment = function(_super) {
            __extends(MeshAttachment, _super);

            function MeshAttachment(name) {
                var _this = _super.call(this, name) || this;
                _this.color = new core.Color(1, 1, 1, 1);
                _this.inheritDeform = false;
                _this.tempColor = new core.Color(0, 0, 0, 0);
                return _this
            }
            MeshAttachment.prototype.updateUVs = function(region, uvs) {
                var regionUVs = this.regionUVs;
                var n = regionUVs.length;
                if (!uvs || uvs.length != n) {
                    uvs = core.Utils.newFloatArray(n)
                }
                if (region == null) {
                    return
                }
                var texture = region.texture;
                var r = texture._uvs;
                var w1 = region.width,
                    h1 = region.height,
                    w2 = region.originalWidth,
                    h2 = region.originalHeight;
                var x = region.offsetX,
                    y = region.pixiOffsetY;
                for (var i = 0; i < n; i += 2) {
                    var u = this.regionUVs[i],
                        v = this.regionUVs[i + 1];
                    u = (u * w2 - x) / w1;
                    v = (v * h2 - y) / h1;
                    uvs[i] = (r.x0 * (1 - u) + r.x1 * u) * (1 - v) + (r.x3 * (1 - u) + r.x2 * u) * v;
                    uvs[i + 1] = (r.y0 * (1 - u) + r.y1 * u) * (1 - v) + (r.y3 * (1 - u) + r.y2 * u) * v
                }
                return uvs
            };
            MeshAttachment.prototype.applyDeform = function(sourceAttachment) {
                return this == sourceAttachment || this.inheritDeform && this.parentMesh == sourceAttachment
            };
            MeshAttachment.prototype.getParentMesh = function() {
                return this.parentMesh
            };
            MeshAttachment.prototype.setParentMesh = function(parentMesh) {
                this.parentMesh = parentMesh;
                if (parentMesh != null) {
                    this.bones = parentMesh.bones;
                    this.vertices = parentMesh.vertices;
                    this.worldVerticesLength = parentMesh.worldVerticesLength;
                    this.regionUVs = parentMesh.regionUVs;
                    this.triangles = parentMesh.triangles;
                    this.hullLength = parentMesh.hullLength;
                    this.worldVerticesLength = parentMesh.worldVerticesLength
                }
            };
            return MeshAttachment
        }(core.VertexAttachment);
        core.MeshAttachment = MeshAttachment
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var PathAttachment = function(_super) {
            __extends(PathAttachment, _super);

            function PathAttachment(name) {
                var _this = _super.call(this, name) || this;
                _this.closed = false;
                _this.constantSpeed = false;
                _this.color = new core.Color(1, 1, 1, 1);
                return _this
            }
            return PathAttachment
        }(core.VertexAttachment);
        core.PathAttachment = PathAttachment
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var PointAttachment = function(_super) {
            __extends(PointAttachment, _super);

            function PointAttachment(name) {
                var _this = _super.call(this, name) || this;
                _this.color = new core.Color(.38, .94, 0, 1);
                return _this
            }
            PointAttachment.prototype.computeWorldPosition = function(bone, point) {
                var mat = bone.matrix;
                point.x = this.x * mat.a + this.y * mat.c + bone.worldX;
                point.y = this.x * mat.b + this.y * mat.d + bone.worldY;
                return point
            };
            PointAttachment.prototype.computeWorldRotation = function(bone) {
                var mat = bone.matrix;
                var cos = core.MathUtils.cosDeg(this.rotation),
                    sin = core.MathUtils.sinDeg(this.rotation);
                var x = cos * mat.a + sin * mat.c;
                var y = cos * mat.b + sin * mat.d;
                return Math.atan2(y, x) * core.MathUtils.radDeg
            };
            return PointAttachment
        }(core.VertexAttachment);
        core.PointAttachment = PointAttachment
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var RegionAttachment = function(_super) {
            __extends(RegionAttachment, _super);

            function RegionAttachment(name) {
                var _this = _super.call(this, name) || this;
                _this.x = 0;
                _this.y = 0;
                _this.scaleX = 1;
                _this.scaleY = 1;
                _this.rotation = 0;
                _this.width = 0;
                _this.height = 0;
                _this.color = new core.Color(1, 1, 1, 1);
                _this.offset = core.Utils.newFloatArray(8);
                _this.uvs = core.Utils.newFloatArray(8);
                _this.tempColor = new core.Color(1, 1, 1, 1);
                return _this
            }
            RegionAttachment.prototype.updateOffset = function() {
                var regionScaleX = this.width / this.region.originalWidth * this.scaleX;
                var regionScaleY = this.height / this.region.originalHeight * this.scaleY;
                var localX = -this.width / 2 * this.scaleX + this.region.offsetX * regionScaleX;
                var localY = -this.height / 2 * this.scaleY + this.region.offsetY * regionScaleY;
                var localX2 = localX + this.region.width * regionScaleX;
                var localY2 = localY + this.region.height * regionScaleY;
                var radians = this.rotation * Math.PI / 180;
                var cos = Math.cos(radians);
                var sin = Math.sin(radians);
                var localXCos = localX * cos + this.x;
                var localXSin = localX * sin;
                var localYCos = localY * cos + this.y;
                var localYSin = localY * sin;
                var localX2Cos = localX2 * cos + this.x;
                var localX2Sin = localX2 * sin;
                var localY2Cos = localY2 * cos + this.y;
                var localY2Sin = localY2 * sin;
                var offset = this.offset;
                offset[RegionAttachment.OX1] = localXCos - localYSin;
                offset[RegionAttachment.OY1] = localYCos + localXSin;
                offset[RegionAttachment.OX2] = localXCos - localY2Sin;
                offset[RegionAttachment.OY2] = localY2Cos + localXSin;
                offset[RegionAttachment.OX3] = localX2Cos - localY2Sin;
                offset[RegionAttachment.OY3] = localY2Cos + localX2Sin;
                offset[RegionAttachment.OX4] = localX2Cos - localYSin;
                offset[RegionAttachment.OY4] = localYCos + localX2Sin
            };
            RegionAttachment.prototype.setRegion = function(region) {
                this.region = region;
                var uvs = this.uvs;
                if (region.rotate) {
                    uvs[2] = region.u;
                    uvs[3] = region.v2;
                    uvs[4] = region.u;
                    uvs[5] = region.v;
                    uvs[6] = region.u2;
                    uvs[7] = region.v;
                    uvs[0] = region.u2;
                    uvs[1] = region.v2
                } else {
                    uvs[0] = region.u;
                    uvs[1] = region.v2;
                    uvs[2] = region.u;
                    uvs[3] = region.v;
                    uvs[4] = region.u2;
                    uvs[5] = region.v;
                    uvs[6] = region.u2;
                    uvs[7] = region.v2
                }
            };
            RegionAttachment.prototype.computeWorldVertices = function(bone, worldVertices, offset, stride) {
                var vertexOffset = this.offset;
                var mat = bone.matrix;
                var x = mat.tx,
                    y = mat.ty;
                var a = mat.a,
                    b = mat.c,
                    c = mat.b,
                    d = mat.d;
                var offsetX = 0,
                    offsetY = 0;
                offsetX = vertexOffset[RegionAttachment.OX1];
                offsetY = vertexOffset[RegionAttachment.OY1];
                worldVertices[offset] = offsetX * a + offsetY * b + x;
                worldVertices[offset + 1] = offsetX * c + offsetY * d + y;
                offset += stride;
                offsetX = vertexOffset[RegionAttachment.OX2];
                offsetY = vertexOffset[RegionAttachment.OY2];
                worldVertices[offset] = offsetX * a + offsetY * b + x;
                worldVertices[offset + 1] = offsetX * c + offsetY * d + y;
                offset += stride;
                offsetX = vertexOffset[RegionAttachment.OX3];
                offsetY = vertexOffset[RegionAttachment.OY3];
                worldVertices[offset] = offsetX * a + offsetY * b + x;
                worldVertices[offset + 1] = offsetX * c + offsetY * d + y;
                offset += stride;
                offsetX = vertexOffset[RegionAttachment.OX4];
                offsetY = vertexOffset[RegionAttachment.OY4];
                worldVertices[offset] = offsetX * a + offsetY * b + x;
                worldVertices[offset + 1] = offsetX * c + offsetY * d + y
            };
            RegionAttachment.OX1 = 0;
            RegionAttachment.OY1 = 1;
            RegionAttachment.OX2 = 2;
            RegionAttachment.OY2 = 3;
            RegionAttachment.OX3 = 4;
            RegionAttachment.OY3 = 5;
            RegionAttachment.OX4 = 6;
            RegionAttachment.OY4 = 7;
            RegionAttachment.X1 = 0;
            RegionAttachment.Y1 = 1;
            RegionAttachment.C1R = 2;
            RegionAttachment.C1G = 3;
            RegionAttachment.C1B = 4;
            RegionAttachment.C1A = 5;
            RegionAttachment.U1 = 6;
            RegionAttachment.V1 = 7;
            RegionAttachment.X2 = 8;
            RegionAttachment.Y2 = 9;
            RegionAttachment.C2R = 10;
            RegionAttachment.C2G = 11;
            RegionAttachment.C2B = 12;
            RegionAttachment.C2A = 13;
            RegionAttachment.U2 = 14;
            RegionAttachment.V2 = 15;
            RegionAttachment.X3 = 16;
            RegionAttachment.Y3 = 17;
            RegionAttachment.C3R = 18;
            RegionAttachment.C3G = 19;
            RegionAttachment.C3B = 20;
            RegionAttachment.C3A = 21;
            RegionAttachment.U3 = 22;
            RegionAttachment.V3 = 23;
            RegionAttachment.X4 = 24;
            RegionAttachment.Y4 = 25;
            RegionAttachment.C4R = 26;
            RegionAttachment.C4G = 27;
            RegionAttachment.C4B = 28;
            RegionAttachment.C4A = 29;
            RegionAttachment.U4 = 30;
            RegionAttachment.V4 = 31;
            return RegionAttachment
        }(core.Attachment);
        core.RegionAttachment = RegionAttachment
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var JitterEffect = function() {
            function JitterEffect(jitterX, jitterY) {
                this.jitterX = 0;
                this.jitterY = 0;
                this.jitterX = jitterX;
                this.jitterY = jitterY
            }
            JitterEffect.prototype.begin = function(skeleton) {};
            JitterEffect.prototype.transform = function(position, uv, light, dark) {
                position.x += core.MathUtils.randomTriangular(-this.jitterX, this.jitterY);
                position.y += core.MathUtils.randomTriangular(-this.jitterX, this.jitterY)
            };
            JitterEffect.prototype.end = function() {};
            return JitterEffect
        }();
        core.JitterEffect = JitterEffect
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    var core;
    (function(core) {
        var SwirlEffect = function() {
            function SwirlEffect(radius) {
                this.centerX = 0;
                this.centerY = 0;
                this.radius = 0;
                this.angle = 0;
                this.worldX = 0;
                this.worldY = 0;
                this.radius = radius
            }
            SwirlEffect.prototype.begin = function(skeleton) {
                this.worldX = skeleton.x + this.centerX;
                this.worldY = skeleton.y + this.centerY
            };
            SwirlEffect.prototype.transform = function(position, uv, light, dark) {
                var radAngle = this.angle * core.MathUtils.degreesToRadians;
                var x = position.x - this.worldX;
                var y = position.y - this.worldY;
                var dist = Math.sqrt(x * x + y * y);
                if (dist < this.radius) {
                    var theta = SwirlEffect.interpolation.apply(0, radAngle, (this.radius - dist) / this.radius);
                    var cos = Math.cos(theta);
                    var sin = Math.sin(theta);
                    position.x = cos * x - sin * y + this.worldX;
                    position.y = sin * x + cos * y + this.worldY
                }
            };
            SwirlEffect.prototype.end = function() {};
            SwirlEffect.interpolation = new core.PowOut(2);
            return SwirlEffect
        }();
        core.SwirlEffect = SwirlEffect
    })(core = pixi_spine.core || (pixi_spine.core = {}))
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    PIXI.spine = pixi_spine;
    var TextureProto = PIXI.Texture.prototype;
    if (!TextureProto._updateUvs) {
        TextureProto._updateUvs = TextureProto.updateUvs
    }
})(pixi_spine || (pixi_spine = {}));
var pixi_spine;
(function(pixi_spine) {
    function isJson(resource) {
        return resource.type === PIXI.loaders.Resource.TYPE.JSON
    }

    function atlasParser() {
        return function(resource, next) {
            if (!resource.data || !isJson(resource) || !resource.data.bones) {
                return next()
            }
            var metadata = resource.metadata || {};
            var metadataSkeletonScale = metadata ? resource.metadata.spineSkeletonScale : null;
            var metadataAtlas = metadata ? resource.metadata.spineAtlas : null;
            if (metadataAtlas === false) {
                return next()
            }
            if (metadataAtlas && metadataAtlas.pages) {
                var spineJsonParser = new pixi_spine.core.SkeletonJson(new pixi_spine.core.AtlasAttachmentLoader(metadataAtlas));
                var skeletonData = spineJsonParser.readSkeletonData(resource.data);
                resource.spineData = skeletonData;
                resource.spineAtlas = metadataAtlas;
                return next()
            }
            var metadataAtlasSuffix = metadata.spineAtlasSuffix || ".atlas";
            var atlasPath = resource.url.substr(0, resource.url.lastIndexOf(".")) + metadataAtlasSuffix;
            if (resource.metadata && resource.metadata.spineAtlasFile) {
                atlasPath = resource.metadata.spineAtlasFile
            }
            atlasPath = atlasPath.replace(this.baseUrl, "");
            var atlasOptions = {
                crossOrigin: resource.crossOrigin,
                xhrType: PIXI.loaders.Resource.XHR_RESPONSE_TYPE.TEXT,
                metadata: metadata.spineMetadata || null,
                parentResource: resource
            };
            var imageOptions = {
                crossOrigin: resource.crossOrigin,
                metadata: metadata.imageMetadata || null,
                parentResource: resource
            };
            var baseUrl = resource.url.substr(0, resource.url.lastIndexOf("/") + 1);
            baseUrl = baseUrl.replace(this.baseUrl, "");
            var adapter = metadata.images ? staticImageLoader(metadata.images) : metadata.image ? staticImageLoader({
                default: metadata.image
            }) : metadata.imageLoader ? metadata.imageLoader(this, resource.name + "_atlas_page_", baseUrl, imageOptions) : imageLoaderAdapter(this, resource.name + "_atlas_page_", baseUrl, imageOptions);
            var createSkeletonWithRawAtlas = function(rawData) {
                new pixi_spine.core.TextureAtlas(rawData, adapter, function(spineAtlas) {
                    var spineJsonParser = new pixi_spine.core.SkeletonJson(new pixi_spine.core.AtlasAttachmentLoader(spineAtlas));
                    if (metadataSkeletonScale) {
                        spineJsonParser.scale = metadataSkeletonScale
                    }
                    resource.spineData = spineJsonParser.readSkeletonData(resource.data);
                    resource.spineAtlas = spineAtlas;
                    next()
                })
            };
            if (resource.metadata && resource.metadata.atlasRawData) {
                createSkeletonWithRawAtlas(resource.metadata.atlasRawData)
            } else {
                this.add(resource.name + "_atlas", atlasPath, atlasOptions, function(atlasResource) {
                    createSkeletonWithRawAtlas(atlasResource.xhr.responseText)
                })
            }
        }
    }
    pixi_spine.atlasParser = atlasParser;

    function imageLoaderAdapter(loader, namePrefix, baseUrl, imageOptions) {
        if (baseUrl && baseUrl.lastIndexOf("/") !== baseUrl.length - 1) {
            baseUrl += "/"
        }
        return function(line, callback) {
            var name = namePrefix + line;
            var url = baseUrl + line;
            loader.add(name, url, imageOptions, function(resource) {
                callback(resource.texture.baseTexture)
            })
        }
    }
    pixi_spine.imageLoaderAdapter = imageLoaderAdapter;

    function syncImageLoaderAdapter(baseUrl, crossOrigin) {
        if (baseUrl && baseUrl.lastIndexOf("/") !== baseUrl.length - 1) {
            baseUrl += "/"
        }
        return function(line, callback) {
            callback(PIXI.BaseTexture.fromImage(line, crossOrigin))
        }
    }
    pixi_spine.syncImageLoaderAdapter = syncImageLoaderAdapter;

    function staticImageLoader(pages) {
        return function(line, callback) {
            var page = pages[line] || pages["default"];
            if (page && page.baseTexture) callback(page.baseTexture);
            else callback(page)
        }
    }
    pixi_spine.staticImageLoader = staticImageLoader;
    PIXI.loaders.Loader.addPixiMiddleware(atlasParser);
    PIXI.loader.use(atlasParser())
})(pixi_spine || (pixi_spine = {}));
(function() {
    if (!Math.fround) {
        Math.fround = Math.fround = function(array) {
            return function(x) {
                return array[0] = x, array[0]
            }
        }(new Float32Array(1))
    }
})();
var pixi_spine;
(function(pixi_spine) {
    pixi_spine.core.Bone.yDown = true;
    var tempRgb = [0, 0, 0];
    var SpineSprite = function(_super) {
        __extends(SpineSprite, _super);

        function SpineSprite() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.region = null;
            return _this
        }
        return SpineSprite
    }(PIXI.Sprite);
    pixi_spine.SpineSprite = SpineSprite;
    var SpineMesh = function(_super) {
        __extends(SpineMesh, _super);

        function SpineMesh(texture, vertices, uvs, indices, drawMode) {
            return _super.call(this, texture, vertices, uvs, indices, drawMode) || this
        }
        return SpineMesh
    }(PIXI.mesh.Mesh);
    pixi_spine.SpineMesh = SpineMesh;
    var Spine = function(_super) {
        __extends(Spine, _super);

        function Spine(spineData) {
            var _this = _super.call(this) || this;
            if (!spineData) {
                throw new Error("The spineData param is required.")
            }
            if (typeof spineData === "string") {
                throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.')
            }
            _this.spineData = spineData;
            _this.skeleton = new pixi_spine.core.Skeleton(spineData);
            _this.skeleton.updateWorldTransform();
            _this.stateData = new pixi_spine.core.AnimationStateData(spineData);
            _this.state = new pixi_spine.core.AnimationState(_this.stateData);
            _this.slotContainers = [];
            _this.tempClipContainers = [];
            for (var i = 0, n = _this.skeleton.slots.length; i < n; i++) {
                var slot = _this.skeleton.slots[i];
                var attachment = slot.attachment;
                var slotContainer = _this.newContainer();
                _this.slotContainers.push(slotContainer);
                _this.addChild(slotContainer);
                _this.tempClipContainers.push(null);
                if (attachment instanceof pixi_spine.core.RegionAttachment) {
                    var spriteName = attachment.region.name;
                    var sprite = _this.createSprite(slot, attachment, spriteName);
                    slot.currentSprite = sprite;
                    slot.currentSpriteName = spriteName;
                    slotContainer.addChild(sprite)
                } else if (attachment instanceof pixi_spine.core.MeshAttachment) {
                    var mesh = _this.createMesh(slot, attachment);
                    slot.currentMesh = mesh;
                    slot.currentMeshName = attachment.name;
                    slotContainer.addChild(mesh)
                } else if (attachment instanceof pixi_spine.core.ClippingAttachment) {
                    _this.createGraphics(slot, attachment);
                    slotContainer.addChild(slot.clippingContainer);
                    slotContainer.addChild(slot.currentGraphics)
                } else {
                    continue
                }
            }
            _this.autoUpdate = true;
            _this.tintRgb = new Float32Array([1, 1, 1]);
            return _this
        }
        Object.defineProperty(Spine.prototype, "autoUpdate", {
            get: function() {
                return this.updateTransform === Spine.prototype.autoUpdateTransform
            },
            set: function(value) {
                this.updateTransform = value ? Spine.prototype.autoUpdateTransform : PIXI.Container.prototype.updateTransform
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Spine.prototype, "tint", {
            get: function() {
                return PIXI.utils.rgb2hex(this.tintRgb)
            },
            set: function(value) {
                this.tintRgb = PIXI.utils.hex2rgb(value, this.tintRgb)
            },
            enumerable: true,
            configurable: true
        });
        Spine.prototype.update = function(dt) {
            this.state.update(dt);
            this.state.apply(this.skeleton);
            this.skeleton.updateWorldTransform();
            var slots = this.skeleton.slots;
            var globalClr = this.color;
            var light = null,
                dark = null;
            if (globalClr) {
                light = globalClr.light;
                dark = globalClr.dark
            } else {
                light = this.tintRgb
            }
            var thack = PIXI.TransformBase && this.transformHack() == 1;
            for (var i = 0, n = slots.length; i < n; i++) {
                var slot = slots[i];
                var attachment = slot.attachment;
                var slotContainer = this.slotContainers[i];
                if (!attachment) {
                    slotContainer.visible = false;
                    continue
                }
                var spriteColor = null;
                var attColor = attachment.color;
                if (attachment instanceof pixi_spine.core.RegionAttachment) {
                    var region = attachment.region;
                    if (region) {
                        if (slot.currentMesh) {
                            slot.currentMesh.visible = false;
                            slot.currentMesh = null;
                            slot.currentMeshName = undefined
                        }
                        var ar = region;
                        if (!slot.currentSpriteName || slot.currentSpriteName !== ar.name) {
                            var spriteName = ar.name;
                            if (slot.currentSprite) {
                                slot.currentSprite.visible = false
                            }
                            slot.sprites = slot.sprites || {};
                            if (slot.sprites[spriteName] !== undefined) {
                                slot.sprites[spriteName].visible = true
                            } else {
                                var sprite = this.createSprite(slot, attachment, spriteName);
                                slotContainer.addChild(sprite)
                            }
                            slot.currentSprite = slot.sprites[spriteName];
                            slot.currentSpriteName = spriteName
                        }
                    }
                    if (slotContainer.transform) {
                        var transform = slotContainer.transform;
                        var transAny = transform;
                        var lt = null;
                        if (transAny.matrix2d) {
                            lt = transAny.matrix2d;
                            transAny._dirtyVersion++;
                            transAny.version = transAny._dirtyVersion;
                            transAny.isStatic = true;
                            transAny.operMode = 0
                        } else {
                            if (thack) {
                                if (transAny.position) {
                                    transform = new PIXI.TransformBase;
                                    transform._parentID = -1;
                                    transform._worldID = slotContainer.transform._worldID;
                                    slotContainer.transform = transform
                                }
                                lt = transform.localTransform
                            } else {
                                transAny.setFromMatrix(slot.bone.matrix)
                            }
                        }
                        if (lt) {
                            slot.bone.matrix.copy(lt)
                        }
                    } else {
                        var lt = slotContainer.localTransform || new PIXI.Matrix;
                        slot.bone.matrix.copy(lt);
                        slotContainer.localTransform = lt;
                        slotContainer.displayObjectUpdateTransform = SlotContainerUpdateTransformV3
                    }
                    if (slot.currentSprite.color) {
                        spriteColor = slot.currentSprite.color
                    } else {
                        tempRgb[0] = light[0] * slot.color.r * attColor.r;
                        tempRgb[1] = light[1] * slot.color.g * attColor.g;
                        tempRgb[2] = light[2] * slot.color.b * attColor.b;
                        slot.currentSprite.tint = PIXI.utils.rgb2hex(tempRgb)
                    }
                    slot.currentSprite.blendMode = slot.blendMode
                } else if (attachment instanceof pixi_spine.core.MeshAttachment) {
                    if (slot.currentSprite) {
                        slot.currentSprite.visible = false;
                        slot.currentSprite = null;
                        slot.currentSpriteName = undefined;
                        if (slotContainer.transform) {
                            var transform = new PIXI.TransformStatic;
                            transform._parentID = -1;
                            transform._worldID = slotContainer.transform._worldID;
                            slotContainer.transform = transform
                        } else {
                            slotContainer.localTransform = new PIXI.Matrix;
                            slotContainer.displayObjectUpdateTransform = PIXI.DisplayObject.prototype.updateTransform
                        }
                    }
                    if (!slot.currentMeshName || slot.currentMeshName !== attachment.name) {
                        var meshName = attachment.name;
                        if (slot.currentMesh) {
                            slot.currentMesh.visible = false
                        }
                        slot.meshes = slot.meshes || {};
                        if (slot.meshes[meshName] !== undefined) {
                            slot.meshes[meshName].visible = true
                        } else {
                            var mesh = this.createMesh(slot, attachment);
                            slotContainer.addChild(mesh)
                        }
                        slot.currentMesh = slot.meshes[meshName];
                        slot.currentMeshName = meshName
                    }
                    attachment.computeWorldVerticesOld(slot, slot.currentMesh.vertices);
                    if (slot.currentMesh.color) {
                        spriteColor = slot.currentMesh.color
                    } else if (PIXI.VERSION[0] !== "3") {
                        var tintRgb = slot.currentMesh.tintRgb;
                        tintRgb[0] = light[0] * slot.color.r * attColor.r;
                        tintRgb[1] = light[1] * slot.color.g * attColor.g;
                        tintRgb[2] = light[2] * slot.color.b * attColor.b
                    }
                    slot.currentMesh.blendMode = slot.blendMode
                } else if (attachment instanceof pixi_spine.core.ClippingAttachment) {
                    if (!slot.currentGraphics) {
                        this.createGraphics(slot, attachment);
                        slotContainer.addChild(slot.clippingContainer);
                        slotContainer.addChild(slot.currentGraphics)
                    }
                    this.updateGraphics(slot, attachment)
                } else {
                    slotContainer.visible = false;
                    continue
                }
                slotContainer.visible = true;
                if (spriteColor) {
                    var r0 = slot.color.r * attColor.r;
                    var g0 = slot.color.g * attColor.g;
                    var b0 = slot.color.b * attColor.b;
                    spriteColor.setLight(light[0] * r0 + dark[0] * (1 - r0), light[1] * g0 + dark[1] * (1 - g0), light[2] * b0 + dark[2] * (1 - b0));
                    if (slot.darkColor) {
                        r0 = slot.darkColor.r;
                        g0 = slot.darkColor.g;
                        b0 = slot.darkColor.b
                    } else {
                        r0 = 0;
                        g0 = 0;
                        b0 = 0
                    }
                    spriteColor.setDark(light[0] * r0 + dark[0] * (1 - r0), light[1] * g0 + dark[1] * (1 - g0), light[2] * b0 + dark[2] * (1 - b0))
                }
                slotContainer.alpha = slot.color.a
            }
            var drawOrder = this.skeleton.drawOrder;
            var clippingAttachment = null;
            var clippingContainer = null;
            for (var i = 0, n = drawOrder.length; i < n; i++) {
                var slot = slots[drawOrder[i].data.index];
                var slotContainer = this.slotContainers[drawOrder[i].data.index];
                if (!clippingContainer) {
                    if (slotContainer.parent !== this) {
                        slotContainer.parent.removeChild(slotContainer);
                        slotContainer.parent = this
                    }
                }
                if (slot.currentGraphics && slot.attachment) {
                    clippingContainer = slot.clippingContainer;
                    clippingAttachment = slot.attachment;
                    clippingContainer.children.length = 0;
                    this.children[i] = slotContainer;
                    if (clippingAttachment.endSlot == slot.data) {
                        clippingAttachment.endSlot = null
                    }
                } else {
                    if (clippingContainer) {
                        var c = this.tempClipContainers[i];
                        if (!c) {
                            c = this.tempClipContainers[i] = this.newContainer();
                            c.visible = false
                        }
                        this.children[i] = c;
                        slotContainer.parent = null;
                        clippingContainer.addChild(slotContainer);
                        if (clippingAttachment.endSlot == slot.data) {
                            clippingContainer.renderable = true;
                            clippingContainer = null;
                            clippingAttachment = null
                        }
                    } else {
                        this.children[i] = slotContainer
                    }
                }
            }
        };
        Spine.prototype.setSpriteRegion = function(attachment, sprite, region) {
            sprite.region = region;
            sprite.texture = region.texture;
            if (!region.size) {
                sprite.scale.x = attachment.scaleX * attachment.width / region.originalWidth;
                sprite.scale.y = -attachment.scaleY * attachment.height / region.originalHeight
            } else {
                sprite.scale.x = region.size.width / region.originalWidth;
                sprite.scale.y = -region.size.height / region.originalHeight
            }
        };
        Spine.prototype.setMeshRegion = function(attachment, mesh, region) {
            mesh.region = region;
            mesh.texture = region.texture;
            region.texture._updateUvs();
            attachment.updateUVs(region, mesh.uvs);
            mesh.dirty++
        };
        Spine.prototype.autoUpdateTransform = function() {
            if (Spine.globalAutoUpdate) {
                this.lastTime = this.lastTime || Date.now();
                var timeDelta = (Date.now() - this.lastTime) * .001;
                this.lastTime = Date.now();
                this.update(timeDelta)
            } else {
                this.lastTime = 0
            }
            PIXI.Container.prototype.updateTransform.call(this)
        };
        Spine.prototype.createSprite = function(slot, attachment, defName) {
            var region = attachment.region;
            if (slot.tempAttachment === attachment) {
                region = slot.tempRegion;
                slot.tempAttachment = null;
                slot.tempRegion = null
            }
            var texture = region.texture;
            var sprite = this.newSprite(texture);
            sprite.rotation = attachment.rotation * pixi_spine.core.MathUtils.degRad;
            sprite.anchor.x = .5;
            sprite.anchor.y = .5;
            sprite.position.x = attachment.x;
            sprite.position.y = attachment.y;
            sprite.alpha = attachment.color.a;
            sprite.region = attachment.region;
            this.setSpriteRegion(attachment, sprite, attachment.region);
            slot.sprites = slot.sprites || {};
            slot.sprites[defName] = sprite;
            return sprite
        };
        Spine.prototype.createMesh = function(slot, attachment) {
            var region = attachment.region;
            if (slot.tempAttachment === attachment) {
                region = slot.tempRegion;
                slot.tempAttachment = null;
                slot.tempRegion = null
            }
            var strip = this.newMesh(region.texture, new Float32Array(attachment.regionUVs.length), new Float32Array(attachment.regionUVs.length), new Uint16Array(attachment.triangles), PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);
            strip.canvasPadding = 1.5;
            strip.alpha = attachment.color.a;
            strip.region = attachment.region;
            this.setMeshRegion(attachment, strip, region);
            slot.meshes = slot.meshes || {};
            slot.meshes[attachment.name] = strip;
            return strip
        };
        Spine.prototype.createGraphics = function(slot, clip) {
            var graphics = this.newGraphics();
            var poly = new PIXI.Polygon([]);
            graphics.clear();
            graphics.beginFill(16777215, 1);
            graphics.drawPolygon(poly);
            graphics.renderable = false;
            slot.currentGraphics = graphics;
            slot.clippingContainer = this.newContainer();
            slot.clippingContainer.mask = slot.currentGraphics;
            return graphics
        };
        Spine.prototype.updateGraphics = function(slot, clip) {
            var vertices = slot.currentGraphics.graphicsData[0].shape.points;
            var n = clip.worldVerticesLength;
            vertices.length = n;
            clip.computeWorldVertices(slot, 0, n, vertices, 0, 2);
            slot.currentGraphics.dirty++;
            slot.currentGraphics.clearDirty++
        };
        Spine.prototype.hackTextureBySlotIndex = function(slotIndex, texture, size) {
            if (texture === void 0) {
                texture = null
            }
            if (size === void 0) {
                size = null
            }
            var slot = this.skeleton.slots[slotIndex];
            if (!slot) {
                return false
            }
            var attachment = slot.attachment;
            var region = attachment.region;
            if (texture) {
                region = new pixi_spine.core.TextureRegion;
                region.texture = texture;
                region.size = size
            }
            if (slot.currentSprite && slot.currentSprite.region != region) {
                this.setSpriteRegion(attachment, slot.currentSprite, region);
                slot.currentSprite.region = region
            } else if (slot.currentMesh && slot.currentMesh.region != region) {
                this.setMeshRegion(attachment, slot.currentMesh, region)
            } else {
                slot.tempRegion = region;
                slot.tempAttachment = attachment
            }
            return true
        };
        Spine.prototype.hackTextureBySlotName = function(slotName, texture, size) {
            if (texture === void 0) {
                texture = null
            }
            if (size === void 0) {
                size = null
            }
            var index = this.skeleton.findSlotIndex(slotName);
            if (index == -1) {
                return false
            }
            return this.hackTextureBySlotIndex(index, texture, size)
        };
        Spine.prototype.newContainer = function() {
            return new PIXI.Container
        };
        Spine.prototype.newSprite = function(tex) {
            return new SpineSprite(tex)
        };
        Spine.prototype.newGraphics = function() {
            return new PIXI.Graphics
        };
        Spine.prototype.newMesh = function(texture, vertices, uvs, indices, drawMode) {
            return new SpineMesh(texture, vertices, uvs, indices, drawMode)
        };
        Spine.prototype.transformHack = function() {
            return 1
        };
        Spine.globalAutoUpdate = true;
        Spine.clippingPolygon = [];
        return Spine
    }(PIXI.Container);
    pixi_spine.Spine = Spine;

    function SlotContainerUpdateTransformV3() {
        var pt = this.parent.worldTransform;
        var wt = this.worldTransform;
        var lt = this.localTransform;
        wt.a = lt.a * pt.a + lt.b * pt.c;
        wt.b = lt.a * pt.b + lt.b * pt.d;
        wt.c = lt.c * pt.a + lt.d * pt.c;
        wt.d = lt.c * pt.b + lt.d * pt.d;
        wt.tx = lt.tx * pt.a + lt.ty * pt.c + pt.tx;
        wt.ty = lt.tx * pt.b + lt.ty * pt.d + pt.ty;
        this.worldAlpha = this.alpha * this.parent.worldAlpha;
        this._currentBounds = null
    }
})(pixi_spine || (pixi_spine = {}));
$.ui.intersect = function(draggable, droppable, toleranceMode) {
    if (!droppable.offset) {
        return false
    }
    var draggableLeft, draggableTop, x1 = (draggable.positionAbs || draggable.position.absolute).left,
        x2 = x1 + draggable.helperProportions.width * FullSize.scale,
        y1 = (draggable.positionAbs || draggable.position.absolute).top,
        y2 = y1 + draggable.helperProportions.height * FullSize.scale,
        l = droppable.offset.left,
        r = l + droppable.proportions.width * FullSize.scale,
        t = droppable.offset.top,
        b = t + droppable.proportions.height * FullSize.scale;
    switch (toleranceMode) {
        case "fit":
            return l <= x1 && x2 <= r && t <= y1 && y2 <= b;
        case "intersect":
            return l < x1 + draggable.helperProportions.width * FullSize.scale / 2 && x2 - draggable.helperProportions.width * FullSize.scale / 2 < r && t < y1 + draggable.helperProportions.height * FullSize.scale / 2 && y2 - draggable.helperProportions.height * FullSize.scale / 2 < b;
        case "pointer":
            draggableLeft = (draggable.positionAbs || draggable.position.absolute).left + (draggable.clickOffset || draggable.offset.click).left;
            draggableTop = (draggable.positionAbs || draggable.position.absolute).top + (draggable.clickOffset || draggable.offset.click).top;
            return isOverAxis(draggableTop, t, droppable.proportions.height) && isOverAxis(draggableLeft, l, droppable.proportions.width);
        case "touch":
            return (y1 >= t && y1 <= b || y2 >= t && y2 <= b || y1 < t && y2 > b) && (x1 >= l && x1 <= r || x2 >= l && x2 <= r || x1 < l && x2 > r);
        default:
            return false
    }
};
! function(a) {
    function f(a, b) {
        if (!(a.originalEvent.touches.length > 1)) {
            a.preventDefault();
            var c = a.originalEvent.changedTouches[0],
                d = document.createEvent("MouseEvents");
            d.initMouseEvent(b, !0, !0, window, 1, c.screenX, c.screenY, c.clientX, c.clientY, !1, !1, !1, !1, 0, null), a.target.dispatchEvent(d)
        }
    }
    if (a.support.touch = "ontouchend" in document, a.support.touch) {
        var e, b = a.ui.mouse.prototype,
            c = b._mouseInit,
            d = b._mouseDestroy;
        b._touchStart = function(a) {
            var b = this;
            !e && b._mouseCapture(a.originalEvent.changedTouches[0]) && (e = !0, b._touchMoved = !1, f(a, "mouseover"), f(a, "mousemove"), f(a, "mousedown"))
        }, b._touchMove = function(a) {
            e && (this._touchMoved = !0, f(a, "mousemove"))
        }, b._touchEnd = function(a) {
            e && (f(a, "mouseup"), f(a, "mouseout"), this._touchMoved || f(a, "click"), e = !1)
        }, b._mouseInit = function() {
            var b = this;
            b.element.bind({
                touchstart: a.proxy(b, "_touchStart"),
                touchmove: a.proxy(b, "_touchMove"),
                touchend: a.proxy(b, "_touchEnd")
            }), c.call(b)
        }, b._mouseDestroy = function() {
            var b = this;
            b.element.unbind({
                touchstart: a.proxy(b, "_touchStart"),
                touchmove: a.proxy(b, "_touchMove"),
                touchend: a.proxy(b, "_touchEnd")
            }), d.call(b)
        }
    }
}(jQuery);
"use strict";
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function(obj) {
    return typeof obj
} : function(obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj
};
var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor)
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor
    }
}();

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
    }
    return call && ((typeof call === "undefined" ? "undefined" : _typeof(call)) === "object" || typeof call === "function") ? call : self
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + (typeof superClass === "undefined" ? "undefined" : _typeof(superClass)))
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function")
    }
}
var Emitter = function() {
    function Emitter() {
        _classCallCheck(this, Emitter)
    }
    _createClass(Emitter, [{
        key: "on",
        value: function on(event, fn) {
            this._callbacks = this._callbacks || {};
            if (!this._callbacks[event]) {
                this._callbacks[event] = []
            }
            this._callbacks[event].push(fn);
            return this
        }
    }, {
        key: "emit",
        value: function emit(event) {
            this._callbacks = this._callbacks || {};
            var callbacks = this._callbacks[event];
            if (callbacks) {
                for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                    args[_key - 1] = arguments[_key]
                }
                for (var _iterator = callbacks, _isArray = true, _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
                    var _ref;
                    if (_isArray) {
                        if (_i >= _iterator.length) break;
                        _ref = _iterator[_i++]
                    } else {
                        _i = _iterator.next();
                        if (_i.done) break;
                        _ref = _i.value
                    }
                    var callback = _ref;
                    callback.apply(this, args)
                }
            }
            return this
        }
    }, {
        key: "off",
        value: function off(event, fn) {
            if (!this._callbacks || arguments.length === 0) {
                this._callbacks = {};
                return this
            }
            var callbacks = this._callbacks[event];
            if (!callbacks) {
                return this
            }
            if (arguments.length === 1) {
                delete this._callbacks[event];
                return this
            }
            for (var i = 0; i < callbacks.length; i++) {
                var callback = callbacks[i];
                if (callback === fn) {
                    callbacks.splice(i, 1);
                    break
                }
            }
            return this
        }
    }]);
    return Emitter
}();
var Dropzone = function(_Emitter) {
    _inherits(Dropzone, _Emitter);
    _createClass(Dropzone, null, [{
        key: "initClass",
        value: function initClass() {
            this.prototype.Emitter = Emitter;
            this.prototype.events = ["drop", "dragstart", "dragend", "dragenter", "dragover", "dragleave", "addedfile", "addedfiles", "removedfile", "thumbnail", "error", "errormultiple", "processing", "processingmultiple", "uploadprogress", "totaluploadprogress", "sending", "sendingmultiple", "success", "successmultiple", "canceled", "canceledmultiple", "complete", "completemultiple", "reset", "maxfilesexceeded", "maxfilesreached", "queuecomplete"];
            this.prototype.defaultOptions = {
                url: null,
                method: "post",
                withCredentials: false,
                timeout: 3e4,
                parallelUploads: 2,
                uploadMultiple: false,
                chunking: false,
                forceChunking: false,
                chunkSize: 2e6,
                parallelChunkUploads: false,
                retryChunks: false,
                retryChunksLimit: 3,
                maxFilesize: 256,
                paramName: "file",
                createImageThumbnails: true,
                maxThumbnailFilesize: 10,
                thumbnailWidth: 120,
                thumbnailHeight: 120,
                thumbnailMethod: "crop",
                resizeWidth: null,
                resizeHeight: null,
                resizeMimeType: null,
                resizeQuality: .8,
                resizeMethod: "contain",
                filesizeBase: 1e3,
                maxFiles: null,
                headers: null,
                clickable: true,
                ignoreHiddenFiles: true,
                acceptedFiles: null,
                acceptedMimeTypes: null,
                autoProcessQueue: true,
                autoQueue: true,
                addRemoveLinks: false,
                previewsContainer: null,
                hiddenInputContainer: "body",
                capture: null,
                renameFilename: null,
                renameFile: null,
                forceFallback: false,
                dictDefaultMessage: "Drop files here to upload",
                dictFallbackMessage: "Your browser does not support drag'n'drop file uploads.",
                dictFallbackText: "Please use the fallback form below to upload your files like in the olden days.",
                dictFileTooBig: "File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",
                dictInvalidFileType: "You can't upload files of this type.",
                dictResponseError: "Server responded with {{statusCode}} code.",
                dictCancelUpload: "Cancel upload",
                dictUploadCanceled: "Upload canceled.",
                dictCancelUploadConfirmation: "Are you sure you want to cancel this upload?",
                dictRemoveFile: "Remove file",
                dictRemoveFileConfirmation: null,
                dictMaxFilesExceeded: "You can not upload any more files.",
                dictFileSizeUnits: {
                    tb: "TB",
                    gb: "GB",
                    mb: "MB",
                    kb: "KB",
                    b: "b"
                },
                init: function init() {},
                params: function params(files, xhr, chunk) {
                    if (chunk) {
                        return {
                            dzuuid: chunk.file.upload.uuid,
                            dzchunkindex: chunk.index,
                            dztotalfilesize: chunk.file.size,
                            dzchunksize: this.options.chunkSize,
                            dztotalchunkcount: chunk.file.upload.totalChunkCount,
                            dzchunkbyteoffset: chunk.index * this.options.chunkSize
                        }
                    }
                },
                accept: function accept(file, done) {
                    return done()
                },
                chunksUploaded: function chunksUploaded(file, done) {
                    done()
                },
                fallback: function fallback() {
                    var messageElement = void 0;
                    this.element.className = this.element.className + " dz-browser-not-supported";
                    for (var _iterator2 = this.element.getElementsByTagName("div"), _isArray2 = true, _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
                        var _ref2;
                        if (_isArray2) {
                            if (_i2 >= _iterator2.length) break;
                            _ref2 = _iterator2[_i2++]
                        } else {
                            _i2 = _iterator2.next();
                            if (_i2.done) break;
                            _ref2 = _i2.value
                        }
                        var child = _ref2;
                        if (/(^| )dz-message($| )/.test(child.className)) {
                            messageElement = child;
                            child.className = "dz-message";
                            break
                        }
                    }
                    if (!messageElement) {
                        messageElement = Dropzone.createElement('<div class="dz-message"><span></span></div>');
                        this.element.appendChild(messageElement)
                    }
                    var span = messageElement.getElementsByTagName("span")[0];
                    if (span) {
                        if (span.textContent != null) {
                            span.textContent = this.options.dictFallbackMessage
                        } else if (span.innerText != null) {
                            span.innerText = this.options.dictFallbackMessage
                        }
                    }
                    return this.element.appendChild(this.getFallbackForm())
                },
                resize: function resize(file, width, height, resizeMethod) {
                    var info = {
                        srcX: 0,
                        srcY: 0,
                        srcWidth: file.width,
                        srcHeight: file.height
                    };
                    var srcRatio = file.width / file.height;
                    if (width == null && height == null) {
                        width = info.srcWidth;
                        height = info.srcHeight
                    } else if (width == null) {
                        width = height * srcRatio
                    } else if (height == null) {
                        height = width / srcRatio
                    }
                    width = Math.min(width, info.srcWidth);
                    height = Math.min(height, info.srcHeight);
                    var trgRatio = width / height;
                    if (info.srcWidth > width || info.srcHeight > height) {
                        if (resizeMethod === "crop") {
                            if (srcRatio > trgRatio) {
                                info.srcHeight = file.height;
                                info.srcWidth = info.srcHeight * trgRatio
                            } else {
                                info.srcWidth = file.width;
                                info.srcHeight = info.srcWidth / trgRatio
                            }
                        } else if (resizeMethod === "contain") {
                            if (srcRatio > trgRatio) {
                                height = width / srcRatio
                            } else {
                                width = height * srcRatio
                            }
                        } else {
                            throw new Error("Unknown resizeMethod '" + resizeMethod + "'")
                        }
                    }
                    info.srcX = (file.width - info.srcWidth) / 2;
                    info.srcY = (file.height - info.srcHeight) / 2;
                    info.trgWidth = width;
                    info.trgHeight = height;
                    return info
                },
                transformFile: function transformFile(file, done) {
                    if ((this.options.resizeWidth || this.options.resizeHeight) && file.type.match(/image.*/)) {
                        return this.resizeImage(file, this.options.resizeWidth, this.options.resizeHeight, this.options.resizeMethod, done)
                    } else {
                        return done(file)
                    }
                },
                previewTemplate: '<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>',
                drop: function drop(e) {
                    return this.element.classList.remove("dz-drag-hover")
                },
                dragstart: function dragstart(e) {},
                dragend: function dragend(e) {
                    return this.element.classList.remove("dz-drag-hover")
                },
                dragenter: function dragenter(e) {
                    return this.element.classList.add("dz-drag-hover")
                },
                dragover: function dragover(e) {
                    return this.element.classList.add("dz-drag-hover")
                },
                dragleave: function dragleave(e) {
                    return this.element.classList.remove("dz-drag-hover")
                },
                paste: function paste(e) {},
                reset: function reset() {
                    return this.element.classList.remove("dz-started")
                },
                addedfile: function addedfile(file) {
                    var _this2 = this;
                    if (this.element === this.previewsContainer) {
                        this.element.classList.add("dz-started")
                    }
                    if (this.previewsContainer) {
                        file.previewElement = Dropzone.createElement(this.options.previewTemplate.trim());
                        file.previewTemplate = file.previewElement;
                        this.previewsContainer.appendChild(file.previewElement);
                        for (var _iterator3 = file.previewElement.querySelectorAll("[data-dz-name]"), _isArray3 = true, _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {
                            var _ref3;
                            if (_isArray3) {
                                if (_i3 >= _iterator3.length) break;
                                _ref3 = _iterator3[_i3++]
                            } else {
                                _i3 = _iterator3.next();
                                if (_i3.done) break;
                                _ref3 = _i3.value
                            }
                            var node = _ref3;
                            node.textContent = file.name
                        }
                        for (var _iterator4 = file.previewElement.querySelectorAll("[data-dz-size]"), _isArray4 = true, _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {
                            if (_isArray4) {
                                if (_i4 >= _iterator4.length) break;
                                node = _iterator4[_i4++]
                            } else {
                                _i4 = _iterator4.next();
                                if (_i4.done) break;
                                node = _i4.value
                            }
                            node.innerHTML = this.filesize(file.size)
                        }
                        if (this.options.addRemoveLinks) {
                            file._removeLink = Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>' + this.options.dictRemoveFile + "</a>");
                            file.previewElement.appendChild(file._removeLink)
                        }
                        var removeFileEvent = function removeFileEvent(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (file.status === Dropzone.UPLOADING) {
                                return Dropzone.confirm(_this2.options.dictCancelUploadConfirmation, function() {
                                    return _this2.removeFile(file)
                                })
                            } else {
                                if (_this2.options.dictRemoveFileConfirmation) {
                                    return Dropzone.confirm(_this2.options.dictRemoveFileConfirmation, function() {
                                        return _this2.removeFile(file)
                                    })
                                } else {
                                    return _this2.removeFile(file)
                                }
                            }
                        };
                        for (var _iterator5 = file.previewElement.querySelectorAll("[data-dz-remove]"), _isArray5 = true, _i5 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {
                            var _ref4;
                            if (_isArray5) {
                                if (_i5 >= _iterator5.length) break;
                                _ref4 = _iterator5[_i5++]
                            } else {
                                _i5 = _iterator5.next();
                                if (_i5.done) break;
                                _ref4 = _i5.value
                            }
                            var removeLink = _ref4;
                            removeLink.addEventListener("click", removeFileEvent)
                        }
                    }
                },
                removedfile: function removedfile(file) {
                    if (file.previewElement != null && file.previewElement.parentNode != null) {
                        file.previewElement.parentNode.removeChild(file.previewElement)
                    }
                    return this._updateMaxFilesReachedClass()
                },
                thumbnail: function thumbnail(file, dataUrl) {
                    if (file.previewElement) {
                        file.previewElement.classList.remove("dz-file-preview");
                        for (var _iterator6 = file.previewElement.querySelectorAll("[data-dz-thumbnail]"), _isArray6 = true, _i6 = 0, _iterator6 = _isArray6 ? _iterator6 : _iterator6[Symbol.iterator]();;) {
                            var _ref5;
                            if (_isArray6) {
                                if (_i6 >= _iterator6.length) break;
                                _ref5 = _iterator6[_i6++]
                            } else {
                                _i6 = _iterator6.next();
                                if (_i6.done) break;
                                _ref5 = _i6.value
                            }
                            var thumbnailElement = _ref5;
                            thumbnailElement.alt = file.name;
                            thumbnailElement.src = dataUrl
                        }
                        return setTimeout(function() {
                            return file.previewElement.classList.add("dz-image-preview")
                        }, 1)
                    }
                },
                error: function error(file, message) {
                    if (file.previewElement) {
                        file.previewElement.classList.add("dz-error");
                        if (typeof message !== "String" && message.error) {
                            message = message.error
                        }
                        for (var _iterator7 = file.previewElement.querySelectorAll("[data-dz-errormessage]"), _isArray7 = true, _i7 = 0, _iterator7 = _isArray7 ? _iterator7 : _iterator7[Symbol.iterator]();;) {
                            var _ref6;
                            if (_isArray7) {
                                if (_i7 >= _iterator7.length) break;
                                _ref6 = _iterator7[_i7++]
                            } else {
                                _i7 = _iterator7.next();
                                if (_i7.done) break;
                                _ref6 = _i7.value
                            }
                            var node = _ref6;
                            node.textContent = message
                        }
                    }
                },
                errormultiple: function errormultiple() {},
                processing: function processing(file) {
                    if (file.previewElement) {
                        file.previewElement.classList.add("dz-processing");
                        if (file._removeLink) {
                            return file._removeLink.innerHTML = this.options.dictCancelUpload
                        }
                    }
                },
                processingmultiple: function processingmultiple() {},
                uploadprogress: function uploadprogress(file, progress, bytesSent) {
                    if (file.previewElement) {
                        for (var _iterator8 = file.previewElement.querySelectorAll("[data-dz-uploadprogress]"), _isArray8 = true, _i8 = 0, _iterator8 = _isArray8 ? _iterator8 : _iterator8[Symbol.iterator]();;) {
                            var _ref7;
                            if (_isArray8) {
                                if (_i8 >= _iterator8.length) break;
                                _ref7 = _iterator8[_i8++]
                            } else {
                                _i8 = _iterator8.next();
                                if (_i8.done) break;
                                _ref7 = _i8.value
                            }
                            var node = _ref7;
                            node.nodeName === "PROGRESS" ? node.value = progress : node.style.width = progress + "%"
                        }
                    }
                },
                totaluploadprogress: function totaluploadprogress() {},
                sending: function sending() {},
                sendingmultiple: function sendingmultiple() {},
                success: function success(file) {
                    if (file.previewElement) {
                        return file.previewElement.classList.add("dz-success")
                    }
                },
                successmultiple: function successmultiple() {},
                canceled: function canceled(file) {
                    return this.emit("error", file, this.options.dictUploadCanceled)
                },
                canceledmultiple: function canceledmultiple() {},
                complete: function complete(file) {
                    if (file._removeLink) {
                        file._removeLink.innerHTML = this.options.dictRemoveFile
                    }
                    if (file.previewElement) {
                        return file.previewElement.classList.add("dz-complete")
                    }
                },
                completemultiple: function completemultiple() {},
                maxfilesexceeded: function maxfilesexceeded() {},
                maxfilesreached: function maxfilesreached() {},
                queuecomplete: function queuecomplete() {},
                addedfiles: function addedfiles() {}
            };
            this.prototype._thumbnailQueue = [];
            this.prototype._processingThumbnail = false
        }
    }, {
        key: "extend",
        value: function extend(target) {
            for (var _len2 = arguments.length, objects = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
                objects[_key2 - 1] = arguments[_key2]
            }
            for (var _iterator9 = objects, _isArray9 = true, _i9 = 0, _iterator9 = _isArray9 ? _iterator9 : _iterator9[Symbol.iterator]();;) {
                var _ref8;
                if (_isArray9) {
                    if (_i9 >= _iterator9.length) break;
                    _ref8 = _iterator9[_i9++]
                } else {
                    _i9 = _iterator9.next();
                    if (_i9.done) break;
                    _ref8 = _i9.value
                }
                var object = _ref8;
                for (var key in object) {
                    var val = object[key];
                    target[key] = val
                }
            }
            return target
        }
    }]);

    function Dropzone(el, options) {
        _classCallCheck(this, Dropzone);
        var _this = _possibleConstructorReturn(this, (Dropzone.__proto__ || Object.getPrototypeOf(Dropzone)).call(this));
        var fallback = void 0,
            left = void 0;
        _this.element = el;
        _this.version = Dropzone.version;
        _this.defaultOptions.previewTemplate = _this.defaultOptions.previewTemplate.replace(/\n*/g, "");
        _this.clickableElements = [];
        _this.listeners = [];
        _this.files = [];
        if (typeof _this.element === "string") {
            _this.element = document.querySelector(_this.element)
        }
        if (!_this.element || _this.element.nodeType == null) {
            throw new Error("Invalid dropzone element.")
        }
        if (_this.element.dropzone) {
            throw new Error("Dropzone already attached.")
        }
        Dropzone.instances.push(_this);
        _this.element.dropzone = _this;
        var elementOptions = (left = Dropzone.optionsForElement(_this.element)) != null ? left : {};
        _this.options = Dropzone.extend({}, _this.defaultOptions, elementOptions, options != null ? options : {});
        if (_this.options.forceFallback || !Dropzone.isBrowserSupported()) {
            var _ret;
            return _ret = _this.options.fallback.call(_this), _possibleConstructorReturn(_this, _ret)
        }
        if (_this.options.url == null) {
            _this.options.url = _this.element.getAttribute("action")
        }
        if (!_this.options.url) {
            throw new Error("No URL provided.")
        }
        if (_this.options.acceptedFiles && _this.options.acceptedMimeTypes) {
            throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.")
        }
        if (_this.options.uploadMultiple && _this.options.chunking) {
            throw new Error("You cannot set both: uploadMultiple and chunking.")
        }
        if (_this.options.acceptedMimeTypes) {
            _this.options.acceptedFiles = _this.options.acceptedMimeTypes;
            delete _this.options.acceptedMimeTypes
        }
        if (_this.options.renameFilename != null) {
            _this.options.renameFile = function(file) {
                return _this.options.renameFilename.call(_this, file.name, file)
            }
        }
        _this.options.method = _this.options.method.toUpperCase();
        if ((fallback = _this.getExistingFallback()) && fallback.parentNode) {
            fallback.parentNode.removeChild(fallback)
        }
        if (_this.options.previewsContainer !== false) {
            if (_this.options.previewsContainer) {
                _this.previewsContainer = Dropzone.getElement(_this.options.previewsContainer, "previewsContainer")
            } else {
                _this.previewsContainer = _this.element
            }
        }
        if (_this.options.clickable) {
            if (_this.options.clickable === true) {
                _this.clickableElements = [_this.element]
            } else {
                _this.clickableElements = Dropzone.getElements(_this.options.clickable, "clickable")
            }
        }
        _this.init();
        return _this
    }
    _createClass(Dropzone, [{
        key: "getAcceptedFiles",
        value: function getAcceptedFiles() {
            return this.files.filter(function(file) {
                return file.accepted
            }).map(function(file) {
                return file
            })
        }
    }, {
        key: "getRejectedFiles",
        value: function getRejectedFiles() {
            return this.files.filter(function(file) {
                return !file.accepted
            }).map(function(file) {
                return file
            })
        }
    }, {
        key: "getFilesWithStatus",
        value: function getFilesWithStatus(status) {
            return this.files.filter(function(file) {
                return file.status === status
            }).map(function(file) {
                return file
            })
        }
    }, {
        key: "getQueuedFiles",
        value: function getQueuedFiles() {
            return this.getFilesWithStatus(Dropzone.QUEUED)
        }
    }, {
        key: "getUploadingFiles",
        value: function getUploadingFiles() {
            return this.getFilesWithStatus(Dropzone.UPLOADING)
        }
    }, {
        key: "getAddedFiles",
        value: function getAddedFiles() {
            return this.getFilesWithStatus(Dropzone.ADDED)
        }
    }, {
        key: "getActiveFiles",
        value: function getActiveFiles() {
            return this.files.filter(function(file) {
                return file.status === Dropzone.UPLOADING || file.status === Dropzone.QUEUED
            }).map(function(file) {
                return file
            })
        }
    }, {
        key: "init",
        value: function init() {
            var _this3 = this;
            if (this.element.tagName === "form") {
                this.element.setAttribute("enctype", "multipart/form-data")
            }
            if (this.element.classList.contains("dropzone") && !this.element.querySelector(".dz-message")) {
                this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>' + this.options.dictDefaultMessage + "</span></div>"))
            }
            if (this.clickableElements.length) {
                var setupHiddenFileInput = function setupHiddenFileInput() {
                    if (_this3.hiddenFileInput) {
                        _this3.hiddenFileInput.parentNode.removeChild(_this3.hiddenFileInput)
                    }
                    _this3.hiddenFileInput = document.createElement("input");
                    _this3.hiddenFileInput.setAttribute("type", "file");
                    if (_this3.options.maxFiles === null || _this3.options.maxFiles > 1) {
                        _this3.hiddenFileInput.setAttribute("multiple", "multiple")
                    }
                    _this3.hiddenFileInput.className = "dz-hidden-input";
                    if (_this3.options.acceptedFiles !== null) {
                        _this3.hiddenFileInput.setAttribute("accept", _this3.options.acceptedFiles)
                    }
                    if (_this3.options.capture !== null) {
                        _this3.hiddenFileInput.setAttribute("capture", _this3.options.capture)
                    }
                    _this3.hiddenFileInput.style.visibility = "hidden";
                    _this3.hiddenFileInput.style.position = "absolute";
                    _this3.hiddenFileInput.style.top = "0";
                    _this3.hiddenFileInput.style.left = "0";
                    _this3.hiddenFileInput.style.height = "0";
                    _this3.hiddenFileInput.style.width = "0";
                    Dropzone.getElement(_this3.options.hiddenInputContainer, "hiddenInputContainer").appendChild(_this3.hiddenFileInput);
                    return _this3.hiddenFileInput.addEventListener("change", function() {
                        var files = _this3.hiddenFileInput.files;
                        if (files.length) {
                            for (var _iterator10 = files, _isArray10 = true, _i10 = 0, _iterator10 = _isArray10 ? _iterator10 : _iterator10[Symbol.iterator]();;) {
                                var _ref9;
                                if (_isArray10) {
                                    if (_i10 >= _iterator10.length) break;
                                    _ref9 = _iterator10[_i10++]
                                } else {
                                    _i10 = _iterator10.next();
                                    if (_i10.done) break;
                                    _ref9 = _i10.value
                                }
                                var file = _ref9;
                                _this3.addFile(file)
                            }
                        }
                        _this3.emit("addedfiles", files);
                        return setupHiddenFileInput()
                    })
                };
                setupHiddenFileInput()
            }
            this.URL = window.URL !== null ? window.URL : window.webkitURL;
            for (var _iterator11 = this.events, _isArray11 = true, _i11 = 0, _iterator11 = _isArray11 ? _iterator11 : _iterator11[Symbol.iterator]();;) {
                var _ref10;
                if (_isArray11) {
                    if (_i11 >= _iterator11.length) break;
                    _ref10 = _iterator11[_i11++]
                } else {
                    _i11 = _iterator11.next();
                    if (_i11.done) break;
                    _ref10 = _i11.value
                }
                var eventName = _ref10;
                this.on(eventName, this.options[eventName])
            }
            this.on("uploadprogress", function() {
                return _this3.updateTotalUploadProgress()
            });
            this.on("removedfile", function() {
                return _this3.updateTotalUploadProgress()
            });
            this.on("canceled", function(file) {
                return _this3.emit("complete", file)
            });
            this.on("complete", function(file) {
                if (_this3.getAddedFiles().length === 0 && _this3.getUploadingFiles().length === 0 && _this3.getQueuedFiles().length === 0) {
                    return setTimeout(function() {
                        return _this3.emit("queuecomplete")
                    }, 0)
                }
            });
            var noPropagation = function noPropagation(e) {
                e.stopPropagation();
                if (e.preventDefault) {
                    return e.preventDefault()
                } else {
                    return e.returnValue = false
                }
            };
            this.listeners = [{
                element: this.element,
                events: {
                    dragstart: function dragstart(e) {
                        return _this3.emit("dragstart", e)
                    },
                    dragenter: function dragenter(e) {
                        noPropagation(e);
                        return _this3.emit("dragenter", e)
                    },
                    dragover: function dragover(e) {
                        var efct = void 0;
                        try {
                            efct = e.dataTransfer.effectAllowed
                        } catch (error) {}
                        e.dataTransfer.dropEffect = "move" === efct || "linkMove" === efct ? "move" : "copy";
                        noPropagation(e);
                        return _this3.emit("dragover", e)
                    },
                    dragleave: function dragleave(e) {
                        return _this3.emit("dragleave", e)
                    },
                    drop: function drop(e) {
                        noPropagation(e);
                        return _this3.drop(e)
                    },
                    dragend: function dragend(e) {
                        return _this3.emit("dragend", e)
                    }
                }
            }];
            this.clickableElements.forEach(function(clickableElement) {
                return _this3.listeners.push({
                    element: clickableElement,
                    events: {
                        click: function click(evt) {
                            if (clickableElement !== _this3.element || evt.target === _this3.element || Dropzone.elementInside(evt.target, _this3.element.querySelector(".dz-message"))) {
                                _this3.hiddenFileInput.click()
                            }
                            return true
                        }
                    }
                })
            });
            this.enable();
            return this.options.init.call(this)
        }
    }, {
        key: "destroy",
        value: function destroy() {
            this.disable();
            this.removeAllFiles(true);
            if (this.hiddenFileInput != null ? this.hiddenFileInput.parentNode : undefined) {
                this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput);
                this.hiddenFileInput = null
            }
            delete this.element.dropzone;
            return Dropzone.instances.splice(Dropzone.instances.indexOf(this), 1)
        }
    }, {
        key: "updateTotalUploadProgress",
        value: function updateTotalUploadProgress() {
            var totalUploadProgress = void 0;
            var totalBytesSent = 0;
            var totalBytes = 0;
            var activeFiles = this.getActiveFiles();
            if (activeFiles.length) {
                for (var _iterator12 = this.getActiveFiles(), _isArray12 = true, _i12 = 0, _iterator12 = _isArray12 ? _iterator12 : _iterator12[Symbol.iterator]();;) {
                    var _ref11;
                    if (_isArray12) {
                        if (_i12 >= _iterator12.length) break;
                        _ref11 = _iterator12[_i12++]
                    } else {
                        _i12 = _iterator12.next();
                        if (_i12.done) break;
                        _ref11 = _i12.value
                    }
                    var file = _ref11;
                    totalBytesSent += file.upload.bytesSent;
                    totalBytes += file.upload.total
                }
                totalUploadProgress = 100 * totalBytesSent / totalBytes
            } else {
                totalUploadProgress = 100
            }
            return this.emit("totaluploadprogress", totalUploadProgress, totalBytes, totalBytesSent)
        }
    }, {
        key: "_getParamName",
        value: function _getParamName(n) {
            if (typeof this.options.paramName === "function") {
                return this.options.paramName(n)
            } else {
                return "" + this.options.paramName + (this.options.uploadMultiple ? "[" + n + "]" : "")
            }
        }
    }, {
        key: "_renameFile",
        value: function _renameFile(file) {
            if (typeof this.options.renameFile !== "function") {
                return file.name
            }
            return this.options.renameFile(file)
        }
    }, {
        key: "getFallbackForm",
        value: function getFallbackForm() {
            var existingFallback = void 0,
                form = void 0;
            if (existingFallback = this.getExistingFallback()) {
                return existingFallback
            }
            var fieldsString = '<div class="dz-fallback">';
            if (this.options.dictFallbackText) {
                fieldsString += "<p>" + this.options.dictFallbackText + "</p>"
            }
            fieldsString += '<input type="file" name="' + this._getParamName(0) + '" ' + (this.options.uploadMultiple ? 'multiple="multiple"' : undefined) + ' /><input type="submit" value="Upload!"></div>';
            var fields = Dropzone.createElement(fieldsString);
            if (this.element.tagName !== "FORM") {
                form = Dropzone.createElement('<form action="' + this.options.url + '" enctype="multipart/form-data" method="' + this.options.method + '"></form>');
                form.appendChild(fields)
            } else {
                this.element.setAttribute("enctype", "multipart/form-data");
                this.element.setAttribute("method", this.options.method)
            }
            return form != null ? form : fields
        }
    }, {
        key: "getExistingFallback",
        value: function getExistingFallback() {
            var getFallback = function getFallback(elements) {
                for (var _iterator13 = elements, _isArray13 = true, _i13 = 0, _iterator13 = _isArray13 ? _iterator13 : _iterator13[Symbol.iterator]();;) {
                    var _ref12;
                    if (_isArray13) {
                        if (_i13 >= _iterator13.length) break;
                        _ref12 = _iterator13[_i13++]
                    } else {
                        _i13 = _iterator13.next();
                        if (_i13.done) break;
                        _ref12 = _i13.value
                    }
                    var el = _ref12;
                    if (/(^| )fallback($| )/.test(el.className)) {
                        return el
                    }
                }
            };
            var _arr = ["div", "form"];
            for (var _i14 = 0; _i14 < _arr.length; _i14++) {
                var tagName = _arr[_i14];
                var fallback;
                if (fallback = getFallback(this.element.getElementsByTagName(tagName))) {
                    return fallback
                }
            }
        }
    }, {
        key: "setupEventListeners",
        value: function setupEventListeners() {
            return this.listeners.map(function(elementListeners) {
                return function() {
                    var result = [];
                    for (var event in elementListeners.events) {
                        var listener = elementListeners.events[event];
                        result.push(elementListeners.element.addEventListener(event, listener, false))
                    }
                    return result
                }()
            })
        }
    }, {
        key: "removeEventListeners",
        value: function removeEventListeners() {
            return this.listeners.map(function(elementListeners) {
                return function() {
                    var result = [];
                    for (var event in elementListeners.events) {
                        var listener = elementListeners.events[event];
                        result.push(elementListeners.element.removeEventListener(event, listener, false))
                    }
                    return result
                }()
            })
        }
    }, {
        key: "disable",
        value: function disable() {
            var _this4 = this;
            this.clickableElements.forEach(function(element) {
                return element.classList.remove("dz-clickable")
            });
            this.removeEventListeners();
            this.disabled = true;
            return this.files.map(function(file) {
                return _this4.cancelUpload(file)
            })
        }
    }, {
        key: "enable",
        value: function enable() {
            delete this.disabled;
            this.clickableElements.forEach(function(element) {
                return element.classList.add("dz-clickable")
            });
            return this.setupEventListeners()
        }
    }, {
        key: "filesize",
        value: function filesize(size) {
            var selectedSize = 0;
            var selectedUnit = "b";
            if (size > 0) {
                var units = ["tb", "gb", "mb", "kb", "b"];
                for (var i = 0; i < units.length; i++) {
                    var unit = units[i];
                    var cutoff = Math.pow(this.options.filesizeBase, 4 - i) / 10;
                    if (size >= cutoff) {
                        selectedSize = size / Math.pow(this.options.filesizeBase, 4 - i);
                        selectedUnit = unit;
                        break
                    }
                }
                selectedSize = Math.round(10 * selectedSize) / 10
            }
            return "<strong>" + selectedSize + "</strong> " + this.options.dictFileSizeUnits[selectedUnit]
        }
    }, {
        key: "_updateMaxFilesReachedClass",
        value: function _updateMaxFilesReachedClass() {
            if (this.options.maxFiles != null && this.getAcceptedFiles().length >= this.options.maxFiles) {
                if (this.getAcceptedFiles().length === this.options.maxFiles) {
                    this.emit("maxfilesreached", this.files)
                }
                return this.element.classList.add("dz-max-files-reached")
            } else {
                return this.element.classList.remove("dz-max-files-reached")
            }
        }
    }, {
        key: "drop",
        value: function drop(e) {
            if (!e.dataTransfer) {
                return
            }
            this.emit("drop", e);
            var files = [];
            for (var i = 0; i < e.dataTransfer.files.length; i++) {
                files[i] = e.dataTransfer.files[i]
            }
            this.emit("addedfiles", files);
            if (files.length) {
                var items = e.dataTransfer.items;
                if (items && items.length && items[0].webkitGetAsEntry != null) {
                    this._addFilesFromItems(items)
                } else {
                    this.handleFiles(files)
                }
            }
        }
    }, {
        key: "paste",
        value: function paste(e) {
            if (__guard__(e != null ? e.clipboardData : undefined, function(x) {
                    return x.items
                }) == null) {
                return
            }
            this.emit("paste", e);
            var items = e.clipboardData.items;
            if (items.length) {
                return this._addFilesFromItems(items)
            }
        }
    }, {
        key: "handleFiles",
        value: function handleFiles(files) {
            for (var _iterator14 = files, _isArray14 = true, _i15 = 0, _iterator14 = _isArray14 ? _iterator14 : _iterator14[Symbol.iterator]();;) {
                var _ref13;
                if (_isArray14) {
                    if (_i15 >= _iterator14.length) break;
                    _ref13 = _iterator14[_i15++]
                } else {
                    _i15 = _iterator14.next();
                    if (_i15.done) break;
                    _ref13 = _i15.value
                }
                var file = _ref13;
                this.addFile(file)
            }
        }
    }, {
        key: "_addFilesFromItems",
        value: function _addFilesFromItems(items) {
            var _this5 = this;
            return function() {
                var result = [];
                for (var _iterator15 = items, _isArray15 = true, _i16 = 0, _iterator15 = _isArray15 ? _iterator15 : _iterator15[Symbol.iterator]();;) {
                    var _ref14;
                    if (_isArray15) {
                        if (_i16 >= _iterator15.length) break;
                        _ref14 = _iterator15[_i16++]
                    } else {
                        _i16 = _iterator15.next();
                        if (_i16.done) break;
                        _ref14 = _i16.value
                    }
                    var item = _ref14;
                    var entry;
                    if (item.webkitGetAsEntry != null && (entry = item.webkitGetAsEntry())) {
                        if (entry.isFile) {
                            result.push(_this5.addFile(item.getAsFile()))
                        } else if (entry.isDirectory) {
                            result.push(_this5._addFilesFromDirectory(entry, entry.name))
                        } else {
                            result.push(undefined)
                        }
                    } else if (item.getAsFile != null) {
                        if (item.kind == null || item.kind === "file") {
                            result.push(_this5.addFile(item.getAsFile()))
                        } else {
                            result.push(undefined)
                        }
                    } else {
                        result.push(undefined)
                    }
                }
                return result
            }()
        }
    }, {
        key: "_addFilesFromDirectory",
        value: function _addFilesFromDirectory(directory, path) {
            var _this6 = this;
            var dirReader = directory.createReader();
            var errorHandler = function errorHandler(error) {
                return __guardMethod__(console, "log", function(o) {
                    return o.log(error)
                })
            };
            var readEntries = function readEntries() {
                return dirReader.readEntries(function(entries) {
                    if (entries.length > 0) {
                        for (var _iterator16 = entries, _isArray16 = true, _i17 = 0, _iterator16 = _isArray16 ? _iterator16 : _iterator16[Symbol.iterator]();;) {
                            var _ref15;
                            if (_isArray16) {
                                if (_i17 >= _iterator16.length) break;
                                _ref15 = _iterator16[_i17++]
                            } else {
                                _i17 = _iterator16.next();
                                if (_i17.done) break;
                                _ref15 = _i17.value
                            }
                            var entry = _ref15;
                            if (entry.isFile) {
                                entry.file(function(file) {
                                    if (_this6.options.ignoreHiddenFiles && file.name.substring(0, 1) === ".") {
                                        return
                                    }
                                    file.fullPath = path + "/" + file.name;
                                    return _this6.addFile(file)
                                })
                            } else if (entry.isDirectory) {
                                _this6._addFilesFromDirectory(entry, path + "/" + entry.name)
                            }
                        }
                        readEntries()
                    }
                    return null
                }, errorHandler)
            };
            return readEntries()
        }
    }, {
        key: "accept",
        value: function accept(file, done) {
            if (this.options.maxFilesize && file.size > this.options.maxFilesize * 1024 * 1024) {
                return done(this.options.dictFileTooBig.replace("{{filesize}}", Math.round(file.size / 1024 / 10.24) / 100).replace("{{maxFilesize}}", this.options.maxFilesize))
            } else if (!Dropzone.isValidFile(file, this.options.acceptedFiles)) {
                return done(this.options.dictInvalidFileType)
            } else if (this.options.maxFiles != null && this.getAcceptedFiles().length >= this.options.maxFiles) {
                done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}", this.options.maxFiles));
                return this.emit("maxfilesexceeded", file)
            } else {
                return this.options.accept.call(this, file, done)
            }
        }
    }, {
        key: "addFile",
        value: function addFile(file) {
            var _this7 = this;
            file.upload = {
                uuid: Dropzone.uuidv4(),
                progress: 0,
                total: file.size,
                bytesSent: 0,
                filename: this._renameFile(file),
                chunked: this.options.chunking && (this.options.forceChunking || file.size > this.options.chunkSize),
                totalChunkCount: Math.ceil(file.size / this.options.chunkSize)
            };
            this.files.push(file);
            file.status = Dropzone.ADDED;
            this.emit("addedfile", file);
            this._enqueueThumbnail(file);
            return this.accept(file, function(error) {
                if (error) {
                    file.accepted = false;
                    _this7._errorProcessing([file], error)
                } else {
                    file.accepted = true;
                    if (_this7.options.autoQueue) {
                        _this7.enqueueFile(file)
                    }
                }
                return _this7._updateMaxFilesReachedClass()
            })
        }
    }, {
        key: "enqueueFiles",
        value: function enqueueFiles(files) {
            for (var _iterator17 = files, _isArray17 = true, _i18 = 0, _iterator17 = _isArray17 ? _iterator17 : _iterator17[Symbol.iterator]();;) {
                var _ref16;
                if (_isArray17) {
                    if (_i18 >= _iterator17.length) break;
                    _ref16 = _iterator17[_i18++]
                } else {
                    _i18 = _iterator17.next();
                    if (_i18.done) break;
                    _ref16 = _i18.value
                }
                var file = _ref16;
                this.enqueueFile(file)
            }
            return null
        }
    }, {
        key: "enqueueFile",
        value: function enqueueFile(file) {
            var _this8 = this;
            if (file.status === Dropzone.ADDED && file.accepted === true) {
                file.status = Dropzone.QUEUED;
                if (this.options.autoProcessQueue) {
                    return setTimeout(function() {
                        return _this8.processQueue()
                    }, 0)
                }
            } else {
                throw new Error("This file can't be queued because it has already been processed or was rejected.")
            }
        }
    }, {
        key: "_enqueueThumbnail",
        value: function _enqueueThumbnail(file) {
            var _this9 = this;
            if (this.options.createImageThumbnails && file.type.match(/image.*/) && file.size <= this.options.maxThumbnailFilesize * 1024 * 1024) {
                this._thumbnailQueue.push(file);
                return setTimeout(function() {
                    return _this9._processThumbnailQueue()
                }, 0)
            }
        }
    }, {
        key: "_processThumbnailQueue",
        value: function _processThumbnailQueue() {
            var _this10 = this;
            if (this._processingThumbnail || this._thumbnailQueue.length === 0) {
                return
            }
            this._processingThumbnail = true;
            var file = this._thumbnailQueue.shift();
            return this.createThumbnail(file, this.options.thumbnailWidth, this.options.thumbnailHeight, this.options.thumbnailMethod, true, function(dataUrl) {
                _this10.emit("thumbnail", file, dataUrl);
                _this10._processingThumbnail = false;
                return _this10._processThumbnailQueue()
            })
        }
    }, {
        key: "removeFile",
        value: function removeFile(file) {
            if (file.status === Dropzone.UPLOADING) {
                this.cancelUpload(file)
            }
            this.files = without(this.files, file);
            this.emit("removedfile", file);
            if (this.files.length === 0) {
                return this.emit("reset")
            }
        }
    }, {
        key: "removeAllFiles",
        value: function removeAllFiles(cancelIfNecessary) {
            if (cancelIfNecessary == null) {
                cancelIfNecessary = false
            }
            for (var _iterator18 = this.files.slice(), _isArray18 = true, _i19 = 0, _iterator18 = _isArray18 ? _iterator18 : _iterator18[Symbol.iterator]();;) {
                var _ref17;
                if (_isArray18) {
                    if (_i19 >= _iterator18.length) break;
                    _ref17 = _iterator18[_i19++]
                } else {
                    _i19 = _iterator18.next();
                    if (_i19.done) break;
                    _ref17 = _i19.value
                }
                var file = _ref17;
                if (file.status !== Dropzone.UPLOADING || cancelIfNecessary) {
                    this.removeFile(file)
                }
            }
            return null
        }
    }, {
        key: "resizeImage",
        value: function resizeImage(file, width, height, resizeMethod, callback) {
            var _this11 = this;
            return this.createThumbnail(file, width, height, resizeMethod, true, function(dataUrl, canvas) {
                if (canvas == null) {
                    return callback(file)
                } else {
                    var resizeMimeType = _this11.options.resizeMimeType;
                    if (resizeMimeType == null) {
                        resizeMimeType = file.type
                    }
                    var resizedDataURL = canvas.toDataURL(resizeMimeType, _this11.options.resizeQuality);
                    if (resizeMimeType === "image/jpeg" || resizeMimeType === "image/jpg") {
                        resizedDataURL = ExifRestore.restore(file.dataURL, resizedDataURL)
                    }
                    return callback(Dropzone.dataURItoBlob(resizedDataURL))
                }
            })
        }
    }, {
        key: "createThumbnail",
        value: function createThumbnail(file, width, height, resizeMethod, fixOrientation, callback) {
            var _this12 = this;
            var fileReader = new FileReader;
            fileReader.onload = function() {
                file.dataURL = fileReader.result;
                if (file.type === "image/svg+xml") {
                    if (callback != null) {
                        callback(fileReader.result)
                    }
                    return
                }
                return _this12.createThumbnailFromUrl(file, width, height, resizeMethod, fixOrientation, callback)
            };
            return fileReader.readAsDataURL(file)
        }
    }, {
        key: "createThumbnailFromUrl",
        value: function createThumbnailFromUrl(file, width, height, resizeMethod, fixOrientation, callback, crossOrigin) {
            var _this13 = this;
            var img = document.createElement("img");
            if (crossOrigin) {
                img.crossOrigin = crossOrigin
            }
            img.onload = function() {
                var loadExif = function loadExif(callback) {
                    return callback(1)
                };
                if (typeof EXIF !== "undefined" && EXIF !== null && fixOrientation) {
                    loadExif = function loadExif(callback) {
                        return EXIF.getData(img, function() {
                            return callback(EXIF.getTag(this, "Orientation"))
                        })
                    }
                }
                return loadExif(function(orientation) {
                    file.width = img.width;
                    file.height = img.height;
                    var resizeInfo = _this13.options.resize.call(_this13, file, width, height, resizeMethod);
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    canvas.width = resizeInfo.trgWidth;
                    canvas.height = resizeInfo.trgHeight;
                    if (orientation > 4) {
                        canvas.width = resizeInfo.trgHeight;
                        canvas.height = resizeInfo.trgWidth
                    }
                    switch (orientation) {
                        case 2:
                            ctx.translate(canvas.width, 0);
                            ctx.scale(-1, 1);
                            break;
                        case 3:
                            ctx.translate(canvas.width, canvas.height);
                            ctx.rotate(Math.PI);
                            break;
                        case 4:
                            ctx.translate(0, canvas.height);
                            ctx.scale(1, -1);
                            break;
                        case 5:
                            ctx.rotate(.5 * Math.PI);
                            ctx.scale(1, -1);
                            break;
                        case 6:
                            ctx.rotate(.5 * Math.PI);
                            ctx.translate(0, -canvas.width);
                            break;
                        case 7:
                            ctx.rotate(.5 * Math.PI);
                            ctx.translate(canvas.height, -canvas.width);
                            ctx.scale(-1, 1);
                            break;
                        case 8:
                            ctx.rotate(-.5 * Math.PI);
                            ctx.translate(-canvas.height, 0);
                            break
                    }
                    drawImageIOSFix(ctx, img, resizeInfo.srcX != null ? resizeInfo.srcX : 0, resizeInfo.srcY != null ? resizeInfo.srcY : 0, resizeInfo.srcWidth, resizeInfo.srcHeight, resizeInfo.trgX != null ? resizeInfo.trgX : 0, resizeInfo.trgY != null ? resizeInfo.trgY : 0, resizeInfo.trgWidth, resizeInfo.trgHeight);
                    var thumbnail = canvas.toDataURL("image/png");
                    if (callback != null) {
                        return callback(thumbnail, canvas)
                    }
                })
            };
            if (callback != null) {
                img.onerror = callback
            }
            return img.src = file.dataURL
        }
    }, {
        key: "processQueue",
        value: function processQueue() {
            var parallelUploads = this.options.parallelUploads;
            var processingLength = this.getUploadingFiles().length;
            var i = processingLength;
            if (processingLength >= parallelUploads) {
                return
            }
            var queuedFiles = this.getQueuedFiles();
            if (!(queuedFiles.length > 0)) {
                return
            }
            if (this.options.uploadMultiple) {
                return this.processFiles(queuedFiles.slice(0, parallelUploads - processingLength))
            } else {
                while (i < parallelUploads) {
                    if (!queuedFiles.length) {
                        return
                    }
                    this.processFile(queuedFiles.shift());
                    i++
                }
            }
        }
    }, {
        key: "processFile",
        value: function processFile(file) {
            return this.processFiles([file])
        }
    }, {
        key: "processFiles",
        value: function processFiles(files) {
            for (var _iterator19 = files, _isArray19 = true, _i20 = 0, _iterator19 = _isArray19 ? _iterator19 : _iterator19[Symbol.iterator]();;) {
                var _ref18;
                if (_isArray19) {
                    if (_i20 >= _iterator19.length) break;
                    _ref18 = _iterator19[_i20++]
                } else {
                    _i20 = _iterator19.next();
                    if (_i20.done) break;
                    _ref18 = _i20.value
                }
                var file = _ref18;
                file.processing = true;
                file.status = Dropzone.UPLOADING;
                this.emit("processing", file)
            }
            if (this.options.uploadMultiple) {
                this.emit("processingmultiple", files)
            }
            return this.uploadFiles(files)
        }
    }, {
        key: "_getFilesWithXhr",
        value: function _getFilesWithXhr(xhr) {
            var files = void 0;
            return files = this.files.filter(function(file) {
                return file.xhr === xhr
            }).map(function(file) {
                return file
            })
        }
    }, {
        key: "cancelUpload",
        value: function cancelUpload(file) {
            if (file.status === Dropzone.UPLOADING) {
                var groupedFiles = this._getFilesWithXhr(file.xhr);
                for (var _iterator20 = groupedFiles, _isArray20 = true, _i21 = 0, _iterator20 = _isArray20 ? _iterator20 : _iterator20[Symbol.iterator]();;) {
                    var _ref19;
                    if (_isArray20) {
                        if (_i21 >= _iterator20.length) break;
                        _ref19 = _iterator20[_i21++]
                    } else {
                        _i21 = _iterator20.next();
                        if (_i21.done) break;
                        _ref19 = _i21.value
                    }
                    var groupedFile = _ref19;
                    groupedFile.status = Dropzone.CANCELED
                }
                if (typeof file.xhr !== "undefined") {
                    file.xhr.abort()
                }
                for (var _iterator21 = groupedFiles, _isArray21 = true, _i22 = 0, _iterator21 = _isArray21 ? _iterator21 : _iterator21[Symbol.iterator]();;) {
                    var _ref20;
                    if (_isArray21) {
                        if (_i22 >= _iterator21.length) break;
                        _ref20 = _iterator21[_i22++]
                    } else {
                        _i22 = _iterator21.next();
                        if (_i22.done) break;
                        _ref20 = _i22.value
                    }
                    var _groupedFile = _ref20;
                    this.emit("canceled", _groupedFile)
                }
                if (this.options.uploadMultiple) {
                    this.emit("canceledmultiple", groupedFiles)
                }
            } else if (file.status === Dropzone.ADDED || file.status === Dropzone.QUEUED) {
                file.status = Dropzone.CANCELED;
                this.emit("canceled", file);
                if (this.options.uploadMultiple) {
                    this.emit("canceledmultiple", [file])
                }
            }
            if (this.options.autoProcessQueue) {
                return this.processQueue()
            }
        }
    }, {
        key: "resolveOption",
        value: function resolveOption(option) {
            if (typeof option === "function") {
                for (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
                    args[_key3 - 1] = arguments[_key3]
                }
                return option.apply(this, args)
            }
            return option
        }
    }, {
        key: "uploadFile",
        value: function uploadFile(file) {
            return this.uploadFiles([file])
        }
    }, {
        key: "uploadFiles",
        value: function uploadFiles(files) {
            var _this14 = this;
            this._transformFiles(files, function(transformedFiles) {
                if (files[0].upload.chunked) {
                    var file = files[0];
                    var transformedFile = transformedFiles[0];
                    var startedChunkCount = 0;
                    file.upload.chunks = [];
                    var handleNextChunk = function handleNextChunk() {
                        var chunkIndex = 0;
                        while (file.upload.chunks[chunkIndex] !== undefined) {
                            chunkIndex++
                        }
                        if (chunkIndex >= file.upload.totalChunkCount) return;
                        startedChunkCount++;
                        var start = chunkIndex * _this14.options.chunkSize;
                        var end = Math.min(start + _this14.options.chunkSize, file.size);
                        var dataBlock = {
                            name: _this14._getParamName(0),
                            data: transformedFile.webkitSlice ? transformedFile.webkitSlice(start, end) : transformedFile.slice(start, end),
                            filename: file.upload.filename,
                            chunkIndex: chunkIndex
                        };
                        file.upload.chunks[chunkIndex] = {
                            file: file,
                            index: chunkIndex,
                            dataBlock: dataBlock,
                            status: Dropzone.UPLOADING,
                            progress: 0,
                            retries: 0
                        };
                        _this14._uploadData(files, [dataBlock])
                    };
                    file.upload.finishedChunkUpload = function(chunk) {
                        var allFinished = true;
                        chunk.status = Dropzone.SUCCESS;
                        chunk.dataBlock = null;
                        chunk.xhr = null;
                        for (var i = 0; i < file.upload.totalChunkCount; i++) {
                            if (file.upload.chunks[i] === undefined) {
                                return handleNextChunk()
                            }
                            if (file.upload.chunks[i].status !== Dropzone.SUCCESS) {
                                allFinished = false
                            }
                        }
                        if (allFinished) {
                            _this14.options.chunksUploaded(file, function() {
                                _this14._finished(files, "", null)
                            })
                        }
                    };
                    if (_this14.options.parallelChunkUploads) {
                        for (var i = 0; i < file.upload.totalChunkCount; i++) {
                            handleNextChunk()
                        }
                    } else {
                        handleNextChunk()
                    }
                } else {
                    var dataBlocks = [];
                    for (var _i23 = 0; _i23 < files.length; _i23++) {
                        dataBlocks[_i23] = {
                            name: _this14._getParamName(_i23),
                            data: transformedFiles[_i23],
                            filename: files[_i23].upload.filename
                        }
                    }
                    _this14._uploadData(files, dataBlocks)
                }
            })
        }
    }, {
        key: "_getChunk",
        value: function _getChunk(file, xhr) {
            for (var i = 0; i < file.upload.totalChunkCount; i++) {
                if (file.upload.chunks[i] !== undefined && file.upload.chunks[i].xhr === xhr) {
                    return file.upload.chunks[i]
                }
            }
        }
    }, {
        key: "_uploadData",
        value: function _uploadData(files, dataBlocks) {
            var _this15 = this;
            var xhr = new XMLHttpRequest;
            for (var _iterator22 = files, _isArray22 = true, _i24 = 0, _iterator22 = _isArray22 ? _iterator22 : _iterator22[Symbol.iterator]();;) {
                var _ref21;
                if (_isArray22) {
                    if (_i24 >= _iterator22.length) break;
                    _ref21 = _iterator22[_i24++]
                } else {
                    _i24 = _iterator22.next();
                    if (_i24.done) break;
                    _ref21 = _i24.value
                }
                var file = _ref21;
                file.xhr = xhr
            }
            if (files[0].upload.chunked) {
                files[0].upload.chunks[dataBlocks[0].chunkIndex].xhr = xhr
            }
            var method = this.resolveOption(this.options.method, files);
            var url = this.resolveOption(this.options.url, files);
            xhr.open(method, url, true);
            xhr.timeout = this.resolveOption(this.options.timeout, files);
            xhr.withCredentials = !!this.options.withCredentials;
            xhr.onload = function(e) {
                _this15._finishedUploading(files, xhr, e)
            };
            xhr.onerror = function() {
                _this15._handleUploadError(files, xhr)
            };
            var progressObj = xhr.upload != null ? xhr.upload : xhr;
            progressObj.onprogress = function(e) {
                return _this15._updateFilesUploadProgress(files, xhr, e)
            };
            var headers = {
                Accept: "application/json",
                "Cache-Control": "no-cache",
                "X-Requested-With": "XMLHttpRequest"
            };
            if (this.options.headers) {
                Dropzone.extend(headers, this.options.headers)
            }
            for (var headerName in headers) {
                var headerValue = headers[headerName];
                if (headerValue) {
                    xhr.setRequestHeader(headerName, headerValue)
                }
            }
            var formData = new FormData;
            if (this.options.params) {
                var additionalParams = this.options.params;
                if (typeof additionalParams === "function") {
                    additionalParams = additionalParams.call(this, files, xhr, files[0].upload.chunked ? this._getChunk(files[0], xhr) : null)
                }
                for (var key in additionalParams) {
                    var value = additionalParams[key];
                    formData.append(key, value)
                }
            }
            for (var _iterator23 = files, _isArray23 = true, _i25 = 0, _iterator23 = _isArray23 ? _iterator23 : _iterator23[Symbol.iterator]();;) {
                var _ref22;
                if (_isArray23) {
                    if (_i25 >= _iterator23.length) break;
                    _ref22 = _iterator23[_i25++]
                } else {
                    _i25 = _iterator23.next();
                    if (_i25.done) break;
                    _ref22 = _i25.value
                }
                var _file = _ref22;
                this.emit("sending", _file, xhr, formData)
            }
            if (this.options.uploadMultiple) {
                this.emit("sendingmultiple", files, xhr, formData)
            }
            this._addFormElementData(formData);
            for (var i = 0; i < dataBlocks.length; i++) {
                var dataBlock = dataBlocks[i];
                formData.append(dataBlock.name, dataBlock.data, dataBlock.filename)
            }
            this.submitRequest(xhr, formData, files)
        }
    }, {
        key: "_transformFiles",
        value: function _transformFiles(files, done) {
            var _this16 = this;
            var transformedFiles = [];
            var doneCounter = 0;
            var _loop = function _loop(i) {
                _this16.options.transformFile.call(_this16, files[i], function(transformedFile) {
                    transformedFiles[i] = transformedFile;
                    if (++doneCounter === files.length) {
                        done(transformedFiles)
                    }
                })
            };
            for (var i = 0; i < files.length; i++) {
                _loop(i)
            }
        }
    }, {
        key: "_addFormElementData",
        value: function _addFormElementData(formData) {
            if (this.element.tagName === "FORM") {
                for (var _iterator24 = this.element.querySelectorAll("input, textarea, select, button"), _isArray24 = true, _i26 = 0, _iterator24 = _isArray24 ? _iterator24 : _iterator24[Symbol.iterator]();;) {
                    var _ref23;
                    if (_isArray24) {
                        if (_i26 >= _iterator24.length) break;
                        _ref23 = _iterator24[_i26++]
                    } else {
                        _i26 = _iterator24.next();
                        if (_i26.done) break;
                        _ref23 = _i26.value
                    }
                    var input = _ref23;
                    var inputName = input.getAttribute("name");
                    var inputType = input.getAttribute("type");
                    if (inputType) inputType = inputType.toLowerCase();
                    if (typeof inputName === "undefined" || inputName === null) continue;
                    if (input.tagName === "SELECT" && input.hasAttribute("multiple")) {
                        for (var _iterator25 = input.options, _isArray25 = true, _i27 = 0, _iterator25 = _isArray25 ? _iterator25 : _iterator25[Symbol.iterator]();;) {
                            var _ref24;
                            if (_isArray25) {
                                if (_i27 >= _iterator25.length) break;
                                _ref24 = _iterator25[_i27++]
                            } else {
                                _i27 = _iterator25.next();
                                if (_i27.done) break;
                                _ref24 = _i27.value
                            }
                            var option = _ref24;
                            if (option.selected) {
                                formData.append(inputName, option.value)
                            }
                        }
                    } else if (!inputType || inputType !== "checkbox" && inputType !== "radio" || input.checked) {
                        formData.append(inputName, input.value)
                    }
                }
            }
        }
    }, {
        key: "_updateFilesUploadProgress",
        value: function _updateFilesUploadProgress(files, xhr, e) {
            var progress = void 0;
            if (typeof e !== "undefined") {
                progress = 100 * e.loaded / e.total;
                if (files[0].upload.chunked) {
                    var file = files[0];
                    var chunk = this._getChunk(file, xhr);
                    chunk.progress = progress;
                    chunk.total = e.total;
                    chunk.bytesSent = e.loaded;
                    var fileProgress = 0,
                        fileTotal = void 0,
                        fileBytesSent = void 0;
                    file.upload.progress = 0;
                    file.upload.total = 0;
                    file.upload.bytesSent = 0;
                    for (var i = 0; i < file.upload.totalChunkCount; i++) {
                        if (file.upload.chunks[i] !== undefined && file.upload.chunks[i].progress !== undefined) {
                            file.upload.progress += file.upload.chunks[i].progress;
                            file.upload.total += file.upload.chunks[i].total;
                            file.upload.bytesSent += file.upload.chunks[i].bytesSent
                        }
                    }
                    file.upload.progress = file.upload.progress / file.upload.totalChunkCount
                } else {
                    for (var _iterator26 = files, _isArray26 = true, _i28 = 0, _iterator26 = _isArray26 ? _iterator26 : _iterator26[Symbol.iterator]();;) {
                        var _ref25;
                        if (_isArray26) {
                            if (_i28 >= _iterator26.length) break;
                            _ref25 = _iterator26[_i28++]
                        } else {
                            _i28 = _iterator26.next();
                            if (_i28.done) break;
                            _ref25 = _i28.value
                        }
                        var _file2 = _ref25;
                        _file2.upload.progress = progress;
                        _file2.upload.total = e.total;
                        _file2.upload.bytesSent = e.loaded
                    }
                }
                for (var _iterator27 = files, _isArray27 = true, _i29 = 0, _iterator27 = _isArray27 ? _iterator27 : _iterator27[Symbol.iterator]();;) {
                    var _ref26;
                    if (_isArray27) {
                        if (_i29 >= _iterator27.length) break;
                        _ref26 = _iterator27[_i29++]
                    } else {
                        _i29 = _iterator27.next();
                        if (_i29.done) break;
                        _ref26 = _i29.value
                    }
                    var _file3 = _ref26;
                    this.emit("uploadprogress", _file3, _file3.upload.progress, _file3.upload.bytesSent)
                }
            } else {
                var allFilesFinished = true;
                progress = 100;
                for (var _iterator28 = files, _isArray28 = true, _i30 = 0, _iterator28 = _isArray28 ? _iterator28 : _iterator28[Symbol.iterator]();;) {
                    var _ref27;
                    if (_isArray28) {
                        if (_i30 >= _iterator28.length) break;
                        _ref27 = _iterator28[_i30++]
                    } else {
                        _i30 = _iterator28.next();
                        if (_i30.done) break;
                        _ref27 = _i30.value
                    }
                    var _file4 = _ref27;
                    if (_file4.upload.progress !== 100 || _file4.upload.bytesSent !== _file4.upload.total) {
                        allFilesFinished = false
                    }
                    _file4.upload.progress = progress;
                    _file4.upload.bytesSent = _file4.upload.total
                }
                if (allFilesFinished) {
                    return
                }
                for (var _iterator29 = files, _isArray29 = true, _i31 = 0, _iterator29 = _isArray29 ? _iterator29 : _iterator29[Symbol.iterator]();;) {
                    var _ref28;
                    if (_isArray29) {
                        if (_i31 >= _iterator29.length) break;
                        _ref28 = _iterator29[_i31++]
                    } else {
                        _i31 = _iterator29.next();
                        if (_i31.done) break;
                        _ref28 = _i31.value
                    }
                    var _file5 = _ref28;
                    this.emit("uploadprogress", _file5, progress, _file5.upload.bytesSent)
                }
            }
        }
    }, {
        key: "_finishedUploading",
        value: function _finishedUploading(files, xhr, e) {
            var response = void 0;
            if (files[0].status === Dropzone.CANCELED) {
                return
            }
            if (xhr.readyState !== 4) {
                return
            }
            if (xhr.responseType !== "arraybuffer" && xhr.responseType !== "blob") {
                response = xhr.responseText;
                if (xhr.getResponseHeader("content-type") && ~xhr.getResponseHeader("content-type").indexOf("application/json")) {
                    try {
                        response = JSON.parse(response)
                    } catch (error) {
                        e = error;
                        response = "Invalid JSON response from server."
                    }
                }
            }
            this._updateFilesUploadProgress(files);
            if (!(200 <= xhr.status && xhr.status < 300)) {
                this._handleUploadError(files, xhr, response)
            } else {
                if (files[0].upload.chunked) {
                    files[0].upload.finishedChunkUpload(this._getChunk(files[0], xhr))
                } else {
                    this._finished(files, response, e)
                }
            }
        }
    }, {
        key: "_handleUploadError",
        value: function _handleUploadError(files, xhr, response) {
            if (files[0].status === Dropzone.CANCELED) {
                return
            }
            if (files[0].upload.chunked && this.options.retryChunks) {
                var chunk = this._getChunk(files[0], xhr);
                if (chunk.retries++ < this.options.retryChunksLimit) {
                    this._uploadData(files, [chunk.dataBlock]);
                    return
                } else {
                    console.warn("Retried this chunk too often. Giving up.")
                }
            }
            for (var _iterator30 = files, _isArray30 = true, _i32 = 0, _iterator30 = _isArray30 ? _iterator30 : _iterator30[Symbol.iterator]();;) {
                var _ref29;
                if (_isArray30) {
                    if (_i32 >= _iterator30.length) break;
                    _ref29 = _iterator30[_i32++]
                } else {
                    _i32 = _iterator30.next();
                    if (_i32.done) break;
                    _ref29 = _i32.value
                }
                var file = _ref29;
                this._errorProcessing(files, response || this.options.dictResponseError.replace("{{statusCode}}", xhr.status), xhr)
            }
        }
    }, {
        key: "submitRequest",
        value: function submitRequest(xhr, formData, files) {
            xhr.send(formData)
        }
    }, {
        key: "_finished",
        value: function _finished(files, responseText, e) {
            for (var _iterator31 = files, _isArray31 = true, _i33 = 0, _iterator31 = _isArray31 ? _iterator31 : _iterator31[Symbol.iterator]();;) {
                var _ref30;
                if (_isArray31) {
                    if (_i33 >= _iterator31.length) break;
                    _ref30 = _iterator31[_i33++]
                } else {
                    _i33 = _iterator31.next();
                    if (_i33.done) break;
                    _ref30 = _i33.value
                }
                var file = _ref30;
                file.status = Dropzone.SUCCESS;
                this.emit("success", file, responseText, e);
                this.emit("complete", file)
            }
            if (this.options.uploadMultiple) {
                this.emit("successmultiple", files, responseText, e);
                this.emit("completemultiple", files)
            }
            if (this.options.autoProcessQueue) {
                return this.processQueue()
            }
        }
    }, {
        key: "_errorProcessing",
        value: function _errorProcessing(files, message, xhr) {
            for (var _iterator32 = files, _isArray32 = true, _i34 = 0, _iterator32 = _isArray32 ? _iterator32 : _iterator32[Symbol.iterator]();;) {
                var _ref31;
                if (_isArray32) {
                    if (_i34 >= _iterator32.length) break;
                    _ref31 = _iterator32[_i34++]
                } else {
                    _i34 = _iterator32.next();
                    if (_i34.done) break;
                    _ref31 = _i34.value
                }
                var file = _ref31;
                file.status = Dropzone.ERROR;
                this.emit("error", file, message, xhr);
                this.emit("complete", file)
            }
            if (this.options.uploadMultiple) {
                this.emit("errormultiple", files, message, xhr);
                this.emit("completemultiple", files)
            }
            if (this.options.autoProcessQueue) {
                return this.processQueue()
            }
        }
    }], [{
        key: "uuidv4",
        value: function uuidv4() {
            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0,
                    v = c === "x" ? r : r & 3 | 8;
                return v.toString(16)
            })
        }
    }]);
    return Dropzone
}(Emitter);
Dropzone.initClass();
Dropzone.version = "5.5.0";
Dropzone.options = {};
Dropzone.optionsForElement = function(element) {
    if (element.getAttribute("id")) {
        return Dropzone.options[camelize(element.getAttribute("id"))]
    } else {
        return undefined
    }
};
Dropzone.instances = [];
Dropzone.forElement = function(element) {
    if (typeof element === "string") {
        element = document.querySelector(element)
    }
    if ((element != null ? element.dropzone : undefined) == null) {
        throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.")
    }
    return element.dropzone
};
Dropzone.autoDiscover = true;
Dropzone.discover = function() {
    var dropzones = void 0;
    if (document.querySelectorAll) {
        dropzones = document.querySelectorAll(".dropzone")
    } else {
        dropzones = [];
        var checkElements = function checkElements(elements) {
            return function() {
                var result = [];
                for (var _iterator33 = elements, _isArray33 = true, _i35 = 0, _iterator33 = _isArray33 ? _iterator33 : _iterator33[Symbol.iterator]();;) {
                    var _ref32;
                    if (_isArray33) {
                        if (_i35 >= _iterator33.length) break;
                        _ref32 = _iterator33[_i35++]
                    } else {
                        _i35 = _iterator33.next();
                        if (_i35.done) break;
                        _ref32 = _i35.value
                    }
                    var el = _ref32;
                    if (/(^| )dropzone($| )/.test(el.className)) {
                        result.push(dropzones.push(el))
                    } else {
                        result.push(undefined)
                    }
                }
                return result
            }()
        };
        checkElements(document.getElementsByTagName("div"));
        checkElements(document.getElementsByTagName("form"))
    }
    return function() {
        var result = [];
        for (var _iterator34 = dropzones, _isArray34 = true, _i36 = 0, _iterator34 = _isArray34 ? _iterator34 : _iterator34[Symbol.iterator]();;) {
            var _ref33;
            if (_isArray34) {
                if (_i36 >= _iterator34.length) break;
                _ref33 = _iterator34[_i36++]
            } else {
                _i36 = _iterator34.next();
                if (_i36.done) break;
                _ref33 = _i36.value
            }
            var dropzone = _ref33;
            if (Dropzone.optionsForElement(dropzone) !== false) {
                result.push(new Dropzone(dropzone))
            } else {
                result.push(undefined)
            }
        }
        return result
    }()
};
Dropzone.blacklistedBrowsers = [/opera.*(Macintosh|Windows Phone).*version\/12/i];
Dropzone.isBrowserSupported = function() {
    var capableBrowser = true;
    if (window.File && window.FileReader && window.FileList && window.Blob && window.FormData && document.querySelector) {
        if (!("classList" in document.createElement("a"))) {
            capableBrowser = false
        } else {
            for (var _iterator35 = Dropzone.blacklistedBrowsers, _isArray35 = true, _i37 = 0, _iterator35 = _isArray35 ? _iterator35 : _iterator35[Symbol.iterator]();;) {
                var _ref34;
                if (_isArray35) {
                    if (_i37 >= _iterator35.length) break;
                    _ref34 = _iterator35[_i37++]
                } else {
                    _i37 = _iterator35.next();
                    if (_i37.done) break;
                    _ref34 = _i37.value
                }
                var regex = _ref34;
                if (regex.test(navigator.userAgent)) {
                    capableBrowser = false;
                    continue
                }
            }
        }
    } else {
        capableBrowser = false
    }
    return capableBrowser
};
Dropzone.dataURItoBlob = function(dataURI) {
    var byteString = atob(dataURI.split(",")[1]);
    var mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
    var ab = new ArrayBuffer(byteString.length);
    var ia = new Uint8Array(ab);
    for (var i = 0, end = byteString.length, asc = 0 <= end; asc ? i <= end : i >= end; asc ? i++ : i--) {
        ia[i] = byteString.charCodeAt(i)
    }
    return new Blob([ab], {
        type: mimeString
    })
};
var without = function without(list, rejectedItem) {
    return list.filter(function(item) {
        return item !== rejectedItem
    }).map(function(item) {
        return item
    })
};
var camelize = function camelize(str) {
    return str.replace(/[\-_](\w)/g, function(match) {
        return match.charAt(1).toUpperCase()
    })
};
Dropzone.createElement = function(string) {
    var div = document.createElement("div");
    div.innerHTML = string;
    return div.childNodes[0]
};
Dropzone.elementInside = function(element, container) {
    if (element === container) {
        return true
    }
    while (element = element.parentNode) {
        if (element === container) {
            return true
        }
    }
    return false
};
Dropzone.getElement = function(el, name) {
    var element = void 0;
    if (typeof el === "string") {
        element = document.querySelector(el)
    } else if (el.nodeType != null) {
        element = el
    }
    if (element == null) {
        throw new Error("Invalid `" + name + "` option provided. Please provide a CSS selector or a plain HTML element.")
    }
    return element
};
Dropzone.getElements = function(els, name) {
    var el = void 0,
        elements = void 0;
    if (els instanceof Array) {
        elements = [];
        try {
            for (var _iterator36 = els, _isArray36 = true, _i38 = 0, _iterator36 = _isArray36 ? _iterator36 : _iterator36[Symbol.iterator]();;) {
                if (_isArray36) {
                    if (_i38 >= _iterator36.length) break;
                    el = _iterator36[_i38++]
                } else {
                    _i38 = _iterator36.next();
                    if (_i38.done) break;
                    el = _i38.value
                }
                elements.push(this.getElement(el, name))
            }
        } catch (e) {
            elements = null
        }
    } else if (typeof els === "string") {
        elements = [];
        for (var _iterator37 = document.querySelectorAll(els), _isArray37 = true, _i39 = 0, _iterator37 = _isArray37 ? _iterator37 : _iterator37[Symbol.iterator]();;) {
            if (_isArray37) {
                if (_i39 >= _iterator37.length) break;
                el = _iterator37[_i39++]
            } else {
                _i39 = _iterator37.next();
                if (_i39.done) break;
                el = _i39.value
            }
            elements.push(el)
        }
    } else if (els.nodeType != null) {
        elements = [els]
    }
    if (elements == null || !elements.length) {
        throw new Error("Invalid `" + name + "` option provided. Please provide a CSS selector, a plain HTML element or a list of those.")
    }
    return elements
};
Dropzone.confirm = function(question, accepted, rejected) {
    if (window.confirm(question)) {
        return accepted()
    } else if (rejected != null) {
        return rejected()
    }
};
Dropzone.isValidFile = function(file, acceptedFiles) {
    if (!acceptedFiles) {
        return true
    }
    acceptedFiles = acceptedFiles.split(",");
    var mimeType = file.type;
    var baseMimeType = mimeType.replace(/\/.*$/, "");
    for (var _iterator38 = acceptedFiles, _isArray38 = true, _i40 = 0, _iterator38 = _isArray38 ? _iterator38 : _iterator38[Symbol.iterator]();;) {
        var _ref35;
        if (_isArray38) {
            if (_i40 >= _iterator38.length) break;
            _ref35 = _iterator38[_i40++]
        } else {
            _i40 = _iterator38.next();
            if (_i40.done) break;
            _ref35 = _i40.value
        }
        var validType = _ref35;
        validType = validType.trim();
        if (validType.charAt(0) === ".") {
            if (file.name.toLowerCase().indexOf(validType.toLowerCase(), file.name.length - validType.length) !== -1) {
                return true
            }
        } else if (/\/\*$/.test(validType)) {
            if (baseMimeType === validType.replace(/\/.*$/, "")) {
                return true
            }
        } else {
            if (mimeType === validType) {
                return true
            }
        }
    }
    return false
};
if (typeof jQuery !== "undefined" && jQuery !== null) {
    jQuery.fn.dropzone = function(options) {
        return this.each(function() {
            return new Dropzone(this, options)
        })
    }
}
if (typeof module !== "undefined" && module !== null) {
    module.exports = Dropzone
} else {
    window.Dropzone = Dropzone
}
Dropzone.ADDED = "added";
Dropzone.QUEUED = "queued";
Dropzone.ACCEPTED = Dropzone.QUEUED;
Dropzone.UPLOADING = "uploading";
Dropzone.PROCESSING = Dropzone.UPLOADING;
Dropzone.CANCELED = "canceled";
Dropzone.ERROR = "error";
Dropzone.SUCCESS = "success";
var detectVerticalSquash = function detectVerticalSquash(img) {
    var iw = img.naturalWidth;
    var ih = img.naturalHeight;
    var canvas = document.createElement("canvas");
    canvas.width = 1;
    canvas.height = ih;
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    var _ctx$getImageData = ctx.getImageData(1, 0, 1, ih),
        data = _ctx$getImageData.data;
    var sy = 0;
    var ey = ih;
    var py = ih;
    while (py > sy) {
        var alpha = data[(py - 1) * 4 + 3];
        if (alpha === 0) {
            ey = py
        } else {
            sy = py
        }
        py = ey + sy >> 1
    }
    var ratio = py / ih;
    if (ratio === 0) {
        return 1
    } else {
        return ratio
    }
};
var drawImageIOSFix = function drawImageIOSFix(ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {
    var vertSquashRatio = detectVerticalSquash(img);
    return ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio)
};
var ExifRestore = function() {
    function ExifRestore() {
        _classCallCheck(this, ExifRestore)
    }
    _createClass(ExifRestore, null, [{
        key: "initClass",
        value: function initClass() {
            this.KEY_STR = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
        }
    }, {
        key: "encode64",
        value: function encode64(input) {
            var output = "";
            var chr1 = undefined;
            var chr2 = undefined;
            var chr3 = "";
            var enc1 = undefined;
            var enc2 = undefined;
            var enc3 = undefined;
            var enc4 = "";
            var i = 0;
            while (true) {
                chr1 = input[i++];
                chr2 = input[i++];
                chr3 = input[i++];
                enc1 = chr1 >> 2;
                enc2 = (chr1 & 3) << 4 | chr2 >> 4;
                enc3 = (chr2 & 15) << 2 | chr3 >> 6;
                enc4 = chr3 & 63;
                if (isNaN(chr2)) {
                    enc3 = enc4 = 64
                } else if (isNaN(chr3)) {
                    enc4 = 64
                }
                output = output + this.KEY_STR.charAt(enc1) + this.KEY_STR.charAt(enc2) + this.KEY_STR.charAt(enc3) + this.KEY_STR.charAt(enc4);
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
                if (!(i < input.length)) {
                    break
                }
            }
            return output
        }
    }, {
        key: "restore",
        value: function restore(origFileBase64, resizedFileBase64) {
            if (!origFileBase64.match("data:image/jpeg;base64,")) {
                return resizedFileBase64
            }
            var rawImage = this.decode64(origFileBase64.replace("data:image/jpeg;base64,", ""));
            var segments = this.slice2Segments(rawImage);
            var image = this.exifManipulation(resizedFileBase64, segments);
            return "data:image/jpeg;base64," + this.encode64(image)
        }
    }, {
        key: "exifManipulation",
        value: function exifManipulation(resizedFileBase64, segments) {
            var exifArray = this.getExifArray(segments);
            var newImageArray = this.insertExif(resizedFileBase64, exifArray);
            var aBuffer = new Uint8Array(newImageArray);
            return aBuffer
        }
    }, {
        key: "getExifArray",
        value: function getExifArray(segments) {
            var seg = undefined;
            var x = 0;
            while (x < segments.length) {
                seg = segments[x];
                if (seg[0] === 255 & seg[1] === 225) {
                    return seg
                }
                x++
            }
            return []
        }
    }, {
        key: "insertExif",
        value: function insertExif(resizedFileBase64, exifArray) {
            var imageData = resizedFileBase64.replace("data:image/jpeg;base64,", "");
            var buf = this.decode64(imageData);
            var separatePoint = buf.indexOf(255, 3);
            var mae = buf.slice(0, separatePoint);
            var ato = buf.slice(separatePoint);
            var array = mae;
            array = array.concat(exifArray);
            array = array.concat(ato);
            return array
        }
    }, {
        key: "slice2Segments",
        value: function slice2Segments(rawImageArray) {
            var head = 0;
            var segments = [];
            while (true) {
                var length;
                if (rawImageArray[head] === 255 & rawImageArray[head + 1] === 218) {
                    break
                }
                if (rawImageArray[head] === 255 & rawImageArray[head + 1] === 216) {
                    head += 2
                } else {
                    length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3];
                    var endPoint = head + length + 2;
                    var seg = rawImageArray.slice(head, endPoint);
                    segments.push(seg);
                    head = endPoint
                }
                if (head > rawImageArray.length) {
                    break
                }
            }
            return segments
        }
    }, {
        key: "decode64",
        value: function decode64(input) {
            var output = "";
            var chr1 = undefined;
            var chr2 = undefined;
            var chr3 = "";
            var enc1 = undefined;
            var enc2 = undefined;
            var enc3 = undefined;
            var enc4 = "";
            var i = 0;
            var buf = [];
            var base64test = /[^A-Za-z0-9\+\/\=]/g;
            if (base64test.exec(input)) {
                console.warn("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.")
            }
            input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
            while (true) {
                enc1 = this.KEY_STR.indexOf(input.charAt(i++));
                enc2 = this.KEY_STR.indexOf(input.charAt(i++));
                enc3 = this.KEY_STR.indexOf(input.charAt(i++));
                enc4 = this.KEY_STR.indexOf(input.charAt(i++));
                chr1 = enc1 << 2 | enc2 >> 4;
                chr2 = (enc2 & 15) << 4 | enc3 >> 2;
                chr3 = (enc3 & 3) << 6 | enc4;
                buf.push(chr1);
                if (enc3 !== 64) {
                    buf.push(chr2)
                }
                if (enc4 !== 64) {
                    buf.push(chr3)
                }
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
                if (!(i < input.length)) {
                    break
                }
            }
            return buf
        }
    }]);
    return ExifRestore
}();
ExifRestore.initClass();
var contentLoaded = function contentLoaded(win, fn) {
    var done = false;
    var top = true;
    var doc = win.document;
    var root = doc.documentElement;
    var add = doc.addEventListener ? "addEventListener" : "attachEvent";
    var rem = doc.addEventListener ? "removeEventListener" : "detachEvent";
    var pre = doc.addEventListener ? "" : "on";
    var init = function init(e) {
        if (e.type === "readystatechange" && doc.readyState !== "complete") {
            return
        }(e.type === "load" ? win : doc)[rem](pre + e.type, init, false);
        if (!done && (done = true)) {
            return fn.call(win, e.type || e)
        }
    };
    var poll = function poll() {
        try {
            root.doScroll("left")
        } catch (e) {
            setTimeout(poll, 50);
            return
        }
        return init("poll")
    };
    if (doc.readyState !== "complete") {
        if (doc.createEventObject && root.doScroll) {
            try {
                top = !win.frameElement
            } catch (error) {}
            if (top) {
                poll()
            }
        }
        doc[add](pre + "DOMContentLoaded", init, false);
        doc[add](pre + "readystatechange", init, false);
        return win[add](pre + "load", init, false)
    }
};
Dropzone._autoDiscoverFunction = function() {
    if (Dropzone.autoDiscover) {
        return Dropzone.discover()
    }
};
contentLoaded(window, Dropzone._autoDiscoverFunction);

function __guard__(value, transform) {
    return typeof value !== "undefined" && value !== null ? transform(value) : undefined
}

function __guardMethod__(obj, methodName, transform) {
    if (typeof obj !== "undefined" && obj !== null && typeof obj[methodName] === "function") {
        return transform(obj, methodName)
    } else {
        return undefined
    }
}
